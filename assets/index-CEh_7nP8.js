var WR=i=>{throw TypeError(i)};var QT=(i,t,a)=>t.has(i)||WR("Cannot "+a);var Ut=(i,t,a)=>(QT(i,t,"read from private field"),a?a.call(i):t.get(i)),bn=(i,t,a)=>t.has(i)?WR("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,a),zi=(i,t,a,h)=>(QT(i,t,"write to private field"),h?h.call(i,a):t.set(i,a),a),Ao=(i,t,a)=>(QT(i,t,"access private method"),a);var wx=(i,t,a,h)=>({set _(g){zi(i,t,g,a)},get _(){return Ut(i,t,h)}});function JO(i,t){for(var a=0;a<t.length;a++){const h=t[a];if(typeof h!="string"&&!Array.isArray(h)){for(const g in h)if(g!=="default"&&!(g in i)){const v=Object.getOwnPropertyDescriptor(h,g);v&&Object.defineProperty(i,g,v.get?v:{enumerable:!0,get:()=>h[g]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))h(g);new MutationObserver(g=>{for(const v of g)if(v.type==="childList")for(const E of v.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&h(E)}).observe(document,{childList:!0,subtree:!0});function a(g){const v={};return g.integrity&&(v.integrity=g.integrity),g.referrerPolicy&&(v.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?v.credentials="include":g.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function h(g){if(g.ep)return;g.ep=!0;const v=a(g);fetch(g.href,v)}})();var cj=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function v2(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function uj(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var a=function h(){return this instanceof h?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};a.prototype=t.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(h){var g=Object.getOwnPropertyDescriptor(i,h);Object.defineProperty(a,h,g.get?g:{enumerable:!0,get:function(){return i[h]}})}),a}var QO={exports:{}},mw={},eD={exports:{}},nn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v0=Symbol.for("react.element"),hj=Symbol.for("react.portal"),dj=Symbol.for("react.fragment"),fj=Symbol.for("react.strict_mode"),pj=Symbol.for("react.profiler"),mj=Symbol.for("react.provider"),gj=Symbol.for("react.context"),_j=Symbol.for("react.forward_ref"),yj=Symbol.for("react.suspense"),vj=Symbol.for("react.memo"),xj=Symbol.for("react.lazy"),ZR=Symbol.iterator;function wj(i){return i===null||typeof i!="object"?null:(i=ZR&&i[ZR]||i["@@iterator"],typeof i=="function"?i:null)}var tD={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rD=Object.assign,iD={};function Qm(i,t,a){this.props=i,this.context=t,this.refs=iD,this.updater=a||tD}Qm.prototype.isReactComponent={};Qm.prototype.setState=function(i,t){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,t,"setState")};Qm.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function nD(){}nD.prototype=Qm.prototype;function x2(i,t,a){this.props=i,this.context=t,this.refs=iD,this.updater=a||tD}var w2=x2.prototype=new nD;w2.constructor=x2;rD(w2,Qm.prototype);w2.isPureReactComponent=!0;var XR=Array.isArray,sD=Object.prototype.hasOwnProperty,b2={current:null},oD={key:!0,ref:!0,__self:!0,__source:!0};function aD(i,t,a){var h,g={},v=null,E=null;if(t!=null)for(h in t.ref!==void 0&&(E=t.ref),t.key!==void 0&&(v=""+t.key),t)sD.call(t,h)&&!oD.hasOwnProperty(h)&&(g[h]=t[h]);var o=arguments.length-2;if(o===1)g.children=a;else if(1<o){for(var O=Array(o),F=0;F<o;F++)O[F]=arguments[F+2];g.children=O}if(i&&i.defaultProps)for(h in o=i.defaultProps,o)g[h]===void 0&&(g[h]=o[h]);return{$$typeof:v0,type:i,key:v,ref:E,props:g,_owner:b2.current}}function bj(i,t){return{$$typeof:v0,type:i.type,key:t,ref:i.ref,props:i.props,_owner:i._owner}}function T2(i){return typeof i=="object"&&i!==null&&i.$$typeof===v0}function Tj(i){var t={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(a){return t[a]})}var KR=/\/+/g;function eS(i,t){return typeof i=="object"&&i!==null&&i.key!=null?Tj(""+i.key):t.toString(36)}function t1(i,t,a,h,g){var v=typeof i;(v==="undefined"||v==="boolean")&&(i=null);var E=!1;if(i===null)E=!0;else switch(v){case"string":case"number":E=!0;break;case"object":switch(i.$$typeof){case v0:case hj:E=!0}}if(E)return E=i,g=g(E),i=h===""?"."+eS(E,0):h,XR(g)?(a="",i!=null&&(a=i.replace(KR,"$&/")+"/"),t1(g,t,a,"",function(F){return F})):g!=null&&(T2(g)&&(g=bj(g,a+(!g.key||E&&E.key===g.key?"":(""+g.key).replace(KR,"$&/")+"/")+i)),t.push(g)),1;if(E=0,h=h===""?".":h+":",XR(i))for(var o=0;o<i.length;o++){v=i[o];var O=h+eS(v,o);E+=t1(v,t,a,O,g)}else if(O=wj(i),typeof O=="function")for(i=O.call(i),o=0;!(v=i.next()).done;)v=v.value,O=h+eS(v,o++),E+=t1(v,t,a,O,g);else if(v==="object")throw t=String(i),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return E}function bx(i,t,a){if(i==null)return i;var h=[],g=0;return t1(i,h,"","",function(v){return t.call(a,v,g++)}),h}function Sj(i){if(i._status===-1){var t=i._result;t=t(),t.then(function(a){(i._status===0||i._status===-1)&&(i._status=1,i._result=a)},function(a){(i._status===0||i._status===-1)&&(i._status=2,i._result=a)}),i._status===-1&&(i._status=0,i._result=t)}if(i._status===1)return i._result.default;throw i._result}var na={current:null},r1={transition:null},Ej={ReactCurrentDispatcher:na,ReactCurrentBatchConfig:r1,ReactCurrentOwner:b2};function lD(){throw Error("act(...) is not supported in production builds of React.")}nn.Children={map:bx,forEach:function(i,t,a){bx(i,function(){t.apply(this,arguments)},a)},count:function(i){var t=0;return bx(i,function(){t++}),t},toArray:function(i){return bx(i,function(t){return t})||[]},only:function(i){if(!T2(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};nn.Component=Qm;nn.Fragment=dj;nn.Profiler=pj;nn.PureComponent=x2;nn.StrictMode=fj;nn.Suspense=yj;nn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ej;nn.act=lD;nn.cloneElement=function(i,t,a){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var h=rD({},i.props),g=i.key,v=i.ref,E=i._owner;if(t!=null){if(t.ref!==void 0&&(v=t.ref,E=b2.current),t.key!==void 0&&(g=""+t.key),i.type&&i.type.defaultProps)var o=i.type.defaultProps;for(O in t)sD.call(t,O)&&!oD.hasOwnProperty(O)&&(h[O]=t[O]===void 0&&o!==void 0?o[O]:t[O])}var O=arguments.length-2;if(O===1)h.children=a;else if(1<O){o=Array(O);for(var F=0;F<O;F++)o[F]=arguments[F+2];h.children=o}return{$$typeof:v0,type:i.type,key:g,ref:v,props:h,_owner:E}};nn.createContext=function(i){return i={$$typeof:gj,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:mj,_context:i},i.Consumer=i};nn.createElement=aD;nn.createFactory=function(i){var t=aD.bind(null,i);return t.type=i,t};nn.createRef=function(){return{current:null}};nn.forwardRef=function(i){return{$$typeof:_j,render:i}};nn.isValidElement=T2;nn.lazy=function(i){return{$$typeof:xj,_payload:{_status:-1,_result:i},_init:Sj}};nn.memo=function(i,t){return{$$typeof:vj,type:i,compare:t===void 0?null:t}};nn.startTransition=function(i){var t=r1.transition;r1.transition={};try{i()}finally{r1.transition=t}};nn.unstable_act=lD;nn.useCallback=function(i,t){return na.current.useCallback(i,t)};nn.useContext=function(i){return na.current.useContext(i)};nn.useDebugValue=function(){};nn.useDeferredValue=function(i){return na.current.useDeferredValue(i)};nn.useEffect=function(i,t){return na.current.useEffect(i,t)};nn.useId=function(){return na.current.useId()};nn.useImperativeHandle=function(i,t,a){return na.current.useImperativeHandle(i,t,a)};nn.useInsertionEffect=function(i,t){return na.current.useInsertionEffect(i,t)};nn.useLayoutEffect=function(i,t){return na.current.useLayoutEffect(i,t)};nn.useMemo=function(i,t){return na.current.useMemo(i,t)};nn.useReducer=function(i,t,a){return na.current.useReducer(i,t,a)};nn.useRef=function(i){return na.current.useRef(i)};nn.useState=function(i){return na.current.useState(i)};nn.useSyncExternalStore=function(i,t,a){return na.current.useSyncExternalStore(i,t,a)};nn.useTransition=function(){return na.current.useTransition()};nn.version="18.3.1";eD.exports=nn;var ke=eD.exports;const Ft=v2(ke),cD=JO({__proto__:null,default:Ft},[ke]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ij=ke,Aj=Symbol.for("react.element"),Cj=Symbol.for("react.fragment"),Pj=Object.prototype.hasOwnProperty,Rj=Ij.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kj={key:!0,ref:!0,__self:!0,__source:!0};function uD(i,t,a){var h,g={},v=null,E=null;a!==void 0&&(v=""+a),t.key!==void 0&&(v=""+t.key),t.ref!==void 0&&(E=t.ref);for(h in t)Pj.call(t,h)&&!kj.hasOwnProperty(h)&&(g[h]=t[h]);if(i&&i.defaultProps)for(h in t=i.defaultProps,t)g[h]===void 0&&(g[h]=t[h]);return{$$typeof:Aj,type:i,key:v,ref:E,props:g,_owner:Rj.current}}mw.Fragment=Cj;mw.jsx=uD;mw.jsxs=uD;QO.exports=mw;var ye=QO.exports,hD={exports:{}},Xa={},dD={exports:{}},fD={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function t(dt,It){var tr=dt.length;dt.push(It);e:for(;0<tr;){var Gr=tr-1>>>1,Rr=dt[Gr];if(0<g(Rr,It))dt[Gr]=It,dt[tr]=Rr,tr=Gr;else break e}}function a(dt){return dt.length===0?null:dt[0]}function h(dt){if(dt.length===0)return null;var It=dt[0],tr=dt.pop();if(tr!==It){dt[0]=tr;e:for(var Gr=0,Rr=dt.length,Sr=Rr>>>1;Gr<Sr;){var ti=2*(Gr+1)-1,Vi=dt[ti],On=ti+1,wi=dt[On];if(0>g(Vi,tr))On<Rr&&0>g(wi,Vi)?(dt[Gr]=wi,dt[On]=tr,Gr=On):(dt[Gr]=Vi,dt[ti]=tr,Gr=ti);else if(On<Rr&&0>g(wi,tr))dt[Gr]=wi,dt[On]=tr,Gr=On;else break e}}return It}function g(dt,It){var tr=dt.sortIndex-It.sortIndex;return tr!==0?tr:dt.id-It.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;i.unstable_now=function(){return v.now()}}else{var E=Date,o=E.now();i.unstable_now=function(){return E.now()-o}}var O=[],F=[],$=1,Q=null,te=3,J=!1,we=!1,se=!1,me=typeof setTimeout=="function"?setTimeout:null,fe=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function de(dt){for(var It=a(F);It!==null;){if(It.callback===null)h(F);else if(It.startTime<=dt)h(F),It.sortIndex=It.expirationTime,t(O,It);else break;It=a(F)}}function Oe(dt){if(se=!1,de(dt),!we)if(a(O)!==null)we=!0,Qt(Xe);else{var It=a(F);It!==null&&er(Oe,It.startTime-dt)}}function Xe(dt,It){we=!1,se&&(se=!1,fe(bt),bt=-1),J=!0;var tr=te;try{for(de(It),Q=a(O);Q!==null&&(!(Q.expirationTime>It)||dt&&!nr());){var Gr=Q.callback;if(typeof Gr=="function"){Q.callback=null,te=Q.priorityLevel;var Rr=Gr(Q.expirationTime<=It);It=i.unstable_now(),typeof Rr=="function"?Q.callback=Rr:Q===a(O)&&h(O),de(It)}else h(O);Q=a(O)}if(Q!==null)var Sr=!0;else{var ti=a(F);ti!==null&&er(Oe,ti.startTime-It),Sr=!1}return Sr}finally{Q=null,te=tr,J=!1}}var qe=!1,Be=null,bt=-1,Bt=5,Jt=-1;function nr(){return!(i.unstable_now()-Jt<Bt)}function Gt(){if(Be!==null){var dt=i.unstable_now();Jt=dt;var It=!0;try{It=Be(!0,dt)}finally{It?Mt():(qe=!1,Be=null)}}else qe=!1}var Mt;if(typeof re=="function")Mt=function(){re(Gt)};else if(typeof MessageChannel<"u"){var Zt=new MessageChannel,mr=Zt.port2;Zt.port1.onmessage=Gt,Mt=function(){mr.postMessage(null)}}else Mt=function(){me(Gt,0)};function Qt(dt){Be=dt,qe||(qe=!0,Mt())}function er(dt,It){bt=me(function(){dt(i.unstable_now())},It)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(dt){dt.callback=null},i.unstable_continueExecution=function(){we||J||(we=!0,Qt(Xe))},i.unstable_forceFrameRate=function(dt){0>dt||125<dt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Bt=0<dt?Math.floor(1e3/dt):5},i.unstable_getCurrentPriorityLevel=function(){return te},i.unstable_getFirstCallbackNode=function(){return a(O)},i.unstable_next=function(dt){switch(te){case 1:case 2:case 3:var It=3;break;default:It=te}var tr=te;te=It;try{return dt()}finally{te=tr}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(dt,It){switch(dt){case 1:case 2:case 3:case 4:case 5:break;default:dt=3}var tr=te;te=dt;try{return It()}finally{te=tr}},i.unstable_scheduleCallback=function(dt,It,tr){var Gr=i.unstable_now();switch(typeof tr=="object"&&tr!==null?(tr=tr.delay,tr=typeof tr=="number"&&0<tr?Gr+tr:Gr):tr=Gr,dt){case 1:var Rr=-1;break;case 2:Rr=250;break;case 5:Rr=1073741823;break;case 4:Rr=1e4;break;default:Rr=5e3}return Rr=tr+Rr,dt={id:$++,callback:It,priorityLevel:dt,startTime:tr,expirationTime:Rr,sortIndex:-1},tr>Gr?(dt.sortIndex=tr,t(F,dt),a(O)===null&&dt===a(F)&&(se?(fe(bt),bt=-1):se=!0,er(Oe,tr-Gr))):(dt.sortIndex=Rr,t(O,dt),we||J||(we=!0,Qt(Xe))),dt},i.unstable_shouldYield=nr,i.unstable_wrapCallback=function(dt){var It=te;return function(){var tr=te;te=It;try{return dt.apply(this,arguments)}finally{te=tr}}}})(fD);dD.exports=fD;var Mj=dD.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oj=ke,Wa=Mj;function sr(i){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+i,a=1;a<arguments.length;a++)t+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+i+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var pD=new Set,Gy={};function Sf(i,t){Nm(i,t),Nm(i+"Capture",t)}function Nm(i,t){for(Gy[i]=t,i=0;i<t.length;i++)pD.add(t[i])}var hu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),qS=Object.prototype.hasOwnProperty,Dj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,YR={},JR={};function Lj(i){return qS.call(JR,i)?!0:qS.call(YR,i)?!1:Dj.test(i)?JR[i]=!0:(YR[i]=!0,!1)}function zj(i,t,a,h){if(a!==null&&a.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return h?!1:a!==null?!a.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Fj(i,t,a,h){if(t===null||typeof t>"u"||zj(i,t,a,h))return!0;if(h)return!1;if(a!==null)switch(a.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function sa(i,t,a,h,g,v,E){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=h,this.attributeNamespace=g,this.mustUseProperty=a,this.propertyName=i,this.type=t,this.sanitizeURL=v,this.removeEmptyString=E}var yo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){yo[i]=new sa(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var t=i[0];yo[t]=new sa(t,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){yo[i]=new sa(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){yo[i]=new sa(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){yo[i]=new sa(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){yo[i]=new sa(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){yo[i]=new sa(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){yo[i]=new sa(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){yo[i]=new sa(i,5,!1,i.toLowerCase(),null,!1,!1)});var S2=/[\-:]([a-z])/g;function E2(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var t=i.replace(S2,E2);yo[t]=new sa(t,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var t=i.replace(S2,E2);yo[t]=new sa(t,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var t=i.replace(S2,E2);yo[t]=new sa(t,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){yo[i]=new sa(i,1,!1,i.toLowerCase(),null,!1,!1)});yo.xlinkHref=new sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){yo[i]=new sa(i,1,!1,i.toLowerCase(),null,!0,!0)});function I2(i,t,a,h){var g=yo.hasOwnProperty(t)?yo[t]:null;(g!==null?g.type!==0:h||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Fj(t,a,g,h)&&(a=null),h||g===null?Lj(t)&&(a===null?i.removeAttribute(t):i.setAttribute(t,""+a)):g.mustUseProperty?i[g.propertyName]=a===null?g.type===3?!1:"":a:(t=g.attributeName,h=g.attributeNamespace,a===null?i.removeAttribute(t):(g=g.type,a=g===3||g===4&&a===!0?"":""+a,h?i.setAttributeNS(h,t,a):i.setAttribute(t,a))))}var yu=Oj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Tx=Symbol.for("react.element"),cm=Symbol.for("react.portal"),um=Symbol.for("react.fragment"),A2=Symbol.for("react.strict_mode"),WS=Symbol.for("react.profiler"),mD=Symbol.for("react.provider"),gD=Symbol.for("react.context"),C2=Symbol.for("react.forward_ref"),ZS=Symbol.for("react.suspense"),XS=Symbol.for("react.suspense_list"),P2=Symbol.for("react.memo"),mh=Symbol.for("react.lazy"),_D=Symbol.for("react.offscreen"),QR=Symbol.iterator;function hy(i){return i===null||typeof i!="object"?null:(i=QR&&i[QR]||i["@@iterator"],typeof i=="function"?i:null)}var ps=Object.assign,tS;function Ty(i){if(tS===void 0)try{throw Error()}catch(a){var t=a.stack.trim().match(/\n( *(at )?)/);tS=t&&t[1]||""}return`
`+tS+i}var rS=!1;function iS(i,t){if(!i||rS)return"";rS=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(F){var h=F}Reflect.construct(i,[],t)}else{try{t.call()}catch(F){h=F}i.call(t.prototype)}else{try{throw Error()}catch(F){h=F}i()}}catch(F){if(F&&h&&typeof F.stack=="string"){for(var g=F.stack.split(`
`),v=h.stack.split(`
`),E=g.length-1,o=v.length-1;1<=E&&0<=o&&g[E]!==v[o];)o--;for(;1<=E&&0<=o;E--,o--)if(g[E]!==v[o]){if(E!==1||o!==1)do if(E--,o--,0>o||g[E]!==v[o]){var O=`
`+g[E].replace(" at new "," at ");return i.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",i.displayName)),O}while(1<=E&&0<=o);break}}}finally{rS=!1,Error.prepareStackTrace=a}return(i=i?i.displayName||i.name:"")?Ty(i):""}function Bj(i){switch(i.tag){case 5:return Ty(i.type);case 16:return Ty("Lazy");case 13:return Ty("Suspense");case 19:return Ty("SuspenseList");case 0:case 2:case 15:return i=iS(i.type,!1),i;case 11:return i=iS(i.type.render,!1),i;case 1:return i=iS(i.type,!0),i;default:return""}}function KS(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case um:return"Fragment";case cm:return"Portal";case WS:return"Profiler";case A2:return"StrictMode";case ZS:return"Suspense";case XS:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case gD:return(i.displayName||"Context")+".Consumer";case mD:return(i._context.displayName||"Context")+".Provider";case C2:var t=i.render;return i=i.displayName,i||(i=t.displayName||t.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case P2:return t=i.displayName||null,t!==null?t:KS(i.type)||"Memo";case mh:t=i._payload,i=i._init;try{return KS(i(t))}catch{}}return null}function Nj(i){var t=i.type;switch(i.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=t.render,i=i.displayName||i.name||"",t.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return KS(t);case 8:return t===A2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Nh(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function yD(i){var t=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function jj(i){var t=yD(i)?"checked":"value",a=Object.getOwnPropertyDescriptor(i.constructor.prototype,t),h=""+i[t];if(!i.hasOwnProperty(t)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var g=a.get,v=a.set;return Object.defineProperty(i,t,{configurable:!0,get:function(){return g.call(this)},set:function(E){h=""+E,v.call(this,E)}}),Object.defineProperty(i,t,{enumerable:a.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){i._valueTracker=null,delete i[t]}}}}function Sx(i){i._valueTracker||(i._valueTracker=jj(i))}function vD(i){if(!i)return!1;var t=i._valueTracker;if(!t)return!0;var a=t.getValue(),h="";return i&&(h=yD(i)?i.checked?"true":"false":i.value),i=h,i!==a?(t.setValue(i),!0):!1}function b1(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function YS(i,t){var a=t.checked;return ps({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??i._wrapperState.initialChecked})}function ek(i,t){var a=t.defaultValue==null?"":t.defaultValue,h=t.checked!=null?t.checked:t.defaultChecked;a=Nh(t.value!=null?t.value:a),i._wrapperState={initialChecked:h,initialValue:a,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function xD(i,t){t=t.checked,t!=null&&I2(i,"checked",t,!1)}function JS(i,t){xD(i,t);var a=Nh(t.value),h=t.type;if(a!=null)h==="number"?(a===0&&i.value===""||i.value!=a)&&(i.value=""+a):i.value!==""+a&&(i.value=""+a);else if(h==="submit"||h==="reset"){i.removeAttribute("value");return}t.hasOwnProperty("value")?QS(i,t.type,a):t.hasOwnProperty("defaultValue")&&QS(i,t.type,Nh(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(i.defaultChecked=!!t.defaultChecked)}function tk(i,t,a){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var h=t.type;if(!(h!=="submit"&&h!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+i._wrapperState.initialValue,a||t===i.value||(i.value=t),i.defaultValue=t}a=i.name,a!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,a!==""&&(i.name=a)}function QS(i,t,a){(t!=="number"||b1(i.ownerDocument)!==i)&&(a==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+a&&(i.defaultValue=""+a))}var Sy=Array.isArray;function wm(i,t,a,h){if(i=i.options,t){t={};for(var g=0;g<a.length;g++)t["$"+a[g]]=!0;for(a=0;a<i.length;a++)g=t.hasOwnProperty("$"+i[a].value),i[a].selected!==g&&(i[a].selected=g),g&&h&&(i[a].defaultSelected=!0)}else{for(a=""+Nh(a),t=null,g=0;g<i.length;g++){if(i[g].value===a){i[g].selected=!0,h&&(i[g].defaultSelected=!0);return}t!==null||i[g].disabled||(t=i[g])}t!==null&&(t.selected=!0)}}function eE(i,t){if(t.dangerouslySetInnerHTML!=null)throw Error(sr(91));return ps({},t,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function rk(i,t){var a=t.value;if(a==null){if(a=t.children,t=t.defaultValue,a!=null){if(t!=null)throw Error(sr(92));if(Sy(a)){if(1<a.length)throw Error(sr(93));a=a[0]}t=a}t==null&&(t=""),a=t}i._wrapperState={initialValue:Nh(a)}}function wD(i,t){var a=Nh(t.value),h=Nh(t.defaultValue);a!=null&&(a=""+a,a!==i.value&&(i.value=a),t.defaultValue==null&&i.defaultValue!==a&&(i.defaultValue=a)),h!=null&&(i.defaultValue=""+h)}function ik(i){var t=i.textContent;t===i._wrapperState.initialValue&&t!==""&&t!==null&&(i.value=t)}function bD(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function tE(i,t){return i==null||i==="http://www.w3.org/1999/xhtml"?bD(t):i==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ex,TD=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,a,h,g){MSApp.execUnsafeLocalFunction(function(){return i(t,a,h,g)})}:i}(function(i,t){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=t;else{for(Ex=Ex||document.createElement("div"),Ex.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ex.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;t.firstChild;)i.appendChild(t.firstChild)}});function Hy(i,t){if(t){var a=i.firstChild;if(a&&a===i.lastChild&&a.nodeType===3){a.nodeValue=t;return}}i.textContent=t}var Py={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vj=["Webkit","ms","Moz","O"];Object.keys(Py).forEach(function(i){Vj.forEach(function(t){t=t+i.charAt(0).toUpperCase()+i.substring(1),Py[t]=Py[i]})});function SD(i,t,a){return t==null||typeof t=="boolean"||t===""?"":a||typeof t!="number"||t===0||Py.hasOwnProperty(i)&&Py[i]?(""+t).trim():t+"px"}function ED(i,t){i=i.style;for(var a in t)if(t.hasOwnProperty(a)){var h=a.indexOf("--")===0,g=SD(a,t[a],h);a==="float"&&(a="cssFloat"),h?i.setProperty(a,g):i[a]=g}}var Uj=ps({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rE(i,t){if(t){if(Uj[i]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(sr(137,i));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(sr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(sr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(sr(62))}}function iE(i,t){if(i.indexOf("-")===-1)return typeof t.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nE=null;function R2(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var sE=null,bm=null,Tm=null;function nk(i){if(i=b0(i)){if(typeof sE!="function")throw Error(sr(280));var t=i.stateNode;t&&(t=xw(t),sE(i.stateNode,i.type,t))}}function ID(i){bm?Tm?Tm.push(i):Tm=[i]:bm=i}function AD(){if(bm){var i=bm,t=Tm;if(Tm=bm=null,nk(i),t)for(i=0;i<t.length;i++)nk(t[i])}}function CD(i,t){return i(t)}function PD(){}var nS=!1;function RD(i,t,a){if(nS)return i(t,a);nS=!0;try{return CD(i,t,a)}finally{nS=!1,(bm!==null||Tm!==null)&&(PD(),AD())}}function qy(i,t){var a=i.stateNode;if(a===null)return null;var h=xw(a);if(h===null)return null;a=h[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(a&&typeof a!="function")throw Error(sr(231,t,typeof a));return a}var oE=!1;if(hu)try{var dy={};Object.defineProperty(dy,"passive",{get:function(){oE=!0}}),window.addEventListener("test",dy,dy),window.removeEventListener("test",dy,dy)}catch{oE=!1}function $j(i,t,a,h,g,v,E,o,O){var F=Array.prototype.slice.call(arguments,3);try{t.apply(a,F)}catch($){this.onError($)}}var Ry=!1,T1=null,S1=!1,aE=null,Gj={onError:function(i){Ry=!0,T1=i}};function Hj(i,t,a,h,g,v,E,o,O){Ry=!1,T1=null,$j.apply(Gj,arguments)}function qj(i,t,a,h,g,v,E,o,O){if(Hj.apply(this,arguments),Ry){if(Ry){var F=T1;Ry=!1,T1=null}else throw Error(sr(198));S1||(S1=!0,aE=F)}}function Ef(i){var t=i,a=i;if(i.alternate)for(;t.return;)t=t.return;else{i=t;do t=i,t.flags&4098&&(a=t.return),i=t.return;while(i)}return t.tag===3?a:null}function kD(i){if(i.tag===13){var t=i.memoizedState;if(t===null&&(i=i.alternate,i!==null&&(t=i.memoizedState)),t!==null)return t.dehydrated}return null}function sk(i){if(Ef(i)!==i)throw Error(sr(188))}function Wj(i){var t=i.alternate;if(!t){if(t=Ef(i),t===null)throw Error(sr(188));return t!==i?null:i}for(var a=i,h=t;;){var g=a.return;if(g===null)break;var v=g.alternate;if(v===null){if(h=g.return,h!==null){a=h;continue}break}if(g.child===v.child){for(v=g.child;v;){if(v===a)return sk(g),i;if(v===h)return sk(g),t;v=v.sibling}throw Error(sr(188))}if(a.return!==h.return)a=g,h=v;else{for(var E=!1,o=g.child;o;){if(o===a){E=!0,a=g,h=v;break}if(o===h){E=!0,h=g,a=v;break}o=o.sibling}if(!E){for(o=v.child;o;){if(o===a){E=!0,a=v,h=g;break}if(o===h){E=!0,h=v,a=g;break}o=o.sibling}if(!E)throw Error(sr(189))}}if(a.alternate!==h)throw Error(sr(190))}if(a.tag!==3)throw Error(sr(188));return a.stateNode.current===a?i:t}function MD(i){return i=Wj(i),i!==null?OD(i):null}function OD(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var t=OD(i);if(t!==null)return t;i=i.sibling}return null}var DD=Wa.unstable_scheduleCallback,ok=Wa.unstable_cancelCallback,Zj=Wa.unstable_shouldYield,Xj=Wa.unstable_requestPaint,Cs=Wa.unstable_now,Kj=Wa.unstable_getCurrentPriorityLevel,k2=Wa.unstable_ImmediatePriority,LD=Wa.unstable_UserBlockingPriority,E1=Wa.unstable_NormalPriority,Yj=Wa.unstable_LowPriority,zD=Wa.unstable_IdlePriority,gw=null,Sc=null;function Jj(i){if(Sc&&typeof Sc.onCommitFiberRoot=="function")try{Sc.onCommitFiberRoot(gw,i,void 0,(i.current.flags&128)===128)}catch{}}var Hl=Math.clz32?Math.clz32:tV,Qj=Math.log,eV=Math.LN2;function tV(i){return i>>>=0,i===0?32:31-(Qj(i)/eV|0)|0}var Ix=64,Ax=4194304;function Ey(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function I1(i,t){var a=i.pendingLanes;if(a===0)return 0;var h=0,g=i.suspendedLanes,v=i.pingedLanes,E=a&268435455;if(E!==0){var o=E&~g;o!==0?h=Ey(o):(v&=E,v!==0&&(h=Ey(v)))}else E=a&~g,E!==0?h=Ey(E):v!==0&&(h=Ey(v));if(h===0)return 0;if(t!==0&&t!==h&&!(t&g)&&(g=h&-h,v=t&-t,g>=v||g===16&&(v&4194240)!==0))return t;if(h&4&&(h|=a&16),t=i.entangledLanes,t!==0)for(i=i.entanglements,t&=h;0<t;)a=31-Hl(t),g=1<<a,h|=i[a],t&=~g;return h}function rV(i,t){switch(i){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iV(i,t){for(var a=i.suspendedLanes,h=i.pingedLanes,g=i.expirationTimes,v=i.pendingLanes;0<v;){var E=31-Hl(v),o=1<<E,O=g[E];O===-1?(!(o&a)||o&h)&&(g[E]=rV(o,t)):O<=t&&(i.expiredLanes|=o),v&=~o}}function lE(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function FD(){var i=Ix;return Ix<<=1,!(Ix&4194240)&&(Ix=64),i}function sS(i){for(var t=[],a=0;31>a;a++)t.push(i);return t}function x0(i,t,a){i.pendingLanes|=t,t!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,t=31-Hl(t),i[t]=a}function nV(i,t){var a=i.pendingLanes&~t;i.pendingLanes=t,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=t,i.mutableReadLanes&=t,i.entangledLanes&=t,t=i.entanglements;var h=i.eventTimes;for(i=i.expirationTimes;0<a;){var g=31-Hl(a),v=1<<g;t[g]=0,h[g]=-1,i[g]=-1,a&=~v}}function M2(i,t){var a=i.entangledLanes|=t;for(i=i.entanglements;a;){var h=31-Hl(a),g=1<<h;g&t|i[h]&t&&(i[h]|=t),a&=~g}}var zn=0;function BD(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var ND,O2,jD,VD,UD,cE=!1,Cx=[],Rh=null,kh=null,Mh=null,Wy=new Map,Zy=new Map,yh=[],sV="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ak(i,t){switch(i){case"focusin":case"focusout":Rh=null;break;case"dragenter":case"dragleave":kh=null;break;case"mouseover":case"mouseout":Mh=null;break;case"pointerover":case"pointerout":Wy.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Zy.delete(t.pointerId)}}function fy(i,t,a,h,g,v){return i===null||i.nativeEvent!==v?(i={blockedOn:t,domEventName:a,eventSystemFlags:h,nativeEvent:v,targetContainers:[g]},t!==null&&(t=b0(t),t!==null&&O2(t)),i):(i.eventSystemFlags|=h,t=i.targetContainers,g!==null&&t.indexOf(g)===-1&&t.push(g),i)}function oV(i,t,a,h,g){switch(t){case"focusin":return Rh=fy(Rh,i,t,a,h,g),!0;case"dragenter":return kh=fy(kh,i,t,a,h,g),!0;case"mouseover":return Mh=fy(Mh,i,t,a,h,g),!0;case"pointerover":var v=g.pointerId;return Wy.set(v,fy(Wy.get(v)||null,i,t,a,h,g)),!0;case"gotpointercapture":return v=g.pointerId,Zy.set(v,fy(Zy.get(v)||null,i,t,a,h,g)),!0}return!1}function $D(i){var t=nf(i.target);if(t!==null){var a=Ef(t);if(a!==null){if(t=a.tag,t===13){if(t=kD(a),t!==null){i.blockedOn=t,UD(i.priority,function(){jD(a)});return}}else if(t===3&&a.stateNode.current.memoizedState.isDehydrated){i.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}i.blockedOn=null}function i1(i){if(i.blockedOn!==null)return!1;for(var t=i.targetContainers;0<t.length;){var a=uE(i.domEventName,i.eventSystemFlags,t[0],i.nativeEvent);if(a===null){a=i.nativeEvent;var h=new a.constructor(a.type,a);nE=h,a.target.dispatchEvent(h),nE=null}else return t=b0(a),t!==null&&O2(t),i.blockedOn=a,!1;t.shift()}return!0}function lk(i,t,a){i1(i)&&a.delete(t)}function aV(){cE=!1,Rh!==null&&i1(Rh)&&(Rh=null),kh!==null&&i1(kh)&&(kh=null),Mh!==null&&i1(Mh)&&(Mh=null),Wy.forEach(lk),Zy.forEach(lk)}function py(i,t){i.blockedOn===t&&(i.blockedOn=null,cE||(cE=!0,Wa.unstable_scheduleCallback(Wa.unstable_NormalPriority,aV)))}function Xy(i){function t(g){return py(g,i)}if(0<Cx.length){py(Cx[0],i);for(var a=1;a<Cx.length;a++){var h=Cx[a];h.blockedOn===i&&(h.blockedOn=null)}}for(Rh!==null&&py(Rh,i),kh!==null&&py(kh,i),Mh!==null&&py(Mh,i),Wy.forEach(t),Zy.forEach(t),a=0;a<yh.length;a++)h=yh[a],h.blockedOn===i&&(h.blockedOn=null);for(;0<yh.length&&(a=yh[0],a.blockedOn===null);)$D(a),a.blockedOn===null&&yh.shift()}var Sm=yu.ReactCurrentBatchConfig,A1=!0;function lV(i,t,a,h){var g=zn,v=Sm.transition;Sm.transition=null;try{zn=1,D2(i,t,a,h)}finally{zn=g,Sm.transition=v}}function cV(i,t,a,h){var g=zn,v=Sm.transition;Sm.transition=null;try{zn=4,D2(i,t,a,h)}finally{zn=g,Sm.transition=v}}function D2(i,t,a,h){if(A1){var g=uE(i,t,a,h);if(g===null)mS(i,t,h,C1,a),ak(i,h);else if(oV(g,i,t,a,h))h.stopPropagation();else if(ak(i,h),t&4&&-1<sV.indexOf(i)){for(;g!==null;){var v=b0(g);if(v!==null&&ND(v),v=uE(i,t,a,h),v===null&&mS(i,t,h,C1,a),v===g)break;g=v}g!==null&&h.stopPropagation()}else mS(i,t,h,null,a)}}var C1=null;function uE(i,t,a,h){if(C1=null,i=R2(h),i=nf(i),i!==null)if(t=Ef(i),t===null)i=null;else if(a=t.tag,a===13){if(i=kD(t),i!==null)return i;i=null}else if(a===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;i=null}else t!==i&&(i=null);return C1=i,null}function GD(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Kj()){case k2:return 1;case LD:return 4;case E1:case Yj:return 16;case zD:return 536870912;default:return 16}default:return 16}}var Ih=null,L2=null,n1=null;function HD(){if(n1)return n1;var i,t=L2,a=t.length,h,g="value"in Ih?Ih.value:Ih.textContent,v=g.length;for(i=0;i<a&&t[i]===g[i];i++);var E=a-i;for(h=1;h<=E&&t[a-h]===g[v-h];h++);return n1=g.slice(i,1<h?1-h:void 0)}function s1(i){var t=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&t===13&&(i=13)):i=t,i===10&&(i=13),32<=i||i===13?i:0}function Px(){return!0}function ck(){return!1}function Ka(i){function t(a,h,g,v,E){this._reactName=a,this._targetInst=g,this.type=h,this.nativeEvent=v,this.target=E,this.currentTarget=null;for(var o in i)i.hasOwnProperty(o)&&(a=i[o],this[o]=a?a(v):v[o]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Px:ck,this.isPropagationStopped=ck,this}return ps(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Px)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Px)},persist:function(){},isPersistent:Px}),t}var eg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},z2=Ka(eg),w0=ps({},eg,{view:0,detail:0}),uV=Ka(w0),oS,aS,my,_w=ps({},w0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:F2,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==my&&(my&&i.type==="mousemove"?(oS=i.screenX-my.screenX,aS=i.screenY-my.screenY):aS=oS=0,my=i),oS)},movementY:function(i){return"movementY"in i?i.movementY:aS}}),uk=Ka(_w),hV=ps({},_w,{dataTransfer:0}),dV=Ka(hV),fV=ps({},w0,{relatedTarget:0}),lS=Ka(fV),pV=ps({},eg,{animationName:0,elapsedTime:0,pseudoElement:0}),mV=Ka(pV),gV=ps({},eg,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),_V=Ka(gV),yV=ps({},eg,{data:0}),hk=Ka(yV),vV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bV(i){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(i):(i=wV[i])?!!t[i]:!1}function F2(){return bV}var TV=ps({},w0,{key:function(i){if(i.key){var t=vV[i.key]||i.key;if(t!=="Unidentified")return t}return i.type==="keypress"?(i=s1(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?xV[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:F2,charCode:function(i){return i.type==="keypress"?s1(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?s1(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),SV=Ka(TV),EV=ps({},_w,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dk=Ka(EV),IV=ps({},w0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:F2}),AV=Ka(IV),CV=ps({},eg,{propertyName:0,elapsedTime:0,pseudoElement:0}),PV=Ka(CV),RV=ps({},_w,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),kV=Ka(RV),MV=[9,13,27,32],B2=hu&&"CompositionEvent"in window,ky=null;hu&&"documentMode"in document&&(ky=document.documentMode);var OV=hu&&"TextEvent"in window&&!ky,qD=hu&&(!B2||ky&&8<ky&&11>=ky),fk=" ",pk=!1;function WD(i,t){switch(i){case"keyup":return MV.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZD(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var hm=!1;function DV(i,t){switch(i){case"compositionend":return ZD(t);case"keypress":return t.which!==32?null:(pk=!0,fk);case"textInput":return i=t.data,i===fk&&pk?null:i;default:return null}}function LV(i,t){if(hm)return i==="compositionend"||!B2&&WD(i,t)?(i=HD(),n1=L2=Ih=null,hm=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return qD&&t.locale!=="ko"?null:t.data;default:return null}}var zV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function mk(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t==="input"?!!zV[i.type]:t==="textarea"}function XD(i,t,a,h){ID(h),t=P1(t,"onChange"),0<t.length&&(a=new z2("onChange","change",null,a,h),i.push({event:a,listeners:t}))}var My=null,Ky=null;function FV(i){oL(i,0)}function yw(i){var t=pm(i);if(vD(t))return i}function BV(i,t){if(i==="change")return t}var KD=!1;if(hu){var cS;if(hu){var uS="oninput"in document;if(!uS){var gk=document.createElement("div");gk.setAttribute("oninput","return;"),uS=typeof gk.oninput=="function"}cS=uS}else cS=!1;KD=cS&&(!document.documentMode||9<document.documentMode)}function _k(){My&&(My.detachEvent("onpropertychange",YD),Ky=My=null)}function YD(i){if(i.propertyName==="value"&&yw(Ky)){var t=[];XD(t,Ky,i,R2(i)),RD(FV,t)}}function NV(i,t,a){i==="focusin"?(_k(),My=t,Ky=a,My.attachEvent("onpropertychange",YD)):i==="focusout"&&_k()}function jV(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return yw(Ky)}function VV(i,t){if(i==="click")return yw(t)}function UV(i,t){if(i==="input"||i==="change")return yw(t)}function $V(i,t){return i===t&&(i!==0||1/i===1/t)||i!==i&&t!==t}var Wl=typeof Object.is=="function"?Object.is:$V;function Yy(i,t){if(Wl(i,t))return!0;if(typeof i!="object"||i===null||typeof t!="object"||t===null)return!1;var a=Object.keys(i),h=Object.keys(t);if(a.length!==h.length)return!1;for(h=0;h<a.length;h++){var g=a[h];if(!qS.call(t,g)||!Wl(i[g],t[g]))return!1}return!0}function yk(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function vk(i,t){var a=yk(i);i=0;for(var h;a;){if(a.nodeType===3){if(h=i+a.textContent.length,i<=t&&h>=t)return{node:a,offset:t-i};i=h}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=yk(a)}}function JD(i,t){return i&&t?i===t?!0:i&&i.nodeType===3?!1:t&&t.nodeType===3?JD(i,t.parentNode):"contains"in i?i.contains(t):i.compareDocumentPosition?!!(i.compareDocumentPosition(t)&16):!1:!1}function QD(){for(var i=window,t=b1();t instanceof i.HTMLIFrameElement;){try{var a=typeof t.contentWindow.location.href=="string"}catch{a=!1}if(a)i=t.contentWindow;else break;t=b1(i.document)}return t}function N2(i){var t=i&&i.nodeName&&i.nodeName.toLowerCase();return t&&(t==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||t==="textarea"||i.contentEditable==="true")}function GV(i){var t=QD(),a=i.focusedElem,h=i.selectionRange;if(t!==a&&a&&a.ownerDocument&&JD(a.ownerDocument.documentElement,a)){if(h!==null&&N2(a)){if(t=h.start,i=h.end,i===void 0&&(i=t),"selectionStart"in a)a.selectionStart=t,a.selectionEnd=Math.min(i,a.value.length);else if(i=(t=a.ownerDocument||document)&&t.defaultView||window,i.getSelection){i=i.getSelection();var g=a.textContent.length,v=Math.min(h.start,g);h=h.end===void 0?v:Math.min(h.end,g),!i.extend&&v>h&&(g=h,h=v,v=g),g=vk(a,v);var E=vk(a,h);g&&E&&(i.rangeCount!==1||i.anchorNode!==g.node||i.anchorOffset!==g.offset||i.focusNode!==E.node||i.focusOffset!==E.offset)&&(t=t.createRange(),t.setStart(g.node,g.offset),i.removeAllRanges(),v>h?(i.addRange(t),i.extend(E.node,E.offset)):(t.setEnd(E.node,E.offset),i.addRange(t)))}}for(t=[],i=a;i=i.parentNode;)i.nodeType===1&&t.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<t.length;a++)i=t[a],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var HV=hu&&"documentMode"in document&&11>=document.documentMode,dm=null,hE=null,Oy=null,dE=!1;function xk(i,t,a){var h=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;dE||dm==null||dm!==b1(h)||(h=dm,"selectionStart"in h&&N2(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Oy&&Yy(Oy,h)||(Oy=h,h=P1(hE,"onSelect"),0<h.length&&(t=new z2("onSelect","select",null,t,a),i.push({event:t,listeners:h}),t.target=dm)))}function Rx(i,t){var a={};return a[i.toLowerCase()]=t.toLowerCase(),a["Webkit"+i]="webkit"+t,a["Moz"+i]="moz"+t,a}var fm={animationend:Rx("Animation","AnimationEnd"),animationiteration:Rx("Animation","AnimationIteration"),animationstart:Rx("Animation","AnimationStart"),transitionend:Rx("Transition","TransitionEnd")},hS={},eL={};hu&&(eL=document.createElement("div").style,"AnimationEvent"in window||(delete fm.animationend.animation,delete fm.animationiteration.animation,delete fm.animationstart.animation),"TransitionEvent"in window||delete fm.transitionend.transition);function vw(i){if(hS[i])return hS[i];if(!fm[i])return i;var t=fm[i],a;for(a in t)if(t.hasOwnProperty(a)&&a in eL)return hS[i]=t[a];return i}var tL=vw("animationend"),rL=vw("animationiteration"),iL=vw("animationstart"),nL=vw("transitionend"),sL=new Map,wk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wh(i,t){sL.set(i,t),Sf(t,[i])}for(var dS=0;dS<wk.length;dS++){var fS=wk[dS],qV=fS.toLowerCase(),WV=fS[0].toUpperCase()+fS.slice(1);Wh(qV,"on"+WV)}Wh(tL,"onAnimationEnd");Wh(rL,"onAnimationIteration");Wh(iL,"onAnimationStart");Wh("dblclick","onDoubleClick");Wh("focusin","onFocus");Wh("focusout","onBlur");Wh(nL,"onTransitionEnd");Nm("onMouseEnter",["mouseout","mouseover"]);Nm("onMouseLeave",["mouseout","mouseover"]);Nm("onPointerEnter",["pointerout","pointerover"]);Nm("onPointerLeave",["pointerout","pointerover"]);Sf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Sf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Sf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Sf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Sf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Sf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ZV=new Set("cancel close invalid load scroll toggle".split(" ").concat(Iy));function bk(i,t,a){var h=i.type||"unknown-event";i.currentTarget=a,qj(h,t,void 0,i),i.currentTarget=null}function oL(i,t){t=(t&4)!==0;for(var a=0;a<i.length;a++){var h=i[a],g=h.event;h=h.listeners;e:{var v=void 0;if(t)for(var E=h.length-1;0<=E;E--){var o=h[E],O=o.instance,F=o.currentTarget;if(o=o.listener,O!==v&&g.isPropagationStopped())break e;bk(g,o,F),v=O}else for(E=0;E<h.length;E++){if(o=h[E],O=o.instance,F=o.currentTarget,o=o.listener,O!==v&&g.isPropagationStopped())break e;bk(g,o,F),v=O}}}if(S1)throw i=aE,S1=!1,aE=null,i}function Kn(i,t){var a=t[_E];a===void 0&&(a=t[_E]=new Set);var h=i+"__bubble";a.has(h)||(aL(t,i,2,!1),a.add(h))}function pS(i,t,a){var h=0;t&&(h|=4),aL(a,i,h,t)}var kx="_reactListening"+Math.random().toString(36).slice(2);function Jy(i){if(!i[kx]){i[kx]=!0,pD.forEach(function(a){a!=="selectionchange"&&(ZV.has(a)||pS(a,!1,i),pS(a,!0,i))});var t=i.nodeType===9?i:i.ownerDocument;t===null||t[kx]||(t[kx]=!0,pS("selectionchange",!1,t))}}function aL(i,t,a,h){switch(GD(t)){case 1:var g=lV;break;case 4:g=cV;break;default:g=D2}a=g.bind(null,t,a,i),g=void 0,!oE||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(g=!0),h?g!==void 0?i.addEventListener(t,a,{capture:!0,passive:g}):i.addEventListener(t,a,!0):g!==void 0?i.addEventListener(t,a,{passive:g}):i.addEventListener(t,a,!1)}function mS(i,t,a,h,g){var v=h;if(!(t&1)&&!(t&2)&&h!==null)e:for(;;){if(h===null)return;var E=h.tag;if(E===3||E===4){var o=h.stateNode.containerInfo;if(o===g||o.nodeType===8&&o.parentNode===g)break;if(E===4)for(E=h.return;E!==null;){var O=E.tag;if((O===3||O===4)&&(O=E.stateNode.containerInfo,O===g||O.nodeType===8&&O.parentNode===g))return;E=E.return}for(;o!==null;){if(E=nf(o),E===null)return;if(O=E.tag,O===5||O===6){h=v=E;continue e}o=o.parentNode}}h=h.return}RD(function(){var F=v,$=R2(a),Q=[];e:{var te=sL.get(i);if(te!==void 0){var J=z2,we=i;switch(i){case"keypress":if(s1(a)===0)break e;case"keydown":case"keyup":J=SV;break;case"focusin":we="focus",J=lS;break;case"focusout":we="blur",J=lS;break;case"beforeblur":case"afterblur":J=lS;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=uk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=dV;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=AV;break;case tL:case rL:case iL:J=mV;break;case nL:J=PV;break;case"scroll":J=uV;break;case"wheel":J=kV;break;case"copy":case"cut":case"paste":J=_V;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=dk}var se=(t&4)!==0,me=!se&&i==="scroll",fe=se?te!==null?te+"Capture":null:te;se=[];for(var re=F,de;re!==null;){de=re;var Oe=de.stateNode;if(de.tag===5&&Oe!==null&&(de=Oe,fe!==null&&(Oe=qy(re,fe),Oe!=null&&se.push(Qy(re,Oe,de)))),me)break;re=re.return}0<se.length&&(te=new J(te,we,null,a,$),Q.push({event:te,listeners:se}))}}if(!(t&7)){e:{if(te=i==="mouseover"||i==="pointerover",J=i==="mouseout"||i==="pointerout",te&&a!==nE&&(we=a.relatedTarget||a.fromElement)&&(nf(we)||we[du]))break e;if((J||te)&&(te=$.window===$?$:(te=$.ownerDocument)?te.defaultView||te.parentWindow:window,J?(we=a.relatedTarget||a.toElement,J=F,we=we?nf(we):null,we!==null&&(me=Ef(we),we!==me||we.tag!==5&&we.tag!==6)&&(we=null)):(J=null,we=F),J!==we)){if(se=uk,Oe="onMouseLeave",fe="onMouseEnter",re="mouse",(i==="pointerout"||i==="pointerover")&&(se=dk,Oe="onPointerLeave",fe="onPointerEnter",re="pointer"),me=J==null?te:pm(J),de=we==null?te:pm(we),te=new se(Oe,re+"leave",J,a,$),te.target=me,te.relatedTarget=de,Oe=null,nf($)===F&&(se=new se(fe,re+"enter",we,a,$),se.target=de,se.relatedTarget=me,Oe=se),me=Oe,J&&we)t:{for(se=J,fe=we,re=0,de=se;de;de=Qp(de))re++;for(de=0,Oe=fe;Oe;Oe=Qp(Oe))de++;for(;0<re-de;)se=Qp(se),re--;for(;0<de-re;)fe=Qp(fe),de--;for(;re--;){if(se===fe||fe!==null&&se===fe.alternate)break t;se=Qp(se),fe=Qp(fe)}se=null}else se=null;J!==null&&Tk(Q,te,J,se,!1),we!==null&&me!==null&&Tk(Q,me,we,se,!0)}}e:{if(te=F?pm(F):window,J=te.nodeName&&te.nodeName.toLowerCase(),J==="select"||J==="input"&&te.type==="file")var Xe=BV;else if(mk(te))if(KD)Xe=UV;else{Xe=jV;var qe=NV}else(J=te.nodeName)&&J.toLowerCase()==="input"&&(te.type==="checkbox"||te.type==="radio")&&(Xe=VV);if(Xe&&(Xe=Xe(i,F))){XD(Q,Xe,a,$);break e}qe&&qe(i,te,F),i==="focusout"&&(qe=te._wrapperState)&&qe.controlled&&te.type==="number"&&QS(te,"number",te.value)}switch(qe=F?pm(F):window,i){case"focusin":(mk(qe)||qe.contentEditable==="true")&&(dm=qe,hE=F,Oy=null);break;case"focusout":Oy=hE=dm=null;break;case"mousedown":dE=!0;break;case"contextmenu":case"mouseup":case"dragend":dE=!1,xk(Q,a,$);break;case"selectionchange":if(HV)break;case"keydown":case"keyup":xk(Q,a,$)}var Be;if(B2)e:{switch(i){case"compositionstart":var bt="onCompositionStart";break e;case"compositionend":bt="onCompositionEnd";break e;case"compositionupdate":bt="onCompositionUpdate";break e}bt=void 0}else hm?WD(i,a)&&(bt="onCompositionEnd"):i==="keydown"&&a.keyCode===229&&(bt="onCompositionStart");bt&&(qD&&a.locale!=="ko"&&(hm||bt!=="onCompositionStart"?bt==="onCompositionEnd"&&hm&&(Be=HD()):(Ih=$,L2="value"in Ih?Ih.value:Ih.textContent,hm=!0)),qe=P1(F,bt),0<qe.length&&(bt=new hk(bt,i,null,a,$),Q.push({event:bt,listeners:qe}),Be?bt.data=Be:(Be=ZD(a),Be!==null&&(bt.data=Be)))),(Be=OV?DV(i,a):LV(i,a))&&(F=P1(F,"onBeforeInput"),0<F.length&&($=new hk("onBeforeInput","beforeinput",null,a,$),Q.push({event:$,listeners:F}),$.data=Be))}oL(Q,t)})}function Qy(i,t,a){return{instance:i,listener:t,currentTarget:a}}function P1(i,t){for(var a=t+"Capture",h=[];i!==null;){var g=i,v=g.stateNode;g.tag===5&&v!==null&&(g=v,v=qy(i,a),v!=null&&h.unshift(Qy(i,v,g)),v=qy(i,t),v!=null&&h.push(Qy(i,v,g))),i=i.return}return h}function Qp(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Tk(i,t,a,h,g){for(var v=t._reactName,E=[];a!==null&&a!==h;){var o=a,O=o.alternate,F=o.stateNode;if(O!==null&&O===h)break;o.tag===5&&F!==null&&(o=F,g?(O=qy(a,v),O!=null&&E.unshift(Qy(a,O,o))):g||(O=qy(a,v),O!=null&&E.push(Qy(a,O,o)))),a=a.return}E.length!==0&&i.push({event:t,listeners:E})}var XV=/\r\n?/g,KV=/\u0000|\uFFFD/g;function Sk(i){return(typeof i=="string"?i:""+i).replace(XV,`
`).replace(KV,"")}function Mx(i,t,a){if(t=Sk(t),Sk(i)!==t&&a)throw Error(sr(425))}function R1(){}var fE=null,pE=null;function mE(i,t){return i==="textarea"||i==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var gE=typeof setTimeout=="function"?setTimeout:void 0,YV=typeof clearTimeout=="function"?clearTimeout:void 0,Ek=typeof Promise=="function"?Promise:void 0,JV=typeof queueMicrotask=="function"?queueMicrotask:typeof Ek<"u"?function(i){return Ek.resolve(null).then(i).catch(QV)}:gE;function QV(i){setTimeout(function(){throw i})}function gS(i,t){var a=t,h=0;do{var g=a.nextSibling;if(i.removeChild(a),g&&g.nodeType===8)if(a=g.data,a==="/$"){if(h===0){i.removeChild(g),Xy(t);return}h--}else a!=="$"&&a!=="$?"&&a!=="$!"||h++;a=g}while(a);Xy(t)}function Oh(i){for(;i!=null;i=i.nextSibling){var t=i.nodeType;if(t===1||t===3)break;if(t===8){if(t=i.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return i}function Ik(i){i=i.previousSibling;for(var t=0;i;){if(i.nodeType===8){var a=i.data;if(a==="$"||a==="$!"||a==="$?"){if(t===0)return i;t--}else a==="/$"&&t++}i=i.previousSibling}return null}var tg=Math.random().toString(36).slice(2),wc="__reactFiber$"+tg,e0="__reactProps$"+tg,du="__reactContainer$"+tg,_E="__reactEvents$"+tg,eU="__reactListeners$"+tg,tU="__reactHandles$"+tg;function nf(i){var t=i[wc];if(t)return t;for(var a=i.parentNode;a;){if(t=a[du]||a[wc]){if(a=t.alternate,t.child!==null||a!==null&&a.child!==null)for(i=Ik(i);i!==null;){if(a=i[wc])return a;i=Ik(i)}return t}i=a,a=i.parentNode}return null}function b0(i){return i=i[wc]||i[du],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function pm(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(sr(33))}function xw(i){return i[e0]||null}var yE=[],mm=-1;function Zh(i){return{current:i}}function Yn(i){0>mm||(i.current=yE[mm],yE[mm]=null,mm--)}function Hn(i,t){mm++,yE[mm]=i.current,i.current=t}var jh={},Oo=Zh(jh),Sa=Zh(!1),_f=jh;function jm(i,t){var a=i.type.contextTypes;if(!a)return jh;var h=i.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===t)return h.__reactInternalMemoizedMaskedChildContext;var g={},v;for(v in a)g[v]=t[v];return h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=t,i.__reactInternalMemoizedMaskedChildContext=g),g}function Ea(i){return i=i.childContextTypes,i!=null}function k1(){Yn(Sa),Yn(Oo)}function Ak(i,t,a){if(Oo.current!==jh)throw Error(sr(168));Hn(Oo,t),Hn(Sa,a)}function lL(i,t,a){var h=i.stateNode;if(t=t.childContextTypes,typeof h.getChildContext!="function")return a;h=h.getChildContext();for(var g in h)if(!(g in t))throw Error(sr(108,Nj(i)||"Unknown",g));return ps({},a,h)}function M1(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||jh,_f=Oo.current,Hn(Oo,i),Hn(Sa,Sa.current),!0}function Ck(i,t,a){var h=i.stateNode;if(!h)throw Error(sr(169));a?(i=lL(i,t,_f),h.__reactInternalMemoizedMergedChildContext=i,Yn(Sa),Yn(Oo),Hn(Oo,i)):Yn(Sa),Hn(Sa,a)}var su=null,ww=!1,_S=!1;function cL(i){su===null?su=[i]:su.push(i)}function rU(i){ww=!0,cL(i)}function Xh(){if(!_S&&su!==null){_S=!0;var i=0,t=zn;try{var a=su;for(zn=1;i<a.length;i++){var h=a[i];do h=h(!0);while(h!==null)}su=null,ww=!1}catch(g){throw su!==null&&(su=su.slice(i+1)),DD(k2,Xh),g}finally{zn=t,_S=!1}}return null}var gm=[],_m=0,O1=null,D1=0,ol=[],al=0,yf=null,lu=1,cu="";function Jd(i,t){gm[_m++]=D1,gm[_m++]=O1,O1=i,D1=t}function uL(i,t,a){ol[al++]=lu,ol[al++]=cu,ol[al++]=yf,yf=i;var h=lu;i=cu;var g=32-Hl(h)-1;h&=~(1<<g),a+=1;var v=32-Hl(t)+g;if(30<v){var E=g-g%5;v=(h&(1<<E)-1).toString(32),h>>=E,g-=E,lu=1<<32-Hl(t)+g|a<<g|h,cu=v+i}else lu=1<<v|a<<g|h,cu=i}function j2(i){i.return!==null&&(Jd(i,1),uL(i,1,0))}function V2(i){for(;i===O1;)O1=gm[--_m],gm[_m]=null,D1=gm[--_m],gm[_m]=null;for(;i===yf;)yf=ol[--al],ol[al]=null,cu=ol[--al],ol[al]=null,lu=ol[--al],ol[al]=null}var Ha=null,$a=null,is=!1,Ul=null;function hL(i,t){var a=ll(5,null,null,0);a.elementType="DELETED",a.stateNode=t,a.return=i,t=i.deletions,t===null?(i.deletions=[a],i.flags|=16):t.push(a)}function Pk(i,t){switch(i.tag){case 5:var a=i.type;return t=t.nodeType!==1||a.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(i.stateNode=t,Ha=i,$a=Oh(t.firstChild),!0):!1;case 6:return t=i.pendingProps===""||t.nodeType!==3?null:t,t!==null?(i.stateNode=t,Ha=i,$a=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(a=yf!==null?{id:lu,overflow:cu}:null,i.memoizedState={dehydrated:t,treeContext:a,retryLane:1073741824},a=ll(18,null,null,0),a.stateNode=t,a.return=i,i.child=a,Ha=i,$a=null,!0):!1;default:return!1}}function vE(i){return(i.mode&1)!==0&&(i.flags&128)===0}function xE(i){if(is){var t=$a;if(t){var a=t;if(!Pk(i,t)){if(vE(i))throw Error(sr(418));t=Oh(a.nextSibling);var h=Ha;t&&Pk(i,t)?hL(h,a):(i.flags=i.flags&-4097|2,is=!1,Ha=i)}}else{if(vE(i))throw Error(sr(418));i.flags=i.flags&-4097|2,is=!1,Ha=i}}}function Rk(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Ha=i}function Ox(i){if(i!==Ha)return!1;if(!is)return Rk(i),is=!0,!1;var t;if((t=i.tag!==3)&&!(t=i.tag!==5)&&(t=i.type,t=t!=="head"&&t!=="body"&&!mE(i.type,i.memoizedProps)),t&&(t=$a)){if(vE(i))throw dL(),Error(sr(418));for(;t;)hL(i,t),t=Oh(t.nextSibling)}if(Rk(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(sr(317));e:{for(i=i.nextSibling,t=0;i;){if(i.nodeType===8){var a=i.data;if(a==="/$"){if(t===0){$a=Oh(i.nextSibling);break e}t--}else a!=="$"&&a!=="$!"&&a!=="$?"||t++}i=i.nextSibling}$a=null}}else $a=Ha?Oh(i.stateNode.nextSibling):null;return!0}function dL(){for(var i=$a;i;)i=Oh(i.nextSibling)}function Vm(){$a=Ha=null,is=!1}function U2(i){Ul===null?Ul=[i]:Ul.push(i)}var iU=yu.ReactCurrentBatchConfig;function gy(i,t,a){if(i=a.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(sr(309));var h=a.stateNode}if(!h)throw Error(sr(147,i));var g=h,v=""+i;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===v?t.ref:(t=function(E){var o=g.refs;E===null?delete o[v]:o[v]=E},t._stringRef=v,t)}if(typeof i!="string")throw Error(sr(284));if(!a._owner)throw Error(sr(290,i))}return i}function Dx(i,t){throw i=Object.prototype.toString.call(t),Error(sr(31,i==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":i))}function kk(i){var t=i._init;return t(i._payload)}function fL(i){function t(fe,re){if(i){var de=fe.deletions;de===null?(fe.deletions=[re],fe.flags|=16):de.push(re)}}function a(fe,re){if(!i)return null;for(;re!==null;)t(fe,re),re=re.sibling;return null}function h(fe,re){for(fe=new Map;re!==null;)re.key!==null?fe.set(re.key,re):fe.set(re.index,re),re=re.sibling;return fe}function g(fe,re){return fe=Fh(fe,re),fe.index=0,fe.sibling=null,fe}function v(fe,re,de){return fe.index=de,i?(de=fe.alternate,de!==null?(de=de.index,de<re?(fe.flags|=2,re):de):(fe.flags|=2,re)):(fe.flags|=1048576,re)}function E(fe){return i&&fe.alternate===null&&(fe.flags|=2),fe}function o(fe,re,de,Oe){return re===null||re.tag!==6?(re=SS(de,fe.mode,Oe),re.return=fe,re):(re=g(re,de),re.return=fe,re)}function O(fe,re,de,Oe){var Xe=de.type;return Xe===um?$(fe,re,de.props.children,Oe,de.key):re!==null&&(re.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===mh&&kk(Xe)===re.type)?(Oe=g(re,de.props),Oe.ref=gy(fe,re,de),Oe.return=fe,Oe):(Oe=d1(de.type,de.key,de.props,null,fe.mode,Oe),Oe.ref=gy(fe,re,de),Oe.return=fe,Oe)}function F(fe,re,de,Oe){return re===null||re.tag!==4||re.stateNode.containerInfo!==de.containerInfo||re.stateNode.implementation!==de.implementation?(re=ES(de,fe.mode,Oe),re.return=fe,re):(re=g(re,de.children||[]),re.return=fe,re)}function $(fe,re,de,Oe,Xe){return re===null||re.tag!==7?(re=gf(de,fe.mode,Oe,Xe),re.return=fe,re):(re=g(re,de),re.return=fe,re)}function Q(fe,re,de){if(typeof re=="string"&&re!==""||typeof re=="number")return re=SS(""+re,fe.mode,de),re.return=fe,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case Tx:return de=d1(re.type,re.key,re.props,null,fe.mode,de),de.ref=gy(fe,null,re),de.return=fe,de;case cm:return re=ES(re,fe.mode,de),re.return=fe,re;case mh:var Oe=re._init;return Q(fe,Oe(re._payload),de)}if(Sy(re)||hy(re))return re=gf(re,fe.mode,de,null),re.return=fe,re;Dx(fe,re)}return null}function te(fe,re,de,Oe){var Xe=re!==null?re.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Xe!==null?null:o(fe,re,""+de,Oe);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case Tx:return de.key===Xe?O(fe,re,de,Oe):null;case cm:return de.key===Xe?F(fe,re,de,Oe):null;case mh:return Xe=de._init,te(fe,re,Xe(de._payload),Oe)}if(Sy(de)||hy(de))return Xe!==null?null:$(fe,re,de,Oe,null);Dx(fe,de)}return null}function J(fe,re,de,Oe,Xe){if(typeof Oe=="string"&&Oe!==""||typeof Oe=="number")return fe=fe.get(de)||null,o(re,fe,""+Oe,Xe);if(typeof Oe=="object"&&Oe!==null){switch(Oe.$$typeof){case Tx:return fe=fe.get(Oe.key===null?de:Oe.key)||null,O(re,fe,Oe,Xe);case cm:return fe=fe.get(Oe.key===null?de:Oe.key)||null,F(re,fe,Oe,Xe);case mh:var qe=Oe._init;return J(fe,re,de,qe(Oe._payload),Xe)}if(Sy(Oe)||hy(Oe))return fe=fe.get(de)||null,$(re,fe,Oe,Xe,null);Dx(re,Oe)}return null}function we(fe,re,de,Oe){for(var Xe=null,qe=null,Be=re,bt=re=0,Bt=null;Be!==null&&bt<de.length;bt++){Be.index>bt?(Bt=Be,Be=null):Bt=Be.sibling;var Jt=te(fe,Be,de[bt],Oe);if(Jt===null){Be===null&&(Be=Bt);break}i&&Be&&Jt.alternate===null&&t(fe,Be),re=v(Jt,re,bt),qe===null?Xe=Jt:qe.sibling=Jt,qe=Jt,Be=Bt}if(bt===de.length)return a(fe,Be),is&&Jd(fe,bt),Xe;if(Be===null){for(;bt<de.length;bt++)Be=Q(fe,de[bt],Oe),Be!==null&&(re=v(Be,re,bt),qe===null?Xe=Be:qe.sibling=Be,qe=Be);return is&&Jd(fe,bt),Xe}for(Be=h(fe,Be);bt<de.length;bt++)Bt=J(Be,fe,bt,de[bt],Oe),Bt!==null&&(i&&Bt.alternate!==null&&Be.delete(Bt.key===null?bt:Bt.key),re=v(Bt,re,bt),qe===null?Xe=Bt:qe.sibling=Bt,qe=Bt);return i&&Be.forEach(function(nr){return t(fe,nr)}),is&&Jd(fe,bt),Xe}function se(fe,re,de,Oe){var Xe=hy(de);if(typeof Xe!="function")throw Error(sr(150));if(de=Xe.call(de),de==null)throw Error(sr(151));for(var qe=Xe=null,Be=re,bt=re=0,Bt=null,Jt=de.next();Be!==null&&!Jt.done;bt++,Jt=de.next()){Be.index>bt?(Bt=Be,Be=null):Bt=Be.sibling;var nr=te(fe,Be,Jt.value,Oe);if(nr===null){Be===null&&(Be=Bt);break}i&&Be&&nr.alternate===null&&t(fe,Be),re=v(nr,re,bt),qe===null?Xe=nr:qe.sibling=nr,qe=nr,Be=Bt}if(Jt.done)return a(fe,Be),is&&Jd(fe,bt),Xe;if(Be===null){for(;!Jt.done;bt++,Jt=de.next())Jt=Q(fe,Jt.value,Oe),Jt!==null&&(re=v(Jt,re,bt),qe===null?Xe=Jt:qe.sibling=Jt,qe=Jt);return is&&Jd(fe,bt),Xe}for(Be=h(fe,Be);!Jt.done;bt++,Jt=de.next())Jt=J(Be,fe,bt,Jt.value,Oe),Jt!==null&&(i&&Jt.alternate!==null&&Be.delete(Jt.key===null?bt:Jt.key),re=v(Jt,re,bt),qe===null?Xe=Jt:qe.sibling=Jt,qe=Jt);return i&&Be.forEach(function(Gt){return t(fe,Gt)}),is&&Jd(fe,bt),Xe}function me(fe,re,de,Oe){if(typeof de=="object"&&de!==null&&de.type===um&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case Tx:e:{for(var Xe=de.key,qe=re;qe!==null;){if(qe.key===Xe){if(Xe=de.type,Xe===um){if(qe.tag===7){a(fe,qe.sibling),re=g(qe,de.props.children),re.return=fe,fe=re;break e}}else if(qe.elementType===Xe||typeof Xe=="object"&&Xe!==null&&Xe.$$typeof===mh&&kk(Xe)===qe.type){a(fe,qe.sibling),re=g(qe,de.props),re.ref=gy(fe,qe,de),re.return=fe,fe=re;break e}a(fe,qe);break}else t(fe,qe);qe=qe.sibling}de.type===um?(re=gf(de.props.children,fe.mode,Oe,de.key),re.return=fe,fe=re):(Oe=d1(de.type,de.key,de.props,null,fe.mode,Oe),Oe.ref=gy(fe,re,de),Oe.return=fe,fe=Oe)}return E(fe);case cm:e:{for(qe=de.key;re!==null;){if(re.key===qe)if(re.tag===4&&re.stateNode.containerInfo===de.containerInfo&&re.stateNode.implementation===de.implementation){a(fe,re.sibling),re=g(re,de.children||[]),re.return=fe,fe=re;break e}else{a(fe,re);break}else t(fe,re);re=re.sibling}re=ES(de,fe.mode,Oe),re.return=fe,fe=re}return E(fe);case mh:return qe=de._init,me(fe,re,qe(de._payload),Oe)}if(Sy(de))return we(fe,re,de,Oe);if(hy(de))return se(fe,re,de,Oe);Dx(fe,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,re!==null&&re.tag===6?(a(fe,re.sibling),re=g(re,de),re.return=fe,fe=re):(a(fe,re),re=SS(de,fe.mode,Oe),re.return=fe,fe=re),E(fe)):a(fe,re)}return me}var Um=fL(!0),pL=fL(!1),L1=Zh(null),z1=null,ym=null,$2=null;function G2(){$2=ym=z1=null}function H2(i){var t=L1.current;Yn(L1),i._currentValue=t}function wE(i,t,a){for(;i!==null;){var h=i.alternate;if((i.childLanes&t)!==t?(i.childLanes|=t,h!==null&&(h.childLanes|=t)):h!==null&&(h.childLanes&t)!==t&&(h.childLanes|=t),i===a)break;i=i.return}}function Em(i,t){z1=i,$2=ym=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&t&&(Ta=!0),i.firstContext=null)}function ul(i){var t=i._currentValue;if($2!==i)if(i={context:i,memoizedValue:t,next:null},ym===null){if(z1===null)throw Error(sr(308));ym=i,z1.dependencies={lanes:0,firstContext:i}}else ym=ym.next=i;return t}var sf=null;function q2(i){sf===null?sf=[i]:sf.push(i)}function mL(i,t,a,h){var g=t.interleaved;return g===null?(a.next=a,q2(t)):(a.next=g.next,g.next=a),t.interleaved=a,fu(i,h)}function fu(i,t){i.lanes|=t;var a=i.alternate;for(a!==null&&(a.lanes|=t),a=i,i=i.return;i!==null;)i.childLanes|=t,a=i.alternate,a!==null&&(a.childLanes|=t),a=i,i=i.return;return a.tag===3?a.stateNode:null}var gh=!1;function W2(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gL(i,t){i=i.updateQueue,t.updateQueue===i&&(t.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function uu(i,t){return{eventTime:i,lane:t,tag:0,payload:null,callback:null,next:null}}function Dh(i,t,a){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,yn&2){var g=h.pending;return g===null?t.next=t:(t.next=g.next,g.next=t),h.pending=t,fu(i,a)}return g=h.interleaved,g===null?(t.next=t,q2(h)):(t.next=g.next,g.next=t),h.interleaved=t,fu(i,a)}function o1(i,t,a){if(t=t.updateQueue,t!==null&&(t=t.shared,(a&4194240)!==0)){var h=t.lanes;h&=i.pendingLanes,a|=h,t.lanes=a,M2(i,a)}}function Mk(i,t){var a=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,a===h)){var g=null,v=null;if(a=a.firstBaseUpdate,a!==null){do{var E={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};v===null?g=v=E:v=v.next=E,a=a.next}while(a!==null);v===null?g=v=t:v=v.next=t}else g=v=t;a={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:v,shared:h.shared,effects:h.effects},i.updateQueue=a;return}i=a.lastBaseUpdate,i===null?a.firstBaseUpdate=t:i.next=t,a.lastBaseUpdate=t}function F1(i,t,a,h){var g=i.updateQueue;gh=!1;var v=g.firstBaseUpdate,E=g.lastBaseUpdate,o=g.shared.pending;if(o!==null){g.shared.pending=null;var O=o,F=O.next;O.next=null,E===null?v=F:E.next=F,E=O;var $=i.alternate;$!==null&&($=$.updateQueue,o=$.lastBaseUpdate,o!==E&&(o===null?$.firstBaseUpdate=F:o.next=F,$.lastBaseUpdate=O))}if(v!==null){var Q=g.baseState;E=0,$=F=O=null,o=v;do{var te=o.lane,J=o.eventTime;if((h&te)===te){$!==null&&($=$.next={eventTime:J,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var we=i,se=o;switch(te=t,J=a,se.tag){case 1:if(we=se.payload,typeof we=="function"){Q=we.call(J,Q,te);break e}Q=we;break e;case 3:we.flags=we.flags&-65537|128;case 0:if(we=se.payload,te=typeof we=="function"?we.call(J,Q,te):we,te==null)break e;Q=ps({},Q,te);break e;case 2:gh=!0}}o.callback!==null&&o.lane!==0&&(i.flags|=64,te=g.effects,te===null?g.effects=[o]:te.push(o))}else J={eventTime:J,lane:te,tag:o.tag,payload:o.payload,callback:o.callback,next:null},$===null?(F=$=J,O=Q):$=$.next=J,E|=te;if(o=o.next,o===null){if(o=g.shared.pending,o===null)break;te=o,o=te.next,te.next=null,g.lastBaseUpdate=te,g.shared.pending=null}}while(!0);if($===null&&(O=Q),g.baseState=O,g.firstBaseUpdate=F,g.lastBaseUpdate=$,t=g.shared.interleaved,t!==null){g=t;do E|=g.lane,g=g.next;while(g!==t)}else v===null&&(g.shared.lanes=0);xf|=E,i.lanes=E,i.memoizedState=Q}}function Ok(i,t,a){if(i=t.effects,t.effects=null,i!==null)for(t=0;t<i.length;t++){var h=i[t],g=h.callback;if(g!==null){if(h.callback=null,h=a,typeof g!="function")throw Error(sr(191,g));g.call(h)}}}var T0={},Ec=Zh(T0),t0=Zh(T0),r0=Zh(T0);function of(i){if(i===T0)throw Error(sr(174));return i}function Z2(i,t){switch(Hn(r0,t),Hn(t0,i),Hn(Ec,T0),i=t.nodeType,i){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:tE(null,"");break;default:i=i===8?t.parentNode:t,t=i.namespaceURI||null,i=i.tagName,t=tE(t,i)}Yn(Ec),Hn(Ec,t)}function $m(){Yn(Ec),Yn(t0),Yn(r0)}function _L(i){of(r0.current);var t=of(Ec.current),a=tE(t,i.type);t!==a&&(Hn(t0,i),Hn(Ec,a))}function X2(i){t0.current===i&&(Yn(Ec),Yn(t0))}var ds=Zh(0);function B1(i){for(var t=i;t!==null;){if(t.tag===13){var a=t.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yS=[];function K2(){for(var i=0;i<yS.length;i++)yS[i]._workInProgressVersionPrimary=null;yS.length=0}var a1=yu.ReactCurrentDispatcher,vS=yu.ReactCurrentBatchConfig,vf=0,fs=null,Xs=null,oo=null,N1=!1,Dy=!1,i0=0,nU=0;function Co(){throw Error(sr(321))}function Y2(i,t){if(t===null)return!1;for(var a=0;a<t.length&&a<i.length;a++)if(!Wl(i[a],t[a]))return!1;return!0}function J2(i,t,a,h,g,v){if(vf=v,fs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,a1.current=i===null||i.memoizedState===null?lU:cU,i=a(h,g),Dy){v=0;do{if(Dy=!1,i0=0,25<=v)throw Error(sr(301));v+=1,oo=Xs=null,t.updateQueue=null,a1.current=uU,i=a(h,g)}while(Dy)}if(a1.current=j1,t=Xs!==null&&Xs.next!==null,vf=0,oo=Xs=fs=null,N1=!1,t)throw Error(sr(300));return i}function Q2(){var i=i0!==0;return i0=0,i}function _c(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return oo===null?fs.memoizedState=oo=i:oo=oo.next=i,oo}function hl(){if(Xs===null){var i=fs.alternate;i=i!==null?i.memoizedState:null}else i=Xs.next;var t=oo===null?fs.memoizedState:oo.next;if(t!==null)oo=t,Xs=i;else{if(i===null)throw Error(sr(310));Xs=i,i={memoizedState:Xs.memoizedState,baseState:Xs.baseState,baseQueue:Xs.baseQueue,queue:Xs.queue,next:null},oo===null?fs.memoizedState=oo=i:oo=oo.next=i}return oo}function n0(i,t){return typeof t=="function"?t(i):t}function xS(i){var t=hl(),a=t.queue;if(a===null)throw Error(sr(311));a.lastRenderedReducer=i;var h=Xs,g=h.baseQueue,v=a.pending;if(v!==null){if(g!==null){var E=g.next;g.next=v.next,v.next=E}h.baseQueue=g=v,a.pending=null}if(g!==null){v=g.next,h=h.baseState;var o=E=null,O=null,F=v;do{var $=F.lane;if((vf&$)===$)O!==null&&(O=O.next={lane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),h=F.hasEagerState?F.eagerState:i(h,F.action);else{var Q={lane:$,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null};O===null?(o=O=Q,E=h):O=O.next=Q,fs.lanes|=$,xf|=$}F=F.next}while(F!==null&&F!==v);O===null?E=h:O.next=o,Wl(h,t.memoizedState)||(Ta=!0),t.memoizedState=h,t.baseState=E,t.baseQueue=O,a.lastRenderedState=h}if(i=a.interleaved,i!==null){g=i;do v=g.lane,fs.lanes|=v,xf|=v,g=g.next;while(g!==i)}else g===null&&(a.lanes=0);return[t.memoizedState,a.dispatch]}function wS(i){var t=hl(),a=t.queue;if(a===null)throw Error(sr(311));a.lastRenderedReducer=i;var h=a.dispatch,g=a.pending,v=t.memoizedState;if(g!==null){a.pending=null;var E=g=g.next;do v=i(v,E.action),E=E.next;while(E!==g);Wl(v,t.memoizedState)||(Ta=!0),t.memoizedState=v,t.baseQueue===null&&(t.baseState=v),a.lastRenderedState=v}return[v,h]}function yL(){}function vL(i,t){var a=fs,h=hl(),g=t(),v=!Wl(h.memoizedState,g);if(v&&(h.memoizedState=g,Ta=!0),h=h.queue,eI(bL.bind(null,a,h,i),[i]),h.getSnapshot!==t||v||oo!==null&&oo.memoizedState.tag&1){if(a.flags|=2048,s0(9,wL.bind(null,a,h,g,t),void 0,null),ao===null)throw Error(sr(349));vf&30||xL(a,t,g)}return g}function xL(i,t,a){i.flags|=16384,i={getSnapshot:t,value:a},t=fs.updateQueue,t===null?(t={lastEffect:null,stores:null},fs.updateQueue=t,t.stores=[i]):(a=t.stores,a===null?t.stores=[i]:a.push(i))}function wL(i,t,a,h){t.value=a,t.getSnapshot=h,TL(t)&&SL(i)}function bL(i,t,a){return a(function(){TL(t)&&SL(i)})}function TL(i){var t=i.getSnapshot;i=i.value;try{var a=t();return!Wl(i,a)}catch{return!0}}function SL(i){var t=fu(i,1);t!==null&&ql(t,i,1,-1)}function Dk(i){var t=_c();return typeof i=="function"&&(i=i()),t.memoizedState=t.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n0,lastRenderedState:i},t.queue=i,i=i.dispatch=aU.bind(null,fs,i),[t.memoizedState,i]}function s0(i,t,a,h){return i={tag:i,create:t,destroy:a,deps:h,next:null},t=fs.updateQueue,t===null?(t={lastEffect:null,stores:null},fs.updateQueue=t,t.lastEffect=i.next=i):(a=t.lastEffect,a===null?t.lastEffect=i.next=i:(h=a.next,a.next=i,i.next=h,t.lastEffect=i)),i}function EL(){return hl().memoizedState}function l1(i,t,a,h){var g=_c();fs.flags|=i,g.memoizedState=s0(1|t,a,void 0,h===void 0?null:h)}function bw(i,t,a,h){var g=hl();h=h===void 0?null:h;var v=void 0;if(Xs!==null){var E=Xs.memoizedState;if(v=E.destroy,h!==null&&Y2(h,E.deps)){g.memoizedState=s0(t,a,v,h);return}}fs.flags|=i,g.memoizedState=s0(1|t,a,v,h)}function Lk(i,t){return l1(8390656,8,i,t)}function eI(i,t){return bw(2048,8,i,t)}function IL(i,t){return bw(4,2,i,t)}function AL(i,t){return bw(4,4,i,t)}function CL(i,t){if(typeof t=="function")return i=i(),t(i),function(){t(null)};if(t!=null)return i=i(),t.current=i,function(){t.current=null}}function PL(i,t,a){return a=a!=null?a.concat([i]):null,bw(4,4,CL.bind(null,t,i),a)}function tI(){}function RL(i,t){var a=hl();t=t===void 0?null:t;var h=a.memoizedState;return h!==null&&t!==null&&Y2(t,h[1])?h[0]:(a.memoizedState=[i,t],i)}function kL(i,t){var a=hl();t=t===void 0?null:t;var h=a.memoizedState;return h!==null&&t!==null&&Y2(t,h[1])?h[0]:(i=i(),a.memoizedState=[i,t],i)}function ML(i,t,a){return vf&21?(Wl(a,t)||(a=FD(),fs.lanes|=a,xf|=a,i.baseState=!0),t):(i.baseState&&(i.baseState=!1,Ta=!0),i.memoizedState=a)}function sU(i,t){var a=zn;zn=a!==0&&4>a?a:4,i(!0);var h=vS.transition;vS.transition={};try{i(!1),t()}finally{zn=a,vS.transition=h}}function OL(){return hl().memoizedState}function oU(i,t,a){var h=zh(i);if(a={lane:h,action:a,hasEagerState:!1,eagerState:null,next:null},DL(i))LL(t,a);else if(a=mL(i,t,a,h),a!==null){var g=ia();ql(a,i,h,g),zL(a,t,h)}}function aU(i,t,a){var h=zh(i),g={lane:h,action:a,hasEagerState:!1,eagerState:null,next:null};if(DL(i))LL(t,g);else{var v=i.alternate;if(i.lanes===0&&(v===null||v.lanes===0)&&(v=t.lastRenderedReducer,v!==null))try{var E=t.lastRenderedState,o=v(E,a);if(g.hasEagerState=!0,g.eagerState=o,Wl(o,E)){var O=t.interleaved;O===null?(g.next=g,q2(t)):(g.next=O.next,O.next=g),t.interleaved=g;return}}catch{}finally{}a=mL(i,t,g,h),a!==null&&(g=ia(),ql(a,i,h,g),zL(a,t,h))}}function DL(i){var t=i.alternate;return i===fs||t!==null&&t===fs}function LL(i,t){Dy=N1=!0;var a=i.pending;a===null?t.next=t:(t.next=a.next,a.next=t),i.pending=t}function zL(i,t,a){if(a&4194240){var h=t.lanes;h&=i.pendingLanes,a|=h,t.lanes=a,M2(i,a)}}var j1={readContext:ul,useCallback:Co,useContext:Co,useEffect:Co,useImperativeHandle:Co,useInsertionEffect:Co,useLayoutEffect:Co,useMemo:Co,useReducer:Co,useRef:Co,useState:Co,useDebugValue:Co,useDeferredValue:Co,useTransition:Co,useMutableSource:Co,useSyncExternalStore:Co,useId:Co,unstable_isNewReconciler:!1},lU={readContext:ul,useCallback:function(i,t){return _c().memoizedState=[i,t===void 0?null:t],i},useContext:ul,useEffect:Lk,useImperativeHandle:function(i,t,a){return a=a!=null?a.concat([i]):null,l1(4194308,4,CL.bind(null,t,i),a)},useLayoutEffect:function(i,t){return l1(4194308,4,i,t)},useInsertionEffect:function(i,t){return l1(4,2,i,t)},useMemo:function(i,t){var a=_c();return t=t===void 0?null:t,i=i(),a.memoizedState=[i,t],i},useReducer:function(i,t,a){var h=_c();return t=a!==void 0?a(t):t,h.memoizedState=h.baseState=t,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:t},h.queue=i,i=i.dispatch=oU.bind(null,fs,i),[h.memoizedState,i]},useRef:function(i){var t=_c();return i={current:i},t.memoizedState=i},useState:Dk,useDebugValue:tI,useDeferredValue:function(i){return _c().memoizedState=i},useTransition:function(){var i=Dk(!1),t=i[0];return i=sU.bind(null,i[1]),_c().memoizedState=i,[t,i]},useMutableSource:function(){},useSyncExternalStore:function(i,t,a){var h=fs,g=_c();if(is){if(a===void 0)throw Error(sr(407));a=a()}else{if(a=t(),ao===null)throw Error(sr(349));vf&30||xL(h,t,a)}g.memoizedState=a;var v={value:a,getSnapshot:t};return g.queue=v,Lk(bL.bind(null,h,v,i),[i]),h.flags|=2048,s0(9,wL.bind(null,h,v,a,t),void 0,null),a},useId:function(){var i=_c(),t=ao.identifierPrefix;if(is){var a=cu,h=lu;a=(h&~(1<<32-Hl(h)-1)).toString(32)+a,t=":"+t+"R"+a,a=i0++,0<a&&(t+="H"+a.toString(32)),t+=":"}else a=nU++,t=":"+t+"r"+a.toString(32)+":";return i.memoizedState=t},unstable_isNewReconciler:!1},cU={readContext:ul,useCallback:RL,useContext:ul,useEffect:eI,useImperativeHandle:PL,useInsertionEffect:IL,useLayoutEffect:AL,useMemo:kL,useReducer:xS,useRef:EL,useState:function(){return xS(n0)},useDebugValue:tI,useDeferredValue:function(i){var t=hl();return ML(t,Xs.memoizedState,i)},useTransition:function(){var i=xS(n0)[0],t=hl().memoizedState;return[i,t]},useMutableSource:yL,useSyncExternalStore:vL,useId:OL,unstable_isNewReconciler:!1},uU={readContext:ul,useCallback:RL,useContext:ul,useEffect:eI,useImperativeHandle:PL,useInsertionEffect:IL,useLayoutEffect:AL,useMemo:kL,useReducer:wS,useRef:EL,useState:function(){return wS(n0)},useDebugValue:tI,useDeferredValue:function(i){var t=hl();return Xs===null?t.memoizedState=i:ML(t,Xs.memoizedState,i)},useTransition:function(){var i=wS(n0)[0],t=hl().memoizedState;return[i,t]},useMutableSource:yL,useSyncExternalStore:vL,useId:OL,unstable_isNewReconciler:!1};function Ll(i,t){if(i&&i.defaultProps){t=ps({},t),i=i.defaultProps;for(var a in i)t[a]===void 0&&(t[a]=i[a]);return t}return t}function bE(i,t,a,h){t=i.memoizedState,a=a(h,t),a=a==null?t:ps({},t,a),i.memoizedState=a,i.lanes===0&&(i.updateQueue.baseState=a)}var Tw={isMounted:function(i){return(i=i._reactInternals)?Ef(i)===i:!1},enqueueSetState:function(i,t,a){i=i._reactInternals;var h=ia(),g=zh(i),v=uu(h,g);v.payload=t,a!=null&&(v.callback=a),t=Dh(i,v,g),t!==null&&(ql(t,i,g,h),o1(t,i,g))},enqueueReplaceState:function(i,t,a){i=i._reactInternals;var h=ia(),g=zh(i),v=uu(h,g);v.tag=1,v.payload=t,a!=null&&(v.callback=a),t=Dh(i,v,g),t!==null&&(ql(t,i,g,h),o1(t,i,g))},enqueueForceUpdate:function(i,t){i=i._reactInternals;var a=ia(),h=zh(i),g=uu(a,h);g.tag=2,t!=null&&(g.callback=t),t=Dh(i,g,h),t!==null&&(ql(t,i,h,a),o1(t,i,h))}};function zk(i,t,a,h,g,v,E){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,v,E):t.prototype&&t.prototype.isPureReactComponent?!Yy(a,h)||!Yy(g,v):!0}function FL(i,t,a){var h=!1,g=jh,v=t.contextType;return typeof v=="object"&&v!==null?v=ul(v):(g=Ea(t)?_f:Oo.current,h=t.contextTypes,v=(h=h!=null)?jm(i,g):jh),t=new t(a,v),i.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Tw,i.stateNode=t,t._reactInternals=i,h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=g,i.__reactInternalMemoizedMaskedChildContext=v),t}function Fk(i,t,a,h){i=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(a,h),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(a,h),t.state!==i&&Tw.enqueueReplaceState(t,t.state,null)}function TE(i,t,a,h){var g=i.stateNode;g.props=a,g.state=i.memoizedState,g.refs={},W2(i);var v=t.contextType;typeof v=="object"&&v!==null?g.context=ul(v):(v=Ea(t)?_f:Oo.current,g.context=jm(i,v)),g.state=i.memoizedState,v=t.getDerivedStateFromProps,typeof v=="function"&&(bE(i,t,v,a),g.state=i.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(t=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),t!==g.state&&Tw.enqueueReplaceState(g,g.state,null),F1(i,a,g,h),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308)}function Gm(i,t){try{var a="",h=t;do a+=Bj(h),h=h.return;while(h);var g=a}catch(v){g=`
Error generating stack: `+v.message+`
`+v.stack}return{value:i,source:t,stack:g,digest:null}}function bS(i,t,a){return{value:i,source:null,stack:a??null,digest:t??null}}function SE(i,t){try{console.error(t.value)}catch(a){setTimeout(function(){throw a})}}var hU=typeof WeakMap=="function"?WeakMap:Map;function BL(i,t,a){a=uu(-1,a),a.tag=3,a.payload={element:null};var h=t.value;return a.callback=function(){U1||(U1=!0,DE=h),SE(i,t)},a}function NL(i,t,a){a=uu(-1,a),a.tag=3;var h=i.type.getDerivedStateFromError;if(typeof h=="function"){var g=t.value;a.payload=function(){return h(g)},a.callback=function(){SE(i,t)}}var v=i.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(a.callback=function(){SE(i,t),typeof h!="function"&&(Lh===null?Lh=new Set([this]):Lh.add(this));var E=t.stack;this.componentDidCatch(t.value,{componentStack:E!==null?E:""})}),a}function Bk(i,t,a){var h=i.pingCache;if(h===null){h=i.pingCache=new hU;var g=new Set;h.set(t,g)}else g=h.get(t),g===void 0&&(g=new Set,h.set(t,g));g.has(a)||(g.add(a),i=EU.bind(null,i,t,a),t.then(i,i))}function Nk(i){do{var t;if((t=i.tag===13)&&(t=i.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return i;i=i.return}while(i!==null);return null}function jk(i,t,a,h,g){return i.mode&1?(i.flags|=65536,i.lanes=g,i):(i===t?i.flags|=65536:(i.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(t=uu(-1,1),t.tag=2,Dh(a,t,1))),a.lanes|=1),i)}var dU=yu.ReactCurrentOwner,Ta=!1;function Qo(i,t,a,h){t.child=i===null?pL(t,null,a,h):Um(t,i.child,a,h)}function Vk(i,t,a,h,g){a=a.render;var v=t.ref;return Em(t,g),h=J2(i,t,a,h,v,g),a=Q2(),i!==null&&!Ta?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~g,pu(i,t,g)):(is&&a&&j2(t),t.flags|=1,Qo(i,t,h,g),t.child)}function Uk(i,t,a,h,g){if(i===null){var v=a.type;return typeof v=="function"&&!cI(v)&&v.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(t.tag=15,t.type=v,jL(i,t,v,h,g)):(i=d1(a.type,null,h,t,t.mode,g),i.ref=t.ref,i.return=t,t.child=i)}if(v=i.child,!(i.lanes&g)){var E=v.memoizedProps;if(a=a.compare,a=a!==null?a:Yy,a(E,h)&&i.ref===t.ref)return pu(i,t,g)}return t.flags|=1,i=Fh(v,h),i.ref=t.ref,i.return=t,t.child=i}function jL(i,t,a,h,g){if(i!==null){var v=i.memoizedProps;if(Yy(v,h)&&i.ref===t.ref)if(Ta=!1,t.pendingProps=h=v,(i.lanes&g)!==0)i.flags&131072&&(Ta=!0);else return t.lanes=i.lanes,pu(i,t,g)}return EE(i,t,a,h,g)}function VL(i,t,a){var h=t.pendingProps,g=h.children,v=i!==null?i.memoizedState:null;if(h.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Hn(xm,Ba),Ba|=a;else{if(!(a&1073741824))return i=v!==null?v.baseLanes|a:a,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:i,cachePool:null,transitions:null},t.updateQueue=null,Hn(xm,Ba),Ba|=i,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=v!==null?v.baseLanes:a,Hn(xm,Ba),Ba|=h}else v!==null?(h=v.baseLanes|a,t.memoizedState=null):h=a,Hn(xm,Ba),Ba|=h;return Qo(i,t,g,a),t.child}function UL(i,t){var a=t.ref;(i===null&&a!==null||i!==null&&i.ref!==a)&&(t.flags|=512,t.flags|=2097152)}function EE(i,t,a,h,g){var v=Ea(a)?_f:Oo.current;return v=jm(t,v),Em(t,g),a=J2(i,t,a,h,v,g),h=Q2(),i!==null&&!Ta?(t.updateQueue=i.updateQueue,t.flags&=-2053,i.lanes&=~g,pu(i,t,g)):(is&&h&&j2(t),t.flags|=1,Qo(i,t,a,g),t.child)}function $k(i,t,a,h,g){if(Ea(a)){var v=!0;M1(t)}else v=!1;if(Em(t,g),t.stateNode===null)c1(i,t),FL(t,a,h),TE(t,a,h,g),h=!0;else if(i===null){var E=t.stateNode,o=t.memoizedProps;E.props=o;var O=E.context,F=a.contextType;typeof F=="object"&&F!==null?F=ul(F):(F=Ea(a)?_f:Oo.current,F=jm(t,F));var $=a.getDerivedStateFromProps,Q=typeof $=="function"||typeof E.getSnapshotBeforeUpdate=="function";Q||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(o!==h||O!==F)&&Fk(t,E,h,F),gh=!1;var te=t.memoizedState;E.state=te,F1(t,h,E,g),O=t.memoizedState,o!==h||te!==O||Sa.current||gh?(typeof $=="function"&&(bE(t,a,$,h),O=t.memoizedState),(o=gh||zk(t,a,o,h,te,O,F))?(Q||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(t.flags|=4194308)):(typeof E.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=h,t.memoizedState=O),E.props=h,E.state=O,E.context=F,h=o):(typeof E.componentDidMount=="function"&&(t.flags|=4194308),h=!1)}else{E=t.stateNode,gL(i,t),o=t.memoizedProps,F=t.type===t.elementType?o:Ll(t.type,o),E.props=F,Q=t.pendingProps,te=E.context,O=a.contextType,typeof O=="object"&&O!==null?O=ul(O):(O=Ea(a)?_f:Oo.current,O=jm(t,O));var J=a.getDerivedStateFromProps;($=typeof J=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(o!==Q||te!==O)&&Fk(t,E,h,O),gh=!1,te=t.memoizedState,E.state=te,F1(t,h,E,g);var we=t.memoizedState;o!==Q||te!==we||Sa.current||gh?(typeof J=="function"&&(bE(t,a,J,h),we=t.memoizedState),(F=gh||zk(t,a,F,h,te,we,O)||!1)?($||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(h,we,O),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(h,we,O)),typeof E.componentDidUpdate=="function"&&(t.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof E.componentDidUpdate!="function"||o===i.memoizedProps&&te===i.memoizedState||(t.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&te===i.memoizedState||(t.flags|=1024),t.memoizedProps=h,t.memoizedState=we),E.props=h,E.state=we,E.context=O,h=F):(typeof E.componentDidUpdate!="function"||o===i.memoizedProps&&te===i.memoizedState||(t.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||o===i.memoizedProps&&te===i.memoizedState||(t.flags|=1024),h=!1)}return IE(i,t,a,h,v,g)}function IE(i,t,a,h,g,v){UL(i,t);var E=(t.flags&128)!==0;if(!h&&!E)return g&&Ck(t,a,!1),pu(i,t,v);h=t.stateNode,dU.current=t;var o=E&&typeof a.getDerivedStateFromError!="function"?null:h.render();return t.flags|=1,i!==null&&E?(t.child=Um(t,i.child,null,v),t.child=Um(t,null,o,v)):Qo(i,t,o,v),t.memoizedState=h.state,g&&Ck(t,a,!0),t.child}function $L(i){var t=i.stateNode;t.pendingContext?Ak(i,t.pendingContext,t.pendingContext!==t.context):t.context&&Ak(i,t.context,!1),Z2(i,t.containerInfo)}function Gk(i,t,a,h,g){return Vm(),U2(g),t.flags|=256,Qo(i,t,a,h),t.child}var AE={dehydrated:null,treeContext:null,retryLane:0};function CE(i){return{baseLanes:i,cachePool:null,transitions:null}}function GL(i,t,a){var h=t.pendingProps,g=ds.current,v=!1,E=(t.flags&128)!==0,o;if((o=E)||(o=i!==null&&i.memoizedState===null?!1:(g&2)!==0),o?(v=!0,t.flags&=-129):(i===null||i.memoizedState!==null)&&(g|=1),Hn(ds,g&1),i===null)return xE(t),i=t.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(t.mode&1?i.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(E=h.children,i=h.fallback,v?(h=t.mode,v=t.child,E={mode:"hidden",children:E},!(h&1)&&v!==null?(v.childLanes=0,v.pendingProps=E):v=Iw(E,h,0,null),i=gf(i,h,a,null),v.return=t,i.return=t,v.sibling=i,t.child=v,t.child.memoizedState=CE(a),t.memoizedState=AE,i):rI(t,E));if(g=i.memoizedState,g!==null&&(o=g.dehydrated,o!==null))return fU(i,t,E,h,o,g,a);if(v){v=h.fallback,E=t.mode,g=i.child,o=g.sibling;var O={mode:"hidden",children:h.children};return!(E&1)&&t.child!==g?(h=t.child,h.childLanes=0,h.pendingProps=O,t.deletions=null):(h=Fh(g,O),h.subtreeFlags=g.subtreeFlags&14680064),o!==null?v=Fh(o,v):(v=gf(v,E,a,null),v.flags|=2),v.return=t,h.return=t,h.sibling=v,t.child=h,h=v,v=t.child,E=i.child.memoizedState,E=E===null?CE(a):{baseLanes:E.baseLanes|a,cachePool:null,transitions:E.transitions},v.memoizedState=E,v.childLanes=i.childLanes&~a,t.memoizedState=AE,h}return v=i.child,i=v.sibling,h=Fh(v,{mode:"visible",children:h.children}),!(t.mode&1)&&(h.lanes=a),h.return=t,h.sibling=null,i!==null&&(a=t.deletions,a===null?(t.deletions=[i],t.flags|=16):a.push(i)),t.child=h,t.memoizedState=null,h}function rI(i,t){return t=Iw({mode:"visible",children:t},i.mode,0,null),t.return=i,i.child=t}function Lx(i,t,a,h){return h!==null&&U2(h),Um(t,i.child,null,a),i=rI(t,t.pendingProps.children),i.flags|=2,t.memoizedState=null,i}function fU(i,t,a,h,g,v,E){if(a)return t.flags&256?(t.flags&=-257,h=bS(Error(sr(422))),Lx(i,t,E,h)):t.memoizedState!==null?(t.child=i.child,t.flags|=128,null):(v=h.fallback,g=t.mode,h=Iw({mode:"visible",children:h.children},g,0,null),v=gf(v,g,E,null),v.flags|=2,h.return=t,v.return=t,h.sibling=v,t.child=h,t.mode&1&&Um(t,i.child,null,E),t.child.memoizedState=CE(E),t.memoizedState=AE,v);if(!(t.mode&1))return Lx(i,t,E,null);if(g.data==="$!"){if(h=g.nextSibling&&g.nextSibling.dataset,h)var o=h.dgst;return h=o,v=Error(sr(419)),h=bS(v,h,void 0),Lx(i,t,E,h)}if(o=(E&i.childLanes)!==0,Ta||o){if(h=ao,h!==null){switch(E&-E){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=g&(h.suspendedLanes|E)?0:g,g!==0&&g!==v.retryLane&&(v.retryLane=g,fu(i,g),ql(h,i,g,-1))}return lI(),h=bS(Error(sr(421))),Lx(i,t,E,h)}return g.data==="$?"?(t.flags|=128,t.child=i.child,t=IU.bind(null,i),g._reactRetry=t,null):(i=v.treeContext,$a=Oh(g.nextSibling),Ha=t,is=!0,Ul=null,i!==null&&(ol[al++]=lu,ol[al++]=cu,ol[al++]=yf,lu=i.id,cu=i.overflow,yf=t),t=rI(t,h.children),t.flags|=4096,t)}function Hk(i,t,a){i.lanes|=t;var h=i.alternate;h!==null&&(h.lanes|=t),wE(i.return,t,a)}function TS(i,t,a,h,g){var v=i.memoizedState;v===null?i.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:h,tail:a,tailMode:g}:(v.isBackwards=t,v.rendering=null,v.renderingStartTime=0,v.last=h,v.tail=a,v.tailMode=g)}function HL(i,t,a){var h=t.pendingProps,g=h.revealOrder,v=h.tail;if(Qo(i,t,h.children,a),h=ds.current,h&2)h=h&1|2,t.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=t.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Hk(i,a,t);else if(i.tag===19)Hk(i,a,t);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;i.sibling===null;){if(i.return===null||i.return===t)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}if(Hn(ds,h),!(t.mode&1))t.memoizedState=null;else switch(g){case"forwards":for(a=t.child,g=null;a!==null;)i=a.alternate,i!==null&&B1(i)===null&&(g=a),a=a.sibling;a=g,a===null?(g=t.child,t.child=null):(g=a.sibling,a.sibling=null),TS(t,!1,g,a,v);break;case"backwards":for(a=null,g=t.child,t.child=null;g!==null;){if(i=g.alternate,i!==null&&B1(i)===null){t.child=g;break}i=g.sibling,g.sibling=a,a=g,g=i}TS(t,!0,a,null,v);break;case"together":TS(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function c1(i,t){!(t.mode&1)&&i!==null&&(i.alternate=null,t.alternate=null,t.flags|=2)}function pu(i,t,a){if(i!==null&&(t.dependencies=i.dependencies),xf|=t.lanes,!(a&t.childLanes))return null;if(i!==null&&t.child!==i.child)throw Error(sr(153));if(t.child!==null){for(i=t.child,a=Fh(i,i.pendingProps),t.child=a,a.return=t;i.sibling!==null;)i=i.sibling,a=a.sibling=Fh(i,i.pendingProps),a.return=t;a.sibling=null}return t.child}function pU(i,t,a){switch(t.tag){case 3:$L(t),Vm();break;case 5:_L(t);break;case 1:Ea(t.type)&&M1(t);break;case 4:Z2(t,t.stateNode.containerInfo);break;case 10:var h=t.type._context,g=t.memoizedProps.value;Hn(L1,h._currentValue),h._currentValue=g;break;case 13:if(h=t.memoizedState,h!==null)return h.dehydrated!==null?(Hn(ds,ds.current&1),t.flags|=128,null):a&t.child.childLanes?GL(i,t,a):(Hn(ds,ds.current&1),i=pu(i,t,a),i!==null?i.sibling:null);Hn(ds,ds.current&1);break;case 19:if(h=(a&t.childLanes)!==0,i.flags&128){if(h)return HL(i,t,a);t.flags|=128}if(g=t.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Hn(ds,ds.current),h)break;return null;case 22:case 23:return t.lanes=0,VL(i,t,a)}return pu(i,t,a)}var qL,PE,WL,ZL;qL=function(i,t){for(var a=t.child;a!==null;){if(a.tag===5||a.tag===6)i.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===t)break;for(;a.sibling===null;){if(a.return===null||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};PE=function(){};WL=function(i,t,a,h){var g=i.memoizedProps;if(g!==h){i=t.stateNode,of(Ec.current);var v=null;switch(a){case"input":g=YS(i,g),h=YS(i,h),v=[];break;case"select":g=ps({},g,{value:void 0}),h=ps({},h,{value:void 0}),v=[];break;case"textarea":g=eE(i,g),h=eE(i,h),v=[];break;default:typeof g.onClick!="function"&&typeof h.onClick=="function"&&(i.onclick=R1)}rE(a,h);var E;a=null;for(F in g)if(!h.hasOwnProperty(F)&&g.hasOwnProperty(F)&&g[F]!=null)if(F==="style"){var o=g[F];for(E in o)o.hasOwnProperty(E)&&(a||(a={}),a[E]="")}else F!=="dangerouslySetInnerHTML"&&F!=="children"&&F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(Gy.hasOwnProperty(F)?v||(v=[]):(v=v||[]).push(F,null));for(F in h){var O=h[F];if(o=g!=null?g[F]:void 0,h.hasOwnProperty(F)&&O!==o&&(O!=null||o!=null))if(F==="style")if(o){for(E in o)!o.hasOwnProperty(E)||O&&O.hasOwnProperty(E)||(a||(a={}),a[E]="");for(E in O)O.hasOwnProperty(E)&&o[E]!==O[E]&&(a||(a={}),a[E]=O[E])}else a||(v||(v=[]),v.push(F,a)),a=O;else F==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,o=o?o.__html:void 0,O!=null&&o!==O&&(v=v||[]).push(F,O)):F==="children"?typeof O!="string"&&typeof O!="number"||(v=v||[]).push(F,""+O):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&(Gy.hasOwnProperty(F)?(O!=null&&F==="onScroll"&&Kn("scroll",i),v||o===O||(v=[])):(v=v||[]).push(F,O))}a&&(v=v||[]).push("style",a);var F=v;(t.updateQueue=F)&&(t.flags|=4)}};ZL=function(i,t,a,h){a!==h&&(t.flags|=4)};function _y(i,t){if(!is)switch(i.tailMode){case"hidden":t=i.tail;for(var a=null;t!==null;)t.alternate!==null&&(a=t),t=t.sibling;a===null?i.tail=null:a.sibling=null;break;case"collapsed":a=i.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?t||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function Po(i){var t=i.alternate!==null&&i.alternate.child===i.child,a=0,h=0;if(t)for(var g=i.child;g!==null;)a|=g.lanes|g.childLanes,h|=g.subtreeFlags&14680064,h|=g.flags&14680064,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)a|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=h,i.childLanes=a,t}function mU(i,t,a){var h=t.pendingProps;switch(V2(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Po(t),null;case 1:return Ea(t.type)&&k1(),Po(t),null;case 3:return h=t.stateNode,$m(),Yn(Sa),Yn(Oo),K2(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(i===null||i.child===null)&&(Ox(t)?t.flags|=4:i===null||i.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ul!==null&&(FE(Ul),Ul=null))),PE(i,t),Po(t),null;case 5:X2(t);var g=of(r0.current);if(a=t.type,i!==null&&t.stateNode!=null)WL(i,t,a,h,g),i.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!h){if(t.stateNode===null)throw Error(sr(166));return Po(t),null}if(i=of(Ec.current),Ox(t)){h=t.stateNode,a=t.type;var v=t.memoizedProps;switch(h[wc]=t,h[e0]=v,i=(t.mode&1)!==0,a){case"dialog":Kn("cancel",h),Kn("close",h);break;case"iframe":case"object":case"embed":Kn("load",h);break;case"video":case"audio":for(g=0;g<Iy.length;g++)Kn(Iy[g],h);break;case"source":Kn("error",h);break;case"img":case"image":case"link":Kn("error",h),Kn("load",h);break;case"details":Kn("toggle",h);break;case"input":ek(h,v),Kn("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!v.multiple},Kn("invalid",h);break;case"textarea":rk(h,v),Kn("invalid",h)}rE(a,v),g=null;for(var E in v)if(v.hasOwnProperty(E)){var o=v[E];E==="children"?typeof o=="string"?h.textContent!==o&&(v.suppressHydrationWarning!==!0&&Mx(h.textContent,o,i),g=["children",o]):typeof o=="number"&&h.textContent!==""+o&&(v.suppressHydrationWarning!==!0&&Mx(h.textContent,o,i),g=["children",""+o]):Gy.hasOwnProperty(E)&&o!=null&&E==="onScroll"&&Kn("scroll",h)}switch(a){case"input":Sx(h),tk(h,v,!0);break;case"textarea":Sx(h),ik(h);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(h.onclick=R1)}h=g,t.updateQueue=h,h!==null&&(t.flags|=4)}else{E=g.nodeType===9?g:g.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=bD(a)),i==="http://www.w3.org/1999/xhtml"?a==="script"?(i=E.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof h.is=="string"?i=E.createElement(a,{is:h.is}):(i=E.createElement(a),a==="select"&&(E=i,h.multiple?E.multiple=!0:h.size&&(E.size=h.size))):i=E.createElementNS(i,a),i[wc]=t,i[e0]=h,qL(i,t,!1,!1),t.stateNode=i;e:{switch(E=iE(a,h),a){case"dialog":Kn("cancel",i),Kn("close",i),g=h;break;case"iframe":case"object":case"embed":Kn("load",i),g=h;break;case"video":case"audio":for(g=0;g<Iy.length;g++)Kn(Iy[g],i);g=h;break;case"source":Kn("error",i),g=h;break;case"img":case"image":case"link":Kn("error",i),Kn("load",i),g=h;break;case"details":Kn("toggle",i),g=h;break;case"input":ek(i,h),g=YS(i,h),Kn("invalid",i);break;case"option":g=h;break;case"select":i._wrapperState={wasMultiple:!!h.multiple},g=ps({},h,{value:void 0}),Kn("invalid",i);break;case"textarea":rk(i,h),g=eE(i,h),Kn("invalid",i);break;default:g=h}rE(a,g),o=g;for(v in o)if(o.hasOwnProperty(v)){var O=o[v];v==="style"?ED(i,O):v==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&TD(i,O)):v==="children"?typeof O=="string"?(a!=="textarea"||O!=="")&&Hy(i,O):typeof O=="number"&&Hy(i,""+O):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Gy.hasOwnProperty(v)?O!=null&&v==="onScroll"&&Kn("scroll",i):O!=null&&I2(i,v,O,E))}switch(a){case"input":Sx(i),tk(i,h,!1);break;case"textarea":Sx(i),ik(i);break;case"option":h.value!=null&&i.setAttribute("value",""+Nh(h.value));break;case"select":i.multiple=!!h.multiple,v=h.value,v!=null?wm(i,!!h.multiple,v,!1):h.defaultValue!=null&&wm(i,!!h.multiple,h.defaultValue,!0);break;default:typeof g.onClick=="function"&&(i.onclick=R1)}switch(a){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Po(t),null;case 6:if(i&&t.stateNode!=null)ZL(i,t,i.memoizedProps,h);else{if(typeof h!="string"&&t.stateNode===null)throw Error(sr(166));if(a=of(r0.current),of(Ec.current),Ox(t)){if(h=t.stateNode,a=t.memoizedProps,h[wc]=t,(v=h.nodeValue!==a)&&(i=Ha,i!==null))switch(i.tag){case 3:Mx(h.nodeValue,a,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Mx(h.nodeValue,a,(i.mode&1)!==0)}v&&(t.flags|=4)}else h=(a.nodeType===9?a:a.ownerDocument).createTextNode(h),h[wc]=t,t.stateNode=h}return Po(t),null;case 13:if(Yn(ds),h=t.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(is&&$a!==null&&t.mode&1&&!(t.flags&128))dL(),Vm(),t.flags|=98560,v=!1;else if(v=Ox(t),h!==null&&h.dehydrated!==null){if(i===null){if(!v)throw Error(sr(318));if(v=t.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(sr(317));v[wc]=t}else Vm(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Po(t),v=!1}else Ul!==null&&(FE(Ul),Ul=null),v=!0;if(!v)return t.flags&65536?t:null}return t.flags&128?(t.lanes=a,t):(h=h!==null,h!==(i!==null&&i.memoizedState!==null)&&h&&(t.child.flags|=8192,t.mode&1&&(i===null||ds.current&1?Ys===0&&(Ys=3):lI())),t.updateQueue!==null&&(t.flags|=4),Po(t),null);case 4:return $m(),PE(i,t),i===null&&Jy(t.stateNode.containerInfo),Po(t),null;case 10:return H2(t.type._context),Po(t),null;case 17:return Ea(t.type)&&k1(),Po(t),null;case 19:if(Yn(ds),v=t.memoizedState,v===null)return Po(t),null;if(h=(t.flags&128)!==0,E=v.rendering,E===null)if(h)_y(v,!1);else{if(Ys!==0||i!==null&&i.flags&128)for(i=t.child;i!==null;){if(E=B1(i),E!==null){for(t.flags|=128,_y(v,!1),h=E.updateQueue,h!==null&&(t.updateQueue=h,t.flags|=4),t.subtreeFlags=0,h=a,a=t.child;a!==null;)v=a,i=h,v.flags&=14680066,E=v.alternate,E===null?(v.childLanes=0,v.lanes=i,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=E.childLanes,v.lanes=E.lanes,v.child=E.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=E.memoizedProps,v.memoizedState=E.memoizedState,v.updateQueue=E.updateQueue,v.type=E.type,i=E.dependencies,v.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),a=a.sibling;return Hn(ds,ds.current&1|2),t.child}i=i.sibling}v.tail!==null&&Cs()>Hm&&(t.flags|=128,h=!0,_y(v,!1),t.lanes=4194304)}else{if(!h)if(i=B1(E),i!==null){if(t.flags|=128,h=!0,a=i.updateQueue,a!==null&&(t.updateQueue=a,t.flags|=4),_y(v,!0),v.tail===null&&v.tailMode==="hidden"&&!E.alternate&&!is)return Po(t),null}else 2*Cs()-v.renderingStartTime>Hm&&a!==1073741824&&(t.flags|=128,h=!0,_y(v,!1),t.lanes=4194304);v.isBackwards?(E.sibling=t.child,t.child=E):(a=v.last,a!==null?a.sibling=E:t.child=E,v.last=E)}return v.tail!==null?(t=v.tail,v.rendering=t,v.tail=t.sibling,v.renderingStartTime=Cs(),t.sibling=null,a=ds.current,Hn(ds,h?a&1|2:a&1),t):(Po(t),null);case 22:case 23:return aI(),h=t.memoizedState!==null,i!==null&&i.memoizedState!==null!==h&&(t.flags|=8192),h&&t.mode&1?Ba&1073741824&&(Po(t),t.subtreeFlags&6&&(t.flags|=8192)):Po(t),null;case 24:return null;case 25:return null}throw Error(sr(156,t.tag))}function gU(i,t){switch(V2(t),t.tag){case 1:return Ea(t.type)&&k1(),i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 3:return $m(),Yn(Sa),Yn(Oo),K2(),i=t.flags,i&65536&&!(i&128)?(t.flags=i&-65537|128,t):null;case 5:return X2(t),null;case 13:if(Yn(ds),i=t.memoizedState,i!==null&&i.dehydrated!==null){if(t.alternate===null)throw Error(sr(340));Vm()}return i=t.flags,i&65536?(t.flags=i&-65537|128,t):null;case 19:return Yn(ds),null;case 4:return $m(),null;case 10:return H2(t.type._context),null;case 22:case 23:return aI(),null;case 24:return null;default:return null}}var zx=!1,Mo=!1,_U=typeof WeakSet=="function"?WeakSet:Set,Br=null;function vm(i,t){var a=i.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(h){Ts(i,t,h)}else a.current=null}function RE(i,t,a){try{a()}catch(h){Ts(i,t,h)}}var qk=!1;function yU(i,t){if(fE=A1,i=QD(),N2(i)){if("selectionStart"in i)var a={start:i.selectionStart,end:i.selectionEnd};else e:{a=(a=i.ownerDocument)&&a.defaultView||window;var h=a.getSelection&&a.getSelection();if(h&&h.rangeCount!==0){a=h.anchorNode;var g=h.anchorOffset,v=h.focusNode;h=h.focusOffset;try{a.nodeType,v.nodeType}catch{a=null;break e}var E=0,o=-1,O=-1,F=0,$=0,Q=i,te=null;t:for(;;){for(var J;Q!==a||g!==0&&Q.nodeType!==3||(o=E+g),Q!==v||h!==0&&Q.nodeType!==3||(O=E+h),Q.nodeType===3&&(E+=Q.nodeValue.length),(J=Q.firstChild)!==null;)te=Q,Q=J;for(;;){if(Q===i)break t;if(te===a&&++F===g&&(o=E),te===v&&++$===h&&(O=E),(J=Q.nextSibling)!==null)break;Q=te,te=Q.parentNode}Q=J}a=o===-1||O===-1?null:{start:o,end:O}}else a=null}a=a||{start:0,end:0}}else a=null;for(pE={focusedElem:i,selectionRange:a},A1=!1,Br=t;Br!==null;)if(t=Br,i=t.child,(t.subtreeFlags&1028)!==0&&i!==null)i.return=t,Br=i;else for(;Br!==null;){t=Br;try{var we=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(we!==null){var se=we.memoizedProps,me=we.memoizedState,fe=t.stateNode,re=fe.getSnapshotBeforeUpdate(t.elementType===t.type?se:Ll(t.type,se),me);fe.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var de=t.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(sr(163))}}catch(Oe){Ts(t,t.return,Oe)}if(i=t.sibling,i!==null){i.return=t.return,Br=i;break}Br=t.return}return we=qk,qk=!1,we}function Ly(i,t,a){var h=t.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var g=h=h.next;do{if((g.tag&i)===i){var v=g.destroy;g.destroy=void 0,v!==void 0&&RE(t,a,v)}g=g.next}while(g!==h)}}function Sw(i,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var a=t=t.next;do{if((a.tag&i)===i){var h=a.create;a.destroy=h()}a=a.next}while(a!==t)}}function kE(i){var t=i.ref;if(t!==null){var a=i.stateNode;switch(i.tag){case 5:i=a;break;default:i=a}typeof t=="function"?t(i):t.current=i}}function XL(i){var t=i.alternate;t!==null&&(i.alternate=null,XL(t)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(t=i.stateNode,t!==null&&(delete t[wc],delete t[e0],delete t[_E],delete t[eU],delete t[tU])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function KL(i){return i.tag===5||i.tag===3||i.tag===4}function Wk(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||KL(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function ME(i,t,a){var h=i.tag;if(h===5||h===6)i=i.stateNode,t?a.nodeType===8?a.parentNode.insertBefore(i,t):a.insertBefore(i,t):(a.nodeType===8?(t=a.parentNode,t.insertBefore(i,a)):(t=a,t.appendChild(i)),a=a._reactRootContainer,a!=null||t.onclick!==null||(t.onclick=R1));else if(h!==4&&(i=i.child,i!==null))for(ME(i,t,a),i=i.sibling;i!==null;)ME(i,t,a),i=i.sibling}function OE(i,t,a){var h=i.tag;if(h===5||h===6)i=i.stateNode,t?a.insertBefore(i,t):a.appendChild(i);else if(h!==4&&(i=i.child,i!==null))for(OE(i,t,a),i=i.sibling;i!==null;)OE(i,t,a),i=i.sibling}var go=null,jl=!1;function uh(i,t,a){for(a=a.child;a!==null;)YL(i,t,a),a=a.sibling}function YL(i,t,a){if(Sc&&typeof Sc.onCommitFiberUnmount=="function")try{Sc.onCommitFiberUnmount(gw,a)}catch{}switch(a.tag){case 5:Mo||vm(a,t);case 6:var h=go,g=jl;go=null,uh(i,t,a),go=h,jl=g,go!==null&&(jl?(i=go,a=a.stateNode,i.nodeType===8?i.parentNode.removeChild(a):i.removeChild(a)):go.removeChild(a.stateNode));break;case 18:go!==null&&(jl?(i=go,a=a.stateNode,i.nodeType===8?gS(i.parentNode,a):i.nodeType===1&&gS(i,a),Xy(i)):gS(go,a.stateNode));break;case 4:h=go,g=jl,go=a.stateNode.containerInfo,jl=!0,uh(i,t,a),go=h,jl=g;break;case 0:case 11:case 14:case 15:if(!Mo&&(h=a.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){g=h=h.next;do{var v=g,E=v.destroy;v=v.tag,E!==void 0&&(v&2||v&4)&&RE(a,t,E),g=g.next}while(g!==h)}uh(i,t,a);break;case 1:if(!Mo&&(vm(a,t),h=a.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=a.memoizedProps,h.state=a.memoizedState,h.componentWillUnmount()}catch(o){Ts(a,t,o)}uh(i,t,a);break;case 21:uh(i,t,a);break;case 22:a.mode&1?(Mo=(h=Mo)||a.memoizedState!==null,uh(i,t,a),Mo=h):uh(i,t,a);break;default:uh(i,t,a)}}function Zk(i){var t=i.updateQueue;if(t!==null){i.updateQueue=null;var a=i.stateNode;a===null&&(a=i.stateNode=new _U),t.forEach(function(h){var g=AU.bind(null,i,h);a.has(h)||(a.add(h),h.then(g,g))})}}function kl(i,t){var a=t.deletions;if(a!==null)for(var h=0;h<a.length;h++){var g=a[h];try{var v=i,E=t,o=E;e:for(;o!==null;){switch(o.tag){case 5:go=o.stateNode,jl=!1;break e;case 3:go=o.stateNode.containerInfo,jl=!0;break e;case 4:go=o.stateNode.containerInfo,jl=!0;break e}o=o.return}if(go===null)throw Error(sr(160));YL(v,E,g),go=null,jl=!1;var O=g.alternate;O!==null&&(O.return=null),g.return=null}catch(F){Ts(g,t,F)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)JL(t,i),t=t.sibling}function JL(i,t){var a=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(kl(t,i),mc(i),h&4){try{Ly(3,i,i.return),Sw(3,i)}catch(se){Ts(i,i.return,se)}try{Ly(5,i,i.return)}catch(se){Ts(i,i.return,se)}}break;case 1:kl(t,i),mc(i),h&512&&a!==null&&vm(a,a.return);break;case 5:if(kl(t,i),mc(i),h&512&&a!==null&&vm(a,a.return),i.flags&32){var g=i.stateNode;try{Hy(g,"")}catch(se){Ts(i,i.return,se)}}if(h&4&&(g=i.stateNode,g!=null)){var v=i.memoizedProps,E=a!==null?a.memoizedProps:v,o=i.type,O=i.updateQueue;if(i.updateQueue=null,O!==null)try{o==="input"&&v.type==="radio"&&v.name!=null&&xD(g,v),iE(o,E);var F=iE(o,v);for(E=0;E<O.length;E+=2){var $=O[E],Q=O[E+1];$==="style"?ED(g,Q):$==="dangerouslySetInnerHTML"?TD(g,Q):$==="children"?Hy(g,Q):I2(g,$,Q,F)}switch(o){case"input":JS(g,v);break;case"textarea":wD(g,v);break;case"select":var te=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!v.multiple;var J=v.value;J!=null?wm(g,!!v.multiple,J,!1):te!==!!v.multiple&&(v.defaultValue!=null?wm(g,!!v.multiple,v.defaultValue,!0):wm(g,!!v.multiple,v.multiple?[]:"",!1))}g[e0]=v}catch(se){Ts(i,i.return,se)}}break;case 6:if(kl(t,i),mc(i),h&4){if(i.stateNode===null)throw Error(sr(162));g=i.stateNode,v=i.memoizedProps;try{g.nodeValue=v}catch(se){Ts(i,i.return,se)}}break;case 3:if(kl(t,i),mc(i),h&4&&a!==null&&a.memoizedState.isDehydrated)try{Xy(t.containerInfo)}catch(se){Ts(i,i.return,se)}break;case 4:kl(t,i),mc(i);break;case 13:kl(t,i),mc(i),g=i.child,g.flags&8192&&(v=g.memoizedState!==null,g.stateNode.isHidden=v,!v||g.alternate!==null&&g.alternate.memoizedState!==null||(sI=Cs())),h&4&&Zk(i);break;case 22:if($=a!==null&&a.memoizedState!==null,i.mode&1?(Mo=(F=Mo)||$,kl(t,i),Mo=F):kl(t,i),mc(i),h&8192){if(F=i.memoizedState!==null,(i.stateNode.isHidden=F)&&!$&&i.mode&1)for(Br=i,$=i.child;$!==null;){for(Q=Br=$;Br!==null;){switch(te=Br,J=te.child,te.tag){case 0:case 11:case 14:case 15:Ly(4,te,te.return);break;case 1:vm(te,te.return);var we=te.stateNode;if(typeof we.componentWillUnmount=="function"){h=te,a=te.return;try{t=h,we.props=t.memoizedProps,we.state=t.memoizedState,we.componentWillUnmount()}catch(se){Ts(h,a,se)}}break;case 5:vm(te,te.return);break;case 22:if(te.memoizedState!==null){Kk(Q);continue}}J!==null?(J.return=te,Br=J):Kk(Q)}$=$.sibling}e:for($=null,Q=i;;){if(Q.tag===5){if($===null){$=Q;try{g=Q.stateNode,F?(v=g.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(o=Q.stateNode,O=Q.memoizedProps.style,E=O!=null&&O.hasOwnProperty("display")?O.display:null,o.style.display=SD("display",E))}catch(se){Ts(i,i.return,se)}}}else if(Q.tag===6){if($===null)try{Q.stateNode.nodeValue=F?"":Q.memoizedProps}catch(se){Ts(i,i.return,se)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===i)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===i)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===i)break e;$===Q&&($=null),Q=Q.return}$===Q&&($=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:kl(t,i),mc(i),h&4&&Zk(i);break;case 21:break;default:kl(t,i),mc(i)}}function mc(i){var t=i.flags;if(t&2){try{e:{for(var a=i.return;a!==null;){if(KL(a)){var h=a;break e}a=a.return}throw Error(sr(160))}switch(h.tag){case 5:var g=h.stateNode;h.flags&32&&(Hy(g,""),h.flags&=-33);var v=Wk(i);OE(i,v,g);break;case 3:case 4:var E=h.stateNode.containerInfo,o=Wk(i);ME(i,o,E);break;default:throw Error(sr(161))}}catch(O){Ts(i,i.return,O)}i.flags&=-3}t&4096&&(i.flags&=-4097)}function vU(i,t,a){Br=i,QL(i)}function QL(i,t,a){for(var h=(i.mode&1)!==0;Br!==null;){var g=Br,v=g.child;if(g.tag===22&&h){var E=g.memoizedState!==null||zx;if(!E){var o=g.alternate,O=o!==null&&o.memoizedState!==null||Mo;o=zx;var F=Mo;if(zx=E,(Mo=O)&&!F)for(Br=g;Br!==null;)E=Br,O=E.child,E.tag===22&&E.memoizedState!==null?Yk(g):O!==null?(O.return=E,Br=O):Yk(g);for(;v!==null;)Br=v,QL(v),v=v.sibling;Br=g,zx=o,Mo=F}Xk(i)}else g.subtreeFlags&8772&&v!==null?(v.return=g,Br=v):Xk(i)}}function Xk(i){for(;Br!==null;){var t=Br;if(t.flags&8772){var a=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Mo||Sw(5,t);break;case 1:var h=t.stateNode;if(t.flags&4&&!Mo)if(a===null)h.componentDidMount();else{var g=t.elementType===t.type?a.memoizedProps:Ll(t.type,a.memoizedProps);h.componentDidUpdate(g,a.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var v=t.updateQueue;v!==null&&Ok(t,v,h);break;case 3:var E=t.updateQueue;if(E!==null){if(a=null,t.child!==null)switch(t.child.tag){case 5:a=t.child.stateNode;break;case 1:a=t.child.stateNode}Ok(t,E,a)}break;case 5:var o=t.stateNode;if(a===null&&t.flags&4){a=o;var O=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&a.focus();break;case"img":O.src&&(a.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var F=t.alternate;if(F!==null){var $=F.memoizedState;if($!==null){var Q=$.dehydrated;Q!==null&&Xy(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(sr(163))}Mo||t.flags&512&&kE(t)}catch(te){Ts(t,t.return,te)}}if(t===i){Br=null;break}if(a=t.sibling,a!==null){a.return=t.return,Br=a;break}Br=t.return}}function Kk(i){for(;Br!==null;){var t=Br;if(t===i){Br=null;break}var a=t.sibling;if(a!==null){a.return=t.return,Br=a;break}Br=t.return}}function Yk(i){for(;Br!==null;){var t=Br;try{switch(t.tag){case 0:case 11:case 15:var a=t.return;try{Sw(4,t)}catch(O){Ts(t,a,O)}break;case 1:var h=t.stateNode;if(typeof h.componentDidMount=="function"){var g=t.return;try{h.componentDidMount()}catch(O){Ts(t,g,O)}}var v=t.return;try{kE(t)}catch(O){Ts(t,v,O)}break;case 5:var E=t.return;try{kE(t)}catch(O){Ts(t,E,O)}}}catch(O){Ts(t,t.return,O)}if(t===i){Br=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Br=o;break}Br=t.return}}var xU=Math.ceil,V1=yu.ReactCurrentDispatcher,iI=yu.ReactCurrentOwner,cl=yu.ReactCurrentBatchConfig,yn=0,ao=null,Ns=null,_o=0,Ba=0,xm=Zh(0),Ys=0,o0=null,xf=0,Ew=0,nI=0,zy=null,ba=null,sI=0,Hm=1/0,iu=null,U1=!1,DE=null,Lh=null,Fx=!1,Ah=null,$1=0,Fy=0,LE=null,u1=-1,h1=0;function ia(){return yn&6?Cs():u1!==-1?u1:u1=Cs()}function zh(i){return i.mode&1?yn&2&&_o!==0?_o&-_o:iU.transition!==null?(h1===0&&(h1=FD()),h1):(i=zn,i!==0||(i=window.event,i=i===void 0?16:GD(i.type)),i):1}function ql(i,t,a,h){if(50<Fy)throw Fy=0,LE=null,Error(sr(185));x0(i,a,h),(!(yn&2)||i!==ao)&&(i===ao&&(!(yn&2)&&(Ew|=a),Ys===4&&vh(i,_o)),Ia(i,h),a===1&&yn===0&&!(t.mode&1)&&(Hm=Cs()+500,ww&&Xh()))}function Ia(i,t){var a=i.callbackNode;iV(i,t);var h=I1(i,i===ao?_o:0);if(h===0)a!==null&&ok(a),i.callbackNode=null,i.callbackPriority=0;else if(t=h&-h,i.callbackPriority!==t){if(a!=null&&ok(a),t===1)i.tag===0?rU(Jk.bind(null,i)):cL(Jk.bind(null,i)),JV(function(){!(yn&6)&&Xh()}),a=null;else{switch(BD(h)){case 1:a=k2;break;case 4:a=LD;break;case 16:a=E1;break;case 536870912:a=zD;break;default:a=E1}a=az(a,ez.bind(null,i))}i.callbackPriority=t,i.callbackNode=a}}function ez(i,t){if(u1=-1,h1=0,yn&6)throw Error(sr(327));var a=i.callbackNode;if(Im()&&i.callbackNode!==a)return null;var h=I1(i,i===ao?_o:0);if(h===0)return null;if(h&30||h&i.expiredLanes||t)t=G1(i,h);else{t=h;var g=yn;yn|=2;var v=rz();(ao!==i||_o!==t)&&(iu=null,Hm=Cs()+500,mf(i,t));do try{TU();break}catch(o){tz(i,o)}while(!0);G2(),V1.current=v,yn=g,Ns!==null?t=0:(ao=null,_o=0,t=Ys)}if(t!==0){if(t===2&&(g=lE(i),g!==0&&(h=g,t=zE(i,g))),t===1)throw a=o0,mf(i,0),vh(i,h),Ia(i,Cs()),a;if(t===6)vh(i,h);else{if(g=i.current.alternate,!(h&30)&&!wU(g)&&(t=G1(i,h),t===2&&(v=lE(i),v!==0&&(h=v,t=zE(i,v))),t===1))throw a=o0,mf(i,0),vh(i,h),Ia(i,Cs()),a;switch(i.finishedWork=g,i.finishedLanes=h,t){case 0:case 1:throw Error(sr(345));case 2:Qd(i,ba,iu);break;case 3:if(vh(i,h),(h&130023424)===h&&(t=sI+500-Cs(),10<t)){if(I1(i,0)!==0)break;if(g=i.suspendedLanes,(g&h)!==h){ia(),i.pingedLanes|=i.suspendedLanes&g;break}i.timeoutHandle=gE(Qd.bind(null,i,ba,iu),t);break}Qd(i,ba,iu);break;case 4:if(vh(i,h),(h&4194240)===h)break;for(t=i.eventTimes,g=-1;0<h;){var E=31-Hl(h);v=1<<E,E=t[E],E>g&&(g=E),h&=~v}if(h=g,h=Cs()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*xU(h/1960))-h,10<h){i.timeoutHandle=gE(Qd.bind(null,i,ba,iu),h);break}Qd(i,ba,iu);break;case 5:Qd(i,ba,iu);break;default:throw Error(sr(329))}}}return Ia(i,Cs()),i.callbackNode===a?ez.bind(null,i):null}function zE(i,t){var a=zy;return i.current.memoizedState.isDehydrated&&(mf(i,t).flags|=256),i=G1(i,t),i!==2&&(t=ba,ba=a,t!==null&&FE(t)),i}function FE(i){ba===null?ba=i:ba.push.apply(ba,i)}function wU(i){for(var t=i;;){if(t.flags&16384){var a=t.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var h=0;h<a.length;h++){var g=a[h],v=g.getSnapshot;g=g.value;try{if(!Wl(v(),g))return!1}catch{return!1}}}if(a=t.child,t.subtreeFlags&16384&&a!==null)a.return=t,t=a;else{if(t===i)break;for(;t.sibling===null;){if(t.return===null||t.return===i)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function vh(i,t){for(t&=~nI,t&=~Ew,i.suspendedLanes|=t,i.pingedLanes&=~t,i=i.expirationTimes;0<t;){var a=31-Hl(t),h=1<<a;i[a]=-1,t&=~h}}function Jk(i){if(yn&6)throw Error(sr(327));Im();var t=I1(i,0);if(!(t&1))return Ia(i,Cs()),null;var a=G1(i,t);if(i.tag!==0&&a===2){var h=lE(i);h!==0&&(t=h,a=zE(i,h))}if(a===1)throw a=o0,mf(i,0),vh(i,t),Ia(i,Cs()),a;if(a===6)throw Error(sr(345));return i.finishedWork=i.current.alternate,i.finishedLanes=t,Qd(i,ba,iu),Ia(i,Cs()),null}function oI(i,t){var a=yn;yn|=1;try{return i(t)}finally{yn=a,yn===0&&(Hm=Cs()+500,ww&&Xh())}}function wf(i){Ah!==null&&Ah.tag===0&&!(yn&6)&&Im();var t=yn;yn|=1;var a=cl.transition,h=zn;try{if(cl.transition=null,zn=1,i)return i()}finally{zn=h,cl.transition=a,yn=t,!(yn&6)&&Xh()}}function aI(){Ba=xm.current,Yn(xm)}function mf(i,t){i.finishedWork=null,i.finishedLanes=0;var a=i.timeoutHandle;if(a!==-1&&(i.timeoutHandle=-1,YV(a)),Ns!==null)for(a=Ns.return;a!==null;){var h=a;switch(V2(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&k1();break;case 3:$m(),Yn(Sa),Yn(Oo),K2();break;case 5:X2(h);break;case 4:$m();break;case 13:Yn(ds);break;case 19:Yn(ds);break;case 10:H2(h.type._context);break;case 22:case 23:aI()}a=a.return}if(ao=i,Ns=i=Fh(i.current,null),_o=Ba=t,Ys=0,o0=null,nI=Ew=xf=0,ba=zy=null,sf!==null){for(t=0;t<sf.length;t++)if(a=sf[t],h=a.interleaved,h!==null){a.interleaved=null;var g=h.next,v=a.pending;if(v!==null){var E=v.next;v.next=g,h.next=E}a.pending=h}sf=null}return i}function tz(i,t){do{var a=Ns;try{if(G2(),a1.current=j1,N1){for(var h=fs.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}N1=!1}if(vf=0,oo=Xs=fs=null,Dy=!1,i0=0,iI.current=null,a===null||a.return===null){Ys=1,o0=t,Ns=null;break}e:{var v=i,E=a.return,o=a,O=t;if(t=_o,o.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var F=O,$=o,Q=$.tag;if(!($.mode&1)&&(Q===0||Q===11||Q===15)){var te=$.alternate;te?($.updateQueue=te.updateQueue,$.memoizedState=te.memoizedState,$.lanes=te.lanes):($.updateQueue=null,$.memoizedState=null)}var J=Nk(E);if(J!==null){J.flags&=-257,jk(J,E,o,v,t),J.mode&1&&Bk(v,F,t),t=J,O=F;var we=t.updateQueue;if(we===null){var se=new Set;se.add(O),t.updateQueue=se}else we.add(O);break e}else{if(!(t&1)){Bk(v,F,t),lI();break e}O=Error(sr(426))}}else if(is&&o.mode&1){var me=Nk(E);if(me!==null){!(me.flags&65536)&&(me.flags|=256),jk(me,E,o,v,t),U2(Gm(O,o));break e}}v=O=Gm(O,o),Ys!==4&&(Ys=2),zy===null?zy=[v]:zy.push(v),v=E;do{switch(v.tag){case 3:v.flags|=65536,t&=-t,v.lanes|=t;var fe=BL(v,O,t);Mk(v,fe);break e;case 1:o=O;var re=v.type,de=v.stateNode;if(!(v.flags&128)&&(typeof re.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(Lh===null||!Lh.has(de)))){v.flags|=65536,t&=-t,v.lanes|=t;var Oe=NL(v,o,t);Mk(v,Oe);break e}}v=v.return}while(v!==null)}nz(a)}catch(Xe){t=Xe,Ns===a&&a!==null&&(Ns=a=a.return);continue}break}while(!0)}function rz(){var i=V1.current;return V1.current=j1,i===null?j1:i}function lI(){(Ys===0||Ys===3||Ys===2)&&(Ys=4),ao===null||!(xf&268435455)&&!(Ew&268435455)||vh(ao,_o)}function G1(i,t){var a=yn;yn|=2;var h=rz();(ao!==i||_o!==t)&&(iu=null,mf(i,t));do try{bU();break}catch(g){tz(i,g)}while(!0);if(G2(),yn=a,V1.current=h,Ns!==null)throw Error(sr(261));return ao=null,_o=0,Ys}function bU(){for(;Ns!==null;)iz(Ns)}function TU(){for(;Ns!==null&&!Zj();)iz(Ns)}function iz(i){var t=oz(i.alternate,i,Ba);i.memoizedProps=i.pendingProps,t===null?nz(i):Ns=t,iI.current=null}function nz(i){var t=i;do{var a=t.alternate;if(i=t.return,t.flags&32768){if(a=gU(a,t),a!==null){a.flags&=32767,Ns=a;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Ys=6,Ns=null;return}}else if(a=mU(a,t,Ba),a!==null){Ns=a;return}if(t=t.sibling,t!==null){Ns=t;return}Ns=t=i}while(t!==null);Ys===0&&(Ys=5)}function Qd(i,t,a){var h=zn,g=cl.transition;try{cl.transition=null,zn=1,SU(i,t,a,h)}finally{cl.transition=g,zn=h}return null}function SU(i,t,a,h){do Im();while(Ah!==null);if(yn&6)throw Error(sr(327));a=i.finishedWork;var g=i.finishedLanes;if(a===null)return null;if(i.finishedWork=null,i.finishedLanes=0,a===i.current)throw Error(sr(177));i.callbackNode=null,i.callbackPriority=0;var v=a.lanes|a.childLanes;if(nV(i,v),i===ao&&(Ns=ao=null,_o=0),!(a.subtreeFlags&2064)&&!(a.flags&2064)||Fx||(Fx=!0,az(E1,function(){return Im(),null})),v=(a.flags&15990)!==0,a.subtreeFlags&15990||v){v=cl.transition,cl.transition=null;var E=zn;zn=1;var o=yn;yn|=4,iI.current=null,yU(i,a),JL(a,i),GV(pE),A1=!!fE,pE=fE=null,i.current=a,vU(a),Xj(),yn=o,zn=E,cl.transition=v}else i.current=a;if(Fx&&(Fx=!1,Ah=i,$1=g),v=i.pendingLanes,v===0&&(Lh=null),Jj(a.stateNode),Ia(i,Cs()),t!==null)for(h=i.onRecoverableError,a=0;a<t.length;a++)g=t[a],h(g.value,{componentStack:g.stack,digest:g.digest});if(U1)throw U1=!1,i=DE,DE=null,i;return $1&1&&i.tag!==0&&Im(),v=i.pendingLanes,v&1?i===LE?Fy++:(Fy=0,LE=i):Fy=0,Xh(),null}function Im(){if(Ah!==null){var i=BD($1),t=cl.transition,a=zn;try{if(cl.transition=null,zn=16>i?16:i,Ah===null)var h=!1;else{if(i=Ah,Ah=null,$1=0,yn&6)throw Error(sr(331));var g=yn;for(yn|=4,Br=i.current;Br!==null;){var v=Br,E=v.child;if(Br.flags&16){var o=v.deletions;if(o!==null){for(var O=0;O<o.length;O++){var F=o[O];for(Br=F;Br!==null;){var $=Br;switch($.tag){case 0:case 11:case 15:Ly(8,$,v)}var Q=$.child;if(Q!==null)Q.return=$,Br=Q;else for(;Br!==null;){$=Br;var te=$.sibling,J=$.return;if(XL($),$===F){Br=null;break}if(te!==null){te.return=J,Br=te;break}Br=J}}}var we=v.alternate;if(we!==null){var se=we.child;if(se!==null){we.child=null;do{var me=se.sibling;se.sibling=null,se=me}while(se!==null)}}Br=v}}if(v.subtreeFlags&2064&&E!==null)E.return=v,Br=E;else e:for(;Br!==null;){if(v=Br,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Ly(9,v,v.return)}var fe=v.sibling;if(fe!==null){fe.return=v.return,Br=fe;break e}Br=v.return}}var re=i.current;for(Br=re;Br!==null;){E=Br;var de=E.child;if(E.subtreeFlags&2064&&de!==null)de.return=E,Br=de;else e:for(E=re;Br!==null;){if(o=Br,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Sw(9,o)}}catch(Xe){Ts(o,o.return,Xe)}if(o===E){Br=null;break e}var Oe=o.sibling;if(Oe!==null){Oe.return=o.return,Br=Oe;break e}Br=o.return}}if(yn=g,Xh(),Sc&&typeof Sc.onPostCommitFiberRoot=="function")try{Sc.onPostCommitFiberRoot(gw,i)}catch{}h=!0}return h}finally{zn=a,cl.transition=t}}return!1}function Qk(i,t,a){t=Gm(a,t),t=BL(i,t,1),i=Dh(i,t,1),t=ia(),i!==null&&(x0(i,1,t),Ia(i,t))}function Ts(i,t,a){if(i.tag===3)Qk(i,i,a);else for(;t!==null;){if(t.tag===3){Qk(t,i,a);break}else if(t.tag===1){var h=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Lh===null||!Lh.has(h))){i=Gm(a,i),i=NL(t,i,1),t=Dh(t,i,1),i=ia(),t!==null&&(x0(t,1,i),Ia(t,i));break}}t=t.return}}function EU(i,t,a){var h=i.pingCache;h!==null&&h.delete(t),t=ia(),i.pingedLanes|=i.suspendedLanes&a,ao===i&&(_o&a)===a&&(Ys===4||Ys===3&&(_o&130023424)===_o&&500>Cs()-sI?mf(i,0):nI|=a),Ia(i,t)}function sz(i,t){t===0&&(i.mode&1?(t=Ax,Ax<<=1,!(Ax&130023424)&&(Ax=4194304)):t=1);var a=ia();i=fu(i,t),i!==null&&(x0(i,t,a),Ia(i,a))}function IU(i){var t=i.memoizedState,a=0;t!==null&&(a=t.retryLane),sz(i,a)}function AU(i,t){var a=0;switch(i.tag){case 13:var h=i.stateNode,g=i.memoizedState;g!==null&&(a=g.retryLane);break;case 19:h=i.stateNode;break;default:throw Error(sr(314))}h!==null&&h.delete(t),sz(i,a)}var oz;oz=function(i,t,a){if(i!==null)if(i.memoizedProps!==t.pendingProps||Sa.current)Ta=!0;else{if(!(i.lanes&a)&&!(t.flags&128))return Ta=!1,pU(i,t,a);Ta=!!(i.flags&131072)}else Ta=!1,is&&t.flags&1048576&&uL(t,D1,t.index);switch(t.lanes=0,t.tag){case 2:var h=t.type;c1(i,t),i=t.pendingProps;var g=jm(t,Oo.current);Em(t,a),g=J2(null,t,h,i,g,a);var v=Q2();return t.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ea(h)?(v=!0,M1(t)):v=!1,t.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,W2(t),g.updater=Tw,t.stateNode=g,g._reactInternals=t,TE(t,h,i,a),t=IE(null,t,h,!0,v,a)):(t.tag=0,is&&v&&j2(t),Qo(null,t,g,a),t=t.child),t;case 16:h=t.elementType;e:{switch(c1(i,t),i=t.pendingProps,g=h._init,h=g(h._payload),t.type=h,g=t.tag=PU(h),i=Ll(h,i),g){case 0:t=EE(null,t,h,i,a);break e;case 1:t=$k(null,t,h,i,a);break e;case 11:t=Vk(null,t,h,i,a);break e;case 14:t=Uk(null,t,h,Ll(h.type,i),a);break e}throw Error(sr(306,h,""))}return t;case 0:return h=t.type,g=t.pendingProps,g=t.elementType===h?g:Ll(h,g),EE(i,t,h,g,a);case 1:return h=t.type,g=t.pendingProps,g=t.elementType===h?g:Ll(h,g),$k(i,t,h,g,a);case 3:e:{if($L(t),i===null)throw Error(sr(387));h=t.pendingProps,v=t.memoizedState,g=v.element,gL(i,t),F1(t,h,null,a);var E=t.memoizedState;if(h=E.element,v.isDehydrated)if(v={element:h,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},t.updateQueue.baseState=v,t.memoizedState=v,t.flags&256){g=Gm(Error(sr(423)),t),t=Gk(i,t,h,a,g);break e}else if(h!==g){g=Gm(Error(sr(424)),t),t=Gk(i,t,h,a,g);break e}else for($a=Oh(t.stateNode.containerInfo.firstChild),Ha=t,is=!0,Ul=null,a=pL(t,null,h,a),t.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Vm(),h===g){t=pu(i,t,a);break e}Qo(i,t,h,a)}t=t.child}return t;case 5:return _L(t),i===null&&xE(t),h=t.type,g=t.pendingProps,v=i!==null?i.memoizedProps:null,E=g.children,mE(h,g)?E=null:v!==null&&mE(h,v)&&(t.flags|=32),UL(i,t),Qo(i,t,E,a),t.child;case 6:return i===null&&xE(t),null;case 13:return GL(i,t,a);case 4:return Z2(t,t.stateNode.containerInfo),h=t.pendingProps,i===null?t.child=Um(t,null,h,a):Qo(i,t,h,a),t.child;case 11:return h=t.type,g=t.pendingProps,g=t.elementType===h?g:Ll(h,g),Vk(i,t,h,g,a);case 7:return Qo(i,t,t.pendingProps,a),t.child;case 8:return Qo(i,t,t.pendingProps.children,a),t.child;case 12:return Qo(i,t,t.pendingProps.children,a),t.child;case 10:e:{if(h=t.type._context,g=t.pendingProps,v=t.memoizedProps,E=g.value,Hn(L1,h._currentValue),h._currentValue=E,v!==null)if(Wl(v.value,E)){if(v.children===g.children&&!Sa.current){t=pu(i,t,a);break e}}else for(v=t.child,v!==null&&(v.return=t);v!==null;){var o=v.dependencies;if(o!==null){E=v.child;for(var O=o.firstContext;O!==null;){if(O.context===h){if(v.tag===1){O=uu(-1,a&-a),O.tag=2;var F=v.updateQueue;if(F!==null){F=F.shared;var $=F.pending;$===null?O.next=O:(O.next=$.next,$.next=O),F.pending=O}}v.lanes|=a,O=v.alternate,O!==null&&(O.lanes|=a),wE(v.return,a,t),o.lanes|=a;break}O=O.next}}else if(v.tag===10)E=v.type===t.type?null:v.child;else if(v.tag===18){if(E=v.return,E===null)throw Error(sr(341));E.lanes|=a,o=E.alternate,o!==null&&(o.lanes|=a),wE(E,a,t),E=v.sibling}else E=v.child;if(E!==null)E.return=v;else for(E=v;E!==null;){if(E===t){E=null;break}if(v=E.sibling,v!==null){v.return=E.return,E=v;break}E=E.return}v=E}Qo(i,t,g.children,a),t=t.child}return t;case 9:return g=t.type,h=t.pendingProps.children,Em(t,a),g=ul(g),h=h(g),t.flags|=1,Qo(i,t,h,a),t.child;case 14:return h=t.type,g=Ll(h,t.pendingProps),g=Ll(h.type,g),Uk(i,t,h,g,a);case 15:return jL(i,t,t.type,t.pendingProps,a);case 17:return h=t.type,g=t.pendingProps,g=t.elementType===h?g:Ll(h,g),c1(i,t),t.tag=1,Ea(h)?(i=!0,M1(t)):i=!1,Em(t,a),FL(t,h,g),TE(t,h,g,a),IE(null,t,h,!0,i,a);case 19:return HL(i,t,a);case 22:return VL(i,t,a)}throw Error(sr(156,t.tag))};function az(i,t){return DD(i,t)}function CU(i,t,a,h){this.tag=i,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ll(i,t,a,h){return new CU(i,t,a,h)}function cI(i){return i=i.prototype,!(!i||!i.isReactComponent)}function PU(i){if(typeof i=="function")return cI(i)?1:0;if(i!=null){if(i=i.$$typeof,i===C2)return 11;if(i===P2)return 14}return 2}function Fh(i,t){var a=i.alternate;return a===null?(a=ll(i.tag,t,i.key,i.mode),a.elementType=i.elementType,a.type=i.type,a.stateNode=i.stateNode,a.alternate=i,i.alternate=a):(a.pendingProps=t,a.type=i.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=i.flags&14680064,a.childLanes=i.childLanes,a.lanes=i.lanes,a.child=i.child,a.memoizedProps=i.memoizedProps,a.memoizedState=i.memoizedState,a.updateQueue=i.updateQueue,t=i.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},a.sibling=i.sibling,a.index=i.index,a.ref=i.ref,a}function d1(i,t,a,h,g,v){var E=2;if(h=i,typeof i=="function")cI(i)&&(E=1);else if(typeof i=="string")E=5;else e:switch(i){case um:return gf(a.children,g,v,t);case A2:E=8,g|=8;break;case WS:return i=ll(12,a,t,g|2),i.elementType=WS,i.lanes=v,i;case ZS:return i=ll(13,a,t,g),i.elementType=ZS,i.lanes=v,i;case XS:return i=ll(19,a,t,g),i.elementType=XS,i.lanes=v,i;case _D:return Iw(a,g,v,t);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case mD:E=10;break e;case gD:E=9;break e;case C2:E=11;break e;case P2:E=14;break e;case mh:E=16,h=null;break e}throw Error(sr(130,i==null?i:typeof i,""))}return t=ll(E,a,t,g),t.elementType=i,t.type=h,t.lanes=v,t}function gf(i,t,a,h){return i=ll(7,i,h,t),i.lanes=a,i}function Iw(i,t,a,h){return i=ll(22,i,h,t),i.elementType=_D,i.lanes=a,i.stateNode={isHidden:!1},i}function SS(i,t,a){return i=ll(6,i,null,t),i.lanes=a,i}function ES(i,t,a){return t=ll(4,i.children!==null?i.children:[],i.key,t),t.lanes=a,t.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},t}function RU(i,t,a,h,g){this.tag=t,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sS(0),this.expirationTimes=sS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sS(0),this.identifierPrefix=h,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function uI(i,t,a,h,g,v,E,o,O){return i=new RU(i,t,a,o,O),t===1?(t=1,v===!0&&(t|=8)):t=0,v=ll(3,null,null,t),i.current=v,v.stateNode=i,v.memoizedState={element:h,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},W2(v),i}function kU(i,t,a){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cm,key:h==null?null:""+h,children:i,containerInfo:t,implementation:a}}function lz(i){if(!i)return jh;i=i._reactInternals;e:{if(Ef(i)!==i||i.tag!==1)throw Error(sr(170));var t=i;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ea(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(sr(171))}if(i.tag===1){var a=i.type;if(Ea(a))return lL(i,a,t)}return t}function cz(i,t,a,h,g,v,E,o,O){return i=uI(a,h,!0,i,g,v,E,o,O),i.context=lz(null),a=i.current,h=ia(),g=zh(a),v=uu(h,g),v.callback=t??null,Dh(a,v,g),i.current.lanes=g,x0(i,g,h),Ia(i,h),i}function Aw(i,t,a,h){var g=t.current,v=ia(),E=zh(g);return a=lz(a),t.context===null?t.context=a:t.pendingContext=a,t=uu(v,E),t.payload={element:i},h=h===void 0?null:h,h!==null&&(t.callback=h),i=Dh(g,t,E),i!==null&&(ql(i,g,E,v),o1(i,g,E)),E}function H1(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function eM(i,t){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var a=i.retryLane;i.retryLane=a!==0&&a<t?a:t}}function hI(i,t){eM(i,t),(i=i.alternate)&&eM(i,t)}function MU(){return null}var uz=typeof reportError=="function"?reportError:function(i){console.error(i)};function dI(i){this._internalRoot=i}Cw.prototype.render=dI.prototype.render=function(i){var t=this._internalRoot;if(t===null)throw Error(sr(409));Aw(i,t,null,null)};Cw.prototype.unmount=dI.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var t=i.containerInfo;wf(function(){Aw(null,i,null,null)}),t[du]=null}};function Cw(i){this._internalRoot=i}Cw.prototype.unstable_scheduleHydration=function(i){if(i){var t=VD();i={blockedOn:null,target:i,priority:t};for(var a=0;a<yh.length&&t!==0&&t<yh[a].priority;a++);yh.splice(a,0,i),a===0&&$D(i)}};function fI(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Pw(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function tM(){}function OU(i,t,a,h,g){if(g){if(typeof h=="function"){var v=h;h=function(){var F=H1(E);v.call(F)}}var E=cz(t,h,i,0,null,!1,!1,"",tM);return i._reactRootContainer=E,i[du]=E.current,Jy(i.nodeType===8?i.parentNode:i),wf(),E}for(;g=i.lastChild;)i.removeChild(g);if(typeof h=="function"){var o=h;h=function(){var F=H1(O);o.call(F)}}var O=uI(i,0,!1,null,null,!1,!1,"",tM);return i._reactRootContainer=O,i[du]=O.current,Jy(i.nodeType===8?i.parentNode:i),wf(function(){Aw(t,O,a,h)}),O}function Rw(i,t,a,h,g){var v=a._reactRootContainer;if(v){var E=v;if(typeof g=="function"){var o=g;g=function(){var O=H1(E);o.call(O)}}Aw(t,E,i,g)}else E=OU(a,t,i,g,h);return H1(E)}ND=function(i){switch(i.tag){case 3:var t=i.stateNode;if(t.current.memoizedState.isDehydrated){var a=Ey(t.pendingLanes);a!==0&&(M2(t,a|1),Ia(t,Cs()),!(yn&6)&&(Hm=Cs()+500,Xh()))}break;case 13:wf(function(){var h=fu(i,1);if(h!==null){var g=ia();ql(h,i,1,g)}}),hI(i,1)}};O2=function(i){if(i.tag===13){var t=fu(i,134217728);if(t!==null){var a=ia();ql(t,i,134217728,a)}hI(i,134217728)}};jD=function(i){if(i.tag===13){var t=zh(i),a=fu(i,t);if(a!==null){var h=ia();ql(a,i,t,h)}hI(i,t)}};VD=function(){return zn};UD=function(i,t){var a=zn;try{return zn=i,t()}finally{zn=a}};sE=function(i,t,a){switch(t){case"input":if(JS(i,a),t=a.name,a.type==="radio"&&t!=null){for(a=i;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<a.length;t++){var h=a[t];if(h!==i&&h.form===i.form){var g=xw(h);if(!g)throw Error(sr(90));vD(h),JS(h,g)}}}break;case"textarea":wD(i,a);break;case"select":t=a.value,t!=null&&wm(i,!!a.multiple,t,!1)}};CD=oI;PD=wf;var DU={usingClientEntryPoint:!1,Events:[b0,pm,xw,ID,AD,oI]},yy={findFiberByHostInstance:nf,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},LU={bundleType:yy.bundleType,version:yy.version,rendererPackageName:yy.rendererPackageName,rendererConfig:yy.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yu.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=MD(i),i===null?null:i.stateNode},findFiberByHostInstance:yy.findFiberByHostInstance||MU,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bx.isDisabled&&Bx.supportsFiber)try{gw=Bx.inject(LU),Sc=Bx}catch{}}Xa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DU;Xa.createPortal=function(i,t){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fI(t))throw Error(sr(200));return kU(i,t,null,a)};Xa.createRoot=function(i,t){if(!fI(i))throw Error(sr(299));var a=!1,h="",g=uz;return t!=null&&(t.unstable_strictMode===!0&&(a=!0),t.identifierPrefix!==void 0&&(h=t.identifierPrefix),t.onRecoverableError!==void 0&&(g=t.onRecoverableError)),t=uI(i,1,!1,null,null,a,!1,h,g),i[du]=t.current,Jy(i.nodeType===8?i.parentNode:i),new dI(t)};Xa.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var t=i._reactInternals;if(t===void 0)throw typeof i.render=="function"?Error(sr(188)):(i=Object.keys(i).join(","),Error(sr(268,i)));return i=MD(t),i=i===null?null:i.stateNode,i};Xa.flushSync=function(i){return wf(i)};Xa.hydrate=function(i,t,a){if(!Pw(t))throw Error(sr(200));return Rw(null,i,t,!0,a)};Xa.hydrateRoot=function(i,t,a){if(!fI(i))throw Error(sr(405));var h=a!=null&&a.hydratedSources||null,g=!1,v="",E=uz;if(a!=null&&(a.unstable_strictMode===!0&&(g=!0),a.identifierPrefix!==void 0&&(v=a.identifierPrefix),a.onRecoverableError!==void 0&&(E=a.onRecoverableError)),t=cz(t,null,i,1,a??null,g,!1,v,E),i[du]=t.current,Jy(i),h)for(i=0;i<h.length;i++)a=h[i],g=a._getVersion,g=g(a._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[a,g]:t.mutableSourceEagerHydrationData.push(a,g);return new Cw(t)};Xa.render=function(i,t,a){if(!Pw(t))throw Error(sr(200));return Rw(null,i,t,!1,a)};Xa.unmountComponentAtNode=function(i){if(!Pw(i))throw Error(sr(40));return i._reactRootContainer?(wf(function(){Rw(null,null,i,!1,function(){i._reactRootContainer=null,i[du]=null})}),!0):!1};Xa.unstable_batchedUpdates=oI;Xa.unstable_renderSubtreeIntoContainer=function(i,t,a,h){if(!Pw(a))throw Error(sr(200));if(i==null||i._reactInternals===void 0)throw Error(sr(38));return Rw(i,t,a,!1,h)};Xa.version="18.3.1-next-f1338f8080-20240426";function hz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hz)}catch(i){console.error(i)}}hz(),hD.exports=Xa;var S0=hD.exports;const dz=v2(S0);var fz,rM=S0;fz=rM.createRoot,rM.hydrateRoot;const zU=1,FU=1e6;let IS=0;function BU(){return IS=(IS+1)%Number.MAX_SAFE_INTEGER,IS.toString()}const AS=new Map,iM=i=>{if(AS.has(i))return;const t=setTimeout(()=>{AS.delete(i),By({type:"REMOVE_TOAST",toastId:i})},FU);AS.set(i,t)},NU=(i,t)=>{switch(t.type){case"ADD_TOAST":return{...i,toasts:[t.toast,...i.toasts].slice(0,zU)};case"UPDATE_TOAST":return{...i,toasts:i.toasts.map(a=>a.id===t.toast.id?{...a,...t.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=t;return a?iM(a):i.toasts.forEach(h=>{iM(h.id)}),{...i,toasts:i.toasts.map(h=>h.id===a||a===void 0?{...h,open:!1}:h)}}case"REMOVE_TOAST":return t.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(a=>a.id!==t.toastId)}}},f1=[];let p1={toasts:[]};function By(i){p1=NU(p1,i),f1.forEach(t=>{t(p1)})}function jU({...i}){const t=BU(),a=g=>By({type:"UPDATE_TOAST",toast:{...g,id:t}}),h=()=>By({type:"DISMISS_TOAST",toastId:t});return By({type:"ADD_TOAST",toast:{...i,id:t,open:!0,onOpenChange:g=>{g||h()}}}),{id:t,dismiss:h,update:a}}function pz(){const[i,t]=ke.useState(p1);return ke.useEffect(()=>(f1.push(t),()=>{const a=f1.indexOf(t);a>-1&&f1.splice(a,1)}),[i]),{...i,toast:jU,dismiss:a=>By({type:"DISMISS_TOAST",toastId:a})}}function Ks(i,t,{checkForDefaultPrevented:a=!0}={}){return function(g){if(i==null||i(g),a===!1||!g.defaultPrevented)return t==null?void 0:t(g)}}function nM(i,t){if(typeof i=="function")return i(t);i!=null&&(i.current=t)}function mz(...i){return t=>{let a=!1;const h=i.map(g=>{const v=nM(g,t);return!a&&typeof v=="function"&&(a=!0),v});if(a)return()=>{for(let g=0;g<h.length;g++){const v=h[g];typeof v=="function"?v():nM(i[g],null)}}}}function Zl(...i){return ke.useCallback(mz(...i),i)}function kw(i,t=[]){let a=[];function h(v,E){const o=ke.createContext(E),O=a.length;a=[...a,E];const F=Q=>{var fe;const{scope:te,children:J,...we}=Q,se=((fe=te==null?void 0:te[i])==null?void 0:fe[O])||o,me=ke.useMemo(()=>we,Object.values(we));return ye.jsx(se.Provider,{value:me,children:J})};F.displayName=v+"Provider";function $(Q,te){var se;const J=((se=te==null?void 0:te[i])==null?void 0:se[O])||o,we=ke.useContext(J);if(we)return we;if(E!==void 0)return E;throw new Error(`\`${Q}\` must be used within \`${v}\``)}return[F,$]}const g=()=>{const v=a.map(E=>ke.createContext(E));return function(o){const O=(o==null?void 0:o[i])||v;return ke.useMemo(()=>({[`__scope${i}`]:{...o,[i]:O}}),[o,O])}};return g.scopeName=i,[h,VU(g,...t)]}function VU(...i){const t=i[0];if(i.length===1)return t;const a=()=>{const h=i.map(g=>({useScope:g(),scopeName:g.scopeName}));return function(v){const E=h.reduce((o,{useScope:O,scopeName:F})=>{const Q=O(v)[`__scope${F}`];return{...o,...Q}},{});return ke.useMemo(()=>({[`__scope${t.scopeName}`]:E}),[E])}};return a.scopeName=t.scopeName,a}function q1(i){const t=UU(i),a=ke.forwardRef((h,g)=>{const{children:v,...E}=h,o=ke.Children.toArray(v),O=o.find(GU);if(O){const F=O.props.children,$=o.map(Q=>Q===O?ke.Children.count(F)>1?ke.Children.only(null):ke.isValidElement(F)?F.props.children:null:Q);return ye.jsx(t,{...E,ref:g,children:ke.isValidElement(F)?ke.cloneElement(F,void 0,$):null})}return ye.jsx(t,{...E,ref:g,children:v})});return a.displayName=`${i}.Slot`,a}var gz=q1("Slot");function UU(i){const t=ke.forwardRef((a,h)=>{const{children:g,...v}=a;if(ke.isValidElement(g)){const E=qU(g),o=HU(v,g.props);return g.type!==ke.Fragment&&(o.ref=h?mz(h,E):E),ke.cloneElement(g,o)}return ke.Children.count(g)>1?ke.Children.only(null):null});return t.displayName=`${i}.SlotClone`,t}var _z=Symbol("radix.slottable");function $U(i){const t=({children:a})=>ye.jsx(ye.Fragment,{children:a});return t.displayName=`${i}.Slottable`,t.__radixId=_z,t}function GU(i){return ke.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===_z}function HU(i,t){const a={...t};for(const h in t){const g=i[h],v=t[h];/^on[A-Z]/.test(h)?g&&v?a[h]=(...o)=>{const O=v(...o);return g(...o),O}:g&&(a[h]=g):h==="style"?a[h]={...g,...v}:h==="className"&&(a[h]=[g,v].filter(Boolean).join(" "))}return{...i,...a}}function qU(i){var h,g;let t=(h=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:h.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?i.ref:(t=(g=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:g.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}function WU(i){const t=i+"CollectionProvider",[a,h]=kw(t),[g,v]=a(t,{collectionRef:{current:null},itemMap:new Map}),E=se=>{const{scope:me,children:fe}=se,re=Ft.useRef(null),de=Ft.useRef(new Map).current;return ye.jsx(g,{scope:me,itemMap:de,collectionRef:re,children:fe})};E.displayName=t;const o=i+"CollectionSlot",O=q1(o),F=Ft.forwardRef((se,me)=>{const{scope:fe,children:re}=se,de=v(o,fe),Oe=Zl(me,de.collectionRef);return ye.jsx(O,{ref:Oe,children:re})});F.displayName=o;const $=i+"CollectionItemSlot",Q="data-radix-collection-item",te=q1($),J=Ft.forwardRef((se,me)=>{const{scope:fe,children:re,...de}=se,Oe=Ft.useRef(null),Xe=Zl(me,Oe),qe=v($,fe);return Ft.useEffect(()=>(qe.itemMap.set(Oe,{ref:Oe,...de}),()=>void qe.itemMap.delete(Oe))),ye.jsx(te,{[Q]:"",ref:Xe,children:re})});J.displayName=$;function we(se){const me=v(i+"CollectionConsumer",se);return Ft.useCallback(()=>{const re=me.collectionRef.current;if(!re)return[];const de=Array.from(re.querySelectorAll(`[${Q}]`));return Array.from(me.itemMap.values()).sort((qe,Be)=>de.indexOf(qe.ref.current)-de.indexOf(Be.ref.current))},[me.collectionRef,me.itemMap])}return[{Provider:E,Slot:F,ItemSlot:J},we,h]}var ZU=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],oa=ZU.reduce((i,t)=>{const a=q1(`Primitive.${t}`),h=ke.forwardRef((g,v)=>{const{asChild:E,...o}=g,O=E?a:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),ye.jsx(O,{...o,ref:v})});return h.displayName=`Primitive.${t}`,{...i,[t]:h}},{});function yz(i,t){i&&S0.flushSync(()=>i.dispatchEvent(t))}function Vh(i){const t=ke.useRef(i);return ke.useEffect(()=>{t.current=i}),ke.useMemo(()=>(...a)=>{var h;return(h=t.current)==null?void 0:h.call(t,...a)},[])}function XU(i,t=globalThis==null?void 0:globalThis.document){const a=Vh(i);ke.useEffect(()=>{const h=g=>{g.key==="Escape"&&a(g)};return t.addEventListener("keydown",h,{capture:!0}),()=>t.removeEventListener("keydown",h,{capture:!0})},[a,t])}var KU="DismissableLayer",BE="dismissableLayer.update",YU="dismissableLayer.pointerDownOutside",JU="dismissableLayer.focusOutside",sM,vz=ke.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),pI=ke.forwardRef((i,t)=>{const{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:h,onPointerDownOutside:g,onFocusOutside:v,onInteractOutside:E,onDismiss:o,...O}=i,F=ke.useContext(vz),[$,Q]=ke.useState(null),te=($==null?void 0:$.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,J]=ke.useState({}),we=Zl(t,Be=>Q(Be)),se=Array.from(F.layers),[me]=[...F.layersWithOutsidePointerEventsDisabled].slice(-1),fe=se.indexOf(me),re=$?se.indexOf($):-1,de=F.layersWithOutsidePointerEventsDisabled.size>0,Oe=re>=fe,Xe=e6(Be=>{const bt=Be.target,Bt=[...F.branches].some(Jt=>Jt.contains(bt));!Oe||Bt||(g==null||g(Be),E==null||E(Be),Be.defaultPrevented||o==null||o())},te),qe=t6(Be=>{const bt=Be.target;[...F.branches].some(Jt=>Jt.contains(bt))||(v==null||v(Be),E==null||E(Be),Be.defaultPrevented||o==null||o())},te);return XU(Be=>{re===F.layers.size-1&&(h==null||h(Be),!Be.defaultPrevented&&o&&(Be.preventDefault(),o()))},te),ke.useEffect(()=>{if($)return a&&(F.layersWithOutsidePointerEventsDisabled.size===0&&(sM=te.body.style.pointerEvents,te.body.style.pointerEvents="none"),F.layersWithOutsidePointerEventsDisabled.add($)),F.layers.add($),oM(),()=>{a&&F.layersWithOutsidePointerEventsDisabled.size===1&&(te.body.style.pointerEvents=sM)}},[$,te,a,F]),ke.useEffect(()=>()=>{$&&(F.layers.delete($),F.layersWithOutsidePointerEventsDisabled.delete($),oM())},[$,F]),ke.useEffect(()=>{const Be=()=>J({});return document.addEventListener(BE,Be),()=>document.removeEventListener(BE,Be)},[]),ye.jsx(oa.div,{...O,ref:we,style:{pointerEvents:de?Oe?"auto":"none":void 0,...i.style},onFocusCapture:Ks(i.onFocusCapture,qe.onFocusCapture),onBlurCapture:Ks(i.onBlurCapture,qe.onBlurCapture),onPointerDownCapture:Ks(i.onPointerDownCapture,Xe.onPointerDownCapture)})});pI.displayName=KU;var QU="DismissableLayerBranch",xz=ke.forwardRef((i,t)=>{const a=ke.useContext(vz),h=ke.useRef(null),g=Zl(t,h);return ke.useEffect(()=>{const v=h.current;if(v)return a.branches.add(v),()=>{a.branches.delete(v)}},[a.branches]),ye.jsx(oa.div,{...i,ref:g})});xz.displayName=QU;function e6(i,t=globalThis==null?void 0:globalThis.document){const a=Vh(i),h=ke.useRef(!1),g=ke.useRef(()=>{});return ke.useEffect(()=>{const v=o=>{if(o.target&&!h.current){let O=function(){wz(YU,a,F,{discrete:!0})};const F={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",g.current),g.current=O,t.addEventListener("click",g.current,{once:!0})):O()}else t.removeEventListener("click",g.current);h.current=!1},E=window.setTimeout(()=>{t.addEventListener("pointerdown",v)},0);return()=>{window.clearTimeout(E),t.removeEventListener("pointerdown",v),t.removeEventListener("click",g.current)}},[t,a]),{onPointerDownCapture:()=>h.current=!0}}function t6(i,t=globalThis==null?void 0:globalThis.document){const a=Vh(i),h=ke.useRef(!1);return ke.useEffect(()=>{const g=v=>{v.target&&!h.current&&wz(JU,a,{originalEvent:v},{discrete:!1})};return t.addEventListener("focusin",g),()=>t.removeEventListener("focusin",g)},[t,a]),{onFocusCapture:()=>h.current=!0,onBlurCapture:()=>h.current=!1}}function oM(){const i=new CustomEvent(BE);document.dispatchEvent(i)}function wz(i,t,a,{discrete:h}){const g=a.originalEvent.target,v=new CustomEvent(i,{bubbles:!1,cancelable:!0,detail:a});t&&g.addEventListener(i,t,{once:!0}),h?yz(g,v):g.dispatchEvent(v)}var r6=pI,i6=xz,Uh=globalThis!=null&&globalThis.document?ke.useLayoutEffect:()=>{},n6="Portal",bz=ke.forwardRef((i,t)=>{var o;const{container:a,...h}=i,[g,v]=ke.useState(!1);Uh(()=>v(!0),[]);const E=a||g&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return E?dz.createPortal(ye.jsx(oa.div,{...h,ref:t}),E):null});bz.displayName=n6;function s6(i,t){return ke.useReducer((a,h)=>t[a][h]??a,i)}var mI=i=>{const{present:t,children:a}=i,h=o6(t),g=typeof a=="function"?a({present:h.isPresent}):ke.Children.only(a),v=Zl(h.ref,a6(g));return typeof a=="function"||h.isPresent?ke.cloneElement(g,{ref:v}):null};mI.displayName="Presence";function o6(i){const[t,a]=ke.useState(),h=ke.useRef(null),g=ke.useRef(i),v=ke.useRef("none"),E=i?"mounted":"unmounted",[o,O]=s6(E,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return ke.useEffect(()=>{const F=Nx(h.current);v.current=o==="mounted"?F:"none"},[o]),Uh(()=>{const F=h.current,$=g.current;if($!==i){const te=v.current,J=Nx(F);i?O("MOUNT"):J==="none"||(F==null?void 0:F.display)==="none"?O("UNMOUNT"):O($&&te!==J?"ANIMATION_OUT":"UNMOUNT"),g.current=i}},[i,O]),Uh(()=>{if(t){let F;const $=t.ownerDocument.defaultView??window,Q=J=>{const se=Nx(h.current).includes(J.animationName);if(J.target===t&&se&&(O("ANIMATION_END"),!g.current)){const me=t.style.animationFillMode;t.style.animationFillMode="forwards",F=$.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=me)})}},te=J=>{J.target===t&&(v.current=Nx(h.current))};return t.addEventListener("animationstart",te),t.addEventListener("animationcancel",Q),t.addEventListener("animationend",Q),()=>{$.clearTimeout(F),t.removeEventListener("animationstart",te),t.removeEventListener("animationcancel",Q),t.removeEventListener("animationend",Q)}}else O("ANIMATION_END")},[t,O]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:ke.useCallback(F=>{h.current=F?getComputedStyle(F):null,a(F)},[])}}function Nx(i){return(i==null?void 0:i.animationName)||"none"}function a6(i){var h,g;let t=(h=Object.getOwnPropertyDescriptor(i.props,"ref"))==null?void 0:h.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?i.ref:(t=(g=Object.getOwnPropertyDescriptor(i,"ref"))==null?void 0:g.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?i.props.ref:i.props.ref||i.ref)}var l6=cD[" useInsertionEffect ".trim().toString()]||Uh;function c6({prop:i,defaultProp:t,onChange:a=()=>{},caller:h}){const[g,v,E]=u6({defaultProp:t,onChange:a}),o=i!==void 0,O=o?i:g;{const $=ke.useRef(i!==void 0);ke.useEffect(()=>{const Q=$.current;Q!==o&&console.warn(`${h} is changing from ${Q?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),$.current=o},[o,h])}const F=ke.useCallback($=>{var Q;if(o){const te=h6($)?$(i):$;te!==i&&((Q=E.current)==null||Q.call(E,te))}else v($)},[o,i,v,E]);return[O,F]}function u6({defaultProp:i,onChange:t}){const[a,h]=ke.useState(i),g=ke.useRef(a),v=ke.useRef(t);return l6(()=>{v.current=t},[t]),ke.useEffect(()=>{var E;g.current!==a&&((E=v.current)==null||E.call(v,a),g.current=a)},[a,g]),[a,h,v]}function h6(i){return typeof i=="function"}var d6=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),f6="VisuallyHidden",Mw=ke.forwardRef((i,t)=>ye.jsx(oa.span,{...i,ref:t,style:{...d6,...i.style}}));Mw.displayName=f6;var p6=Mw,gI="ToastProvider",[_I,m6,g6]=WU("Toast"),[Tz,gZ]=kw("Toast",[g6]),[_6,Ow]=Tz(gI),Sz=i=>{const{__scopeToast:t,label:a="Notification",duration:h=5e3,swipeDirection:g="right",swipeThreshold:v=50,children:E}=i,[o,O]=ke.useState(null),[F,$]=ke.useState(0),Q=ke.useRef(!1),te=ke.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${gI}\`. Expected non-empty \`string\`.`),ye.jsx(_I.Provider,{scope:t,children:ye.jsx(_6,{scope:t,label:a,duration:h,swipeDirection:g,swipeThreshold:v,toastCount:F,viewport:o,onViewportChange:O,onToastAdd:ke.useCallback(()=>$(J=>J+1),[]),onToastRemove:ke.useCallback(()=>$(J=>J-1),[]),isFocusedToastEscapeKeyDownRef:Q,isClosePausedRef:te,children:E})})};Sz.displayName=gI;var Ez="ToastViewport",y6=["F8"],NE="toast.viewportPause",jE="toast.viewportResume",Iz=ke.forwardRef((i,t)=>{const{__scopeToast:a,hotkey:h=y6,label:g="Notifications ({hotkey})",...v}=i,E=Ow(Ez,a),o=m6(a),O=ke.useRef(null),F=ke.useRef(null),$=ke.useRef(null),Q=ke.useRef(null),te=Zl(t,Q,E.onViewportChange),J=h.join("+").replace(/Key/g,"").replace(/Digit/g,""),we=E.toastCount>0;ke.useEffect(()=>{const me=fe=>{var de;h.length!==0&&h.every(Oe=>fe[Oe]||fe.code===Oe)&&((de=Q.current)==null||de.focus())};return document.addEventListener("keydown",me),()=>document.removeEventListener("keydown",me)},[h]),ke.useEffect(()=>{const me=O.current,fe=Q.current;if(we&&me&&fe){const re=()=>{if(!E.isClosePausedRef.current){const qe=new CustomEvent(NE);fe.dispatchEvent(qe),E.isClosePausedRef.current=!0}},de=()=>{if(E.isClosePausedRef.current){const qe=new CustomEvent(jE);fe.dispatchEvent(qe),E.isClosePausedRef.current=!1}},Oe=qe=>{!me.contains(qe.relatedTarget)&&de()},Xe=()=>{me.contains(document.activeElement)||de()};return me.addEventListener("focusin",re),me.addEventListener("focusout",Oe),me.addEventListener("pointermove",re),me.addEventListener("pointerleave",Xe),window.addEventListener("blur",re),window.addEventListener("focus",de),()=>{me.removeEventListener("focusin",re),me.removeEventListener("focusout",Oe),me.removeEventListener("pointermove",re),me.removeEventListener("pointerleave",Xe),window.removeEventListener("blur",re),window.removeEventListener("focus",de)}}},[we,E.isClosePausedRef]);const se=ke.useCallback(({tabbingDirection:me})=>{const re=o().map(de=>{const Oe=de.ref.current,Xe=[Oe,...k6(Oe)];return me==="forwards"?Xe:Xe.reverse()});return(me==="forwards"?re.reverse():re).flat()},[o]);return ke.useEffect(()=>{const me=Q.current;if(me){const fe=re=>{var Xe,qe,Be;const de=re.altKey||re.ctrlKey||re.metaKey;if(re.key==="Tab"&&!de){const bt=document.activeElement,Bt=re.shiftKey;if(re.target===me&&Bt){(Xe=F.current)==null||Xe.focus();return}const Gt=se({tabbingDirection:Bt?"backwards":"forwards"}),Mt=Gt.findIndex(Zt=>Zt===bt);CS(Gt.slice(Mt+1))?re.preventDefault():Bt?(qe=F.current)==null||qe.focus():(Be=$.current)==null||Be.focus()}};return me.addEventListener("keydown",fe),()=>me.removeEventListener("keydown",fe)}},[o,se]),ye.jsxs(i6,{ref:O,role:"region","aria-label":g.replace("{hotkey}",J),tabIndex:-1,style:{pointerEvents:we?void 0:"none"},children:[we&&ye.jsx(VE,{ref:F,onFocusFromOutsideViewport:()=>{const me=se({tabbingDirection:"forwards"});CS(me)}}),ye.jsx(_I.Slot,{scope:a,children:ye.jsx(oa.ol,{tabIndex:-1,...v,ref:te})}),we&&ye.jsx(VE,{ref:$,onFocusFromOutsideViewport:()=>{const me=se({tabbingDirection:"backwards"});CS(me)}})]})});Iz.displayName=Ez;var Az="ToastFocusProxy",VE=ke.forwardRef((i,t)=>{const{__scopeToast:a,onFocusFromOutsideViewport:h,...g}=i,v=Ow(Az,a);return ye.jsx(Mw,{"aria-hidden":!0,tabIndex:0,...g,ref:t,style:{position:"fixed"},onFocus:E=>{var F;const o=E.relatedTarget;!((F=v.viewport)!=null&&F.contains(o))&&h()}})});VE.displayName=Az;var E0="Toast",v6="toast.swipeStart",x6="toast.swipeMove",w6="toast.swipeCancel",b6="toast.swipeEnd",Cz=ke.forwardRef((i,t)=>{const{forceMount:a,open:h,defaultOpen:g,onOpenChange:v,...E}=i,[o,O]=c6({prop:h,defaultProp:g??!0,onChange:v,caller:E0});return ye.jsx(mI,{present:a||o,children:ye.jsx(E6,{open:o,...E,ref:t,onClose:()=>O(!1),onPause:Vh(i.onPause),onResume:Vh(i.onResume),onSwipeStart:Ks(i.onSwipeStart,F=>{F.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ks(i.onSwipeMove,F=>{const{x:$,y:Q}=F.detail.delta;F.currentTarget.setAttribute("data-swipe","move"),F.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${$}px`),F.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${Q}px`)}),onSwipeCancel:Ks(i.onSwipeCancel,F=>{F.currentTarget.setAttribute("data-swipe","cancel"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),F.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ks(i.onSwipeEnd,F=>{const{x:$,y:Q}=F.detail.delta;F.currentTarget.setAttribute("data-swipe","end"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),F.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),F.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${$}px`),F.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${Q}px`),O(!1)})})})});Cz.displayName=E0;var[T6,S6]=Tz(E0,{onClose(){}}),E6=ke.forwardRef((i,t)=>{const{__scopeToast:a,type:h="foreground",duration:g,open:v,onClose:E,onEscapeKeyDown:o,onPause:O,onResume:F,onSwipeStart:$,onSwipeMove:Q,onSwipeCancel:te,onSwipeEnd:J,...we}=i,se=Ow(E0,a),[me,fe]=ke.useState(null),re=Zl(t,Zt=>fe(Zt)),de=ke.useRef(null),Oe=ke.useRef(null),Xe=g||se.duration,qe=ke.useRef(0),Be=ke.useRef(Xe),bt=ke.useRef(0),{onToastAdd:Bt,onToastRemove:Jt}=se,nr=Vh(()=>{var mr;(me==null?void 0:me.contains(document.activeElement))&&((mr=se.viewport)==null||mr.focus()),E()}),Gt=ke.useCallback(Zt=>{!Zt||Zt===1/0||(window.clearTimeout(bt.current),qe.current=new Date().getTime(),bt.current=window.setTimeout(nr,Zt))},[nr]);ke.useEffect(()=>{const Zt=se.viewport;if(Zt){const mr=()=>{Gt(Be.current),F==null||F()},Qt=()=>{const er=new Date().getTime()-qe.current;Be.current=Be.current-er,window.clearTimeout(bt.current),O==null||O()};return Zt.addEventListener(NE,Qt),Zt.addEventListener(jE,mr),()=>{Zt.removeEventListener(NE,Qt),Zt.removeEventListener(jE,mr)}}},[se.viewport,Xe,O,F,Gt]),ke.useEffect(()=>{v&&!se.isClosePausedRef.current&&Gt(Xe)},[v,Xe,se.isClosePausedRef,Gt]),ke.useEffect(()=>(Bt(),()=>Jt()),[Bt,Jt]);const Mt=ke.useMemo(()=>me?Lz(me):null,[me]);return se.viewport?ye.jsxs(ye.Fragment,{children:[Mt&&ye.jsx(I6,{__scopeToast:a,role:"status","aria-live":h==="foreground"?"assertive":"polite","aria-atomic":!0,children:Mt}),ye.jsx(T6,{scope:a,onClose:nr,children:S0.createPortal(ye.jsx(_I.ItemSlot,{scope:a,children:ye.jsx(r6,{asChild:!0,onEscapeKeyDown:Ks(o,()=>{se.isFocusedToastEscapeKeyDownRef.current||nr(),se.isFocusedToastEscapeKeyDownRef.current=!1}),children:ye.jsx(oa.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":v?"open":"closed","data-swipe-direction":se.swipeDirection,...we,ref:re,style:{userSelect:"none",touchAction:"none",...i.style},onKeyDown:Ks(i.onKeyDown,Zt=>{Zt.key==="Escape"&&(o==null||o(Zt.nativeEvent),Zt.nativeEvent.defaultPrevented||(se.isFocusedToastEscapeKeyDownRef.current=!0,nr()))}),onPointerDown:Ks(i.onPointerDown,Zt=>{Zt.button===0&&(de.current={x:Zt.clientX,y:Zt.clientY})}),onPointerMove:Ks(i.onPointerMove,Zt=>{if(!de.current)return;const mr=Zt.clientX-de.current.x,Qt=Zt.clientY-de.current.y,er=!!Oe.current,dt=["left","right"].includes(se.swipeDirection),It=["left","up"].includes(se.swipeDirection)?Math.min:Math.max,tr=dt?It(0,mr):0,Gr=dt?0:It(0,Qt),Rr=Zt.pointerType==="touch"?10:2,Sr={x:tr,y:Gr},ti={originalEvent:Zt,delta:Sr};er?(Oe.current=Sr,jx(x6,Q,ti,{discrete:!1})):aM(Sr,se.swipeDirection,Rr)?(Oe.current=Sr,jx(v6,$,ti,{discrete:!1}),Zt.target.setPointerCapture(Zt.pointerId)):(Math.abs(mr)>Rr||Math.abs(Qt)>Rr)&&(de.current=null)}),onPointerUp:Ks(i.onPointerUp,Zt=>{const mr=Oe.current,Qt=Zt.target;if(Qt.hasPointerCapture(Zt.pointerId)&&Qt.releasePointerCapture(Zt.pointerId),Oe.current=null,de.current=null,mr){const er=Zt.currentTarget,dt={originalEvent:Zt,delta:mr};aM(mr,se.swipeDirection,se.swipeThreshold)?jx(b6,J,dt,{discrete:!0}):jx(w6,te,dt,{discrete:!0}),er.addEventListener("click",It=>It.preventDefault(),{once:!0})}})})})}),se.viewport)})]}):null}),I6=i=>{const{__scopeToast:t,children:a,...h}=i,g=Ow(E0,t),[v,E]=ke.useState(!1),[o,O]=ke.useState(!1);return P6(()=>E(!0)),ke.useEffect(()=>{const F=window.setTimeout(()=>O(!0),1e3);return()=>window.clearTimeout(F)},[]),o?null:ye.jsx(bz,{asChild:!0,children:ye.jsx(Mw,{...h,children:v&&ye.jsxs(ye.Fragment,{children:[g.label," ",a]})})})},A6="ToastTitle",Pz=ke.forwardRef((i,t)=>{const{__scopeToast:a,...h}=i;return ye.jsx(oa.div,{...h,ref:t})});Pz.displayName=A6;var C6="ToastDescription",Rz=ke.forwardRef((i,t)=>{const{__scopeToast:a,...h}=i;return ye.jsx(oa.div,{...h,ref:t})});Rz.displayName=C6;var kz="ToastAction",Mz=ke.forwardRef((i,t)=>{const{altText:a,...h}=i;return a.trim()?ye.jsx(Dz,{altText:a,asChild:!0,children:ye.jsx(yI,{...h,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${kz}\`. Expected non-empty \`string\`.`),null)});Mz.displayName=kz;var Oz="ToastClose",yI=ke.forwardRef((i,t)=>{const{__scopeToast:a,...h}=i,g=S6(Oz,a);return ye.jsx(Dz,{asChild:!0,children:ye.jsx(oa.button,{type:"button",...h,ref:t,onClick:Ks(i.onClick,g.onClose)})})});yI.displayName=Oz;var Dz=ke.forwardRef((i,t)=>{const{__scopeToast:a,altText:h,...g}=i;return ye.jsx(oa.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":h||void 0,...g,ref:t})});function Lz(i){const t=[];return Array.from(i.childNodes).forEach(h=>{if(h.nodeType===h.TEXT_NODE&&h.textContent&&t.push(h.textContent),R6(h)){const g=h.ariaHidden||h.hidden||h.style.display==="none",v=h.dataset.radixToastAnnounceExclude==="";if(!g)if(v){const E=h.dataset.radixToastAnnounceAlt;E&&t.push(E)}else t.push(...Lz(h))}}),t}function jx(i,t,a,{discrete:h}){const g=a.originalEvent.currentTarget,v=new CustomEvent(i,{bubbles:!0,cancelable:!0,detail:a});t&&g.addEventListener(i,t,{once:!0}),h?yz(g,v):g.dispatchEvent(v)}var aM=(i,t,a=0)=>{const h=Math.abs(i.x),g=Math.abs(i.y),v=h>g;return t==="left"||t==="right"?v&&h>a:!v&&g>a};function P6(i=()=>{}){const t=Vh(i);Uh(()=>{let a=0,h=0;return a=window.requestAnimationFrame(()=>h=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(h)}},[t])}function R6(i){return i.nodeType===i.ELEMENT_NODE}function k6(i){const t=[],a=document.createTreeWalker(i,NodeFilter.SHOW_ELEMENT,{acceptNode:h=>{const g=h.tagName==="INPUT"&&h.type==="hidden";return h.disabled||h.hidden||g?NodeFilter.FILTER_SKIP:h.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)t.push(a.currentNode);return t}function CS(i){const t=document.activeElement;return i.some(a=>a===t?!0:(a.focus(),document.activeElement!==t))}var M6=Sz,zz=Iz,Fz=Cz,Bz=Pz,Nz=Rz,jz=Mz,Vz=yI;function Uz(i){var t,a,h="";if(typeof i=="string"||typeof i=="number")h+=i;else if(typeof i=="object")if(Array.isArray(i)){var g=i.length;for(t=0;t<g;t++)i[t]&&(a=Uz(i[t]))&&(h&&(h+=" "),h+=a)}else for(a in i)i[a]&&(h&&(h+=" "),h+=a);return h}function $z(){for(var i,t,a=0,h="",g=arguments.length;a<g;a++)(i=arguments[a])&&(t=Uz(i))&&(h&&(h+=" "),h+=t);return h}const lM=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,cM=$z,I0=(i,t)=>a=>{var h;if((t==null?void 0:t.variants)==null)return cM(i,a==null?void 0:a.class,a==null?void 0:a.className);const{variants:g,defaultVariants:v}=t,E=Object.keys(g).map(F=>{const $=a==null?void 0:a[F],Q=v==null?void 0:v[F];if($===null)return null;const te=lM($)||lM(Q);return g[F][te]}),o=a&&Object.entries(a).reduce((F,$)=>{let[Q,te]=$;return te===void 0||(F[Q]=te),F},{}),O=t==null||(h=t.compoundVariants)===null||h===void 0?void 0:h.reduce((F,$)=>{let{class:Q,className:te,...J}=$;return Object.entries(J).every(we=>{let[se,me]=we;return Array.isArray(me)?me.includes({...v,...o}[se]):{...v,...o}[se]===me})?[...F,Q,te]:F},[]);return cM(i,E,O,a==null?void 0:a.class,a==null?void 0:a.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O6=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Gz=(...i)=>i.filter((t,a,h)=>!!t&&t.trim()!==""&&h.indexOf(t)===a).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var D6={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L6=ke.forwardRef(({color:i="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:h,className:g="",children:v,iconNode:E,...o},O)=>ke.createElement("svg",{ref:O,...D6,width:t,height:t,stroke:i,strokeWidth:h?Number(a)*24/Number(t):a,className:Gz("lucide",g),...o},[...E.map(([F,$])=>ke.createElement(F,$)),...Array.isArray(v)?v:[v]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=(i,t)=>{const a=ke.forwardRef(({className:h,...g},v)=>ke.createElement(L6,{ref:v,iconNode:t,className:Gz(`lucide-${O6(i)}`,h),...g}));return a.displayName=`${i}`,a};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=Mn("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dw=Mn("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hz=Mn("Battery",[["rect",{width:"16",height:"10",x:"2",y:"7",rx:"2",ry:"2",key:"1w10f2"}],["line",{x1:"22",x2:"22",y1:"11",y2:"13",key:"4dh1rd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=Mn("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z6=Mn("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F6=Mn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B6=Mn("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N6=Mn("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j6=Mn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V6=Mn("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U6=Mn("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qz=Mn("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $6=Mn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G6=Mn("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H6=Mn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q6=Mn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W6=Mn("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z6=Mn("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=Mn("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X6=Mn("Radio",[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K6=Mn("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y6=Mn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J6=Mn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q6=Mn("Trees",[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16H5a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"1l6gj6"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e$=Mn("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t$=Mn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wz=Mn("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r$=Mn("Wind",[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i$=Mn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n$=Mn("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),vI="-",s$=i=>{const t=a$(i),{conflictingClassGroups:a,conflictingClassGroupModifiers:h}=i;return{getClassGroupId:E=>{const o=E.split(vI);return o[0]===""&&o.length!==1&&o.shift(),Zz(o,t)||o$(E)},getConflictingClassGroupIds:(E,o)=>{const O=a[E]||[];return o&&h[E]?[...O,...h[E]]:O}}},Zz=(i,t)=>{var E;if(i.length===0)return t.classGroupId;const a=i[0],h=t.nextPart.get(a),g=h?Zz(i.slice(1),h):void 0;if(g)return g;if(t.validators.length===0)return;const v=i.join(vI);return(E=t.validators.find(({validator:o})=>o(v)))==null?void 0:E.classGroupId},fM=/^\[(.+)\]$/,o$=i=>{if(fM.test(i)){const t=fM.exec(i)[1],a=t==null?void 0:t.substring(0,t.indexOf(":"));if(a)return"arbitrary.."+a}},a$=i=>{const{theme:t,prefix:a}=i,h={nextPart:new Map,validators:[]};return c$(Object.entries(i.classGroups),a).forEach(([v,E])=>{UE(E,h,v,t)}),h},UE=(i,t,a,h)=>{i.forEach(g=>{if(typeof g=="string"){const v=g===""?t:pM(t,g);v.classGroupId=a;return}if(typeof g=="function"){if(l$(g)){UE(g(h),t,a,h);return}t.validators.push({validator:g,classGroupId:a});return}Object.entries(g).forEach(([v,E])=>{UE(E,pM(t,v),a,h)})})},pM=(i,t)=>{let a=i;return t.split(vI).forEach(h=>{a.nextPart.has(h)||a.nextPart.set(h,{nextPart:new Map,validators:[]}),a=a.nextPart.get(h)}),a},l$=i=>i.isThemeGetter,c$=(i,t)=>t?i.map(([a,h])=>{const g=h.map(v=>typeof v=="string"?t+v:typeof v=="object"?Object.fromEntries(Object.entries(v).map(([E,o])=>[t+E,o])):v);return[a,g]}):i,u$=i=>{if(i<1)return{get:()=>{},set:()=>{}};let t=0,a=new Map,h=new Map;const g=(v,E)=>{a.set(v,E),t++,t>i&&(t=0,h=a,a=new Map)};return{get(v){let E=a.get(v);if(E!==void 0)return E;if((E=h.get(v))!==void 0)return g(v,E),E},set(v,E){a.has(v)?a.set(v,E):g(v,E)}}},Xz="!",h$=i=>{const{separator:t,experimentalParseClassName:a}=i,h=t.length===1,g=t[0],v=t.length,E=o=>{const O=[];let F=0,$=0,Q;for(let me=0;me<o.length;me++){let fe=o[me];if(F===0){if(fe===g&&(h||o.slice(me,me+v)===t)){O.push(o.slice($,me)),$=me+v;continue}if(fe==="/"){Q=me;continue}}fe==="["?F++:fe==="]"&&F--}const te=O.length===0?o:o.substring($),J=te.startsWith(Xz),we=J?te.substring(1):te,se=Q&&Q>$?Q-$:void 0;return{modifiers:O,hasImportantModifier:J,baseClassName:we,maybePostfixModifierPosition:se}};return a?o=>a({className:o,parseClassName:E}):E},d$=i=>{if(i.length<=1)return i;const t=[];let a=[];return i.forEach(h=>{h[0]==="["?(t.push(...a.sort(),h),a=[]):a.push(h)}),t.push(...a.sort()),t},f$=i=>({cache:u$(i.cacheSize),parseClassName:h$(i),...s$(i)}),p$=/\s+/,m$=(i,t)=>{const{parseClassName:a,getClassGroupId:h,getConflictingClassGroupIds:g}=t,v=[],E=i.trim().split(p$);let o="";for(let O=E.length-1;O>=0;O-=1){const F=E[O],{modifiers:$,hasImportantModifier:Q,baseClassName:te,maybePostfixModifierPosition:J}=a(F);let we=!!J,se=h(we?te.substring(0,J):te);if(!se){if(!we){o=F+(o.length>0?" "+o:o);continue}if(se=h(te),!se){o=F+(o.length>0?" "+o:o);continue}we=!1}const me=d$($).join(":"),fe=Q?me+Xz:me,re=fe+se;if(v.includes(re))continue;v.push(re);const de=g(se,we);for(let Oe=0;Oe<de.length;++Oe){const Xe=de[Oe];v.push(fe+Xe)}o=F+(o.length>0?" "+o:o)}return o};function g$(){let i=0,t,a,h="";for(;i<arguments.length;)(t=arguments[i++])&&(a=Kz(t))&&(h&&(h+=" "),h+=a);return h}const Kz=i=>{if(typeof i=="string")return i;let t,a="";for(let h=0;h<i.length;h++)i[h]&&(t=Kz(i[h]))&&(a&&(a+=" "),a+=t);return a};function _$(i,...t){let a,h,g,v=E;function E(O){const F=t.reduce(($,Q)=>Q($),i());return a=f$(F),h=a.cache.get,g=a.cache.set,v=o,o(O)}function o(O){const F=h(O);if(F)return F;const $=m$(O,a);return g(O,$),$}return function(){return v(g$.apply(null,arguments))}}const Xn=i=>{const t=a=>a[i]||[];return t.isThemeGetter=!0,t},Yz=/^\[(?:([a-z-]+):)?(.+)\]$/i,y$=/^\d+\/\d+$/,v$=new Set(["px","full","screen"]),x$=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,w$=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,b$=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,T$=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,S$=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,eu=i=>Am(i)||v$.has(i)||y$.test(i),hh=i=>rg(i,"length",M$),Am=i=>!!i&&!Number.isNaN(Number(i)),PS=i=>rg(i,"number",Am),vy=i=>!!i&&Number.isInteger(Number(i)),E$=i=>i.endsWith("%")&&Am(i.slice(0,-1)),ji=i=>Yz.test(i),dh=i=>x$.test(i),I$=new Set(["length","size","percentage"]),A$=i=>rg(i,I$,Jz),C$=i=>rg(i,"position",Jz),P$=new Set(["image","url"]),R$=i=>rg(i,P$,D$),k$=i=>rg(i,"",O$),xy=()=>!0,rg=(i,t,a)=>{const h=Yz.exec(i);return h?h[1]?typeof t=="string"?h[1]===t:t.has(h[1]):a(h[2]):!1},M$=i=>w$.test(i)&&!b$.test(i),Jz=()=>!1,O$=i=>T$.test(i),D$=i=>S$.test(i),L$=()=>{const i=Xn("colors"),t=Xn("spacing"),a=Xn("blur"),h=Xn("brightness"),g=Xn("borderColor"),v=Xn("borderRadius"),E=Xn("borderSpacing"),o=Xn("borderWidth"),O=Xn("contrast"),F=Xn("grayscale"),$=Xn("hueRotate"),Q=Xn("invert"),te=Xn("gap"),J=Xn("gradientColorStops"),we=Xn("gradientColorStopPositions"),se=Xn("inset"),me=Xn("margin"),fe=Xn("opacity"),re=Xn("padding"),de=Xn("saturate"),Oe=Xn("scale"),Xe=Xn("sepia"),qe=Xn("skew"),Be=Xn("space"),bt=Xn("translate"),Bt=()=>["auto","contain","none"],Jt=()=>["auto","hidden","clip","visible","scroll"],nr=()=>["auto",ji,t],Gt=()=>[ji,t],Mt=()=>["",eu,hh],Zt=()=>["auto",Am,ji],mr=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Qt=()=>["solid","dashed","dotted","double","none"],er=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],dt=()=>["start","end","center","between","around","evenly","stretch"],It=()=>["","0",ji],tr=()=>["auto","avoid","all","avoid-page","page","left","right","column"],Gr=()=>[Am,ji];return{cacheSize:500,separator:":",theme:{colors:[xy],spacing:[eu,hh],blur:["none","",dh,ji],brightness:Gr(),borderColor:[i],borderRadius:["none","","full",dh,ji],borderSpacing:Gt(),borderWidth:Mt(),contrast:Gr(),grayscale:It(),hueRotate:Gr(),invert:It(),gap:Gt(),gradientColorStops:[i],gradientColorStopPositions:[E$,hh],inset:nr(),margin:nr(),opacity:Gr(),padding:Gt(),saturate:Gr(),scale:Gr(),sepia:It(),skew:Gr(),space:Gt(),translate:Gt()},classGroups:{aspect:[{aspect:["auto","square","video",ji]}],container:["container"],columns:[{columns:[dh]}],"break-after":[{"break-after":tr()}],"break-before":[{"break-before":tr()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...mr(),ji]}],overflow:[{overflow:Jt()}],"overflow-x":[{"overflow-x":Jt()}],"overflow-y":[{"overflow-y":Jt()}],overscroll:[{overscroll:Bt()}],"overscroll-x":[{"overscroll-x":Bt()}],"overscroll-y":[{"overscroll-y":Bt()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[se]}],"inset-x":[{"inset-x":[se]}],"inset-y":[{"inset-y":[se]}],start:[{start:[se]}],end:[{end:[se]}],top:[{top:[se]}],right:[{right:[se]}],bottom:[{bottom:[se]}],left:[{left:[se]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",vy,ji]}],basis:[{basis:nr()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ji]}],grow:[{grow:It()}],shrink:[{shrink:It()}],order:[{order:["first","last","none",vy,ji]}],"grid-cols":[{"grid-cols":[xy]}],"col-start-end":[{col:["auto",{span:["full",vy,ji]},ji]}],"col-start":[{"col-start":Zt()}],"col-end":[{"col-end":Zt()}],"grid-rows":[{"grid-rows":[xy]}],"row-start-end":[{row:["auto",{span:[vy,ji]},ji]}],"row-start":[{"row-start":Zt()}],"row-end":[{"row-end":Zt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ji]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ji]}],gap:[{gap:[te]}],"gap-x":[{"gap-x":[te]}],"gap-y":[{"gap-y":[te]}],"justify-content":[{justify:["normal",...dt()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...dt(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...dt(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[re]}],px:[{px:[re]}],py:[{py:[re]}],ps:[{ps:[re]}],pe:[{pe:[re]}],pt:[{pt:[re]}],pr:[{pr:[re]}],pb:[{pb:[re]}],pl:[{pl:[re]}],m:[{m:[me]}],mx:[{mx:[me]}],my:[{my:[me]}],ms:[{ms:[me]}],me:[{me:[me]}],mt:[{mt:[me]}],mr:[{mr:[me]}],mb:[{mb:[me]}],ml:[{ml:[me]}],"space-x":[{"space-x":[Be]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Be]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ji,t]}],"min-w":[{"min-w":[ji,t,"min","max","fit"]}],"max-w":[{"max-w":[ji,t,"none","full","min","max","fit","prose",{screen:[dh]},dh]}],h:[{h:[ji,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ji,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ji,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ji,t,"auto","min","max","fit"]}],"font-size":[{text:["base",dh,hh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",PS]}],"font-family":[{font:[xy]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ji]}],"line-clamp":[{"line-clamp":["none",Am,PS]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",eu,ji]}],"list-image":[{"list-image":["none",ji]}],"list-style-type":[{list:["none","disc","decimal",ji]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[fe]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[fe]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Qt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",eu,hh]}],"underline-offset":[{"underline-offset":["auto",eu,ji]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Gt()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ji]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ji]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[fe]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...mr(),C$]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",A$]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},R$]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[we]}],"gradient-via-pos":[{via:[we]}],"gradient-to-pos":[{to:[we]}],"gradient-from":[{from:[J]}],"gradient-via":[{via:[J]}],"gradient-to":[{to:[J]}],rounded:[{rounded:[v]}],"rounded-s":[{"rounded-s":[v]}],"rounded-e":[{"rounded-e":[v]}],"rounded-t":[{"rounded-t":[v]}],"rounded-r":[{"rounded-r":[v]}],"rounded-b":[{"rounded-b":[v]}],"rounded-l":[{"rounded-l":[v]}],"rounded-ss":[{"rounded-ss":[v]}],"rounded-se":[{"rounded-se":[v]}],"rounded-ee":[{"rounded-ee":[v]}],"rounded-es":[{"rounded-es":[v]}],"rounded-tl":[{"rounded-tl":[v]}],"rounded-tr":[{"rounded-tr":[v]}],"rounded-br":[{"rounded-br":[v]}],"rounded-bl":[{"rounded-bl":[v]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[fe]}],"border-style":[{border:[...Qt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[fe]}],"divide-style":[{divide:Qt()}],"border-color":[{border:[g]}],"border-color-x":[{"border-x":[g]}],"border-color-y":[{"border-y":[g]}],"border-color-s":[{"border-s":[g]}],"border-color-e":[{"border-e":[g]}],"border-color-t":[{"border-t":[g]}],"border-color-r":[{"border-r":[g]}],"border-color-b":[{"border-b":[g]}],"border-color-l":[{"border-l":[g]}],"divide-color":[{divide:[g]}],"outline-style":[{outline:["",...Qt()]}],"outline-offset":[{"outline-offset":[eu,ji]}],"outline-w":[{outline:[eu,hh]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:Mt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[fe]}],"ring-offset-w":[{"ring-offset":[eu,hh]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",dh,k$]}],"shadow-color":[{shadow:[xy]}],opacity:[{opacity:[fe]}],"mix-blend":[{"mix-blend":[...er(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":er()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[h]}],contrast:[{contrast:[O]}],"drop-shadow":[{"drop-shadow":["","none",dh,ji]}],grayscale:[{grayscale:[F]}],"hue-rotate":[{"hue-rotate":[$]}],invert:[{invert:[Q]}],saturate:[{saturate:[de]}],sepia:[{sepia:[Xe]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[h]}],"backdrop-contrast":[{"backdrop-contrast":[O]}],"backdrop-grayscale":[{"backdrop-grayscale":[F]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[$]}],"backdrop-invert":[{"backdrop-invert":[Q]}],"backdrop-opacity":[{"backdrop-opacity":[fe]}],"backdrop-saturate":[{"backdrop-saturate":[de]}],"backdrop-sepia":[{"backdrop-sepia":[Xe]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[E]}],"border-spacing-x":[{"border-spacing-x":[E]}],"border-spacing-y":[{"border-spacing-y":[E]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ji]}],duration:[{duration:Gr()}],ease:[{ease:["linear","in","out","in-out",ji]}],delay:[{delay:Gr()}],animate:[{animate:["none","spin","ping","pulse","bounce",ji]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[Oe]}],"scale-x":[{"scale-x":[Oe]}],"scale-y":[{"scale-y":[Oe]}],rotate:[{rotate:[vy,ji]}],"translate-x":[{"translate-x":[bt]}],"translate-y":[{"translate-y":[bt]}],"skew-x":[{"skew-x":[qe]}],"skew-y":[{"skew-y":[qe]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ji]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ji]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Gt()}],"scroll-mx":[{"scroll-mx":Gt()}],"scroll-my":[{"scroll-my":Gt()}],"scroll-ms":[{"scroll-ms":Gt()}],"scroll-me":[{"scroll-me":Gt()}],"scroll-mt":[{"scroll-mt":Gt()}],"scroll-mr":[{"scroll-mr":Gt()}],"scroll-mb":[{"scroll-mb":Gt()}],"scroll-ml":[{"scroll-ml":Gt()}],"scroll-p":[{"scroll-p":Gt()}],"scroll-px":[{"scroll-px":Gt()}],"scroll-py":[{"scroll-py":Gt()}],"scroll-ps":[{"scroll-ps":Gt()}],"scroll-pe":[{"scroll-pe":Gt()}],"scroll-pt":[{"scroll-pt":Gt()}],"scroll-pr":[{"scroll-pr":Gt()}],"scroll-pb":[{"scroll-pb":Gt()}],"scroll-pl":[{"scroll-pl":Gt()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ji]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[eu,hh,PS]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},z$=_$(L$);function Jn(...i){return z$($z(i))}const F$=M6,Qz=ke.forwardRef(({className:i,...t},a)=>ye.jsx(zz,{ref:a,className:Jn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",i),...t}));Qz.displayName=zz.displayName;const B$=I0("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),e3=ke.forwardRef(({className:i,variant:t,...a},h)=>ye.jsx(Fz,{ref:h,className:Jn(B$({variant:t}),i),...a}));e3.displayName=Fz.displayName;const N$=ke.forwardRef(({className:i,...t},a)=>ye.jsx(jz,{ref:a,className:Jn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",i),...t}));N$.displayName=jz.displayName;const t3=ke.forwardRef(({className:i,...t},a)=>ye.jsx(Vz,{ref:a,className:Jn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",i),"toast-close":"",...t,children:ye.jsx(i$,{className:"h-4 w-4"})}));t3.displayName=Vz.displayName;const r3=ke.forwardRef(({className:i,...t},a)=>ye.jsx(Bz,{ref:a,className:Jn("text-sm font-semibold",i),...t}));r3.displayName=Bz.displayName;const i3=ke.forwardRef(({className:i,...t},a)=>ye.jsx(Nz,{ref:a,className:Jn("text-sm opacity-90",i),...t}));i3.displayName=Nz.displayName;function j$(){const{toasts:i}=pz();return ye.jsxs(F$,{children:[i.map(function({id:t,title:a,description:h,action:g,...v}){return ye.jsxs(e3,{...v,children:[ye.jsxs("div",{className:"grid gap-1",children:[a&&ye.jsx(r3,{children:a}),h&&ye.jsx(i3,{children:h})]}),g,ye.jsx(t3,{})]},t)}),ye.jsx(Qz,{})]})}var mM=["light","dark"],V$="(prefers-color-scheme: dark)",U$=ke.createContext(void 0),$$={setTheme:i=>{},themes:[]},G$=()=>{var i;return(i=ke.useContext(U$))!=null?i:$$};ke.memo(({forcedTheme:i,storageKey:t,attribute:a,enableSystem:h,enableColorScheme:g,defaultTheme:v,value:E,attrs:o,nonce:O})=>{let F=v==="system",$=a==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(we=>`'${we}'`).join(",")})`};`:`var d=document.documentElement,n='${a}',s='setAttribute';`,Q=g?mM.includes(v)&&v?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${v}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",te=(we,se=!1,me=!0)=>{let fe=E?E[we]:we,re=se?we+"|| ''":`'${fe}'`,de="";return g&&me&&!se&&mM.includes(we)&&(de+=`d.style.colorScheme = '${we}';`),a==="class"?se||fe?de+=`c.add(${re})`:de+="null":fe&&(de+=`d[s](n,${re})`),de},J=i?`!function(){${$}${te(i)}}()`:h?`!function(){try{${$}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${F})){var t='${V$}',m=window.matchMedia(t);if(m.media!==t||m.matches){${te("dark")}}else{${te("light")}}}else if(e){${E?`var x=${JSON.stringify(E)};`:""}${te(E?"x[e]":"e",!0)}}${F?"":"else{"+te(v,!1,!1)+"}"}${Q}}catch(e){}}()`:`!function(){try{${$}var e=localStorage.getItem('${t}');if(e){${E?`var x=${JSON.stringify(E)};`:""}${te(E?"x[e]":"e",!0)}}else{${te(v,!1,!1)};}${Q}}catch(t){}}();`;return ke.createElement("script",{nonce:O,dangerouslySetInnerHTML:{__html:J}})});var H$=i=>{switch(i){case"success":return Z$;case"info":return K$;case"warning":return X$;case"error":return Y$;default:return null}},q$=Array(12).fill(0),W$=({visible:i,className:t})=>Ft.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":i},Ft.createElement("div",{className:"sonner-spinner"},q$.map((a,h)=>Ft.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${h}`})))),Z$=Ft.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ft.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),X$=Ft.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Ft.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),K$=Ft.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ft.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Y$=Ft.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Ft.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),J$=Ft.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Ft.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Ft.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Q$=()=>{let[i,t]=Ft.useState(document.hidden);return Ft.useEffect(()=>{let a=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),i},$E=1,e8=class{constructor(){this.subscribe=i=>(this.subscribers.push(i),()=>{let t=this.subscribers.indexOf(i);this.subscribers.splice(t,1)}),this.publish=i=>{this.subscribers.forEach(t=>t(i))},this.addToast=i=>{this.publish(i),this.toasts=[...this.toasts,i]},this.create=i=>{var t;let{message:a,...h}=i,g=typeof(i==null?void 0:i.id)=="number"||((t=i.id)==null?void 0:t.length)>0?i.id:$E++,v=this.toasts.find(o=>o.id===g),E=i.dismissible===void 0?!0:i.dismissible;return this.dismissedToasts.has(g)&&this.dismissedToasts.delete(g),v?this.toasts=this.toasts.map(o=>o.id===g?(this.publish({...o,...i,id:g,title:a}),{...o,...i,id:g,dismissible:E,title:a}):o):this.addToast({title:a,...h,dismissible:E,id:g}),g},this.dismiss=i=>(this.dismissedToasts.add(i),i||this.toasts.forEach(t=>{this.subscribers.forEach(a=>a({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:i,dismiss:!0})),i),this.message=(i,t)=>this.create({...t,message:i}),this.error=(i,t)=>this.create({...t,message:i,type:"error"}),this.success=(i,t)=>this.create({...t,type:"success",message:i}),this.info=(i,t)=>this.create({...t,type:"info",message:i}),this.warning=(i,t)=>this.create({...t,type:"warning",message:i}),this.loading=(i,t)=>this.create({...t,type:"loading",message:i}),this.promise=(i,t)=>{if(!t)return;let a;t.loading!==void 0&&(a=this.create({...t,promise:i,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let h=i instanceof Promise?i:i(),g=a!==void 0,v,E=h.then(async O=>{if(v=["resolve",O],Ft.isValidElement(O))g=!1,this.create({id:a,type:"default",message:O});else if(r8(O)&&!O.ok){g=!1;let F=typeof t.error=="function"?await t.error(`HTTP error! status: ${O.status}`):t.error,$=typeof t.description=="function"?await t.description(`HTTP error! status: ${O.status}`):t.description;this.create({id:a,type:"error",message:F,description:$})}else if(t.success!==void 0){g=!1;let F=typeof t.success=="function"?await t.success(O):t.success,$=typeof t.description=="function"?await t.description(O):t.description;this.create({id:a,type:"success",message:F,description:$})}}).catch(async O=>{if(v=["reject",O],t.error!==void 0){g=!1;let F=typeof t.error=="function"?await t.error(O):t.error,$=typeof t.description=="function"?await t.description(O):t.description;this.create({id:a,type:"error",message:F,description:$})}}).finally(()=>{var O;g&&(this.dismiss(a),a=void 0),(O=t.finally)==null||O.call(t)}),o=()=>new Promise((O,F)=>E.then(()=>v[0]==="reject"?F(v[1]):O(v[1])).catch(F));return typeof a!="string"&&typeof a!="number"?{unwrap:o}:Object.assign(a,{unwrap:o})},this.custom=(i,t)=>{let a=(t==null?void 0:t.id)||$E++;return this.create({jsx:i(a),id:a,...t}),a},this.getActiveToasts=()=>this.toasts.filter(i=>!this.dismissedToasts.has(i.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},wa=new e8,t8=(i,t)=>{let a=(t==null?void 0:t.id)||$E++;return wa.addToast({title:i,...t,id:a}),a},r8=i=>i&&typeof i=="object"&&"ok"in i&&typeof i.ok=="boolean"&&"status"in i&&typeof i.status=="number",i8=t8,n8=()=>wa.toasts,s8=()=>wa.getActiveToasts();Object.assign(i8,{success:wa.success,info:wa.info,warning:wa.warning,error:wa.error,custom:wa.custom,message:wa.message,promise:wa.promise,dismiss:wa.dismiss,loading:wa.loading},{getHistory:n8,getToasts:s8});function o8(i,{insertAt:t}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],h=document.createElement("style");h.type="text/css",t==="top"&&a.firstChild?a.insertBefore(h,a.firstChild):a.appendChild(h),h.styleSheet?h.styleSheet.cssText=i:h.appendChild(document.createTextNode(i))}o8(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Vx(i){return i.label!==void 0}var a8=3,l8="32px",c8="16px",gM=4e3,u8=356,h8=14,d8=20,f8=200;function Ml(...i){return i.filter(Boolean).join(" ")}function p8(i){let[t,a]=i.split("-"),h=[];return t&&h.push(t),a&&h.push(a),h}var m8=i=>{var t,a,h,g,v,E,o,O,F,$,Q;let{invert:te,toast:J,unstyled:we,interacting:se,setHeights:me,visibleToasts:fe,heights:re,index:de,toasts:Oe,expanded:Xe,removeToast:qe,defaultRichColors:Be,closeButton:bt,style:Bt,cancelButtonStyle:Jt,actionButtonStyle:nr,className:Gt="",descriptionClassName:Mt="",duration:Zt,position:mr,gap:Qt,loadingIcon:er,expandByDefault:dt,classNames:It,icons:tr,closeButtonAriaLabel:Gr="Close toast",pauseWhenPageIsHidden:Rr}=i,[Sr,ti]=Ft.useState(null),[Vi,On]=Ft.useState(null),[wi,Vn]=Ft.useState(!1),[Hr,Pi]=Ft.useState(!1),[Qi,Fn]=Ft.useState(!1),[bi,ns]=Ft.useState(!1),[ss,Qn]=Ft.useState(!1),[Ss,Gi]=Ft.useState(0),[Js,Ve]=Ft.useState(0),ct=Ft.useRef(J.duration||Zt||gM),Ct=Ft.useRef(null),cr=Ft.useRef(null),Nt=de===0,rr=de+1<=fe,br=J.type,_i=J.dismissible!==!1,Hi=J.className||"",xn=J.descriptionClassName||"",js=Ft.useMemo(()=>re.findIndex(di=>di.toastId===J.id)||0,[re,J.id]),os=Ft.useMemo(()=>{var di;return(di=J.closeButton)!=null?di:bt},[J.closeButton,bt]),Pa=Ft.useMemo(()=>J.duration||Zt||gM,[J.duration,Zt]),vo=Ft.useRef(0),en=Ft.useRef(0),aa=Ft.useRef(0),Qs=Ft.useRef(null),[Do,eo]=mr.split("-"),lo=Ft.useMemo(()=>re.reduce((di,sn,An)=>An>=js?di:di+sn.height,0),[re,js]),tn=Q$(),ms=J.invert||te,Ra=br==="loading";en.current=Ft.useMemo(()=>js*Qt+lo,[js,lo]),Ft.useEffect(()=>{ct.current=Pa},[Pa]),Ft.useEffect(()=>{Vn(!0)},[]),Ft.useEffect(()=>{let di=cr.current;if(di){let sn=di.getBoundingClientRect().height;return Ve(sn),me(An=>[{toastId:J.id,height:sn,position:J.position},...An]),()=>me(An=>An.filter(Rs=>Rs.toastId!==J.id))}},[me,J.id]),Ft.useLayoutEffect(()=>{if(!wi)return;let di=cr.current,sn=di.style.height;di.style.height="auto";let An=di.getBoundingClientRect().height;di.style.height=sn,Ve(An),me(Rs=>Rs.find(nt=>nt.toastId===J.id)?Rs.map(nt=>nt.toastId===J.id?{...nt,height:An}:nt):[{toastId:J.id,height:An,position:J.position},...Rs])},[wi,J.title,J.description,me,J.id]);let Vs=Ft.useCallback(()=>{Pi(!0),Gi(en.current),me(di=>di.filter(sn=>sn.toastId!==J.id)),setTimeout(()=>{qe(J)},f8)},[J,qe,me,en]);Ft.useEffect(()=>{if(J.promise&&br==="loading"||J.duration===1/0||J.type==="loading")return;let di;return Xe||se||Rr&&tn?(()=>{if(aa.current<vo.current){let sn=new Date().getTime()-vo.current;ct.current=ct.current-sn}aa.current=new Date().getTime()})():ct.current!==1/0&&(vo.current=new Date().getTime(),di=setTimeout(()=>{var sn;(sn=J.onAutoClose)==null||sn.call(J,J),Vs()},ct.current)),()=>clearTimeout(di)},[Xe,se,J,br,Rr,tn,Vs]),Ft.useEffect(()=>{J.delete&&Vs()},[Vs,J.delete]);function co(){var di,sn,An;return tr!=null&&tr.loading?Ft.createElement("div",{className:Ml(It==null?void 0:It.loader,(di=J==null?void 0:J.classNames)==null?void 0:di.loader,"sonner-loader"),"data-visible":br==="loading"},tr.loading):er?Ft.createElement("div",{className:Ml(It==null?void 0:It.loader,(sn=J==null?void 0:J.classNames)==null?void 0:sn.loader,"sonner-loader"),"data-visible":br==="loading"},er):Ft.createElement(W$,{className:Ml(It==null?void 0:It.loader,(An=J==null?void 0:J.classNames)==null?void 0:An.loader),visible:br==="loading"})}return Ft.createElement("li",{tabIndex:0,ref:cr,className:Ml(Gt,Hi,It==null?void 0:It.toast,(t=J==null?void 0:J.classNames)==null?void 0:t.toast,It==null?void 0:It.default,It==null?void 0:It[br],(a=J==null?void 0:J.classNames)==null?void 0:a[br]),"data-sonner-toast":"","data-rich-colors":(h=J.richColors)!=null?h:Be,"data-styled":!(J.jsx||J.unstyled||we),"data-mounted":wi,"data-promise":!!J.promise,"data-swiped":ss,"data-removed":Hr,"data-visible":rr,"data-y-position":Do,"data-x-position":eo,"data-index":de,"data-front":Nt,"data-swiping":Qi,"data-dismissible":_i,"data-type":br,"data-invert":ms,"data-swipe-out":bi,"data-swipe-direction":Vi,"data-expanded":!!(Xe||dt&&wi),style:{"--index":de,"--toasts-before":de,"--z-index":Oe.length-de,"--offset":`${Hr?Ss:en.current}px`,"--initial-height":dt?"auto":`${Js}px`,...Bt,...J.style},onDragEnd:()=>{Fn(!1),ti(null),Qs.current=null},onPointerDown:di=>{Ra||!_i||(Ct.current=new Date,Gi(en.current),di.target.setPointerCapture(di.pointerId),di.target.tagName!=="BUTTON"&&(Fn(!0),Qs.current={x:di.clientX,y:di.clientY}))},onPointerUp:()=>{var di,sn,An,Rs;if(bi||!_i)return;Qs.current=null;let nt=Number(((di=cr.current)==null?void 0:di.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),ks=Number(((sn=cr.current)==null?void 0:sn.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Lo=new Date().getTime()-((An=Ct.current)==null?void 0:An.getTime()),Us=Sr==="x"?nt:ks,Nr=Math.abs(Us)/Lo;if(Math.abs(Us)>=d8||Nr>.11){Gi(en.current),(Rs=J.onDismiss)==null||Rs.call(J,J),On(Sr==="x"?nt>0?"right":"left":ks>0?"down":"up"),Vs(),ns(!0),Qn(!1);return}Fn(!1),ti(null)},onPointerMove:di=>{var sn,An,Rs,nt;if(!Qs.current||!_i||((sn=window.getSelection())==null?void 0:sn.toString().length)>0)return;let ks=di.clientY-Qs.current.y,Lo=di.clientX-Qs.current.x,Us=(An=i.swipeDirections)!=null?An:p8(mr);!Sr&&(Math.abs(Lo)>1||Math.abs(ks)>1)&&ti(Math.abs(Lo)>Math.abs(ks)?"x":"y");let Nr={x:0,y:0};Sr==="y"?(Us.includes("top")||Us.includes("bottom"))&&(Us.includes("top")&&ks<0||Us.includes("bottom")&&ks>0)&&(Nr.y=ks):Sr==="x"&&(Us.includes("left")||Us.includes("right"))&&(Us.includes("left")&&Lo<0||Us.includes("right")&&Lo>0)&&(Nr.x=Lo),(Math.abs(Nr.x)>0||Math.abs(Nr.y)>0)&&Qn(!0),(Rs=cr.current)==null||Rs.style.setProperty("--swipe-amount-x",`${Nr.x}px`),(nt=cr.current)==null||nt.style.setProperty("--swipe-amount-y",`${Nr.y}px`)}},os&&!J.jsx?Ft.createElement("button",{"aria-label":Gr,"data-disabled":Ra,"data-close-button":!0,onClick:Ra||!_i?()=>{}:()=>{var di;Vs(),(di=J.onDismiss)==null||di.call(J,J)},className:Ml(It==null?void 0:It.closeButton,(g=J==null?void 0:J.classNames)==null?void 0:g.closeButton)},(v=tr==null?void 0:tr.close)!=null?v:J$):null,J.jsx||ke.isValidElement(J.title)?J.jsx?J.jsx:typeof J.title=="function"?J.title():J.title:Ft.createElement(Ft.Fragment,null,br||J.icon||J.promise?Ft.createElement("div",{"data-icon":"",className:Ml(It==null?void 0:It.icon,(E=J==null?void 0:J.classNames)==null?void 0:E.icon)},J.promise||J.type==="loading"&&!J.icon?J.icon||co():null,J.type!=="loading"?J.icon||(tr==null?void 0:tr[br])||H$(br):null):null,Ft.createElement("div",{"data-content":"",className:Ml(It==null?void 0:It.content,(o=J==null?void 0:J.classNames)==null?void 0:o.content)},Ft.createElement("div",{"data-title":"",className:Ml(It==null?void 0:It.title,(O=J==null?void 0:J.classNames)==null?void 0:O.title)},typeof J.title=="function"?J.title():J.title),J.description?Ft.createElement("div",{"data-description":"",className:Ml(Mt,xn,It==null?void 0:It.description,(F=J==null?void 0:J.classNames)==null?void 0:F.description)},typeof J.description=="function"?J.description():J.description):null),ke.isValidElement(J.cancel)?J.cancel:J.cancel&&Vx(J.cancel)?Ft.createElement("button",{"data-button":!0,"data-cancel":!0,style:J.cancelButtonStyle||Jt,onClick:di=>{var sn,An;Vx(J.cancel)&&_i&&((An=(sn=J.cancel).onClick)==null||An.call(sn,di),Vs())},className:Ml(It==null?void 0:It.cancelButton,($=J==null?void 0:J.classNames)==null?void 0:$.cancelButton)},J.cancel.label):null,ke.isValidElement(J.action)?J.action:J.action&&Vx(J.action)?Ft.createElement("button",{"data-button":!0,"data-action":!0,style:J.actionButtonStyle||nr,onClick:di=>{var sn,An;Vx(J.action)&&((An=(sn=J.action).onClick)==null||An.call(sn,di),!di.defaultPrevented&&Vs())},className:Ml(It==null?void 0:It.actionButton,(Q=J==null?void 0:J.classNames)==null?void 0:Q.actionButton)},J.action.label):null))};function _M(){if(typeof window>"u"||typeof document>"u")return"ltr";let i=document.documentElement.getAttribute("dir");return i==="auto"||!i?window.getComputedStyle(document.documentElement).direction:i}function g8(i,t){let a={};return[i,t].forEach((h,g)=>{let v=g===1,E=v?"--mobile-offset":"--offset",o=v?c8:l8;function O(F){["top","right","bottom","left"].forEach($=>{a[`${E}-${$}`]=typeof F=="number"?`${F}px`:F})}typeof h=="number"||typeof h=="string"?O(h):typeof h=="object"?["top","right","bottom","left"].forEach(F=>{h[F]===void 0?a[`${E}-${F}`]=o:a[`${E}-${F}`]=typeof h[F]=="number"?`${h[F]}px`:h[F]}):O(o)}),a}var _8=ke.forwardRef(function(i,t){let{invert:a,position:h="bottom-right",hotkey:g=["altKey","KeyT"],expand:v,closeButton:E,className:o,offset:O,mobileOffset:F,theme:$="light",richColors:Q,duration:te,style:J,visibleToasts:we=a8,toastOptions:se,dir:me=_M(),gap:fe=h8,loadingIcon:re,icons:de,containerAriaLabel:Oe="Notifications",pauseWhenPageIsHidden:Xe}=i,[qe,Be]=Ft.useState([]),bt=Ft.useMemo(()=>Array.from(new Set([h].concat(qe.filter(Rr=>Rr.position).map(Rr=>Rr.position)))),[qe,h]),[Bt,Jt]=Ft.useState([]),[nr,Gt]=Ft.useState(!1),[Mt,Zt]=Ft.useState(!1),[mr,Qt]=Ft.useState($!=="system"?$:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),er=Ft.useRef(null),dt=g.join("+").replace(/Key/g,"").replace(/Digit/g,""),It=Ft.useRef(null),tr=Ft.useRef(!1),Gr=Ft.useCallback(Rr=>{Be(Sr=>{var ti;return(ti=Sr.find(Vi=>Vi.id===Rr.id))!=null&&ti.delete||wa.dismiss(Rr.id),Sr.filter(({id:Vi})=>Vi!==Rr.id)})},[]);return Ft.useEffect(()=>wa.subscribe(Rr=>{if(Rr.dismiss){Be(Sr=>Sr.map(ti=>ti.id===Rr.id?{...ti,delete:!0}:ti));return}setTimeout(()=>{dz.flushSync(()=>{Be(Sr=>{let ti=Sr.findIndex(Vi=>Vi.id===Rr.id);return ti!==-1?[...Sr.slice(0,ti),{...Sr[ti],...Rr},...Sr.slice(ti+1)]:[Rr,...Sr]})})})}),[]),Ft.useEffect(()=>{if($!=="system"){Qt($);return}if($==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Qt("dark"):Qt("light")),typeof window>"u")return;let Rr=window.matchMedia("(prefers-color-scheme: dark)");try{Rr.addEventListener("change",({matches:Sr})=>{Qt(Sr?"dark":"light")})}catch{Rr.addListener(({matches:ti})=>{try{Qt(ti?"dark":"light")}catch(Vi){console.error(Vi)}})}},[$]),Ft.useEffect(()=>{qe.length<=1&&Gt(!1)},[qe]),Ft.useEffect(()=>{let Rr=Sr=>{var ti,Vi;g.every(On=>Sr[On]||Sr.code===On)&&(Gt(!0),(ti=er.current)==null||ti.focus()),Sr.code==="Escape"&&(document.activeElement===er.current||(Vi=er.current)!=null&&Vi.contains(document.activeElement))&&Gt(!1)};return document.addEventListener("keydown",Rr),()=>document.removeEventListener("keydown",Rr)},[g]),Ft.useEffect(()=>{if(er.current)return()=>{It.current&&(It.current.focus({preventScroll:!0}),It.current=null,tr.current=!1)}},[er.current]),Ft.createElement("section",{ref:t,"aria-label":`${Oe} ${dt}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},bt.map((Rr,Sr)=>{var ti;let[Vi,On]=Rr.split("-");return qe.length?Ft.createElement("ol",{key:Rr,dir:me==="auto"?_M():me,tabIndex:-1,ref:er,className:o,"data-sonner-toaster":!0,"data-theme":mr,"data-y-position":Vi,"data-lifted":nr&&qe.length>1&&!v,"data-x-position":On,style:{"--front-toast-height":`${((ti=Bt[0])==null?void 0:ti.height)||0}px`,"--width":`${u8}px`,"--gap":`${fe}px`,...J,...g8(O,F)},onBlur:wi=>{tr.current&&!wi.currentTarget.contains(wi.relatedTarget)&&(tr.current=!1,It.current&&(It.current.focus({preventScroll:!0}),It.current=null))},onFocus:wi=>{wi.target instanceof HTMLElement&&wi.target.dataset.dismissible==="false"||tr.current||(tr.current=!0,It.current=wi.relatedTarget)},onMouseEnter:()=>Gt(!0),onMouseMove:()=>Gt(!0),onMouseLeave:()=>{Mt||Gt(!1)},onDragEnd:()=>Gt(!1),onPointerDown:wi=>{wi.target instanceof HTMLElement&&wi.target.dataset.dismissible==="false"||Zt(!0)},onPointerUp:()=>Zt(!1)},qe.filter(wi=>!wi.position&&Sr===0||wi.position===Rr).map((wi,Vn)=>{var Hr,Pi;return Ft.createElement(m8,{key:wi.id,icons:de,index:Vn,toast:wi,defaultRichColors:Q,duration:(Hr=se==null?void 0:se.duration)!=null?Hr:te,className:se==null?void 0:se.className,descriptionClassName:se==null?void 0:se.descriptionClassName,invert:a,visibleToasts:we,closeButton:(Pi=se==null?void 0:se.closeButton)!=null?Pi:E,interacting:Mt,position:Rr,style:se==null?void 0:se.style,unstyled:se==null?void 0:se.unstyled,classNames:se==null?void 0:se.classNames,cancelButtonStyle:se==null?void 0:se.cancelButtonStyle,actionButtonStyle:se==null?void 0:se.actionButtonStyle,removeToast:Gr,toasts:qe.filter(Qi=>Qi.position==wi.position),heights:Bt.filter(Qi=>Qi.position==wi.position),setHeights:Jt,expandByDefault:v,gap:fe,loadingIcon:re,expanded:nr,pauseWhenPageIsHidden:Xe,swipeDirections:i.swipeDirections})})):null}))});const y8=({...i})=>{const{theme:t="system"}=G$();return ye.jsx(_8,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...i})},v8=["top","right","bottom","left"],$h=Math.min,ja=Math.max,W1=Math.round,Ux=Math.floor,Ic=i=>({x:i,y:i}),x8={left:"right",right:"left",bottom:"top",top:"bottom"},w8={start:"end",end:"start"};function GE(i,t,a){return ja(i,$h(t,a))}function mu(i,t){return typeof i=="function"?i(t):i}function gu(i){return i.split("-")[0]}function ig(i){return i.split("-")[1]}function xI(i){return i==="x"?"y":"x"}function wI(i){return i==="y"?"height":"width"}const b8=new Set(["top","bottom"]);function bc(i){return b8.has(gu(i))?"y":"x"}function bI(i){return xI(bc(i))}function T8(i,t,a){a===void 0&&(a=!1);const h=ig(i),g=bI(i),v=wI(g);let E=g==="x"?h===(a?"end":"start")?"right":"left":h==="start"?"bottom":"top";return t.reference[v]>t.floating[v]&&(E=Z1(E)),[E,Z1(E)]}function S8(i){const t=Z1(i);return[HE(i),t,HE(t)]}function HE(i){return i.replace(/start|end/g,t=>w8[t])}const yM=["left","right"],vM=["right","left"],E8=["top","bottom"],I8=["bottom","top"];function A8(i,t,a){switch(i){case"top":case"bottom":return a?t?vM:yM:t?yM:vM;case"left":case"right":return t?E8:I8;default:return[]}}function C8(i,t,a,h){const g=ig(i);let v=A8(gu(i),a==="start",h);return g&&(v=v.map(E=>E+"-"+g),t&&(v=v.concat(v.map(HE)))),v}function Z1(i){return i.replace(/left|right|bottom|top/g,t=>x8[t])}function P8(i){return{top:0,right:0,bottom:0,left:0,...i}}function n3(i){return typeof i!="number"?P8(i):{top:i,right:i,bottom:i,left:i}}function X1(i){const{x:t,y:a,width:h,height:g}=i;return{width:h,height:g,top:a,left:t,right:t+h,bottom:a+g,x:t,y:a}}function xM(i,t,a){let{reference:h,floating:g}=i;const v=bc(t),E=bI(t),o=wI(E),O=gu(t),F=v==="y",$=h.x+h.width/2-g.width/2,Q=h.y+h.height/2-g.height/2,te=h[o]/2-g[o]/2;let J;switch(O){case"top":J={x:$,y:h.y-g.height};break;case"bottom":J={x:$,y:h.y+h.height};break;case"right":J={x:h.x+h.width,y:Q};break;case"left":J={x:h.x-g.width,y:Q};break;default:J={x:h.x,y:h.y}}switch(ig(t)){case"start":J[E]-=te*(a&&F?-1:1);break;case"end":J[E]+=te*(a&&F?-1:1);break}return J}const R8=async(i,t,a)=>{const{placement:h="bottom",strategy:g="absolute",middleware:v=[],platform:E}=a,o=v.filter(Boolean),O=await(E.isRTL==null?void 0:E.isRTL(t));let F=await E.getElementRects({reference:i,floating:t,strategy:g}),{x:$,y:Q}=xM(F,h,O),te=h,J={},we=0;for(let se=0;se<o.length;se++){const{name:me,fn:fe}=o[se],{x:re,y:de,data:Oe,reset:Xe}=await fe({x:$,y:Q,initialPlacement:h,placement:te,strategy:g,middlewareData:J,rects:F,platform:E,elements:{reference:i,floating:t}});$=re??$,Q=de??Q,J={...J,[me]:{...J[me],...Oe}},Xe&&we<=50&&(we++,typeof Xe=="object"&&(Xe.placement&&(te=Xe.placement),Xe.rects&&(F=Xe.rects===!0?await E.getElementRects({reference:i,floating:t,strategy:g}):Xe.rects),{x:$,y:Q}=xM(F,te,O)),se=-1)}return{x:$,y:Q,placement:te,strategy:g,middlewareData:J}};async function a0(i,t){var a;t===void 0&&(t={});const{x:h,y:g,platform:v,rects:E,elements:o,strategy:O}=i,{boundary:F="clippingAncestors",rootBoundary:$="viewport",elementContext:Q="floating",altBoundary:te=!1,padding:J=0}=mu(t,i),we=n3(J),me=o[te?Q==="floating"?"reference":"floating":Q],fe=X1(await v.getClippingRect({element:(a=await(v.isElement==null?void 0:v.isElement(me)))==null||a?me:me.contextElement||await(v.getDocumentElement==null?void 0:v.getDocumentElement(o.floating)),boundary:F,rootBoundary:$,strategy:O})),re=Q==="floating"?{x:h,y:g,width:E.floating.width,height:E.floating.height}:E.reference,de=await(v.getOffsetParent==null?void 0:v.getOffsetParent(o.floating)),Oe=await(v.isElement==null?void 0:v.isElement(de))?await(v.getScale==null?void 0:v.getScale(de))||{x:1,y:1}:{x:1,y:1},Xe=X1(v.convertOffsetParentRelativeRectToViewportRelativeRect?await v.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:re,offsetParent:de,strategy:O}):re);return{top:(fe.top-Xe.top+we.top)/Oe.y,bottom:(Xe.bottom-fe.bottom+we.bottom)/Oe.y,left:(fe.left-Xe.left+we.left)/Oe.x,right:(Xe.right-fe.right+we.right)/Oe.x}}const k8=i=>({name:"arrow",options:i,async fn(t){const{x:a,y:h,placement:g,rects:v,platform:E,elements:o,middlewareData:O}=t,{element:F,padding:$=0}=mu(i,t)||{};if(F==null)return{};const Q=n3($),te={x:a,y:h},J=bI(g),we=wI(J),se=await E.getDimensions(F),me=J==="y",fe=me?"top":"left",re=me?"bottom":"right",de=me?"clientHeight":"clientWidth",Oe=v.reference[we]+v.reference[J]-te[J]-v.floating[we],Xe=te[J]-v.reference[J],qe=await(E.getOffsetParent==null?void 0:E.getOffsetParent(F));let Be=qe?qe[de]:0;(!Be||!await(E.isElement==null?void 0:E.isElement(qe)))&&(Be=o.floating[de]||v.floating[we]);const bt=Oe/2-Xe/2,Bt=Be/2-se[we]/2-1,Jt=$h(Q[fe],Bt),nr=$h(Q[re],Bt),Gt=Jt,Mt=Be-se[we]-nr,Zt=Be/2-se[we]/2+bt,mr=GE(Gt,Zt,Mt),Qt=!O.arrow&&ig(g)!=null&&Zt!==mr&&v.reference[we]/2-(Zt<Gt?Jt:nr)-se[we]/2<0,er=Qt?Zt<Gt?Zt-Gt:Zt-Mt:0;return{[J]:te[J]+er,data:{[J]:mr,centerOffset:Zt-mr-er,...Qt&&{alignmentOffset:er}},reset:Qt}}}),M8=function(i){return i===void 0&&(i={}),{name:"flip",options:i,async fn(t){var a,h;const{placement:g,middlewareData:v,rects:E,initialPlacement:o,platform:O,elements:F}=t,{mainAxis:$=!0,crossAxis:Q=!0,fallbackPlacements:te,fallbackStrategy:J="bestFit",fallbackAxisSideDirection:we="none",flipAlignment:se=!0,...me}=mu(i,t);if((a=v.arrow)!=null&&a.alignmentOffset)return{};const fe=gu(g),re=bc(o),de=gu(o)===o,Oe=await(O.isRTL==null?void 0:O.isRTL(F.floating)),Xe=te||(de||!se?[Z1(o)]:S8(o)),qe=we!=="none";!te&&qe&&Xe.push(...C8(o,se,we,Oe));const Be=[o,...Xe],bt=await a0(t,me),Bt=[];let Jt=((h=v.flip)==null?void 0:h.overflows)||[];if($&&Bt.push(bt[fe]),Q){const Zt=T8(g,E,Oe);Bt.push(bt[Zt[0]],bt[Zt[1]])}if(Jt=[...Jt,{placement:g,overflows:Bt}],!Bt.every(Zt=>Zt<=0)){var nr,Gt;const Zt=(((nr=v.flip)==null?void 0:nr.index)||0)+1,mr=Be[Zt];if(mr&&(!(Q==="alignment"?re!==bc(mr):!1)||Jt.every(dt=>dt.overflows[0]>0&&bc(dt.placement)===re)))return{data:{index:Zt,overflows:Jt},reset:{placement:mr}};let Qt=(Gt=Jt.filter(er=>er.overflows[0]<=0).sort((er,dt)=>er.overflows[1]-dt.overflows[1])[0])==null?void 0:Gt.placement;if(!Qt)switch(J){case"bestFit":{var Mt;const er=(Mt=Jt.filter(dt=>{if(qe){const It=bc(dt.placement);return It===re||It==="y"}return!0}).map(dt=>[dt.placement,dt.overflows.filter(It=>It>0).reduce((It,tr)=>It+tr,0)]).sort((dt,It)=>dt[1]-It[1])[0])==null?void 0:Mt[0];er&&(Qt=er);break}case"initialPlacement":Qt=o;break}if(g!==Qt)return{reset:{placement:Qt}}}return{}}}};function wM(i,t){return{top:i.top-t.height,right:i.right-t.width,bottom:i.bottom-t.height,left:i.left-t.width}}function bM(i){return v8.some(t=>i[t]>=0)}const O8=function(i){return i===void 0&&(i={}),{name:"hide",options:i,async fn(t){const{rects:a}=t,{strategy:h="referenceHidden",...g}=mu(i,t);switch(h){case"referenceHidden":{const v=await a0(t,{...g,elementContext:"reference"}),E=wM(v,a.reference);return{data:{referenceHiddenOffsets:E,referenceHidden:bM(E)}}}case"escaped":{const v=await a0(t,{...g,altBoundary:!0}),E=wM(v,a.floating);return{data:{escapedOffsets:E,escaped:bM(E)}}}default:return{}}}}},s3=new Set(["left","top"]);async function D8(i,t){const{placement:a,platform:h,elements:g}=i,v=await(h.isRTL==null?void 0:h.isRTL(g.floating)),E=gu(a),o=ig(a),O=bc(a)==="y",F=s3.has(E)?-1:1,$=v&&O?-1:1,Q=mu(t,i);let{mainAxis:te,crossAxis:J,alignmentAxis:we}=typeof Q=="number"?{mainAxis:Q,crossAxis:0,alignmentAxis:null}:{mainAxis:Q.mainAxis||0,crossAxis:Q.crossAxis||0,alignmentAxis:Q.alignmentAxis};return o&&typeof we=="number"&&(J=o==="end"?we*-1:we),O?{x:J*$,y:te*F}:{x:te*F,y:J*$}}const L8=function(i){return i===void 0&&(i=0),{name:"offset",options:i,async fn(t){var a,h;const{x:g,y:v,placement:E,middlewareData:o}=t,O=await D8(t,i);return E===((a=o.offset)==null?void 0:a.placement)&&(h=o.arrow)!=null&&h.alignmentOffset?{}:{x:g+O.x,y:v+O.y,data:{...O,placement:E}}}}},z8=function(i){return i===void 0&&(i={}),{name:"shift",options:i,async fn(t){const{x:a,y:h,placement:g}=t,{mainAxis:v=!0,crossAxis:E=!1,limiter:o={fn:me=>{let{x:fe,y:re}=me;return{x:fe,y:re}}},...O}=mu(i,t),F={x:a,y:h},$=await a0(t,O),Q=bc(gu(g)),te=xI(Q);let J=F[te],we=F[Q];if(v){const me=te==="y"?"top":"left",fe=te==="y"?"bottom":"right",re=J+$[me],de=J-$[fe];J=GE(re,J,de)}if(E){const me=Q==="y"?"top":"left",fe=Q==="y"?"bottom":"right",re=we+$[me],de=we-$[fe];we=GE(re,we,de)}const se=o.fn({...t,[te]:J,[Q]:we});return{...se,data:{x:se.x-a,y:se.y-h,enabled:{[te]:v,[Q]:E}}}}}},F8=function(i){return i===void 0&&(i={}),{options:i,fn(t){const{x:a,y:h,placement:g,rects:v,middlewareData:E}=t,{offset:o=0,mainAxis:O=!0,crossAxis:F=!0}=mu(i,t),$={x:a,y:h},Q=bc(g),te=xI(Q);let J=$[te],we=$[Q];const se=mu(o,t),me=typeof se=="number"?{mainAxis:se,crossAxis:0}:{mainAxis:0,crossAxis:0,...se};if(O){const de=te==="y"?"height":"width",Oe=v.reference[te]-v.floating[de]+me.mainAxis,Xe=v.reference[te]+v.reference[de]-me.mainAxis;J<Oe?J=Oe:J>Xe&&(J=Xe)}if(F){var fe,re;const de=te==="y"?"width":"height",Oe=s3.has(gu(g)),Xe=v.reference[Q]-v.floating[de]+(Oe&&((fe=E.offset)==null?void 0:fe[Q])||0)+(Oe?0:me.crossAxis),qe=v.reference[Q]+v.reference[de]+(Oe?0:((re=E.offset)==null?void 0:re[Q])||0)-(Oe?me.crossAxis:0);we<Xe?we=Xe:we>qe&&(we=qe)}return{[te]:J,[Q]:we}}}},B8=function(i){return i===void 0&&(i={}),{name:"size",options:i,async fn(t){var a,h;const{placement:g,rects:v,platform:E,elements:o}=t,{apply:O=()=>{},...F}=mu(i,t),$=await a0(t,F),Q=gu(g),te=ig(g),J=bc(g)==="y",{width:we,height:se}=v.floating;let me,fe;Q==="top"||Q==="bottom"?(me=Q,fe=te===(await(E.isRTL==null?void 0:E.isRTL(o.floating))?"start":"end")?"left":"right"):(fe=Q,me=te==="end"?"top":"bottom");const re=se-$.top-$.bottom,de=we-$.left-$.right,Oe=$h(se-$[me],re),Xe=$h(we-$[fe],de),qe=!t.middlewareData.shift;let Be=Oe,bt=Xe;if((a=t.middlewareData.shift)!=null&&a.enabled.x&&(bt=de),(h=t.middlewareData.shift)!=null&&h.enabled.y&&(Be=re),qe&&!te){const Jt=ja($.left,0),nr=ja($.right,0),Gt=ja($.top,0),Mt=ja($.bottom,0);J?bt=we-2*(Jt!==0||nr!==0?Jt+nr:ja($.left,$.right)):Be=se-2*(Gt!==0||Mt!==0?Gt+Mt:ja($.top,$.bottom))}await O({...t,availableWidth:bt,availableHeight:Be});const Bt=await E.getDimensions(o.floating);return we!==Bt.width||se!==Bt.height?{reset:{rects:!0}}:{}}}};function Lw(){return typeof window<"u"}function ng(i){return o3(i)?(i.nodeName||"").toLowerCase():"#document"}function qa(i){var t;return(i==null||(t=i.ownerDocument)==null?void 0:t.defaultView)||window}function Pc(i){var t;return(t=(o3(i)?i.ownerDocument:i.document)||window.document)==null?void 0:t.documentElement}function o3(i){return Lw()?i instanceof Node||i instanceof qa(i).Node:!1}function Xl(i){return Lw()?i instanceof Element||i instanceof qa(i).Element:!1}function Cc(i){return Lw()?i instanceof HTMLElement||i instanceof qa(i).HTMLElement:!1}function TM(i){return!Lw()||typeof ShadowRoot>"u"?!1:i instanceof ShadowRoot||i instanceof qa(i).ShadowRoot}const N8=new Set(["inline","contents"]);function A0(i){const{overflow:t,overflowX:a,overflowY:h,display:g}=Kl(i);return/auto|scroll|overlay|hidden|clip/.test(t+h+a)&&!N8.has(g)}const j8=new Set(["table","td","th"]);function V8(i){return j8.has(ng(i))}const U8=[":popover-open",":modal"];function zw(i){return U8.some(t=>{try{return i.matches(t)}catch{return!1}})}const $8=["transform","translate","scale","rotate","perspective"],G8=["transform","translate","scale","rotate","perspective","filter"],H8=["paint","layout","strict","content"];function TI(i){const t=SI(),a=Xl(i)?Kl(i):i;return $8.some(h=>a[h]?a[h]!=="none":!1)||(a.containerType?a.containerType!=="normal":!1)||!t&&(a.backdropFilter?a.backdropFilter!=="none":!1)||!t&&(a.filter?a.filter!=="none":!1)||G8.some(h=>(a.willChange||"").includes(h))||H8.some(h=>(a.contain||"").includes(h))}function q8(i){let t=Gh(i);for(;Cc(t)&&!qm(t);){if(TI(t))return t;if(zw(t))return null;t=Gh(t)}return null}function SI(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const W8=new Set(["html","body","#document"]);function qm(i){return W8.has(ng(i))}function Kl(i){return qa(i).getComputedStyle(i)}function Fw(i){return Xl(i)?{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}:{scrollLeft:i.scrollX,scrollTop:i.scrollY}}function Gh(i){if(ng(i)==="html")return i;const t=i.assignedSlot||i.parentNode||TM(i)&&i.host||Pc(i);return TM(t)?t.host:t}function a3(i){const t=Gh(i);return qm(t)?i.ownerDocument?i.ownerDocument.body:i.body:Cc(t)&&A0(t)?t:a3(t)}function l0(i,t,a){var h;t===void 0&&(t=[]),a===void 0&&(a=!0);const g=a3(i),v=g===((h=i.ownerDocument)==null?void 0:h.body),E=qa(g);if(v){const o=qE(E);return t.concat(E,E.visualViewport||[],A0(g)?g:[],o&&a?l0(o):[])}return t.concat(g,l0(g,[],a))}function qE(i){return i.parent&&Object.getPrototypeOf(i.parent)?i.frameElement:null}function l3(i){const t=Kl(i);let a=parseFloat(t.width)||0,h=parseFloat(t.height)||0;const g=Cc(i),v=g?i.offsetWidth:a,E=g?i.offsetHeight:h,o=W1(a)!==v||W1(h)!==E;return o&&(a=v,h=E),{width:a,height:h,$:o}}function EI(i){return Xl(i)?i:i.contextElement}function Cm(i){const t=EI(i);if(!Cc(t))return Ic(1);const a=t.getBoundingClientRect(),{width:h,height:g,$:v}=l3(t);let E=(v?W1(a.width):a.width)/h,o=(v?W1(a.height):a.height)/g;return(!E||!Number.isFinite(E))&&(E=1),(!o||!Number.isFinite(o))&&(o=1),{x:E,y:o}}const Z8=Ic(0);function c3(i){const t=qa(i);return!SI()||!t.visualViewport?Z8:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function X8(i,t,a){return t===void 0&&(t=!1),!a||t&&a!==qa(i)?!1:t}function bf(i,t,a,h){t===void 0&&(t=!1),a===void 0&&(a=!1);const g=i.getBoundingClientRect(),v=EI(i);let E=Ic(1);t&&(h?Xl(h)&&(E=Cm(h)):E=Cm(i));const o=X8(v,a,h)?c3(v):Ic(0);let O=(g.left+o.x)/E.x,F=(g.top+o.y)/E.y,$=g.width/E.x,Q=g.height/E.y;if(v){const te=qa(v),J=h&&Xl(h)?qa(h):h;let we=te,se=qE(we);for(;se&&h&&J!==we;){const me=Cm(se),fe=se.getBoundingClientRect(),re=Kl(se),de=fe.left+(se.clientLeft+parseFloat(re.paddingLeft))*me.x,Oe=fe.top+(se.clientTop+parseFloat(re.paddingTop))*me.y;O*=me.x,F*=me.y,$*=me.x,Q*=me.y,O+=de,F+=Oe,we=qa(se),se=qE(we)}}return X1({width:$,height:Q,x:O,y:F})}function II(i,t){const a=Fw(i).scrollLeft;return t?t.left+a:bf(Pc(i)).left+a}function u3(i,t,a){a===void 0&&(a=!1);const h=i.getBoundingClientRect(),g=h.left+t.scrollLeft-(a?0:II(i,h)),v=h.top+t.scrollTop;return{x:g,y:v}}function K8(i){let{elements:t,rect:a,offsetParent:h,strategy:g}=i;const v=g==="fixed",E=Pc(h),o=t?zw(t.floating):!1;if(h===E||o&&v)return a;let O={scrollLeft:0,scrollTop:0},F=Ic(1);const $=Ic(0),Q=Cc(h);if((Q||!Q&&!v)&&((ng(h)!=="body"||A0(E))&&(O=Fw(h)),Cc(h))){const J=bf(h);F=Cm(h),$.x=J.x+h.clientLeft,$.y=J.y+h.clientTop}const te=E&&!Q&&!v?u3(E,O,!0):Ic(0);return{width:a.width*F.x,height:a.height*F.y,x:a.x*F.x-O.scrollLeft*F.x+$.x+te.x,y:a.y*F.y-O.scrollTop*F.y+$.y+te.y}}function Y8(i){return Array.from(i.getClientRects())}function J8(i){const t=Pc(i),a=Fw(i),h=i.ownerDocument.body,g=ja(t.scrollWidth,t.clientWidth,h.scrollWidth,h.clientWidth),v=ja(t.scrollHeight,t.clientHeight,h.scrollHeight,h.clientHeight);let E=-a.scrollLeft+II(i);const o=-a.scrollTop;return Kl(h).direction==="rtl"&&(E+=ja(t.clientWidth,h.clientWidth)-g),{width:g,height:v,x:E,y:o}}function Q8(i,t){const a=qa(i),h=Pc(i),g=a.visualViewport;let v=h.clientWidth,E=h.clientHeight,o=0,O=0;if(g){v=g.width,E=g.height;const F=SI();(!F||F&&t==="fixed")&&(o=g.offsetLeft,O=g.offsetTop)}return{width:v,height:E,x:o,y:O}}const eG=new Set(["absolute","fixed"]);function tG(i,t){const a=bf(i,!0,t==="fixed"),h=a.top+i.clientTop,g=a.left+i.clientLeft,v=Cc(i)?Cm(i):Ic(1),E=i.clientWidth*v.x,o=i.clientHeight*v.y,O=g*v.x,F=h*v.y;return{width:E,height:o,x:O,y:F}}function SM(i,t,a){let h;if(t==="viewport")h=Q8(i,a);else if(t==="document")h=J8(Pc(i));else if(Xl(t))h=tG(t,a);else{const g=c3(i);h={x:t.x-g.x,y:t.y-g.y,width:t.width,height:t.height}}return X1(h)}function h3(i,t){const a=Gh(i);return a===t||!Xl(a)||qm(a)?!1:Kl(a).position==="fixed"||h3(a,t)}function rG(i,t){const a=t.get(i);if(a)return a;let h=l0(i,[],!1).filter(o=>Xl(o)&&ng(o)!=="body"),g=null;const v=Kl(i).position==="fixed";let E=v?Gh(i):i;for(;Xl(E)&&!qm(E);){const o=Kl(E),O=TI(E);!O&&o.position==="fixed"&&(g=null),(v?!O&&!g:!O&&o.position==="static"&&!!g&&eG.has(g.position)||A0(E)&&!O&&h3(i,E))?h=h.filter($=>$!==E):g=o,E=Gh(E)}return t.set(i,h),h}function iG(i){let{element:t,boundary:a,rootBoundary:h,strategy:g}=i;const E=[...a==="clippingAncestors"?zw(t)?[]:rG(t,this._c):[].concat(a),h],o=E[0],O=E.reduce((F,$)=>{const Q=SM(t,$,g);return F.top=ja(Q.top,F.top),F.right=$h(Q.right,F.right),F.bottom=$h(Q.bottom,F.bottom),F.left=ja(Q.left,F.left),F},SM(t,o,g));return{width:O.right-O.left,height:O.bottom-O.top,x:O.left,y:O.top}}function nG(i){const{width:t,height:a}=l3(i);return{width:t,height:a}}function sG(i,t,a){const h=Cc(t),g=Pc(t),v=a==="fixed",E=bf(i,!0,v,t);let o={scrollLeft:0,scrollTop:0};const O=Ic(0);function F(){O.x=II(g)}if(h||!h&&!v)if((ng(t)!=="body"||A0(g))&&(o=Fw(t)),h){const J=bf(t,!0,v,t);O.x=J.x+t.clientLeft,O.y=J.y+t.clientTop}else g&&F();v&&!h&&g&&F();const $=g&&!h&&!v?u3(g,o):Ic(0),Q=E.left+o.scrollLeft-O.x-$.x,te=E.top+o.scrollTop-O.y-$.y;return{x:Q,y:te,width:E.width,height:E.height}}function RS(i){return Kl(i).position==="static"}function EM(i,t){if(!Cc(i)||Kl(i).position==="fixed")return null;if(t)return t(i);let a=i.offsetParent;return Pc(i)===a&&(a=a.ownerDocument.body),a}function d3(i,t){const a=qa(i);if(zw(i))return a;if(!Cc(i)){let g=Gh(i);for(;g&&!qm(g);){if(Xl(g)&&!RS(g))return g;g=Gh(g)}return a}let h=EM(i,t);for(;h&&V8(h)&&RS(h);)h=EM(h,t);return h&&qm(h)&&RS(h)&&!TI(h)?a:h||q8(i)||a}const oG=async function(i){const t=this.getOffsetParent||d3,a=this.getDimensions,h=await a(i.floating);return{reference:sG(i.reference,await t(i.floating),i.strategy),floating:{x:0,y:0,width:h.width,height:h.height}}};function aG(i){return Kl(i).direction==="rtl"}const lG={convertOffsetParentRelativeRectToViewportRelativeRect:K8,getDocumentElement:Pc,getClippingRect:iG,getOffsetParent:d3,getElementRects:oG,getClientRects:Y8,getDimensions:nG,getScale:Cm,isElement:Xl,isRTL:aG};function f3(i,t){return i.x===t.x&&i.y===t.y&&i.width===t.width&&i.height===t.height}function cG(i,t){let a=null,h;const g=Pc(i);function v(){var o;clearTimeout(h),(o=a)==null||o.disconnect(),a=null}function E(o,O){o===void 0&&(o=!1),O===void 0&&(O=1),v();const F=i.getBoundingClientRect(),{left:$,top:Q,width:te,height:J}=F;if(o||t(),!te||!J)return;const we=Ux(Q),se=Ux(g.clientWidth-($+te)),me=Ux(g.clientHeight-(Q+J)),fe=Ux($),de={rootMargin:-we+"px "+-se+"px "+-me+"px "+-fe+"px",threshold:ja(0,$h(1,O))||1};let Oe=!0;function Xe(qe){const Be=qe[0].intersectionRatio;if(Be!==O){if(!Oe)return E();Be?E(!1,Be):h=setTimeout(()=>{E(!1,1e-7)},1e3)}Be===1&&!f3(F,i.getBoundingClientRect())&&E(),Oe=!1}try{a=new IntersectionObserver(Xe,{...de,root:g.ownerDocument})}catch{a=new IntersectionObserver(Xe,de)}a.observe(i)}return E(!0),v}function uG(i,t,a,h){h===void 0&&(h={});const{ancestorScroll:g=!0,ancestorResize:v=!0,elementResize:E=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:O=!1}=h,F=EI(i),$=g||v?[...F?l0(F):[],...l0(t)]:[];$.forEach(fe=>{g&&fe.addEventListener("scroll",a,{passive:!0}),v&&fe.addEventListener("resize",a)});const Q=F&&o?cG(F,a):null;let te=-1,J=null;E&&(J=new ResizeObserver(fe=>{let[re]=fe;re&&re.target===F&&J&&(J.unobserve(t),cancelAnimationFrame(te),te=requestAnimationFrame(()=>{var de;(de=J)==null||de.observe(t)})),a()}),F&&!O&&J.observe(F),J.observe(t));let we,se=O?bf(i):null;O&&me();function me(){const fe=bf(i);se&&!f3(se,fe)&&a(),se=fe,we=requestAnimationFrame(me)}return a(),()=>{var fe;$.forEach(re=>{g&&re.removeEventListener("scroll",a),v&&re.removeEventListener("resize",a)}),Q==null||Q(),(fe=J)==null||fe.disconnect(),J=null,O&&cancelAnimationFrame(we)}}const hG=L8,dG=z8,fG=M8,pG=B8,mG=O8,IM=k8,gG=F8,_G=(i,t,a)=>{const h=new Map,g={platform:lG,...a},v={...g.platform,_c:h};return R8(i,t,{...g,platform:v})};var yG=typeof document<"u",vG=function(){},m1=yG?ke.useLayoutEffect:vG;function K1(i,t){if(i===t)return!0;if(typeof i!=typeof t)return!1;if(typeof i=="function"&&i.toString()===t.toString())return!0;let a,h,g;if(i&&t&&typeof i=="object"){if(Array.isArray(i)){if(a=i.length,a!==t.length)return!1;for(h=a;h--!==0;)if(!K1(i[h],t[h]))return!1;return!0}if(g=Object.keys(i),a=g.length,a!==Object.keys(t).length)return!1;for(h=a;h--!==0;)if(!{}.hasOwnProperty.call(t,g[h]))return!1;for(h=a;h--!==0;){const v=g[h];if(!(v==="_owner"&&i.$$typeof)&&!K1(i[v],t[v]))return!1}return!0}return i!==i&&t!==t}function p3(i){return typeof window>"u"?1:(i.ownerDocument.defaultView||window).devicePixelRatio||1}function AM(i,t){const a=p3(i);return Math.round(t*a)/a}function kS(i){const t=ke.useRef(i);return m1(()=>{t.current=i}),t}function xG(i){i===void 0&&(i={});const{placement:t="bottom",strategy:a="absolute",middleware:h=[],platform:g,elements:{reference:v,floating:E}={},transform:o=!0,whileElementsMounted:O,open:F}=i,[$,Q]=ke.useState({x:0,y:0,strategy:a,placement:t,middlewareData:{},isPositioned:!1}),[te,J]=ke.useState(h);K1(te,h)||J(h);const[we,se]=ke.useState(null),[me,fe]=ke.useState(null),re=ke.useCallback(dt=>{dt!==qe.current&&(qe.current=dt,se(dt))},[]),de=ke.useCallback(dt=>{dt!==Be.current&&(Be.current=dt,fe(dt))},[]),Oe=v||we,Xe=E||me,qe=ke.useRef(null),Be=ke.useRef(null),bt=ke.useRef($),Bt=O!=null,Jt=kS(O),nr=kS(g),Gt=kS(F),Mt=ke.useCallback(()=>{if(!qe.current||!Be.current)return;const dt={placement:t,strategy:a,middleware:te};nr.current&&(dt.platform=nr.current),_G(qe.current,Be.current,dt).then(It=>{const tr={...It,isPositioned:Gt.current!==!1};Zt.current&&!K1(bt.current,tr)&&(bt.current=tr,S0.flushSync(()=>{Q(tr)}))})},[te,t,a,nr,Gt]);m1(()=>{F===!1&&bt.current.isPositioned&&(bt.current.isPositioned=!1,Q(dt=>({...dt,isPositioned:!1})))},[F]);const Zt=ke.useRef(!1);m1(()=>(Zt.current=!0,()=>{Zt.current=!1}),[]),m1(()=>{if(Oe&&(qe.current=Oe),Xe&&(Be.current=Xe),Oe&&Xe){if(Jt.current)return Jt.current(Oe,Xe,Mt);Mt()}},[Oe,Xe,Mt,Jt,Bt]);const mr=ke.useMemo(()=>({reference:qe,floating:Be,setReference:re,setFloating:de}),[re,de]),Qt=ke.useMemo(()=>({reference:Oe,floating:Xe}),[Oe,Xe]),er=ke.useMemo(()=>{const dt={position:a,left:0,top:0};if(!Qt.floating)return dt;const It=AM(Qt.floating,$.x),tr=AM(Qt.floating,$.y);return o?{...dt,transform:"translate("+It+"px, "+tr+"px)",...p3(Qt.floating)>=1.5&&{willChange:"transform"}}:{position:a,left:It,top:tr}},[a,o,Qt.floating,$.x,$.y]);return ke.useMemo(()=>({...$,update:Mt,refs:mr,elements:Qt,floatingStyles:er}),[$,Mt,mr,Qt,er])}const wG=i=>{function t(a){return{}.hasOwnProperty.call(a,"current")}return{name:"arrow",options:i,fn(a){const{element:h,padding:g}=typeof i=="function"?i(a):i;return h&&t(h)?h.current!=null?IM({element:h.current,padding:g}).fn(a):{}:h?IM({element:h,padding:g}).fn(a):{}}}},bG=(i,t)=>({...hG(i),options:[i,t]}),TG=(i,t)=>({...dG(i),options:[i,t]}),SG=(i,t)=>({...gG(i),options:[i,t]}),EG=(i,t)=>({...fG(i),options:[i,t]}),IG=(i,t)=>({...pG(i),options:[i,t]}),AG=(i,t)=>({...mG(i),options:[i,t]}),CG=(i,t)=>({...wG(i),options:[i,t]});var PG="Arrow",m3=ke.forwardRef((i,t)=>{const{children:a,width:h=10,height:g=5,...v}=i;return ye.jsx(oa.svg,{...v,ref:t,width:h,height:g,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:i.asChild?a:ye.jsx("polygon",{points:"0,0 30,0 15,10"})})});m3.displayName=PG;var RG=m3;function kG(i){const[t,a]=ke.useState(void 0);return Uh(()=>{if(i){a({width:i.offsetWidth,height:i.offsetHeight});const h=new ResizeObserver(g=>{if(!Array.isArray(g)||!g.length)return;const v=g[0];let E,o;if("borderBoxSize"in v){const O=v.borderBoxSize,F=Array.isArray(O)?O[0]:O;E=F.inlineSize,o=F.blockSize}else E=i.offsetWidth,o=i.offsetHeight;a({width:E,height:o})});return h.observe(i,{box:"border-box"}),()=>h.unobserve(i)}else a(void 0)},[i]),t}var g3="Popper",[_3,y3]=kw(g3),[_Z,v3]=_3(g3),x3="PopperAnchor",w3=ke.forwardRef((i,t)=>{const{__scopePopper:a,virtualRef:h,...g}=i,v=v3(x3,a),E=ke.useRef(null),o=Zl(t,E);return ke.useEffect(()=>{v.onAnchorChange((h==null?void 0:h.current)||E.current)}),h?null:ye.jsx(oa.div,{...g,ref:o})});w3.displayName=x3;var AI="PopperContent",[MG,OG]=_3(AI),b3=ke.forwardRef((i,t)=>{var wi,Vn,Hr,Pi,Qi,Fn;const{__scopePopper:a,side:h="bottom",sideOffset:g=0,align:v="center",alignOffset:E=0,arrowPadding:o=0,avoidCollisions:O=!0,collisionBoundary:F=[],collisionPadding:$=0,sticky:Q="partial",hideWhenDetached:te=!1,updatePositionStrategy:J="optimized",onPlaced:we,...se}=i,me=v3(AI,a),[fe,re]=ke.useState(null),de=Zl(t,bi=>re(bi)),[Oe,Xe]=ke.useState(null),qe=kG(Oe),Be=(qe==null?void 0:qe.width)??0,bt=(qe==null?void 0:qe.height)??0,Bt=h+(v!=="center"?"-"+v:""),Jt=typeof $=="number"?$:{top:0,right:0,bottom:0,left:0,...$},nr=Array.isArray(F)?F:[F],Gt=nr.length>0,Mt={padding:Jt,boundary:nr.filter(LG),altBoundary:Gt},{refs:Zt,floatingStyles:mr,placement:Qt,isPositioned:er,middlewareData:dt}=xG({strategy:"fixed",placement:Bt,whileElementsMounted:(...bi)=>uG(...bi,{animationFrame:J==="always"}),elements:{reference:me.anchor},middleware:[bG({mainAxis:g+bt,alignmentAxis:E}),O&&TG({mainAxis:!0,crossAxis:!1,limiter:Q==="partial"?SG():void 0,...Mt}),O&&EG({...Mt}),IG({...Mt,apply:({elements:bi,rects:ns,availableWidth:ss,availableHeight:Qn})=>{const{width:Ss,height:Gi}=ns.reference,Js=bi.floating.style;Js.setProperty("--radix-popper-available-width",`${ss}px`),Js.setProperty("--radix-popper-available-height",`${Qn}px`),Js.setProperty("--radix-popper-anchor-width",`${Ss}px`),Js.setProperty("--radix-popper-anchor-height",`${Gi}px`)}}),Oe&&CG({element:Oe,padding:o}),zG({arrowWidth:Be,arrowHeight:bt}),te&&AG({strategy:"referenceHidden",...Mt})]}),[It,tr]=E3(Qt),Gr=Vh(we);Uh(()=>{er&&(Gr==null||Gr())},[er,Gr]);const Rr=(wi=dt.arrow)==null?void 0:wi.x,Sr=(Vn=dt.arrow)==null?void 0:Vn.y,ti=((Hr=dt.arrow)==null?void 0:Hr.centerOffset)!==0,[Vi,On]=ke.useState();return Uh(()=>{fe&&On(window.getComputedStyle(fe).zIndex)},[fe]),ye.jsx("div",{ref:Zt.setFloating,"data-radix-popper-content-wrapper":"",style:{...mr,transform:er?mr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Vi,"--radix-popper-transform-origin":[(Pi=dt.transformOrigin)==null?void 0:Pi.x,(Qi=dt.transformOrigin)==null?void 0:Qi.y].join(" "),...((Fn=dt.hide)==null?void 0:Fn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:i.dir,children:ye.jsx(MG,{scope:a,placedSide:It,onArrowChange:Xe,arrowX:Rr,arrowY:Sr,shouldHideArrow:ti,children:ye.jsx(oa.div,{"data-side":It,"data-align":tr,...se,ref:de,style:{...se.style,animation:er?void 0:"none"}})})})});b3.displayName=AI;var T3="PopperArrow",DG={top:"bottom",right:"left",bottom:"top",left:"right"},S3=ke.forwardRef(function(t,a){const{__scopePopper:h,...g}=t,v=OG(T3,h),E=DG[v.placedSide];return ye.jsx("span",{ref:v.onArrowChange,style:{position:"absolute",left:v.arrowX,top:v.arrowY,[E]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[v.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[v.placedSide],visibility:v.shouldHideArrow?"hidden":void 0},children:ye.jsx(RG,{...g,ref:a,style:{...g.style,display:"block"}})})});S3.displayName=T3;function LG(i){return i!==null}var zG=i=>({name:"transformOrigin",options:i,fn(t){var me,fe,re;const{placement:a,rects:h,middlewareData:g}=t,E=((me=g.arrow)==null?void 0:me.centerOffset)!==0,o=E?0:i.arrowWidth,O=E?0:i.arrowHeight,[F,$]=E3(a),Q={start:"0%",center:"50%",end:"100%"}[$],te=(((fe=g.arrow)==null?void 0:fe.x)??0)+o/2,J=(((re=g.arrow)==null?void 0:re.y)??0)+O/2;let we="",se="";return F==="bottom"?(we=E?Q:`${te}px`,se=`${-O}px`):F==="top"?(we=E?Q:`${te}px`,se=`${h.floating.height+O}px`):F==="right"?(we=`${-O}px`,se=E?Q:`${J}px`):F==="left"&&(we=`${h.floating.width+O}px`,se=E?Q:`${J}px`),{data:{x:we,y:se}}}});function E3(i){const[t,a="center"]=i.split("-");return[t,a]}var FG=w3,BG=b3,NG=S3,[Bw,yZ]=kw("Tooltip",[y3]),CI=y3(),I3="TooltipProvider",jG=700,CM="tooltip.open",[VG,A3]=Bw(I3),C3=i=>{const{__scopeTooltip:t,delayDuration:a=jG,skipDelayDuration:h=300,disableHoverableContent:g=!1,children:v}=i,E=ke.useRef(!0),o=ke.useRef(!1),O=ke.useRef(0);return ke.useEffect(()=>{const F=O.current;return()=>window.clearTimeout(F)},[]),ye.jsx(VG,{scope:t,isOpenDelayedRef:E,delayDuration:a,onOpen:ke.useCallback(()=>{window.clearTimeout(O.current),E.current=!1},[]),onClose:ke.useCallback(()=>{window.clearTimeout(O.current),O.current=window.setTimeout(()=>E.current=!0,h)},[h]),isPointerInTransitRef:o,onPointerInTransitChange:ke.useCallback(F=>{o.current=F},[]),disableHoverableContent:g,children:v})};C3.displayName=I3;var P3="Tooltip",[vZ,Nw]=Bw(P3),WE="TooltipTrigger",UG=ke.forwardRef((i,t)=>{const{__scopeTooltip:a,...h}=i,g=Nw(WE,a),v=A3(WE,a),E=CI(a),o=ke.useRef(null),O=Zl(t,o,g.onTriggerChange),F=ke.useRef(!1),$=ke.useRef(!1),Q=ke.useCallback(()=>F.current=!1,[]);return ke.useEffect(()=>()=>document.removeEventListener("pointerup",Q),[Q]),ye.jsx(FG,{asChild:!0,...E,children:ye.jsx(oa.button,{"aria-describedby":g.open?g.contentId:void 0,"data-state":g.stateAttribute,...h,ref:O,onPointerMove:Ks(i.onPointerMove,te=>{te.pointerType!=="touch"&&!$.current&&!v.isPointerInTransitRef.current&&(g.onTriggerEnter(),$.current=!0)}),onPointerLeave:Ks(i.onPointerLeave,()=>{g.onTriggerLeave(),$.current=!1}),onPointerDown:Ks(i.onPointerDown,()=>{g.open&&g.onClose(),F.current=!0,document.addEventListener("pointerup",Q,{once:!0})}),onFocus:Ks(i.onFocus,()=>{F.current||g.onOpen()}),onBlur:Ks(i.onBlur,g.onClose),onClick:Ks(i.onClick,g.onClose)})})});UG.displayName=WE;var $G="TooltipPortal",[xZ,GG]=Bw($G,{forceMount:void 0}),Wm="TooltipContent",R3=ke.forwardRef((i,t)=>{const a=GG(Wm,i.__scopeTooltip),{forceMount:h=a.forceMount,side:g="top",...v}=i,E=Nw(Wm,i.__scopeTooltip);return ye.jsx(mI,{present:h||E.open,children:E.disableHoverableContent?ye.jsx(k3,{side:g,...v,ref:t}):ye.jsx(HG,{side:g,...v,ref:t})})}),HG=ke.forwardRef((i,t)=>{const a=Nw(Wm,i.__scopeTooltip),h=A3(Wm,i.__scopeTooltip),g=ke.useRef(null),v=Zl(t,g),[E,o]=ke.useState(null),{trigger:O,onClose:F}=a,$=g.current,{onPointerInTransitChange:Q}=h,te=ke.useCallback(()=>{o(null),Q(!1)},[Q]),J=ke.useCallback((we,se)=>{const me=we.currentTarget,fe={x:we.clientX,y:we.clientY},re=KG(fe,me.getBoundingClientRect()),de=YG(fe,re),Oe=JG(se.getBoundingClientRect()),Xe=eH([...de,...Oe]);o(Xe),Q(!0)},[Q]);return ke.useEffect(()=>()=>te(),[te]),ke.useEffect(()=>{if(O&&$){const we=me=>J(me,$),se=me=>J(me,O);return O.addEventListener("pointerleave",we),$.addEventListener("pointerleave",se),()=>{O.removeEventListener("pointerleave",we),$.removeEventListener("pointerleave",se)}}},[O,$,J,te]),ke.useEffect(()=>{if(E){const we=se=>{const me=se.target,fe={x:se.clientX,y:se.clientY},re=(O==null?void 0:O.contains(me))||($==null?void 0:$.contains(me)),de=!QG(fe,E);re?te():de&&(te(),F())};return document.addEventListener("pointermove",we),()=>document.removeEventListener("pointermove",we)}},[O,$,E,F,te]),ye.jsx(k3,{...i,ref:v})}),[qG,WG]=Bw(P3,{isInside:!1}),ZG=$U("TooltipContent"),k3=ke.forwardRef((i,t)=>{const{__scopeTooltip:a,children:h,"aria-label":g,onEscapeKeyDown:v,onPointerDownOutside:E,...o}=i,O=Nw(Wm,a),F=CI(a),{onClose:$}=O;return ke.useEffect(()=>(document.addEventListener(CM,$),()=>document.removeEventListener(CM,$)),[$]),ke.useEffect(()=>{if(O.trigger){const Q=te=>{const J=te.target;J!=null&&J.contains(O.trigger)&&$()};return window.addEventListener("scroll",Q,{capture:!0}),()=>window.removeEventListener("scroll",Q,{capture:!0})}},[O.trigger,$]),ye.jsx(pI,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:v,onPointerDownOutside:E,onFocusOutside:Q=>Q.preventDefault(),onDismiss:$,children:ye.jsxs(BG,{"data-state":O.stateAttribute,...F,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[ye.jsx(ZG,{children:h}),ye.jsx(qG,{scope:a,isInside:!0,children:ye.jsx(p6,{id:O.contentId,role:"tooltip",children:g||h})})]})})});R3.displayName=Wm;var M3="TooltipArrow",XG=ke.forwardRef((i,t)=>{const{__scopeTooltip:a,...h}=i,g=CI(a);return WG(M3,a).isInside?null:ye.jsx(NG,{...g,...h,ref:t})});XG.displayName=M3;function KG(i,t){const a=Math.abs(t.top-i.y),h=Math.abs(t.bottom-i.y),g=Math.abs(t.right-i.x),v=Math.abs(t.left-i.x);switch(Math.min(a,h,g,v)){case v:return"left";case g:return"right";case a:return"top";case h:return"bottom";default:throw new Error("unreachable")}}function YG(i,t,a=5){const h=[];switch(t){case"top":h.push({x:i.x-a,y:i.y+a},{x:i.x+a,y:i.y+a});break;case"bottom":h.push({x:i.x-a,y:i.y-a},{x:i.x+a,y:i.y-a});break;case"left":h.push({x:i.x+a,y:i.y-a},{x:i.x+a,y:i.y+a});break;case"right":h.push({x:i.x-a,y:i.y-a},{x:i.x-a,y:i.y+a});break}return h}function JG(i){const{top:t,right:a,bottom:h,left:g}=i;return[{x:g,y:t},{x:a,y:t},{x:a,y:h},{x:g,y:h}]}function QG(i,t){const{x:a,y:h}=i;let g=!1;for(let v=0,E=t.length-1;v<t.length;E=v++){const o=t[v],O=t[E],F=o.x,$=o.y,Q=O.x,te=O.y;$>h!=te>h&&a<(Q-F)*(h-$)/(te-$)+F&&(g=!g)}return g}function eH(i){const t=i.slice();return t.sort((a,h)=>a.x<h.x?-1:a.x>h.x?1:a.y<h.y?-1:a.y>h.y?1:0),tH(t)}function tH(i){if(i.length<=1)return i.slice();const t=[];for(let h=0;h<i.length;h++){const g=i[h];for(;t.length>=2;){const v=t[t.length-1],E=t[t.length-2];if((v.x-E.x)*(g.y-E.y)>=(v.y-E.y)*(g.x-E.x))t.pop();else break}t.push(g)}t.pop();const a=[];for(let h=i.length-1;h>=0;h--){const g=i[h];for(;a.length>=2;){const v=a[a.length-1],E=a[a.length-2];if((v.x-E.x)*(g.y-E.y)>=(v.y-E.y)*(g.x-E.x))a.pop();else break}a.push(g)}return a.pop(),t.length===1&&a.length===1&&t[0].x===a[0].x&&t[0].y===a[0].y?t:t.concat(a)}var rH=C3,O3=R3;const iH=rH,nH=ke.forwardRef(({className:i,sideOffset:t=4,...a},h)=>ye.jsx(O3,{ref:h,sideOffset:t,className:Jn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",i),...a}));nH.displayName=O3.displayName;var jw=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(i){return this.listeners.add(i),this.onSubscribe(),()=>{this.listeners.delete(i),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Vw=typeof window>"u"||"Deno"in globalThis;function zl(){}function sH(i,t){return typeof i=="function"?i(t):i}function oH(i){return typeof i=="number"&&i>=0&&i!==1/0}function aH(i,t){return Math.max(i+(t||0)-Date.now(),0)}function ZE(i,t){return typeof i=="function"?i(t):i}function lH(i,t){return typeof i=="function"?i(t):i}function PM(i,t){const{type:a="all",exact:h,fetchStatus:g,predicate:v,queryKey:E,stale:o}=i;if(E){if(h){if(t.queryHash!==PI(E,t.options))return!1}else if(!u0(t.queryKey,E))return!1}if(a!=="all"){const O=t.isActive();if(a==="active"&&!O||a==="inactive"&&O)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||g&&g!==t.state.fetchStatus||v&&!v(t))}function RM(i,t){const{exact:a,status:h,predicate:g,mutationKey:v}=i;if(v){if(!t.options.mutationKey)return!1;if(a){if(c0(t.options.mutationKey)!==c0(v))return!1}else if(!u0(t.options.mutationKey,v))return!1}return!(h&&t.state.status!==h||g&&!g(t))}function PI(i,t){return((t==null?void 0:t.queryKeyHashFn)||c0)(i)}function c0(i){return JSON.stringify(i,(t,a)=>XE(a)?Object.keys(a).sort().reduce((h,g)=>(h[g]=a[g],h),{}):a)}function u0(i,t){return i===t?!0:typeof i!=typeof t?!1:i&&t&&typeof i=="object"&&typeof t=="object"?Object.keys(t).every(a=>u0(i[a],t[a])):!1}function D3(i,t){if(i===t)return i;const a=kM(i)&&kM(t);if(a||XE(i)&&XE(t)){const h=a?i:Object.keys(i),g=h.length,v=a?t:Object.keys(t),E=v.length,o=a?[]:{},O=new Set(h);let F=0;for(let $=0;$<E;$++){const Q=a?$:v[$];(!a&&O.has(Q)||a)&&i[Q]===void 0&&t[Q]===void 0?(o[Q]=void 0,F++):(o[Q]=D3(i[Q],t[Q]),o[Q]===i[Q]&&i[Q]!==void 0&&F++)}return g===E&&F===g?i:o}return t}function kM(i){return Array.isArray(i)&&i.length===Object.keys(i).length}function XE(i){if(!MM(i))return!1;const t=i.constructor;if(t===void 0)return!0;const a=t.prototype;return!(!MM(a)||!a.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(i)!==Object.prototype)}function MM(i){return Object.prototype.toString.call(i)==="[object Object]"}function cH(i){return new Promise(t=>{setTimeout(t,i)})}function uH(i,t,a){return typeof a.structuralSharing=="function"?a.structuralSharing(i,t):a.structuralSharing!==!1?D3(i,t):t}function hH(i,t,a=0){const h=[...i,t];return a&&h.length>a?h.slice(1):h}function dH(i,t,a=0){const h=[t,...i];return a&&h.length>a?h.slice(0,-1):h}var RI=Symbol();function L3(i,t){return!i.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!i.queryFn||i.queryFn===RI?()=>Promise.reject(new Error(`Missing queryFn: '${i.queryHash}'`)):i.queryFn}var cf,wh,km,GO,fH=(GO=class extends jw{constructor(){super();bn(this,cf);bn(this,wh);bn(this,km);zi(this,km,t=>{if(!Vw&&window.addEventListener){const a=()=>t();return window.addEventListener("visibilitychange",a,!1),()=>{window.removeEventListener("visibilitychange",a)}}})}onSubscribe(){Ut(this,wh)||this.setEventListener(Ut(this,km))}onUnsubscribe(){var t;this.hasListeners()||((t=Ut(this,wh))==null||t.call(this),zi(this,wh,void 0))}setEventListener(t){var a;zi(this,km,t),(a=Ut(this,wh))==null||a.call(this),zi(this,wh,t(h=>{typeof h=="boolean"?this.setFocused(h):this.onFocus()}))}setFocused(t){Ut(this,cf)!==t&&(zi(this,cf,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(a=>{a(t)})}isFocused(){var t;return typeof Ut(this,cf)=="boolean"?Ut(this,cf):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},cf=new WeakMap,wh=new WeakMap,km=new WeakMap,GO),z3=new fH,Mm,bh,Om,HO,pH=(HO=class extends jw{constructor(){super();bn(this,Mm,!0);bn(this,bh);bn(this,Om);zi(this,Om,t=>{if(!Vw&&window.addEventListener){const a=()=>t(!0),h=()=>t(!1);return window.addEventListener("online",a,!1),window.addEventListener("offline",h,!1),()=>{window.removeEventListener("online",a),window.removeEventListener("offline",h)}}})}onSubscribe(){Ut(this,bh)||this.setEventListener(Ut(this,Om))}onUnsubscribe(){var t;this.hasListeners()||((t=Ut(this,bh))==null||t.call(this),zi(this,bh,void 0))}setEventListener(t){var a;zi(this,Om,t),(a=Ut(this,bh))==null||a.call(this),zi(this,bh,t(this.setOnline.bind(this)))}setOnline(t){Ut(this,Mm)!==t&&(zi(this,Mm,t),this.listeners.forEach(h=>{h(t)}))}isOnline(){return Ut(this,Mm)}},Mm=new WeakMap,bh=new WeakMap,Om=new WeakMap,HO),Y1=new pH;function mH(){let i,t;const a=new Promise((g,v)=>{i=g,t=v});a.status="pending",a.catch(()=>{});function h(g){Object.assign(a,g),delete a.resolve,delete a.reject}return a.resolve=g=>{h({status:"fulfilled",value:g}),i(g)},a.reject=g=>{h({status:"rejected",reason:g}),t(g)},a}function gH(i){return Math.min(1e3*2**i,3e4)}function F3(i){return(i??"online")==="online"?Y1.isOnline():!0}var B3=class extends Error{constructor(i){super("CancelledError"),this.revert=i==null?void 0:i.revert,this.silent=i==null?void 0:i.silent}};function MS(i){return i instanceof B3}function N3(i){let t=!1,a=0,h=!1,g;const v=mH(),E=se=>{var me;h||(te(new B3(se)),(me=i.abort)==null||me.call(i))},o=()=>{t=!0},O=()=>{t=!1},F=()=>z3.isFocused()&&(i.networkMode==="always"||Y1.isOnline())&&i.canRun(),$=()=>F3(i.networkMode)&&i.canRun(),Q=se=>{var me;h||(h=!0,(me=i.onSuccess)==null||me.call(i,se),g==null||g(),v.resolve(se))},te=se=>{var me;h||(h=!0,(me=i.onError)==null||me.call(i,se),g==null||g(),v.reject(se))},J=()=>new Promise(se=>{var me;g=fe=>{(h||F())&&se(fe)},(me=i.onPause)==null||me.call(i)}).then(()=>{var se;g=void 0,h||(se=i.onContinue)==null||se.call(i)}),we=()=>{if(h)return;let se;const me=a===0?i.initialPromise:void 0;try{se=me??i.fn()}catch(fe){se=Promise.reject(fe)}Promise.resolve(se).then(Q).catch(fe=>{var qe;if(h)return;const re=i.retry??(Vw?0:3),de=i.retryDelay??gH,Oe=typeof de=="function"?de(a,fe):de,Xe=re===!0||typeof re=="number"&&a<re||typeof re=="function"&&re(a,fe);if(t||!Xe){te(fe);return}a++,(qe=i.onFail)==null||qe.call(i,a,fe),cH(Oe).then(()=>F()?void 0:J()).then(()=>{t?te(fe):we()})})};return{promise:v,cancel:E,continue:()=>(g==null||g(),v),cancelRetry:o,continueRetry:O,canStart:$,start:()=>($()?we():J().then(we),v)}}var _H=i=>setTimeout(i,0);function yH(){let i=[],t=0,a=o=>{o()},h=o=>{o()},g=_H;const v=o=>{t?i.push(o):g(()=>{a(o)})},E=()=>{const o=i;i=[],o.length&&g(()=>{h(()=>{o.forEach(O=>{a(O)})})})};return{batch:o=>{let O;t++;try{O=o()}finally{t--,t||E()}return O},batchCalls:o=>(...O)=>{v(()=>{o(...O)})},schedule:v,setNotifyFunction:o=>{a=o},setBatchNotifyFunction:o=>{h=o},setScheduler:o=>{g=o}}}var ta=yH(),uf,qO,j3=(qO=class{constructor(){bn(this,uf)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),oH(this.gcTime)&&zi(this,uf,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(i){this.gcTime=Math.max(this.gcTime||0,i??(Vw?1/0:5*60*1e3))}clearGcTimeout(){Ut(this,uf)&&(clearTimeout(Ut(this,uf)),zi(this,uf,void 0))}},uf=new WeakMap,qO),Dm,hf,sl,df,ko,_0,ff,Bl,ru,WO,vH=(WO=class extends j3{constructor(t){super();bn(this,Bl);bn(this,Dm);bn(this,hf);bn(this,sl);bn(this,df);bn(this,ko);bn(this,_0);bn(this,ff);zi(this,ff,!1),zi(this,_0,t.defaultOptions),this.setOptions(t.options),this.observers=[],zi(this,df,t.client),zi(this,sl,Ut(this,df).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,zi(this,Dm,wH(this.options)),this.state=t.state??Ut(this,Dm),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Ut(this,ko))==null?void 0:t.promise}setOptions(t){this.options={...Ut(this,_0),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ut(this,sl).remove(this)}setData(t,a){const h=uH(this.state.data,t,this.options);return Ao(this,Bl,ru).call(this,{data:h,type:"success",dataUpdatedAt:a==null?void 0:a.updatedAt,manual:a==null?void 0:a.manual}),h}setState(t,a){Ao(this,Bl,ru).call(this,{type:"setState",state:t,setStateOptions:a})}cancel(t){var h,g;const a=(h=Ut(this,ko))==null?void 0:h.promise;return(g=Ut(this,ko))==null||g.cancel(t),a?a.then(zl).catch(zl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ut(this,Dm))}isActive(){return this.observers.some(t=>lH(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===RI||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ZE(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!aH(this.state.dataUpdatedAt,t)}onFocus(){var a;const t=this.observers.find(h=>h.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(a=Ut(this,ko))==null||a.continue()}onOnline(){var a;const t=this.observers.find(h=>h.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(a=Ut(this,ko))==null||a.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Ut(this,sl).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(a=>a!==t),this.observers.length||(Ut(this,ko)&&(Ut(this,ff)?Ut(this,ko).cancel({revert:!0}):Ut(this,ko).cancelRetry()),this.scheduleGc()),Ut(this,sl).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ao(this,Bl,ru).call(this,{type:"invalidate"})}fetch(t,a){var F,$,Q;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(a!=null&&a.cancelRefetch))this.cancel({silent:!0});else if(Ut(this,ko))return Ut(this,ko).continueRetry(),Ut(this,ko).promise}if(t&&this.setOptions(t),!this.options.queryFn){const te=this.observers.find(J=>J.options.queryFn);te&&this.setOptions(te.options)}const h=new AbortController,g=te=>{Object.defineProperty(te,"signal",{enumerable:!0,get:()=>(zi(this,ff,!0),h.signal)})},v=()=>{const te=L3(this.options,a),we=(()=>{const se={client:Ut(this,df),queryKey:this.queryKey,meta:this.meta};return g(se),se})();return zi(this,ff,!1),this.options.persister?this.options.persister(te,we,this):te(we)},o=(()=>{const te={fetchOptions:a,options:this.options,queryKey:this.queryKey,client:Ut(this,df),state:this.state,fetchFn:v};return g(te),te})();(F=this.options.behavior)==null||F.onFetch(o,this),zi(this,hf,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==(($=o.fetchOptions)==null?void 0:$.meta))&&Ao(this,Bl,ru).call(this,{type:"fetch",meta:(Q=o.fetchOptions)==null?void 0:Q.meta});const O=te=>{var J,we,se,me;MS(te)&&te.silent||Ao(this,Bl,ru).call(this,{type:"error",error:te}),MS(te)||((we=(J=Ut(this,sl).config).onError)==null||we.call(J,te,this),(me=(se=Ut(this,sl).config).onSettled)==null||me.call(se,this.state.data,te,this)),this.scheduleGc()};return zi(this,ko,N3({initialPromise:a==null?void 0:a.initialPromise,fn:o.fetchFn,abort:h.abort.bind(h),onSuccess:te=>{var J,we,se,me;if(te===void 0){O(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(te)}catch(fe){O(fe);return}(we=(J=Ut(this,sl).config).onSuccess)==null||we.call(J,te,this),(me=(se=Ut(this,sl).config).onSettled)==null||me.call(se,te,this.state.error,this),this.scheduleGc()},onError:O,onFail:(te,J)=>{Ao(this,Bl,ru).call(this,{type:"failed",failureCount:te,error:J})},onPause:()=>{Ao(this,Bl,ru).call(this,{type:"pause"})},onContinue:()=>{Ao(this,Bl,ru).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),Ut(this,ko).start()}},Dm=new WeakMap,hf=new WeakMap,sl=new WeakMap,df=new WeakMap,ko=new WeakMap,_0=new WeakMap,ff=new WeakMap,Bl=new WeakSet,ru=function(t){const a=h=>{switch(t.type){case"failed":return{...h,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...h,fetchStatus:"paused"};case"continue":return{...h,fetchStatus:"fetching"};case"fetch":return{...h,...xH(h.data,this.options),fetchMeta:t.meta??null};case"success":return zi(this,hf,void 0),{...h,data:t.data,dataUpdateCount:h.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const g=t.error;return MS(g)&&g.revert&&Ut(this,hf)?{...Ut(this,hf),fetchStatus:"idle"}:{...h,error:g,errorUpdateCount:h.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:h.fetchFailureCount+1,fetchFailureReason:g,fetchStatus:"idle",status:"error"};case"invalidate":return{...h,isInvalidated:!0};case"setState":return{...h,...t.state}}};this.state=a(this.state),ta.batch(()=>{this.observers.forEach(h=>{h.onQueryUpdate()}),Ut(this,sl).notify({query:this,type:"updated",action:t})})},WO);function xH(i,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:F3(t.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function wH(i){const t=typeof i.initialData=="function"?i.initialData():i.initialData,a=t!==void 0,h=a?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:a?h??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:a?"success":"pending",fetchStatus:"idle"}}var yc,ZO,bH=(ZO=class extends jw{constructor(t={}){super();bn(this,yc);this.config=t,zi(this,yc,new Map)}build(t,a,h){const g=a.queryKey,v=a.queryHash??PI(g,a);let E=this.get(v);return E||(E=new vH({client:t,queryKey:g,queryHash:v,options:t.defaultQueryOptions(a),state:h,defaultOptions:t.getQueryDefaults(g)}),this.add(E)),E}add(t){Ut(this,yc).has(t.queryHash)||(Ut(this,yc).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const a=Ut(this,yc).get(t.queryHash);a&&(t.destroy(),a===t&&Ut(this,yc).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){ta.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Ut(this,yc).get(t)}getAll(){return[...Ut(this,yc).values()]}find(t){const a={exact:!0,...t};return this.getAll().find(h=>PM(a,h))}findAll(t={}){const a=this.getAll();return Object.keys(t).length>0?a.filter(h=>PM(t,h)):a}notify(t){ta.batch(()=>{this.listeners.forEach(a=>{a(t)})})}onFocus(){ta.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){ta.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},yc=new WeakMap,ZO),vc,Jo,pf,xc,ph,XO,TH=(XO=class extends j3{constructor(t){super();bn(this,xc);bn(this,vc);bn(this,Jo);bn(this,pf);this.mutationId=t.mutationId,zi(this,Jo,t.mutationCache),zi(this,vc,[]),this.state=t.state||SH(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Ut(this,vc).includes(t)||(Ut(this,vc).push(t),this.clearGcTimeout(),Ut(this,Jo).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){zi(this,vc,Ut(this,vc).filter(a=>a!==t)),this.scheduleGc(),Ut(this,Jo).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Ut(this,vc).length||(this.state.status==="pending"?this.scheduleGc():Ut(this,Jo).remove(this))}continue(){var t;return((t=Ut(this,pf))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var v,E,o,O,F,$,Q,te,J,we,se,me,fe,re,de,Oe,Xe,qe,Be,bt;const a=()=>{Ao(this,xc,ph).call(this,{type:"continue"})};zi(this,pf,N3({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Bt,Jt)=>{Ao(this,xc,ph).call(this,{type:"failed",failureCount:Bt,error:Jt})},onPause:()=>{Ao(this,xc,ph).call(this,{type:"pause"})},onContinue:a,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ut(this,Jo).canRun(this)}));const h=this.state.status==="pending",g=!Ut(this,pf).canStart();try{if(h)a();else{Ao(this,xc,ph).call(this,{type:"pending",variables:t,isPaused:g}),await((E=(v=Ut(this,Jo).config).onMutate)==null?void 0:E.call(v,t,this));const Jt=await((O=(o=this.options).onMutate)==null?void 0:O.call(o,t));Jt!==this.state.context&&Ao(this,xc,ph).call(this,{type:"pending",context:Jt,variables:t,isPaused:g})}const Bt=await Ut(this,pf).start();return await(($=(F=Ut(this,Jo).config).onSuccess)==null?void 0:$.call(F,Bt,t,this.state.context,this)),await((te=(Q=this.options).onSuccess)==null?void 0:te.call(Q,Bt,t,this.state.context)),await((we=(J=Ut(this,Jo).config).onSettled)==null?void 0:we.call(J,Bt,null,this.state.variables,this.state.context,this)),await((me=(se=this.options).onSettled)==null?void 0:me.call(se,Bt,null,t,this.state.context)),Ao(this,xc,ph).call(this,{type:"success",data:Bt}),Bt}catch(Bt){try{throw await((re=(fe=Ut(this,Jo).config).onError)==null?void 0:re.call(fe,Bt,t,this.state.context,this)),await((Oe=(de=this.options).onError)==null?void 0:Oe.call(de,Bt,t,this.state.context)),await((qe=(Xe=Ut(this,Jo).config).onSettled)==null?void 0:qe.call(Xe,void 0,Bt,this.state.variables,this.state.context,this)),await((bt=(Be=this.options).onSettled)==null?void 0:bt.call(Be,void 0,Bt,t,this.state.context)),Bt}finally{Ao(this,xc,ph).call(this,{type:"error",error:Bt})}}finally{Ut(this,Jo).runNext(this)}}},vc=new WeakMap,Jo=new WeakMap,pf=new WeakMap,xc=new WeakSet,ph=function(t){const a=h=>{switch(t.type){case"failed":return{...h,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...h,isPaused:!0};case"continue":return{...h,isPaused:!1};case"pending":return{...h,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...h,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...h,data:void 0,error:t.error,failureCount:h.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=a(this.state),ta.batch(()=>{Ut(this,vc).forEach(h=>{h.onMutationUpdate(t)}),Ut(this,Jo).notify({mutation:this,type:"updated",action:t})})},XO);function SH(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ou,Nl,y0,KO,EH=(KO=class extends jw{constructor(t={}){super();bn(this,ou);bn(this,Nl);bn(this,y0);this.config=t,zi(this,ou,new Set),zi(this,Nl,new Map),zi(this,y0,0)}build(t,a,h){const g=new TH({mutationCache:this,mutationId:++wx(this,y0)._,options:t.defaultMutationOptions(a),state:h});return this.add(g),g}add(t){Ut(this,ou).add(t);const a=$x(t);if(typeof a=="string"){const h=Ut(this,Nl).get(a);h?h.push(t):Ut(this,Nl).set(a,[t])}this.notify({type:"added",mutation:t})}remove(t){if(Ut(this,ou).delete(t)){const a=$x(t);if(typeof a=="string"){const h=Ut(this,Nl).get(a);if(h)if(h.length>1){const g=h.indexOf(t);g!==-1&&h.splice(g,1)}else h[0]===t&&Ut(this,Nl).delete(a)}}this.notify({type:"removed",mutation:t})}canRun(t){const a=$x(t);if(typeof a=="string"){const h=Ut(this,Nl).get(a),g=h==null?void 0:h.find(v=>v.state.status==="pending");return!g||g===t}else return!0}runNext(t){var h;const a=$x(t);if(typeof a=="string"){const g=(h=Ut(this,Nl).get(a))==null?void 0:h.find(v=>v!==t&&v.state.isPaused);return(g==null?void 0:g.continue())??Promise.resolve()}else return Promise.resolve()}clear(){ta.batch(()=>{Ut(this,ou).forEach(t=>{this.notify({type:"removed",mutation:t})}),Ut(this,ou).clear(),Ut(this,Nl).clear()})}getAll(){return Array.from(Ut(this,ou))}find(t){const a={exact:!0,...t};return this.getAll().find(h=>RM(a,h))}findAll(t={}){return this.getAll().filter(a=>RM(t,a))}notify(t){ta.batch(()=>{this.listeners.forEach(a=>{a(t)})})}resumePausedMutations(){const t=this.getAll().filter(a=>a.state.isPaused);return ta.batch(()=>Promise.all(t.map(a=>a.continue().catch(zl))))}},ou=new WeakMap,Nl=new WeakMap,y0=new WeakMap,KO);function $x(i){var t;return(t=i.options.scope)==null?void 0:t.id}function OM(i){return{onFetch:(t,a)=>{var $,Q,te,J,we;const h=t.options,g=(te=(Q=($=t.fetchOptions)==null?void 0:$.meta)==null?void 0:Q.fetchMore)==null?void 0:te.direction,v=((J=t.state.data)==null?void 0:J.pages)||[],E=((we=t.state.data)==null?void 0:we.pageParams)||[];let o={pages:[],pageParams:[]},O=0;const F=async()=>{let se=!1;const me=de=>{Object.defineProperty(de,"signal",{enumerable:!0,get:()=>(t.signal.aborted?se=!0:t.signal.addEventListener("abort",()=>{se=!0}),t.signal)})},fe=L3(t.options,t.fetchOptions),re=async(de,Oe,Xe)=>{if(se)return Promise.reject();if(Oe==null&&de.pages.length)return Promise.resolve(de);const Be=(()=>{const nr={client:t.client,queryKey:t.queryKey,pageParam:Oe,direction:Xe?"backward":"forward",meta:t.options.meta};return me(nr),nr})(),bt=await fe(Be),{maxPages:Bt}=t.options,Jt=Xe?dH:hH;return{pages:Jt(de.pages,bt,Bt),pageParams:Jt(de.pageParams,Oe,Bt)}};if(g&&v.length){const de=g==="backward",Oe=de?IH:DM,Xe={pages:v,pageParams:E},qe=Oe(h,Xe);o=await re(Xe,qe,de)}else{const de=i??v.length;do{const Oe=O===0?E[0]??h.initialPageParam:DM(h,o);if(O>0&&Oe==null)break;o=await re(o,Oe),O++}while(O<de)}return o};t.options.persister?t.fetchFn=()=>{var se,me;return(me=(se=t.options).persister)==null?void 0:me.call(se,F,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},a)}:t.fetchFn=F}}}function DM(i,{pages:t,pageParams:a}){const h=t.length-1;return t.length>0?i.getNextPageParam(t[h],t,a[h],a):void 0}function IH(i,{pages:t,pageParams:a}){var h;return t.length>0?(h=i.getPreviousPageParam)==null?void 0:h.call(i,t[0],t,a[0],a):void 0}var ws,Th,Sh,Lm,zm,Eh,Fm,Bm,YO,AH=(YO=class{constructor(i={}){bn(this,ws);bn(this,Th);bn(this,Sh);bn(this,Lm);bn(this,zm);bn(this,Eh);bn(this,Fm);bn(this,Bm);zi(this,ws,i.queryCache||new bH),zi(this,Th,i.mutationCache||new EH),zi(this,Sh,i.defaultOptions||{}),zi(this,Lm,new Map),zi(this,zm,new Map),zi(this,Eh,0)}mount(){wx(this,Eh)._++,Ut(this,Eh)===1&&(zi(this,Fm,z3.subscribe(async i=>{i&&(await this.resumePausedMutations(),Ut(this,ws).onFocus())})),zi(this,Bm,Y1.subscribe(async i=>{i&&(await this.resumePausedMutations(),Ut(this,ws).onOnline())})))}unmount(){var i,t;wx(this,Eh)._--,Ut(this,Eh)===0&&((i=Ut(this,Fm))==null||i.call(this),zi(this,Fm,void 0),(t=Ut(this,Bm))==null||t.call(this),zi(this,Bm,void 0))}isFetching(i){return Ut(this,ws).findAll({...i,fetchStatus:"fetching"}).length}isMutating(i){return Ut(this,Th).findAll({...i,status:"pending"}).length}getQueryData(i){var a;const t=this.defaultQueryOptions({queryKey:i});return(a=Ut(this,ws).get(t.queryHash))==null?void 0:a.state.data}ensureQueryData(i){const t=this.defaultQueryOptions(i),a=Ut(this,ws).build(this,t),h=a.state.data;return h===void 0?this.fetchQuery(i):(i.revalidateIfStale&&a.isStaleByTime(ZE(t.staleTime,a))&&this.prefetchQuery(t),Promise.resolve(h))}getQueriesData(i){return Ut(this,ws).findAll(i).map(({queryKey:t,state:a})=>{const h=a.data;return[t,h]})}setQueryData(i,t,a){const h=this.defaultQueryOptions({queryKey:i}),g=Ut(this,ws).get(h.queryHash),v=g==null?void 0:g.state.data,E=sH(t,v);if(E!==void 0)return Ut(this,ws).build(this,h).setData(E,{...a,manual:!0})}setQueriesData(i,t,a){return ta.batch(()=>Ut(this,ws).findAll(i).map(({queryKey:h})=>[h,this.setQueryData(h,t,a)]))}getQueryState(i){var a;const t=this.defaultQueryOptions({queryKey:i});return(a=Ut(this,ws).get(t.queryHash))==null?void 0:a.state}removeQueries(i){const t=Ut(this,ws);ta.batch(()=>{t.findAll(i).forEach(a=>{t.remove(a)})})}resetQueries(i,t){const a=Ut(this,ws);return ta.batch(()=>(a.findAll(i).forEach(h=>{h.reset()}),this.refetchQueries({type:"active",...i},t)))}cancelQueries(i,t={}){const a={revert:!0,...t},h=ta.batch(()=>Ut(this,ws).findAll(i).map(g=>g.cancel(a)));return Promise.all(h).then(zl).catch(zl)}invalidateQueries(i,t={}){return ta.batch(()=>(Ut(this,ws).findAll(i).forEach(a=>{a.invalidate()}),(i==null?void 0:i.refetchType)==="none"?Promise.resolve():this.refetchQueries({...i,type:(i==null?void 0:i.refetchType)??(i==null?void 0:i.type)??"active"},t)))}refetchQueries(i,t={}){const a={...t,cancelRefetch:t.cancelRefetch??!0},h=ta.batch(()=>Ut(this,ws).findAll(i).filter(g=>!g.isDisabled()&&!g.isStatic()).map(g=>{let v=g.fetch(void 0,a);return a.throwOnError||(v=v.catch(zl)),g.state.fetchStatus==="paused"?Promise.resolve():v}));return Promise.all(h).then(zl)}fetchQuery(i){const t=this.defaultQueryOptions(i);t.retry===void 0&&(t.retry=!1);const a=Ut(this,ws).build(this,t);return a.isStaleByTime(ZE(t.staleTime,a))?a.fetch(t):Promise.resolve(a.state.data)}prefetchQuery(i){return this.fetchQuery(i).then(zl).catch(zl)}fetchInfiniteQuery(i){return i.behavior=OM(i.pages),this.fetchQuery(i)}prefetchInfiniteQuery(i){return this.fetchInfiniteQuery(i).then(zl).catch(zl)}ensureInfiniteQueryData(i){return i.behavior=OM(i.pages),this.ensureQueryData(i)}resumePausedMutations(){return Y1.isOnline()?Ut(this,Th).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ut(this,ws)}getMutationCache(){return Ut(this,Th)}getDefaultOptions(){return Ut(this,Sh)}setDefaultOptions(i){zi(this,Sh,i)}setQueryDefaults(i,t){Ut(this,Lm).set(c0(i),{queryKey:i,defaultOptions:t})}getQueryDefaults(i){const t=[...Ut(this,Lm).values()],a={};return t.forEach(h=>{u0(i,h.queryKey)&&Object.assign(a,h.defaultOptions)}),a}setMutationDefaults(i,t){Ut(this,zm).set(c0(i),{mutationKey:i,defaultOptions:t})}getMutationDefaults(i){const t=[...Ut(this,zm).values()],a={};return t.forEach(h=>{u0(i,h.mutationKey)&&Object.assign(a,h.defaultOptions)}),a}defaultQueryOptions(i){if(i._defaulted)return i;const t={...Ut(this,Sh).queries,...this.getQueryDefaults(i.queryKey),...i,_defaulted:!0};return t.queryHash||(t.queryHash=PI(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===RI&&(t.enabled=!1),t}defaultMutationOptions(i){return i!=null&&i._defaulted?i:{...Ut(this,Sh).mutations,...(i==null?void 0:i.mutationKey)&&this.getMutationDefaults(i.mutationKey),...i,_defaulted:!0}}clear(){Ut(this,ws).clear(),Ut(this,Th).clear()}},ws=new WeakMap,Th=new WeakMap,Sh=new WeakMap,Lm=new WeakMap,zm=new WeakMap,Eh=new WeakMap,Fm=new WeakMap,Bm=new WeakMap,YO),CH=ke.createContext(void 0),PH=({client:i,children:t})=>(ke.useEffect(()=>(i.mount(),()=>{i.unmount()}),[i]),ye.jsx(CH.Provider,{value:i,children:t}));/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function J1(){return J1=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(i[h]=a[h])}return i},J1.apply(this,arguments)}var Ch;(function(i){i.Pop="POP",i.Push="PUSH",i.Replace="REPLACE"})(Ch||(Ch={}));const LM="popstate";function RH(i){i===void 0&&(i={});function t(h,g){let{pathname:v,search:E,hash:o}=h.location;return KE("",{pathname:v,search:E,hash:o},g.state&&g.state.usr||null,g.state&&g.state.key||"default")}function a(h,g){return typeof g=="string"?g:U3(g)}return MH(t,a,null,i)}function Ca(i,t){if(i===!1||i===null||typeof i>"u")throw new Error(t)}function V3(i,t){if(!i){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function kH(){return Math.random().toString(36).substr(2,8)}function zM(i,t){return{usr:i.state,key:i.key,idx:t}}function KE(i,t,a,h){return a===void 0&&(a=null),J1({pathname:typeof i=="string"?i:i.pathname,search:"",hash:""},typeof t=="string"?Uw(t):t,{state:a,key:t&&t.key||h||kH()})}function U3(i){let{pathname:t="/",search:a="",hash:h=""}=i;return a&&a!=="?"&&(t+=a.charAt(0)==="?"?a:"?"+a),h&&h!=="#"&&(t+=h.charAt(0)==="#"?h:"#"+h),t}function Uw(i){let t={};if(i){let a=i.indexOf("#");a>=0&&(t.hash=i.substr(a),i=i.substr(0,a));let h=i.indexOf("?");h>=0&&(t.search=i.substr(h),i=i.substr(0,h)),i&&(t.pathname=i)}return t}function MH(i,t,a,h){h===void 0&&(h={});let{window:g=document.defaultView,v5Compat:v=!1}=h,E=g.history,o=Ch.Pop,O=null,F=$();F==null&&(F=0,E.replaceState(J1({},E.state,{idx:F}),""));function $(){return(E.state||{idx:null}).idx}function Q(){o=Ch.Pop;let me=$(),fe=me==null?null:me-F;F=me,O&&O({action:o,location:se.location,delta:fe})}function te(me,fe){o=Ch.Push;let re=KE(se.location,me,fe);F=$()+1;let de=zM(re,F),Oe=se.createHref(re);try{E.pushState(de,"",Oe)}catch(Xe){if(Xe instanceof DOMException&&Xe.name==="DataCloneError")throw Xe;g.location.assign(Oe)}v&&O&&O({action:o,location:se.location,delta:1})}function J(me,fe){o=Ch.Replace;let re=KE(se.location,me,fe);F=$();let de=zM(re,F),Oe=se.createHref(re);E.replaceState(de,"",Oe),v&&O&&O({action:o,location:se.location,delta:0})}function we(me){let fe=g.location.origin!=="null"?g.location.origin:g.location.href,re=typeof me=="string"?me:U3(me);return re=re.replace(/ $/,"%20"),Ca(fe,"No window.location.(origin|href) available to create URL for href: "+re),new URL(re,fe)}let se={get action(){return o},get location(){return i(g,E)},listen(me){if(O)throw new Error("A history only accepts one active listener");return g.addEventListener(LM,Q),O=me,()=>{g.removeEventListener(LM,Q),O=null}},createHref(me){return t(g,me)},createURL:we,encodeLocation(me){let fe=we(me);return{pathname:fe.pathname,search:fe.search,hash:fe.hash}},push:te,replace:J,go(me){return E.go(me)}};return se}var FM;(function(i){i.data="data",i.deferred="deferred",i.redirect="redirect",i.error="error"})(FM||(FM={}));function OH(i,t,a){return a===void 0&&(a="/"),DH(i,t,a,!1)}function DH(i,t,a,h){let g=typeof t=="string"?Uw(t):t,v=H3(g.pathname||"/",a);if(v==null)return null;let E=$3(i);LH(E);let o=null;for(let O=0;o==null&&O<E.length;++O){let F=qH(v);o=GH(E[O],F,h)}return o}function $3(i,t,a,h){t===void 0&&(t=[]),a===void 0&&(a=[]),h===void 0&&(h="");let g=(v,E,o)=>{let O={relativePath:o===void 0?v.path||"":o,caseSensitive:v.caseSensitive===!0,childrenIndex:E,route:v};O.relativePath.startsWith("/")&&(Ca(O.relativePath.startsWith(h),'Absolute route path "'+O.relativePath+'" nested under path '+('"'+h+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),O.relativePath=O.relativePath.slice(h.length));let F=Pm([h,O.relativePath]),$=a.concat(O);v.children&&v.children.length>0&&(Ca(v.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+F+'".')),$3(v.children,t,$,F)),!(v.path==null&&!v.index)&&t.push({path:F,score:UH(F,v.index),routesMeta:$})};return i.forEach((v,E)=>{var o;if(v.path===""||!((o=v.path)!=null&&o.includes("?")))g(v,E);else for(let O of G3(v.path))g(v,E,O)}),t}function G3(i){let t=i.split("/");if(t.length===0)return[];let[a,...h]=t,g=a.endsWith("?"),v=a.replace(/\?$/,"");if(h.length===0)return g?[v,""]:[v];let E=G3(h.join("/")),o=[];return o.push(...E.map(O=>O===""?v:[v,O].join("/"))),g&&o.push(...E),o.map(O=>i.startsWith("/")&&O===""?"/":O)}function LH(i){i.sort((t,a)=>t.score!==a.score?a.score-t.score:$H(t.routesMeta.map(h=>h.childrenIndex),a.routesMeta.map(h=>h.childrenIndex)))}const zH=/^:[\w-]+$/,FH=3,BH=2,NH=1,jH=10,VH=-2,BM=i=>i==="*";function UH(i,t){let a=i.split("/"),h=a.length;return a.some(BM)&&(h+=VH),t&&(h+=BH),a.filter(g=>!BM(g)).reduce((g,v)=>g+(zH.test(v)?FH:v===""?NH:jH),h)}function $H(i,t){return i.length===t.length&&i.slice(0,-1).every((h,g)=>h===t[g])?i[i.length-1]-t[t.length-1]:0}function GH(i,t,a){let{routesMeta:h}=i,g={},v="/",E=[];for(let o=0;o<h.length;++o){let O=h[o],F=o===h.length-1,$=v==="/"?t:t.slice(v.length)||"/",Q=NM({path:O.relativePath,caseSensitive:O.caseSensitive,end:F},$),te=O.route;if(!Q&&F&&a&&!h[h.length-1].route.index&&(Q=NM({path:O.relativePath,caseSensitive:O.caseSensitive,end:!1},$)),!Q)return null;Object.assign(g,Q.params),E.push({params:g,pathname:Pm([v,Q.pathname]),pathnameBase:WH(Pm([v,Q.pathnameBase])),route:te}),Q.pathnameBase!=="/"&&(v=Pm([v,Q.pathnameBase]))}return E}function NM(i,t){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[a,h]=HH(i.path,i.caseSensitive,i.end),g=t.match(a);if(!g)return null;let v=g[0],E=v.replace(/(.)\/+$/,"$1"),o=g.slice(1);return{params:h.reduce((F,$,Q)=>{let{paramName:te,isOptional:J}=$;if(te==="*"){let se=o[Q]||"";E=v.slice(0,v.length-se.length).replace(/(.)\/+$/,"$1")}const we=o[Q];return J&&!we?F[te]=void 0:F[te]=(we||"").replace(/%2F/g,"/"),F},{}),pathname:v,pathnameBase:E,pattern:i}}function HH(i,t,a){t===void 0&&(t=!1),a===void 0&&(a=!0),V3(i==="*"||!i.endsWith("*")||i.endsWith("/*"),'Route path "'+i+'" will be treated as if it were '+('"'+i.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+i.replace(/\*$/,"/*")+'".'));let h=[],g="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(E,o,O)=>(h.push({paramName:o,isOptional:O!=null}),O?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(h.push({paramName:"*"}),g+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):a?g+="\\/*$":i!==""&&i!=="/"&&(g+="(?:(?=\\/|$))"),[new RegExp(g,t?void 0:"i"),h]}function qH(i){try{return i.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return V3(!1,'The URL path "'+i+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),i}}function H3(i,t){if(t==="/")return i;if(!i.toLowerCase().startsWith(t.toLowerCase()))return null;let a=t.endsWith("/")?t.length-1:t.length,h=i.charAt(a);return h&&h!=="/"?null:i.slice(a)||"/"}const Pm=i=>i.join("/").replace(/\/\/+/g,"/"),WH=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/");function ZH(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}const q3=["post","put","patch","delete"];new Set(q3);const XH=["get",...q3];new Set(XH);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Q1(){return Q1=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(i[h]=a[h])}return i},Q1.apply(this,arguments)}const KH=ke.createContext(null),YH=ke.createContext(null),W3=ke.createContext(null),$w=ke.createContext(null),Gw=ke.createContext({outlet:null,matches:[],isDataRoute:!1}),Z3=ke.createContext(null);function kI(){return ke.useContext($w)!=null}function X3(){return kI()||Ca(!1),ke.useContext($w).location}function JH(i,t){return QH(i,t)}function QH(i,t,a,h){kI()||Ca(!1);let{navigator:g}=ke.useContext(W3),{matches:v}=ke.useContext(Gw),E=v[v.length-1],o=E?E.params:{};E&&E.pathname;let O=E?E.pathnameBase:"/";E&&E.route;let F=X3(),$;if(t){var Q;let me=typeof t=="string"?Uw(t):t;O==="/"||(Q=me.pathname)!=null&&Q.startsWith(O)||Ca(!1),$=me}else $=F;let te=$.pathname||"/",J=te;if(O!=="/"){let me=O.replace(/^\//,"").split("/");J="/"+te.replace(/^\//,"").split("/").slice(me.length).join("/")}let we=OH(i,{pathname:J}),se=nq(we&&we.map(me=>Object.assign({},me,{params:Object.assign({},o,me.params),pathname:Pm([O,g.encodeLocation?g.encodeLocation(me.pathname).pathname:me.pathname]),pathnameBase:me.pathnameBase==="/"?O:Pm([O,g.encodeLocation?g.encodeLocation(me.pathnameBase).pathname:me.pathnameBase])})),v,a,h);return t&&se?ke.createElement($w.Provider,{value:{location:Q1({pathname:"/",search:"",hash:"",state:null,key:"default"},$),navigationType:Ch.Pop}},se):se}function eq(){let i=lq(),t=ZH(i)?i.status+" "+i.statusText:i instanceof Error?i.message:JSON.stringify(i),a=i instanceof Error?i.stack:null,g={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ke.createElement(ke.Fragment,null,ke.createElement("h2",null,"Unexpected Application Error!"),ke.createElement("h3",{style:{fontStyle:"italic"}},t),a?ke.createElement("pre",{style:g},a):null,null)}const tq=ke.createElement(eq,null);class rq extends ke.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,a){return a.location!==t.location||a.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:a.error,location:a.location,revalidation:t.revalidation||a.revalidation}}componentDidCatch(t,a){console.error("React Router caught the following error during render",t,a)}render(){return this.state.error!==void 0?ke.createElement(Gw.Provider,{value:this.props.routeContext},ke.createElement(Z3.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function iq(i){let{routeContext:t,match:a,children:h}=i,g=ke.useContext(KH);return g&&g.static&&g.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(g.staticContext._deepestRenderedBoundaryId=a.route.id),ke.createElement(Gw.Provider,{value:t},h)}function nq(i,t,a,h){var g;if(t===void 0&&(t=[]),a===void 0&&(a=null),h===void 0&&(h=null),i==null){var v;if(!a)return null;if(a.errors)i=a.matches;else if((v=h)!=null&&v.v7_partialHydration&&t.length===0&&!a.initialized&&a.matches.length>0)i=a.matches;else return null}let E=i,o=(g=a)==null?void 0:g.errors;if(o!=null){let $=E.findIndex(Q=>Q.route.id&&(o==null?void 0:o[Q.route.id])!==void 0);$>=0||Ca(!1),E=E.slice(0,Math.min(E.length,$+1))}let O=!1,F=-1;if(a&&h&&h.v7_partialHydration)for(let $=0;$<E.length;$++){let Q=E[$];if((Q.route.HydrateFallback||Q.route.hydrateFallbackElement)&&(F=$),Q.route.id){let{loaderData:te,errors:J}=a,we=Q.route.loader&&te[Q.route.id]===void 0&&(!J||J[Q.route.id]===void 0);if(Q.route.lazy||we){O=!0,F>=0?E=E.slice(0,F+1):E=[E[0]];break}}}return E.reduceRight(($,Q,te)=>{let J,we=!1,se=null,me=null;a&&(J=o&&Q.route.id?o[Q.route.id]:void 0,se=Q.route.errorElement||tq,O&&(F<0&&te===0?(we=!0,me=null):F===te&&(we=!0,me=Q.route.hydrateFallbackElement||null)));let fe=t.concat(E.slice(0,te+1)),re=()=>{let de;return J?de=se:we?de=me:Q.route.Component?de=ke.createElement(Q.route.Component,null):Q.route.element?de=Q.route.element:de=$,ke.createElement(iq,{match:Q,routeContext:{outlet:$,matches:fe,isDataRoute:a!=null},children:de})};return a&&(Q.route.ErrorBoundary||Q.route.errorElement||te===0)?ke.createElement(rq,{location:a.location,revalidation:a.revalidation,component:se,error:J,children:re(),routeContext:{outlet:null,matches:fe,isDataRoute:!0}}):re()},null)}var YE=function(i){return i.UseBlocker="useBlocker",i.UseLoaderData="useLoaderData",i.UseActionData="useActionData",i.UseRouteError="useRouteError",i.UseNavigation="useNavigation",i.UseRouteLoaderData="useRouteLoaderData",i.UseMatches="useMatches",i.UseRevalidator="useRevalidator",i.UseNavigateStable="useNavigate",i.UseRouteId="useRouteId",i}(YE||{});function sq(i){let t=ke.useContext(YH);return t||Ca(!1),t}function oq(i){let t=ke.useContext(Gw);return t||Ca(!1),t}function aq(i){let t=oq(),a=t.matches[t.matches.length-1];return a.route.id||Ca(!1),a.route.id}function lq(){var i;let t=ke.useContext(Z3),a=sq(YE.UseRouteError),h=aq(YE.UseRouteError);return t!==void 0?t:(i=a.errors)==null?void 0:i[h]}function cq(i,t){i==null||i.v7_startTransition,i==null||i.v7_relativeSplatPath}function JE(i){Ca(!1)}function uq(i){let{basename:t="/",children:a=null,location:h,navigationType:g=Ch.Pop,navigator:v,static:E=!1,future:o}=i;kI()&&Ca(!1);let O=t.replace(/^\/*/,"/"),F=ke.useMemo(()=>({basename:O,navigator:v,static:E,future:Q1({v7_relativeSplatPath:!1},o)}),[O,o,v,E]);typeof h=="string"&&(h=Uw(h));let{pathname:$="/",search:Q="",hash:te="",state:J=null,key:we="default"}=h,se=ke.useMemo(()=>{let me=H3($,O);return me==null?null:{location:{pathname:me,search:Q,hash:te,state:J,key:we},navigationType:g}},[O,$,Q,te,J,we,g]);return se==null?null:ke.createElement(W3.Provider,{value:F},ke.createElement($w.Provider,{children:a,value:se}))}function hq(i){let{children:t,location:a}=i;return JH(QE(t),a)}new Promise(()=>{});function QE(i,t){t===void 0&&(t=[]);let a=[];return ke.Children.forEach(i,(h,g)=>{if(!ke.isValidElement(h))return;let v=[...t,g];if(h.type===ke.Fragment){a.push.apply(a,QE(h.props.children,v));return}h.type!==JE&&Ca(!1),!h.props.index||!h.props.children||Ca(!1);let E={id:h.props.id||v.join("-"),caseSensitive:h.props.caseSensitive,element:h.props.element,Component:h.props.Component,index:h.props.index,path:h.props.path,loader:h.props.loader,action:h.props.action,errorElement:h.props.errorElement,ErrorBoundary:h.props.ErrorBoundary,hasErrorBoundary:h.props.ErrorBoundary!=null||h.props.errorElement!=null,shouldRevalidate:h.props.shouldRevalidate,handle:h.props.handle,lazy:h.props.lazy};h.props.children&&(E.children=QE(h.props.children,v)),a.push(E)}),a}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const dq="6";try{window.__reactRouterVersion=dq}catch{}const fq="startTransition",jM=cD[fq];function pq(i){let{basename:t,children:a,future:h,window:g}=i,v=ke.useRef();v.current==null&&(v.current=RH({window:g,v5Compat:!0}));let E=v.current,[o,O]=ke.useState({action:E.action,location:E.location}),{v7_startTransition:F}=h||{},$=ke.useCallback(Q=>{F&&jM?jM(()=>O(Q)):O(Q)},[O,F]);return ke.useLayoutEffect(()=>E.listen($),[E,$]),ke.useEffect(()=>cq(h),[h]),ke.createElement(uq,{basename:t,children:a,location:o.location,navigationType:o.action,navigator:E,future:h})}var VM;(function(i){i.UseScrollRestoration="useScrollRestoration",i.UseSubmit="useSubmit",i.UseSubmitFetcher="useSubmitFetcher",i.UseFetcher="useFetcher",i.useViewTransitionState="useViewTransitionState"})(VM||(VM={}));var UM;(function(i){i.UseFetcher="useFetcher",i.UseFetchers="useFetchers",i.UseScrollRestoration="useScrollRestoration"})(UM||(UM={}));const mq=I0("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ga=ke.forwardRef(({className:i,variant:t,size:a,asChild:h=!1,...g},v)=>{const E=h?gz:"button";return ye.jsx(E,{className:Jn(mq({variant:t,size:a,className:i})),ref:v,...g})});Ga.displayName="Button";const gq="/assets/protected-forest-qvVbXGzS.png",_q="/assets/logo-TX0FqS9U.png",yq=({scrollY:i})=>{const[t,a]=ke.useState(!1);ke.useEffect(()=>{a(!0)},[]);const h=i*.5;return ye.jsxs("section",{className:"relative min-h-screen flex items-center justify-center overflow-hidden",children:[ye.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-25",style:{backgroundImage:`url(${gq})`,filter:"blur(2px)"}}),ye.jsxs("div",{className:"absolute inset-0 opacity-30",children:[ye.jsx("div",{className:"absolute top-20 left-10 w-64 h-64 bg-primary/20 rounded-full blur-3xl animate-float"}),ye.jsx("div",{className:"absolute bottom-20 right-10 w-96 h-96 bg-secondary/20 rounded-full blur-3xl animate-float",style:{animationDelay:"1s"}}),ye.jsx("div",{className:"absolute top-1/2 left-1/2 w-72 h-72 bg-accent/10 rounded-full blur-3xl animate-float",style:{animationDelay:"2s"}})]}),ye.jsx("div",{className:"container mx-auto px-4 text-center relative z-10",style:{transform:`translateY(-${h}px)`},children:ye.jsxs("div",{className:`transition-all duration-1000 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsx("div",{className:"flex w-64 h- mx-auto",style:{content:`url(${_q})`}}),ye.jsxs("h1",{className:"text-7xl md:text-9xl font-bold mb-6 tracking-tight",children:[ye.jsx("span",{className:"text-gradient-primary",children:"MISTIFY"}),ye.jsx("span",{className:"text-foreground",children:".ai"})]}),ye.jsxs("p",{className:"text-2xl md:text-4xl font-light mb-8 text-muted-foreground max-w-4xl mx-auto leading-relaxed",children:["Advancing agroforestry with ",ye.jsx("span",{className:"text-gradient-secondary font-semibold",children:"AI robotics"})]}),ye.jsxs("p",{className:"text-lg md:text-xl mb-12 text-muted-foreground max-w-3xl mx-auto",children:["The weatherproof, fireproof, autonomous hydration system protecting vegetation from wildfire  ",ye.jsx("span",{className:"text-primary",children:"before it starts"})]}),ye.jsx("div",{className:"flex gap-4 justify-center flex-wrap",children:ye.jsx(Ga,{size:"lg",variant:"outline",className:"border-secondary text-secondary hover:bg-secondary/10 hover-glow-secondary text-lg px-8 py-6 transition-all duration-300 hover:scale-105",onClick:()=>{var g;return(g=document.getElementById("problem"))==null?void 0:g.scrollIntoView({behavior:"smooth"})},children:"Learn More"})}),ye.jsx("div",{className:"mt-16 animate-bounce",children:ye.jsx(Dw,{className:"w-8 h-8 mx-auto text-primary opacity-60"})})]})}),ye.jsx("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-muted-foreground/50 tracking-widest",children:"WORK PRODUCT  CONFIDENTIAL  PATENT PENDING"})]})},Aa=ke.forwardRef(({className:i,...t},a)=>ye.jsx("div",{ref:a,className:Jn("rounded-lg border bg-card text-card-foreground shadow-sm",i),...t}));Aa.displayName="Card";const vq=ke.forwardRef(({className:i,...t},a)=>ye.jsx("div",{ref:a,className:Jn("flex flex-col space-y-1.5 p-6",i),...t}));vq.displayName="CardHeader";const xq=ke.forwardRef(({className:i,...t},a)=>ye.jsx("h3",{ref:a,className:Jn("text-2xl font-semibold leading-none tracking-tight",i),...t}));xq.displayName="CardTitle";const wq=ke.forwardRef(({className:i,...t},a)=>ye.jsx("p",{ref:a,className:Jn("text-sm text-muted-foreground",i),...t}));wq.displayName="CardDescription";const g1=ke.forwardRef(({className:i,...t},a)=>ye.jsx("div",{ref:a,className:Jn("p-6 pt-0",i),...t}));g1.displayName="CardContent";const bq=ke.forwardRef(({className:i,...t},a)=>ye.jsx("div",{ref:a,className:Jn("flex items-center p-6 pt-0",i),...t}));bq.displayName="CardFooter";const Tq=({label:i,value:t,suffix:a,detail:h,color:g="primary"})=>{const[v,E]=ke.useState(!1);return ke.useEffect(()=>{E(!0)},[]),ye.jsx(Aa,{className:`p-6 bg-card/50 border-${g}/30 hover-glow-${g} transition-all duration-300 ${v?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:ye.jsxs("div",{className:"text-center",children:[ye.jsx("div",{className:`text-4xl font-bold mb-2 text-gradient-${g}`,children:t}),a&&ye.jsx("div",{className:"text-sm text-muted-foreground mb-3",children:a}),ye.jsx("div",{className:"text-sm font-medium text-foreground mb-2",children:i}),h&&ye.jsx("div",{className:"text-xs text-muted-foreground mt-2 pt-2 border-t border-border/50",children:h})]})})},Sq=({scrollY:i})=>{const[t,a]=ke.useState(null),[h,g]=ke.useState(!1);ke.useEffect(()=>{const E=()=>{const o=document.getElementById("problem");if(o){const O=o.getBoundingClientRect();g(O.top<window.innerHeight*.7)}};return window.addEventListener("scroll",E),E(),()=>window.removeEventListener("scroll",E)},[]);const v=[{icon:V6,title:"Climate Crisis Accelerating",description:"Deforestation drives climate change, biodiversity loss, and soil erosion, disrupts water cycles, increases wildfire risks, harms human health via air pollution, and undermines economies and Indigenous livelihoods globally.",stats:[{label:"Carbon absorption capacity",value:"75%",suffix:"reduction",detail:"Globally, 2023 to 2024 vs. pre-2023"},{label:"Forest acres burned",value:"3x",suffix:"annual average",detail:"Globally, 2023 to 2024 vs. pre-2023"},{label:"Air quality",value:"99%",suffix:"unsafe",detail:"of global population breathes unsafe air"}],color:"accent"},{icon:B6,title:"Trillion-Dollar Economic Impact",description:"Investors face growing risks from deforestation, including $45 trillion in global market capitalization exposed to nature-related risks, and rising regulatory, reputational, and transition risks as regulations tighten and commodity markets shift.",stats:[{label:"U.S. wildfire costs",value:"$394-893B",suffix:"per year"},{label:"U.S. biodegradation costs",value:"$83B",suffix:"per year"},{label:"Global deforestation costs",value:"$2-5T",suffix:"per year"}],color:"accent"},{icon:e$,title:"Investment Imbalance",description:"Unmitigated wildfires and deforestation risk triggering irreversible climate tipping points, collapsing ecosystems, and destabilizing global markets. A persistent 70:1 ratio of investment in deforestation versus protection continues despite strong incentives for change.",stats:[{label:"Investment ratio",value:"70:1",suffix:"deforestation vs protection"},{label:"Prevention spending gap",value:"5x",suffix:"more on suppression than prevention"}],color:"accent"},{icon:t$,title:"Tipping Point Approaching",description:"Record wildfire activity and emissions in 2023-2024 signal a shift from forests as carbon sinks to carbon sources. The U.S. alone spends 5 times more on wildfire suppression than prevention, while trends suggest exponential investment increases needed to halt adverse climate conditions.",stats:[{label:"Forest status",value:"Carbon emitters",suffix:"shifting from absorbers"},{label:"Wildfire trend",value:"Exponential",suffix:"growth in frequency & intensity"}],color:"accent"}];return ye.jsxs("section",{id:"problem",className:"py-32 px-4 relative overflow-hidden",children:[ye.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-10"}),ye.jsxs("div",{className:"container mx-auto max-w-7xl relative z-10",children:[ye.jsxs("div",{className:`text-center mb-20 transition-all duration-1000 ${h?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsxs("h2",{className:"text-5xl md:text-7xl font-bold mb-6",children:["The ",ye.jsx("span",{className:"text-gradient-accent",children:"Problem"})]}),ye.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"A global crisis demanding immediate action and innovative solutions"})]}),ye.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:v.map((E,o)=>{const O=E.icon,F=t===o;return ye.jsxs(Aa,{className:`glass-card p-8 cursor-pointer transition-all duration-500 hover:scale-105 ${F?"md:col-span-2":""} ${h?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,style:{transitionDelay:`${o*100}ms`,border:F?`2px solid hsl(var(--${E.color}))`:void 0},onClick:()=>a(F?null:o),children:[ye.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[ye.jsx("div",{className:`p-3 rounded-xl bg-${E.color}/10 hover-glow-${E.color}`,children:ye.jsx(O,{className:`w-8 h-8 text-${E.color}`})}),ye.jsxs("div",{className:"flex-1",children:[ye.jsx("h3",{className:"text-2xl font-bold mb-2",children:E.title}),ye.jsx("p",{className:"text-muted-foreground leading-relaxed",children:E.description})]}),ye.jsx(F6,{className:`w-6 h-6 text-${E.color} transition-transform duration-300 ${F?"rotate-180":""}`})]}),ye.jsx("div",{className:`overflow-hidden transition-all duration-500 ${F?"max-h-[1000px] opacity-100 mt-6":"max-h-0 opacity-0"}`,children:ye.jsx("div",{className:"grid md:grid-cols-3 gap-4",children:E.stats.map(($,Q)=>ye.jsx(Tq,{label:$.label,value:$.value,suffix:$.suffix,detail:$.detail,color:E.color},Q))})})]},o)})}),ye.jsx("div",{className:`text-center mt-16 transition-all duration-1000 delay-700 ${h?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:ye.jsxs(Ga,{size:"lg",variant:"outline",className:"border-accent text-accent hover:bg-accent/10 hover-glow-accent text-lg px-8 py-6 transition-all duration-300 hover:scale-105",onClick:()=>{var E;return(E=document.getElementById("solution"))==null?void 0:E.scrollIntoView({behavior:"smooth"})},children:["Learn More",ye.jsx(Dw,{className:"w-5 h-5 ml-2"})]})})]})]})},Eq=({scrollY:i})=>{const[t,a]=ke.useState(!1),[h,g]=ke.useState(null);ke.useEffect(()=>{const E=()=>{const o=document.getElementById("solution");if(o){const O=o.getBoundingClientRect();a(O.top<window.innerHeight*.7)}};return window.addEventListener("scroll",E),E(),()=>window.removeEventListener("scroll",E)},[]);const v=[{icon:N6,title:"Autonomous Hydration",description:"Continuously prevents wildfire by dispensing hydration fluid and replenishing without human intervention.",color:"secondary"},{icon:W6,title:"Autonomous Flying",description:"Smart aerial navigation with collision-avoidance for efficient territory coverage.",color:"primary"},{icon:z6,title:"Autonomous Driving",description:"Ground-based navigation with obstacle detection for comprehensive terrain monitoring.",color:"secondary"},{icon:j6,title:"Environmental Sensing",description:"Detects conditions conducive to wildfire through advanced sensor array before fires manifest.",color:"primary"},{icon:Hz,title:"Autonomous Recharging",description:"Navigates to nearest charging station automatically to maintain operational readiness.",color:"secondary"},{icon:X6,title:"Autonomous Replenishing",description:"Self-navigates to fluid stations for automatic hydration system replenishment.",color:"primary"},{icon:J6,title:"Self-Aware Systems",description:"Monitors functionality and environmental conditions with self-repair capabilities.",color:"secondary"},{icon:n$,title:"Quantum Calibration",description:"Leverages quantum computing for more efficient AI learning and rapid adaptation.",color:"primary"},{icon:Wz,title:"24/7/365 Connectivity",description:"Real-time data streaming, live camera feeds, and remote control capabilities.",color:"secondary"}];return ye.jsx("section",{id:"solution",className:"py-32 px-4 relative",children:ye.jsxs("div",{className:"container mx-auto max-w-7xl",children:[ye.jsxs("div",{className:`text-center mb-20 transition-all duration-1000 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsxs("h2",{className:"text-5xl md:text-7xl font-bold mb-6",children:["The ",ye.jsx("span",{className:"text-gradient-primary",children:"Solution"})]}),ye.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto mb-8",children:"The world's first intelligent firefighting robot system"}),ye.jsxs("p",{className:"text-lg text-foreground max-w-4xl mx-auto leading-relaxed",children:[ye.jsx("span",{className:"text-gradient-primary font-bold",children:"MISTIFY"})," is the only solution that continuously prevents wildfire, recharging and replenishing without human intervention. Designed modularly as independently operational, complementary units  affordable to a global market and scalable to address specific needs."]})]}),ye.jsx("div",{className:"grid md:grid-cols-3 gap-6 mb-16",children:v.map((E,o)=>{const O=E.icon,F=h===o;return ye.jsxs(Aa,{className:`glass-card p-8 transition-all duration-500 hover:scale-105 cursor-pointer group ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"} ${F?`border-${E.color}`:""}`,style:{transitionDelay:`${o*50}ms`,borderWidth:F?"2px":"1px"},onMouseEnter:()=>g(o),onMouseLeave:()=>g(null),children:[ye.jsx("div",{className:`inline-block p-4 rounded-xl bg-${E.color}/10 mb-4 group-hover:scale-110 transition-transform duration-300 hover-glow-${E.color}`,children:ye.jsx(O,{className:`w-8 h-8 text-${E.color}`})}),ye.jsx("h3",{className:"text-xl font-bold mb-3",children:E.title}),ye.jsx("p",{className:"text-muted-foreground leading-relaxed",children:E.description})]},o)})}),ye.jsx("div",{className:`text-center mt-16 transition-all duration-1000 delay-500 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:ye.jsxs(Aa,{className:"glass-card p-12 max-w-4xl mx-auto hover-glow-primary",children:[ye.jsxs("h3",{className:"text-3xl font-bold mb-6",children:["Modular. Intelligent. ",ye.jsx("span",{className:"text-gradient-primary",children:"Life-Saving."})]}),ye.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed",children:"Never leave your seat while your eye on the ground  MISTIFY  feeds you live environmental data, inferences, and camera footage on-demand. A truly preventative solution adaptive to a variety of use cases."})]})}),ye.jsx("div",{className:`text-center mt-16 transition-all duration-1000 delay-700 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:ye.jsxs(Ga,{size:"lg",variant:"outline",className:"border-primary text-primary hover:bg-secondary/10 hover-glow-secondary text-lg px-8 py-6 transition-all duration-300 hover:scale-105",onClick:()=>{var E;return(E=document.getElementById("interface"))==null?void 0:E.scrollIntoView({behavior:"smooth"})},children:["Learn More",ye.jsx(Dw,{className:"w-5 h-5 ml-2"})]})})]})})};var K3={exports:{}};(function(i,t){(function(a,h){i.exports=h()})(cj,function(){var a,h,g;function v(o,O){if(!a)a=O;else if(!h)h=O;else{var F="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",$={};a($),g=O($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}v(["exports"],function(o){var O=1e-6,F=typeof Float32Array<"u"?Float32Array:Array;function $(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=n*p-u*c;return m?(s[0]=p*(m=1/m),s[1]=-c*m,s[2]=-u*m,s[3]=n*m,s):null}function Q(){var s=new F(9);return F!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function te(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=e[4],y=e[5],b=e[6],T=e[7],A=e[8];return s[0]=m*A-y*T,s[1]=u*T-c*A,s[2]=c*y-u*m,s[3]=y*b-p*A,s[4]=n*A-u*b,s[5]=u*p-n*y,s[6]=p*T-m*b,s[7]=c*b-n*T,s[8]=n*m-c*p,s}function J(s,e,n){var c=e[0],u=e[1],p=e[2],m=e[3],y=e[4],b=e[5],T=e[6],A=e[7],C=e[8],P=n[0],D=n[1],L=n[2],N=n[3],V=n[4],G=n[5],X=n[6],Y=n[7],ie=n[8];return s[0]=P*c+D*m+L*T,s[1]=P*u+D*y+L*A,s[2]=P*p+D*b+L*C,s[3]=N*c+V*m+G*T,s[4]=N*u+V*y+G*A,s[5]=N*p+V*b+G*C,s[6]=X*c+Y*m+ie*T,s[7]=X*u+Y*y+ie*A,s[8]=X*p+Y*b+ie*C,s}function we(){var s=new F(16);return F!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function se(s){var e=new F(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e}function me(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function fe(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=e[4],y=e[5],b=e[6],T=e[7],A=e[8],C=e[9],P=e[10],D=e[11],L=e[12],N=e[13],V=e[14],G=e[15],X=n*y-c*m,Y=n*b-u*m,ie=n*T-p*m,_e=c*b-u*y,ue=c*T-p*y,be=u*T-p*b,Ee=A*N-C*L,Ae=A*V-P*L,Ze=A*G-D*L,ze=C*V-P*N,Ke=C*G-D*N,tt=P*G-D*V,st=X*tt-Y*Ke+ie*ze+_e*Ze-ue*Ae+be*Ee;return st?(s[0]=(y*tt-b*Ke+T*ze)*(st=1/st),s[1]=(u*Ke-c*tt-p*ze)*st,s[2]=(N*be-V*ue+G*_e)*st,s[3]=(P*ue-C*be-D*_e)*st,s[4]=(b*Ze-m*tt-T*Ae)*st,s[5]=(n*tt-u*Ze+p*Ae)*st,s[6]=(V*ie-L*be-G*Y)*st,s[7]=(A*be-P*ie+D*Y)*st,s[8]=(m*Ke-y*Ze+T*Ee)*st,s[9]=(c*Ze-n*Ke-p*Ee)*st,s[10]=(L*ue-N*ie+G*X)*st,s[11]=(C*ie-A*ue-D*X)*st,s[12]=(y*Ae-m*ze-b*Ee)*st,s[13]=(n*ze-c*Ae+u*Ee)*st,s[14]=(N*Y-L*_e-V*X)*st,s[15]=(A*_e-C*Y+P*X)*st,s):null}function re(s,e,n){var c=e[0],u=e[1],p=e[2],m=e[3],y=e[4],b=e[5],T=e[6],A=e[7],C=e[8],P=e[9],D=e[10],L=e[11],N=e[12],V=e[13],G=e[14],X=e[15],Y=n[0],ie=n[1],_e=n[2],ue=n[3];return s[0]=Y*c+ie*y+_e*C+ue*N,s[1]=Y*u+ie*b+_e*P+ue*V,s[2]=Y*p+ie*T+_e*D+ue*G,s[3]=Y*m+ie*A+_e*L+ue*X,s[4]=(Y=n[4])*c+(ie=n[5])*y+(_e=n[6])*C+(ue=n[7])*N,s[5]=Y*u+ie*b+_e*P+ue*V,s[6]=Y*p+ie*T+_e*D+ue*G,s[7]=Y*m+ie*A+_e*L+ue*X,s[8]=(Y=n[8])*c+(ie=n[9])*y+(_e=n[10])*C+(ue=n[11])*N,s[9]=Y*u+ie*b+_e*P+ue*V,s[10]=Y*p+ie*T+_e*D+ue*G,s[11]=Y*m+ie*A+_e*L+ue*X,s[12]=(Y=n[12])*c+(ie=n[13])*y+(_e=n[14])*C+(ue=n[15])*N,s[13]=Y*u+ie*b+_e*P+ue*V,s[14]=Y*p+ie*T+_e*D+ue*G,s[15]=Y*m+ie*A+_e*L+ue*X,s}function de(s,e,n){var c,u,p,m,y,b,T,A,C,P,D,L,N=n[0],V=n[1],G=n[2];return e===s?(s[12]=e[0]*N+e[4]*V+e[8]*G+e[12],s[13]=e[1]*N+e[5]*V+e[9]*G+e[13],s[14]=e[2]*N+e[6]*V+e[10]*G+e[14],s[15]=e[3]*N+e[7]*V+e[11]*G+e[15]):(u=e[1],p=e[2],m=e[3],y=e[4],b=e[5],T=e[6],A=e[7],C=e[8],P=e[9],D=e[10],L=e[11],s[0]=c=e[0],s[1]=u,s[2]=p,s[3]=m,s[4]=y,s[5]=b,s[6]=T,s[7]=A,s[8]=C,s[9]=P,s[10]=D,s[11]=L,s[12]=c*N+y*V+C*G+e[12],s[13]=u*N+b*V+P*G+e[13],s[14]=p*N+T*V+D*G+e[14],s[15]=m*N+A*V+L*G+e[15]),s}function Oe(s,e,n){var c=n[0],u=n[1],p=n[2];return s[0]=e[0]*c,s[1]=e[1]*c,s[2]=e[2]*c,s[3]=e[3]*c,s[4]=e[4]*u,s[5]=e[5]*u,s[6]=e[6]*u,s[7]=e[7]*u,s[8]=e[8]*p,s[9]=e[9]*p,s[10]=e[10]*p,s[11]=e[11]*p,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Xe(s,e,n){var c=Math.sin(n),u=Math.cos(n),p=e[4],m=e[5],y=e[6],b=e[7],T=e[8],A=e[9],C=e[10],P=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=p*u+T*c,s[5]=m*u+A*c,s[6]=y*u+C*c,s[7]=b*u+P*c,s[8]=T*u-p*c,s[9]=A*u-m*c,s[10]=C*u-y*c,s[11]=P*u-b*c,s}function qe(s,e,n){var c=Math.sin(n),u=Math.cos(n),p=e[0],m=e[1],y=e[2],b=e[3],T=e[8],A=e[9],C=e[10],P=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u-T*c,s[1]=m*u-A*c,s[2]=y*u-C*c,s[3]=b*u-P*c,s[8]=p*c+T*u,s[9]=m*c+A*u,s[10]=y*c+C*u,s[11]=b*c+P*u,s}function Be(s,e,n){var c=Math.sin(n),u=Math.cos(n),p=e[0],m=e[1],y=e[2],b=e[3],T=e[4],A=e[5],C=e[6],P=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=p*u+T*c,s[1]=m*u+A*c,s[2]=y*u+C*c,s[3]=b*u+P*c,s[4]=T*u-p*c,s[5]=A*u-m*c,s[6]=C*u-y*c,s[7]=P*u-b*c,s}function bt(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Bt(s,e,n){var c,u,p,m=n[0],y=n[1],b=n[2],T=Math.sqrt(m*m+y*y+b*b);return T<O?null:(m*=T=1/T,y*=T,b*=T,c=Math.sin(e),u=Math.cos(e),s[0]=m*m*(p=1-u)+u,s[1]=y*m*p+b*c,s[2]=b*m*p-y*c,s[3]=0,s[4]=m*y*p-b*c,s[5]=y*y*p+u,s[6]=b*y*p+m*c,s[7]=0,s[8]=m*b*p+y*c,s[9]=y*b*p-m*c,s[10]=b*b*p+u,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Jt(s,e){var n=e[0],c=e[1],u=e[2],p=e[4],m=e[5],y=e[6],b=e[8],T=e[9],A=e[10];return s[0]=Math.sqrt(n*n+c*c+u*u),s[1]=Math.sqrt(p*p+m*m+y*y),s[2]=Math.sqrt(b*b+T*T+A*A),s}function nr(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=n+n,y=c+c,b=u+u,T=n*m,A=c*m,C=c*y,P=u*m,D=u*y,L=u*b,N=p*m,V=p*y,G=p*b;return s[0]=1-C-L,s[1]=A+G,s[2]=P-V,s[3]=0,s[4]=A-G,s[5]=1-T-L,s[6]=D+N,s[7]=0,s[8]=P+V,s[9]=D-N,s[10]=1-T-C,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}var Gt=re;function Mt(){var s=new F(3);return F!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Zt(s){var e=new F(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function mr(s){var e=s[0],n=s[1],c=s[2];return Math.sqrt(e*e+n*n+c*c)}function Qt(s,e,n){var c=new F(3);return c[0]=s,c[1]=e,c[2]=n,c}function er(s,e,n,c){return s[0]=e,s[1]=n,s[2]=c,s}function dt(s,e,n){return s[0]=e[0]+n[0],s[1]=e[1]+n[1],s[2]=e[2]+n[2],s}function It(s,e,n){return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],s}function tr(s,e,n){return s[0]=e[0]*n[0],s[1]=e[1]*n[1],s[2]=e[2]*n[2],s}function Gr(s,e,n){return s[0]=Math.min(e[0],n[0]),s[1]=Math.min(e[1],n[1]),s[2]=Math.min(e[2],n[2]),s}function Rr(s,e,n){return s[0]=Math.max(e[0],n[0]),s[1]=Math.max(e[1],n[1]),s[2]=Math.max(e[2],n[2]),s}function Sr(s,e,n){return s[0]=e[0]*n,s[1]=e[1]*n,s[2]=e[2]*n,s}function ti(s,e,n,c){return s[0]=e[0]+n[0]*c,s[1]=e[1]+n[1]*c,s[2]=e[2]+n[2]*c,s}function Vi(s,e){var n=e[0]-s[0],c=e[1]-s[1],u=e[2]-s[2];return Math.sqrt(n*n+c*c+u*u)}function On(s,e){var n=e[0]-s[0],c=e[1]-s[1],u=e[2]-s[2];return n*n+c*c+u*u}function wi(s){var e=s[0],n=s[1],c=s[2];return e*e+n*n+c*c}function Vn(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s}function Hr(s,e){var n=e[0],c=e[1],u=e[2],p=n*n+c*c+u*u;return p>0&&(p=1/Math.sqrt(p)),s[0]=e[0]*p,s[1]=e[1]*p,s[2]=e[2]*p,s}function Pi(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Qi(s,e,n){var c=e[0],u=e[1],p=e[2],m=n[0],y=n[1],b=n[2];return s[0]=u*b-p*y,s[1]=p*m-c*b,s[2]=c*y-u*m,s}function Fn(s,e,n,c){var u=e[0],p=e[1],m=e[2];return s[0]=u+c*(n[0]-u),s[1]=p+c*(n[1]-p),s[2]=m+c*(n[2]-m),s}function bi(s,e,n){var c=e[0],u=e[1],p=e[2],m=n[3]*c+n[7]*u+n[11]*p+n[15];return s[0]=(n[0]*c+n[4]*u+n[8]*p+n[12])/(m=m||1),s[1]=(n[1]*c+n[5]*u+n[9]*p+n[13])/m,s[2]=(n[2]*c+n[6]*u+n[10]*p+n[14])/m,s}function ns(s,e,n){var c=e[0],u=e[1],p=e[2];return s[0]=c*n[0]+u*n[3]+p*n[6],s[1]=c*n[1]+u*n[4]+p*n[7],s[2]=c*n[2]+u*n[5]+p*n[8],s}function ss(s,e,n){var c=n[0],u=n[1],p=n[2],m=n[3],y=e[0],b=e[1],T=e[2],A=u*T-p*b,C=p*y-c*T,P=c*b-u*y;return s[0]=y+m*(A+=A)+u*(P+=P)-p*(C+=C),s[1]=b+m*C+p*A-c*P,s[2]=T+m*P+c*C-u*A,s}function Qn(s){return s[0]=0,s[1]=0,s[2]=0,s}function Ss(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]}var Gi=It,Js=tr,Ve=mr;function ct(){var s=new F(4);return F!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function Ct(s,e,n){return s[0]=e[0]*n,s[1]=e[1]*n,s[2]=e[2]*n,s[3]=e[3]*n,s}function cr(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=n*n+c*c+u*u+p*p;return m>0&&(m=1/Math.sqrt(m)),s[0]=n*m,s[1]=c*m,s[2]=u*m,s[3]=p*m,s}function Nt(s,e,n){var c=e[0],u=e[1],p=e[2],m=e[3];return s[0]=n[0]*c+n[4]*u+n[8]*p+n[12]*m,s[1]=n[1]*c+n[5]*u+n[9]*p+n[13]*m,s[2]=n[2]*c+n[6]*u+n[10]*p+n[14]*m,s[3]=n[3]*c+n[7]*u+n[11]*p+n[15]*m,s}function rr(){var s=new F(4);return F!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function br(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function _i(s,e,n){n*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],y=Math.sin(n),b=Math.cos(n);return s[0]=c*b+m*y,s[1]=u*b+p*y,s[2]=p*b-u*y,s[3]=m*b-c*y,s}function Hi(s,e,n){n*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],y=Math.sin(n),b=Math.cos(n);return s[0]=c*b-p*y,s[1]=u*b+m*y,s[2]=p*b+c*y,s[3]=m*b-u*y,s}Mt(),ct();var xn,js,os,Pa=cr,vo=(xn=Mt(),js=Qt(1,0,0),os=Qt(0,1,0),function(s,e,n){var c=Pi(e,n);return c<-.999999?(Qi(xn,js,e),Ve(xn)<1e-6&&Qi(xn,os,e),Hr(xn,xn),function(u,p,m){m*=.5;var y=Math.sin(m);u[0]=y*p[0],u[1]=y*p[1],u[2]=y*p[2],u[3]=Math.cos(m)}(s,xn,Math.PI),s):c>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Qi(xn,e,n),s[0]=xn[0],s[1]=xn[1],s[2]=xn[2],s[3]=1+c,Pa(s,s))});function en(){var s=new F(2);return F!=Float32Array&&(s[0]=0,s[1]=0),s}function aa(s,e){var n=new F(2);return n[0]=s,n[1]=e,n}function Qs(s,e,n){return s[0]=e,s[1]=n,s}function Do(s,e,n){return s[0]=e[0]+n[0],s[1]=e[1]+n[1],s}function eo(s,e,n){return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s}function lo(s,e,n){return s[0]=e[0]*n,s[1]=e[1]*n,s}function tn(s){var e=s[0],n=s[1];return Math.sqrt(e*e+n*n)}function ms(s,e){var n=e[0],c=e[1],u=n*n+c*c;return u>0&&(u=1/Math.sqrt(u)),s[0]=e[0]*u,s[1]=e[1]*u,s}function Ra(s,e){return s[0]*e[0]+s[1]*e[1]}rr(),rr(),Q();var Vs,co,di=eo;function sn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}en();var An=function(){if(co)return Vs;function s(e,n,c,u){this.cx=3*e,this.bx=3*(c-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=c,this.p2y=u}return co=1,Vs=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var c=e,u=0;u<8;u++){var p=this.sampleCurveX(c)-e;if(Math.abs(p)<n)return c;var m=this.sampleCurveDerivativeX(c);if(Math.abs(m)<1e-6)break;c-=p/m}var y=0,b=1;for(c=e,u=0;u<20&&(p=this.sampleCurveX(c),!(Math.abs(p-e)<n));u++)e>p?y=c:b=c,c=.5*(b-y)+y;return c},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Vs}(),Rs=sn(An);function nt(s,e){this.x=s,this.y=e}function ks(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(!ks(s[n],e[n]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const n in s)if(!ks(s[n],e[n]))return!1;return!0}return s===e}nt.prototype={clone(){return new nt(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,e){return this.clone()._rotateAround(s,e)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const e=s.x-this.x,n=s.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult(s){const e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const e=Math.cos(s),n=Math.sin(s),c=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=c,this},_rotateAround(s,e){const n=Math.cos(s),c=Math.sin(s),u=e.y+c*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-c*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:nt},nt.convert=function(s){if(s instanceof nt)return s;if(Array.isArray(s))return new nt(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new nt(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};const Lo=Math.PI/180,Us=180/Math.PI;function Nr(s){return s*Lo}function $s(s){return s*Us}const lg=[[0,0],[1,0],[1,1],[0,1]];function Yh(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,n=e*s;return 4*(s<.5?n:3*(s-e)+n-.75)}function De(s,e,n,c){const u=new Rs(s,e,n,c);return function(p){return u.solve(p)}}const H=De(.25,.1,.25,1);function W(s,e,n){return Math.min(n,Math.max(e,s))}function le(s,e,n){return(n=W((n-s)/(e-s),0,1))*n*(3-2*n)}function Se(s,e,n){const c=n-e,u=((s-e)%c+c)%c+e;return u===e?n:u}function Te(s,e,n){if(!s.length)return n(null,[]);let c=s.length;const u=new Array(s.length);let p=null;s.forEach((m,y)=>{e(m,(b,T)=>{b&&(p=b),u[y]=T,--c==0&&n(p,u)})})}let Pe=1;function Ge(){return Pe++}function Re(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log2(s)))}function Ue(s,e){s.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function gt(s,e,n){const c={};for(const u in s)c[u]=e.call(this,s[u],u,s);return c}function lt(s,e,n){const c={};for(const u in s)e.call(this,s[u],u,s)&&(c[u]=s[u]);return c}function Xt(s){return Array.isArray(s)?s.map(Xt):typeof s=="object"&&s?gt(s,Xt):s}function vr(s,e){for(let n=0;n<s.length;n++)if(e.indexOf(s[n])>=0)return!0;return!1}const gr={};function or(s){gr[s]||(typeof console<"u"&&console.warn(s),gr[s]=!0)}function zr(s,e,n){return(n.y-s.y)*(e.x-s.x)>(e.y-s.y)*(n.x-s.x)}function jr(s){let e=0;for(let n,c,u=0,p=s.length,m=p-1;u<p;m=u++)n=s[u],c=s[m],e+=(c.x-n.x)*(n.y+c.y);return e}function Ai([s,e,n]){const c=Nr(e+90),u=Nr(n);return{x:s*Math.cos(c)*Math.sin(u),y:s*Math.sin(c)*Math.sin(u),z:s*Math.cos(u),azimuthal:e,polar:n}}function mn(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function Bn(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,c,u,p)=>{const m=u||p;return e[c]=!m||m.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Cn=null;function Sn(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Ei(s,e,n,c){for(;e<n;){const u=e+n>>1;s[u]<c?e=u+1:n=u}return e}function Xr(s,e,n,c){for(;e<n;){const u=e+n>>1;s[u]<=c?e=u+1:n=u}return e}function qi(s){return s>0?1/(1.001-s):1+s}function hn(s){return s>0?1-1/(1.001-s):-s}function Ri(s,e,n){return(s-e.min)*(n.max-n.min)/(e.max-e.min)+n.min}const Wi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Wi.API_URL)return null;try{const s=new URL(Wi.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function qn(s){return Wi.API_URL_REGEX.test(s)}function Gs(s){return Wi.API_SPRITE_REGEX.test(s)}let la,Rc,es,ca,to,ka;function xo(){return la==null&&(la=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),la}const wo={now:()=>ca!==void 0?ca:performance.now(),setNow(s){ca=s},restoreNow(){ca=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:n,height:c}=s;to||(to=document.createElement("canvas"));const u=to.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>to.width||c>to.height)&&(to.width=n,to.height=c),u.clearRect(-e,-e,n+2*e,c+2*e),u.drawImage(s,0,0,n,c),u.getImageData(-e,-e,n+2*e,c+2*e)},resolveURL:s=>(Rc||(Rc=document.createElement("a")),Rc.href=s,Rc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(es==null&&(es=window.matchMedia("(prefers-reduced-motion: reduce)")),es.matches)},hasCanvasFingerprintNoise(){if(ka!==void 0)return ka;if(!xo())return ka=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<s.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const c=e.getImageData(0,0,s.width,s.height);n=0;for(let u=0;u<c.data.length;++u)if(u%4!=3&&n++!==c.data[u])return ka=!0,!0;return ka=!1,!1}};function If(s,e){const n=s.indexOf("?");if(n<0)return`${s}?${new URLSearchParams(e).toString()}`;const c=new URLSearchParams(s.slice(n));for(const u in e)c.set(u,e[u]);return`${s.slice(0,n)}?${c.toString()}`}function Jh(s,e={persistentParams:[]}){const n=s.indexOf("?");if(n<0)return s;const c=new URLSearchParams,u=new URLSearchParams(s.slice(n));for(const m of e.persistentParams){const y=u.get(m);y&&c.set(m,y)}const p=c.toString();return`${s.slice(0,n)}${p.length>0?`?${p}`:""}`}const Qh="mapbox-tiles";let ed=500,uo=50;const Ma=["language","worldview","jobid"];let ro,zo;function fl(){try{return caches}catch{}}function kc(){const s=fl();s&&ro==null&&(ro=s.open(Qh))}let Af=1/0;const Cf={supported:!1,testSupport:function(s){!cg&&Yl&&(R0?ug(s):Ya=s)}};let Ya,Yl,cg=!1,R0=!1;const ua=typeof self<"u"?self:{};function ug(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Yl),s.isContextLost())return;Cf.supported=!0}catch{}s.deleteTexture(e),cg=!0}ua.document&&(Yl=ua.document.createElement("img"),Yl.onload=function(){Ya&&ug(Ya),Ya=null,R0=!0},Yl.onerror=function(){cg=!0,Ya=null},Yl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Mc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Mc);class Oc extends Error{constructor(e,n,c){n===401&&qn(c)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const hg=mn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,td=function(s,e){if(!(/^file:/.test(n=s.url)||/^file:/.test(hg())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(c,u){const p=new AbortController,m=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:hg(),referrerPolicy:c.referrerPolicy,signal:p.signal});let y=!1,b=!1;const T=(A=m.url).indexOf("sku=")>0&&qn(A);var A;c.type==="json"&&m.headers.set("Accept","application/json");const C=(D,L,N)=>{if(b)return;if(D&&D.message!=="SecurityError"&&or(D.toString()),L&&N)return P(L);const V=Date.now();fetch(m).then(G=>{if(G.ok){const X=T?G.clone():null;return P(G,X,V)}return u(new Oc(G.statusText,G.status,c.url))}).catch(G=>{G.name!=="AbortError"&&u(new Error(`${G.message} ${c.url}`))})},P=(D,L,N)=>{(c.type==="arrayBuffer"?D.arrayBuffer():c.type==="json"?D.json():D.text()).then(V=>{b||(L&&N&&function(G,X,Y){if(kc(),ro==null)return;const ie=Bn(X.headers.get("Cache-Control")||"");if(ie["no-store"])return;const _e={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((Ee,Ae)=>_e.headers.set(Ae,Ee)),ie["max-age"]&&_e.headers.set("Expires",new Date(Y+1e3*ie["max-age"]).toUTCString());const ue=_e.headers.get("Expires");if(!ue||new Date(ue).getTime()-Y<42e4)return;let be=Jh(G.url,{persistentParams:Ma});if(X.status===206){const Ee=G.headers.get("Range");if(!Ee)return;_e.status=200,be=If(be,{range:Ee})}(function(Ee,Ae){if(zo===void 0)try{new Response(new ReadableStream),zo=!0}catch{zo=!1}zo?Ae(Ee.body):Ee.blob().then(Ae).catch(Ze=>or(Ze.message))})(X,Ee=>{const Ae=new Response((Ze=X.status)!==200&&Ze!==404&&[101,103,204,205,304].includes(Ze)?null:Ee,_e);var Ze;kc(),ro!=null&&ro.then(ze=>ze.put(be,Ae)).catch(ze=>or(ze.message))})}(m,L,N),y=!0,u(null,V,D.headers))}).catch(V=>{b||u(new Error(V.message))})};return T?function(D,L){if(kc(),ro==null)return L(null);ro.then(N=>{let V=Jh(D.url,{persistentParams:Ma});const G=D.headers.get("Range");G&&(V=If(V,{range:G})),N.match(V).then(X=>{const Y=function(ie){if(!ie)return!1;const _e=new Date(ie.headers.get("Expires")||0),ue=Bn(ie.headers.get("Cache-Control")||"");return Number(_e)>Date.now()&&!ue["no-cache"]}(X);N.delete(V).catch(L),Y&&N.put(V,X.clone()).catch(L),L(null,X,Y)}).catch(L)}).catch(L)}(m,C):C(null,null),{cancel:()=>{b=!0,y||p.abort()}}}(s,e);if(mn(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var n;return function(c,u){const p=new XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in c.headers)p.setRequestHeader(m,c.headers[m]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(c.type==="json")try{m=JSON.parse(p.response)}catch(b){return u(b)}const y=new Headers;p.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{const T=b.split(": "),A=T.shift(),C=T.join(": ");y.append(A,C)}),u(null,m,y)}else u(new Oc(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(s,e)},vu=function(s,e){return td(Object.assign(s,{type:"arrayBuffer"}),e)};function fi(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const dg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let rd,id;rd=[],id=0;const fg=function(s,e){if(Cf.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),id>=Wi.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return rd.push(p),p}id++;let n=!1;const c=()=>{if(!n)for(n=!0,id--;rd.length&&id<Wi.MAX_PARALLEL_IMAGE_REQUESTS;){const p=rd.shift(),{requestParameters:m,callback:y,cancelled:b}=p;b||(p.cancel=fg(m,y).cancel)}},u=vu(s,(p,m,y)=>{c(),p?e(p):m&&(self.createImageBitmap?function(b,T){const A=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(A).then(C=>{T(null,C)}).catch(C=>{T(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,T)=>e(b,T,y)):function(b,T){const A=new Image;A.onload=()=>{T(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=dg})},A.onerror=()=>T(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(b)],{type:"image/png"});A.src=b.byteLength?URL.createObjectURL(C):dg}(m,(b,T)=>e(b,T,y)))});return{cancel:()=>{u.cancel(),c()}}};var nd,sd,od,Dc={exports:{}},k0={exports:{}},Pf={exports:{}},Kw=function(){if(od)return Dc.exports;od=1;var s=(nd||(nd=1,k0.exports=function(n,c){var u,p,m,y,b,T,A,C;for(p=n.length-(u=3&n.length),m=c,b=3432918353,T=461845907,C=0;C<p;)A=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,m=27492+(65535&(y=5*(65535&(m=(m^=A=(65535&(A=(A=(65535&A)*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(A=0,u){case 3:A^=(255&n.charCodeAt(C+2))<<16;case 2:A^=(255&n.charCodeAt(C+1))<<8;case 1:m^=A=(65535&(A=(A=(65535&(A^=255&n.charCodeAt(C)))*b+(((A>>>16)*b&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return m^=n.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),k0.exports),e=(sd||(sd=1,Pf.exports=function(n,c){for(var u,p=n.length,m=c^p,y=0;p>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++y;switch(p){case 3:m^=(255&n.charCodeAt(y+2))<<16;case 2:m^=(255&n.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&n.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),Pf.exports);return Dc.exports=s,Dc.exports.murmur3=s,Dc.exports.murmur2=e,Dc.exports}(),ad=sn(Kw);class Fo{constructor(e,...n){Object.assign(this,n[0]||{}),this.type=e}}class ld extends Fo{constructor(e,n={}){super("error",Object.assign({error:e},n))}}function xu(s,e,n){n[s]&&n[s].indexOf(e)!==-1||(n[s]=n[s]||[],n[s].push(e))}function cd(s,e,n){if(n&&n[s]){const c=n[s].indexOf(e);c!==-1&&n[s].splice(c,1)}}class pl{on(e,n){return this._listeners=this._listeners||{},xu(e,n,this._listeners),this}off(e,n){return cd(e,n,this._listeners),cd(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},xu(e,n,this._oneTimeListeners),this):new Promise(c=>{this.once(e,c)})}fire(e,n){const c=typeof e=="string"?new Fo(e,n):e,u=c.type;if(this.listens(u)){c.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of p)b.call(this,c);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of m)cd(u,b,this._oneTimeListeners),b.call(this,c);const y=this._eventedParent;if(y){const b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(c,b),y.fire(c)}}else c instanceof ld&&console.error(c.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class Wn{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Wn(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,c]=e.split("");return new Wn({name:n,iconsetId:c})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return Wn.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var pg,mg={},gg=function(){if(pg)return mg;pg=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function n(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function c(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function u(p,m,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?p+(m-p)*y*6:2*y<1?m:3*y<2?p+(m-p)*(2/3-y)*6:p}try{mg.parseCSSColor=function(p){var m,y=p.replace(/ /g,"").toLowerCase();if(y in s)return s[y].slice();if(y[0]==="#")return y.length===4?(m=parseInt(y.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:y.length===7&&(m=parseInt(y.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var b=y.indexOf("("),T=y.indexOf(")");if(b!==-1&&T+1===y.length){var A=y.substr(0,b),C=y.substr(b+1,T-(b+1)).split(","),P=1;switch(A){case"rgba":if(C.length!==4)return null;P=c(C.pop());case"rgb":return C.length!==3?null:[n(C[0]),n(C[1]),n(C[2]),P];case"hsla":if(C.length!==4)return null;P=c(C.pop());case"hsl":if(C.length!==3)return null;var D=(parseFloat(C[0])%360+360)%360/360,L=c(C[1]),N=c(C[2]),V=N<=.5?N*(L+1):N+L-N*L,G=2*N-V;return[e(255*u(G,V,D+1/3)),e(255*u(G,V,D)),e(255*u(G,V,D-1/3)),P];default:return null}}return null}}catch{}return mg}();class yi{constructor(e,n,c,u=1){this.r=e,this.g=n,this.b=c,this.a=u}static parse(e){if(!e)return;if(e instanceof yi)return e;if(typeof e!="string")return;const n=gg.parseCSSColor(e);return n?new yi(n[0]/255,n[1]/255,n[2]/255,n[3]):void 0}toString(){const[e,n,c,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*c)},${u})`}toNonPremultipliedRenderColor(e){const{r:n,g:c,b:u,a:p}=this;return new M0(e,n,c,u,p)}toPremultipliedRenderColor(e){const{r:n,g:c,b:u,a:p}=this;return new O0(e,n*p,c*p,u*p,p)}clone(){return new yi(this.r,this.g,this.b,this.a)}}class _g{constructor(e,n,c,u,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const y=e.image.height,b=y*y;this.premultiplied?(n=p===0?0:n/p*(y-1),c=p===0?0:c/p*(y-1),u=p===0?0:u/p*(y-1)):(n*=y-1,c*=y-1,u*=y-1);const T=Math.floor(n),A=Math.floor(c),C=Math.floor(u),P=Math.ceil(n),D=Math.ceil(c),L=Math.ceil(u),N=n-T,V=c-A,G=u-C,X=e.image.data,Y=4*(T+A*b+C*y),ie=4*(T+A*b+L*y),_e=4*(T+D*b+C*y),ue=4*(T+D*b+L*y),be=4*(P+A*b+C*y),Ee=4*(P+A*b+L*y),Ae=4*(P+D*b+C*y),Ze=4*(P+D*b+L*y);if(Y<0||Ze>=X.length)throw new Error("out of range");this.r=pr(pr(pr(X[Y],X[ie],G),pr(X[_e],X[ue],G),V),pr(pr(X[be],X[Ee],G),pr(X[Ae],X[Ze],G),V),N)/255*(this.premultiplied?p:1),this.g=pr(pr(pr(X[Y+1],X[ie+1],G),pr(X[_e+1],X[ue+1],G),V),pr(pr(X[be+1],X[Ee+1],G),pr(X[Ae+1],X[Ze+1],G),V),N)/255*(this.premultiplied?p:1),this.b=pr(pr(pr(X[Y+2],X[ie+2],G),pr(X[_e+2],X[ue+2],G),V),pr(pr(X[be+2],X[Ee+2],G),pr(X[Ae+2],X[Ze+2],G),V),N)/255*(this.premultiplied?p:1),this.a=p}else this.r=n,this.g=c,this.b=u,this.a=p}toArray(){const{r:e,g:n,b:c,a:u}=this;return[255*e,255*n,255*c,u]}toHslaArray(){let{r:e,g:n,b:c,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const L=1/u;e*=L,n*=L,c*=L}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(n,0),1),y=Math.min(Math.max(c,0),1),b=Math.min(p,m,y),T=Math.max(p,m,y),A=T-b,C=.5*(b+T);if(A===0)return[0,0,100*C,u];const P=C>.5?A/(2-T-b):A/(T+b);let D;switch(T){case p:D=60*((m-y)/A+(m<y?6:0));break;case m:D=60*((y-p)/A+2);break;default:D=60*((p-m)/A+4)}return[D,100*P,100*C,u]}toArray01(){const{r:e,g:n,b:c,a:u}=this;return[e,n,c,u]}toArray01Scaled(e){const{r:n,g:c,b:u}=this;return[n*e,c*e,u*e]}toArray01Linear(){const{r:e,g:n,b:c,a:u}=this;return[Math.pow(e,2.2),Math.pow(n,2.2),Math.pow(c,2.2),u]}}class M0 extends _g{constructor(e,n,c,u,p){super(e,n,c,u,p,!1)}}class O0 extends _g{constructor(e,n,c,u,p){super(e,n,c,u,p,!0)}}function pr(s,e,n){return s*(1-n)+e*n}function ud(s,e,n){return s.map((c,u)=>pr(c,e[u],n))}yi.black=new yi(0,0,0,1),yi.white=new yi(1,1,1,1),yi.transparent=new yi(0,0,0,0),yi.red=new yi(1,0,0,1),yi.blue=new yi(0,0,1,1);var ml=Object.freeze({__proto__:null,array:ud,color:function(s,e,n){return new yi(pr(s.r,e.r,n),pr(s.g,e.g,n),pr(s.b,e.b,n),pr(s.a,e.a,n))},number:pr});class ha extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class da{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[c,u]of n)this.bindings[c]=u}concat(e){return new da(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wu={kind:"null"},Yt={kind:"number"},si={kind:"string"},mi={kind:"boolean"},bo={kind:"color"},bu={kind:"object"},Ti={kind:"value"},hd={kind:"collator"},Lc={kind:"formatted"},dd={kind:"resolvedImage"};function gs(s,e){return{kind:"array",itemType:s,N:e}}function Un(s){if(s.kind==="array"){const e=Un(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const Yw=[wu,Yt,si,mi,bo,Lc,bu,gs(Ti),dd];function fd(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fd(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const n of Yw)if(!fd(n,e))return null}}return`Expected ${Un(s)} but found ${Un(e)} instead.`}function yg(s,e){return e.some(n=>n.kind===s.kind)}function pd(s,e){return e.some(n=>n==="null"?s===null:n==="array"?Array.isArray(s):n==="object"?s&&!Array.isArray(s)&&typeof s=="object":n===typeof s)}function Rf(s,e){return s.kind==="array"&&e.kind==="array"?s.N===e.N&&Rf(s.itemType,e.itemType):s.kind===e.kind}class vg{constructor(e,n,c){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class md{constructor(e,n,c,u,p){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=c,this.fontStack=u,this.textColor=p}}class as{constructor(e){this.sections=e}static fromString(e){return new as([new md(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof as?e:as.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const u=n.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(n.text);const c={};n.fontStack&&(c["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(c["font-scale"]=n.scale),n.textColor&&(c["text-color"]=["rgba"].concat(n.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(c)}return e}}class gl{constructor(e,n={}){if(this.id=Wn.from(e),this.options=Object.assign({},n),n.transform){const{a:c,b:u,c:p,d:m,e:y,f:b}=n.transform;this.options.transform=new DOMMatrix([c,u,p,m,y,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:n,c,d:u,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:n,c,d:u,e:p,f:m}})}static parse(e){let n,c,u,p;try{({name:n,iconsetId:c,params:u,transform:p}=JSON.parse(e)||{})}catch{return null}if(!n)return null;const{a:m,b:y,c:b,d:T,e:A,f:C}=p||{};return new gl({name:n,iconsetId:c},{params:u,transform:new DOMMatrix([m,y,b,T,A,C])})}scaleSelf(e,n){return this.options.transform.scaleSelf(e,n),this}}class ho{constructor(e,n,c,u,p=!1){this.primaryId=Wn.from(e),this.primaryOptions=n,c&&(this.secondaryId=Wn.from(c)),this.secondaryOptions=u,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new gl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new gl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?ho.build({name:e}):e}static build(e,n,c,u){return!e||typeof e=="object"&&!("name"in e)?null:new ho(e,c,n,u)}}function kf(s,e,n,c){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[s,e,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[s,e,n,c]:[s,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Tu(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof yi||s instanceof vg||s instanceof as||s instanceof ho)return!0;if(Array.isArray(s)){for(const e of s)if(!Tu(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!Tu(s[e]))return!1;return!0}return!1}function ts(s){if(s===null)return wu;if(typeof s=="string")return si;if(typeof s=="boolean")return mi;if(typeof s=="number")return Yt;if(s instanceof yi)return bo;if(s instanceof vg)return hd;if(s instanceof as)return Lc;if(s instanceof ho)return dd;if(Array.isArray(s)){const e=s.length;let n;for(const c of s){const u=ts(c);if(n){if(n===u)continue;n=Ti;break}n=u}return gs(n||Ti,e)}return bu}function Ja(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof as||s instanceof ho||s instanceof yi?s.toString():JSON.stringify(s)}class _l{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Tu(e[1]))return n.error("invalid value");const c=e[1];let u=ts(c);const p=n.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new _l(u,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof yi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof as?this.value.serialize():this.value}}class Pn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Dr={string:si,number:Yt,boolean:mi,object:bu};class qt{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let c,u=1;const p=e[0];if(p==="array"){let y,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in Dr)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Dr[T],u++}else y=Ti;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}c=gs(y,b)}else c=Dr[p];const m=[];for(;u<e.length;u++){const y=n.parse(e[u],u,Ti);if(!y)return null;m.push(y)}return new qt(c,m)}evaluate(e){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(e);if(!fd(this.type,ts(c)))return c;if(n===this.args.length-1)throw new Pn(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Un(ts(c))} but was expected to be of type ${Un(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const c=e.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){n.push(c.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(c=>c.serialize()))}}class zc{constructor(e){this.type=Lc,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const u=[];let p=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(p&&typeof y=="object"&&!Array.isArray(y)){p=!1;let b=null;if(y["font-scale"]&&(b=n.parseObjectValue(y["font-scale"],m,"font-scale",Yt),!b))return null;let T=null;if(y["text-font"]&&(T=n.parseObjectValue(y["text-font"],m,"text-font",gs(si)),!T))return null;let A=null;if(y["text-color"]&&(A=n.parseObjectValue(y["text-color"],m,"text-color",bo),!A))return null;const C=u[u.length-1];C.scale=b,C.font=T,C.textColor=A}else{const b=n.parse(e[m],m,Ti);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new zc(u)}evaluate(e){return new as(this.sections.map(n=>{const c=n.content.evaluate(e);return Rf(ts(c),dd)?new md("",c,null,null,null):new md(Ja(c),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const c={};n.scale&&(c["font-scale"]=n.scale.serialize()),n.font&&(c["text-font"]=n.font.serialize()),n.textColor&&(c["text-color"]=n.textColor.serialize()),e.push(c)}return e}}class Tr{constructor(e,n,c,u){this._imageWarnHistory={},this.type=dd,this.namePrimary=e,this.nameSecondary=n,c&&(this.paramsPrimary=c.params,this.iconsetIdPrimary=c.iconset?c.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let c=1;const u=[];function p(){if(c<e.length){const y=n.parse(e[c],c++,si);return y?(u.push({image:y,options:{}}),!0):(n.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(c<e.length){const b=e[c];if((y=b)===null||typeof y!="object"||Array.isArray(y))return!0;const T=b.params,A=b.iconset,C=n.concat(c);if(!T&&!A)return c++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const P={},D=C.concat(void 0,"params");for(const L in T){if(!L)return D.error("Image parameter name should be non-empty"),!1;const N=D.concat(void 0,L).parse(T[L],void 0,bo,void 0,{typeAnnotation:"coerce"});if(!N)return!1;P[L]=N}u[u.length-1].options.params=P}if(A){if(typeof A!="object"||A.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!A.id)return C.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=A}return c++,!0}var y;return!0}for(let y=0;y<2;y++)if(!p()||!m())return;return new Tr(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,n){const c={};if(n){for(const u in n)if(n[u])try{c[u]=n[u].evaluate(e)}catch{continue}if(Object.keys(c).length!==0)return{params:c}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},c=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=ho.build(n,c,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const p=u.getPrimary().id;if(u.available=e.availableImages.some(m=>Wn.isEqual(m,p)),u.available){const m=u.getSecondary()?u.getSecondary().id:null;m&&(u.available=e.availableImages.some(y=>Wn.isEqual(y,m)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const c={};if(n&&(c.iconset={id:n}),e){c.params={};for(const u in e)e[u]&&(c.params[u]=e[u].serialize())}return Object.keys(c).length>0?c:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Su(s){return _r(s)?"string":gd(s)?"number":Of(s)?"boolean":Array.isArray(s)?"array":s===null?"null":Mf(s)?"object":typeof s}function Mf(s){return s!=null&&!Array.isArray(s)&&typeof s!="function"&&!(s instanceof String||s instanceof Number||s instanceof Boolean)&&typeof s=="object"}function _r(s){return typeof s=="string"||s instanceof String}function gd(s){return typeof s=="number"||s instanceof Number}function Of(s){return typeof s=="boolean"||s instanceof Boolean}const D0={"to-boolean":mi,"to-color":bo,"to-number":Yt,"to-string":si};class Qa{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const c=e[0],u=[];let p=wu;if(c==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);p=gs(n.expectedType.itemType,m)}else{if(!(m>0&&Tu(e[1][0])))return null;p=gs(ts(e[1][0]),m)}for(let y=0;y<m;y++){const b=e[1][y];let T;if(Array.isArray(b))T=n.parse(b,void 0,p.itemType);else{const A=Su(b);if(A!==p.itemType.kind)return n.error(`Expected ${p.itemType.kind} but found ${A}.`);T=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!T)return null;u.push(T)}}else{if((c==="to-boolean"||c==="to-string")&&e.length!==2)return n.error("Expected one argument.");p=D0[c];for(let m=1;m<e.length;m++){const y=n.parse(e[m],m,Ti);if(!y)return null;u.push(y)}}return new Qa(p,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,c;for(const u of this.args){if(n=u.evaluate(e),c=null,n instanceof yi)return n;if(typeof n=="string"){const p=e.parseColor(n);if(p)return p}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:kf(n[0],n[1],n[2],n[3]),!c))return new yi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Pn(c||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const c of this.args){if(n=c.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Pn(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?as.fromString(Ja(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ho.build(Ja(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Ja(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new zc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Tr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Df=["Unknown","Point","LineString","Polygon"];class _s{constructor(e,n,c){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n,this.iconImageUseTheme=c}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Df[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:c,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=yi.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Hs{constructor(e,n,c,u,p){this.name=e,this.type=n,this._evaluate=c,this.args=u,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const n=Hs.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const c=e[0],u=Hs.definitions[c];if(!u)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,T=-1;for(const[A,C]of m){if(Array.isArray(A)&&A.length!==e.length-1)continue;y.push(A),T++,b=new Gf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options,n.iconImageUseTheme);const P=[];let D=!1;for(let L=1;L<e.length;L++){const N=e[L],V=Array.isArray(A)?A[L-1]:A.type,G=b.parse(N,1+P.length,V);if(!G){D=!0;break}P.push(G)}if(!D)if(Array.isArray(A)&&A.length!==P.length)b.error(`Expected ${A.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const N=Array.isArray(A)?A[L]:A.type,V=P[L];b.concat(L+1).checkSubtype(N,V.type)}if(b.errors.length===0)return new Hs(c,p,C,P,T)}}if(y.length===1)n.errors.push(...b.errors);else{const A=(y.length?y:m.map(([P])=>P)).map(Fc).join(" | "),C=[];for(let P=1;P<e.length;P++){const D=n.parse(e[P],1+C.length);if(!D)return null;C.push(Un(D.type))}n.error(`Expected arguments of type ${A}, but found (${C.join(", ")}) instead.`)}return null}static register(e,n){Hs.definitions=n;for(const c in n)e[c]=Hs}}function Fc(s){return Array.isArray(s)?`(${s.map(Un).join(", ")})`:`(${Un(s.type)}...)`}class Eu{constructor(e,n,c){this.type=hd,this.locale=c,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const c=e[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const u=c["case-sensitive"]===void 0?n.parse(!1,1,mi):n.parseObjectValue(c["case-sensitive"],1,"case-sensitive",mi);if(!u)return null;const p=c["diacritic-sensitive"]===void 0?n.parse(!1,1,mi):n.parseObjectValue(c["diacritic-sensitive"],1,"diacritic-sensitive",mi);if(!p)return null;let m=null;return c.locale&&(m=n.parseObjectValue(c.locale,1,"locale",si),!m)?null:new Eu(u,p,m)}evaluate(e){return new vg(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function yl(s,e,n=0,c=s.length-1,u=Jw){for(;c>n;){if(c-n>600){const b=c-n+1,T=e-n+1,A=Math.log(b),C=.5*Math.exp(2*A/3),P=.5*Math.sqrt(A*C*(b-C)/b)*(T-b/2<0?-1:1);yl(s,e,Math.max(n,Math.floor(e-T*C/b+P)),Math.min(c,Math.floor(e+(b-T)*C/b+P)),u)}const p=s[e];let m=n,y=c;for(ys(s,n,e),u(s[c],p)>0&&ys(s,n,c);m<y;){for(ys(s,m,y),m++,y--;u(s[m],p)<0;)m++;for(;u(s[y],p)>0;)y--}u(s[n],p)===0?ys(s,n,y):(y++,ys(s,y,c)),y<=e&&(n=y+1),e<=y&&(c=y-1)}}function ys(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}function Jw(s,e){return s<e?-1:s>e?1:0}function Qw(s){let e=0;for(let n,c,u=0,p=s.length,m=p-1;u<p;m=u++)n=s[u],c=s[m],e+=(c.x-n.x)*(n.y+c.y);return e}function _d(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Jl(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function L0(s,e,n){const c=s[0]-e[0],u=s[1]-e[1],p=s[0]-n[0],m=s[1]-n[1];return c*m-p*u==0&&c*p<=0&&u*m<=0}function fa(s,e,n=!1){let c=!1;for(let y=0,b=e.length;y<b;y++){const T=e[y];for(let A=0,C=T.length,P=C-1;A<C;P=A++){const D=T[P],L=T[A];if(L0(s,D,L))return n;(p=D)[1]>(u=s)[1]!=(m=L)[1]>u[1]&&u[0]<(m[0]-p[0])*(u[1]-p[1])/(m[1]-p[1])+p[0]&&(c=!c)}}var u,p,m;return c}function z0(s,e,n,c){const u=c[0]-n[0],p=c[1]-n[1],m=(s[0]-n[0])*p-u*(s[1]-n[1]),y=(e[0]-n[0])*p-u*(e[1]-n[1]);return m>0&&y<0||m<0&&y>0}function Lf(s,e,n,c){return(u=[c[0]-n[0],c[1]-n[1]])[0]*(p=[e[0]-s[0],e[1]-s[1]])[1]-u[1]*p[0]!=0&&!(!z0(s,e,n,c)||!z0(n,c,s,e));var u,p}function yd(s){const e=new nt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),n=new nt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const c of s[0])e.x>c.x&&(e.x=c.x),e.y>c.y&&(e.y=c.y),n.x<c.x&&(n.x=c.x),n.y<c.y&&(n.y=c.y);return{min:e,max:n}}const Ql=8192;function eb(s,e){const n=(180+s[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Ql),Math.round(c*u*Ql)]}function F0(s,e){for(let n=0;n<e.length;n++)if(fa(s,e[n]))return!0;return!1}function tb(s,e,n){for(const c of n)for(let u=0,p=c.length,m=p-1;u<p;m=u++)if(Lf(s,e,c[m],c[u]))return!0;return!1}function ec(s,e){for(let n=0;n<s.length;++n)if(!fa(s[n],e))return!1;for(let n=0;n<s.length-1;++n)if(tb(s[n],s[n+1],e))return!1;return!0}function rb(s,e){for(let n=0;n<e.length;n++)if(ec(s,e[n]))return!0;return!1}function xg(s,e,n){const c=[];for(let u=0;u<s.length;u++){const p=[];for(let m=0;m<s[u].length;m++){const y=eb(s[u][m],n);_d(e,y),p.push(y)}c.push(p)}return c}function zf(s,e,n){const c=[];for(let u=0;u<s.length;u++){const p=xg(s[u],e,n);c.push(p)}return c}function wg(s,e,n,c){if(s[0]<n[0]||s[0]>n[2]){const u=.5*c;let p=s[0]-n[0]>u?-c:n[0]-s[0]>u?c:0;p===0&&(p=s[0]-n[2]>u?-c:n[2]-s[0]>u?c:0),s[0]+=p}_d(e,s)}function bg(s,e,n,c){const u=Math.pow(2,c.z)*Ql,p=[c.x*Ql,c.y*Ql],m=[];if(!s)return m;for(const y of s)for(const b of y){const T=[b.x+p[0],b.y+p[1]];wg(T,e,n,u),m.push(T)}return m}function pa(s,e,n,c){const u=Math.pow(2,c.z)*Ql,p=[c.x*Ql,c.y*Ql],m=[];if(!s)return m;for(const b of s){const T=[];for(const A of b){const C=[A.x+p[0],A.y+p[1]];_d(e,C),T.push(C)}m.push(T)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const T of b)wg(T,e,n,u)}var y;return m}class Bc{constructor(e,n){this.type=mi,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Tu(e[1])){const c=e[1];if(c.type==="FeatureCollection")for(let u=0;u<c.features.length;++u){const p=c.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Bc(c,c.features[u].geometry)}else if(c.type==="Feature"){const u=c.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Bc(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Bc(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const y=xg(c.coordinates,p,m),b=bg(n.geometry(),u,p,m);if(!Jl(u,p))return!1;for(const T of b)if(!fa(T,y))return!1}if(c.type==="MultiPolygon"){const y=zf(c.coordinates,p,m),b=bg(n.geometry(),u,p,m);if(!Jl(u,p))return!1;for(const T of b)if(!F0(T,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,c){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=n.canonicalID();if(!m)return!1;if(c.type==="Polygon"){const y=xg(c.coordinates,p,m),b=pa(n.geometry(),u,p,m);if(!Jl(u,p))return!1;for(const T of b)if(!ec(T,y))return!1}if(c.type==="MultiPolygon"){const y=zf(c.coordinates,p,m),b=pa(n.geometry(),u,p,m);if(!Jl(u,p))return!1;for(const T of b)if(!rb(T,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const vd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Tg=1/298.257223563,Sg=Tg*(2-Tg),Iu=Math.PI/180;class Au{static fromTile(e,n,c){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Iu;return new Au(p,c)}static get units(){return vd}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!vd[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(vd).join(", ")}`);const c=6378.137*Iu*(n?vd[n]:1),u=Math.cos(e*Iu),p=1/(1-Sg*(1-u*u)),m=Math.sqrt(p);this.kx=c*m*u,this.ky=c*m*p*(1-Sg)}distance(e,n){const c=Bo(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(c*c+u*u)}bearing(e,n){const c=Bo(n[0]-e[0])*this.kx;return Math.atan2(c,(n[1]-e[1])*this.ky)/Iu}destination(e,n,c){const u=c*Iu;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,c){return[e[0]+n/this.kx,e[1]+c/this.ky]}lineDistance(e){let n=0;for(let c=0;c<e.length-1;c++)n+=this.distance(e[c],e[c+1]);return n}area(e){let n=0;for(let c=0;c<e.length;c++){const u=e[c];for(let p=0,m=u.length,y=m-1;p<m;y=p++)n+=Bo(u[p][0]-u[y][0])*(u[p][1]+u[y][1])*(c?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let c=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){const p=e[u],m=e[u+1],y=this.distance(p,m);if(c+=y,c>n)return Ff(p,m,(n-(c-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,n,c){let[u,p]=n,m=Bo(c[0]-u)*this.kx,y=(c[1]-p)*this.ky;if(m!==0||y!==0){const b=(Bo(e[0]-u)*this.kx*m+(e[1]-p)*this.ky*y)/(m*m+y*y);b>1?(u=c[0],p=c[1]):b>0&&(u+=m/this.kx*b,p+=y/this.ky*b)}return m=Bo(e[0]-u)*this.kx,y=(e[1]-p)*this.ky,Math.sqrt(m*m+y*y)}pointOnLine(e,n){let c=1/0,u=e[0][0],p=e[0][1],m=0,y=0;for(let b=0;b<e.length-1;b++){let T=e[b][0],A=e[b][1],C=Bo(e[b+1][0]-T)*this.kx,P=(e[b+1][1]-A)*this.ky,D=0;C===0&&P===0||(D=(Bo(n[0]-T)*this.kx*C+(n[1]-A)*this.ky*P)/(C*C+P*P),D>1?(T=e[b+1][0],A=e[b+1][1]):D>0&&(T+=C/this.kx*D,A+=P/this.ky*D)),C=Bo(n[0]-T)*this.kx,P=(n[1]-A)*this.ky;const L=C*C+P*P;L<c&&(c=L,u=T,p=A,m=b,y=D)}return{point:[u,p],index:m,t:Math.max(0,Math.min(1,y))}}lineSlice(e,n,c){let u=this.pointOnLine(c,e),p=this.pointOnLine(c,n);if(u.index>p.index||u.index===p.index&&u.t>p.t){const T=u;u=p,p=T}const m=[u.point],y=u.index+1,b=p.index;!Eg(c[y],m[0])&&y<=b&&m.push(c[y]);for(let T=y+1;T<=b;T++)m.push(c[T]);return Eg(c[b],p.point)||m.push(p.point),m}lineSliceAlong(e,n,c){let u=0;const p=[];for(let m=0;m<c.length-1;m++){const y=c[m],b=c[m+1],T=this.distance(y,b);if(u+=T,u>e&&p.length===0&&p.push(Ff(y,b,(e-(u-T))/T)),u>=n)return p.push(Ff(y,b,(n-(u-T))/T)),p;u>e&&p.push(b)}return p}bufferPoint(e,n){const c=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-c,e[0]+u,e[1]+c]}bufferBBox(e,n){const c=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-c,e[2]+u,e[3]+c]}insideBBox(e,n){return Bo(e[0]-n[0])>=0&&Bo(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Eg(s,e){return s[0]===e[0]&&s[1]===e[1]}function Ff(s,e,n){const c=Bo(e[0]-s[0]);return[s[0]+c*n,s[1]+(e[1]-s[1])*n]}function Bo(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class Bf{constructor(e=[],n=(c,u)=>c<u?-1:c>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:c}=this,u=n[e];for(;e>0;){const p=e-1>>1,m=n[p];if(c(u,m)>=0)break;n[e]=m,e=p}n[e]=u}_down(e){const{data:n,compare:c}=this,u=this.length>>1,p=n[e];for(;e<u;){let m=1+(e<<1);const y=m+1;if(y<this.length&&c(n[y],n[m])<0&&(m=y),c(n[m],p)>=0)break;n[e]=n[m],e=m}n[e]=p}}var xt=8192;function Ig(s,e){return e.dist-s.dist}const Cu=100,Pu=50;function xd(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==s[n])return!1;return!0}function wd(s){return s[1]-s[0]+1}function el(s,e){const n=s[1]>=s[0]&&s[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Nf(s,e){if(s[0]>s[1])return[null,null];const n=wd(s);if(e){if(n===2)return[s,null];const c=Math.floor(n/2);return[[s[0],s[0]+c],[s[0]+c,s[1]]]}{if(n===1)return[s,null];const c=Math.floor(n/2)-1;return[[s[0],s[0]+c],[s[0]+c+1,s[1]]]}}function ma(s,e){const n=[1/0,1/0,-1/0,-1/0];if(!el(e,s.length))return n;for(let c=e[0];c<=e[1];++c)_d(n,s[c]);return n}function Zr(s){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<s.length;++n)for(let c=0;c<s[n].length;++c)_d(e,s[n][c]);return e}function Ru(s,e,n){if(xd(s)||xd(e))return NaN;let c=0,u=0;return s[2]<e[0]&&(c=e[0]-s[2]),s[0]>e[2]&&(c=s[0]-e[2]),s[1]>e[3]&&(u=s[1]-e[3]),s[3]<e[1]&&(u=e[1]-s[3]),n.distance([0,0],[c,u])}function ib(s){return 360*s-180}function nb(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function jf(s,e){const n=Math.pow(2,e.z),c=(s.y/xt+e.y)/n;return[ib((s.x/xt+e.x)/n),nb(c)]}function sb(s,e){const n=[];for(let c=0;c<s.length;++c)n.push(jf(s[c],e));return n}function ln(s,e,n){const c=n.pointOnLine(e,s).point;return n.distance(s,c)}function B0(s,e,n,c,u){const p=n.slice(c[0],c[1]+1);let m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,ln(s[y],p,u)))===0)return 0;return m}function Ag(s,e,n,c,u){const p=Math.min(u.pointToSegmentDistance(s,n,c),u.pointToSegmentDistance(e,n,c)),m=Math.min(u.pointToSegmentDistance(n,s,e),u.pointToSegmentDistance(c,s,e));return Math.min(p,m)}function ob(s,e,n,c,u){if(!el(e,s.length)||!el(c,n.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let y=c[0];y<c[1];++y){if(Lf(s[m],s[m+1],n[y],n[y+1]))return 0;p=Math.min(p,Ag(s[m],s[m+1],n[y],n[y+1],u))}return p}function ab(s,e,n,c,u){if(!el(e,s.length)||!el(c,n.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let y=c[0];y<=c[1];++y)if((p=Math.min(p,u.distance(s[m],n[y])))===0)return p;return p}function lb(s,e,n){if(fa(s,e,!0))return 0;let c=1/0;for(const u of e){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&(c=Math.min(c,n.pointToSegmentDistance(s,u[p-1],u[0])))===0||(c=Math.min(c,ln(s,u,n)))===0)return c}return c}function cb(s,e,n,c){if(!el(e,s.length))return NaN;for(let p=e[0];p<=e[1];++p)if(fa(s[p],n,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p)for(const m of n)for(let y=0,b=m.length,T=b-1;y<b;T=y++){if(Lf(s[p],s[p+1],m[T],m[y]))return 0;u=Math.min(u,Ag(s[p],s[p+1],m[T],m[y],c))}return u}function N0(s,e){for(const n of s)for(let c=0;c<=n.length-1;++c)if(fa(n[c],e,!0))return!0;return!1}function ub(s,e,n,c=1/0){const u=Zr(s),p=Zr(e);if(c!==1/0&&Ru(u,p,n)>=c)return c;if(Jl(u,p)){if(N0(s,e))return 0}else if(N0(e,s))return 0;let m=c;for(const y of s)for(let b=0,T=y.length,A=T-1;b<T;A=b++)for(const C of e)for(let P=0,D=C.length,L=D-1;P<D;L=P++){if(Lf(y[A],y[b],C[L],C[P]))return 0;m=Math.min(m,Ag(y[A],y[b],C[L],C[P],n))}return m}function Vf(s,e,n,c,u,p,m){if(p===null||m===null)return;const y=Ru(ma(c,p),ma(u,m),n);y<e&&s.push({dist:y,range1:p,range2:m})}function hb(s,e,n,c,u=1/0){let p=Math.min(c.distance(s[0],n[0][0]),u);if(p===0)return p;const m=new Bf([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Ig),y=e?Pu:Cu,b=Zr(n);for(;m.length;){const T=m.pop();if(T.dist>=p)continue;const A=T.range1;if(wd(A)<=y){if(!el(A,s.length))return NaN;if(e){const C=cb(s,A,n,c);if((p=Math.min(p,C))===0)return p}else for(let C=A[0];C<=A[1];++C){const P=lb(s[C],n,c);if((p=Math.min(p,P))===0)return p}}else{const C=Nf(A,e);if(C[0]!==null){const P=Ru(ma(s,C[0]),b,c);P<p&&m.push({dist:P,range1:C[0],range2:[0,0]})}if(C[1]!==null){const P=Ru(ma(s,C[1]),b,c);P<p&&m.push({dist:P,range1:C[1],range2:[0,0]})}}}return p}function j0(s,e,n,c,u,p=1/0){let m=Math.min(p,u.distance(s[0],n[0]));if(m===0)return m;const y=new Bf([{dist:0,range1:[0,s.length-1],range2:[0,n.length-1]}],Ig),b=e?Pu:Cu,T=c?Pu:Cu;for(;y.length;){const A=y.pop();if(A.dist>=m)continue;const C=A.range1,P=A.range2;if(wd(C)<=b&&wd(P)<=T){if(!el(C,s.length)||!el(P,n.length))return NaN;if(e&&c?m=Math.min(m,ob(s,C,n,P,u)):e||c?e&&!c?m=Math.min(m,B0(n,P,s,C,u)):!e&&c&&(m=Math.min(m,B0(s,C,n,P,u))):m=Math.min(m,ab(s,C,n,P,u)),m===0)return m}else{const D=Nf(C,e),L=Nf(P,c);Vf(y,m,u,s,n,D[0],L[0]),Vf(y,m,u,s,n,D[0],L[1]),Vf(y,m,u,s,n,D[1],L[0]),Vf(y,m,u,s,n,D[1],L[1])}}return m}function Cg(s,e,n,c,u=1/0){let p=u;const m=ma(s,[0,s.length-1]);for(const y of n)if(!(p!==1/0&&Ru(m,ma(y,[0,y.length-1]),c)>=p)&&(p=Math.min(p,j0(s,e,y,!0,c,p)),p===0))return p;return p}function Uf(s,e,n,c,u=1/0){let p=u;const m=ma(s,[0,s.length-1]);for(const y of n){if(p!==1/0&&Ru(m,Zr(y),c)>=p)continue;const b=hb(s,e,y,c,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function Pg(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class Nc{constructor(e,n){this.type=Yt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Tu(e[1])){const c=e[1];if(c.type==="FeatureCollection"){for(let u=0;u<c.features.length;++u)if(Pg(c.features[u].geometry.type))return new Nc(c,c.features[u].geometry)}else if(c.type==="Feature"){if(Pg(c.geometry.type))return new Nc(c,c.geometry)}else if(Pg(c.type))return new Nc(c,c)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),c=e.canonicalID();if(n!=null&&c!=null){if(e.geometryType()==="Point")return function(u,p,m){const y=[];for(const T of u)for(const A of T)y.push(jf(A,p));const b=new Au(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?j0(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?Cg(y,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?Uf(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(n,c,this.geometries);if(e.geometryType()==="LineString")return function(u,p,m){const y=[];for(const T of u){const A=[];for(const C of T)A.push(jf(C,p));y.push(A)}const b=new Au(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Cg(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let T=1/0;for(let A=0;A<m.coordinates.length;A++){const C=Cg(m.coordinates[A],!0,y,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}if(m.type==="Polygon"||m.type==="MultiPolygon"){let T=1/0;for(let A=0;A<y.length;A++){const C=Uf(y[A],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return null}(n,c,this.geometries);if(e.geometryType()==="Polygon")return function(u,p,m){const y=[];for(const T of function(A,C){const P=A.length;if(P<=1)return[A];const D=[];let L,N;for(let V=0;V<P;V++){const G=Qw(A[V]);G!==0&&(A[V].area=Math.abs(G),N===void 0&&(N=G<0),N===G<0?(L&&D.push(L),L=[A[V]]):L.push(A[V]))}return L&&D.push(L),D}(u)){const A=[];for(let C=0;C<T.length;++C)A.push(sb(T[C],p));y.push(A)}const b=new Au(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Uf(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let T=1/0;for(let A=0;A<m.coordinates.length;A++){const C=Uf(m.coordinates[A],!0,y,b,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return m.type==="Polygon"||m.type==="MultiPolygon"?function(T,A,C){let P=1/0;for(const D of T)for(const L of A){const N=ub(D,L,C,P);if(isNaN(N))return N;if((P=Math.min(P,N))===0)return P}return P}(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,b):null}(n,c,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ku(s){if(s instanceof Hs&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Bc||s instanceof Nc)return!1;if(s instanceof Ou)return s.featureConstant;let e=!0;return s.eachChild(n=>{e&&!ku(n)&&(e=!1)}),e}function bd(s){if(s instanceof Hs&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(n=>{e&&!bd(n)&&(e=!1)}),e}function Mu(s,e){if(s instanceof Hs&&e.indexOf(s.name)>=0)return!1;let n=!0;return s.eachChild(c=>{n&&!Mu(c,e)&&(n=!1)}),n}function V0(s,e,n){return[s,e,n].filter(Boolean).join("")}function Rg(s,e){switch(s){case"string":return Ja(e);case"number":return+e;case"boolean":return!!e;case"color":return yi.parse(e);case"formatted":return as.fromString(Ja(e));case"resolvedImage":return ho.build(Ja(e))}return e}function U0(s,e,n,c){return c!==void 0&&(s=c*Math.round(s/c)),e!==void 0&&s<e&&(s=e),n!==void 0&&s>n&&(s=n),s}class Ou{constructor(e,n,c,u=!1){this.type=e,this.key=n,this.scope=c,this.featureConstant=u}static parse(e,n){let c=n.expectedType;if(c==null&&(c=Ti),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const u=n.parse(e[1],1);if(!(u instanceof _l))return n.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const y=Ja(u.value);if(e.length>=3){const b=n.parse(e[2],2);if(!(b instanceof _l))return n.error("Scope of 'config' expression must be a string literal.");p=Ja(b.value)}if(n.options){const b=V0(y,p,n._scope),T=n.options.get(b);T&&(m=ku(T.value||T.default))}return new Ou(c,y,p,m)}evaluate(e){const n=V0(this.key,this.scope,e.scope),c=e.getConfig(n);if(!c)return null;const{type:u,value:p,values:m,minValue:y,maxValue:b,stepValue:T}=c,A=c.default.evaluate(e);let C=A;if(p){const P=e.scope;e.scope=(P||"").split("").slice(1).join(""),C=p.evaluate(e),e.scope=P}return u&&(C=Rg(u,C)),C===void 0||y===void 0&&b===void 0&&T===void 0||(typeof C=="number"?C=U0(C,y,b,T):Array.isArray(C)&&(C=C.map(P=>typeof P=="number"?U0(P,y,b,T):P))),p!==void 0&&C!==void 0&&m&&!m.includes(C)&&(C=A,u&&(C=Rg(u,C))),(u&&u!==this.type||C!==void 0&&!Rf(ts(C),this.type))&&(C=Rg(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class $f{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=e[1];return n.scope.has(c)?new $f(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Gf{constructor(e,n=[],c,u=new da,p=[],m,y,b){this.registry=e,this.path=n,this.key=n.map(T=>typeof T=="string"?`['${T}']`:`[${T}]`).join(""),this.scope=u,this.errors=p,this.expectedType=c,this._scope=m,this.options=y,this.iconImageUseTheme=b}parse(e,n,c,u,p={}){return n||c?this.concat(n,null,c,u)._parse(e,p):this._parse(e,p)}parseObjectValue(e,n,c,u,p,m={}){return this.concat(n,c,u,p)._parse(e,m)}_parse(e,n){function c(u,p,m){return m==="assert"?new qt(p,[u]):m==="coerce"?new Qa(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,y=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else p=c(p,m,n.typeAnnotation||"coerce");else p=c(p,m,n.typeAnnotation||"assert")}if(!(p instanceof _l)&&p.type.kind!=="resolvedImage"&&kg(p)){const m=new _s(this._scope,this.options,this.iconImageUseTheme);try{p=new _l(p.type,p.evaluate(m))}catch(y){return this.error(y.message),null}}return p}return Qa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,c,u){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof n=="string"?p.concat(n):p;const m=u?this.scope.concat(u):this.scope;return new Gf(this.registry,p,c||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...n){const c=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new ha(c,e))}checkSubtype(e,n){const c=fd(e,n);return c&&this.error(c),c}}function kg(s){if(s instanceof $f)return kg(s.boundExpression);if(s instanceof Hs&&s.name==="error"||s instanceof Eu||s instanceof Bc||s instanceof Nc||s instanceof Ou)return!1;const e=s instanceof Qa||s instanceof qt;let n=!0;return s.eachChild(c=>{n=e?n&&kg(c):n&&c instanceof _l}),!!n&&ku(s)&&Mu(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Hf(s,e){const n=s.length-1;let c,u,p=0,m=n,y=0;for(;p<=m;)if(y=Math.floor((p+m)/2),c=s[y],u=s[y+1],c<=e){if(y===n||e<u)return y;p=y+1}else{if(!(c>e))throw new Pn("Input is not a number.");m=y-1}return 0}class Td{constructor(e,n,c){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,p]of c)this.labels.push(u),this.outputs.push(p)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(e[1],1,Yt);if(!c)return null;const u=[];let p=null;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],b=e[m+1],T=m,A=m+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=n.parse(b,A,p);if(!C)return null;p=p||C.type,u.push([y,C])}return new Td(p,c,u)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return c[0].evaluate(e);const p=n.length;return u>=n[p-1]?c[p-1].evaluate(e):c[Hf(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const $0=.95047,G0=1.08883,H0=4/29,Du=6/29,qf=3*Du*Du,db=Du*Du*Du,q0=Math.PI/180,fb=180/Math.PI;function Mg(s){return s>db?Math.pow(s,1/3):s/qf+H0}function Og(s){return s>Du?s*s*s:qf*(s-H0)}function Wf(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Zf(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function jc(s){const e=Zf(s.r),n=Zf(s.g),c=Zf(s.b),u=Mg((.4124564*e+.3575761*n+.1804375*c)/$0),p=Mg((.2126729*e+.7151522*n+.072175*c)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-Mg((.0193339*e+.119192*n+.9503041*c)/G0)),alpha:s.a}}function Dg(s){let e=(s.l+16)/116,n=isNaN(s.a)?e:e+s.a/500,c=isNaN(s.b)?e:e-s.b/200;return e=1*Og(e),n=$0*Og(n),c=G0*Og(c),new yi(Wf(3.2404542*n-1.5371385*e-.4985314*c),Wf(-.969266*n+1.8760108*e+.041556*c),Wf(.0556434*n-.2040259*e+1.0572252*c),s.alpha)}function W0(s,e,n){const c=e-s;return s+n*(c>180||c<-180?c-360*Math.round(c/360):c)}const Sd={forward:jc,reverse:Dg,interpolate:function(s,e,n){return{l:pr(s.l,e.l,n),a:pr(s.a,e.a,n),b:pr(s.b,e.b,n),alpha:pr(s.alpha,e.alpha,n)}}},Vc={forward:function(s){const{l:e,a:n,b:c}=jc(s),u=Math.atan2(c,n)*fb;return{h:u<0?u+360:u,c:Math.sqrt(n*n+c*c),l:e,alpha:s.a}},reverse:function(s){const e=s.h*q0,n=s.c;return Dg({l:s.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:s.alpha})},interpolate:function(s,e,n){return{h:W0(s.h,e.h,n),c:pr(s.c,e.c,n),l:pr(s.l,e.l,n),alpha:pr(s.alpha,e.alpha,n)}}};var Xf=Object.freeze({__proto__:null,hcl:Vc,lab:Sd});class No{constructor(e,n,c,u,p){this.type=e,this.operator=n,this.interpolation=c,this.input=u,this.labels=[],this.outputs=[];for(const[m,y]of p)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,n,c,u){let p=0;if(e.name==="exponential")p=Lg(n,e.base,c,u);else if(e.name==="linear")p=Lg(n,1,c,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new Rs(m[0],m[1],m[2],m[3]).solve(Lg(n,1,c,u))}return p}static parse(e,n){let[c,u,p,...m]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const T=u[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:T}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const T=u.slice(1);if(T.length!==4||T.some(A=>typeof A!="number"||A<0||A>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(p=n.parse(p,2,Yt),!p)return null;const y=[];let b=null;c==="interpolate-hcl"||c==="interpolate-lab"?b=bo:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let T=0;T<m.length;T+=2){const A=m[T],C=m[T+1],P=T+3,D=T+4;if(typeof A!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=A)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const L=n.parse(C,D,b);if(!L)return null;b=b||L.type,y.push([A,L])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new No(b,c,u,p,y):n.error(`Type ${Un(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return c[0].evaluate(e);const p=n.length;if(u>=n[p-1])return c[p-1].evaluate(e);const m=Hf(n,u),y=No.interpolationFactor(this.interpolation,u,n[m],n[m+1]),b=c[m].evaluate(e),T=c[m+1].evaluate(e);return this.operator==="interpolate"?ml[this.type.kind.toLowerCase()](b,T,y):this.operator==="interpolate-hcl"?Vc.reverse(Vc.interpolate(Vc.forward(b),Vc.forward(T),y)):Sd.reverse(Sd.interpolate(Sd.forward(b),Sd.forward(T),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let c=0;c<this.labels.length;c++)n.push(this.labels[c],this.outputs[c].serialize());return n}}function Lg(s,e,n,c){const u=c-n,p=s-n;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Ed{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let c=null;const u=n.expectedType;u&&u.kind!=="value"&&(c=u);const p=[];for(const y of e.slice(1)){const b=n.parse(y,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!b)return null;c=c||b.type,p.push(b)}const m=u&&p.some(y=>fd(u,y.type));return new Ed(m?Ti:c,p)}evaluate(e){let n,c=null,u=0;for(const p of this.args){if(u++,c=p.evaluate(e),c&&c instanceof ho&&!c.available&&(n||(n=c),c=null,u===this.args.length))return n;if(c!==null)break}return c}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Id{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const c=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return n.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return n.error("Variable names must contain only alphanumeric characters or '_'.",p);const y=n.parse(e[p+1],p+1);if(!y)return null;c.push([m,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,c);return u?new Id(c,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,c]of this.bindings)e.push(n,c.serialize());return e.push(this.result.serialize()),e}}class zg{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Yt),u=n.parse(e[2],2,gs(n.expectedType||Ti));return c&&u?new zg(u.type.itemType,c,u):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Pn("Array index out of bounds: negative index");if(n>=c.length)throw new Pn("Array index out of bounds: index exceeds array size");if(n!==Math.floor(n))throw new Pn("Array index must be an integer. Use at-interpolated for fractional indices");return c[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Fg{constructor(e,n,c){this.type=e,this.index=n,this.input=c}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Yt),u=n.parse(e[2],2,gs(n.expectedType||Ti));return c&&u?new Fg(u.type.itemType,c,u):null}evaluate(e){const n=this.index.evaluate(e),c=this.input.evaluate(e);if(n<0)throw new Pn(`Array index out of bounds: ${n} < 0.`);if(n>c.length-1)throw new Pn(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n===Math.floor(n))return c[n];const u=Math.floor(n),p=Math.ceil(n),m=c[u],y=c[p];if(typeof m!="number"||typeof y!="number")throw new Pn(`Cannot interpolate between non-number values at index ${n}.`);const b=n-u;return m*(1-b)+y*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Bg{constructor(e,n){this.type=mi,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Ti),u=n.parse(e[2],2,Ti);return c&&u?yg(c.type,[mi,si,Yt,wu,Ti])?new Bg(c,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(c.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(c==null)return!1;if(!pd(n,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${Un(ts(n))} instead.`);if(!pd(c,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${Un(ts(c))} instead.`);return c.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ad{constructor(e,n,c){this.type=Yt,this.needle=e,this.haystack=n,this.fromIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Ti),u=n.parse(e[2],2,Ti);if(!c||!u)return null;if(!yg(c.type,[mi,si,Yt,wu,Ti]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Un(c.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Yt);return p?new Ad(c,u,p):null}return new Ad(c,u)}evaluate(e){const n=this.needle.evaluate(e),c=this.haystack.evaluate(e);if(!pd(n,["boolean","string","number","null"]))throw new Pn(`Expected first argument to be of type boolean, string, number or null, but found ${Un(ts(n))} instead.`);if(!pd(c,["string","array"]))throw new Pn(`Expected second argument to be of type array or string, but found ${Un(ts(c))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return c.indexOf(n,u)}return c.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Kf{constructor(e,n,c,u,p,m){this.inputType=e,this.type=n,this.input=c,this.cases=u,this.outputs=p,this.otherwise=m}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let c,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const p={},m=[];for(let T=2;T<e.length-1;T+=2){let A=e[T];const C=e[T+1];Array.isArray(A)||(A=[A]);const P=n.concat(T);if(A.length===0)return P.error("Expected at least one branch label.");for(const L of A){if(typeof L!="number"&&typeof L!="string")return P.error("Branch labels must be numbers or strings.");if(typeof L=="number"&&Math.abs(L)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof L=="number"&&Math.floor(L)!==L)return P.error("Numeric branch labels must be integer values.");if(c){if(P.checkSubtype(c,ts(L)))return null}else c=ts(L);if(p[String(L)]!==void 0)return P.error("Branch labels must be unique.");p[String(L)]=m.length}const D=n.parse(C,T,u);if(!D)return null;u=u||D.type,m.push(D)}const y=n.parse(e[1],1,Ti);if(!y)return null;const b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(c,y.type)?null:new Kf(c,u,y,p,m,b):null}evaluate(e){const n=this.input.evaluate(e);return(Rf(ts(n),this.inputType)&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),c=[],u={};for(const m of n){const y=u[this.cases[m]];y===void 0?(u[this.cases[m]]=c.length,c.push([this.cases[m],[m]])):c[y][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of c)e.push(y.length===1?p(y[0]):y.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Lu{constructor(e,n,c){this.type=e,this.branches=n,this.otherwise=c}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const y=n.parse(e[m],m,mi);if(!y)return null;const b=n.parse(e[m+1],m+1,c);if(!b)return null;u.push([y,b]),c=c||b.type}const p=n.parse(e[e.length-1],e.length-1,c);return p?new Lu(c,u,p):null}evaluate(e){for(const[n,c]of this.branches)if(n.evaluate(e))return c.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,c]of this.branches)e(n),e(c);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Yf{constructor(e,n,c,u){this.type=e,this.input=n,this.beginIndex=c,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,Ti),u=n.parse(e[2],2,Yt);if(!c||!u)return null;if(!yg(c.type,[gs(Ti),si,Ti]))return n.error(`Expected first argument to be of type array or string, but found ${Un(c.type)} instead`);if(e.length===4){const p=n.parse(e[3],3,Yt);return p?new Yf(c.type,c,u,p):null}return new Yf(c.type,c,u)}evaluate(e){const n=this.input.evaluate(e),c=this.beginIndex.evaluate(e);if(!pd(n,["string","array"]))throw new Pn(`Expected first argument to be of type array or string, but found ${Un(ts(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(c,u)}return n.slice(c)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Jf{constructor(e,n){this.type=gs(si),this.str=e,this.delimiter=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const c=n.parse(e[1],1,si),u=n.parse(e[2],2,si);return c&&u?new Jf(c,u):void 0}evaluate(e){const n=this.str.evaluate(e),c=this.delimiter.evaluate(e);return n.split(c)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Z0(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function X0(s,e,n,c){return c.compare(e,n)===0}function zu(s,e,n){const c=s!=="=="&&s!=="!=";return class Y3{constructor(p,m,y){this.type=mi,this.lhs=p,this.rhs=m,this.collator=y,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const y=p[0];let b=m.parse(p[1],1,Ti);if(!b)return null;if(!Z0(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${Un(b.type)}'.`);let T=m.parse(p[2],2,Ti);if(!T)return null;if(!Z0(y,T.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${Un(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${Un(b.type)}' and '${Un(T.type)}'.`);c&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new qt(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new qt(b.type,[T])));let A=null;if(p.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(p[3],3,hd),!A)return null}return new Y3(b,T,A)}evaluate(p){const m=this.lhs.evaluate(p),y=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const b=ts(m),T=ts(y);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new Pn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const b=ts(m),T=ts(y);if(b.kind!=="string"||T.kind!=="string")return e(p,m,y)}return this.collator?n(p,m,y,this.collator.evaluate(p)):e(p,m,y)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[s];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const K0=zu("==",function(s,e,n){return e===n},X0),Y0=zu("!=",function(s,e,n){return e!==n},function(s,e,n,c){return!X0(0,e,n,c)}),pb=zu("<",function(s,e,n){return e<n},function(s,e,n,c){return c.compare(e,n)<0}),mb=zu(">",function(s,e,n){return e>n},function(s,e,n,c){return c.compare(e,n)>0}),gb=zu("<=",function(s,e,n){return e<=n},function(s,e,n,c){return c.compare(e,n)<=0}),Qf=zu(">=",function(s,e,n){return e>=n},function(s,e,n,c){return c.compare(e,n)>=0});class Ng{constructor(e,n,c,u,p,m){this.type=si,this.number=e,this.locale=n,this.currency=c,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const c=n.parse(e[1],1,Yt);if(!c)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=n.parseObjectValue(u.locale,2,"locale",si),!p))return null;let m=null;if(u.currency&&(m=n.parseObjectValue(u.currency,2,"currency",si),!m))return null;let y=null;if(u.unit&&(y=n.parseObjectValue(u.unit,2,"unit",si),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Yt),!b))return null;let T=null;return u["max-fraction-digits"]&&(T=n.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Yt),!T)?null:new Ng(c,p,m,y,b,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class jg{constructor(e){this.type=Yt,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const c=n.parse(e[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Un(c.type)} instead.`):new jg(c):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Pn(`Expected value to be of type string or array, but found ${Un(ts(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function J0(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Fu={"==":K0,"!=":Y0,">":mb,"<":pb,">=":Qf,"<=":gb,array:qt,at:zg,"at-interpolated":Fg,boolean:qt,case:Lu,coalesce:Ed,collator:Eu,format:zc,image:Tr,in:Bg,"index-of":Ad,interpolate:No,"interpolate-hcl":No,"interpolate-lab":No,length:jg,let:Id,literal:_l,match:Kf,number:qt,"number-format":Ng,object:qt,slice:Yf,step:Td,string:qt,"to-boolean":Qa,"to-color":Qa,"to-number":Qa,"to-string":Qa,var:$f,within:Bc,distance:Nc,config:Ou,split:Jf};function Vg(s,[e,n,c,u]){e=e.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const p=u?u.evaluate(s):1,m=kf(e,n,c,p);if(m)throw new Pn(m);return new yi(e/255,n/255,c/255,p)}function Q0(s,[e,n,c,u]){e=e.evaluate(s),n=n.evaluate(s),c=c.evaluate(s);const p=u?u.evaluate(s):1,m=function(T,A,C,P){return typeof T=="number"&&T>=0&&T<=360?typeof A=="number"&&A>=0&&A<=100&&typeof C=="number"&&C>=0&&C<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[T,A,C,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[T,A,C,P]:[T,A,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[T,A,C,P]:[T,A,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,c,p);if(m)throw new Pn(m);const y=`hsla(${e}, ${n}%, ${c}%, ${p})`,b=yi.parse(y);if(!b)throw new Pn(`Failed to parse HSLA color: ${y}`);return b}function ev(s,e){return s in e}function ep(s,e){const n=e[s];return n===void 0?null:n}function vl(s){return{type:s}}function Cd(s){if(s instanceof Ou)return new Set([s.key]);let e=new Set;return s.eachChild(n=>{e=new Set([...e,...Cd(n)])}),e}function tp(s){if(s instanceof Hs&&s.name==="is-active-floor")return!0;let e=!1;return s.eachChild(n=>{!e&&tp(n)&&(e=!0)}),e}function Uc(s){return{result:"success",value:s}}function tc(s){return{result:"error",value:s}}function Ug(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function rp(s){return s["property-type"]==="data-driven"}function $g(s){return Ug(s.expression,"measure-light")}function Gg(s){return Ug(s.expression,"zoom")}function ip(s){return!!s.expression&&s.expression.interpolated}function np(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Hg(s){return s}function sp(s,e){const n=e.type==="color",c=s.stops&&typeof s.stops[0][0]=="object",u=c||!(c||s.property!==void 0),p=s.type||(ip(e)?"exponential":"interval");if(n&&((s=Object.assign({},s)).stops&&(s.stops=s.stops.map(T=>[T[0],yi.parse(T[1])])),s.default=yi.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!Xf[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let m,y,b;if(p==="exponential")m=tv;else if(p==="interval")m=rc;else if(p==="categorical"){m=_b,y=Object.create(null);for(const T of s.stops)y[T[0]]=T[1];b=typeof s.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=yb}if(c){const T={},A=[];for(let D=0;D<s.stops.length;D++){const L=s.stops[D],N=L[0].zoom;T[N]===void 0&&(T[N]={zoom:N,type:s.type,property:s.property,default:s.default,stops:[]},A.push(N)),T[N].stops.push([L[0].value,L[1]])}const C=[];for(const D of A)C.push([T[D].zoom,sp(T[D],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:No.interpolationFactor.bind(void 0,P),zoomStops:C.map(D=>D[0]),evaluate:({zoom:D},L)=>tv({stops:C,base:s.base},e,D).evaluate(D,L)}}if(u){const T=p==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:No.interpolationFactor.bind(void 0,T),zoomStops:s.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(s,e,A,y,b)}}return{kind:"source",evaluate(T,A){const C=A&&A.properties?A.properties[s.property]:void 0;return C===void 0?Bu(s.default,e.default):m(s,e,C,y,b)}}}function Bu(s,e,n){return s!==void 0?s:e!==void 0?e:n!==void 0?n:void 0}function _b(s,e,n,c,u){return Bu(typeof n===u?c[n]:void 0,s.default,e.default)}function rc(s,e,n){if(!gd(n))return Bu(s.default,e.default);const c=s.stops.length;if(c===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[c-1][0])return s.stops[c-1][1];const u=Hf(s.stops.map(p=>p[0]),n);return s.stops[u][1]}function tv(s,e,n){const c=s.base!==void 0?s.base:1;if(!gd(n))return Bu(s.default,e.default);const u=s.stops.length;if(u===1||n<=s.stops[0][0])return s.stops[0][1];if(n>=s.stops[u-1][0])return s.stops[u-1][1];const p=Hf(s.stops.map(A=>A[0]),n),m=function(A,C,P,D){const L=D-P,N=A-P;return L===0?0:C===1?N/L:(Math.pow(C,N)-1)/(Math.pow(C,L)-1)}(n,c,s.stops[p][0],s.stops[p+1][0]),y=s.stops[p][1],b=s.stops[p+1][1];let T=ml[e.type]||Hg;if(s.colorSpace&&s.colorSpace!=="rgb"){const A=Xf[s.colorSpace];T=(C,P)=>A.reverse(A.interpolate(A.forward(C),A.forward(P),m))}return typeof y.evaluate=="function"?{evaluate(...A){const C=y.evaluate.apply(void 0,A),P=b.evaluate.apply(void 0,A);if(C!==void 0&&P!==void 0)return T(C,P,m)}}:T(y,b,m)}function yb(s,e,n){return e.type==="color"?n=yi.parse(n):e.type==="formatted"?n=as.fromString(n.toString()):e.type==="resolvedImage"?n=ho.build(n.toString()):Su(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Bu(n,s.default,e.default)}Hs.register(Fu,{error:[{kind:"error"},[si],(s,[e])=>{throw new Pn(e.evaluate(s))}],typeof:[si,[Ti],(s,[e])=>Un(ts(e.evaluate(s)))],"to-rgba":[gs(Yt,4),[bo],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[gs(Yt,4),[bo],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[bo,[Yt,Yt,Yt],Vg],rgba:[bo,[Yt,Yt,Yt,Yt],Vg],hsl:[bo,[Yt,Yt,Yt],Q0],hsla:[bo,[Yt,Yt,Yt,Yt],Q0],has:{type:mi,overloads:[[[si],(s,[e])=>ev(e.evaluate(s),s.properties())],[[si,bu],(s,[e,n])=>ev(e.evaluate(s),n.evaluate(s))]]},get:{type:Ti,overloads:[[[si],(s,[e])=>ep(e.evaluate(s),s.properties())],[[si,bu],(s,[e,n])=>ep(e.evaluate(s),n.evaluate(s))]]},"feature-state":[Ti,[si],(s,[e])=>ep(e.evaluate(s),s.featureState||{})],properties:[bu,[],s=>s.properties()],"geometry-type":[si,[],s=>s.geometryType()],worldview:[si,[],s=>s.globals.worldview||""],"is-active-floor":[mi,vl(si),(s,e)=>{if(!(s.globals.activeFloors&&s.globals.activeFloors.size>0))return!1;const n=s.globals.activeFloors;return e.some(c=>{const u=c.evaluate(s);return n.has(u)})}],id:[Ti,[],s=>s.id()],zoom:[Yt,[],s=>s.globals.zoom],pitch:[Yt,[],s=>s.globals.pitch||0],"distance-from-center":[Yt,[],s=>s.distanceFromCenter()],"measure-light":[Yt,[si],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Yt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Yt,[],s=>s.globals.lineProgress||0],"raster-value":[Yt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Yt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Yt,[],s=>s.globals.skyRadialProgress||0],accumulated:[Ti,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Yt,vl(Yt),(s,e)=>{let n=0;for(const c of e)n+=c.evaluate(s);return n}],"*":[Yt,vl(Yt),(s,e)=>{let n=1;for(const c of e)n*=c.evaluate(s);return n}],"-":{type:Yt,overloads:[[[Yt,Yt],(s,[e,n])=>e.evaluate(s)-n.evaluate(s)],[[Yt],(s,[e])=>-e.evaluate(s)]]},"/":[Yt,[Yt,Yt],(s,[e,n])=>e.evaluate(s)/n.evaluate(s)],"%":[Yt,[Yt,Yt],(s,[e,n])=>e.evaluate(s)%n.evaluate(s)],ln2:[Yt,[],()=>Math.LN2],pi:[Yt,[],()=>Math.PI],e:[Yt,[],()=>Math.E],"^":[Yt,[Yt,Yt],(s,[e,n])=>Math.pow(e.evaluate(s),n.evaluate(s))],sqrt:[Yt,[Yt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Yt,[Yt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Yt,[Yt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Yt,[Yt],(s,[e])=>Math.log2(e.evaluate(s))],sin:[Yt,[Yt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Yt,[Yt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Yt,[Yt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Yt,[Yt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Yt,[Yt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Yt,[Yt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Yt,vl(Yt),(s,e)=>Math.min(...e.map(n=>n.evaluate(s)))],max:[Yt,vl(Yt),(s,e)=>Math.max(...e.map(n=>n.evaluate(s)))],abs:[Yt,[Yt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Yt,[Yt],(s,[e])=>{const n=e.evaluate(s);return n<0?-Math.round(-n):Math.round(n)}],floor:[Yt,[Yt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Yt,[Yt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[mi,[si,Ti],(s,[e,n])=>s.properties()[e.value]===n.value],"filter-id-==":[mi,[Ti],(s,[e])=>s.id()===e.value],"filter-type-==":[mi,[si],(s,[e])=>s.geometryType()===e.value],"filter-<":[mi,[si,Ti],(s,[e,n])=>{const c=s.properties()[e.value],u=n.value;return typeof c==typeof u&&c<u}],"filter-id-<":[mi,[Ti],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<c}],"filter->":[mi,[si,Ti],(s,[e,n])=>{const c=s.properties()[e.value],u=n.value;return typeof c==typeof u&&c>u}],"filter-id->":[mi,[Ti],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>c}],"filter-<=":[mi,[si,Ti],(s,[e,n])=>{const c=s.properties()[e.value],u=n.value;return typeof c==typeof u&&c<=u}],"filter-id-<=":[mi,[Ti],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n<=c}],"filter->=":[mi,[si,Ti],(s,[e,n])=>{const c=s.properties()[e.value],u=n.value;return typeof c==typeof u&&c>=u}],"filter-id->=":[mi,[Ti],(s,[e])=>{const n=s.id(),c=e.value;return typeof n==typeof c&&n>=c}],"filter-has":[mi,[Ti],(s,[e])=>e.value in s.properties()],"filter-has-id":[mi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[mi,[gs(si)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[mi,[gs(Ti)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[mi,[si,gs(Ti)],(s,[e,n])=>n.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[mi,[si,gs(Ti)],(s,[e,n])=>function(c,u,p,m){for(;p<=m;){const y=p+m>>1;if(u[y]===c)return!0;u[y]>c?m=y-1:p=y+1}return!1}(s.properties()[e.value],n.value,0,n.value.length-1)],all:{type:mi,overloads:[[[mi,mi],(s,[e,n])=>e.evaluate(s)&&n.evaluate(s)],[vl(mi),(s,e)=>{for(const n of e)if(!n.evaluate(s))return!1;return!0}]]},any:{type:mi,overloads:[[[mi,mi],(s,[e,n])=>e.evaluate(s)||n.evaluate(s)],[vl(mi),(s,e)=>{for(const n of e)if(n.evaluate(s))return!0;return!1}]]},"!":[mi,[mi],(s,[e])=>!e.evaluate(s)],"is-supported-script":[mi,[si],(s,[e])=>{const n=s.globals&&s.globals.isSupportedScript;return!n||n(e.evaluate(s))}],upcase:[si,[si],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[si,[si],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[si,vl(Ti),(s,e)=>e.map(n=>Ja(n.evaluate(s))).join("")],"resolved-locale":[si,[hd],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Yt,[Yt,Yt,Ti],(s,e)=>{const[n,c,u]=e.map(m=>m.evaluate(s));if(n>c||n===c)return n;let p;if(typeof u=="string")p=function(m){let y=0;if(m.length===0)return y;for(let b=0;b<m.length;b++)y=(y<<5)-y+m.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new Pn(`Invalid seed input: ${u}`);p=u}return n+J0(p)()*(c-n)}]});class op{constructor(e,n,c,u,p){this.expression=e,this._warningHistory={},this._scope=c,this._options=u,this._iconImageUseTheme=p,this._evaluator=new _s(c,u,p),this._defaultValue=n?function(m){return m.type==="color"&&(np(m.default)||Array.isArray(m.default))?new yi(0,0,0,0):m.type==="color"?yi.parse(m.default)||null:m.default===void 0?null:m.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=Cd(e),this.isIndoorDependent=tp(e)}evaluateWithoutErrorHandling(e,n,c,u,p,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,c,u,p,m,y,b,T){this._evaluator||(this._evaluator=new _s(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Pn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function ap(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Fu}function tl(s,e,n,c,u){const p=new Gf(Fu,[],e?function(y){const b={color:bo,string:si,number:Yt,enum:si,boolean:mi,formatted:Lc,resolvedImage:dd};return y.type==="array"?gs(b[y.value]||Ti,y.length):b[y.type]}(e):void 0,void 0,void 0,n,c,u),m=p.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Uc(new op(m,e,n,c,u)):tc(p.errors)}class Pd{constructor(e,n,c,u){this.kind=e,this._styleExpression=n,this.isLightConstant=c,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!bd(n.expression),this.configDependencies=Cd(n.expression),this.isIndoorDependent=tp(n.expression)}evaluateWithoutErrorHandling(e,n,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,u,p,m)}evaluate(e,n,c,u,p,m,y){return this._styleExpression.evaluate(e,n,c,u,p,m,void 0,void 0,y)}}class ic{constructor(e,n,c,u,p,m){this.kind=e,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!bd(n.expression),this.isIndoorDependent=tp(n.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=Cd(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,c,u,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,n,c,u,p,m)}evaluate(e,n,c,u,p,m){return this._styleExpression.evaluate(e,n,c,u,p,m)}interpolationFactor(e,n,c){return this.interpolationType?No.interpolationFactor(this.interpolationType,e,n,c):0}}function qg(s,e,n,c,u){if((s=tl(s,e,n,c,u)).result==="error")return s;const p=s.value.expression,m=ku(p);if(!m&&!rp(e))return tc([new ha("","data expressions not supported")]);const y=Mu(p,["zoom","pitch","distance-from-center"]);if(!y&&!Gg(e))return tc([new ha("","zoom expressions not supported")]);const b=Mu(p,["measure-light"]);if(!b&&!$g(e))return tc([new ha("","measure-light expression not supported")]);const T=Mu(p,["line-progress"]);if(!T&&!function(P){return Ug(P.expression,"line-progress")}(e))return tc([new ha("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,C=cp(p);return C||y||A?C instanceof ha?tc([C]):C instanceof No&&!ip(e)?tc([new ha("",'"interpolate" expressions cannot be used with this property')]):Uc(C?new ic(m&&T?"camera":"composite",s.value,C.labels,C instanceof No?C.interpolation:void 0,b,T):new Pd(m&&T?"constant":"source",s.value,b,T)):tc([new ha("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class lp{constructor(e,n){this._parameters=e,this._specification=n,Object.assign(this,sp(this._parameters,this._specification))}static deserialize(e){return new lp(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function cp(s){let e=null;if(s instanceof Id)e=cp(s.result);else if(s instanceof Ed){for(const n of s.args)if(e=cp(n),e)break}else(s instanceof Td||s instanceof No)&&s.input instanceof Hs&&s.input.name==="zoom"&&(e=s);return e instanceof ha||s.eachChild(n=>{const c=cp(n);c instanceof ha?e=c:e&&c&&e!==c&&(e=new ha("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Rd,up,rv=function(){if(up)return Rd;up=1,Rd=e;var s=3;function e(n,c,u){var p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var m=new Int32Array(this.arrayBuffer);n=m[0],this.d=(c=m[1])+2*(u=m[2]);for(var y=0;y<this.d*this.d;y++){var b=m[s+y],T=m[s+y+1];p.push(b===T?null:m.subarray(b,T))}var A=m[s+p.length+1];this.keys=m.subarray(m[s+p.length],A),this.bboxes=m.subarray(A),this.insert=this._insertReadonly}else{this.d=c+2*u;for(var C=0;C<this.d*this.d;C++)p.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=u,this.scale=c/n,this.uid=0;var P=u/c*n;this.min=-P,this.max=n+P}return e.prototype.insert=function(n,c,u,p,m){this._forEachCell(c,u,p,m,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,c,u,p,m,y){this.cells[m].push(y)},e.prototype.query=function(n,c,u,p,m){var y=this.min,b=this.max;if(n<=y&&c<=y&&b<=u&&b<=p&&!m)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(n,c,u,p,this._queryCell,T,{},m),T},e.prototype._queryCell=function(n,c,u,p,m,y,b,T){var A=this.cells[m];if(A!==null)for(var C=this.keys,P=this.bboxes,D=0;D<A.length;D++){var L=A[D];if(b[L]===void 0){var N=4*L;(T?T(P[N+0],P[N+1],P[N+2],P[N+3]):n<=P[N+2]&&c<=P[N+3]&&u>=P[N+0]&&p>=P[N+1])?(b[L]=!0,y.push(C[L])):b[L]=!1}}},e.prototype._forEachCell=function(n,c,u,p,m,y,b,T){for(var A=this._convertToCellCoord(n),C=this._convertToCellCoord(c),P=this._convertToCellCoord(u),D=this._convertToCellCoord(p),L=A;L<=P;L++)for(var N=C;N<=D;N++){var V=this.d*N+L;if((!T||T(this._convertFromCellCoord(L),this._convertFromCellCoord(N),this._convertFromCellCoord(L+1),this._convertFromCellCoord(N+1)))&&m.call(this,n,c,u,p,V,y,b,T))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,c=s+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var m=new Int32Array(c+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var y=c,b=0;b<n.length;b++){var T=n[b];m[s+b]=y,m.set(T,y),y+=T.length}return m[s+n.length]=y,m.set(this.keys,y),m[s+n.length+1]=y+=this.keys.length,m.set(this.bboxes,y),y+=this.bboxes.length,m.buffer},Rd}(),$c=sn(rv);const Nu={};function zt(s,e,n={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),Nu[e]={klass:s,omit:n.omit||[]}}zt(Object,"Object"),$c.serialize=function(s,e){const n=s.toArrayBuffer();return e&&e.add(n),{buffer:n}},$c.deserialize=function(s){return new $c(s.buffer)},Object.defineProperty($c,"name",{value:"Grid"}),zt($c,"Grid"),delete nt.prototype.constructor,typeof DOMMatrix<"u"&&zt(DOMMatrix,"DOMMatrix"),zt(yi,"Color"),zt(Error,"Error"),zt(as,"Formatted"),zt(md,"FormattedSection"),zt(Oc,"AJAXError"),zt(ho,"ResolvedImage"),zt(lp,"StylePropertyFunction"),zt(op,"StyleExpression",{omit:["_evaluator"]}),zt(Wn,"ImageId"),zt(gl,"ImageVariant"),zt(ic,"ZoomDependentExpression"),zt(Pd,"ZoomConstantExpression"),zt(Hs,"CompoundExpression",{omit:["_evaluate"]});for(const s in Fu)Nu[Fu[s]._classRegistryKey]||zt(Fu[s],`Expression${s}`);function Wg(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function xl(s){return self.ImageBitmap&&s instanceof ImageBitmap}function nc(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Wg(s)||xl(s))return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const n=[];for(const c of s)n.push(nc(c,e));return n}if(s instanceof Map){const n={$name:"Map",entries:[]};for(const[c,u]of s.entries())n.entries.push(nc(c),nc(u,e));return n}if(s instanceof Set){const n={$name:"Set"};let c=0;for(const u of s.values())n[++c]=nc(u);return n}if(s instanceof DOMMatrix){const n={$name:"DOMMatrix"},c=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of c)n[u]=s[u];return n}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const n=s.constructor,c=n._classRegistryKey;if(!c)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const u=n.serialize?n.serialize(s,e):{};if(!n.serialize){for(const p in s)s.hasOwnProperty(p)&&(Nu[c].omit.indexOf(p)>=0||(u[p]=nc(s[p],e)));s instanceof Error&&(u.message=s.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(u.$name=c),u}throw new Error("can't serialize object of type "+typeof s)}function sc(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Wg(s)||xl(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(sc);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const u=s.entries||[],p=new Map;for(let m=0;m<u.length;m+=2)p.set(sc(u[m]),sc(u[m+1]));return p}if(e==="Set"){const u=new Set;for(const p of Object.keys(s))p!=="$name"&&u.add(sc(s[p]));return u}if(e==="DOMMatrix"){let u;return u=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(s.value);const{klass:n}=Nu[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(s);const c=Object.create(n.prototype);for(const u of Object.keys(s))u!=="$name"&&(c[u]=sc(s[u]));return c}throw new Error("can't deserialize object of type "+typeof s)}const ar={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function Zg(s){for(const e of s)if(dp(e.charCodeAt(0)))return!0;return!1}function iv(s){for(const e of s)if(!hp(e.charCodeAt(0)))return!1;return!0}function hp(s){return!(ar.Arabic(s)||ar["Arabic Supplement"](s)||ar["Arabic Extended-A"](s)||ar["Arabic Presentation Forms-A"](s)||ar["Arabic Presentation Forms-B"](s))}function dp(s){return!(s!==746&&s!==747&&(s<4352||!(ar["Bopomofo Extended"](s)||ar.Bopomofo(s)||ar["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ar["CJK Compatibility Ideographs"](s)||ar["CJK Compatibility"](s)||ar["CJK Radicals Supplement"](s)||ar["CJK Strokes"](s)||!(!ar["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ar["CJK Unified Ideographs Extension A"](s)||ar["CJK Unified Ideographs"](s)||ar["Enclosed CJK Letters and Months"](s)||ar["Hangul Compatibility Jamo"](s)||ar["Hangul Jamo Extended-A"](s)||ar["Hangul Jamo Extended-B"](s)||ar["Hangul Jamo"](s)||ar["Hangul Syllables"](s)||ar.Hiragana(s)||ar["Ideographic Description Characters"](s)||ar.Kanbun(s)||ar["Kangxi Radicals"](s)||ar["Katakana Phonetic Extensions"](s)||ar.Katakana(s)&&s!==12540||!(!ar["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ar["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ar["Unified Canadian Aboriginal Syllabics"](s)||ar["Unified Canadian Aboriginal Syllabics Extended"](s)||ar["Vertical Forms"](s)||ar["Yijing Hexagram Symbols"](s)||ar["Yi Syllables"](s)||ar["Yi Radicals"](s))))}function Xg(s){return!(dp(s)||function(e){return!!(ar["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ar["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ar["Letterlike Symbols"](e)||ar["Number Forms"](e)||ar["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ar["Control Pictures"](e)&&e!==9251||ar["Optical Character Recognition"](e)||ar["Enclosed Alphanumerics"](e)||ar["Geometric Shapes"](e)||ar["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ar["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ar["CJK Symbols and Punctuation"](e)||ar.Katakana(e)||ar["Private Use Area"](e)||ar["CJK Compatibility Forms"](e)||ar["Small Form Variants"](e)||ar["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Kg(s){return ar.Arabic(s)||ar["Arabic Supplement"](s)||ar["Arabic Extended-A"](s)||ar["Arabic Presentation Forms-A"](s)||ar["Arabic Presentation Forms-B"](s)}function nv(s){return s>=1424&&s<=2303||ar["Arabic Presentation Forms-A"](s)||ar["Arabic Presentation Forms-B"](s)}function vb(s,e){return!(!e&&nv(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ar.Khmer(s))}function xb(s){for(const e of s)if(nv(e.charCodeAt(0)))return!0;return!1}const To={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Yg=null,io=To.unavailable,oc=null;const sv=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(io=To.error),Yg&&Yg(s)};function Jg(){Qg.fire(new Fo("pluginStateChange",{pluginStatus:io,pluginURL:oc}))}const Qg=new pl,e_=function(){return io},t_=function(){if(io!==To.deferred||!oc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");io=To.loading,Jg(),oc&&vu({url:oc},s=>{s?sv(s):(io=To.loaded,Jg())})},So={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>io===To.loaded||So.applyArabicShaping!=null,isLoading:()=>io===To.loading,setState(s){io=s.pluginStatus,oc=s.pluginURL},isParsing:()=>io===To.parsing,isParsed:()=>io===To.parsed,getPluginURL:()=>oc};class Ui{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness,this.worldview=n.worldview,this.activeFloors=n.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,c){for(const u of n)if(!vb(u.charCodeAt(0),c))return!1;return!0}(e,So.isLoaded())}}class kd{constructor(e,n,c,u,p){this.property=e,this.value=n,this.expression=function(m,y,b,T,A){if(np(m))return new lp(m,y);if(ap(m)||Array.isArray(m)&&m.length>0){const C=qg(m,y,b,T,A);if(C.result==="error")throw new Error(C.value.map(P=>`${P.key}: ${P.message}`).join(", "));return C.value}{let C=m;return typeof m=="string"&&y.type==="color"&&(C=yi.parse(m)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>C}}}(n===void 0?e.specification.default:n,e.specification,c,u,p)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,c,u){return this.property.possiblyEvaluate(this,e,n,c,u)}}class ju{constructor(e,n,c,u){this.property=e,this.value=new kd(e,void 0,n,c,u)}transitioned(e,n){return new av(this.property,this.value,n,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new av(this.property,this.value,null,{},0)}}class ov{constructor(e,n,c,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Xt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ju(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new kd(this._values[e].property,n===null?void 0:Xt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,n){n&&(this._options=n);const c=this._properties.properties;if(e)for(const u in e){const p=e[u];if(u.endsWith("-transition")){const m=u.slice(0,-11);c[m]&&this.setTransition(m,p)}else c.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(e){return Xt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ju(this._values[e].property)),this._values[e].transition=Xt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const c=new wl(this._properties);for(const u of Object.keys(this._values))c._values[u]=this._values[u].transitioned(e,n._values[u]);return c}untransitioned(){const e=new wl(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class av{constructor(e,n,c,u,p){const m=u.delay||0,y=u.duration||0;p=p||0,this.property=e,this.value=n,this.begin=p+m,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=c)}possiblyEvaluate(e,n,c){const u=e.now||0,p=this.value.possiblyEvaluate(e,n,c),m=this.prior;if(m){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return m.possiblyEvaluate(e,n,c);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,n,c),p,Yh(y))}}return p}}class wl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,c){const u=new Gc(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,n,c);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class r_{constructor(e,n,c,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=c,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Xt(this._values[e].value)}setValue(e,n){this._values[e]=new kd(this._values[e].property,n===null?void 0:Xt(n),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(e[n]=c)}return e}possiblyEvaluate(e,n,c,u){const p=new Gc(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(e,n,c,u);return p}isIndoorDependent(){return this._isIndoorDependent}}class ga{constructor(e,n,c,u){this.property=e,this.value=n,this.parameters=c,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,c,u){return this.property.evaluate(this.value,this.parameters,e,n,c,u,this.iconImageUseTheme)}}class Gc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ft{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,c){const u=ml[this.specification.type];return u?u(e,n,c):e}}class Pt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,c,u,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new ga(this,{kind:"constant",value:e.expression.evaluate(n,null,{},c,u,void 0,p)},n):new ga(this,e.expression,n,p)}interpolate(e,n,c){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ga(this,{kind:"constant",value:void 0},e.parameters);const u=ml[this.specification.type];return u?new ga(this,{kind:"constant",value:u(e.value.value,n.value.value,c)},e.parameters):e}evaluate(e,n,c,u,p,m,y){return e.kind==="constant"?e.value:e.evaluate(n,c,u,p,m,void 0,y)}}class Vu{constructor(e){this.specification=e}possiblyEvaluate(e,n,c,u){return!!e.expression.evaluate(n,null,{},c,u)}interpolate(){return!1}}class gn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Ui(0,{});for(const c in e){const u=e[c];u.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new kd(u,void 0),m=this.defaultTransitionablePropertyValues[c]=new ju(u);this.defaultTransitioningPropertyValues[c]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(n)}}}zt(Pt,"DataDrivenProperty"),zt(ft,"DataConstantProperty"),zt(Vu,"ColorRampProperty");var Le=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function i_(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Uu(s){if(Array.isArray(s))return s.map(Uu);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const n in s)e[n]=Uu(s[n]);return e}return i_(s)}function $u(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!$u(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function fp(s,e="",n=null,c="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$u(s)||(s=jo(s));const u=s;let p=!0;try{p=function(A){if(!Hu(A))return A;let C=Uu(A);return Gu(C),C=pp(C),C}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let m=null,y=null;if(c!=="background"&&c!=="sky"&&c!=="slot"){y=Le[`filter_${c}`];const A=tl(p,y,e,n);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,P,D)=>A.value.evaluate(C,P,{},D)}let b=null,T=null;if(p!==u){const A=tl(u,y,e,n);if(A.result==="error")throw new Error(A.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,P,D,L,N)=>A.value.evaluate(C,P,{},D,void 0,void 0,L,N),T=!ku(A.value.expression)}return{filter:m,dynamicFilter:b||void 0,needGeometry:cv(p),needFeature:!!T}}function pp(s){if(!Array.isArray(s))return s;const e=function(n){if(wb.has(n[0])){for(let c=1;c<n.length;c++)if(Hu(n[c]))return!0}return n}(s);return e===!0?e:e.map(n=>pp(n))}function Gu(s){let e=!1;const n=[];if(s[0]==="case"){for(let c=1;c<s.length-1;c+=2)e=e||Hu(s[c]),n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="match"){e=e||Hu(s[1]);for(let c=2;c<s.length-1;c+=2)n.push(s[c+1]);n.push(s[s.length-1])}else if(s[0]==="step"){e=e||Hu(s[1]);for(let c=1;c<s.length-1;c+=2)n.push(s[c+1])}e&&(s.length=0,s.push("any",...n));for(let c=1;c<s.length;c++)Gu(s[c])}function Hu(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<s.length;n++)if(Hu(s[n]))return!0;return!1}const wb=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function lv(s,e){return s<e?-1:s>e?1:0}function cv(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(cv(s[e]))return!0;return!1}function jo(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?n_(s[1],s[2],"=="):e==="!="?mp(n_(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?n_(s[1],s[2],e):e==="any"?(n=s.slice(1),["any"].concat(n.map(jo))):e==="all"?["all"].concat(s.slice(1).map(jo)):e==="none"?["all"].concat(s.slice(1).map(jo).map(mp)):e==="in"?s_(s[1],s.slice(2)):e==="!in"?mp(s_(s[1],s.slice(2))):e==="has"?uv(s[1]):e!=="!has"||mp(uv(s[1]));var n}function n_(s,e,n){switch(s){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,s,e]}}function s_(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",s,["literal",e.sort(lv)]]:["filter-in-small",s,["literal",e]]}}function uv(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function mp(s){return["!",s]}const Md="";function Hc(s,e){return e?`${s}${Md}${e}`:s}let hv;const dv=()=>hv||(hv=new gn({"icon-size":new Pt(Le.layout_symbol["icon-size"]),"icon-image":new Pt(Le.layout_symbol["icon-image"]),"icon-rotate":new Pt(Le.layout_symbol["icon-rotate"]),"icon-offset":new Pt(Le.layout_symbol["icon-offset"])}));class bb{constructor(e,n,c,u,p,m){this.cachedIconPrimary=null;const y=tl(e,Le.appearance.condition);if(y.result==="success"&&(this.condition=y.value),this.name=n,c){this.properties=new Gc(dv()),this.unevaluatedLayout=new r_(dv(),u,p,m);for(const b in c)this.unevaluatedLayout.setValue(b,c[b])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,n,c){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,n,c))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const fv="-transition",Tb=new Set(["fill","line","background","hillshade","raster"]);class qs extends pl{constructor(e,n,c,u,p,m){if(super(),this.id=e.id,this.fqid=Hc(this.id,c),this.type=e.type,this.scope=c,this.lut=u,this.options=p,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const y=tl(this.filter,Le[`filter_${e.type}`]);y.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...y.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||y.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),n.layout&&(this._unevaluatedLayout=new r_(n.layout,this.scope,p,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),n.paint){this._transitionablePaint=new ov(n.paint,this.scope,p);for(const y in e.paint)this.setPaintProperty(y,e.paint[y]);for(const y in e.layout)this.setLayoutProperty(y,e.layout[y]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Gc(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Tb.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const c=this._unevaluatedLayout;c._properties.properties[e]&&(c.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(n=>{this.appearances.push(new bb(n.condition,n.name,n.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(fv)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,n){const c=this._transitionablePaint,u=c._properties.properties;if(e.endsWith(fv)){const C=e.slice(0,-11);return u[C]&&c.setTransition(C,n||void 0),!1}if(!u[e])return!1;const p=c._values[e],m=p.value.isDataDriven(),y=p.value;c.setValue(e,n),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...c.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||c.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const b=c._values[e].value,T=b.isDataDriven(),A=e.endsWith("pattern")||e==="line-dasharray";return T||m||A||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,c){return null}_handleOverridablePaintPropertyUpdate(e,n,c){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(n=>n.serialize())),lt(e,(n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ga&&rp(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}for(const e of this.appearances)if(!bd(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=fp(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,n,c){return{}}queryRadius(e){}queryIntersectsFeature(e,n,c,u,p,m,y,b,T){}}const Sb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Od{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zi{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&n.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Vr(s,e=1){let n=0,c=0;return{members:s.map(u=>{const p=Sb[u.type].BYTES_PER_ELEMENT,m=n=o_(n,Math.max(e,p)),y=u.components||1;return c=Math.max(c,p),n+=p*y,{name:u.name,type:u.type,components:y,offset:m}}),size:o_(n,Math.max(c,e)),alignment:e}}function o_(s,e){return Math.ceil(s/e)*e}class fo extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=c,e}}fo.prototype.bytesPerElement=4,zt(fo,"StructArrayLayout2i4");class qc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,c)}emplace(e,n,c,u){const p=3*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.int16[p+2]=u,e}}qc.prototype.bytesPerElement=6,zt(qc,"StructArrayLayout3i6");class qu extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,u)}emplace(e,n,c,u,p){const m=4*e;return this.int16[m+0]=n,this.int16[m+1]=c,this.int16[m+2]=u,this.int16[m+3]=p,e}}qu.prototype.bytesPerElement=8,zt(qu,"StructArrayLayout4i8");class bl extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}bl.prototype.bytesPerElement=4,zt(bl,"StructArrayLayout1f4");class a_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,c)}emplace(e,n,c,u){const p=4*e,m=2*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.float32[m+1]=u,e}}a_.prototype.bytesPerElement=8,zt(a_,"StructArrayLayout2i1f8");class l_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,c)}emplace(e,n,c,u){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=c,this.int16[p+2]=u,e}}l_.prototype.bytesPerElement=8,zt(l_,"StructArrayLayout3i8");class gp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,c,u,p)}emplace(e,n,c,u,p,m){const y=5*e;return this.int16[y+0]=n,this.int16[y+1]=c,this.int16[y+2]=u,this.int16[y+3]=p,this.int16[y+4]=m,e}}gp.prototype.bytesPerElement=10,zt(gp,"StructArrayLayout5i10");class _p extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,u,p,m,y)}emplace(e,n,c,u,p,m,y,b){const T=6*e,A=12*e,C=3*e;return this.int16[T+0]=n,this.int16[T+1]=c,this.uint8[A+4]=u,this.uint8[A+5]=p,this.uint8[A+6]=m,this.uint8[A+7]=y,this.float32[C+2]=b,e}}_p.prototype.bytesPerElement=12,zt(_p,"StructArrayLayout2i4ub1f12");class Vo extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,c)}emplace(e,n,c,u){const p=3*e;return this.float32[p+0]=n,this.float32[p+1]=c,this.float32[p+2]=u,e}}Vo.prototype.bytesPerElement=12,zt(Vo,"StructArrayLayout3f12");class ac extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,c,u,p)}emplace(e,n,c,u,p,m){const y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=c,this.uint16[y+2]=u,this.uint16[y+3]=p,this.float32[b+2]=m,e}}ac.prototype.bytesPerElement=12,zt(ac,"StructArrayLayout4ui1f12");class Wc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,u)}emplace(e,n,c,u,p){const m=4*e;return this.uint16[m+0]=n,this.uint16[m+1]=c,this.uint16[m+2]=u,this.uint16[m+3]=p,e}}Wc.prototype.bytesPerElement=8,zt(Wc,"StructArrayLayout4ui8");class yp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,c,u,p,m)}emplace(e,n,c,u,p,m,y){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=c,this.int16[b+2]=u,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=y,e}}yp.prototype.bytesPerElement=12,zt(yp,"StructArrayLayout6i12");class vp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,c,u,p,m,y,b,T,A,C,P)}emplace(e,n,c,u,p,m,y,b,T,A,C,P,D){const L=12*e;return this.int16[L+0]=n,this.int16[L+1]=c,this.int16[L+2]=u,this.int16[L+3]=p,this.uint16[L+4]=m,this.uint16[L+5]=y,this.uint16[L+6]=b,this.uint16[L+7]=T,this.int16[L+8]=A,this.int16[L+9]=C,this.int16[L+10]=P,this.int16[L+11]=D,e}}vp.prototype.bytesPerElement=24,zt(vp,"StructArrayLayout4i4ui4i24");class Wu extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,c,u,p,m)}emplace(e,n,c,u,p,m,y){const b=10*e,T=5*e;return this.int16[b+0]=n,this.int16[b+1]=c,this.int16[b+2]=u,this.float32[T+2]=p,this.float32[T+3]=m,this.float32[T+4]=y,e}}Wu.prototype.bytesPerElement=20,zt(Wu,"StructArrayLayout3i3f20");class lc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,u)}emplace(e,n,c,u,p){const m=4*e;return this.float32[m+0]=n,this.float32[m+1]=c,this.float32[m+2]=u,this.float32[m+3]=p,e}}lc.prototype.bytesPerElement=16,zt(lc,"StructArrayLayout4f16");class c_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}c_.prototype.bytesPerElement=4,zt(c_,"StructArrayLayout1ul4");class _a extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=c,e}}_a.prototype.bytesPerElement=4,zt(_a,"StructArrayLayout2ui4");class u_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C,P,D){const L=this.length;return this.resize(L+1),this.emplace(L,e,n,c,u,p,m,y,b,T,A,C,P,D)}emplace(e,n,c,u,p,m,y,b,T,A,C,P,D,L){const N=20*e,V=10*e;return this.int16[N+0]=n,this.int16[N+1]=c,this.int16[N+2]=u,this.int16[N+3]=p,this.int16[N+4]=m,this.float32[V+3]=y,this.float32[V+4]=b,this.float32[V+5]=T,this.float32[V+6]=A,this.int16[N+14]=C,this.uint32[V+8]=P,this.uint16[N+18]=D,this.uint16[N+19]=L,e}}u_.prototype.bytesPerElement=40,zt(u_,"StructArrayLayout5i4f1i1ul2ui40");class xp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,u,p,m,y)}emplace(e,n,c,u,p,m,y,b){const T=8*e;return this.int16[T+0]=n,this.int16[T+1]=c,this.int16[T+2]=u,this.int16[T+4]=p,this.int16[T+5]=m,this.int16[T+6]=y,this.int16[T+7]=b,e}}xp.prototype.bytesPerElement=16,zt(xp,"StructArrayLayout3i2i2i16");class Zu extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,c,u,p)}emplace(e,n,c,u,p,m){const y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=c,this.float32[y+2]=u,this.int16[b+6]=p,this.int16[b+7]=m,e}}Zu.prototype.bytesPerElement=16,zt(Zu,"StructArrayLayout2f1f2i16");class Xu extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,c,u,p,m)}emplace(e,n,c,u,p,m,y){const b=20*e,T=5*e;return this.uint8[b+0]=n,this.uint8[b+1]=c,this.float32[T+1]=u,this.float32[T+2]=p,this.float32[T+3]=m,this.float32[T+4]=y,e}}Xu.prototype.bytesPerElement=20,zt(Xu,"StructArrayLayout2ub4f20");class rn extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,c)}emplace(e,n,c,u){const p=3*e;return this.uint16[p+0]=n,this.uint16[p+1]=c,this.uint16[p+2]=u,e}}rn.prototype.bytesPerElement=6,zt(rn,"StructArrayLayout3ui6");class Ku extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e)}emplace(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e,ue){const be=30*e,Ee=15*e,Ae=60*e;return this.int16[be+0]=n,this.int16[be+1]=c,this.int16[be+2]=u,this.float32[Ee+2]=p,this.float32[Ee+3]=m,this.uint16[be+8]=y,this.uint16[be+9]=b,this.uint32[Ee+5]=T,this.uint32[Ee+6]=A,this.uint32[Ee+7]=C,this.uint16[be+16]=P,this.uint16[be+17]=D,this.uint16[be+18]=L,this.float32[Ee+10]=N,this.float32[Ee+11]=V,this.uint8[Ae+48]=G,this.uint8[Ae+49]=X,this.uint8[Ae+50]=Y,this.uint32[Ee+13]=ie,this.int16[be+28]=_e,this.uint8[Ae+58]=ue,e}}Ku.prototype.bytesPerElement=60,zt(Ku,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class h_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e,ue,be,Ee,Ae,Ze,ze,Ke,tt,st,yt,ht,rt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e,ue,be,Ee,Ae,Ze,ze,Ke,tt,st,yt,ht,rt)}emplace(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e,ue,be,Ee,Ae,Ze,ze,Ke,tt,st,yt,ht,rt,ut){const He=20*e,$e=40*e,at=80*e;return this.float32[He+0]=n,this.float32[He+1]=c,this.int16[$e+4]=u,this.int16[$e+5]=p,this.int16[$e+6]=m,this.int16[$e+7]=y,this.int16[$e+8]=b,this.int16[$e+9]=T,this.int16[$e+10]=A,this.int16[$e+11]=C,this.int16[$e+12]=P,this.uint16[$e+13]=D,this.uint16[$e+14]=L,this.uint16[$e+15]=N,this.uint16[$e+16]=V,this.uint16[$e+17]=G,this.uint16[$e+18]=X,this.uint16[$e+19]=Y,this.uint16[$e+20]=ie,this.uint16[$e+21]=_e,this.uint16[$e+22]=ue,this.uint16[$e+23]=be,this.uint16[$e+24]=Ee,this.uint16[$e+25]=Ae,this.uint16[$e+26]=Ze,this.uint16[$e+27]=ze,this.uint32[He+14]=Ke,this.float32[He+15]=tt,this.float32[He+16]=st,this.float32[He+17]=yt,this.float32[He+18]=ht,this.uint8[at+76]=rt,this.uint16[$e+39]=ut,e}}h_.prototype.bytesPerElement=80,zt(h_,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class d_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,c,u,p,m)}emplace(e,n,c,u,p,m,y){const b=6*e;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=u,this.float32[b+3]=p,this.float32[b+4]=m,this.float32[b+5]=y,e}}d_.prototype.bytesPerElement=24,zt(d_,"StructArrayLayout6f24");class Zc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,c,u,p)}emplace(e,n,c,u,p,m){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=c,this.float32[y+2]=u,this.float32[y+3]=p,this.float32[y+4]=m,e}}Zc.prototype.bytesPerElement=20,zt(Zc,"StructArrayLayout5f20");class f_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,u,p,m,y)}emplace(e,n,c,u,p,m,y,b){const T=7*e;return this.float32[T+0]=n,this.float32[T+1]=c,this.float32[T+2]=u,this.float32[T+3]=p,this.float32[T+4]=m,this.float32[T+5]=y,this.float32[T+6]=b,e}}f_.prototype.bytesPerElement=28,zt(f_,"StructArrayLayout7f28");class Dd extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C){const P=this.length;return this.resize(P+1),this.emplace(P,e,n,c,u,p,m,y,b,T,A,C)}emplace(e,n,c,u,p,m,y,b,T,A,C,P){const D=11*e;return this.float32[D+0]=n,this.float32[D+1]=c,this.float32[D+2]=u,this.float32[D+3]=p,this.float32[D+4]=m,this.float32[D+5]=y,this.float32[D+6]=b,this.float32[D+7]=T,this.float32[D+8]=A,this.float32[D+9]=C,this.float32[D+10]=P,e}}Dd.prototype.bytesPerElement=44,zt(Dd,"StructArrayLayout11f44");class p_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T){const A=this.length;return this.resize(A+1),this.emplace(A,e,n,c,u,p,m,y,b,T)}emplace(e,n,c,u,p,m,y,b,T,A){const C=9*e;return this.float32[C+0]=n,this.float32[C+1]=c,this.float32[C+2]=u,this.float32[C+3]=p,this.float32[C+4]=m,this.float32[C+5]=y,this.float32[C+6]=b,this.float32[C+7]=T,this.float32[C+8]=A,e}}p_.prototype.bytesPerElement=36,zt(p_,"StructArrayLayout9f36");class cc extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const c=this.length;return this.resize(c+1),this.emplace(c,e,n)}emplace(e,n,c){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=c,e}}cc.prototype.bytesPerElement=8,zt(cc,"StructArrayLayout2f8");class m_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,c,u)}emplace(e,n,c,u,p){const m=6*e;return this.uint32[3*e+0]=n,this.uint16[m+2]=c,this.uint16[m+3]=u,this.uint16[m+4]=p,e}}m_.prototype.bytesPerElement=12,zt(m_,"StructArrayLayout1ul3ui12");class wp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}wp.prototype.bytesPerElement=2,zt(wp,"StructArrayLayout1ui2");class bp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V)}emplace(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G){const X=16*e;return this.float32[X+0]=n,this.float32[X+1]=c,this.float32[X+2]=u,this.float32[X+3]=p,this.float32[X+4]=m,this.float32[X+5]=y,this.float32[X+6]=b,this.float32[X+7]=T,this.float32[X+8]=A,this.float32[X+9]=C,this.float32[X+10]=P,this.float32[X+11]=D,this.float32[X+12]=L,this.float32[X+13]=N,this.float32[X+14]=V,this.float32[X+15]=G,e}}bp.prototype.bytesPerElement=64,zt(bp,"StructArrayLayout16f64");class Yu extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,c,u,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,c,u,p,m,y)}emplace(e,n,c,u,p,m,y,b){const T=10*e,A=5*e;return this.uint16[T+0]=n,this.uint16[T+1]=c,this.uint16[T+2]=u,this.uint16[T+3]=p,this.float32[A+2]=m,this.float32[A+3]=y,this.float32[A+4]=b,e}}Yu.prototype.bytesPerElement=20,zt(Yu,"StructArrayLayout4ui3f20");class g_ extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}g_.prototype.bytesPerElement=2,zt(g_,"StructArrayLayout1i2");class Tp extends Zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Tp.prototype.bytesPerElement=1,zt(Tp,"StructArrayLayout1ub1");class __ extends Od{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}__.prototype.size=40;class pv extends u_{get(e){return new __(this,e)}}zt(pv,"CollisionBoxArray");class Sp extends Od{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Sp.prototype.size=60;class Ld extends Ku{get(e){return new Sp(this,e)}}zt(Ld,"PlacedSymbolArray");class y_ extends Od{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}y_.prototype.size=80;class mv extends h_{get(e){return new y_(this,e)}}zt(mv,"SymbolInstanceArray");class v_ extends bl{getoffsetX(e){return this.float32[1*e+0]}}zt(v_,"GlyphOffsetArray");class gv extends fo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}zt(gv,"SymbolLineVertexArray");class Ep extends Od{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ep.prototype.size=12;class _v extends m_{get(e){return new Ep(this,e)}}zt(_v,"FeatureIndexArray");class yv extends _a{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}zt(yv,"FillExtrusionCentroidArray");class vv extends Od{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}vv.prototype.size=6;class xv extends qc{get(e){return new vv(this,e)}}zt(xv,"FillExtrusionWallArray");const wv=Vr([{name:"a_pos",components:2,type:"Int16"}],4),Eb=Vr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ib=Vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,c,u){let p=this.segments[this.segments.length-1];return e>cn.MAX_VERTEX_ARRAY_LENGTH&&or(`Max vertices per segment is ${cn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>cn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:n,primitiveOffset:c,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(e,n,c,u){return this._prepareSegment(e,n.length,c.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,c,u){return new cn([{vertexOffset:e,primitiveOffset:n,vertexLength:c,primitiveLength:u,vaos:{},sortKey:0}])}}function bv(s,e){return 256*(s=W(Math.floor(s),0,255))+W(Math.floor(e),0,255)}cn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,zt(cn,"SegmentVector");const Ab=Vr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Cb=Vr([{name:"a_pattern_b",components:4,type:"Uint16"}]),Pb=Vr([{name:"a_dash",components:4,type:"Uint16"}]);class zd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,c,u){this.ids.push(Fd(e)),this.positions.push(n,c,u)}eachPosition(e,n){const c=Fd(e);let u=0,p=this.ids.length-1;for(;u<p;){const m=u+p>>1;this.ids[m]>=c?p=m:u=m+1}for(;this.ids[u]===c;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const c=new Float64Array(e.ids),u=new Uint32Array(e.positions);return x_(c,u,0,c.length-1),n&&(n.add(c.buffer),n.add(u.buffer)),{ids:c,positions:u}}static deserialize(e){const n=new zd;let c;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==c&&n.uniqueIds.push(u),c=u;return n.indexed=!0,n}}function Fd(s){const e=+s;return Number.isSafeInteger(e)?e:ad(String(s))}function x_(s,e,n,c){for(;n<c;){const u=s[n+c>>1];let p=n-1,m=c+1;for(;;){do p++;while(s[p]<u);do m--;while(s[m]>u);if(p>=m)break;Ip(s,p,m),Ip(e,3*p,3*m),Ip(e,3*p+1,3*m+1),Ip(e,3*p+2,3*m+2)}m-n<c-m?(x_(s,e,n,m),n=m+1):(x_(s,e,m+1,c),c=m)}}function Ip(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}zt(zd,"FeaturePositionMap");class ya{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,c){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Ap extends ya{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}}class Dn extends ya{constructor(e){super(e),this.current=0}set(e,n,c){this.fetchUniformLocation(e,n)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class rl extends ya{constructor(e){super(e),this.current=[0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1])))}}class Ju extends ya{constructor(e){super(e),this.current=[0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2])))}}class Bd extends ya{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,c){this.fetchUniformLocation(e,n)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class w_ extends ya{constructor(e){super(e),this.current=yi.transparent.toPremultipliedRenderColor(null)}set(e,n,c){this.fetchUniformLocation(e,n)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const Tv=new Float32Array(16);class Nd extends ya{constructor(e){super(e),this.current=Tv}set(e,n,c){if(this.fetchUniformLocation(e,n)){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let u=1;u<16;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}}}const Rb=new Float32Array(9),Sv=new Float32Array(4);class b_ extends ya{constructor(e){super(e),this.current=Sv}set(e,n,c){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(c[u]!==this.current[u]){this.current=c,this.gl.uniformMatrix2fv(this.location,!1,c);break}}}}function T_(s){return[bv(255*s.r,255*s.g),bv(255*s.b,255*s.a)]}function Cp(s,e,n,c,u,p,m,y){return!!s&&(s.kind==="composite"||s.kind==="source"?s.evaluate(new Ui(0,{brightness:p,worldview:y}),e,n,u,c,m)==="none":s.value==="none")}class Pp{constructor(e,n,c,u){this.value=e,this.uniformNames=n.map(p=>`u_${p}`),this.type=c,this.context=u}setUniform(e,n,c,u,p){const m=u.constantOr(this.value);n.set(e,p,m instanceof yi?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,n){return this.type==="color"?new w_(e):new Dn(e)}}class jd{constructor(e,n){this.uniformNames=n.map(c=>`u_${c}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,n){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=n?n.tl.concat(n.br):this.pattern}setUniform(e,n,c,u,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&n.set(e,p,m)}getBinding(e,n){return n==="u_pattern"||n==="u_pattern_b"||n==="u_dash"?new Bd(e):new Dn(e)}}class Tl{constructor(e,n,c,u){this.expression=e,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,c,u,p,m,y,b){const T=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ui(0,{brightness:m,worldview:b}),n,{},p,u,y):this.expression.kind==="constant"&&this.expression.value,C=Cp(this.lutExpression,n,{},u,p,m,y,b);this.paintVertexArray.resize(e),this._setPaintValue(T,e,A,C?null:this.context.lut)}updatePaintArray(e,n,c,u,p,m,y,b){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y,worldview:b},c,u,void 0,p):this.expression.kind==="constant"&&this.expression.value,A=Cp(this.lutExpression,c,u,p,void 0,y,void 0,b);this._setPaintValue(e,n,T,A?null:this.context.lut)}_setPaintValue(e,n,c,u){if(this.type==="color"){const p=T_(c.toPremultipliedRenderColor(u));for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oa{constructor(e,n,c,u,p,m){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=c,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,n,c,u,p,m,y,b){const T=this.expression.evaluate(new Ui(this.context.zoom,{brightness:m,worldview:b}),n,{},p,u,y),A=this.expression.evaluate(new Ui(this.context.zoom+1,{brightness:m,worldview:b}),n,{},p,u,y),C=Cp(this.lutExpression,n,{},u,p,m,y,b),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,T,A,C?null:this.context.lut)}updatePaintArray(e,n,c,u,p,m,y,b){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:y,worldview:b},c,u,void 0,p),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y,worldview:b},c,u,void 0,p),C=Cp(this.lutExpression,c,u,p,void 0,y,void 0,b);this._setPaintValue(e,n,T,A,C?null:this.context.lut)}_setPaintValue(e,n,c,u,p){if(this.type==="color"){const m=T_(c.toPremultipliedRenderColor(p)),y=T_(c.toPremultipliedRenderColor(p));for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,m[0],m[1],y[0],y[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,c,u);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,c,u,p){const m=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,y=W(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);n.set(e,p,y)}getBinding(e,n){return new Dn(e)}}class Ms{constructor(e,n,c,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(c==="array"?Pb:Ab).members;for(let m=0;m<n.length;++m);this.paintVertexArray=new u,this.paintTransitionVertexArray=new Wc}populatePaintArray(e,n,c,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(e,n,c,u,p,m,y){this._setPaintValues(e,n,c.patterns&&c.patterns[this.layerId],m)}_setPaintValues(e,n,c,u){if(!u||!c)return;const p=u[c[0]],m=u[c[1]];if(p){if(p){const{tl:y,br:b,pixelRatio:T}=p;for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,y[0],y[1],b[0],b[1],T)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:y,br:b}=m;for(let T=e;T<n;T++)this.paintTransitionVertexArray.emplace(T,y[0],y[1],b[0],b[1])}}}upload(e){const n=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,n)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Cb.members,n))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Sl{constructor(e,n,c=()=>!0){this.binders={},this._buffers=[],this.context=n;const u=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!c(p)||!(m instanceof ga&&rp(m.property.specification)))continue;const y=Mb(p,e.type),b=m.value,T=m.property.specification.type,A=!!m.property.useIntegerZoom,C=p==="line-dasharray"||p.endsWith("pattern"),P=e.paint.get(`${p}-use-theme`),D=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||P&&P.value.kind!=="constant";if(b.kind!=="constant"||D)if(b.kind==="source"||D||C){const L=S_(p,T,"source");this.binders[p]=C?new Ms(b,y,T,L,e.id):new Tl(b,y,T,L),u.push(`/a_${p}`)}else{const L=S_(p,T,"composite");this.binders[p]=new Oa(b,y,T,A,n,L),u.push(`/z_${p}`)}else this.binders[p]=C?new jd(b.value,y):new Pp(b.value,y,T,n),u.push(`/u_${p}`);P&&(this.binders[p].lutExpression=P.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Tl||n instanceof Oa?n.maxValue:0}populatePaintArrays(e,n,c,u,p,m,y,b){for(const T in this.binders){const A=this.binders[T];A.context=this.context,(A instanceof Tl||A instanceof Oa||A instanceof Ms)&&A.populatePaintArray(e,n,c,u,p,m,y,b)}}setConstantPatternPositions(e,n){for(const c in this.binders){const u=this.binders[c];u instanceof jd&&u.setConstantPatternPositions(e,n)}}getPatternTransitionVertexBuffer(e){const n=this.binders[e];return n instanceof Ms?n.paintTransitionVertexBuffer:null}updatePaintArrays(e,n,c,u,p,m,y,b,T,A){let C=!1;const P=Object.keys(e),D=P.length!==0&&!b,L=D?P:n.uniqueIds;this.context.lut=p.lut;for(const N in this.binders){const V=this.binders[N];if(V.context=this.context,(V instanceof Tl||V instanceof Oa||V instanceof Ms)&&V.expression&&V.expression.kind&&V.expression.kind!=="constant"&&(V.expression.isStateDependent===!0||V.expression.isLightConstant===!1)){const G=p.paint.get(N);V.expression=G.value;for(const X of L){const Y=e[X.toString()];n.eachPosition(X,(ie,_e,ue)=>{const be=u.feature(ie);V.updatePaintArray(_e,ue,be,Y,m,y,T,A)})}if(!D)for(const X of c.uniqueIds){const Y=e[X.toString()];c.eachPosition(X,(ie,_e,ue)=>{const be=u.feature(ie);V.updatePaintArray(_e,ue,be,Y,m,y,T,A)})}C=!0}}return C}defines(){const e=[];for(const n in this.binders){const c=this.binders[n];(c instanceof Pp||c instanceof jd)&&e.push(...c.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const c in this.binders){const u=this.binders[c];if(u instanceof Pp||u instanceof jd||u instanceof Oa)for(const p of u.uniformNames)n.push({name:p,property:c,binding:u.getBinding(e,p)})}return n}setUniforms(e,n,c,u,p){for(const{name:m,property:y,binding:b}of c)this.binders[y].setUniform(e,b,p,u.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Tl||n instanceof Oa||n instanceof Ms)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer),n instanceof Ms&&n.paintTransitionVertexBuffer&&this._buffers.push(n.paintTransitionVertexBuffer)}}upload(e){for(const n in this.binders){const c=this.binders[n];(c instanceof Tl||c instanceof Oa||c instanceof Ms)&&c.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Tl||n instanceof Oa||n instanceof Ms)&&n.destroy()}}}class Da{constructor(e,n,c=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new Sl(u,n,c);this.needsUpload=!1,this._featureMap=new zd,this._featureMapWithoutIds=new zd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,c,u,p,m,y,b,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(e,n,u,p,m,y,b,T);n.id!==void 0?this._featureMap.add(n.id,c,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,c,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,c,u,p,m,y,b){for(const T of c)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,T,u,p,m,y||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const kb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Mb(s,e){return kb[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const Ob={"line-pattern":{source:ac,composite:ac},"fill-pattern":{source:ac,composite:ac},"fill-extrusion-pattern":{source:ac,composite:ac},"line-dasharray":{source:Wc,composite:Wc}},Db={color:{source:cc,composite:lc},number:{source:bl,composite:cc}};function S_(s,e,n){const c=Ob[s];return c&&c[n]||Db[e][n]}zt(Pp,"ConstantBinder"),zt(jd,"PatternConstantBinder"),zt(Tl,"SourceExpressionBinder"),zt(Ms,"PatternCompositeBinder"),zt(Oa,"CompositeExpressionBinder"),zt(Sl,"ProgramConfiguration",{omit:["_buffers"]}),zt(Da,"ProgramConfigurationSet");const po=xt/Math.PI/2,d=5,r=6,l=16383,f=64,_=[f,32,16],x=-po,w=po;function S(s,e,n,c=po){return n=Nr(n),[s*Math.sin(n)*c,-e*c,s*Math.cos(n)*c]}function I(s,e,n){return S(Math.cos(Nr(s)),Math.sin(Nr(s)),e,n)}const R=63710088e-1,k=2*Math.PI*R;class z{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new z(Se(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,c=this.lat*n,u=e.lat*n,p=Math.sin(c)*Math.sin(u)+Math.cos(c)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return R*Math.acos(Math.min(p,1))}toBounds(e=0){const n=360*e/40075017,c=n/Math.cos(Math.PI/180*this.lat);return new M({lng:this.lng-c,lat:this.lat-n},{lng:this.lng+c,lat:this.lat+n})}toEcef(e){return I(this.lat,this.lng,po+e*po/R)}static convert(e){if(e instanceof z)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new z(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new z(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class M{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof z?new z(e.lng,e.lat):z.convert(e),this}setSouthWest(e){return this._sw=e instanceof z?new z(e.lng,e.lat):z.convert(e),this}extend(e){const n=this._sw,c=this._ne;let u,p;if(e instanceof z)u=e,p=e;else{if(!(e instanceof M))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(M.convert(e)):this.extend(z.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(z.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return n||c?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new z(u.lng,u.lat),this._ne=new z(p.lng,p.lat)),this}getCenter(){return new z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new z(this.getWest(),this.getNorth())}getSouthEast(){return new z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:c}=z.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&u}static convert(e){if(e)return e instanceof M?e:new M(e)}}const B=0,j=25.5;function U(s){return k*Math.cos(s*Math.PI/180)}function Z(s){return(180+s)/360}function q(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function K(s,e){return s/U(e)}function ne(s){return 360*s-180}function ee(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function ge(s,e){return s*U(ee(e))}const oe=85.051129;function ve(s){return Math.cos(Nr(W(s,-oe,oe)))}function pe(s,e){const n=W(e,B,j),c=Math.pow(2,n);return ve(s)*k/(512*c)}function ce(s){return 1/Math.cos(s*Math.PI/180)}function xe(s,e=0){const n=Math.exp(Math.PI*(1-(s.y+e/xt)/(1<<s.z)*2));return 80150034*n/(n*n+1)/xt/(1<<s.z)}class Me{constructor(e,n,c=0){this.x=+e,this.y=+n,this.z=+c}static fromLngLat(e,n=0){const c=z.convert(e);return new Me(Z(c.lng),q(c.lat),K(n,c.lat))}toLngLat(){return new z(ne(this.x),ee(this.y))}toAltitude(){return ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k*ce(ee(this.y))}}function Ce(s,e,n,c,u,p,m,y,b){const T=(e+c)/2,A=(n+u)/2,C=new nt(T,A);y(C),function(P,D,L,N,V,G){const X=L-V,Y=N-G;return Math.abs((N-D)*X-(L-P)*Y)/Math.hypot(X,Y)}(C.x,C.y,p.x,p.y,m.x,m.y)>=b?(Ce(s,e,n,T,A,p,C,y,b),Ce(s,T,A,c,u,C,m,y,b)):s.push(m)}function We(s,e,n){let c=s[0],u=c.x,p=c.y;e(c);const m=[c];for(let y=1;y<s.length;y++){const b=s[y],{x:T,y:A}=b;e(b),Ce(m,u,p,T,A,c,b,e,n),u=T,p=A,c=b}return m}function Ne(s,e,n,c){if(c(e,n)){const u=e.add(n)._mult(.5);Ne(s,e,u,c),Ne(s,u,n,c)}else s.push(n)}function Qe(s,e){let n=s[0];const c=[n];for(let u=1;u<s.length;u++){const p=s[u];Ne(c,n,p,e),n=p}return c}const _t=Math.pow(2,14)-1,Fe=-_t-1;function Ie(s,e){const n=Math.round(s.x*e),c=Math.round(s.y*e);return s.x=W(n,Fe,_t),s.y=W(c,Fe,_t),(n<s.x||n>s.x+1||c<s.y||c>s.y+1)&&or("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function et(s,e,n){const c=s.loadGeometry(),u=s.extent,p=xt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:T,projection:A}=n,C=P=>{const D=ne((e.x+P.x/u)/m),L=ee((e.y+P.y/u)/m),N=A.project(D,L);P.x=(N.x*y-b)*u,P.y=(N.y*y-T)*u};for(let P=0;P<c.length;P++)if(s.type!==1)c[P]=We(c[P],C,1);else{const D=[];for(const L of c[P])L.x<0||L.x>=u||L.y<0||L.y>=u||(C(L),D.push(L));c[P]=D}}for(const m of c)for(const y of m)Ie(y,p);return c}function je(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?et(s):[]}}class ot{constructor(e,n,c,u,p){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(wt,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,c=[];let u,p=1,m=0,y=0,b=0;for(;e.pos<n;){if(m<=0){const T=e.readVarint();p=7&T,m=T>>3}if(m--,p===1||p===2)y+=e.readSVarint(),b+=e.readSVarint(),p===1&&(u&&c.push(u),u=[]),u&&u.push(new nt(y,b));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&c.push(u),c}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let c=1,u=0,p=0,m=0,y=1/0,b=-1/0,T=1/0,A=-1/0;for(;e.pos<n;){if(u<=0){const C=e.readVarint();c=7&C,u=C>>3}if(u--,c===1||c===2)p+=e.readSVarint(),m+=e.readSVarint(),p<y&&(y=p),p>b&&(b=p),m<T&&(T=m),m>A&&(A=m);else if(c!==7)throw new Error(`unknown command ${c}`)}return[y,T,b,A]}toGeoJSON(e,n,c){const u=this.extent*Math.pow(2,c),p=this.extent*e,m=this.extent*n,y=this.loadGeometry();function b(P){return[360*(P.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(P.y+m)/u)*Math.PI))-90]}function T(P){return P.map(b)}let A;if(this.type===1){const P=[];for(const L of y)P.push(L[0]);const D=T(P);A=P.length===1?{type:"Point",coordinates:D[0]}:{type:"MultiPoint",coordinates:D}}else if(this.type===2){const P=y.map(T);A=P.length===1?{type:"LineString",coordinates:P[0]}:{type:"MultiLineString",coordinates:P}}else{if(this.type!==3)throw new Error("unknown feature type");{const P=function(L){const N=L.length;if(N<=1)return[L];const V=[];let G,X;for(let Y=0;Y<N;Y++){const ie=jt(L[Y]);ie!==0&&(X===void 0&&(X=ie<0),X===ie<0?(G&&V.push(G),G=[L[Y]]):G&&G.push(L[Y]))}return G&&V.push(G),V}(y),D=[];for(const L of P)D.push(L.map(T));A=D.length===1?{type:"Polygon",coordinates:D[0]}:{type:"MultiPolygon",coordinates:D}}}const C={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function wt(s,e,n){s===1?e.id=n.readVarint():s===2?function(c,u){const p=c.readVarint()+c.pos;for(;c.pos<p;){const m=u._keys[c.readVarint()],y=u._values[c.readVarint()];u.properties[m]=y}}(n,e):s===3?e.type=n.readVarint():s===4&&(e._geometry=n.pos)}function jt(s){let e=0;for(let n,c,u=0,p=s.length,m=p-1;u<p;m=u++)n=s[u],c=s[m],e+=(c.x-n.x)*(n.y+c.y);return e}ot.types=["Unknown","Point","LineString","Polygon"];class pt{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(vt,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new ot(this._pbf,n,this.extent,this._keys,this._values)}}function vt(s,e,n){s===15?e.version=n.readVarint():s===1?e.name=n.readString():s===5?e.extent=n.readVarint():s===2?e._features.push(n.pos):s===3?e._keys.push(n.readString()):s===4&&e._values.push(function(c){let u=null;const p=c.readVarint()+c.pos;for(;c.pos<p;){const m=c.readVarint()>>3;u=m===1?c.readString():m===2?c.readFloat():m===3?c.readDouble():m===4?c.readVarint64():m===5?c.readVarint():m===6?c.readSVarint():m===7?c.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(n))}class $t{constructor(e,n){this.layers=e.readFields(Ot,{},n)}}function Ot(s,e,n){if(s===3){const c=new pt(n,n.readVarint()+n.pos);c.length&&(e[c.name]=c)}}const Rt="3d_elevation_id",Dt="level";class lr{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,c){return this.get(e,!0,n,c)}optional(e,n,c){return this.get(e,!1,n,c)}success(){return this._valid}get(e,n,c,u){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?c(u?u(p):p):n&&(this._valid=!1),this}}class Ur{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,c){return this.featureFunc(e,n,c)}parseVertex(e,n,c){return this.vertexFunc(e,n,c)}}const Jr=new Ur((s,e,n)=>s.reset(e).require(Rt,c=>{n.id=c}).optional("fixed_height_relative",c=>{n.constantHeight=c},yr.decodeRelativeHeight).geometry(c=>{n.bounds=c},yd).success(),(s,e,n)=>s.reset(e).require(Rt,c=>{n.id=c}).require("elevation_idx",c=>{n.idx=c}).require("extent",c=>{n.extent=c}).require("height_relative",c=>{n.height=c},yr.decodeRelativeHeight).geometry(c=>{n.position=c},yr.getPoint).success()),Ci=new Ur((s,e,n)=>s.reset(e).require(Rt,c=>{n.id=c}).optional("fixed_height",c=>{n.constantHeight=c},yr.decodeMetricHeight).geometry(c=>{n.bounds=c},yd).success(),(s,e,n)=>s.reset(e).require(Rt,c=>{n.id=c}).require("elevation_idx",c=>{n.idx=c}).require("extent",c=>{n.extent=c}).require("height",c=>{n.height=c},yr.decodeMetricHeight).geometry(c=>{n.position=c},yr.getPoint).success());class yr{static getPoint(e){return aa(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ci:void 0:Jr}static parse(e){const n=[],c=[],u=e.length,p=new lr;for(let m=0;m<u;m++){const y=e.feature(m),b=y.properties.version,T=yr.getVersionSchema(b);if(T===void 0){or(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const A=y.properties.type;if(!A)continue;const C=ot.types[y.type];if(C==="Point"&&A==="curve_point"){const P={};T.parseVertex(p,y,P)&&n.push(P)}else if(C==="Polygon"&&A==="curve_meta"){const P={};T.parseFeature(p,y,P)&&c.push(P)}}return{vertices:n,features:c}}}class Kr{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const u=Ra(n,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/u;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,!0}}class kr{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,c){const u=Pi(n,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,n,c){if(function(D,L){var N=D[0],V=D[1],G=D[2],X=L[0],Y=L[1],ie=L[2];return Math.abs(N-X)<=O*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(V-Y)<=O*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(G-ie)<=O*Math.max(1,Math.abs(G),Math.abs(ie))}(this.pos,e)||n===0)return c[0]=c[1]=c[2]=0,!1;const[u,p,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],T=this.pos[2]-e[2],A=u*u+p*p+m*m,C=2*(y*u+b*p+T*m),P=C*C-4*A*(y*y+b*b+T*T-n*n);if(P<0){const D=Math.max(-C/2,0),L=y+u*D,N=b+p*D,V=T+m*D,G=Math.hypot(L,N,V);return c[0]=L*n/G,c[1]=N*n/G,c[2]=V*n/G,!1}{const D=(-C-Math.sqrt(P))/(2*A);if(D<0){const L=Math.hypot(y,b,T);return c[0]=y*n/L,c[1]=b*n/L,c[2]=T*n/L,!1}return c[0]=y+u*D,c[1]=b+p*D,c[2]=T+m*D,!0}}}class Si{constructor(e,n,c,u,p){this.TL=e,this.TR=n,this.BR=c,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,n,c){const u=[-1,1,1],p=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=bi(u,u,e),T=bi(p,p,e),A=bi(m,m,e),C=bi(y,y,e);return new Si(b,T,A,C,n/c)}}function Qr(s,e,n){let c=1/0,u=-1/0;const p=[];for(const m of s){Gi(p,m,e);const y=Pi(p,n);c=Math.min(c,y),u=Math.max(u,y)}return[c,u]}function Fi(s,e){let n=!0;for(let c=0;c<s.planes.length;c++){const u=s.planes[c];let p=0;for(let m=0;m<e.length;m++)p+=+(Pi(u,e[m])+u[3]>=0);if(p===0)return 0;p!==e.length&&(n=!1)}return n?2:1}function oi(s,e){for(const n of s.projections){const c=Qr(e,s.points[0],n.axis);if(n.projection[1]<c[0]||n.projection[0]>c[1])return 0}return 1}function Mr(s,e){let n=0;const c=[0,0,0,0];for(let m=0;m<s.length;m++)c[0]=s[m][0],c[1]=s[m][1],c[2]=s[m][2],c[3]=1,(u=c)[0]*(p=e)[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3]>=0&&n++;var u,p;return n}class pi{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=Lr.fromPoints(this.points),this.projections=[],this.frustumEdges=[Gi([],this.points[2],this.points[3]),Gi([],this.points[0],this.points[3]),Gi([],this.points[4],this.points[0]),Gi([],this.points[5],this.points[1]),Gi([],this.points[6],this.points[2]),Gi([],this.points[7],this.points[3])];for(const c of this.frustumEdges){const u=[0,-c[2],c[1]],p=[c[2],0,-c[0]];this.projections.push({axis:u,projection:Qr(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:Qr(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,n,c,u){const p=Math.pow(2,c),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const A=Nt([],T,e),C=1/A[3]/n*p;return(P=A)[0]=(D=A)[0]*(L=[C,C,u?1/A[3]:C,C])[0],P[1]=D[1]*L[1],P[2]=D[2]*L[2],P[3]=D[3]*L[3],P;var P,D,L}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const A=Hr([],Qi([],Gi([],m[T[0]],m[T[1]]),Gi([],m[T[2]],m[T[1]]))),C=-Pi(A,m[T[1]]);return A.concat(C)}),b=[];for(let T=0;T<m.length;T++)b.push([m[T][0],m[T][1],m[T][2]]);return new pi(b,y)}intersectsPrecise(e,n,c){for(let u=0;u<n.length;u++)if(!Mr(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Mr(e,this.planes[u]))return 0;for(const u of c)for(const p of this.frustumEdges){const m=Qi([],u,p),y=mr(m);if(y===0)continue;Sr(m,m,1/y);const b=Qr(this.points,this.points[0],m),T=Qr(e,this.points[0],m);if(b[0]>T[1]||T[0]>b[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const c=n[3];if(Pi([n[0],n[1],n[2]],e)+c<0)return!1}return!0}}class Lr{static fromPoints(e){const n=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const u of e)Gr(n,n,u),Rr(c,c,u);return new Lr(n,c)}static fromTileIdAndHeight(e,n,c){const u=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new Lr([p/u,m/u,n],[(p+1)/u,(m+1)/u,c])}static applyTransform(e,n){const c=e.getCorners();for(let u=0;u<c.length;++u)bi(c[u],c[u],n);return Lr.fromPoints(c)}static applyTransformFast(e,n){const c=[n[12],n[13],n[14]],u=[...c];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const y=n[4*m+p],b=y*e.min[m],T=y*e.max[m];c[p]+=Math.min(b,T),u[p]+=Math.max(b,T)}return new Lr(c,u)}static projectAabbCorners(e,n){const c=e.getCorners();for(let u=0;u<c.length;++u)bi(c[u],c[u],n);return c}constructor(e,n){this.min=e,this.max=n,this.center=Sr([],dt([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],c=Zt(this.min),u=Zt(this.max);for(let p=0;p<n.length;p++)c[p]=n[p]?this.min[p]:this.center[p],u[p]=n[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Lr(c,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Fi(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Fi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?oi(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?oi(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}zt(Lr,"Aabb");class $i{constructor(e,n){this.feature=e,this.metersToTile=n,this.index=0}get(){const e=this.feature.vertices[this.index],n=this.feature.vertexProps[this.index].dir,c=n[1],u=-n[0],p=(e.extent+1)*this.metersToTile;return[new nt(Math.trunc(e.position[0]+c*p),Math.trunc(e.position[1]+u*p)),new nt(Math.trunc(e.position[0]-c*p),Math.trunc(e.position[1]-u*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class gi{constructor(e,n,c,u,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[en(),en(),en(),en(),en(),en(),en()],this.id=e,this.heightRange={min:c,max:c},this.safeArea=n,this.constantHeight=c,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=p,this.edges=this.edges.filter(y=>{return y.a<this.vertices.length&&y.b<this.vertices.length&&!((b=this.vertices[y.a].position)[0]===(T=this.vertices[y.b].position)[0]&&b[1]===T[1]);var b,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:aa(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const b=this.vertices[y.a].position,T=this.vertices[y.b].position,A=eo(en(),T,b),C=tn(A),P=lo(en(),A,1/C);this.edgeProps.push({vec:A,dir:P,len:C});const D=this.vertexProps[y.a].dir,L=this.vertexProps[y.b].dir;Do(D,D,P),Do(L,L,P)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||ms(y.dir,y.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[c,u]=n;return pr(this.vertices[this.edges[c].a].height,this.vertices[this.edges[c].b].height,u)}computeSlopeNormal(e,n){const c=this.getClosestEdge(e);if(!c)return Qt(0,0,1);const u=c[0],p=this.edges[u],m=this.edgeProps[u].vec,y=Qt(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*n),b=Qt(y[1],-y[0],0);Qi(b,b,y);const T=mr(b);return T>0?Sr(b,b,1/T):er(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,c=Number.POSITIVE_INFINITY,u=0;const[p,m,y,b,T,A,C]=this._tmpVec2;Qs(C,e.x,e.y);const P=new Kr(C,null);for(let D=0;D<this.edges.length;D++){const L=this.edges[D],N=this.edgeProps[D].dir;P.dir=N;const V=this.vertices[L.a].position,G=this.vertices[L.b].position,X=P.intersectsPlane(V,this.vertexProps[L.a].dir,p),Y=P.intersectsPlane(G,this.vertexProps[L.b].dir,m);if(!X||!Y)continue;eo(y,m,p),eo(b,C,p);const ie=Ra(y,y),_e=ie>0?Ra(b,y)/ie:0,ue=W(_e,0,1),be=Math.abs((_e-ue)*this.edgeProps[D].len);eo(T,C,V),Qs(A,N[1],-N[0]);const Ee=be+Math.abs(Ra(T,A));Ee<c&&(n=D,c=Ee,u=ue)}return[n,u]}tessellate(e){const n=Mt(),c=Mt(),u=Mt(),p=Mt();for(let m=this.edges.length-1;m>=0;--m){const y=this.edges[m].a,b=this.edges[m].b,{position:T,height:A,extent:C}=this.vertices[y],{position:P,height:D,extent:L}=this.vertices[b],N=this.vertexProps[y].dir,V=this.vertexProps[b].dir;if(er(n,T[0]/e,T[1]/e,A),er(c,P[0]/e,P[1]/e,D),er(u,N[1],-N[0],0),Sr(u,u,C),er(p,V[1],-V[0],0),Sr(p,p,L),this.distSqLines(Qt(n[0]+.5*u[0],n[1]+.5*u[1],n[2]+.5*u[2]),Qt(c[0]-.5*p[0],c[1]-.5*p[1],c[2]-.5*p[2]),Qt(n[0]-.5*u[0],n[1]-.5*u[1],n[2]-.5*u[2]),Qt(c[0]+.5*p[0],c[1]+.5*p[1],c[2]+.5*p[2]))<=.0025000000000000005)continue;const G=this.vertices.length,X=Do(en(),T,P);this.vertices.push({position:lo(X,X,.5),height:.5*(A+D),extent:.5*(C+L)});const Y=Do(en(),N,V);this.vertexProps.push({dir:ms(Y,Y)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:y,b:G}),this.edges.push({a:G,b});const ie=eo(en(),this.vertices[G].position,T),_e=tn(ie),ue={vec:ie,dir:lo(en(),ie,1/_e),len:_e};this.edgeProps.push(ue),this.edgeProps.push(ue)}}distSqLines(e,n,c,u){const p=It(Mt(),n,e),m=It(Mt(),u,c),y=It(Mt(),e,c),b=Pi(p,p),T=Pi(p,m),A=Pi(p,y),C=Pi(m,m),P=Pi(m,y),D=b*C-T*T;if(D===0)return On(Fn(p,c,u,Pi(y,m)/Pi(m,m)),e);const L=(b*P-T*A)/D;return On(Fn(p,e,n,(T*P-A*C)/D),Fn(m,c,u,L))}}class xr{static parseFrom(e,n){const c=yr.parse(e);if(!c)return[];let{vertices:u,features:p}=c;const m=1/xe(n);p.sort((A,C)=>A.id-C.id),u.sort((A,C)=>A.id-C.id||A.idx-C.idx),u=u.filter((A,C,P)=>C===P.findIndex(D=>D.id===A.id&&D.idx===A.idx));const y=new Array;let b=0;const T=u.length;for(const A of p){if(A.constantHeight){y.push(new gi(A.id,A.bounds,A.constantHeight));continue}for(;b!==T&&u[b].id<A.id;)b++;if(b===T||u[b].id!==A.id)continue;const C=new Array,P=new Array,D=b;for(;b!==T&&u[b].id===A.id;){const L=u[b];if(C.push({position:L.position,height:L.height,extent:L.extent}),b!==D&&u[b-1].idx===L.idx-1){const N=b-D;P.push({a:N-1,b:N})}b++}y.push(new gi(A.id,A.bounds,void 0,C,P,m))}return y}static getElevationFeature(e,n){if(!n)return;const c=+e.properties[Rt];return Number.isNaN(c)?void 0:n.find(u=>u.id===c)}}class ri{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*xt,this.yOffset=(e.y*this.zScale-n.y)*xt)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,c){const u=this.constantElevation(n,c);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),c))}computeBiasedHeight(e,n){return n<=0?e:e+n*le(0,n,e>=0?e:Math.abs(.5*e))}}zt(gi,"ElevationFeature");class on{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new fo,this.indexArray=new rn,this.segments=new cn,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new bl),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,u){}populate(e,n,c,u){const p=this.layers[0],m=[];let y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:C,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,L=je(T,D);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),L,c))continue;const N=y?y.evaluate(L,{},c):void 0,V={id:A,properties:T.properties,type:T.type,sourceLayerIndex:P,index:C,geometry:D?L.geometry:et(T,c,u),patterns:{},sortKey:N};m.push(V)}y&&m.sort((T,A)=>T.sortKey-A.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new yp,b=u.projection);for(const T of m){const{geometry:A,index:C,sourceLayerIndex:P}=T,D=e[C].feature;this.addFeature(T,A,C,n.availableImages,c,b,n.brightness,n.elevationFeatures),n.featureIndex.insert(D,A,C,P,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,n,c,u,p,m,y){this.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ib.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Eb.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,n,c,u,p,m,y,b){let T;this.elevationMode!=="none"&&(T=xr.getElevationFeature(e,b));for(const A of n)for(const C of A){const P=C.x,D=C.y;if(P<0||P>=xt||D<0||D>=xt)continue;if(m){const V=m.projectTilePoint(P,D,p),G=m.upVector(p,P,D);this.addGlobeExtVertex(V,G),this.addGlobeExtVertex(V,G),this.addGlobeExtVertex(V,G),this.addGlobeExtVertex(V,G)}const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),N=L.vertexLength;if(this.addCircleVertex(P,D,-1,-1),this.addCircleVertex(P,D,1,-1),this.addCircleVertex(P,D,1,1),this.addCircleVertex(P,D,-1,1),this.elevationMode!=="none"){const V=T?T.pointElevation(new nt(P,D)):0;this.hasElevation=this.hasElevation||V!==0;for(let G=0;G<4;G++)this.elevatedLayoutVertexArray.emplaceBack(V)}this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+2,N+3),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,{},u,p,y,void 0,this.worldview)}addCircleVertex(e,n,c,u){this.layoutVertexArray.emplaceBack(2*e+(c+1)/2,2*n+(u+1)/2)}addGlobeExtVertex(e,n){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}}function En(s,e){for(let n=0;n<s.length;n++)if(ls(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(ls(s,e[n]))return!0;return!!no(s,e)}function un(s,e,n){return!!ls(s,e)||!!Is(e,s,n)}function _n(s,e){if(s.length===1)return va(e,s[0]);for(let n=0;n<e.length;n++){const c=e[n];for(let u=0;u<c.length;u++)if(ls(s,c[u]))return!0}for(let n=0;n<s.length;n++)if(va(e,s[n]))return!0;for(let n=0;n<e.length;n++)if(no(s,e[n]))return!0;return!1}function mo(s,e,n){if(s.length>1){if(no(s,e))return!0;for(let c=0;c<e.length;c++)if(Is(e[c],s,n))return!0}for(let c=0;c<s.length;c++)if(Is(s[c],e,n))return!0;return!1}function no(s,e){if(s.length===0||e.length===0)return!1;for(let n=0;n<s.length-1;n++){const c=s[n],u=s[n+1];for(let p=0;p<e.length-1;p++)if(Es(c,u,e[p],e[p+1]))return!0}return!1}function Es(s,e,n,c){return zr(s,n,c)!==zr(e,n,c)&&zr(s,e,n)!==zr(s,e,c)}function Os(s,e,n){return(s.x-n.x)*(e.y-n.y)-(s.y-n.y)*(e.x-n.x)}function Uo(s,e,n,c){const u=Os(s,e,c),p=Os(s,e,n);if(Math.sign(u)===Math.sign(p))return;const m=Os(n,c,s),y=m+p-u;return Math.sign(m)!==Math.sign(y)?[m/(m-y),p/(p-u)]:void 0}function Is(s,e,n){const c=n*n;if(e.length===1)return s.distSqr(e[0])<c;for(let u=1;u<e.length;u++)if($o(s,e[u-1],e[u])<c)return!0;return!1}function $o(s,e,n){const c=e.distSqr(n);if(c===0)return s.distSqr(e);const u=((s.x-e.x)*(n.x-e.x)+(s.y-e.y)*(n.y-e.y))/c;return s.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function va(s,e){let n,c,u,p=!1;for(let m=0;m<s.length;m++){n=s[m];for(let y=0,b=n.length-1;y<n.length;b=y++)c=n[y],u=n[b],c.y>e.y!=u.y>e.y&&e.x<(u.x-c.x)*(e.y-c.y)/(u.y-c.y)+c.x&&(p=!p)}return p}function ls(s,e){let n=!1;for(let c=0,u=s.length-1;c<s.length;u=c++){const p=s[c],m=s[u];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(n=!n)}return n}function dn(s,e,n,c,u){for(const m of s)if(e<=m.x&&n<=m.y&&c>=m.x&&u>=m.y)return!0;const p=[new nt(e,n),new nt(e,u),new nt(c,u),new nt(c,n)];if(s.length>2){for(const m of p)if(ls(s,m))return!0}for(let m=0;m<s.length-1;m++)if(In(s[m],s[m+1],p))return!0;return!1}function In(s,e,n){const c=n[0],u=n[2];if(s.x<c.x&&e.x<c.x||s.x>u.x&&e.x>u.x||s.y<c.y&&e.y<c.y||s.y>u.y&&e.y>u.y)return!1;const p=zr(s,e,n[0]);return p!==zr(s,e,n[1])||p!==zr(s,e,n[2])||p!==zr(s,e,n[3])}function Li(s,e,n,c,u,p){let m=e.y-s.y,y=s.x-e.x;if(p=p||0){const b=m*m+y*y;if(b===0)return!0;const T=Math.sqrt(b);m/=T,y/=T}return!((n.x-s.x)*m+(n.y-s.y)*y-p<0||(c.x-s.x)*m+(c.y-s.y)*y-p<0||(u.x-s.x)*m+(u.y-s.y)*y-p<0)}function Rn(s,e,n,c,u,p,m){return!(Li(s,e,c,u,p,m)||Li(e,n,c,u,p,m)||Li(n,s,c,u,p,m)||Li(c,u,s,e,n,m)||Li(u,p,s,e,n,m)||Li(p,c,s,e,n,m))}function cs(s,e,n){const c=e.paint.get(s).value;return c.kind==="constant"?c.value:n.programConfigurations.get(e.id).getMaxValue(s)}function fn(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Go(s,e,n,c,u){if(!e[0]&&!e[1])return s;const p=nt.convert(e)._mult(u);n==="viewport"&&p._rotate(-c);const m=[];for(let y=0;y<s.length;y++)m.push(s[y].sub(p));return m}function Qu(s,e,n,c){const u=nt.convert(s)._mult(c);return e==="viewport"&&u._rotate(-n),u}let El,eh;function th(s,e,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[s*c-2*Math.PI*6378137/2,e*c-2*Math.PI*6378137/2]}zt(on,"CircleBucket",{omit:["layers"]});class Ho{constructor(e,n,c){this.z=e,this.x=n,this.y=c,this.key=qo(0,e,e,n,c)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const n=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>n&&e.y===this.y>>n}url(e,n){const c=function(p,m,y){var b=th(256*p,256*(m=Math.pow(2,y)-m-1),y),T=th(256*(p+1),256*(m+1),y);return b[0]+","+b[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),u=function(p,m,y){let b,T="";for(let A=p;A>0;A--)b=1<<A-1,T+=(m&b?1:0)+(y&b?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class il{constructor(e,n){this.wrap=e,this.canonical=n,this.key=qo(e,n.z,n.z,n.x,n.y)}}class rs{constructor(e,n,c,u,p){this.overscaledZ=e,this.wrap=n,this.canonical=new Ho(c,+u,+p),this.key=n===0&&e===c?this.canonical.key:qo(n,e,c,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new rs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rs(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return qo(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-e;return qo(this.wrap*+n,e,e,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new rs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,u=2*this.canonical.y;return[new rs(n,this.wrap,n,c,u),new rs(n,this.wrap,n,c+1,u),new rs(n,this.wrap,n,c,u+1),new rs(n,this.wrap,n,c+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new rs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new rs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new il(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function qo(s,e,n,c,u){const p=1<<Math.min(n,22);let m=p*(u%p)+c%p;return s&&n<22&&(m+=p*p*((s<0?-2*s-1:2*s)%(1<<2*(22-n)))),16*(32*m+n)+(e-n)}const Xc=[s=>{let e=s.canonical.x-1,n=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,n--),new rs(s.overscaledZ,n,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,n=s.wrap;return e===1<<s.canonical.z&&(e=0,n++),new rs(s.overscaledZ,n,s.canonical.z,e,s.canonical.y)},s=>new rs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new rs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];zt(Ho,"CanonicalTileID"),zt(rs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ev=Vr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Rp}=Ev,EB=Vr([{name:"a_pos_3",components:3,type:"Int16"}]);var XI=Vr([{name:"a_pos",type:"Int16",components:2}]);function Iv(s){return s*po/R}const IB=[new Lr([x,x,x],[w,w,w]),new Lr([x,x,x],[0,0,w]),new Lr([0,x,x],[w,0,w]),new Lr([x,0,x],[0,w,w]),new Lr([0,0,x],[w,w,w])];function KI(s,e,n,c=!0){const u=Sr([],s._camera.position,s.worldSize),p=[e,n,1,1];Nt(p,p,s.pixelMatrixInverse),Ct(p,p,1/p[3]);const m=Hr([],Gi([],p,u)),y=s.globeMatrix,b=[y[12],y[13],y[14]],T=Gi([],b,u),A=mr(T),C=Hr([],T),P=s.worldSize/(2*Math.PI),D=Pi(C,m),L=Math.asin(P/A);if(L<Math.acos(D)){if(!c)return null;const Ze=[],ze=[];Sr(Ze,m,A/D),Hr(ze,Gi(ze,Ze,T)),Hr(m,dt(m,T,Sr(m,ze,Math.tan(L)*A)))}const N=[];new kr(u,m).closestPointOnSphere(b,P,N);const V=Hr([],Sn(y,0)),G=Hr([],Sn(y,1)),X=Hr([],Sn(y,2)),Y=Pi(V,N),ie=Pi(G,N),_e=Pi(X,N),ue=$s(Math.asin(-ie/P));let be=$s(Math.atan2(Y,_e));be=s.center.lng+function(Ze,ze){const Ke=(ze-Ze+180)%360-180;return Ke<-180?Ke+360:Ke}(s.center.lng,be);const Ee=Z(be),Ae=W(q(ue),0,1);return new Me(Ee,Ae)}class AB{constructor(e,n,c){this.a=Gi([],e,c),this.b=Gi([],n,c),this.center=c;const u=Hr([],this.a),p=Hr([],this.b);this.angle=Math.acos(Pi(u,p))}}function Lb(s,e){if(s.angle===0)return null;let n;return n=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),n<0||n>1?null:function(c,u,p,m){const y=Math.sin(p);return c*(Math.sin((1-m)*p)/y)+u*(Math.sin(m*p)/y)}(s.a[e],s.b[e],s.angle,W(n,0,1))+s.center[e]}function uc(s){if(s.z<=1)return IB[s.z+2*s.y+s.x];const e=zb(Av(s));return Lr.fromPoints(e)}function Kc(s,e,n){return Sr(s,s,1-n),ti(s,s,e,n)}function YI(s,e,n){for(const c of s)bi(c,c,e),Sr(c,c,n)}function JI(s,e,n,c){const u=e/s.worldSize,p=s.globeMatrix;if(n.z<=1){const Ae=uc(n).getCorners();return YI(Ae,p,u),Lr.fromPoints(Ae)}const m=Av(n,c),y=zb(m,po+Iv(s._tileCoverLift));YI(y,p,u);const b=Number.MAX_VALUE,T=[-b,-b,-b],A=[b,b,b];if(m.contains(s.center)){for(const ze of y)Gr(A,A,ze),Rr(T,T,ze);T[2]=0;const Ae=s.point,Ze=[Ae.x*u,Ae.y*u,0];return Gr(A,A,Ze),Rr(T,T,Ze),new Lr(A,T)}if(s._tileCoverLift>0){for(const Ae of y)Gr(A,A,Ae),Rr(T,T,Ae);return new Lr(A,T)}const C=[p[12]*u,p[13]*u,p[14]*u],P=m.getCenter(),D=W(s.center.lat,-oe,oe),L=W(P.lat,-oe,oe),N=Z(s.center.lng),V=q(D);let G=N-Z(P.lng);const X=V-q(L);G>.5?G-=1:G<-.5&&(G+=1);let Y=0;Math.abs(G)>Math.abs(X)?Y=G>=0?1:3:(Y=X>=0?0:2,ti(C,C,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(Nr(X>=0?m.getSouth():m.getNorth()))*po));const ie=y[Y],_e=y[(Y+1)%4],ue=new AB(ie,_e,C),be=[Lb(ue,0)||ie[0],Lb(ue,1)||ie[1],Lb(ue,2)||ie[2]],Ee=rh(s.zoom);if(Ee>0){const Ae=function({x:ze,y:Ke,z:tt},st,yt,ht,rt){const ut=1/(1<<tt);let He=ze*ut,$e=He+ut,at=Ke*ut,mt=at+ut,it=0;const Lt=(He+$e)/2-ht;return Lt>.5?it=-1:Lt<-.5&&(it=1),He=((He+it)*st-(ht*=st))*yt+ht,$e=(($e+it)*st-ht)*yt+ht,at=(at*st-(rt*=st))*yt+rt,mt=(mt*st-rt)*yt+rt,[[He,mt,0],[$e,mt,0],[$e,at,0],[He,at,0]]}(n,e,s._pixelsPerMercatorPixel,N,V);for(let ze=0;ze<y.length;ze++)Kc(y[ze],Ae[ze],Ee);const Ze=dt([],Ae[Y],Ae[(Y+1)%4]);Sr(Ze,Ze,.5),Kc(be,Ze,Ee)}for(const Ae of y)Gr(A,A,Ae),Rr(T,T,Ae);return A[2]=Math.min(ie[2],_e[2]),Gr(A,A,be),Rr(T,T,be),new Lr(A,T)}function Av({x:s,y:e,z:n},c=!1){const u=1/(1<<n),p=new z(ne(s*u),e===(1<<n)-1&&c?-90:ee((e+1)*u)),m=new z(ne((s+1)*u),e===0&&c?90:ee(e*u));return new M(p,m)}function zb(s,e=po){const n=Nr(s.getNorth()),c=Nr(s.getSouth()),u=Math.cos(n),p=Math.cos(c),m=Math.sin(n),y=Math.sin(c),b=s.getWest(),T=s.getEast();return[S(p,y,b,e),S(p,y,T,e),S(u,m,T,e),S(u,m,b,e)]}function E_(s,e,n,c){const u=1<<n.z,p=(s/xt+n.x)/u;return I(ee((e/xt+n.y)/u),ne(p),c)}function Cv({min:s,max:e}){return l/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const QI=new Float64Array(16);function Pv(s){const e=Cv(s),n=bt(QI,[e,e,e]);return de(n,n,Vn([],s.min))}function Fb(s){const e=(c=s.min,(n=QI)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=c[0],n[13]=c[1],n[14]=c[2],n[15]=1,n);var n,c;const u=1/Cv(s);return Oe(e,e,[u,u,u])}function Bb(s){const e=xt/(2*Math.PI);return s/(2*Math.PI)/e}function eA(s,e){return xt/(512*Math.pow(2,s))*Cv(uc(e))}function tA(s,e,n,c,u){const p=Bb(n),m=[s,e,-n/(2*Math.PI)],y=me(new Float64Array(16));return de(y,y,m),Oe(y,y,[p,p,p]),Xe(y,y,Nr(-u)),qe(y,y,Nr(-c)),y}function rh(s){return le(d,r,s)}function rA(s,e){const n=I(e.lat,e.lng),c=function(L){const N=I(L._center.lat,L._center.lng);let V=Qi([],Qt(0,1,0),N);const G=Bt([],-L.angle,N);V=bi(V,V,G),Bt(G,-L._pitch,V);const X=Hr([],N);return Sr(X,X,Iv(L.cameraToCenterDistance/L.pixelsPerMeter)),bi(X,X,G),dt([],N,X)}(s);return m=(u=It([],c,n))[0],y=u[1],b=u[2],T=(p=n)[0],A=p[1],C=p[2],D=(P=Math.sqrt((m*m+y*y+b*b)*(T*T+A*A+C*C)))&&Pi(u,p)/P,Math.acos(Math.min(Math.max(D,-1),1));var u,p,m,y,b,T,A,C,P,D}function Nb(s,e){return rA(s,e)>Math.PI/2*1.01}const iA=Nr(85),CB=Math.cos(iA),PB=Math.sin(iA),RB=we(),nA=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function sA(s,e,n,c,u,p,m,y,b){if(p&&s.queryGeometry.isAboveHorizon)return!1;p&&(b*=s.pixelToTileUnitsFactor);const T=s.tileID.canonical,A=n.projection.upVectorScale(T,n.center.lat,n.worldSize).metersToTile;for(const C of e)for(const P of C){const D=P.add(y),L=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(D.x,D.y,!0):0,N=n.projection.projectTilePoint(D.x,D.y,T);if(L>0){const Y=n.projection.upVector(T,D.x,D.y);N.x+=Y[0]*A*L,N.y+=Y[1]*A*L,N.z+=Y[2]*A*L}const V=p?D:kB(N.x,N.y,N.z,c),G=p?s.tilespaceRays.map(Y=>OB(Y,L)):s.queryGeometry.screenGeometry,X=Nt([],[N.x,N.y,N.z,1],c);if(!m&&p?b*=X[3]/n.cameraToCenterDistance:m&&!p&&(b*=n.cameraToCenterDistance/X[3]),p){const Y=ee((P.y/xt+T.y)/(1<<T.z));b/=n.projection.pixelsPerMeter(Y,1)/K(1,Y)}if(un(G,V,b))return!0}return!1}function kB(s,e,n,c){const u=Nt([],[s,e,n,1],c);return new nt(u[0]/u[3],u[1]/u[3])}const oA=Qt(0,0,0),MB=Qt(0,0,1);function OB(s,e){const n=Mt();return oA[2]=e,s.intersectsPlane(oA,MB,n),new nt(n[0],n[1])}class aA extends on{}let lA,cA,uA,hA;function dA(s,{width:e,height:n},c,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*c)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*c);return s.width=e,s.height=n,s.data=u,s}function fA(s,e,n){const{width:c,height:u}=e;c===s.width&&u===s.height||(jb(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,c),height:Math.min(s.height,u)},n,null),s.width=c,s.height=u,s.data=e.data)}function jb(s,e,n,c,u,p,m,y){if(u.width===0||u.height===0)return e;if(u.width>s.width||u.height>s.height||n.x>s.width-u.width||n.y>s.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||c.x>e.width-u.width||c.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,T=e.data,A=p===4&&y;for(let C=0;C<u.height;C++){const P=((n.y+C)*s.width+n.x)*p,D=((c.y+C)*e.width+c.x)*p;if(A)for(let L=0;L<u.width;L++){const N=P+L*p+3,V=D+L*p;T[V+0]=255,T[V+1]=255,T[V+2]=255,T[V+3]=b[N]}else if(m)for(let L=0;L<u.width;L++){const N=P+L*p,V=D+L*p,G=new yi(b[N+0]/255,b[N+1]/255,b[N+2]/255,b[N+3]).toNonPremultipliedRenderColor(m).toArray();T[V+0]=G[0],T[V+1]=G[1],T[V+2]=G[2],T[V+3]=G[3]}else for(let L=0;L<u.width*p;L++)T[D+L]=b[P+L]}return e}zt(aA,"HeatmapBucket",{omit:["layers"]});class ih{constructor(e,n){dA(this,e,1,n)}resize(e){fA(this,new ih(e),1)}clone(){return new ih({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,u,p){jb(e,n,c,u,p,1,null)}}class Ds{constructor(e,n){dA(this,e,4,n)}resize(e){fA(this,new Ds(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,c,u,p,m,y){jb(e,n,c,u,p,4,m,y)}}class pA{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function I_(s){const e={},n=s.resolution||256,c=s.clips?s.clips.length:1,u=s.image||new Ds({width:n,height:c}),p=(m,y,b)=>{e[s.evaluationKey]=b;const T=s.expression.evaluate(e),A=T?T.toNonPremultipliedRenderColor(null):null;A&&(u.data[m+y+0]=Math.floor(255*A.r),u.data[m+y+1]=Math.floor(255*A.g),u.data[m+y+2]=Math.floor(255*A.b),u.data[m+y+3]=Math.floor(255*A.a))};if(s.clips)for(let m=0,y=0;m<c;++m,y+=4*n)for(let b=0,T=0;b<n;b++,T+=4){const A=b/(n-1),{start:C,end:P}=s.clips[m];p(y,T,C*(1-A)+P*A)}else for(let m=0,y=0;m<n;m++,y+=4)p(0,y,m/(n-1));return u}zt(ih,"AlphaImage"),zt(Ds,"RGBAImage");const DB=Vr([{name:"a_pos",components:2,type:"Int16"}],4),LB=Vr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),zB=Vr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),FB=Vr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function kp(s,e,n=2){const c=e&&e.length,u=c?e[0]*n:s.length;let p=mA(s,0,u,n,!0);const m=[];if(!p||p.next===p.prev)return m;let y,b,T;if(c&&(p=function(A,C,P,D){const L=[];for(let N=0,V=C.length;N<V;N++){const G=mA(A,C[N]*D,N<V-1?C[N+1]*D:A.length,D,!1);G===G.next&&(G.steiner=!0),L.push(HB(G))}L.sort(UB);for(let N=0;N<L.length;N++)P=$B(L[N],P);return P}(s,e,p,n)),s.length>80*n){y=s[0],b=s[1];let A=y,C=b;for(let P=n;P<u;P+=n){const D=s[P],L=s[P+1];D<y&&(y=D),L<b&&(b=L),D>A&&(A=D),L>C&&(C=L)}T=Math.max(A-y,C-b),T=T!==0?32767/T:0}return A_(p,m,n,y,b,T,0),m}function mA(s,e,n,c,u){let p;if(u===function(m,y,b,T){let A=0;for(let C=y,P=b-T;C<b;C+=T)A+=(m[P]-m[C])*(m[C+1]+m[P+1]),P=C;return A}(s,e,n,c)>0)for(let m=e;m<n;m+=c)p=vA(m/c|0,s[m],s[m+1],p);else for(let m=n-c;m>=e;m-=c)p=vA(m/c|0,s[m],s[m+1],p);return p&&Mp(p,p.next)&&(R_(p),p=p.next),p}function Vd(s,e){if(!s)return s;e||(e=s);let n,c=s;do if(n=!1,c.steiner||!Mp(c,c.next)&&us(c.prev,c,c.next)!==0)c=c.next;else{if(R_(c),c=e=c.prev,c===c.next)break;n=!0}while(n||c!==e);return e}function A_(s,e,n,c,u,p,m){if(!s)return;!m&&p&&function(b,T,A,C){let P=b;do P.z===0&&(P.z=Vb(P.x,P.y,T,A,C)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==b);P.prevZ.nextZ=null,P.prevZ=null,function(D){let L,N=1;do{let V,G=D;D=null;let X=null;for(L=0;G;){L++;let Y=G,ie=0;for(let ue=0;ue<N&&(ie++,Y=Y.nextZ,Y);ue++);let _e=N;for(;ie>0||_e>0&&Y;)ie!==0&&(_e===0||!Y||G.z<=Y.z)?(V=G,G=G.nextZ,ie--):(V=Y,Y=Y.nextZ,_e--),X?X.nextZ=V:D=V,V.prevZ=X,X=V;G=Y}X.nextZ=null,N*=2}while(L>1)}(P)}(s,c,u,p);let y=s;for(;s.prev!==s.next;){const b=s.prev,T=s.next;if(p?NB(s,c,u,p):BB(s))e.push(b.i,s.i,T.i),R_(s),s=T.next,y=T.next;else if((s=T)===y){m?m===1?A_(s=jB(Vd(s),e),e,n,c,u,p,2):m===2&&VB(s,e,n,c,u,p):A_(Vd(s),e,n,c,u,p,1);break}}}function BB(s){const e=s.prev,n=s,c=s.next;if(us(e,n,c)>=0)return!1;const u=e.x,p=n.x,m=c.x,y=e.y,b=n.y,T=c.y,A=Math.min(u,p,m),C=Math.min(y,b,T),P=Math.max(u,p,m),D=Math.max(y,b,T);let L=c.next;for(;L!==e;){if(L.x>=A&&L.x<=P&&L.y>=C&&L.y<=D&&C_(u,y,p,b,m,T,L.x,L.y)&&us(L.prev,L,L.next)>=0)return!1;L=L.next}return!0}function NB(s,e,n,c){const u=s.prev,p=s,m=s.next;if(us(u,p,m)>=0)return!1;const y=u.x,b=p.x,T=m.x,A=u.y,C=p.y,P=m.y,D=Math.min(y,b,T),L=Math.min(A,C,P),N=Math.max(y,b,T),V=Math.max(A,C,P),G=Vb(D,L,e,n,c),X=Vb(N,V,e,n,c);let Y=s.prevZ,ie=s.nextZ;for(;Y&&Y.z>=G&&ie&&ie.z<=X;){if(Y.x>=D&&Y.x<=N&&Y.y>=L&&Y.y<=V&&Y!==u&&Y!==m&&C_(y,A,b,C,T,P,Y.x,Y.y)&&us(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,ie.x>=D&&ie.x<=N&&ie.y>=L&&ie.y<=V&&ie!==u&&ie!==m&&C_(y,A,b,C,T,P,ie.x,ie.y)&&us(ie.prev,ie,ie.next)>=0))return!1;ie=ie.nextZ}for(;Y&&Y.z>=G;){if(Y.x>=D&&Y.x<=N&&Y.y>=L&&Y.y<=V&&Y!==u&&Y!==m&&C_(y,A,b,C,T,P,Y.x,Y.y)&&us(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;ie&&ie.z<=X;){if(ie.x>=D&&ie.x<=N&&ie.y>=L&&ie.y<=V&&ie!==u&&ie!==m&&C_(y,A,b,C,T,P,ie.x,ie.y)&&us(ie.prev,ie,ie.next)>=0)return!1;ie=ie.nextZ}return!0}function jB(s,e){let n=s;do{const c=n.prev,u=n.next.next;!Mp(c,u)&&_A(c,n,n.next,u)&&P_(c,u)&&P_(u,c)&&(e.push(c.i,n.i,u.i),R_(n),R_(n.next),n=s=u),n=n.next}while(n!==s);return Vd(n)}function VB(s,e,n,c,u,p){let m=s;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&qB(m,y)){let b=yA(m,y);return m=Vd(m,m.next),b=Vd(b,b.next),A_(m,e,n,c,u,p,0),void A_(b,e,n,c,u,p,0)}y=y.next}m=m.next}while(m!==s)}function UB(s,e){let n=s.x-e.x;return n===0&&(n=s.y-e.y,n===0)&&(n=(s.next.y-s.y)/(s.next.x-s.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function $B(s,e){const n=function(u,p){let m=p;const y=u.x,b=u.y;let T,A=-1/0;if(Mp(u,m))return m;do{if(Mp(u,m.next))return m.next;if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){const N=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(N<=y&&N>A&&(A=N,T=m.x<m.next.x?m:m.next,N===y))return T}m=m.next}while(m!==p);if(!T)return null;const C=T,P=T.x,D=T.y;let L=1/0;m=T;do{if(y>=m.x&&m.x>=P&&y!==m.x&&gA(b<D?y:A,b,P,D,b<D?A:y,b,m.x,m.y)){const N=Math.abs(b-m.y)/(y-m.x);P_(m,u)&&(N<L||N===L&&(m.x>T.x||m.x===T.x&&GB(T,m)))&&(T=m,L=N)}m=m.next}while(m!==C);return T}(s,e);if(!n)return e;const c=yA(n,s);return Vd(c,c.next),Vd(n,n.next)}function GB(s,e){return us(s.prev,s,e.prev)<0&&us(e.next,s,s.next)<0}function Vb(s,e,n,c,u){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-n)*u|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-c)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function HB(s){let e=s,n=s;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==s);return n}function gA(s,e,n,c,u,p,m,y){return(u-m)*(e-y)>=(s-m)*(p-y)&&(s-m)*(c-y)>=(n-m)*(e-y)&&(n-m)*(p-y)>=(u-m)*(c-y)}function C_(s,e,n,c,u,p,m,y){return!(s===m&&e===y)&&gA(s,e,n,c,u,p,m,y)}function qB(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(n,c){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==c.i&&u.next.i!==c.i&&_A(u,u.next,n,c))return!0;u=u.next}while(u!==n);return!1}(s,e)&&(P_(s,e)&&P_(e,s)&&function(n,c){let u=n,p=!1;const m=(n.x+c.x)/2,y=(n.y+c.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&m<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==n);return p}(s,e)&&(us(s.prev,s,e.prev)||us(s,e.prev,e))||Mp(s,e)&&us(s.prev,s,s.next)>0&&us(e.prev,e,e.next)>0)}function us(s,e,n){return(e.y-s.y)*(n.x-e.x)-(e.x-s.x)*(n.y-e.y)}function Mp(s,e){return s.x===e.x&&s.y===e.y}function _A(s,e,n,c){const u=kv(us(s,e,n)),p=kv(us(s,e,c)),m=kv(us(n,c,s)),y=kv(us(n,c,e));return u!==p&&m!==y||!(u!==0||!Rv(s,n,e))||!(p!==0||!Rv(s,c,e))||!(m!==0||!Rv(n,s,c))||!(y!==0||!Rv(n,e,c))}function Rv(s,e,n){return e.x<=Math.max(s.x,n.x)&&e.x>=Math.min(s.x,n.x)&&e.y<=Math.max(s.y,n.y)&&e.y>=Math.min(s.y,n.y)}function kv(s){return s>0?1:s<0?-1:0}function P_(s,e){return us(s.prev,s,s.next)<0?us(s,e,s.next)>=0&&us(s,s.prev,e)>=0:us(s,e,s.prev)<0||us(s,s.next,e)<0}function yA(s,e){const n=Ub(s.i,s.x,s.y),c=Ub(e.i,e.x,e.y),u=s.next,p=e.prev;return s.next=e,e.prev=s,n.next=u,u.prev=n,c.next=n,n.prev=c,p.next=c,c.prev=p,c}function vA(s,e,n,c){const u=Ub(s,e,n);return c?(u.next=c.next,u.prev=c,c.next.prev=u,c.next=u):(u.prev=u,u.next=u),u}function R_(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ub(s,e,n){return{i:s,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function k_(s,e){const n=s.length;if(n<=1)return[s];const c=[];let u,p;for(let m=0;m<n;m++){const y=jr(s[m]);y!==0&&(s[m].area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(u&&c.push(u),u=[s[m]]):u.push(s[m]))}if(u&&c.push(u),e>1)for(let m=0;m<c.length;m++)c[m].length<=e||(yl(c[m],e,1,c[m].length-1,WB),c[m]=c[m].slice(0,e));return c}function WB(s,e){return e.area-s.area}function xA(s,e,n=1){if(!s)return null;const c=typeof s=="string"?ho.from(s).getPrimary():s.getPrimary(),u=typeof s=="string"?null:s.getSecondary();for(const p of[c,u]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(n),e.get(m).push(p)}return{primary:c.toString(),secondary:u?u.toString():null}}function $b(s,e,n,c){const u=c.patternDependencies;let p=!1;for(const m of e){const y=m.paint.get(`${s}-pattern`);y.isConstant()||(p=!0),xA(y.constantOr(null),u,n)&&(p=!0)}return p}function Gb(s,e,n,c,u,p){const m=p.patternDependencies;for(const y of e){const b=y.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:c},n,{},p.availableImages);T=T&&T.name?T.name:T;const A=xA(T,m,u);if(!A)continue;const{primary:C,secondary:P}=A;C&&(n.patterns[y.id]=[C,P].filter(Boolean))}}return n}class wA{constructor(){this.polygons=new Map}add(e,...n){const c=this.polygons.get(e);c?c.push(...n):this.polygons.set(e,n)}merge(e){for(const[n,c]of e.polygons)this.add(n,...c)}}class Yc{constructor(){this.portals=[]}static isOnBorder(e,n){return e<=0&&n<=0||e>=xt&&n>=xt}static evaluate(e){if(e.length===0)return new Yc;let n=[];for(const b of e)n.push(...b.portals);if(n.length===0)return new Yc;for(const b of n){const T=b.va,A=b.vb;(Yc.isOnBorder(T.x,A.x)||Yc.isOnBorder(T.y,A.y))&&(b.type="border")}const c=n.filter(b=>b.type!=="unevaluated"),u=n.filter(b=>b.type==="unevaluated");if(u.length===0)return new Yc;u.sort((b,T)=>b.hash===T.hash?b.isTunnel===T.isTunnel?0:b.isTunnel?-1:1:b.hash<T.hash?1:-1),n=c.concat(u);let p=c.length,m=p,y=p;do if(m++,m===n.length||n[p].hash!==n[m].hash){if(m-p==2){y<p&&(n[y]=n[p],n[p]=null);const b=n[y],T=n[m-1];b.type=b.isTunnel!==T.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:T.connection.a},y++}p=m}while(p!==n.length);return n.splice(y),n.sort((b,T)=>b.hash<T.hash?1:-1),{portals:n}}}zt(Yc,"ElevationPortalGraph"),zt(wA,"ElevationPolygons");class ZB{constructor(e,n,c){this.outPositions=e,this.outNormals=n,this.outIndices=c,this.vertexLookup=new Map}addVertex(e,n,c){let u=e[2];c!=null&&(u*=c);const p=`${e[0]},${e[1]},${e[2]},${n[0]},${n[1]},${n[2]}`,m=this.vertexLookup.get(p);if(m!=null)return m;const y=this.outPositions.length;this.vertexLookup.set(p,y);const b=Math.trunc(16384*n[0]),T=Math.trunc(16384*n[1]),A=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,T,A),y}addTriangle(e,n,c){this.outIndices.emplaceBack(e,n,c)}addTriangles(e,n,c){if(e.length===0)return;const u=c.length===1,p=Mt(),m=Mt();for(let y=0;y<e.length;y+=3){const b=n[e[y+0]],T=n[e[y+1]],A=n[e[y+2]],C=u?c[0]:c[e[y+1]],P=u?c[0]:c[e[y+2]];er(p,b.x,b.y,u?c[0]:c[e[y+0]]);const D=this.addVertex(p,m);er(p,T.x,T.y,C);const L=this.addVertex(p,m);er(p,A.x,A.y,P);const N=this.addVertex(p,m);this.outIndices.emplaceBack(D,L,N)}}addQuad(e,n,c,u,p,m){const y=this.addVertex(e,p,m),b=this.addVertex(n,p,m),T=this.addVertex(c,p,m),A=this.addVertex(u,p,m);this.addTriangle(y,b,T),this.addTriangle(T,A,y)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Wo{constructor(e,n,c,u){this.unevaluatedPortals=new Yc,this.portalPolygons=new wA,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new a_,this.vertexNormals=new l_,this.indexArray=new rn,this.tileToMeters=xe(e),this.bridgeProgramConfigurations=new Da(n,{zoom:c,lut:u},p=>p!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Da(n,{zoom:c,lut:u},p=>p!=="fill-bridge-guard-rail-color")}addVertices(e,n){const c=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(n[u]);return c}addTriangles(e,n,c){const u=c?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)u.push(p+n)}addRenderableRing(e,n,c,u,p,m){const y=[new nt(p.min.x,p.min.y),new nt(p.max.x,p.min.y),new nt(p.max.x,p.max.y),new nt(p.min.x,p.max.y)];for(let b=0;b<c-1;b++){const T=n+b,A=T+1,C=this.unevalVertices[T],P=this.unevalVertices[A];if(!(C.x>=p.min.x&&C.x<=p.max.x&&C.y>=p.min.y&&C.y<=p.max.y||P.x>=p.min.x&&P.x<=p.max.x&&P.y>=p.min.y&&P.y<=p.max.y||In(C,P,y))||this.isOnBorder(C.x,P.x)||this.isOnBorder(C.y,P.y))continue;const D=Wo.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[A]);let L,N=this.vertexHashLookup.get(Wo.computePosHash(C));N!=null?L=N.next:(N=this.vertexHashLookup.get(Wo.computePosHash(P)),L=N!=null?N.prev:D),this.unevalEdges.push({polygonIdx:e,a:T,b:A,hash:D,portalHash:L,isTunnel:u,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,n,c,u,p){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:p});const m=n[0];this.vertexHashLookup.clear();let y=Wo.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let b=0;b<m.length-1;b++){const T=m[b+0],A=m[b+1],C=aa(A.x-T.x,A.y-T.y),P=tn(C);if(P===0)continue;let D="unevaluated";const L=u.pointElevation(T),N=u.pointElevation(A);Math.abs(L)<.01&&Math.abs(N)<.01?D="entrance":(this.isOnBorder(T.x,A.x)||this.isOnBorder(T.y,A.y))&&(D="border");const V=Wo.computeEdgeHash(T,A);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:A,vab:C,length:P,hash:V,isTunnel:c,type:D});const G=Wo.computePosHash(T);this.vertexHashLookup.set(G,{prev:y,next:V}),y=V}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),c=P=>{P.primitiveLength=this.indexArray.length-P.primitiveOffset},u=new ZB(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=n(),m=n(),y=n(),b=(P,D)=>{P.sort((N,V)=>N.type===D&&V.type!==D?-1:N.type!==D&&V.type===D?1:0);const L=P.findIndex(N=>N.type!==D);return L>=0?L:P.length};let T=0;this.unevalEdges.length>0&&(T=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),c(y);const A=n(),C=n();if(this.unevalEdges.length>0){const P=this.unevalEdges.splice(T),D=b(P,"tunnel")+T;this.unevalEdges.push(...P),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:D})}c(A),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),c(C),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),c(m),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),c(p),this.maskSegments=cn.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=cn.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=cn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableTunnelSegments=cn.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=cn.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,n,c,u,p,m,y,b){this.bridgeProgramConfigurations.updatePaintArrays(e,n,p,c,u,m,y,b),this.tunnelProgramConfigurations.updatePaintArrays(e,n,p,c,u,m,y,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,zB.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,FB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,n,c,u,p){const m=(y,b)=>{for(let T=0;T<b.length-1;T++){const A=b[T].featureIndex,C=b[T+1].vertexStart,P=e.feature(A);y.populatePaintArrays(C,P,A,{},c,n,u,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,n,c,u,p){const m=new Map;for(let y=u;y<p;y++){const b=c[y],T=b.a,A=b.b,C=Wo.computePosHash(e[T]),P=Wo.computePosHash(e[A]);let D=m.get(C);D||(D={},m.set(C,D));let L=m.get(P);L||(L={},m.set(P,L)),n[T]<=0&&n[A]<=0||(D.to=A,L.from=T)}return m}isTerminalVertex(e,n){const c=Wo.computePosHash(this.unevalVertices[e]),u=n.get(c);return!u||!u.from||!u.to}constructBridgeStructures(e,n,c,u,p,m){e.clearVertexLookup();const y=this.computeVertexConnections(n,c,u,p.min,p.max),b=1/m,T=.5*b,A=(yt,ht)=>er(yt,n[ht].x,n[ht].y,c[ht]*b),C=Mt(),P=Mt(),D=Mt(),L=Mt(),N=Mt(),V=(yt,ht)=>{const rt=y.get(Wo.computePosHash(n[ht])),ut=rt.from,He=rt.to;if(!ut||!He)return;A(C,ut),A(P,ht),A(D,He),Qn(L),Ss(C,P)||(Gi(N,P,C),Hr(L,N)),Ss(D,P)||(Gi(N,D,P),dt(L,L,Hr(N,N)));const $e=Ve(L);return $e>0?Sr(yt,L,1/$e):void 0};let G=Number.POSITIVE_INFINITY;this.sortSubarray(u,p.min,p.max,(yt,ht)=>yt.featureInfo.featureIndex-ht.featureInfo.featureIndex);const X=Mt(),Y=Mt(),ie=Mt(),_e=Mt(),ue=Mt(),be=Mt(),Ee=Mt(),Ae=Mt(),Ze=Mt(),ze=[Mt(),Mt(),Mt(),Mt()],Ke=[Mt(),Mt(),Mt(),Mt()],tt=[{coord:new nt(0,0),height:0},{coord:new nt(0,0),height:0}],st=(yt,ht)=>yt>ht;for(let yt=p.min;yt<p.max;yt++){const ht=u[yt];if(!ht.featureInfo.guardRailEnabled||!this.prepareEdgePoints(tt,n,c,ht,st))continue;const[rt,ut]=tt;if(er(X,rt.coord.x,rt.coord.y,b*rt.height),er(Y,ut.coord.x,ut.coord.y,b*ut.height),Ss(X,Y))continue;Gi(ie,Y,X),Hr(ie,ie);const He=V(Ae,ht.a)||ie,$e=V(Ze,ht.b)||ie;er(_e,He[1],-He[0],0),Hr(_e,_e),er(ue,$e[1],-$e[0],0),Hr(ue,ue),Qi(Ae,_e,He),Hr(be,Ae),Qi(Ae,ue,$e),Hr(Ee,Ae),dt(ze[0],X,Sr(Ae,Gi(Ae,_e,be),T)),dt(ze[1],X,Sr(Ae,dt(Ae,_e,be),T)),dt(ze[2],X,Sr(Ae,be,T)),ze[3]=X,dt(Ke[0],Y,Sr(Ae,Gi(Ae,ue,Ee),T)),dt(Ke[1],Y,Sr(Ae,dt(Ae,ue,Ee),T)),dt(Ke[2],Y,Sr(Ae,Ee,T)),Ke[3]=Y,G=this.addFeatureSection(ht.featureInfo.featureIndex,G,this.bridgeFeatureSections,e);const at=e.addVertex(ze[0],_e,m),mt=e.addVertex(ze[1],_e,m),it=e.addVertex(Ke[0],ue,m),Lt=e.addVertex(Ke[1],ue,m);e.addTriangle(at,mt,it),e.addTriangle(mt,Lt,it);const Vt=e.addVertex(ze[1],be,m),kt=e.addVertex(ze[2],be,m),St=e.addVertex(Ke[1],Ee,m),wr=e.addVertex(Ke[2],Ee,m);e.addTriangle(Vt,kt,St),e.addTriangle(kt,wr,St),Vn(_e,_e),Vn(ue,ue);const At=e.addVertex(ze[2],_e,m),ir=e.addVertex(ze[3],_e,m),Er=e.addVertex(Ke[2],ue,m),Fr=e.addVertex(Ke[3],ue,m);e.addTriangle(At,ir,Er),e.addTriangle(ir,Fr,Er);const ii=this.isTerminalVertex(ht.a,y),Ar=this.isTerminalVertex(ht.b,y);rt.height<.01&&ii&&e.addQuad(ze[3],ze[2],ze[1],ze[0],Vn(He,He),m),ut.height<.01&&Ar&&e.addQuad(Ke[0],Ke[1],Ke[2],Ke[3],$e,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,n,c,u,p,m){e.clearVertexLookup();let y=Number.POSITIVE_INFINITY;const b=(G,X)=>G.featureInfo.featureIndex-X.featureInfo.featureIndex;this.sortSubarray(u,p.min,p.max,b),this.sortSubarray(u,m.min,m.max,b);const T=G=>Hr(G,G),A=[{coord:new nt(0,0),height:0},{coord:new nt(0,0),height:0}],C=(G,X)=>G<X,P=Mt(),D=Mt(),L=Mt(),N=Mt(),V=Mt();for(let G=p.min;G<p.max;G++){if(!this.prepareEdgePoints(A,n,c,u[G],C))continue;const[X,Y]=A,ie=T(er(V,-(Y.coord.y-X.coord.y),Y.coord.x-X.coord.x,0));y=this.addFeatureSection(u[G].featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(er(P,X.coord.x,X.coord.y,X.height),er(D,Y.coord.x,Y.coord.y,Y.height),er(L,Y.coord.x,Y.coord.y,u[G].isTunnel?-.1:0),er(N,X.coord.x,X.coord.y,u[G].isTunnel?-.1:0),ie)}for(let G=m.min;G<m.max;G++){const X=u[G];X.isTunnel&&([X.a,X.b]=[X.b,X.a]);const Y=n[X.a],ie=n[X.b],_e=T(er(V,-(ie.y-Y.y),ie.x-Y.x,0));y=this.addFeatureSection(X.featureInfo.featureIndex,y,this.tunnelFeatureSections,e),e.addQuad(er(P,ie.x,ie.y,0),er(D,Y.x,Y.y,0),er(L,Y.x,Y.y,c[X.a]+4),er(N,ie.x,ie.y,c[X.b]+4),_e),e.addQuad(er(P,Y.x,Y.y,0),er(D,ie.x,ie.y,0),er(L,ie.x,ie.y,c[X.b]+4),er(N,Y.x,Y.y,c[X.a]+4),_e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,n,c,u){e.coord.x=n,e.coord.y=c,e.height=u}prepareEdgePoints(e,n,c,u,p){let m=n[u.a].x,y=n[u.a].y,b=n[u.b].x,T=n[u.b].y,A=c[u.a],C=c[u.b];const P=p(A,0),D=p(C,0);if(P&&D)return this.setElevatedPoint(e[0],m,y,A),this.setElevatedPoint(e[1],b,T,C),!0;if(!P&&!D)return!1;if(P){if(!D){const L=C/(C-A);b=pr(b,m,L),T=pr(T,y,L),C=pr(C,A,L)}}else{const L=A/(A-C);m=pr(m,b,L),y=pr(y,T,L),A=pr(A,C,L)}return this.setElevatedPoint(e[0],m,y,A),this.setElevatedPoint(e[1],b,T,C),!0}prepareEdges(e,n){if(n.length===0)return;n.sort((y,b)=>y.hash===b.hash?b.polygonIdx-y.polygonIdx:b.hash>y.hash?1:-1);let c=0,u=0,p=0,m=n[c].polygonIdx;do u++,(u===n.length||n[c].hash!==n[u].hash)&&((u-c==1||n[u-1].polygonIdx!==m)&&(p<c&&(n[p]=n[c],n[c]=null),n[p].type="none",p++),c=u,c!==n.length&&(m=n[c].polygonIdx));while(c!==n.length);if(n.splice(p),n.length!==0&&e.length!==0){n.sort((T,A)=>T.portalHash<A.portalHash?1:-1);let y=0,b=0;for(;y!==n.length&&b!==e.length;){const T=n[y],A=e[b];T.portalHash>A.hash?y++:A.hash>T.portalHash?b++:(T.type=A.type,y++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=xt&&n>=xt}addFeatureSection(e,n,c,u){return e!==n&&(n=e,c.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),n}sortSubarray(e,n,c,u){const p=e.slice(n,c);p.sort(u),e.splice(n,p.length,...p)}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(Wo.computePosHash(e))<<32n|BigInt(Wo.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var bA,TA={exports:{}},SA=(bA||(bA=1,function(s,e){(function(n){function c(he,ae){return he>ae?1:he<ae?-1:0}var u=function(he,ae){he===void 0&&(he=c),ae===void 0&&(ae=!1),this._compare=he,this._root=null,this._size=0,this._noDuplicates=!!ae},p={size:{configurable:!0}};function m(he,ae,Ye,Tt,Je){var Et=Je-Tt;if(Et>0){var Kt=Tt+Math.floor(Et/2),Wt={key:ae[Kt],data:Ye[Kt],parent:he};return Wt.left=m(Wt,ae,Ye,Tt,Kt),Wt.right=m(Wt,ae,Ye,Kt+1,Je),Wt}return null}function y(he,ae,Ye,Tt,Je){if(!(Ye>=Tt)){for(var Et=he[Ye+Tt>>1],Kt=Ye-1,Wt=Tt+1;;){do Kt++;while(Je(he[Kt],Et)<0);do Wt--;while(Je(he[Wt],Et)>0);if(Kt>=Wt)break;var Cr=he[Kt];he[Kt]=he[Wt],he[Wt]=Cr,Cr=ae[Kt],ae[Kt]=ae[Wt],ae[Wt]=Cr}y(he,ae,Ye,Wt,Je),y(he,ae,Wt+1,Tt,Je)}}u.prototype.rotateLeft=function(he){var ae=he.right;ae&&(he.right=ae.left,ae.left&&(ae.left.parent=he),ae.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ae:he.parent.right=ae:this._root=ae,ae&&(ae.left=he),he.parent=ae},u.prototype.rotateRight=function(he){var ae=he.left;ae&&(he.left=ae.right,ae.right&&(ae.right.parent=he),ae.parent=he.parent),he.parent?he===he.parent.left?he.parent.left=ae:he.parent.right=ae:this._root=ae,ae&&(ae.right=he),he.parent=ae},u.prototype._splay=function(he){for(;he.parent;){var ae=he.parent;ae.parent?ae.left===he&&ae.parent.left===ae?(this.rotateRight(ae.parent),this.rotateRight(ae)):ae.right===he&&ae.parent.right===ae?(this.rotateLeft(ae.parent),this.rotateLeft(ae)):ae.left===he&&ae.parent.right===ae?(this.rotateRight(ae),this.rotateLeft(ae)):(this.rotateLeft(ae),this.rotateRight(ae)):ae.left===he?this.rotateRight(ae):this.rotateLeft(ae)}},u.prototype.splay=function(he){for(var ae,Ye,Tt,Je,Et;he.parent;)(Ye=(ae=he.parent).parent)&&Ye.parent?((Tt=Ye.parent).left===Ye?Tt.left=he:Tt.right=he,he.parent=Tt):(he.parent=null,this._root=he),Je=he.left,Et=he.right,he===ae.left?(Ye&&(Ye.left===ae?(ae.right?(Ye.left=ae.right,Ye.left.parent=Ye):Ye.left=null,ae.right=Ye,Ye.parent=ae):(Je?(Ye.right=Je,Je.parent=Ye):Ye.right=null,he.left=Ye,Ye.parent=he)),Et?(ae.left=Et,Et.parent=ae):ae.left=null,he.right=ae,ae.parent=he):(Ye&&(Ye.right===ae?(ae.left?(Ye.right=ae.left,Ye.right.parent=Ye):Ye.right=null,ae.left=Ye,Ye.parent=ae):(Et?(Ye.left=Et,Et.parent=Ye):Ye.left=null,he.right=Ye,Ye.parent=he)),Je?(ae.right=Je,Je.parent=ae):ae.right=null,he.left=ae,ae.parent=he)},u.prototype.replace=function(he,ae){he.parent?he===he.parent.left?he.parent.left=ae:he.parent.right=ae:this._root=ae,ae&&(ae.parent=he.parent)},u.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},u.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},u.prototype.insert=function(he,ae){var Ye=this._root,Tt=null,Je=this._compare;if(this._noDuplicates)for(;Ye;){if(Tt=Ye,Je(Ye.key,he)===0)return;Ye=Je(Ye.key,he)<0?Ye.right:Ye.left}else for(;Ye;)Tt=Ye,Ye=Je(Ye.key,he)<0?Ye.right:Ye.left;return Ye={key:he,data:ae,left:null,right:null,parent:Tt},Tt?Je(Tt.key,Ye.key)<0?Tt.right=Ye:Tt.left=Ye:this._root=Ye,this.splay(Ye),this._size++,Ye},u.prototype.find=function(he){for(var ae=this._root,Ye=this._compare;ae;){var Tt=Ye(ae.key,he);if(Tt<0)ae=ae.right;else{if(!(Tt>0))return ae;ae=ae.left}}return null},u.prototype.contains=function(he){for(var ae=this._root,Ye=this._compare;ae;){var Tt=Ye(he,ae.key);if(Tt===0)return!0;ae=Tt<0?ae.left:ae.right}return!1},u.prototype.remove=function(he){var ae=this.find(he);if(!ae)return!1;if(this.splay(ae),ae.left)if(ae.right){var Ye=this.minNode(ae.right);Ye.parent!==ae&&(this.replace(Ye,Ye.right),Ye.right=ae.right,Ye.right.parent=Ye),this.replace(ae,Ye),Ye.left=ae.left,Ye.left.parent=Ye}else this.replace(ae,ae.left);else this.replace(ae,ae.right);return this._size--,!0},u.prototype.removeNode=function(he){if(!he)return!1;if(this.splay(he),he.left)if(he.right){var ae=this.minNode(he.right);ae.parent!==he&&(this.replace(ae,ae.right),ae.right=he.right,ae.right.parent=ae),this.replace(he,ae),ae.left=he.left,ae.left.parent=ae}else this.replace(he,he.left);else this.replace(he,he.right);return this._size--,!0},u.prototype.erase=function(he){var ae=this.find(he);if(ae){this.splay(ae);var Ye=ae.left,Tt=ae.right,Je=null;Ye&&(Ye.parent=null,Je=this.maxNode(Ye),this.splay(Je),this._root=Je),Tt&&(Ye?Je.right=Tt:this._root=Tt,Tt.parent=Je),this._size--}},u.prototype.pop=function(){var he=this._root,ae=null;if(he){for(;he.left;)he=he.left;ae={key:he.key,data:he.data},this.remove(he.key)}return ae},u.prototype.next=function(he){var ae=he;if(ae)if(ae.right)for(ae=ae.right;ae&&ae.left;)ae=ae.left;else for(ae=he.parent;ae&&ae.right===he;)he=ae,ae=ae.parent;return ae},u.prototype.prev=function(he){var ae=he;if(ae)if(ae.left)for(ae=ae.left;ae&&ae.right;)ae=ae.right;else for(ae=he.parent;ae&&ae.left===he;)he=ae,ae=ae.parent;return ae},u.prototype.forEach=function(he){for(var ae=this._root,Ye=[],Tt=!1,Je=0;!Tt;)ae?(Ye.push(ae),ae=ae.left):Ye.length>0?(he(ae=Ye.pop(),Je++),ae=ae.right):Tt=!0;return this},u.prototype.range=function(he,ae,Ye,Tt){for(var Je=[],Et=this._compare,Kt=this._root;Je.length!==0||Kt;)if(Kt)Je.push(Kt),Kt=Kt.left;else{if(Et((Kt=Je.pop()).key,ae)>0)break;if(Et(Kt.key,he)>=0&&Ye.call(Tt,Kt))return this;Kt=Kt.right}return this},u.prototype.keys=function(){for(var he=this._root,ae=[],Ye=[],Tt=!1;!Tt;)he?(ae.push(he),he=he.left):ae.length>0?(he=ae.pop(),Ye.push(he.key),he=he.right):Tt=!0;return Ye},u.prototype.values=function(){for(var he=this._root,ae=[],Ye=[],Tt=!1;!Tt;)he?(ae.push(he),he=he.left):ae.length>0?(he=ae.pop(),Ye.push(he.data),he=he.right):Tt=!0;return Ye},u.prototype.at=function(he){for(var ae=this._root,Ye=[],Tt=!1,Je=0;!Tt;)if(ae)Ye.push(ae),ae=ae.left;else if(Ye.length>0){if(ae=Ye.pop(),Je===he)return ae;Je++,ae=ae.right}else Tt=!0;return null},u.prototype.load=function(he,ae,Ye){if(he===void 0&&(he=[]),ae===void 0&&(ae=[]),Ye===void 0&&(Ye=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Tt=he.length;return Ye&&y(he,ae,0,Tt-1,this._compare),this._root=m(null,he,ae,0,Tt),this._size=Tt,this},u.prototype.min=function(){var he=this.minNode(this._root);return he?he.key:null},u.prototype.max=function(){var he=this.maxNode(this._root);return he?he.key:null},u.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},u.createTree=function(he,ae,Ye,Tt,Je){return new u(Ye,Je).load(he,ae,Tt)},Object.defineProperties(u.prototype,p);var b=0,T=1,A=2,C=3,P=0,D=1,L=2,N=3;function V(he,ae,Ye){ae===null?(he.inOut=!1,he.otherInOut=!0):(he.isSubject===ae.isSubject?(he.inOut=!ae.inOut,he.otherInOut=ae.otherInOut):(he.inOut=!ae.otherInOut,he.otherInOut=ae.isVertical()?!ae.inOut:ae.inOut),ae&&(he.prevInResult=!G(ae,Ye)||ae.isVertical()?ae.prevInResult:ae));var Tt=G(he,Ye);he.resultTransition=Tt?function(Je,Et){var Kt,Wt=!Je.inOut,Cr=!Je.otherInOut;switch(Et){case P:Kt=Wt&&Cr;break;case D:Kt=Wt||Cr;break;case N:Kt=Wt^Cr;break;case L:Kt=Je.isSubject?Wt&&!Cr:Cr&&!Wt}return Kt?1:-1}(he,Ye):0}function G(he,ae){switch(he.type){case b:switch(ae){case P:return!he.otherInOut;case D:return he.otherInOut;case L:return he.isSubject&&he.otherInOut||!he.isSubject&&!he.otherInOut;case N:return!0}break;case A:return ae===P||ae===D;case C:return ae===L;case T:return!1}return!1}var X=function(he,ae,Ye,Tt,Je){this.left=ae,this.point=he,this.otherEvent=Ye,this.isSubject=Tt,this.type=Je||b,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Y={inResult:{configurable:!0}};function ie(he,ae){return he[0]===ae[0]&&he[1]===ae[1]}X.prototype.isBelow=function(he){var ae=this.point,Ye=this.otherEvent.point;return this.left?(ae[0]-he[0])*(Ye[1]-he[1])-(Ye[0]-he[0])*(ae[1]-he[1])>0:(Ye[0]-he[0])*(ae[1]-he[1])-(ae[0]-he[0])*(Ye[1]-he[1])>0},X.prototype.isAbove=function(he){return!this.isBelow(he)},X.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Y.inResult.get=function(){return this.resultTransition!==0},X.prototype.clone=function(){var he=new X(this.point,this.left,this.otherEvent,this.isSubject,this.type);return he.contourId=this.contourId,he.resultTransition=this.resultTransition,he.prevInResult=this.prevInResult,he.isExteriorRing=this.isExteriorRing,he.inOut=this.inOut,he.otherInOut=this.otherInOut,he},Object.defineProperties(X.prototype,Y);var _e=11102230246251565e-32,ue=134217729,be=(3+8*_e)*_e;function Ee(he,ae,Ye,Tt,Je){var Et,Kt,Wt,Cr,hr=ae[0],Ht=Tt[0],ai=0,ki=0;Ht>hr==Ht>-hr?(Et=hr,hr=ae[++ai]):(Et=Ht,Ht=Tt[++ki]);var fr=0;if(ai<he&&ki<Ye)for(Ht>hr==Ht>-hr?(Wt=Et-((Kt=hr+Et)-hr),hr=ae[++ai]):(Wt=Et-((Kt=Ht+Et)-Ht),Ht=Tt[++ki]),Et=Kt,Wt!==0&&(Je[fr++]=Wt);ai<he&&ki<Ye;)Ht>hr==Ht>-hr?(Wt=Et-((Kt=Et+hr)-(Cr=Kt-Et))+(hr-Cr),hr=ae[++ai]):(Wt=Et-((Kt=Et+Ht)-(Cr=Kt-Et))+(Ht-Cr),Ht=Tt[++ki]),Et=Kt,Wt!==0&&(Je[fr++]=Wt);for(;ai<he;)Wt=Et-((Kt=Et+hr)-(Cr=Kt-Et))+(hr-Cr),hr=ae[++ai],Et=Kt,Wt!==0&&(Je[fr++]=Wt);for(;ki<Ye;)Wt=Et-((Kt=Et+Ht)-(Cr=Kt-Et))+(Ht-Cr),Ht=Tt[++ki],Et=Kt,Wt!==0&&(Je[fr++]=Wt);return Et===0&&fr!==0||(Je[fr++]=Et),fr}function Ae(he){return new Float64Array(he)}var Ze=33306690738754716e-32,ze=22204460492503146e-32,Ke=11093356479670487e-47,tt=Ae(4),st=Ae(8),yt=Ae(12),ht=Ae(16),rt=Ae(4);function ut(he,ae,Ye){var Tt=function(Je,Et,Kt,Wt,Cr,hr){var Ht=(Et-hr)*(Kt-Cr),ai=(Je-Cr)*(Wt-hr),ki=Ht-ai;if(Ht===0||ai===0||Ht>0!=ai>0)return ki;var fr=Math.abs(Ht+ai);return Math.abs(ki)>=Ze*fr?ki:-function(ei,Mi,vi,pn,Xi,Bi,Ii){var ui,Pr,hi,Ni,dr,ni,Ki,wn,kn,$n,Yi,Nn,Eo,jn,Xo,Ls,za,Io,Ko=ei-Xi,zs=vi-Xi,Yo=Mi-Bi,Fa=pn-Bi;tt[0]=(Xo=(wn=Ko-(Ki=(ni=ue*Ko)-(ni-Ko)))*($n=Fa-(kn=(ni=ue*Fa)-(ni-Fa)))-((jn=Ko*Fa)-Ki*kn-wn*kn-Ki*$n))-((Yi=Xo-(za=(wn=Yo-(Ki=(ni=ue*Yo)-(ni-Yo)))*($n=zs-(kn=(ni=ue*zs)-(ni-zs)))-((Ls=Yo*zs)-Ki*kn-wn*kn-Ki*$n)))+(dr=Xo-Yi))+(dr-za),tt[1]=(Eo=jn-((Nn=jn+Yi)-(dr=Nn-jn))+(Yi-dr))-((Yi=Eo-Ls)+(dr=Eo-Yi))+(dr-Ls),tt[2]=Nn-((Io=Nn+Yi)-(dr=Io-Nn))+(Yi-dr),tt[3]=Io;var xs=function(ch,pc){for(var xx=pc[0],Yp=1;Yp<4;Yp++)xx+=pc[Yp];return xx}(0,tt),so=ze*Ii;if(xs>=so||-xs>=so||(ui=ei-(Ko+(dr=ei-Ko))+(dr-Xi),hi=vi-(zs+(dr=vi-zs))+(dr-Xi),Pr=Mi-(Yo+(dr=Mi-Yo))+(dr-Bi),Ni=pn-(Fa+(dr=pn-Fa))+(dr-Bi),ui===0&&Pr===0&&hi===0&&Ni===0)||(so=Ke*Ii+be*Math.abs(xs),(xs+=Ko*Ni+Fa*ui-(Yo*hi+zs*Pr))>=so||-xs>=so))return xs;rt[0]=(Xo=(wn=ui-(Ki=(ni=ue*ui)-(ni-ui)))*($n=Fa-(kn=(ni=ue*Fa)-(ni-Fa)))-((jn=ui*Fa)-Ki*kn-wn*kn-Ki*$n))-((Yi=Xo-(za=(wn=Pr-(Ki=(ni=ue*Pr)-(ni-Pr)))*($n=zs-(kn=(ni=ue*zs)-(ni-zs)))-((Ls=Pr*zs)-Ki*kn-wn*kn-Ki*$n)))+(dr=Xo-Yi))+(dr-za),rt[1]=(Eo=jn-((Nn=jn+Yi)-(dr=Nn-jn))+(Yi-dr))-((Yi=Eo-Ls)+(dr=Eo-Yi))+(dr-Ls),rt[2]=Nn-((Io=Nn+Yi)-(dr=Io-Nn))+(Yi-dr),rt[3]=Io;var fc=Ee(4,tt,4,rt,st);rt[0]=(Xo=(wn=Ko-(Ki=(ni=ue*Ko)-(ni-Ko)))*($n=Ni-(kn=(ni=ue*Ni)-(ni-Ni)))-((jn=Ko*Ni)-Ki*kn-wn*kn-Ki*$n))-((Yi=Xo-(za=(wn=Yo-(Ki=(ni=ue*Yo)-(ni-Yo)))*($n=hi-(kn=(ni=ue*hi)-(ni-hi)))-((Ls=Yo*hi)-Ki*kn-wn*kn-Ki*$n)))+(dr=Xo-Yi))+(dr-za),rt[1]=(Eo=jn-((Nn=jn+Yi)-(dr=Nn-jn))+(Yi-dr))-((Yi=Eo-Ls)+(dr=Eo-Yi))+(dr-Ls),rt[2]=Nn-((Io=Nn+Yi)-(dr=Io-Nn))+(Yi-dr),rt[3]=Io;var lh=Ee(fc,st,4,rt,yt);rt[0]=(Xo=(wn=ui-(Ki=(ni=ue*ui)-(ni-ui)))*($n=Ni-(kn=(ni=ue*Ni)-(ni-Ni)))-((jn=ui*Ni)-Ki*kn-wn*kn-Ki*$n))-((Yi=Xo-(za=(wn=Pr-(Ki=(ni=ue*Pr)-(ni-Pr)))*($n=hi-(kn=(ni=ue*hi)-(ni-hi)))-((Ls=Pr*hi)-Ki*kn-wn*kn-Ki*$n)))+(dr=Xo-Yi))+(dr-za),rt[1]=(Eo=jn-((Nn=jn+Yi)-(dr=Nn-jn))+(Yi-dr))-((Yi=Eo-Ls)+(dr=Eo-Yi))+(dr-Ls),rt[2]=Nn-((Io=Nn+Yi)-(dr=Io-Nn))+(Yi-dr),rt[3]=Io;var Kp=Ee(lh,yt,4,rt,ht);return ht[Kp-1]}(Je,Et,Kt,Wt,Cr,hr,fr)}(he[0],he[1],ae[0],ae[1],Ye[0],Ye[1]);return Tt>0?-1:Tt<0?1:0}function He(he,ae){var Ye=he.point,Tt=ae.point;return Ye[0]>Tt[0]?1:Ye[0]<Tt[0]?-1:Ye[1]!==Tt[1]?Ye[1]>Tt[1]?1:-1:function(Je,Et,Kt,Wt){return Je.left!==Et.left?Je.left?1:-1:ut(Kt,Je.otherEvent.point,Et.otherEvent.point)!==0?Je.isBelow(Et.otherEvent.point)?-1:1:!Je.isSubject&&Et.isSubject?1:-1}(he,ae,Ye)}function $e(he,ae,Ye){var Tt=new X(ae,!1,he,he.isSubject),Je=new X(ae,!0,he.otherEvent,he.isSubject);return ie(he.point,he.otherEvent.point)&&console.warn("what is that, a collapsed segment?",he),Tt.contourId=Je.contourId=he.contourId,He(Je,he.otherEvent)>0&&(he.otherEvent.left=!0,Je.left=!1),he.otherEvent.otherEvent=Je,he.otherEvent=Tt,Ye.push(Je),Ye.push(Tt),Ye}function at(he,ae){return he[0]*ae[1]-he[1]*ae[0]}function mt(he,ae){return he[0]*ae[0]+he[1]*ae[1]}function it(he,ae,Ye){var Tt=function(Cr,hr,Ht,ai,ki){var fr=[hr[0]-Cr[0],hr[1]-Cr[1]],ei=[ai[0]-Ht[0],ai[1]-Ht[1]];function Mi(ni,Ki,wn){return[ni[0]+Ki*wn[0],ni[1]+Ki*wn[1]]}var vi=[Ht[0]-Cr[0],Ht[1]-Cr[1]],pn=at(fr,ei),Xi=pn*pn,Bi=mt(fr,fr);if(Xi>0){var Ii=at(vi,ei)/pn;if(Ii<0||Ii>1)return null;var ui=at(vi,fr)/pn;return ui<0||ui>1?null:Ii===0||Ii===1?[Mi(Cr,Ii,fr)]:ui===0||ui===1?[Mi(Ht,ui,ei)]:[Mi(Cr,Ii,fr)]}if((Xi=(pn=at(vi,fr))*pn)>0)return null;var Pr=mt(fr,vi)/Bi,hi=Pr+mt(fr,ei)/Bi,Ni=Math.min(Pr,hi),dr=Math.max(Pr,hi);return Ni<=1&&dr>=0?Ni===1?[Mi(Cr,Ni>0?Ni:0,fr)]:dr===0?[Mi(Cr,dr<1?dr:1,fr)]:[Mi(Cr,Ni>0?Ni:0,fr),Mi(Cr,dr<1?dr:1,fr)]:null}(he.point,he.otherEvent.point,ae.point,ae.otherEvent.point),Je=Tt?Tt.length:0;if(Je===0||Je===1&&(ie(he.point,ae.point)||ie(he.otherEvent.point,ae.otherEvent.point))||Je===2&&he.isSubject===ae.isSubject)return 0;if(Je===1)return ie(he.point,Tt[0])||ie(he.otherEvent.point,Tt[0])||$e(he,Tt[0],Ye),ie(ae.point,Tt[0])||ie(ae.otherEvent.point,Tt[0])||$e(ae,Tt[0],Ye),1;var Et=[],Kt=!1,Wt=!1;return ie(he.point,ae.point)?Kt=!0:He(he,ae)===1?Et.push(ae,he):Et.push(he,ae),ie(he.otherEvent.point,ae.otherEvent.point)?Wt=!0:He(he.otherEvent,ae.otherEvent)===1?Et.push(ae.otherEvent,he.otherEvent):Et.push(he.otherEvent,ae.otherEvent),Kt&&Wt||Kt?(ae.type=T,he.type=ae.inOut===he.inOut?A:C,Kt&&!Wt&&$e(Et[1].otherEvent,Et[0].point,Ye),2):Wt?($e(Et[0],Et[1].point,Ye),3):Et[0]!==Et[3].otherEvent?($e(Et[0],Et[1].point,Ye),$e(Et[1],Et[2].point,Ye),3):($e(Et[0],Et[1].point,Ye),$e(Et[3].otherEvent,Et[2].point,Ye),3)}function Lt(he,ae){if(he===ae)return 0;if(ut(he.point,he.otherEvent.point,ae.point)!==0||ut(he.point,he.otherEvent.point,ae.otherEvent.point)!==0)return ie(he.point,ae.point)?he.isBelow(ae.otherEvent.point)?-1:1:he.point[0]===ae.point[0]?he.point[1]<ae.point[1]?-1:1:He(he,ae)===1?ae.isAbove(he.point)?-1:1:he.isBelow(ae.point)?-1:1;if(he.isSubject!==ae.isSubject)return he.isSubject?-1:1;var Ye=he.point,Tt=ae.point;return Ye[0]===Tt[0]&&Ye[1]===Tt[1]?(Ye=he.otherEvent.point)[0]===(Tt=ae.otherEvent.point)[0]&&Ye[1]===Tt[1]?0:he.contourId>ae.contourId?1:-1:He(he,ae)===1?1:-1}var Vt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function kt(he,ae,Ye,Tt){var Je,Et=he+1,Kt=ae[he].point,Wt=ae.length;for(Et<Wt&&(Je=ae[Et].point);Et<Wt&&Je[0]===Kt[0]&&Je[1]===Kt[1];){if(!Ye[Et])return Et;++Et<Wt&&(Je=ae[Et].point)}for(Et=he-1;Ye[Et]&&Et>Tt;)Et--;return Et}Vt.prototype.isExterior=function(){return this.holeOf==null};var St=At,wr=At;function At(he,ae){if(!(this instanceof At))return new At(he,ae);if(this.data=he||[],this.length=this.data.length,this.compare=ae||ir,this.length>0)for(var Ye=(this.length>>1)-1;Ye>=0;Ye--)this._down(Ye)}function ir(he,ae){return he<ae?-1:he>ae?1:0}At.prototype={push:function(he){this.data.push(he),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var he=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),he}},peek:function(){return this.data[0]},_up:function(he){for(var ae=this.data,Ye=this.compare,Tt=ae[he];he>0;){var Je=he-1>>1,Et=ae[Je];if(Ye(Tt,Et)>=0)break;ae[he]=Et,he=Je}ae[he]=Tt},_down:function(he){for(var ae=this.data,Ye=this.compare,Tt=this.length>>1,Je=ae[he];he<Tt;){var Et=1+(he<<1),Kt=Et+1,Wt=ae[Et];if(Kt<this.length&&Ye(ae[Kt],Wt)<0&&(Et=Kt,Wt=ae[Kt]),Ye(Wt,Je)>=0)break;ae[he]=Wt,he=Et}ae[he]=Je}},St.default=wr;var Er=Math.max,Fr=Math.min,ii=0;function Ar(he,ae,Ye,Tt,Je,Et){var Kt,Wt,Cr,hr,Ht,ai;for(Kt=0,Wt=he.length-1;Kt<Wt;Kt++)if(hr=he[Kt+1],Ht=new X(Cr=he[Kt],!1,void 0,ae),ai=new X(hr,!1,Ht,ae),Ht.otherEvent=ai,Cr[0]!==hr[0]||Cr[1]!==hr[1]){Ht.contourId=ai.contourId=Ye,Et||(Ht.isExteriorRing=!1,ai.isExteriorRing=!1),He(Ht,ai)>0?ai.left=!0:Ht.left=!0;var ki=Cr[0],fr=Cr[1];Je[0]=Fr(Je[0],ki),Je[1]=Fr(Je[1],fr),Je[2]=Er(Je[2],ki),Je[3]=Er(Je[3],fr),Tt.push(Ht),Tt.push(ai)}}var li=[];function ci(he,ae,Ye){typeof he[0][0][0]=="number"&&(he=[he]),typeof ae[0][0][0]=="number"&&(ae=[ae]);var Tt=function(fr,ei,Mi){var vi=null;return fr.length*ei.length==0&&(Mi===P?vi=li:Mi===L?vi=fr:Mi!==D&&Mi!==N||(vi=fr.length===0?ei:fr)),vi}(he,ae,Ye);if(Tt)return Tt===li?null:Tt;var Je=[1/0,1/0,-1/0,-1/0],Et=[1/0,1/0,-1/0,-1/0],Kt=function(fr,ei,Mi,vi,pn){var Xi,Bi,Ii,ui,Pr,hi,Ni=new St(null,He);for(Ii=0,ui=fr.length;Ii<ui;Ii++)for(Pr=0,hi=(Xi=fr[Ii]).length;Pr<hi;Pr++)(Bi=Pr===0)&&ii++,Ar(Xi[Pr],!0,ii,Ni,Mi,Bi);for(Ii=0,ui=ei.length;Ii<ui;Ii++)for(Pr=0,hi=(Xi=ei[Ii]).length;Pr<hi;Pr++)Bi=Pr===0,pn===L&&(Bi=!1),Bi&&ii++,Ar(Xi[Pr],!1,ii,Ni,vi,Bi);return Ni}(he,ae,Je,Et,Ye);if(Tt=function(fr,ei,Mi,vi,pn){var Xi=null;return(Mi[0]>vi[2]||vi[0]>Mi[2]||Mi[1]>vi[3]||vi[1]>Mi[3])&&(pn===P?Xi=li:pn===L?Xi=fr:pn!==D&&pn!==N||(Xi=fr.concat(ei))),Xi}(he,ae,Je,Et,Ye))return Tt===li?null:Tt;for(var Wt=function(fr){var ei,Mi,vi=function(Ii){var ui,Pr,hi,Ni,dr=[];for(Pr=0,hi=Ii.length;Pr<hi;Pr++)((ui=Ii[Pr]).left&&ui.inResult||!ui.left&&ui.otherEvent.inResult)&&dr.push(ui);for(var ni=!1;!ni;)for(ni=!0,Pr=0,hi=dr.length;Pr<hi;Pr++)Pr+1<hi&&He(dr[Pr],dr[Pr+1])===1&&(Ni=dr[Pr],dr[Pr]=dr[Pr+1],dr[Pr+1]=Ni,ni=!1);for(Pr=0,hi=dr.length;Pr<hi;Pr++)(ui=dr[Pr]).otherPos=Pr;for(Pr=0,hi=dr.length;Pr<hi;Pr++)(ui=dr[Pr]).left||(Ni=ui.otherPos,ui.otherPos=ui.otherEvent.otherPos,ui.otherEvent.otherPos=Ni);return dr}(fr),pn={},Xi=[],Bi=function(){if(!pn[ei]){var Ii=Xi.length,ui=function(dr,ni,Ki){var wn=new Vt;if(dr.prevInResult!=null){var kn=dr.prevInResult,$n=kn.outputContourId;if(kn.resultTransition>0){var Yi=ni[$n];if(Yi.holeOf!=null){var Nn=Yi.holeOf;ni[Nn].holeIds.push(Ki),wn.holeOf=Nn,wn.depth=ni[$n].depth}else ni[$n].holeIds.push(Ki),wn.holeOf=$n,wn.depth=ni[$n].depth+1}else wn.holeOf=null,wn.depth=ni[$n].depth}else wn.holeOf=null,wn.depth=0;return wn}(vi[ei],Xi,Ii),Pr=function(dr){pn[dr]=!0,dr<vi.length&&vi[dr]&&(vi[dr].outputContourId=Ii)},hi=ei,Ni=ei;for(ui.points.push(vi[ei].point);Pr(hi),Pr(hi=vi[hi].otherPos),ui.points.push(vi[hi].point),!((hi=kt(hi,vi,pn,Ni))==Ni||hi>=vi.length)&&vi[hi];);Xi.push(ui)}};for(ei=0,Mi=vi.length;ei<Mi;ei++)Bi();return Xi}(function(fr,ei,Mi,vi,pn,Xi){for(var Bi,Ii,ui,Pr=new u(Lt),hi=[],Ni=Math.min(vi[2],pn[2]);fr.length!==0;){var dr=fr.pop();if(hi.push(dr),Xi===P&&dr.point[0]>Ni||Xi===L&&dr.point[0]>vi[2])break;if(dr.left){Ii=Bi=Pr.insert(dr),Bi=Bi!==(ui=Pr.minNode())?Pr.prev(Bi):null,Ii=Pr.next(Ii);var ni=Bi?Bi.key:null;if(V(dr,ni,Xi),Ii&&it(dr,Ii.key,fr)===2&&(V(dr,ni,Xi),V(Ii.key,dr,Xi)),Bi&&it(Bi.key,dr,fr)===2){var Ki=Bi;V(ni,(Ki=Ki!==ui?Pr.prev(Ki):null)?Ki.key:null,Xi),V(dr,ni,Xi)}}else Ii=Bi=Pr.find(dr=dr.otherEvent),Bi&&Ii&&(Bi=Bi!==ui?Pr.prev(Bi):null,Ii=Pr.next(Ii),Pr.remove(dr),Ii&&Bi&&it(Bi.key,Ii.key,fr))}return hi}(Kt,0,0,Je,Et,Ye)),Cr=[],hr=0;hr<Wt.length;hr++){var Ht=Wt[hr];if(Ht.isExterior()){for(var ai=[Ht.points],ki=0;ki<Ht.holeIds.length;ki++)ai.push(Wt[Ht.holeIds[ki]].points);Cr.push(ai)}}return Cr}var an={UNION:D,DIFFERENCE:L,INTERSECTION:P,XOR:N};n.diff=function(he,ae){return ci(he,ae,L)},n.intersection=function(he,ae){return ci(he,ae,P)},n.operations=an,n.union=function(he,ae){return ci(he,ae,D)},n.xor=function(he,ae){return ci(he,ae,N)},Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,TA.exports)),TA.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Mv(s,e,n,c){const u=[],p=c===0?(m,y,b,T,A,C)=>{m.push(new nt(C,b+(C-y)/(T-y)*(A-b)))}:(m,y,b,T,A,C)=>{m.push(new nt(y+(C-b)/(A-b)*(T-y),C))};for(const m of s){const y=[];for(const b of m){if(b.length<=2)continue;const T=[];for(let P=0;P<b.length-1;P++){const D=b[P].x,L=b[P].y,N=b[P+1].x,V=b[P+1].y,G=c===0?D:L,X=c===0?N:V;G<e?X>e&&p(T,D,L,N,V,e):G>n?X<n&&p(T,D,L,N,V,n):T.push(b[P]),X<e&&G>=e&&p(T,D,L,N,V,e),X>n&&G<=n&&p(T,D,L,N,V,n)}let A=b[b.length-1];const C=c===0?A.x:A.y;C>=e&&C<=n&&T.push(A),T.length&&(A=T[T.length-1],T[0].x===A.x&&T[0].y===A.y||T.push(T[0]),y.push(T))}y.length&&u.push(y)}return u}function XB(s,e){const n=Hb(s),c=Hb([e]),u=SA.intersection(n,c);return u==null?[]:EA(u)}function KB(s,e){let c=Hb(s,65536);const u=[];for(;e.valid();e.next()){const[p,m]=e.get(),y=p.x*65536,b=p.y*65536,T=m.x*65536,A=m.y*65536,C=T-y,P=A-b,D=Math.hypot(C,P);if(D===0)continue;const L=Math.trunc(P/D*3),N=-Math.trunc(C/D*3);u.push([[[y,b],[T,A],[T+L,A+N],[y+L,b+N],[y,b]]])}return u.length>0&&(c=SA.diff(c,u)),EA(c,1/65536)}function Hb(s,e=1){return[s.map(n=>n.map(c=>[c.x*e,c.y*e]))]}function EA(s,e=1){return s.map(n=>n.map((c,u)=>{const p=c.map(m=>new nt(m[0]*e,m[1]*e).round());return u>0&&p.reverse(),p}))}class qb{constructor(e,n){this.layoutVertexArray=new fo,this.indexArray=new rn,this.lineIndexArray=new _a,this.triangleSegments=new cn,this.lineSegments=new cn,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new bl)}update(e,n,c,u,p,m,y,b){this.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,DB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,LB.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,c,u,p,m,y){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,u,p,m,void 0,y)}}class Wb{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new qb(e,!1),this.elevationBufferData=new qb(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,u){}populate(e,n,c,u){this.hasPattern=$b("fill",this.layers,this.pixelRatio,n);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:T,sourceLayerIndex:A}of e){const C=this.layers[0]._featureFilter.needGeometry,P=je(y,C);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),P,c))continue;const D=p?p.evaluate(P,{},c,n.availableImages):void 0,L={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:T,geometry:C?P.geometry:et(y,c,u),patterns:{},sortKey:D};m.push(L)}p&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:T,sourceLayerIndex:A}=y;if(this.hasPattern){const C=Gb("fill",this.layers,y,this.zoom,this.pixelRatio,n);this.patternFeatures.push(C)}else this.addFeature(y,b,T,c,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[T].feature,b,T,A,this.index)}}update(e,n,c,u,p,m,y){this.bufferData.update(e,n,c,u,p,m,y,this.worldview),this.elevationBufferData.update(e,n,c,u,p,m,y,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,n,c,u,p,m,y,this.worldview)}addFeatures(e,n,c,u,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,c,u,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,c,u,p,m=[],y,b){const T=k_(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,u,c,b):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,c,p,m,u,y,this.worldview),this.elevationBufferData.populatePaintArrays(e,c,p,m,u,y,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,n,c,u,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(n,c,u,p,this.worldview))}addElevatedRoadFeature(e,n,c,u,p){const m=new Array,y=xr.getElevationFeature(e,p);if(!y)return void this.addGeometry(n,this.bufferData);{const T=this.clipPolygonsToTile(n,1);T.length>0&&m.push({polygons:T,elevationFeature:y,elevationTileID:c})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},c),featureIndex:u};for(const T of m)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Wo(T.elevationTileID,this.layers,this.zoom,this.lut));const C=T.elevationFeature.isTunnel();let P=0;e.properties.hasOwnProperty(Dt)&&(P=+e.properties[Dt]);for(const D of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,D,C,T.elevationFeature,P)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const A=new ri(c,T.elevationTileID);this.addElevatedGeometry(T.polygons,A,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,b)}}addElevatedGeometry(e,n,c,u,p,m){const y={elevation:c,elevationSampler:n,bias:u,index:p,featureInfo:m},[b,T]=this.addGeometry(e,this.elevationBufferData,y);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,n,c){let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;c&&(m=c.elevationSampler.constantElevation(c.elevation,c.bias),m!=null&&(u=m,p=m));const y=(b,T,A)=>{if(c!=null)if(T.push(b),m!=null)n.elevatedLayoutVertexArray.emplaceBack(m),A.push(m);else{const C=c.elevationSampler.pointElevation(b,c.elevation,c.bias);n.elevatedLayoutVertexArray.emplaceBack(C),A.push(C),u=Math.min(u,C),p=Math.max(p,C)}};for(const b of e){let T=0;for(const Y of b)T+=Y.length;const A=n.triangleSegments.prepareSegment(T,n.layoutVertexArray,n.indexArray),C=A.vertexLength,P=[],D=[],L=[],N=[],V=[],G=n.layoutVertexArray.length;for(const Y of b){if(Y.length===0)continue;Y!==b[0]&&D.push(P.length/2);const ie=n.lineSegments.prepareSegment(Y.length,n.layoutVertexArray,n.lineIndexArray),_e=ie.vertexLength;c&&V.push(n.layoutVertexArray.length-G),y(Y[0],L,N),n.layoutVertexArray.emplaceBack(Y[0].x,Y[0].y),n.lineIndexArray.emplaceBack(_e+Y.length-1,_e),P.push(Y[0].x),P.push(Y[0].y);for(let ue=1;ue<Y.length;ue++)y(Y[ue],L,N),n.layoutVertexArray.emplaceBack(Y[ue].x,Y[ue].y),n.lineIndexArray.emplaceBack(_e+ue-1,_e+ue),P.push(Y[ue].x),P.push(Y[ue].y);ie.vertexLength+=Y.length,ie.primitiveLength+=Y.length}const X=kp(P,D);for(let Y=0;Y<X.length;Y+=3)n.indexArray.emplaceBack(C+X[Y],C+X[Y+1],C+X[Y+2]);if(X.length>0&&c&&this.elevationMode==="hd-road-base"){const Y=c.elevation.isTunnel(),ie=c.elevation.safeArea,_e=this.elevatedStructures.addVertices(L,N);this.elevatedStructures.addTriangles(X,_e,Y);const ue=V.length;if(ue>0){for(let be=0;be<ue-1;be++)this.elevatedStructures.addRenderableRing(c.index,V[be]+_e,V[be+1]-V[be],Y,ie,c.featureInfo);this.elevatedStructures.addRenderableRing(c.index,V[ue-1]+_e,L.length-V[ue-1],Y,ie,c.featureInfo)}}A.vertexLength+=T,A.primitiveLength+=X.length/3}return[u,p]}prepareElevatedPolygons(e,n,c){const u=1/xe(c),p=[];for(const m of e){const y=KB(m,new $i(n,u));p.push(...y)}return p}clipPolygonsToTile(e,n){const c=-n,u=-n,p=xt+n,m=xt+n;let y=0;const b=[],T=[];for(;y<e.length;y++){const P=e[y],D=yd(P);(D.min.x>=c&&D.max.x<=p&&D.min.y>=u&&D.max.y<=m?b:T).push(P)}if(b.length===e.length)return e;const A=[new nt(c,u),new nt(p,u),new nt(p,m),new nt(c,m),new nt(c,u)],C=b;for(const P of T)C.push(...XB(P,A));return C}}let IA,AA,CA,PA;zt(Wb,"FillBucket",{omit:["layers","patternFeatures"]}),zt(qb,"FillBufferData"),zt(Wo,"ElevatedStructures");class Ov{constructor(e,n,c,u){if(this.triangleCount=n.length/3,this.min=new nt(0,0),this.max=new nt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const P=e[C];p.x=Math.min(p.x,P.x),p.y=Math.min(p.y,P.y),m.x=Math.max(m.x,P.x),m.y=Math.max(m.y,P.y)}if(u){const C=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/u);c=Math.max(c,C)}if(c===0)return;this.min=p,this.max=m;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const b=Math.max(y.x,y.y)/c;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;const T=[];for(let C=0;C<this.triangleCount;C++){const P=e[n[3*C+0]].sub(this.min),D=e[n[3*C+1]].sub(this.min),L=e[n[3*C+2]].sub(this.min),N=hc(Math.floor(Math.min(P.x,D.x,L.x)),this.xScale,this.cellsX),V=hc(Math.floor(Math.max(P.x,D.x,L.x)),this.xScale,this.cellsX),G=hc(Math.floor(Math.min(P.y,D.y,L.y)),this.yScale,this.cellsY),X=hc(Math.floor(Math.max(P.y,D.y,L.y)),this.yScale,this.cellsY),Y=new nt(0,0),ie=new nt(0,0),_e=new nt(0,0),ue=new nt(0,0);for(let be=G;be<=X;++be){Y.y=ie.y=be*b,_e.y=ue.y=(be+1)*b;for(let Ee=N;Ee<=V;++Ee)Y.x=_e.x=Ee*b,ie.x=ue.x=(Ee+1)*b,(Rn(P,D,L,Y,ie,ue)||Rn(P,D,L,Y,ue,_e))&&T.push({cellIdx:be*this.cellsX+Ee,triIdx:C})}}if(T.length===0)return;T.sort((C,P)=>C.cellIdx-P.cellIdx||C.triIdx-P.triIdx);let A=0;for(;A<T.length;){const C=T[A].cellIdx,P={start:this.payload.length,len:0};for(;A<T.length&&T[A].cellIdx===C;)++P.len,this.payload.push(T[A++].triIdx);this.cells[C]=P}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const c=hc(e.x-this.min.x,this.xScale,this.cellsX),u=hc(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+c];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const y=this.payload[p.start+m],b=Math.floor(y/8),T=1<<y%8;if(!(this.lookup[b]&T)&&(this.lookup[b]|=T,n.push(y),n.length===this.triangleCount))return}}}query(e,n,c){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const u=hc(e.x-this.min.x,this.xScale,this.cellsX),p=hc(n.x-this.min.x,this.xScale,this.cellsX),m=hc(e.y-this.min.y,this.yScale,this.cellsY),y=hc(n.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=y;b++)for(let T=u;T<=p;T++){const A=this.cells[b*this.cellsX+T];if(A)for(let C=0;C<A.len;C++){const P=this.payload[A.start+C],D=Math.floor(P/8),L=1<<P%8;if(!(this.lookup[D]&L)&&(this.lookup[D]|=L,c.push(P),c.length===this.triangleCount))return}}}}function hc(s,e,n){return Math.max(0,Math.min(n-1,Math.floor(s*e)))}zt(Ov,"TriangleGridIndex");class RA{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){for(const c of this.footprints)n.push({footprint:c,id:e})}updateAppearances(e,n,c,u){}populate(e,n,c,u){const p=[];for(const{feature:m,id:y,index:b,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,C=je(m,A);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),C,c))continue;const P={id:y,properties:m.properties,type:m.type,sourceLayerIndex:T,index:b,geometry:A?C.geometry:et(m,c,u),patterns:{}};p.push(P)}for(const m of p){const{geometry:y,index:b,sourceLayerIndex:T}=m;this.addFeature(m,y,b,c,{},n.availableImages,n.brightness),n.featureIndex.insert(e[b].feature,y,b,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,c,u,p,m,y){}destroy(){}addFeature(e,n,c,u,p,m=[],y){for(const b of k_(n,2)){const T=[],A=[],C=[],P=new nt(1/0,1/0),D=new nt(-1/0,-1/0);for(const V of b)if(V.length!==0){V!==b[0]&&C.push(A.length/2);for(let G=0;G<V.length;G++)A.push(V[G].x),A.push(V[G].y),T.push(V[G]),P.x=Math.min(P.x,V[G].x),P.y=Math.min(P.y,V[G].y),D.x=Math.max(D.x,V[G].x),D.y=Math.max(D.y,V[G].y)}const L=kp(A,C),N=new Ov(T,L,8,256);this.footprints.push({vertices:T,indices:L,grid:N,min:P,max:D})}}}zt(RA,"ClipBucket",{omit:["layers"]});const YB=Vr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),JB=Vr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),QB=Vr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),eN=Vr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),tN=Vr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),rN=Vr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),iN=Vr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:nN}=YB,M_=Number.MAX_SAFE_INTEGER,kA=M_-1;function MA(s,e,n,c){return s.order<e||s.order===M_||!(s.clipMask&n)||function(u,p){return p.length!==0&&p.find(m=>m===u)===void 0}(c,s.clipScope)}function Dv(s,e){return s.x-e.x||s.y-e.y}function OA(s,e){return Dv(s.min,e.min)===0&&Dv(s.max,e.max)===0}function Zb(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function Lv(s,e){if(s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(s[n].sourceId!==e[n].sourceId||!OA(s[n],e[n])||s[n].order!==e[n].order||s[n].clipMask!==e[n].clipMask||!ks(s[n].clipScope,e[n].clipScope))return!1;return!0}function DA(s,e,n){const c=1/xt,u=1/(1<<n.canonical.z),p=(e.x*c+n.canonical.x)*u+n.wrap,m=(e.y*c+n.canonical.y)*u;return{min:new nt((s.x*c+n.canonical.x)*u+n.wrap,(s.y*c+n.canonical.y)*u),max:new nt(p,m)}}function sN(s,e,n){const c=1<<n.canonical.z,u=((e.x-n.wrap)*c-n.canonical.x)*xt,p=(e.y*c-n.canonical.y)*xt;return{min:new nt(((s.x-n.wrap)*c-n.canonical.x)*xt,(s.y*c-n.canonical.y)*xt),max:new nt(u,p)}}function Xb(s,e,n,c,u,p,m){const y=s.indices,b=s.vertices,T=[];for(let A=c;A<c+u;A+=3){const C=e[n[A+0]+p],P=e[n[A+1]+p],D=e[n[A+2]+p],L=Math.min(C.x,P.x,D.x),N=Math.max(C.x,P.x,D.x),V=Math.min(C.y,P.y,D.y),G=Math.max(C.y,P.y,D.y);T.length=0,s.grid.query(new nt(L,V),new nt(N,G),T);for(let X=0;X<T.length;X++){const Y=T[X];if(Rn(b[y[3*Y+0]],b[y[3*Y+1]],b[y[3*Y+2]],C,P,D,m))return!0}}return!1}function LA(s,e,n,c){if(!s||!n)return!1;let u=s.vertices;if(!e.canonical.equals(c.canonical)||e.wrap!==c.wrap){if(n.vertices.length<s.vertices.length)return LA(n,c,s,e);const p=e.canonical,m=c.canonical,y=Math.pow(2,m.z-p.z);u=s.vertices.map(b=>new nt((b.x+p.x*xt)*y-m.x*xt,(b.y+p.y*xt)*y-m.y*xt))}return Xb(n,u,s.indices,0,s.indices.length,0,0)}function zA(s,e,n,c){const u=Math.pow(2,c.z-n.z);return new nt((s+n.x*xt)*u-c.x*xt,(e+n.y*xt)*u-c.y*xt)}function Kb(s,e){const n=[];e.grid.queryPoint(s,n);const c=e.indices,u=e.vertices;for(let p=0;p<n.length;p++){const m=n[p];if(ls([u[c[3*m+0]],u[c[3*m+1]],u[c[3*m+2]]],s))return!0}return!1}const Yb=[new nt(0,0),new nt(xt,0),new nt(xt,xt),new nt(0,xt)];function FA(s,e){const n=[];let c=[];if(!e||s.length<2)return[s];if(s.length===2)return In(s[0],s[1],Yb)?[s]:[];for(let u=0;u<s.length+2;u++){const p=s[u%s.length],m=s[(u+1)%s.length],y=In(u===0?s[s.length-1]:s[(u-1)%s.length],p,Yb),b=In(p,m,Yb),T=y||b;T&&c.push(p),T&&b||c.length>0&&(c.length>1&&n.push(c),c=[])}return c.length>1&&n.push(c),n}const Jb=ot.types,oN=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],aN=["fill-extrusion-flood-light-ground-radius"],lN=Math.pow(2,13),cN=Math.pow(2,15)-1,BA=new nt(0,1),nh=2147483648,NA=7,jA=450;function O_(s,e,n,c,u,p,m,y){s.emplaceBack((e<<1)+m,(n<<1)+p,(Math.floor(c*lN)<<1)+u,Math.round(y))}function D_(s,e,n){s.emplaceBack(e.x*xt,e.y*xt,n?1:0)}function zv(s,e,n,c,u,p){s.emplaceBack(e.x,e.y,(n.x<<1)+c,(n.y<<1)+u,p)}function L_(s,e,n){s.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class VA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class UA{constructor(){this.centroidXY=new nt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new nt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new nt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new nt(this.max.x-this.min.x,this.max.y-this.min.y)}}class $A{constructor(){this.acc=new nt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,c){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===xt)&&n.x===c.x)!=((n.y===0||n.y===xt)&&n.y===c.y)&&this.processBorderOverlap(n,c),u&&this.checkBorderIntersection(n,c)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,pr(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>xt!=e.x>xt&&this.addBorderIntersection(1,pr(n.y,e.y,(xt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,pr(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>xt!=e.y>xt&&this.addBorderIntersection(3,pr(n.x,e.x,(xt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[e];n<c[0]&&(c[0]=n),n>c[1]&&(c[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const c=e.x===0?0:1;this.addBorderIntersection(c,n.y),this.addBorderIntersection(c,e.y)}else{const c=e.y===0?2:3;this.addBorderIntersection(c,n.x),this.addBorderIntersection(c,e.x)}}centroid(){return this.accCount===0?new nt(0,0):new nt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function GA(s,e){const n=s.add(e)._unit(),c=W(s.x*n.x+s.y*n.y,-1,1);var u,p,m;return u=Math.acos(c),Math.min(4,Math.max(-4,Math.tan(u)))/4*cN*((p=s).x*(m=e).y-p.y*m.x<0?-1:1)}const uN=[s=>s.x<0,s=>s.x>xt,s=>s.y<0,s=>s.y>xt];function hN(s,e,n,c){const u=[4];if(c===0)return u;n._mult(c);const p=s.sub(n),m=e.sub(n),y=[s,e,p,m];for(let b=0;b<4;b++)for(const T of y)if(uN[b](T)){u.push(b);break}return u}class Qb{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new gp,this.indexArray=new rn,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut},n=>aN.includes(n)),this._segments=new cn,this.hiddenByLandmarkVertexArray=new Tp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new cn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,c,u=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const T=e[0],A=e[1];b=GA(T.sub(e[p-1])._perp()._unit(),A.sub(T)._perp()._unit())}for(let T=0;T<p;T++){const A=T===p-1?0:T+1,C=e[T],P=e[A],D=e[A===p-1?0:A+1],L=P.sub(C)._perp()._unit(),N=GA(L,D.sub(P)._perp()._unit()),V=b,G=N;if(eT(C,P,n)||u&&WA(C,n)&&WA(P,n)){b=N;continue}const X=y.vertexLength;zv(this.vertexArray,C,P,1,1,V),zv(this.vertexArray,C,P,1,0,V),zv(this.vertexArray,C,P,0,1,G),zv(this.vertexArray,C,P,0,0,G),y.vertexLength+=4;const Y=hN(C,P,L,c);for(const ie of Y)this._segmentToGroundQuads[m].push({id:X,region:ie}),this._segmentToRegionTriCounts[m][ie]+=2,y.primitiveLength+=2;b=N}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let c=0;c<n;c++)this._segmentToGroundQuads[c].sort((u,p)=>u.region-p.region);for(let c=0;c<n;c++){const u=this._segmentToGroundQuads[c],p=e[c],m=this._segmentToRegionTriCounts[c];m.reduce((b,T)=>b+T,0);let y=0;for(let b=0;b<=4;b++){const T=m[b];if(T!==0){let A=this.regionSegments[b];A||(A=this.regionSegments[b]=new cn);const C={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+y,vertexLength:p.vertexLength,primitiveLength:T};A.get().push(C)}y+=T}for(let b=0;b<u.length;b++){const T=u[b].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,c,u,p,m,y){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,c,u,p,m,void 0,y)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,JB.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,QB.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,c,u,p,m,y,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,c,u,p,m,y,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&nh))}updateHiddenByLandmarkRange(e,n,c){if(!this.hasData())return;const u=n+e;if(n!==0){for(let p=e;p<u;++p)this.hiddenByLandmarkVertexArray.emplace(p,c?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,rN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class Fv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new rn,this.footprintVertices=new fo,this.footprintSegments=[],this.layoutVertexArray=new qu,this.centroidVertexArray=new yv,this.wallVertexArray=new xv,this.indexArray=new rn,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut},n=>oN.includes(n)),this.segments=new cn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new Qb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,u){}populate(e,n,c,u){this.features=[],this.hasPattern=$b("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=xe(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:y,sourceLayerIndex:b}of e){const T=this.layers[0]._featureFilter.needGeometry,A=je(p,T);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),A,c))continue;const C={id:m,sourceLayerIndex:b,index:y,geometry:T?A.geometry:et(p,c,u),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length,D=Jb[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:Gb("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,n)});else if(this.wallMode)for(const L of C.geometry)for(const N of FA(L,D))this.addFeature(p.id,C,[N],y,c,{},n.availableImages,u,n.brightness);else this.addFeature(p.id,C,C.geometry,y,c,{},n.availableImages,u,n.brightness);n.featureIndex.insert(p,C.geometry,y,b,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,c,u,p,m){for(const{featureId:y,feature:b}of this.features){const T=Jb[b.type]==="Polygon",{geometry:A}=b;if(this.wallMode)for(const C of A)for(const P of FA(C,T))this.addFeature(y,b,[P],b.index,n,c,u,p,m);else this.addFeature(y,b,A,b.index,n,c,u,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,c,u,p,m,y){this.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,this.worldview),this.groundEffect.update(e,n,p,c,u,m,y,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nN),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,tN.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,iN.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,eN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,c,u,p,m,y,b,T){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,C=[new nt(0,0),new nt(xt,xt)],P=b.projection,D=P.name==="globe",L=this.wallMode||Jb[n.type]==="Polygon",N=new $A;N.centroidDataIndex=this.centroidData.length;const V=new UA;V.buildingId=e,n.properties&&n.properties.hasOwnProperty("building_id")&&(V.buildingId=n.properties.building_id);const G=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},p)<=0,X=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},p);let Y;if(V.height=X,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new yp),this.wallMode){if(D)return void or("Non zero fill-extrusion-line-width is not yet supported on globe.");if(c.length!==1)return;Y=function(ze){const Ke=ze[0].x===ze[ze.length-1].x&&ze[0].y===ze[ze.length-1].y;(function(kt){let St=0;const wr=kt.length;for(let At=0;At<wr;At++)St+=(kt[(At+1)%wr].x-kt[At].x)*(kt[(At+1)%wr].y+kt[At].y);return St>=0})(ze)||(ze=ze.reverse());const st={geometry:[],joinNormals:[],indices:[]},yt=[],ht=[],rt=[];let ut=ze.length;for(;ut>=2&&ze[ut-1].equals(ze[ut-2]);)ut--;if(ut<(Ke?3:2))return st;let He,$e,at,mt,it,Lt=0;for(;Lt<ut-1&&ze[Lt].equals(ze[Lt+1]);)Lt++;Ke&&(He=ze[ut-2],it=ze[Lt].sub(He)._unit()._perp());for(let kt=Lt;kt<ut;kt++){if(at=kt===ut-1?Ke?ze[Lt+1]:void 0:ze[kt+1],at&&ze[kt].equals(at))continue;it&&(mt=it),He&&($e=He),He=ze[kt],it=at?at.sub(He)._unit()._perp():mt,mt=mt||it;let St=mt.add(it);St.x===0&&St.y===0||St._unit();const wr=St.x*it.x+St.y*it.y,At=wr!==0?1/wr:1/0,ir=mt.x*it.y-mt.y*it.x>0;let Er="miter";const Fr=2;Er==="miter"&&At>Fr&&(Er="bevel"),Er==="bevel"&&(At>100&&(Er="flipbevel"),At<Fr&&(Er="miter"));const ii=(Ar,li,ci,an)=>{const he=new nt(Ar.x,Ar.y),ae=new nt(Ar.x,Ar.y);he.x+=li.x*an,he.y+=li.y*an,ae.x-=li.x*Math.max(ci,1),ae.y-=li.y*Math.max(ci,1),rt.push(li),yt.push(he),ht.push(ae)};if(Er==="miter")St._mult(At),ii(He,St,0,0);else if(Er==="flipbevel")St=it.mult(-1),ii(He,St,0,0),ii(He,St.mult(-1),0,0);else{const Ar=-Math.sqrt(At*At-1),li=ir?Ar:0,ci=ir?0:Ar;$e&&ii(He,mt,li,ci),at&&ii(He,it,li,ci)}}st.geometry=[...yt,...ht.reverse(),yt[0]],st.joinNormals=[...rt,...rt.reverse(),rt[rt.length-1]];const Vt=st.geometry.length-1;for(let kt=0;kt<Vt/2;kt++)if(kt+1<Vt/2){let St=kt,wr=kt+1,At=Vt-1-kt,ir=Vt-2-kt;St=St===0?Vt-1:St-1,wr=wr===0?Vt-1:wr-1,At=At===0?Vt-1:At-1,ir=ir===0?Vt-1:ir-1,st.indices.push(At),st.indices.push(wr),st.indices.push(St),st.indices.push(At),st.indices.push(ir),st.indices.push(wr)}return st}(c[0]),c=[Y.geometry]}const ie=(ze,Ke)=>ze<(Ke.length-1)/2||ze===Ke.length-1,_e=this.wallMode?[c]:k_(c,500);for(let ze=_e.length-1;ze>=0;ze--){const Ke=_e[ze];(Ke.length===0||(ue=Ke[0]).every(tt=>tt.x<=0)||ue.every(tt=>tt.x>=xt)||ue.every(tt=>tt.y<=0)||ue.every(tt=>tt.y>=xt))&&_e.splice(ze,1)}var ue;let be;if(D)be=YA(_e,C,p);else{be=[];for(const ze of _e)be.push({polygon:ze,bounds:C})}const Ee=L?this.edgeRadius:0,Ae=Ee>0&&this.zoom<17,Ze=(ze,Ke)=>{if(ze.length===0)return!1;const tt=ze[ze.length-1];return Ke.x===tt.x&&Ke.y===tt.y};for(const{polygon:ze,bounds:Ke}of be){let tt=0,st=0;for(const ut of ze)L&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),st+=L?ut.length-1:ut.length;const yt=this.segments.prepareSegment((L?5:4)*st,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const ht={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},rt=new VA;if(rt.vertexOffset=this.footprintVertices.length,rt.indexOffset=3*this.footprintIndices.length,rt.ringIndices=[],L){const ut=[],He=[];tt=yt.vertexLength;for(let at=0;at<ze.length;at++){const mt=ze[at];mt.length&&at!==0&&He.push(ut.length/2);const it=[];let Lt,Vt;Lt=mt[1].sub(mt[0])._perp()._unit(),rt.ringIndices.push(mt.length-1);for(let kt=1;kt<mt.length;kt++){const St=mt[kt],wr=mt[kt===mt.length-1?1:kt+1],At=St.clone();if(Ee){Vt=wr.sub(St)._perp()._unit();const ir=Lt.add(Vt)._unit(),Er=Ee*Math.min(4,1/(Lt.x*ir.x+Lt.y*ir.y));At.x+=Er*ir.x,At.y+=Er*ir.y,At.x=Math.round(At.x),At.y=Math.round(At.y),Lt=Vt}if(!G||Ee!==0&&!Ae||Ze(it,At)||it.push(At),O_(this.layoutVertexArray,At.x,At.y,0,0,1,1,0),this.wallMode){const ir=ie(kt,mt);D_(this.wallVertexArray,Y.joinNormals[kt],!ir)}yt.vertexLength++,this.footprintVertices.emplaceBack(St.x,St.y),ut.push(St.x,St.y),D&&L_(this.layoutVertexExtArray,P.projectTilePoint(At.x,At.y,p),P.upVector(p,At.x,At.y))}G&&(Ee===0||Ae)&&(it.length!==0&&Ze(it,it[0])&&it.pop(),this.groundEffect.addData(it,Ke,A))}const $e=this.wallMode?Y.indices:kp(ut,He);for(let at=0;at<$e.length;at+=3)this.footprintIndices.emplaceBack(rt.vertexOffset+$e[at+0],rt.vertexOffset+$e[at+1],rt.vertexOffset+$e[at+2]),this.indexArray.emplaceBack(tt+$e[at],tt+$e[at+2],tt+$e[at+1]),yt.primitiveLength++;rt.indexCount+=$e.length,rt.vertexCount+=this.footprintVertices.length-rt.vertexOffset}for(let ut=0;ut<ze.length;ut++){const He=ze[ut];N.startRing(V,He[0]);let $e=He.length>4&&ZA(He[He.length-2],He[0],He[1]),at=Ee?dN(He[He.length-2],He[0],He[1],Ee):0;const mt=[];let it,Lt,Vt;Lt=He[1].sub(He[0])._perp()._unit();let kt=!0;for(let St=1,wr=0;St<He.length;St++){let At=He[St-1],ir=He[St];const Er=He[St===He.length-1?1:St+1];if(N.appendEdge(V,ir,At),eT(ir,At,Ke)){Ee&&(Lt=Er.sub(ir)._perp()._unit(),kt=!kt);continue}const Fr=ir.sub(At)._perp(),ii=Fr.x/(Math.abs(Fr.x)+Math.abs(Fr.y)),Ar=Fr.y>0?1:0,li=At.dist(ir);if(wr+li>32768&&(wr=0),Ee){Vt=Er.sub(ir)._perp()._unit();let ae=qA(At,ir,Er,HA(Lt,Vt),Ee);isNaN(ae)&&(ae=0);const Ye=ir.sub(At)._unit();At=At.add(Ye.mult(at))._round(),ir=ir.add(Ye.mult(-ae))._round(),at=ae,Lt=Vt,G&&this.zoom>=17&&(Ze(mt,At)||mt.push(At),Ze(mt,ir)||mt.push(ir))}const ci=yt.vertexLength,an=He.length>4&&ZA(At,ir,Er);let he=XA(wr,$e,kt);if(O_(this.layoutVertexArray,At.x,At.y,ii,Ar,0,0,he),O_(this.layoutVertexArray,At.x,At.y,ii,Ar,0,1,he),this.wallMode){const ae=ie(St-1,He),Ye=Y.joinNormals[St-1];D_(this.wallVertexArray,Ye,ae),D_(this.wallVertexArray,Ye,ae)}if(wr+=li,he=XA(wr,an,!kt),$e=an,O_(this.layoutVertexArray,ir.x,ir.y,ii,Ar,0,0,he),O_(this.layoutVertexArray,ir.x,ir.y,ii,Ar,0,1,he),this.wallMode){const ae=ie(St,He),Ye=Y.joinNormals[St];D_(this.wallVertexArray,Ye,ae),D_(this.wallVertexArray,Ye,ae)}if(yt.vertexLength+=4,this.indexArray.emplaceBack(ci+0,ci+1,ci+2),this.indexArray.emplaceBack(ci+1,ci+3,ci+2),yt.primitiveLength+=2,Ee){const ae=tt+(St===1?He.length-2:St-2),Ye=St===1?tt:ae+1;if(this.indexArray.emplaceBack(ci+1,ae,ci+3),this.indexArray.emplaceBack(ae,Ye,ci+3),yt.primitiveLength+=2,it===void 0&&(it=ci),!eT(Er,He[St],Ke)){const Tt=St===He.length-1?it:yt.vertexLength;this.indexArray.emplaceBack(ci+2,ci+3,Tt),this.indexArray.emplaceBack(ci+3,Tt+1,Tt),this.indexArray.emplaceBack(ci+3,Ye,Tt+1),yt.primitiveLength+=3}kt=!kt}if(D){const ae=this.layoutVertexExtArray,Ye=P.projectTilePoint(At.x,At.y,p),Tt=P.projectTilePoint(ir.x,ir.y,p),Je=P.upVector(p,At.x,At.y),Et=P.upVector(p,ir.x,ir.y);L_(ae,Ye,Je),L_(ae,Ye,Je),L_(ae,Tt,Et),L_(ae,Tt,Et)}}L&&(tt+=He.length-1),G&&Ee&&this.zoom>=17&&(mt.length!==0&&Ze(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,Ke,A,Ee>0))}this.footprintSegments.push(rt),ht.triangleCount=this.indexArray.length-ht.triangleArrayOffset,this.polygonSegments.push(ht),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=N.borders?BA:this.encodeCentroid(N,V),this.centroidData.push(V),N.borders){this.featuresOnBorder.push(N);const ze=this.featuresOnBorder.length-1;for(let Ke=0;Ke<N.borders.length;Ke++)N.borders[Ke][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ke].push(ze)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,u,m,y,p,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,u,m,y,p,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,X)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,c)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[c].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],T=+(b.min.y+b.max.y>xt),A=2*T+(+(b.min.x+b.max.x>xt)^T);for(let C=0;C<b.polygonSegLen;C++){const P=b.polygonSegIdx+C;e.push({centroidIdx:y,subtile:A,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const n=new rn;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let c=0,u=0,p=0;for(const y of e){if(y.triangleSegmentIdx!==c)break;p++}const m=e.length;for(;u!==e.length;){c=e[u].triangleSegmentIdx;let y=0,b=u,T=u;for(let A=b;A<p&&e[A].subtile===y;A++)T++;for(;b!==p;){const A=e[b];y=A.subtile;const C=this.centroidData[A.centroidIdx].min.clone(),P=this.centroidData[A.centroidIdx].max.clone(),D={vertexOffset:this.segments.segments[c].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[c].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let L=b;L<T;L++){const N=e[L],V=this.polygonSegments[N.polygonSegmentIdx],G=this.centroidData[N.centroidIdx].min,X=this.centroidData[N.centroidIdx].max,Y=this.indexArray.uint16;for(let ie=V.triangleArrayOffset;ie<V.triangleArrayOffset+V.triangleCount;ie++)n.emplaceBack(Y[3*ie],Y[3*ie+1],Y[3*ie+2]);D.primitiveLength+=V.triangleCount,C.x=Math.min(C.x,G.x),C.y=Math.min(C.y,G.y),P.x=Math.max(P.x,X.x),P.y=Math.max(P.y,X.y)}D.primitiveLength>0&&this.triangleSubSegments.push({segment:D,min:C,max:P}),b=T;for(let L=b;L<p&&e[L].subtile===e[b].subtile;L++)T++}u=p;for(let A=u;A<m&&e[A].triangleSegmentIdx===e[u].triangleSegmentIdx;A++)p++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,c){const u=new cn;if(this.wallMode){for(const N of this.triangleSubSegments)u.segments.push(N.segment);return u}let p=0,m=0;const y=1<<e.canonical.z;if(n){const N=n.getMinMaxForTile(e);N&&(p=N.min,m=N.max)}m+=this.maxHeight;const b=e.toUnwrapped();let T;const A=[b.canonical.x/y+b.wrap,b.canonical.y/y],C=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],P=(N,V,G)=>[N[0]*(1-G[0])+V[0]*G[0],N[1]*(1-G[1])+V[1]*G[1]],D=[],L=[];for(const N of this.triangleSubSegments){D[0]=N.min.x/xt,D[1]=N.min.y/xt,L[0]=N.max.x/xt,L[1]=N.max.y/xt;const V=P(A,C,D),G=P(A,C,L);if(new Lr([V[0],V[1],p],[G[0],G[1],m]).intersectsPrecise(c)===0){T&&(u.segments.push(T),T=void 0);continue}const X=N.segment;T&&T.vertexOffset!==X.vertexOffset&&(u.segments.push(T),T=void 0),T?(T.vertexLength+=X.vertexLength,T.primitiveLength+=X.primitiveLength):T={vertexOffset:X.vertexOffset,primitiveLength:X.primitiveLength,vertexLength:X.vertexLength,primitiveOffset:X.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&u.segments.push(T),u}encodeCentroid(e,n){const c=e.centroid(),u=n.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new nt(W(c.x,1,xt-1)<<3|p,W(c.y,1,xt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new nt(0,0);const n=e.borders,c=Number.MAX_VALUE;if(n[0][0]!==c||n[1][0]!==c){const u=n[0][0]!==c?0:1;return new nt(6|(n[0][0]!==c?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{const u=n[2][0]!==c?2:3;return new nt((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==c?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=2147483647,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,c=e.vertexCount+e.vertexArrayOffset,u=e.flags&nh?BA:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||p!==u.x){for(let m=n;m<c;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(Lv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<c)continue;const y=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingId){const b=m.footprint.buildingId;for(const T of this.centroidData)T.buildingId===b&&(T.flags|=nh)}else for(const b of this.centroidData)if(!(b.flags&nh||m.min.x>b.max.x||b.min.x>m.max.x||m.min.y>b.max.y||b.min.y>m.max.y))for(let T=0;T<b.footprintSegLen;T++){const A=this.footprintSegments[b.footprintSegIdx+T];if(p.length=0,fN(this.footprintVertices,A.vertexOffset,A.vertexCount,m.footprintTileId.canonical,e.canonical,p),Xb(m.footprint,p,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-y)){b.flags|=nh;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,c){let u=!1;for(let p=0;p<c.footprintSegLen;p++){const m=this.footprintSegments[c.footprintSegIdx+p];let y=0;for(const b of m.ringIndices){for(let T=y,A=b+y-1;T<b+y;A=T++){const C=this.footprintVertices.int16[2*(T+m.vertexOffset)+0],P=this.footprintVertices.int16[2*(T+m.vertexOffset)+1],D=this.footprintVertices.int16[2*(A+m.vertexOffset)+1];P>n!=D>n&&e<(this.footprintVertices.int16[2*(A+m.vertexOffset)+0]-C)*(n-P)/(D-P)+C&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+xt)*xt+(n+xt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&nh)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||n>m.max.y||m.min.y>n||m.height<=c||this.footprintContainsPoint(e,n,m)&&(c=m.height,this.partLookup[p]=m,u=!!(m.flags&nh));if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:u};this.partLookup[p]=void 0}}function HA(s,e){const n=s.add(e)._unit();return s.x*n.x+s.y*n.y}function dN(s,e,n,c){const u=e.sub(s)._perp()._unit(),p=n.sub(e)._perp()._unit();return qA(s,e,n,HA(u,p),c)}function qA(s,e,n,c,u){const p=Math.sqrt(1-c*c);return Math.min(s.dist(e)/3,e.dist(n)/3,u*p/c)}function eT(s,e,n){return s.x<n[0].x&&e.x<n[0].x||s.x>n[1].x&&e.x>n[1].x||s.y<n[0].y&&e.y<n[0].y||s.y>n[1].y&&e.y>n[1].y}function WA(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function ZA(s,e,n){if(s.x<0||s.x>=xt||e.x<0||e.x>=xt||n.x<0||n.x>=xt)return!1;const c=n.sub(e),u=c.perp(),p=s.sub(e);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function XA(s,e,n){const c=e?2|s:-3&s;return n?1|c:-2&c}function KA(){const s=Math.PI/32,e=Math.tan(s),n=R;return n*Math.sqrt(1+2*e*e)-n}function YA(s,e,n){const c=1<<n.z,u=ne(n.x/c),p=ne((n.x+1)/c),m=ee(n.y/c),y=ee((n.y+1)/c);return function(b,T,A,C,P=0,D){const L=[];if(!b.length||!A||!C)return L;const N=(ue,be)=>{for(const Ee of ue)L.push({polygon:Ee,bounds:be})},V=Math.ceil(Math.log2(A)),G=Math.ceil(Math.log2(C)),X=V-G,Y=[];for(let ue=0;ue<Math.abs(X);ue++)Y.push(X>0?0:1);for(let ue=0;ue<Math.min(V,G);ue++)Y.push(0),Y.push(1);let ie=b;if(ie=Mv(ie,T[0].y-P,T[1].y+P,1),ie=Mv(ie,T[0].x-P,T[1].x+P,0),!ie.length)return L;const _e=[];for(Y.length?_e.push({polygons:ie,bounds:T,depth:0}):N(ie,T);_e.length;){const ue=_e.pop(),be=ue.depth,Ee=Y[be],Ae=ue.bounds[0],Ze=ue.bounds[1],ze=Ee===0?Ae.x:Ae.y,Ke=Ee===0?Ze.x:Ze.y,tt=D?D(Ee,ze,Ke):.5*(ze+Ke),st=Mv(ue.polygons,ze-P,tt+P,Ee),yt=Mv(ue.polygons,tt-P,Ke+P,Ee);if(st.length){const ht=[Ae,new nt(Ee===0?tt:Ze.x,Ee===1?tt:Ze.y)];Y.length>be+1?_e.push({polygons:st,bounds:ht,depth:be+1}):N(st,ht)}if(yt.length){const ht=[new nt(Ee===0?tt:Ae.x,Ee===1?tt:Ae.y),Ze];Y.length>be+1?_e.push({polygons:yt,bounds:ht,depth:be+1}):N(yt,ht)}}return L}(s,e,Math.ceil((p-u)/11.25),Math.ceil((m-y)/11.25),1,(b,T,A)=>{if(b===0)return .5*(T+A);{const C=ee((n.y+T/xt)/c);return(q(.5*(ee((n.y+A/xt)/c)+C))*c-n.y)*xt}})}function fN(s,e,n,c,u,p){const m=Math.pow(2,c.z-u.z);for(let y=0;y<n;y++){let b=s.int16[2*(y+e)+0],T=s.int16[2*(y+e)+1];b=(b+u.x*xt)*m-c.x*xt,T=(T+u.y*xt)*m-c.y*xt,p.push(new nt(b,T))}}let JA,QA;zt(Fv,"FillExtrusionBucket",{omit:["layers","features"]}),zt(UA,"PartData"),zt(VA,"FootprintSegment"),zt($A,"BorderCentroidData"),zt(Qb,"GroundEffect");class Ud extends nt{constructor(e,n,c){super(e,n),this.z=c}}class eC extends Ud{constructor(e,n,c,u){super(e,n,c),this.w=u}}function tC(s,e,n,c){const u=n==="x"?"y":"x",p=(c-s[n])/(e[n]-s[n]);s[u]=Math.round(s[u]+(e[u]-s[u])*p),s[n]=c,s.hasOwnProperty("z")&&(s.z=pr(s.z,e.z,p)),s.hasOwnProperty("w")&&(s.w=pr(s.w,e.w,p))}function rC(s,e,n,c){const u=n,p=c;for(const m of["x","y"]){let y=s,b=e;y[m]>=b[m]&&(y=e,b=s),y[m]<u&&b[m]>u&&tC(y,b,m,u),y[m]<p&&b[m]>p&&tC(b,y,m,p)}}function Bv(s,e,n,c,u,p){const m=[];for(let y=0;y<s.length;y++){const b=s[y];let T;const A=m.length;let C=0;for(let P=0;P<b.length-1;P++){let D=b[P],L=b[P+1],N=0;const V=C;let G,X;p&&(N=Math.hypot(L.x-D.x,L.y-D.y),C+=N,G=D,X=L),D.x<e&&L.x<e||(D.x<e?D=new nt(e,D.y+(e-D.x)/(L.x-D.x)*(L.y-D.y))._round():L.x<e&&(L=new nt(e,D.y+(e-D.x)/(L.x-D.x)*(L.y-D.y))._round()),D.y<n&&L.y<n||(D.y<n?D=new nt(D.x+(n-D.y)/(L.y-D.y)*(L.x-D.x),n)._round():L.y<n&&(L=new nt(D.x+(n-D.y)/(L.y-D.y)*(L.x-D.x),n)._round()),D.x>=c&&L.x>=c||(D.x>=c?D=new nt(c,D.y+(c-D.x)/(L.x-D.x)*(L.y-D.y))._round():L.x>=c&&(L=new nt(c,D.y+(c-D.x)/(L.x-D.x)*(L.y-D.y))._round()),D.y>=u&&L.y>=u||(D.y>=u?D=new nt(D.x+(u-D.y)/(L.y-D.y)*(L.x-D.x),u)._round():L.y>=u&&(L=new nt(D.x+(u-D.y)/(L.y-D.y)*(L.x-D.x),u)._round()),T&&D.equals(T[T.length-1])||(T=[D],m.push(T),p&&p.push({progress:{min:V+iC(G,X,D)*N,max:1},parentIndex:y,prevPoint:G,nextPoint:X})),T.push(L),p&&(p[p.length-1].progress.max=V+iC(G,X,L)*N,p[p.length-1].nextPoint=X)))))}if(p&&C>0)for(let P=A;P<m.length;P++)p[P].progress.min/=C,p[P].progress.max/=C}return m}function pN(s,e,n,c,u){if(s.length<2)return void c.push(s);const p=[];for(;e.valid();){const[T,A]=e.get();for(let C=0;C<s.length-1;C++){const P=s[C],D=s[C+1],L=Uo(P,D,T,A);if(L){const[N]=L,V=new nt(pr(P.x,D.x,N),pr(P.y,D.y,N));p.push({t:C+N,distance:0,point:V})}}e.next()}if(p.length===0)return void c.push(s);p.sort((T,A)=>T.t-A.t);let m=0,y=0,b=[];for(c.push(b);m!==s.length;){if(y===p.length){for(;m!==s.length;)b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++;break}p[y].t<=m?(b.length!==0&&b[b.length-1].equals(p[y].point)||b.push(p[y].point),Math.trunc(p[y].t),y++):(b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++)}}function iC(s,e,n){return s.x!==e.x?(n.x-s.x)/(e.x-s.x):s.y!==e.y?(n.y-s.y)/(e.y-s.y):0}function z_(s,e){return s.x*e.x+s.y*e.y}function nC(s,e){if(s.length===1){let n=0;const c=e[n++];let u;for(;!u||c.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const p=e[n],m=s[0],y=u.sub(c),b=p.sub(c),T=m.sub(c),A=z_(y,y),C=z_(y,b),P=z_(b,b),D=z_(T,y),L=z_(T,b),N=A*P-C*C,V=(P*D-C*L)/N,G=(A*L-C*D)/N,X=c.z*(1-V-G)+u.z*V+p.z*G;if(isFinite(X))return X}return 1/0}{let n=1/0;for(const c of e)n=Math.min(n,c.z);return n}}function sC(s,e,n){let c=1/0;_n(n,e)&&(c=nC(n,e[0]));for(let u=0;u<e.length;u++){const p=e[u],m=s[u];for(let y=0;y<p.length-1;y++){const b=p[y],T=[b,p[y+1],m[y+1],m[y],b];En(n,T)&&(c=Math.min(c,nC(n,T)))}}return c!==1/0&&c}function oC(s,e,n,c,u,p,m,y,b,T,A){return s.projection.name==="globe"?function(C,P,D,L,N,V,G,X,Y,ie,_e){const ue=[],be=[],Ee=C.projection.upVectorScale(_e,C.center.lat,C.worldSize).metersToTile,Ae=[0,0,0,1],Ze=[0,0,0,1],ze=(tt,st,yt,ht)=>{tt[0]=st,tt[1]=yt,tt[2]=ht,tt[3]=1},Ke=KA();D>0&&(D+=Ke),L+=Ke;for(const tt of P){const st=[],yt=[];for(const ht of tt){const rt=ht.x+N.x,ut=ht.y+N.y,He=C.projection.projectTilePoint(rt,ut,_e),$e=C.projection.upVector(_e,ht.x,ht.y);let at=D,mt=L;if(G){const it=aC(rt,ut,D,L,G,X,Y,ie);at+=it.base,mt+=it.top}D!==0?ze(Ae,He.x+$e[0]*Ee*at,He.y+$e[1]*Ee*at,He.z+$e[2]*Ee*at):ze(Ae,He.x,He.y,He.z),ze(Ze,He.x+$e[0]*Ee*mt,He.y+$e[1]*Ee*mt,He.z+$e[2]*Ee*mt),bi(Ae,Ae,V),bi(Ze,Ze,V),st.push(new Ud(Ae[0],Ae[1],Ae[2])),yt.push(new Ud(Ze[0],Ze[1],Ze[2]))}ue.push(st),be.push(yt)}return[ue,be]}(s,e,n,c,u,p,m,y,b,T,A):m?function(C,P,D,L,N,V,G,X,Y){const ie=[],_e=[],ue=[0,0,0,1];for(const be of C){const Ee=[],Ae=[];for(const Ze of be){const ze=Ze.x+L.x,Ke=Ze.y+L.y,tt=aC(ze,Ke,P,D,V,G,X,Y);ue[0]=ze,ue[1]=Ke,ue[2]=tt.base,ue[3]=1,Nt(ue,ue,N),ue[3]=Math.max(ue[3],1e-5);const st=new Ud(ue[0]/ue[3],ue[1]/ue[3],ue[2]/ue[3]);ue[0]=ze,ue[1]=Ke,ue[2]=tt.top,ue[3]=1,Nt(ue,ue,N),ue[3]=Math.max(ue[3],1e-5);const yt=new Ud(ue[0]/ue[3],ue[1]/ue[3],ue[2]/ue[3]);Ee.push(st),Ae.push(yt)}ie.push(Ee),_e.push(Ae)}return[ie,_e]}(e,n,c,u,p,m,y,b,T):function(C,P,D,L,N){const V=[],G=[],X=N[8]*P,Y=N[9]*P,ie=N[10]*P,_e=N[11]*P,ue=N[8]*D,be=N[9]*D,Ee=N[10]*D,Ae=N[11]*D;for(const Ze of C){const ze=[],Ke=[];for(const tt of Ze){const st=tt.x+L.x,yt=tt.y+L.y,ht=N[0]*st+N[4]*yt+N[12],rt=N[1]*st+N[5]*yt+N[13],ut=N[2]*st+N[6]*yt+N[14],He=N[3]*st+N[7]*yt+N[15],$e=ht+X,at=rt+Y,mt=ut+ie,it=Math.max(He+_e,1e-5),Lt=ht+ue,Vt=rt+be,kt=ut+Ee,St=Math.max(He+Ae,1e-5);ze.push(new Ud($e/it,at/it,mt/it)),Ke.push(new Ud(Lt/St,Vt/St,kt/St))}V.push(ze),G.push(Ke)}return[V,G]}(e,n,c,u,p)}function aC(s,e,n,c,u,p,m,y){const b=m*u.getElevationAt(s,e,!0,!0),T=p[0]!==0,A=T?p[1]===0?m*(p[0]/NA-jA):m*function(C,P,D){const L=Math.floor(P[0]/8),N=Math.floor(P[1]/8),V=10*(P[0]-8*L),G=10*(P[1]-8*N),X=C.getElevationAt(L,N,!0,!0),Y=C.getMeterToDEM(D),ie=Math.floor(.5*(V*Y-1)),_e=Math.floor(.5*(G*Y-1)),ue=C.tileCoordToPixel(L,N),be=2*ie+1,Ee=2*_e+1,Ae=function(yt,ht,rt,ut,He){return[yt.getElevationAtPixel(ht,rt,!0),yt.getElevationAtPixel(ht+He,rt,!0),yt.getElevationAtPixel(ht,rt+He,!0),yt.getElevationAtPixel(ht+ut,rt+He,!0)]}(C,ue.x-ie,ue.y-_e,be,Ee),Ze=Math.abs(Ae[0]-Ae[1]),ze=Math.abs(Ae[2]-Ae[3]),Ke=Math.abs(Ae[0]-Ae[2])+Math.abs(Ae[1]-Ae[3]),tt=Math.min(.25,.5*Y*(Ze+ze)/be),st=Math.min(.25,.5*Y*Ke/Ee);return X+Math.max(tt*V,st*G)}(u,p,y):b;return{base:b+(n===0?-1:n),top:T?Math.max(A+c,b+n+2):b+c}}class mN{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class gN{constructor(){this.tasks={},this.taskQueue=[],Ue(["process"],this),this.invoker=new mN(this.process),this.nextId=0}add(e,n){const c=this.nextId++,u=function({type:p,isSymbolTile:m,zoom:y}){return y=y||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-y:p==="maybePrepare"&&m?400-y:500:200-y:100-y}(n);if(u===0){try{e()}finally{}return null}return this.tasks[c]={fn:e,metadata:n,priority:u,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<n&&(n=p.priority,e=u)}if(e===null)return null;const c=this.taskQueue[e];return this.taskQueue.splice(e,1),c}remove(){this.invoker.remove()}}class lC{constructor(e,n,c){this.target=e,this.parent=n,this.mapId=c,this.callbacks={},this.cancelCallbacks={},Ue(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new gN}send(e,n,c,u,p=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(c.metadata=m,this.callbacks[y]=c);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!c,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:nc(n,b)},b),{cancel:()=>{c&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const c=n.id;if(c&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[c];delete this.cancelCallbacks[c],u&&u.cancel()}else if(n.mustQueue||mn(self)){const u=this.callbacks[c],p=this.scheduler.add(()=>this.processTask(c,n),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[c]=p)}else this.processTask(c,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const c=this.callbacks[e];delete this.callbacks[e],c&&(n.error?c(sc(n.error)):c(null,sc(n.data)))}else{const c=new Set,u=n.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?nc(m):null,data:nc(y,c)},c)}:()=>{},p=sc(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,p,u);else if(this.parent.getWorkerSource){const m=n.type.split("."),{source:y,scope:b}=p;this.parent.getWorkerSource(n.sourceMapId,m[0],y,b)[m[1]](p,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var F_={workerUrl:"",workerClass:null,workerParams:void 0};const tT="mapboxgl_preloaded_worker_pool";class $d{constructor(){this.active={}}acquire(e,n=$d.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(F_.workerClass!=null?new F_.workerClass:new self.Worker(F_.workerUrl,F_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[tT]}numActive(){return Object.keys(this.active).length}}$d.workerCount=2;class Op{constructor(e,n,c="Worker",u=$d.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ge();const p=this.workerPool.acquire(this.id,u);for(let m=0;m<p.length;m++){const y=new Op.Actor(p[m],n,this.id);y.name=`${c} ${m}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,c){Te(this.actors,(u,p)=>{u.send(e,n,p)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let B_,rT;function Nv(){return B_||(B_=new $d),B_}Op.Actor=lC;class _N{constructor(e){this.module=e}createIntArray(e){const n=new Int32Array(e),c=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heap32.set(n,c/n.BYTES_PER_ELEMENT),c}createFloatArray(e){const n=new Float32Array(e),c=this.module.malloc(n.length*n.BYTES_PER_ELEMENT);return this.module.heapF32.set(n,c/n.BYTES_PER_ELEMENT),c}createStringBuffer(e){const n=this.module.malloc(e.length+1);for(let c=0;c<e.length;++c)this.module.heapU8[n+c]=e.charCodeAt(c);return this.module.heapU8[n+e.length]=0,n}readStringBuffer(e){let n="";for(;this.module.heapU8[e]!==0;)n+=String.fromCharCode(this.module.heapU8[e]),++e;return n}setStyle(e){const n=e.entranceColorRgb,c=e.facadeGlazingColorRgb,u=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(n[0],n[1],n[2],c[0],c[1],c[2],u[0],u[1],u[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,n){this.module.setAOOptions(e?1:0,n)}setMetricOptions(e,n){this.module.setMetricOptions(e?1:0,n)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,n){this.module.setFacadeOptions(e,n?1:0)}setFauxFacadeOptions(e,n,c){this.module.setFauxFacadeOptions(e?1:0,n?1:0,c)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,n){for(const y of e){const b=this.createStringBuffer(y.roofType),T=[0],A=[];for(const D of y.coordinates)if(Array.isArray(D)){for(const L of D)A.push(L.x),A.push(L.y);T.push(A.length)}const C=this.createIntArray(T),P=this.createFloatArray(A);this.module.addFeature(y.id,y.sourceId,y.minHeight,y.height,b,y.roofType.length,P,C,T.length-1),this.module.free(b),this.module.free(C),this.module.free(P)}for(const y of n){let b;b=y.entrances?JSON.parse(y.entrances):[];const T=this.createFloatArray(b),A=[];for(const P of y.coordinates)A.push(P.x),A.push(P.y);const C=this.createFloatArray(A);this.module.addFacade(y.sourceId,y.crossPerc,y.distanceToRoad,T,b.length,C,A.length),this.module.free(T),this.module.free(C)}if(!this.module.generateMesh()){const y=this.module.getLastError();return this.readStringBuffer(y)}const c=this.module.getMeshCount(),u=new Array(c);for(let y=0;y<c;y++){const b=this.module.getPositionsPtr(y),T=this.module.getPositionsLength(y),A=new Float32Array(this.module.heapF32.buffer,b,T),C=this.module.getNormalsPtr(y),P=this.module.getNormalsLength(y),D=new Float32Array(this.module.heapF32.buffer,C,P),L=this.module.getColorsPtr(y),N=this.module.getColorsLength(y),V=new Uint8Array(this.module.heapU8.buffer,L,N),G=this.module.getAOPtr(y),X=this.module.getAOLength(y),Y=new Float32Array(this.module.heapF32.buffer,G,X),ie=this.module.getUVPtr(y),_e=this.module.getUVLength(y),ue=new Float32Array(this.module.heapF32.buffer,ie,_e),be=this.module.getFauxFacadePtr(y),Ee=this.module.getFauxFacadeLength(y),Ae=new Uint8Array(this.module.heapU8.buffer,be,Ee),Ze=this.module.getIndicesPtr(y),ze=this.module.getIndicesLength(y),Ke=new Int32Array(this.module.heap32.buffer,Ze,ze),tt=this.module.getBuildingPart(y),st=this.readStringBuffer(tt);u[y]={positions:A,normals:D,colors:V,ao:Y,uv:ue,isFauxFacade:Ae,indices:Ke,buildingPart:st}}const p=this.module.getRingCount(),m=[];for(let y=0;y<p;y++){const b=this.module.getRingPtr(y),T=this.module.getRingLength(y),A=new Float32Array(this.module.heapF32.buffer,b,T);m.push(A)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let N_,iT,Il,Dp,nT,Lp=null,zp=null,cC=null,jv=null;function uC(){return mn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:iT||Wi.DRACO_URL}function hC(){if(mn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Dp)return Dp;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Dp=WebAssembly.validate(s)?Wi.MESHOPT_SIMD_URL:Wi.MESHOPT_URL,Dp}function yN(){return jv}const Vv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vN={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},j_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function dC(s,e,n){const c=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=c,n.json.bufferViews[c]={buffer:u,byteLength:s.byteLength},n.buffers[u]=s}const sT="KHR_draco_mesh_compression";function xN(s,e){const n=s.extensions&&s.extensions[sT];if(!n)return;const c=new Il.Decoder,u=gC(e,n.bufferView),p=new Il.Mesh;if(!c.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[s.indices],y=Vv[m.componentType],b=m.count*y.BYTES_PER_ELEMENT,T=Il._malloc(b);y===Uint16Array?c.GetTrianglesUInt16Array(p,b,T):c.GetTrianglesUInt32Array(p,b,T),dC(Il.memory.buffer.slice(T,T+b),m,e),Il._free(T);for(const A of Object.keys(n.attributes)){const C=c.GetAttributeByUniqueId(p,n.attributes[A]),P=e.json.accessors[s.attributes[A]],D=vN[P.componentType],L=P.count*j_[P.type]*Vv[P.componentType].BYTES_PER_ELEMENT,N=Il._malloc(L);c.GetAttributeDataArrayForAllPoints(p,C,Il[D],L,N),dC(Il.memory.buffer.slice(N,N+L),P,e),Il._free(N)}c.destroy(),p.destroy(),delete s.extensions[sT]}const Uv="EXT_meshopt_compression";function wN(s,e){if(!s.extensions||!s.extensions[Uv])return;const n=s.extensions[Uv],c=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);nT.decodeGltfBuffer(u,n.count,n.byteStride,c,n.mode,n.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=u.buffer,delete s.extensions[Uv]}const fC=1179937895,pC=new TextDecoder("utf8");function mC(s,e){return new URL(s,e).href}function bN(s,e,n,c){return fetch(mC(s.uri,c)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function gC(s,e){const n=s.json.bufferViews[e];return new Uint8Array(s.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function TN(s,e,n,c){if(s.uri){const u=mC(s.uri,c);return fetch(u).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[n]=p})}if(s.bufferView!==void 0){const u=gC(e,s.bufferView),p=new Blob([u],{type:s.mimeType});return createImageBitmap(p).then(m=>{e.images[n]=m})}}function _C(s,e=0,n){const c={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===fC){const A=new Uint32Array(s,e);let C=2;const P=(A[C++]>>2)-3,D=A[C++]>>2;if(C++,c.json=JSON.parse(pC.decode(A.subarray(C,C+D))),C+=D,C<P){const L=A[C++];C++;const N=e+(C<<2);c.buffers[0]=s.slice(N,N+L)}}else c.json=JSON.parse(pC.decode(new Uint8Array(s,e)));const{buffers:u,images:p,meshes:m,extensionsUsed:y,bufferViews:b}=c.json;let T=Promise.resolve();if(u){const A=[];for(let C=0;C<u.length;C++){const P=u[C];P.uri?A.push(bN(P,c,C,n)):c.buffers[C]||(c.buffers[C]=null)}T=Promise.all(A)}return T.then(()=>{const A=[],C=y&&y.includes(sT),P=y&&y.includes(Uv);if(C&&A.push(function(){if(!Il)return N_??(N_=function(D){let L,N=null;function V(){L=new Uint8Array(N.buffer)}function G(){throw new Error("Unexpected Draco error.")}const X={a:{a:G,d:function(Y,ie,_e){return L.copyWithin(Y,ie,ie+_e)},c:function(Y){const ie=L.length,_e=Math.max(Y>>>0,Math.ceil(1.2*ie)),ue=Math.ceil((_e-ie)/65536);try{return N.grow(ue),V(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(D,X):D.then(Y=>Y.arrayBuffer()).then(Y=>WebAssembly.instantiate(Y,X))).then(Y=>{const{Rb:ie,Qb:_e,P:ue,T:be,X:Ee,Ja:Ae,La:Ze,Qa:ze,Va:Ke,Wa:tt,eb:st,jb:yt,f:ht,e:rt,yb:ut,zb:He,Ab:$e,Bb:at,Db:mt,Gb:it}=Y.instance.exports;N=rt;const Lt=(()=>{let Vt=0,kt=0,St=0,wr=0;return At=>{St&&(ie(wr),ie(Vt),kt+=St,St=Vt=0),Vt||(kt+=128,Vt=_e(kt));const ir=At.length+7&-8;let Er=Vt;ir>=kt&&(St=ir,Er=wr=_e(ir));for(let Fr=0;Fr<At.length;Fr++)L[Er+Fr]=At[Fr];return Er}})();return V(),ht(),{memory:rt,_free:ie,_malloc:_e,Mesh:class{constructor(){this.ptr=ue()}destroy(){be(this.ptr)}},Decoder:class{constructor(){this.ptr=Ae()}destroy(){yt(this.ptr)}DecodeArrayToMesh(Vt,kt,St){const wr=Lt(Vt),At=Ze(this.ptr,wr,kt,St.ptr);return!!Ee(At)}GetAttributeByUniqueId(Vt,kt){return{ptr:ze(this.ptr,Vt.ptr,kt)}}GetTrianglesUInt16Array(Vt,kt,St){Ke(this.ptr,Vt.ptr,kt,St)}GetTrianglesUInt32Array(Vt,kt,St){tt(this.ptr,Vt.ptr,kt,St)}GetAttributeDataArrayForAllPoints(Vt,kt,St,wr,At){st(this.ptr,Vt.ptr,kt.ptr,St,wr,At)}},DT_INT8:ut(),DT_UINT8:He(),DT_INT16:$e(),DT_UINT16:at(),DT_UINT32:mt(),DT_FLOAT32:it()}})}(fetch(uC())),N_.then(D=>{Il=D,N_=void 0}))}()),P&&A.push(function(){if(nT)return;const D=function(L){let N;const V=WebAssembly.instantiateStreaming(L,{}).then(Y=>{N=Y.instance,N.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},X={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(Y,ie,_e,ue,be,Ee){(function(Ae,Ze,ze,Ke,tt,st,yt){const ht=Ae.exports.sbrk,rt=Ke+3&-4,ut=ht(rt*tt),He=ht(st.length),$e=new Uint8Array(Ae.exports.memory.buffer);$e.set(st,He);const at=Ze(ut,Ke,tt,He,st.length);if(at===0&&yt&&yt(ut,rt,tt),ze.set($e.subarray(ut,ut+Ke*tt)),ht(ut-ht(0)),at!==0)throw new Error(`Malformed buffer data: ${at}`)})(N,N.exports[X[be]],Y,ie,_e,ue,N.exports[G[Ee]])}}}(fetch(hC()));return D.ready.then(()=>{nT=D})}()),p)for(let D=0;D<p.length;D++)A.push(TN(p[D],c,D,n));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(C&&m)for(const{primitives:D}of m)for(const L of D)xN(L,c);if(P&&m&&b)for(const D of b)wN(D,c);return c})})}function yC(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>_C(e,0,s))}function oT(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function aT(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class lT{constructor(e,n,c,u){this.context=e,this.format=c,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:u&&u.premultiply})}update(e,n){const c=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x:y,y:b}=n&&n.position?n.position:{x:0,y:0},T=y+c,A=b+u;!this.size||this.size[0]===T&&this.size[1]===A||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!n||n.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&A>0){const P=this.useMipmap?Math.floor(Math.log2(Math.max(T,A)))+1:1;m.texStorage2D(m.TEXTURE_2D,P,this.format,T,A),this.size=[T,A]}this.size&&(C?m.texSubImage2D(m.TEXTURE_2D,0,y,b,oT(this.format),aT(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,y,b,c,u,oT(this.format),aT(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,n,c=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!c?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,c,u,p){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),n!==this.magFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,this.useMipmap?e===y.NEAREST?y.NEAREST_MIPMAP_NEAREST:y.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),c!==this.wrapS&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,c),this.wrapS=c),u!==this.wrapT&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,u),this.wrapT=u),p!==this.compareMode&&(p?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,p)):y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class V_{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:c}=this,{gl:u}=c;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}const SN=Vr([{name:"a_pos_3f",components:3,type:"Float32"}]),EN=Vr([{name:"a_color_3f",components:3,type:"Float32"}]),IN=Vr([{name:"a_color_4f",components:4,type:"Float32"}]),AN=Vr([{name:"a_uv_2f",components:2,type:"Float32"}]),CN=Vr([{name:"a_normal_3f",components:3,type:"Float32"}]),PN=Vr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RN=Vr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function vC(s,e){const n=$v(s.projection,s.zoom,s.width,s.height),c=function(p,m,y,b,T){const A=new z(y.lng-180*sh,y.lat),C=new z(y.lng+180*sh,y.lat),P=p.project(A.lng,A.lat),D=p.project(C.lng,C.lat),L=-Math.atan2(D.y-P.y,D.x-P.x),N=Me.fromLngLat(y);N.y=W(N.y,-1+sh,1-sh);const V=N.toLngLat(),G=p.project(V.lng,V.lat),X=Me.fromLngLat(V);X.x+=sh;const Y=X.toLngLat(),ie=p.project(Y.lng,Y.lat),_e=wC(ie.x-G.x,ie.y-G.y,L),ue=Me.fromLngLat(V);ue.y+=sh;const be=ue.toLngLat(),Ee=p.project(be.lng,be.lat),Ae=wC(Ee.x-G.x,Ee.y-G.y,L),Ze=Math.abs(_e.x)/Math.abs(Ae.y),ze=me([]);Be(ze,ze,-L*(1-(T?0:b)));const Ke=me([]);return Oe(Ke,Ke,[1,1-(1-Ze)*b,1]),Ke[4]=-Ae.x/Ae.y*b,Be(Ke,Ke,L),re(Ke,ze,Ke),Ke}(s.projection,0,s.center,n,e),u=xC(s);return Oe(c,c,[u,u,1]),c}function xC(s){const e=s.projection,n=$v(s.projection,s.zoom,s.width,s.height),c=cT(e,s.center),u=cT(e,z.convert(e.center));return Math.pow(2,c*n+(1-n)*u)}function $v(s,e,n,c,u=1/0){const p=s.range;if(!p)return 0;const m=Math.min(u,Math.max(n,c)),y=Math.log2(m/1024);return le(p[0]+y,p[1]+y,e)}const sh=1/4e4;function cT(s,e){const n=W(e.lat,-oe,oe),c=new z(e.lng-180*sh,n),u=new z(e.lng+180*sh,n),p=s.project(c.lng,n),m=s.project(u.lng,n),y=Me.fromLngLat(c),b=Me.fromLngLat(u),T=m.x-p.x,A=m.y-p.y,C=b.x-y.x,P=b.y-y.y,D=Math.sqrt((C*C+P*P)/(T*T+A*A));return Math.log2(D)}function wC(s,e,n){const c=Math.cos(n),u=Math.sin(n);return{x:s*c-e*u,y:s*u+e*c}}function bC(s,e,n){me(s),Be(s,s,Nr(e[2])),Xe(s,s,Nr(e[0])),qe(s,s,Nr(e[1])),Oe(s,s,n),re(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Gv(s,e,n,c,u,p,m,y){const b=[n[0]-e[0],n[1]-e[1],0],T=[c[0]-e[0],c[1]-e[1],0];if(mr(b)<1e-12||mr(T)<1e-12)return br(s);const A=Qi([],b,T);Hr(A,A),It(T,c,e),b[2]=(p-u)*y,T[2]=(m-u)*y;const C=b;return Qi(C,b,T),Hr(C,C),vo(s,A,C)}function Hv(s,e,n=!1){const c=rh(e.zoom),u=function(p,m,y){const b=m.worldSize,T=[p[12],p[13],p[14]],A=ee(T[1]/b),C=ne(T[0]/b),P=me([]),D=K(1,A)*b,L=K(1,0)*b*pe(A,m.zoom),N=1/Bb(b);let V=L*N;if(y){const ie=$v(m.projection,m.zoom,m.width,m.height,1024);V=N*m.projection.pixelSpaceConversion(m.center.lat,b,ie)}const G=I(A,C);dt(G,G,Sr([],Hr([],G),D*V*T[2]));const X=function(ie){const _e=[ie[0],ie[1],ie[2]];let ue=[0,1,0];const be=Qi([],ue,_e);return Qi(ue,_e,be),wi(ue)===0&&(ue=[0,1,0],Qi(be,_e,ue)),Hr(be,be),Hr(ue,ue),Hr(_e,_e),[be[0],be[1],be[2],0,ue[0],ue[1],ue[2],0,_e[0],_e[1],_e[2],0,ie[0],ie[1],ie[2],1]}(G);Oe(P,P,[V,V,V*D]),de(P,P,[-T[0],-T[1],-T[2]]);const Y=re([],m.globeMatrix,X);return re(Y,Y,P),re(Y,Y,p),Y}(s,e,n);if(c>0){const p=function(m,y){const b=y.worldSize,T=K(1,0)*b*pe(y.center.lat,y.zoom)/Bb(b),A=K(1,y.center.lat)*b,C=me([]);qe(C,C,Nr(y.center.lng)),Xe(C,C,Nr(y.center.lat)),de(C,C,[0,0,po]),Oe(C,C,[T,T,T*A]);const P=y.point;return de(C,C,[-P.x,-P.y,0]),re(C,C,m),re(C,y.globeMatrix,C)}(s,e);return function(m,y,b){const T=(L,N,V)=>{const G=mr(L),X=mr(N),Y=Kc(L,N,V);return Sr(Y,Y,1/mr(Y)*pr(G,X,V))},A=T([m[0],m[1],m[2]],[y[0],y[1],y[2]],b),C=T([m[4],m[5],m[6]],[y[4],y[5],y[6]],b),P=T([m[8],m[9],m[10]],[y[8],y[9],y[10]],b),D=Kc([m[12],m[13],m[14]],[y[12],y[13],y[14]],b);return[A[0],A[1],A[2],0,C[0],C[1],C[2],0,P[0],P[1],P[2],0,D[0],D[1],D[2],1]}(u,p,c)}return u}function uT(s,e,n,c){const u=Lr.projectAabbCorners(c,n);let p=Number.MAX_VALUE;for(let y=0;y<u.length;++y){const b=u[y];b[0]=(.5*b[0]+.5)*e.width,b[1]=(.5-.5*b[1])*e.height,b[2]<p&&(p=b[2])}const m=function(y){const b=[];let T=0;for(let D=1;D<y.length;D++)(y[D][0]<y[T][0]||y[D][0]===y[T][0]&&y[D][1]<y[T][1])&&(T=D);let A,C=T;const P=new Uint8Array(y.length);do{if(P[C])break;b.push(new nt(y[C][0],y[C][1])),P[C]=1,A=(C+1)%y.length;for(let D=0;D<y.length;D++){if(y[D][0]===y[A][0]&&y[D][1]===y[A][1]||y[D][0]===y[C][0]&&y[D][1]===y[C][1])continue;const L=[y[D][0]-y[C][0],y[D][1]-y[C][1]],N=[y[A][0]-y[C][0],y[A][1]-y[C][1]],V=L[0]*N[1]-L[1]*N[0];(V>0||V===0&&L[0]*N[0]+L[1]*N[1]>=0&&L[0]*L[0]+L[1]*L[1]>N[0]*N[0]+N[1]*N[1])&&(A=D)}C=A}while(C!==T);return b.length>0&&b.push(b[0]),b}(u);if(En(s,m))return p}const Gd=64,Fp={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function qv(s,e,n,c,u,p,m,y,b,T=!1){const A=n.zoom,C=n.project(c),P=pe(c.lat,A),D=1/P;me(s),de(s,s,[C.x+m[0]*D,C.y+m[1]*D,m[2]]);let L=1,N=1;const V=n.worldSize;if(T){if(n.projection.name==="mercator"){let ie=0;n.elevation&&(ie=n.elevation.getAtPointOrZero(new Me(C.x/V,C.y/V),0));const _e=Nt([],[C.x,C.y,ie,1],n.projMatrix)[3]/n.cameraToCenterDistance;L=_e,N=_e*pe(n.center.lat,A)}else if(n.projection.name==="globe"){const ie=Hv(s,n),_e=[0,0,0,1];Nt(_e,_e,re([],n.projMatrix,ie));const ue=_e[3]/n.cameraToCenterDistance,be=rh(A),Ee=n.projection.pixelsPerMeter(c.lat,V)*pe(c.lat,A),Ae=n.projection.pixelsPerMeter(n.center.lat,V)*pe(n.center.lat,A);L=ue/pr(Ee,ve(n.center.lat),be),N=ue*P/Ee,L*=Ae,N*=Ae}}else L=D;Oe(s,s,[L,L,N]);const G=[...s],X=e.orientation,Y=[];if(bC(Y,[X[0]+(u?u[0]:0),X[1]+(u?u[1]:0),X[2]+(u?u[2]:0)],p),re(s,G,Y),y&&n.elevation){let ie=0;const _e=[];if(b&&n.elevation){ie=function(be,Ee,Ae,Ze,ze){const Ke=Ee.elevation;if(!Ke)return 0;const tt=Lr.projectAabbCorners(Ae,Ze),st=K(1,ze.lat)*Ee.worldSize,yt=function(kt,St){const wr=[0,0,1],At=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ir of At){const Er=kt[ir.corners[0]],Fr=kt[ir.corners[1]],ii=kt[ir.corners[2]],Ar=[Fr[0]-Er[0],Fr[1]-Er[1],St*(Fr[2]-Er[2])],li=Qi(Ar,Ar,[ii[0]-Er[0],ii[1]-Er[1],St*(ii[2]-Er[2])]);Hr(li,li),ir.dotProductWithUp=Pi(li,wr)}return At.sort((ir,Er)=>ir.dotProductWithUp-Er.dotProductWithUp),At[0].corners}(tt,st),ht=tt[yt[0]],rt=tt[yt[1]],ut=tt[yt[2]],He=tt[yt[3]],$e=Ke.getAtPointOrZero(new Me(ht[0]/Ee.worldSize,ht[1]/Ee.worldSize),0),at=Ke.getAtPointOrZero(new Me(rt[0]/Ee.worldSize,rt[1]/Ee.worldSize),0),mt=Ke.getAtPointOrZero(new Me(ut[0]/Ee.worldSize,ut[1]/Ee.worldSize),0),it=Ke.getAtPointOrZero(new Me(He[0]/Ee.worldSize,He[1]/Ee.worldSize),0),Lt=($e+it)/2,Vt=(at+mt)/2;return Lt>Vt?at<mt?Gv(be,rt,He,ht,at,it,$e,st):Gv(be,ut,ht,He,mt,$e,it,st):$e<it?Gv(be,ht,rt,ut,$e,at,mt,st):Gv(be,He,ut,rt,it,mt,at,st),Math.max(Lt,Vt)}(_e,n,e.aabb,s,c);const ue=re([],nr([],_e),Y);re(s,G,ue)}else ie=n.elevation.getAtPointOrZero(new Me(C.x/V,C.y/V),0);ie!==0&&(s[14]+=ie)}}class TC{constructor(e,n,c,u,p){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=n,this.position=c!=null?new z(c[0],c[1]):new z(0,0),this.orientation=u??[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new Lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){re(e.globalMatrix,n,e.localMatrix);const c=this.nodeOverrides.get(e.name);if(c!==void 0){const m=[];p=c.orientation,me(u=m),qe(u,u,Nr(p[1])),Be(u,u,Nr(p[2])),Xe(u,u,Nr(p[0])),re(e.globalMatrix,e.globalMatrix,m)}var u,p;if(e.meshes)for(const m of e.meshes){const y=Lr.applyTransformFast(m.aabb,e.globalMatrix);this.aabb.encapsulate(y)}if(e.children)for(const m of e.children)this._applyTransformations(m,e.globalMatrix)}computeBoundsAndApplyParent(){const e=me([]);this.aabb=new Lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.nodes)this._applyTransformations(n,e)}computeModelMatrix(e,n,c,u,p,m,y=!1){qv(this.matrix,this,e.transform,this.position,n,c,u,p,m,y)}upload(e){if(!this.uploaded){for(const n of this.nodes)hT(n,e);for(const n of this.nodes)Wv(n);this.uploaded=!0}}destroy(){for(const e of this.nodes)dT(e)}}function U_(s,e,n=!1){s.uploaded||(s.gfxTexture=new lT(e,s.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function kN(s,e,n){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,SN.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,CN.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,AN.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?EN:IN).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,RN.members,!0)),s.segments=cn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const c=s.material;c.pbrMetallicRoughness.baseColorTexture&&U_(c.pbrMetallicRoughness.baseColorTexture,e),c.pbrMetallicRoughness.metallicRoughnessTexture&&U_(c.pbrMetallicRoughness.metallicRoughnessTexture,e),c.normalTexture&&U_(c.normalTexture,e),c.occlusionTexture&&U_(c.occlusionTexture,e,n),c.emissionTexture&&U_(c.emissionTexture,e)}function hT(s,e,n){if(s.meshes)for(const c of s.meshes)kN(c,e,n);if(s.children)for(const c of s.children)hT(c,e,n)}function Wv(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)Wv(e)}function dT(s){if(s.meshes)for(const n of s.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(s.children)for(const n of s.children)dT(n)}function Hd(s,e){const n=s.json.bufferViews[e.bufferView],c=Vv[e.componentType];return new c(s.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==j_[e.type]*c.BYTES_PER_ELEMENT?n.byteStride/c.BYTES_PER_ELEMENT:j_[e.type]))}function fT(s,e,n,c){const u=Vv[e.componentType],p=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),m=s.json.bufferViews[e.bufferView],y=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:j_[e.type],b=n.float32,T=b.length/n.capacity;for(let A=0,C=0;A<e.count*y;A+=y,C+=T)for(let P=0;P<T;P++)b[C+P]=c[A+P]*p;n._trim()}function MN(s,e,n){const c=s.indices,u=s.attributes,p={};p.indexArray=new rn;const m=e.json.accessors[c],y=m.count/3;p.indexArray.reserve(y);const b=Hd(e,m);for(let P=0;P<y;P++)p.indexArray.emplaceBack(b[3*P],b[3*P+1],b[3*P+2]);p.indexArray._trim(),p.vertexArray=new Vo;const T=e.json.accessors[u.POSITION];p.vertexArray.reserve(T.count);const A=Hd(e,T);for(let P=0;P<T.count;P++)p.vertexArray.emplaceBack(A[3*P],A[3*P+1],A[3*P+2]);if(p.vertexArray._trim(),p.aabb=new Lr(T.min,T.max),p.centroid=function(P,D){const L=[0,0,0],N=P.length;if(N>0){for(let V=0;V<N;V++){const G=3*P[V];L[0]+=D[G],L[1]+=D[G+1],L[2]+=D[G+2]}L[0]/=N,L[1]/=N,L[2]/=N}return L}(b,A),u.COLOR_0!==void 0){const P=e.json.accessors[u.COLOR_0],D=j_[P.type],L=Hd(e,P);p.colorArray=D===3?new Vo:new lc,p.colorArray.resize(P.count),fT(e,P,p.colorArray,L)}if(u.NORMAL!==void 0){p.normalArray=new Vo;const P=e.json.accessors[u.NORMAL];p.normalArray.resize(P.count);const D=Hd(e,P);fT(e,P,p.normalArray,D)}if(u.TEXCOORD_0!==void 0&&n.length>0){p.texcoordArray=new cc;const P=e.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(P.count);const D=Hd(e,P);fT(e,P,p.texcoordArray,D)}if(u._FEATURE_ID_RGBA4444!==void 0){const P=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Hd(e,P))}u._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Hd(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const C=s.material;return p.material=function(P,D){const{emissiveFactor:L=[0,0,0],alphaMode:N="OPAQUE",alphaCutoff:V=.5,normalTexture:G,occlusionTexture:X,emissiveTexture:Y,doubleSided:ie,name:_e}=P,{baseColorFactor:ue=[1,1,1,1],metallicFactor:be=1,roughnessFactor:Ee=1,baseColorTexture:Ae,metallicRoughnessTexture:Ze}=P.pbrMetallicRoughness||{},ze=X?D[X.index]:void 0;if(X&&X.extensions&&X.extensions.KHR_texture_transform&&ze){const Ke=X.extensions.KHR_texture_transform;ze.offsetScale=[Ke.offset[0],Ke.offset[1],Ke.scale[0],Ke.scale[1]]}return{name:_e,pbrMetallicRoughness:{baseColorFactor:new yi(...ue),metallicFactor:be,roughnessFactor:Ee,baseColorTexture:Ae?D[Ae.index]:void 0,metallicRoughnessTexture:Ze?D[Ze.index]:void 0},doubleSided:ie,emissiveFactor:new yi(...L),alphaMode:N,alphaCutoff:V,normalTexture:G?D[G.index]:void 0,occlusionTexture:ze,emissionTexture:Y?D[Y.index]:void 0,defined:P.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},n),p}function SC(s,e,n){const{matrix:c,rotation:u,translation:p,scale:m,mesh:y,extras:b,children:T,name:A}=s,C={};if(C.name=A,C.localMatrix=c||function(P,D,L,N){var V=D[0],G=D[1],X=D[2],Y=D[3],ie=V+V,_e=G+G,ue=X+X,be=V*ie,Ee=V*_e,Ae=V*ue,Ze=G*_e,ze=G*ue,Ke=X*ue,tt=Y*ie,st=Y*_e,yt=Y*ue,ht=N[0],rt=N[1],ut=N[2];return P[0]=(1-(Ze+Ke))*ht,P[1]=(Ee+yt)*ht,P[2]=(Ae-st)*ht,P[3]=0,P[4]=(Ee-yt)*rt,P[5]=(1-(be+Ke))*rt,P[6]=(ze+tt)*rt,P[7]=0,P[8]=(Ae+st)*ut,P[9]=(ze-tt)*ut,P[10]=(1-(be+Ze))*ut,P[11]=0,P[12]=L[0],P[13]=L[1],P[14]=L[2],P[15]=1,P}([],u||[0,0,0,1],p||[0,0,0],m||[1,1,1]),C.globalMatrix=se(C.localMatrix),y!==void 0){C.meshes=n[y];const P=C.anchor=[0,0];for(const D of C.meshes){const{min:L,max:N}=D.aabb;P[0]+=L[0]+N[0],P[1]+=L[1]+N[1]}P[0]=Math.floor(P[0]/C.meshes.length/2),P[1]=Math.floor(P[1]/C.meshes.length/2)}if(b&&(b.id&&(C.id=b.id),b.lights&&(C.lights=function(P){if(!P.length)return[];const D=function(X){const Y=atob(X),ie=new Uint8Array(Y.length);for(let _e=0;_e<Y.length;_e++)ie[_e]=Y.codePointAt(_e);return ie}(P),L=[],N=D.length/24,V=new Uint16Array(D.buffer),G=new Float32Array(D.buffer);for(let X=0;X<N;X++){const Y=V[2*X*6]/30,ie=V[2*X*6+1]/30,_e=V[2*X*6+10]/100,ue=G[6*X+1],be=G[6*X+2],Ee=G[6*X+3],Ae=G[6*X+4],Ze=Ee-ue,ze=Ae-be,Ke=Math.hypot(Ze,ze);L.push({pos:[ue+.5*Ze,be+.5*ze,ie],normal:[ze/Ke,-Ze/Ke,0],width:Ke,height:Y,depth:_e,points:[ue,be,Ee,Ae]})}return L}(b.lights)),b.MAPBOX_geometry_bloom&&(C.isGeometryBloom=b.MAPBOX_geometry_bloom)),T){const P=[];for(const D of T)P.push(SC(e.json.nodes[D],e,n));C.children=P}return C}function ON(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new Ov(s.vertices,s.indices,8,256),[n,c]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:n,max:c}}function DN(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const c=[];for(const m of n){if(!Array.isArray(m)||m.length!==2)continue;const y=m[0],b=m[1];typeof y=="number"&&typeof b=="number"&&c.push(new nt(y,b))}if(c.length<3)return null;c.length>1&&c[c.length-1].equals(c[0])&&c.pop();let u=0;for(let m=0;m<c.length;m++){const y=c[m],b=c[(m+1)%c.length],T=c[(m+2)%c.length];u+=(y.x-b.x)*(T.y-b.y)-(T.x-b.x)*(y.y-b.y)}u>0&&c.reverse();const p=kp(c.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:c,indices:p}}function LN(s,e){const n=[],c=[];let u=0;const p=[];for(const m of s){u=n.length;const y=m.vertexArray.float32,b=m.indexArray.uint16;for(let T=0;T<m.vertexArray.length;T++)p[0]=y[3*T+0],p[1]=y[3*T+1],p[2]=y[3*T+2],bi(p,p,e),n.push(new nt(p[0],p[1]));for(let T=0;T<3*m.indexArray.length;T++)c.push(b[T]+u)}if(c.length%3!=0)return null;for(let m=0;m<c.length;m+=3){const y=n[c[m+0]],b=n[c[m+1]],T=n[c[m+2]];(y.x-b.x)*(T.y-b.y)-(T.x-b.x)*(y.y-b.y)>0&&([c[m+1],c[m+2]]=[c[m+2],c[m+1]])}return{vertices:n,indices:c}}function pT(s){const e=function(b,T){const A=[],C=WebGL2RenderingContext;if(b.json.textures)for(const P of b.json.textures){const D={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};P.sampler!==void 0&&Object.assign(D,b.json.samplers[P.sampler]),A.push({image:T[P.source],sampler:D,uploaded:!1})}return A}(s,s.images),n=function(b,T){const A=[];for(const C of b.json.meshes){const P=[];for(const D of C.primitives)P.push(MN(D,b,T));A.push(P)}return A}(s,e),{scenes:c,scene:u,nodes:p}=s.json,m=c?c[u||0].nodes:[...p.keys()],y=[];for(const b of m)y.push(SC(p[b],s,n));return function(b,T,A){const C={},P=new Set;for(let D=0;D<b.length;D++){const L=A[T[D]];if(!L.extras)continue;const N=L.extras["mapbox:footprint:version"],V=L.extras["mapbox:footprint:id"];(N||V)&&P.add(D),N==="1.0.0"&&V&&(C[V]=D)}for(let D=0;D<b.length;D++){if(P.has(D))continue;const L=b[D],N=A[T[D]];if(!N.extras)continue;let V=null;L.id in C&&(V=LN(b[C[L.id]].meshes,L.localMatrix)),V||(V=DN(N)),V&&(L.footprint=ON(V))}if(P.size>0){const D=Array.from(P.values()).sort((L,N)=>L-N);for(let L=D.length-1;L>=0;L--)b.splice(D[L],1)}}(y,m,s.json.nodes),y}function zN(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,n=s.aabb.min[0]-1,c=s.aabb.min[1]-1,u=Gd/(s.aabb.max[0]-n+2),p=Gd/(s.aabb.max[1]-c+2);for(let m=0;m<e.length;m+=3){const y=e[m+2],b=(e[m+0]-n)*u|0,T=(e[m+1]-c)*p|0;y>s.heightmap[T*Gd+b]&&(s.heightmap[T*Gd+b]=y)}}function EC(s,e,n,c,u){n.reserve(n.length+4*s.length),c.reserve(c.length+10*s.length),u.reserve(u.length+10*s.length);let p=c.length;for(const m of s){const y=Math.min(10,Math.max(4,1.3*m.height))*e,b=[-m.normal[1],m.normal[0],0],T=Math.min(.29,.1*m.width/m.depth),A=m.width-2*m.depth*e*(T+.01),C=ti([],m.pos,b,A/2),P=ti([],m.pos,b,-A/2),D=[C[0],C[1],C[2]+m.height],L=[P[0],P[1],P[2]+m.height],N=ti([],m.normal,b,T);Sr(N,N,y);const V=ti([],m.normal,b,-T);Sr(V,V,y),dt(N,C,N),dt(V,P,V),C[2]+=.1,P[2]+=.1,c.emplaceBack(N[0],N[1],N[2]),c.emplaceBack(V[0],V[1],V[2]),c.emplaceBack(C[0],C[1],C[2]),c.emplaceBack(P[0],P[1],P[2]),c.emplaceBack(D[0],D[1],D[2]),c.emplaceBack(L[0],L[1],L[2]),c.emplaceBack(C[0],C[1],C[2]),c.emplaceBack(P[0],P[1],P[2]),c.emplaceBack(N[0],N[1],N[2]),c.emplaceBack(V[0],V[1],V[2]);const G=A/y/2;u.emplaceBack(-G-T,-1,G,.8),u.emplaceBack(G+T,-1,G,.8),u.emplaceBack(-G,0,G,1.3),u.emplaceBack(G,0,G,1.3),u.emplaceBack(G+T,-.8,G,.7),u.emplaceBack(G+T,-.8,G,.7),u.emplaceBack(0,0,G,1.3),u.emplaceBack(0,0,G,1.3),u.emplaceBack(G+T,-1.2,G,.8),u.emplaceBack(G+T,-1.2,G,.8),n.emplaceBack(6+p,4+p,8+p),n.emplaceBack(7+p,9+p,5+p),n.emplaceBack(0+p,1+p,2+p),n.emplaceBack(1+p,3+p,2+p),p+=10}}function FN(s,e){const n={};n.indexArray=new rn,n.vertexArray=new Vo,n.colorArray=new lc,EC(s,e,n.indexArray,n.vertexArray,n.colorArray);const c={defined:!0};c.emissiveFactor=yi.black;const u={};return u.baseColorFactor=yi.white,c.pbrMetallicRoughness=u,n.material=c,n.aabb=new Lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}const IC=Vr([{name:"a_pos_3f",components:3,type:"Float32"}]),BN=Vr([{name:"a_normal_3",components:3,type:"Int16"}]),NN=Vr([{name:"a_centroid_3",components:3,type:"Int16"}]),AC=Vr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),jN=Vr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),VN=Vr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),UN=Vr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),$N=Vr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),GN=Vr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),CC=ot.types,Zv=32767;function HN(s,e){const n=xt+e;for(const c of s)for(const u of c)if(u.x<-e||u.x>n||u.y<-e||u.y>n)return!1;return!0}class PC{constructor(){this.layoutVertexArray=new Vo,this.layoutAttenuationArray=new lc,this.layoutColorArray=new _a,this.indexArray=new rn,this.indexArrayForConflation=new rn,this.segmentsBucket=new cn}}class mT{constructor(){this.layoutVertexArray=new Vo,this.layoutNormalArray=new qc,this.layoutCentroidArray=new qc,this.layoutColorArray=new _a,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new wp,this.layoutAOArray=new bl,this.indexArray=new rn,this.indexArrayForConflation=new rn,this.segmentsBucket=new cn,this.entranceBloom=new PC}}class RC{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new mT,this.buildingWithFacade=new mT,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new _a,this.buildingWithFacade.layoutFacadeDataArray=new Wc,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new _a,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.groundEffect=new Qb(e),this.groundEffect.groundRadiusArray=new bl,this.hasAppearances=null}updateFootprints(e,n){for(const c of this.footprints)n.push({footprint:c,id:e})}updateAppearances(e,n,c,u){}prepare(){return function(){if(jv!=null||cC!=null)return null;if(zp!=null)return zp;const e=fetch(Wi.BUILDING_GEN_URL);return zp=function(n){let c,u,p,m;function y(){c=new Uint8Array(m.buffer),u=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function b(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},A={a:{a:b,f:function(C){const P=c.length,D=Math.max(C>>>0,Math.ceil(1.2*P)),L=Math.ceil((D-P)/65536);try{return m.grow(L),y(),!0}catch{return!1}},g:b,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,A):n.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,A))).then(C=>{const P=C.instance.exports;return(0,P.g)(),m=P.f,y(),new _N({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setStructuralOptions:P.k,setFacadeOptions:P.l,setFauxFacadeOptions:P.m,setFacadeClassifierOptions:P.n,addFeature:P.o,addFacade:P.p,generateMesh:P.q,getLastError:P.r,getOuterRingLength:P.s,getMeshCount:P.t,getPositionsPtr:P.u,getPositionsLength:P.v,getNormalsPtr:P.w,getNormalsLength:P.x,getColorsPtr:P.y,getColorsLength:P.z,getAOPtr:P.A,getAOLength:P.B,getUVPtr:P.C,getUVLength:P.D,getFauxFacadePtr:P.E,getFauxFacadeLength:P.F,getIndicesPtr:P.G,getIndicesLength:P.H,getBuildingPart:P.I,getRingCount:P.J,getRingPtr:P.K,getRingLength:P.L,free:P.M,malloc:P.N,heapU8:c,heap32:u,heapF32:p})})}(e).then(n=>(zp=null,jv=n,jv)).catch(n=>{or("Could not load building-gen"),zp=null,cC=n}),zp}()}populate(e,n,c,u){const p=yN();if(!p)return;const m=xe(c);this.tileToMeter=m,this.brightness=n.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,m],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:m,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const y=new Map,b=new Map;for(const{feature:T}of e){if(CC[T.type]!=="LineString"){y.set(T.id,T.properties.source_id);continue}const A=this.layers[0]._featureFilter.needGeometry,C=je(T,A);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),C,c))continue;const P=A?C.geometry:et(T,c,u),D=[];for(const G of P)for(const X of G)D.push({x:X.x,y:X.y});const L={coordinates:D,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},N=T.properties.source_id;let V=b.get(N);V||(V=[],b.set(N,V)),V.push(L)}this.maxHeight=0;for(const{feature:T,id:A,index:C,sourceLayerIndex:P}of e){if(CC[T.type]==="LineString")continue;const D=this.layers[0]._featureFilter.needGeometry,L=je(T,D);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom),L,c))continue;const N=D?L.geometry:et(T,c,u),V=k_(N,500);if(!HN(N,163))continue;const G=this.layers[0],X=G.layout.get("building-roof-shape").evaluate(T,{},c);if(X==="flat")continue;const Y=G.layout.get("building-base").evaluate(T,{},c),ie=G.layout.get("building-height").evaluate(T,{},c),_e=G.layout.get("building-flood-light-ground-radius").evaluate(T,{},c),ue=G.paint.get("building-ambient-occlusion-intensity"),be=_e/this.tileToMeter;let Ee=G.layout.get("building-flood-light-wall-radius").evaluate(T,{},c);Ee=W(Ee,0,2048);const Ae=Ee/2048*Zv,Ze=y.get(A);let ze;ze=b.has(Ze)?b.get(Ze):[];const Ke=ze.length!==0&&G.layout.get("building-facade").evaluate(T,{},c);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(Ke,!1,1);let tt=0,st=0,yt=0,ht=0,rt=0,ut=0;if(Ke){let Je=Math.round(G.layout.get("building-facade-floors").evaluate(T,{},c));if(Y===0){Je=Math.max(1,Je-(ze.length>0?1:0));let Kt=4;if(ie>100){const Wt=[10,13,15];Kt=Wt[T.id?T.id%Wt.length:0],p.setFacadeOptions(Kt,!0)}rt=1.6803*Kt/m}else rt=Y/m;ut=ie/m,rt=Math.min(rt,ut),yt=G.layout.get("building-facade-unit-width").evaluate(T,{},c)/m,ht=(ut-rt)/Je,p.setFauxFacadeOptions(!0,!0,yt);const Et=G.layout.get("building-facade-window").evaluate(T,{},c);tt=Et[0],st=Et[1]}const He=[],$e=new nt(1/0,1/0),at=new nt(-1/0,-1/0),mt=new nt(0,0);let it=0;for(const Je of V)if(Je.length>0){const Et=[];for(const Kt of Je){const Wt=[];for(let Cr=Kt.length-1;Cr>=0;Cr--){const hr=Kt[Cr];Wt.push({x:hr.x,y:hr.y}),$e.x=Math.min($e.x,hr.x),$e.y=Math.min($e.y,hr.y),at.x=Math.max(at.x,hr.x),at.y=Math.max(at.y,hr.y),mt.x+=hr.x,mt.y+=hr.y,it++}Et.push(Wt)}He.push({id:T.id?T.id:0,height:ie,minHeight:Y,sourceId:0,roofType:X,coordinates:Et})}mt.x/=it||1,mt.y/=it||1;const Lt=p.generateMesh(He,ze);if(typeof Lt=="string"){or(`Unable to generate building ${T.id}: ${Lt}`);continue}if(Lt.meshes.length===0||Lt.modifiedPolygonRings.length===0)continue;let Vt=0;for(const Je of Lt.meshes)Vt+=Je.positions.length/3;const kt=Ke?this.buildingWithFacade:this.buildingWithoutFacade,St=kt.segmentsBucket.prepareSegment(Vt,kt.layoutVertexArray,kt.indexArray),wr=[];let At=null,ir=0,Er=-1;const Fr=kt.layoutVertexArray.length,ii=kt.indexArray.length;let Ar=0;for(const Je of Lt.meshes){const Et=kt.layoutVertexArray.length;if(Je.buildingPart==="entrance"){const Ht=new Array;for(let ei=0;ei<Je.positions.length;ei+=12){const Mi=Je.positions[ei+0],vi=Je.positions[ei+1],pn=Je.positions[ei+3],Xi=Je.positions[ei+4],Bi=Je.positions[ei+2],Ii=Je.positions[ei+8]-Bi,ui=1,Pr=pn-Mi,hi=Xi-vi,Ni=Math.hypot(Pr,hi);Ht.push({pos:[Mi+.5*Pr,vi+.5*hi,Bi],normal:[hi/Ni,-Pr/Ni,0],width:Ni,height:Ii,depth:ui,points:[Mi,vi,pn,Xi]})}const ai=kt.entranceBloom.segmentsBucket.prepareSegment(10*Ht.length,kt.entranceBloom.layoutVertexArray,kt.entranceBloom.indexArray),ki=kt.entranceBloom.layoutVertexArray.length;ir=kt.entranceBloom.indexArray.length,EC(Ht,.5/this.tileToMeter,kt.entranceBloom.indexArray,kt.entranceBloom.layoutVertexArray,kt.entranceBloom.layoutAttenuationArray);const fr=kt.entranceBloom.layoutVertexArray.length-ki;Er=kt.entranceBloom.indexArray.length-ir;for(let ei=0;ei<fr;ei++)kt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);ai.vertexLength+=fr,ai.primitiveLength+=Er,At={part:Je.buildingPart,vertexOffset:ki,vertexLength:fr}}for(let Ht=0;Ht<Je.positions.length;Ht+=3)Ar=Math.max(Ar,Je.positions[Ht+2]),kt.layoutVertexArray.emplaceBack(Je.positions[Ht],Je.positions[Ht+1],Je.positions[Ht+2]);const Kt=Math.floor(mt.x),Wt=Math.floor(mt.y),Cr=Math.floor(Ar);for(let Ht=0;Ht<Je.positions.length;Ht+=3)kt.layoutCentroidArray.emplaceBack(Kt,Wt,Cr),kt.layoutFloodLightDataArray.emplaceBack(Je.buildingPart==="wall"?Ae:0);for(let Ht=0;Ht<Je.normals.length;Ht+=3)kt.layoutNormalArray.emplaceBack(Je.normals[Ht+0]*Zv,Je.normals[Ht+1]*Zv,Je.normals[Ht+2]*Zv);for(let Ht=0;Ht<Je.ao.length;Ht++)kt.layoutAOArray.emplaceBack(Je.ao[Ht]);for(let Ht=0;Ht<Je.colors.length;Ht+=3){const ai=1+(Je.ao[Ht/3]-1)*ue;kt.layoutColorArray.emplaceBack(Je.colors[Ht]*ai<<8|Je.colors[Ht+1]*ai,Je.colors[Ht+2]*ai<<8)}if(Ke){for(let Ht=0;Ht<Je.positions.length;Ht+=3)kt.layoutFacadePaintArray.emplaceBack(65535,255);for(let Ht=0;Ht<Je.isFauxFacade.length;Ht++)if(Je.isFauxFacade[Ht]){const ai=1|Math.min(65535,Math.floor(Je.uv[2*Ht]*Lt.outerRingLength)),ki=Math.floor(255*tt)<<8|Math.floor(255*st),fr=Math.floor(65535*Math.min(1,yt/xt)),ei=Math.floor(65535*Math.min(1,ht/xt));kt.layoutFacadeDataArray.emplaceBack(ai,ki,fr,ei);const Mi=Math.floor(65535*Math.min(1,rt/xt)),vi=Math.floor(65535*Math.min(1,ut/xt));kt.layoutFacadeVerticalRangeArray.emplaceBack(Mi,vi)}else kt.layoutFacadeDataArray.emplaceBack(0,0,0,0),kt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const hr=St.vertexLength;for(let Ht=0;Ht<Je.indices.length;Ht+=3)kt.indexArray.emplaceBack(hr+Je.indices[Ht],hr+Je.indices[Ht+1],hr+Je.indices[Ht+2]);St.vertexLength+=Je.positions.length/3,St.primitiveLength+=Je.indices.length/3,(Je.buildingPart==="roof"||Je.buildingPart==="wall"||Je.buildingPart==="facade_glazing"||Je.buildingPart==="entrance")&&wr.push({part:Je.buildingPart,vertexOffset:Et,vertexLength:Je.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Ar),this.buildingFeatures.push({promoteId:A,feature:L,hasFauxFacade:Ke,segment:St,parts:wr,buildingBloom:At});const li=kt.indexArray.length-ii,ci=[],an=[],he=new nt(1/0,1/0),ae=new nt(-1/0,-1/0),Ye=this.groundEffect.vertexArray.length;for(const Je of Lt.modifiedPolygonRings){const Et=[],Kt=new nt(1/0,1/0),Wt=new nt(-1/0,-1/0);for(let Cr=0;Cr<Je.length;Cr+=2){const hr=Je.length-Cr-2;Kt.x=Math.min(Kt.x,Je[hr]),Kt.y=Math.min(Kt.y,Je[hr+1]),Wt.x=Math.max(Wt.x,Je[hr]),Wt.y=Math.max(Wt.y,Je[hr+1]);const Ht=new nt(Je[hr],Je[hr+1]);Et.push(Ht),ci.push(Ht.x,Ht.y),an.push(Ht.clone())}he.x=Math.min(he.x,Kt.x),he.y=Math.min(he.y,Kt.y),ae.x=Math.max(ae.x,Wt.x),ae.y=Math.max(ae.y,Wt.y),this.groundEffect.addData(Et,[Kt,Wt],be)}const Tt=this.groundEffect.vertexArray.length-Ye;for(let Je=0;Je<Tt;Je++)this.groundEffect.groundRadiusArray.emplaceBack(_e);($e.x<0||at.x>xt||$e.y<0||at.y>xt)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const Je=kp(ci,null,2),Et=new Ov(an,Je,8,256);let Kt=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(Kt=T.properties.building_id);const Wt={vertices:an,indices:Je,grid:Et,min:he,max:ae,buildingId:Kt,hiddenFlags:0,indicesOffset:ii,indicesLength:li,bloomIndicesOffset:ir,bloomIndicesLength:Er,groundEffectVertexOffset:Ye,groundEffectVertexLength:Tt,hasFauxFacade:Ke,segment:St,height:Ar};T.id!==void 0&&this.featureFootprintLookup.set(T.id,this.footprints.length),this.footprints.push(Wt)}this.programConfigurations.populatePaintArrays(kt.layoutVertexArray.length,T,C,{},n.availableImages,c,n.brightness),this.groundEffect.addPaintPropertiesData(T,C,{},n.availableImages,c,n.brightness),n.featureIndex.insert(T,N,C,P,this.index,Fr)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,n,c,u,p,m,y){this.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y),this.groundEffect.update(e,n,p,c,u,m,y),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const n=c=>{c.layoutVertexBuffer=e.createVertexBuffer(c.layoutVertexArray,IC.members),c.layoutNormalBuffer=e.createVertexBuffer(c.layoutNormalArray,BN.members),c.layoutCentroidBuffer=e.createVertexBuffer(c.layoutCentroidArray,NN.members),c.layoutFloodLightDataBuffer=e.createVertexBuffer(c.layoutFloodLightDataArray,GN.members),c.layoutFacadeDataArray&&c.layoutFacadeDataArray.length&&(c.layoutFacadeDataBuffer=e.createVertexBuffer(c.layoutFacadeDataArray,VN.members)),c.layoutFacadeVerticalRangeArray&&c.layoutFacadeVerticalRangeArray.length&&(c.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(c.layoutFacadeVerticalRangeArray,UN.members)),c.entranceBloom.layoutVertexArray.length&&(c.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(c.entranceBloom.layoutVertexArray,IC.members),c.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(c.entranceBloom.layoutAttenuationArray,$N.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=n=>{n.layoutVertexBuffer&&(n.layoutVertexBuffer.destroy(),n.layoutNormalBuffer.destroy(),n.layoutColorBuffer.destroy(),n.segmentsBucket.destroy(),n.indexBuffer&&n.indexBuffer.destroy(),n.entranceBloom.layoutVertexBuffer&&(n.entranceBloom.layoutVertexBuffer.destroy(),n.entranceBloom.layoutColorBuffer.destroy(),n.entranceBloom.layoutAttenuationBuffer.destroy(),n.entranceBloom.indexBuffer.destroy(),n.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,n,c=!0){let u=!1;const p=c?n:0,m=0|(c?-1:~n);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const y of e){const b=this.footprints[y],T=b.hiddenFlags&m|p;b.hiddenFlags!==T&&(b.hiddenFlags=T,u=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const n=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};n(this.buildingWithoutFacade),n(this.buildingWithFacade);for(const u of this.footprints){const p=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let b=u.indicesOffset;b<m;b++)p.indexArrayForConflation.uint16[3*b+0]=0,p.indexArrayForConflation.uint16[3*b+1]=0,p.indexArrayForConflation.uint16[3*b+2]=0;const y=u.bloomIndicesOffset+u.bloomIndicesLength;for(let b=u.bloomIndicesOffset;b<y;b++)p.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}const c=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};c(this.buildingWithoutFacade),c(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const n=c=>{c.layoutColorBuffer?c.layoutColorBuffer.updateData(c.layoutColorArray):c.layoutColorBuffer=e.createVertexBuffer(c.layoutColorArray,AC.members,!0),c.layoutFacadePaintArray&&(c.layoutFacadePaintBuffer?c.layoutFacadePaintBuffer.updateData(c.layoutFacadePaintArray):c.layoutFacadePaintBuffer=e.createVertexBuffer(c.layoutFacadePaintArray,jN.members,!0)),c.entranceBloom.layoutColorBuffer?c.entranceBloom.layoutColorBuffer.updateData(c.entranceBloom.layoutColorArray):c.entranceBloom.layoutColorBuffer=e.createVertexBuffer(c.entranceBloom.layoutColorArray,AC.members,!0)};n(this.buildingWithoutFacade),n(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,n){const c=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const p=n[u.promoteId],m=u.feature;m.properties["building-part"]="roof";const y=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="wall";const T=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),P=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical);m.properties["building-part"]="door";const D=e.paint.get("building-color").evaluate(m,p,this.canonical).toPremultipliedRenderColor(this.lut),L=e.paint.get("building-emissive-strength").evaluate(m,p,this.canonical),N=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const G of u.parts){let X,Y=y;G.part==="roof"?(Y=y,X=b):G.part==="wall"?(Y=T,X=A):G.part==="facade_glazing"?(Y=C,X=P):G.part==="entrance"&&(Y=D,X=L),X=W(X,0,1);for(let ie=0;ie<G.vertexLength;ie++){const _e=G.vertexOffset+ie,ue=1+(N.layoutAOArray.float32[_e]-1)*c;N.layoutColorArray.emplace(_e,Y.r*ue*255<<8|Y.g*ue*255,Y.b*ue*255<<8|255*X),u.hasFauxFacade&&N.layoutFacadePaintArray.emplace(_e,255*C.r<<8|255*C.g,255*C.b<<8|255*P)}}const V=u.buildingBloom;if(V)for(let G=0;G<V.vertexLength;G++)N.entranceBloom.layoutColorArray.emplace(V.vertexOffset+G,255*D.r<<8|255*D.g,255*D.b<<8|51*L)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,n,c){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(Lv(this.activeReplacements,u))return;this.activeReplacements=u;for(const m of this.footprints)m.hiddenFlags&=-2;const p=[];for(const m of this.activeReplacements){if(m.order<=kA)continue;const y=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>m.max.x||b.max.x<m.min.x||b.min.y>m.max.y||b.max.y<m.min.y||(p.length=0,qN(b.vertices,0,b.vertices.length,m.footprintTileId.canonical,e.canonical,p),Xb(m.footprint,p,b.indices,0,b.indices.length,0,-y)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const n=this.featureFootprintLookup.get(e.id);return this.footprints[n]}return null}getHeightAtTileCoord(e,n){let c=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+xt)*xt+(n+xt);if(this.footprintLookup.hasOwnProperty(p)){const y=this.footprintLookup[p];return y?{height:y.height,hidden:y.hiddenFlags!==0}:void 0}const m=new nt(e,n);for(const y of this.footprints)e>y.max.x||y.min.x>e||n>y.max.y||y.min.y>n||y.height<=c||Kb(m,y)&&(c=y.height,this.footprintLookup[p]=y,u=y.hiddenFlags!==0);if(c!==Number.NEGATIVE_INFINITY)return{height:c,hidden:u};this.footprintLookup[p]=void 0}}function qN(s,e,n,c,u,p){const m=Math.pow(2,c.z-u.z);for(let y=0;y<n;y++){let b=s[y+e].x,T=s[y+e].y;b=(b+u.x*xt)*m-c.x*xt,T=(T+u.y*xt)*m-c.y*xt,p.push(new nt(b,T))}}let kC,MC;zt(RC,"BuildingBucket",{omit:["layers"]}),zt(mT,"BuildingGeometry"),zt(PC,"BuildingBloomGeometry");const WN=Vr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),ZN=Vr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:XN}=WN,KN=Vr([{name:"a_packed",components:3,type:"Float32"}]),{members:YN}=KN,JN=Vr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:QN}=JN;class OC{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ih({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const c=this.getKey(e,n);return this.positions[c]}trim(){const e=this.width,n=this.height=Re(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,c){const u=[];let p=e.length%2==1?-e[e.length-1]*c:0,m=e[0]*c,y=!0;u.push({left:p,right:m,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let T=1;T<e.length;T++){y=!y;const A=e[T];p=b*c,b+=A,m=b*c,u.push({left:p,right:m,isDash:y,zeroLength:A===0})}return u}addRoundDash(e,n,c){const u=n/2;for(let p=-c;p<=c;p++){const m=this.width*(this.nextRow+c+p);let y=0,b=e[y];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++y]);const A=Math.abs(T-b.left),C=Math.abs(T-b.right),P=Math.min(A,C);let D;const L=p/c*(u+1);if(b.isDash){const N=u-Math.abs(L);D=Math.sqrt(P*P+N*N)}else D=u-Math.sqrt(P*P+L*L);this.image.data[m+T]=Math.max(0,Math.min(255,D+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const T=e[b],A=e[b+1];T.zeroLength?e.splice(b,1):A&&A.isDash===T.isDash&&(A.left=T.left,e.splice(b,1))}const c=e[0],u=e[e.length-1];c.isDash===u.isDash&&(c.left=u.left-this.width,u.right=c.right+this.width);const p=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const T=Math.abs(b-y.left),A=Math.abs(b-y.right),C=Math.min(T,A);this.image.data[p+b]=Math.max(0,Math.min(255,(y.isDash?C:-C)+n+128))}}addDash(e,n){const c=this.getKey(e,n);if(this.positions[c])return this.positions[c];const u=n==="round",p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return or("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let A=0;A<e.length;A++)e[A]<0&&(or("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),y+=e[A];if(y!==0){const A=this.width/y,C=this.getDashRanges(e,this.width,A);u?this.addRoundDash(C,A,p):this.addRegularDash(C,n==="square"?.5*A:0)}const b=this.nextRow+p;this.nextRow+=m;const T={tl:[b,p],br:[y,0]};return this.positions[c]=T,T}}zt(OC,"LineAtlas");const e5=ot.types,t5=Math.cos(Math.PI/180*37.5),r5=Math.cos(Math.PI/180*5);class gT{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new _p,this.layoutVertexArray2=new Vo,this.patternVertexArray=new Vo,this.indexArray=new rn,this.programConfigurations=new Da(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new cn,this.maxLineLength=0,this.zOffsetVertexArray=new Vo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:xt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,u){}populate(e,n,c,u){this.hasPattern=$b("line",this.layers,this.pixelRatio,n);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=xe(c);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const P=this.layers[0].layout.get("line-z-offset"),D=P.isConstant()&&!P.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&D?"none":"offset",this.elevationType==="offset"&&m==="none"&&or(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const y=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&y!==void 0;const b=[];for(const{feature:P,id:D,index:L,sourceLayerIndex:N}of e){const V=this.layers[0]._featureFilter.needGeometry,G=je(P,V);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),G,c))continue;const X=p?p.evaluate(G,{},c):void 0,Y={id:D,properties:P.properties,type:P.type,sourceLayerIndex:N,index:L,geometry:V?G.geometry:et(P,c,u),patterns:{},sortKey:X};b.push(Y)}p&&b.sort((P,D)=>P.sortKey-D.sortKey);const{lineAtlas:T,featureIndex:A}=n,C=this.addConstantDashes(T);for(const P of b){const{geometry:D,index:L,sourceLayerIndex:N}=P;if(C&&this.addFeatureDashes(P,T),this.hasPattern){const V=Gb("line",this.layers,P,this.zoom,this.pixelRatio,n);this.patternFeatures.push(V)}else this.addFeature(P,D,L,c,T.positions,n.availableImages,n.brightness,n.elevationFeatures);A.insert(e[L].feature,D,L,N,this.index)}}addConstantDashes(e){let n=!1;for(const c of this.layers){const u=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")n=!0;else{const m=p.value,y=u.value;if(!y)continue;e.addDash(y,m)}}return n}addFeatureDashes(e,n){const c=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let y,b;if(p.kind==="constant"){if(y=p.value,!y)continue}else y=p.evaluate({zoom:c},e);b=m.kind==="constant"?m.value:m.evaluate({zoom:c},e),n.addDash(y,b),e.patterns[u.id]=[n.getKey(y,b)]}}update(e,n,c,u,p,m,y,b){this.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,b)}addFeatures(e,n,c,u,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,c,u,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,YN)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,QN)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,ZN.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XN),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,n){let c,u;if(n&&n>0?(c=`mapbox_clip_start_${n}`,u=`mapbox_clip_end_${n}`):(c="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(c)&&e.properties.hasOwnProperty(u))return{start:+e.properties[c],end:+e.properties[u]}}addFeature(e,n,c,u,p,m,y,b){const T=this.layers[0].layout,A=T.get("line-join").evaluate(e,{}),C=T.get("line-cap").evaluate(e,{}),P=T.get("line-miter-limit"),D=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const L=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=T.get("line-z-offset").value;const N=this.layers[0].paint.get("line-width").value;if(N.kind!=="constant"&&N.isLineProgressConstant===!1&&(this.variableWidthValue=N),this.elevationType==="road"){const V=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,n,u,b,A,C,P,D)){const[G,X]=this.clipRuntimeLinesToTile(n,1);for(let Y=0;Y<G.length;Y++){const ie=G[Y],_e=X[Y],ue={progress:{min:_e.progress.min,max:_e.progress.max},nextDir:this.computeSegNextDir(_e,ie),prevDir:this.computeSegPrevDir(_e,ie)};this.addLine(ie,e,u,A,C,P,D,ue,L&&_e.parentIndex>0?_e.parentIndex:null)}this.fillNonElevatedRoadSegment(V)}}else for(let V=0;V<n.length;V++)this.addLine(n[V],e,u,A,C,P,D,void 0,L&&V>0?V:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,c,p,m,u,y,void 0,this.worldview)}computeSegNextDir(e,n){return e.nextPoint.sub(n.at(-2)).unit()}computeSegPrevDir(e,n){return n[1].sub(e.prevPoint).unit()}clipLinesToTile(e,n){return Bv(e,-n,-n,xt+n,xt+n)}clipRuntimeLinesToTile(e,n){const c=[];return[Bv(e,-n,-n,xt+n,xt+n,c),c]}addElevatedRoadFeature(e,n,c,u,p,m,y,b){const T=[],A=xr.getElevationFeature(e,u);if(A){const C=this.clipLinesToTile(n,1),P=this.prepareElevatedLines(C,A,c);for(const D of P)T.push({geometry:D,elevation:A,elevationTileID:c,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const C of T){const P=this.layoutVertexArray.length;this.addLine(C.geometry,e,c,p,m,y,b);const D=new ri(c,C.elevationTileID);if(C.elevation)for(let L=P;L<this.layoutVertexArray.length;L++){const N=new nt(this.layoutVertexArray.int16[6*L]>>1,this.layoutVertexArray.int16[6*L+1]>>1),V=D.pointElevation(N,C.elevation,.05);this.updateHeightRange(V),this.zOffsetVertexArray.emplaceBack(V,0,0)}else this.fillNonElevatedRoadSegment(P)}return!0}prepareElevatedLines(e,n,c){if(n.constantHeight!=null)return e;const u=[],p=1/xe(c);for(const m of e)pN(m,new $i(n,p),0,u);return u}fillNonElevatedRoadSegment(e){for(let n=e;n<this.layoutVertexArray.length;n++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,n,c,u,p,m,y,b,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=T?this.lineFeatureClips(n,T):this.lineClips;const A=u==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=b&&b.progress.min>0,P=b&&b.progress.max<1;if(this.lineClips){let Ae={min:this.lineClips.start,max:this.lineClips.end},Ze=1;if(b){const tt=this.lineClips.end-this.lineClips.start;Ae=function(st,yt,ht){return{min:Ri(st.min,yt,ht),max:Ri(st.max,yt,ht)}}(b.progress,{min:0,max:1},Ae),tt>0&&(Ze=(Ae.max-Ae.min)/tt)}const ze=+n.properties.mapbox_clip_feature_len,Ke=+n.properties.mapbox_clip_seg_len;if(Number.isNaN(ze)||Number.isNaN(Ke)){for(let st=0;st<e.length-1;st++)this.totalDistance+=e[st].dist(e[st+1]);const tt=this.totalDistance/(Ae.max-Ae.min);this.totalFeatureLength=Number.isFinite(tt)?tt:0,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ze,this.distance=Ke*Ze,this.lineClips.start=Ae.min,this.lineClips.end=Ae.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=e5[n.type]==="Polygon";let L=e.length;for(;L>=2&&e[L-1].equals(e[L-2]);)L--;let N=0;for(;N<L-1&&e[N].equals(e[N+1]);)N++;if(L<(D?3:2))return;u==="bevel"&&(m=1.05);const V=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let G,X,Y,ie,_e,ue,be,Ee;b&&b.prevDir&&(ue=b.prevDir.perp()),b&&b.nextDir&&(be=b.nextDir.perp()),this.e1=this.e2=-1,D&&(G=e[L-2],_e=e[N].sub(G)._unit()._perp());for(let Ae=N;Ae<L;Ae++){if(Y=Ae===L-1?D?e[N+1]:void 0:e[Ae+1],Y&&e[Ae].equals(Y))continue;_e&&(ie=_e),G&&(X=G),G=e[Ae],Ee=this.evaluateLineProgressFeatures(X?X.dist(G):0),_e=Y?Y.sub(G)._unit()._perp():ie,ie=ie||_e;const Ze=X&&Y;let ze=Ze?u:D||A?"butt":p;const Ke=ie.x*_e.x+ie.y*_e.y;if(A){const $e=function(at){if(at.patternJoinNone){const mt=at.segmentPoints.length/2,it=at.lineSoFar-at.segmentStart;for(let Lt=0;Lt<mt;++Lt){const Vt=at.segmentPoints[2*Lt+1],kt=Math.round(at.segmentPoints[2*Lt])+.5+.25*Vt;at.patternVertexArray.emplaceBack(kt,it,at.segmentStart),at.patternVertexArray.emplaceBack(kt,it,at.segmentStart)}at.segmentPoints.length=0}at.e1=at.e2=-1};if(Ze&&Ke<r5){this.updateDistance(X,G),this.addCurrentVertex(G,ie,1,1,V,Ee),$e(this),this.addCurrentVertex(G,_e,-1,-1,V,Ee);continue}if(X){if(!Y){this.updateDistance(X,G),this.addCurrentVertex(G,ie,1,1,V,Ee),$e(this);continue}ze="miter"}}let tt=ie.add(_e);tt.x===0&&tt.y===0||tt._unit();const st=tt.x*_e.x+tt.y*_e.y,yt=st!==0?1/st:1/0,ht=2*Math.sqrt(2-2*st),rt=st<t5&&X&&Y,ut=ie.x*_e.y-ie.y*_e.x>0,He=this.overscaling<=16?15*xt/(512*this.overscaling):0;if(Ze&&ze==="round"){if(yt<y)ze="miter";else if(yt<=2){const $e=_T(G,-10,xt+10);ze=this.elevationType==="offset"&&($e||this.hasCrossSlope)?"miter":"fakeround"}}if(ze==="miter"&&yt>m&&(ze="bevel"),ze==="bevel"&&(yt>2&&(ze="flipbevel"),yt<m&&(ze="miter")),X&&!(ze==="miter"&&rt)&&this.updateDistance(X,G),ze==="miter")if(rt){const $e=G.dist(X);if($e>2*He){const mt=G.sub(G.sub(X)._mult(He/$e)._round());this.updateDistance(X,mt),this.addCurrentVertex(mt,ie,0,0,V,Ee),X=mt}this.updateDistance(X,G),tt._mult(yt),this.addCurrentVertex(G,tt,0,0,V,Ee);const at=G.dist(Y);if(at>2*He){const mt=G.add(Y.sub(G)._mult(He/at)._round());this.updateDistance(G,mt),this.addCurrentVertex(mt,_e,0,0,V,Ee),G=mt}}else tt._mult(yt),this.addCurrentVertex(G,tt,0,0,V,Ee);else if(ze==="flipbevel"){if(yt>100)tt=_e.mult(-1);else{const $e=yt*ie.add(_e).mag()/ie.sub(_e).mag();tt._perp()._mult($e*(ut?-1:1))}this.addCurrentVertex(G,tt,0,0,V,Ee),this.addCurrentVertex(G,tt.mult(-1),0,0,V,Ee)}else if(ze==="bevel"||ze==="fakeround"){Ee!=null&&X&&this.addCurrentVertex(G,be||ie,-1,-1,V,Ee);const $e=G.dist(X)<=2*He&&ze!=="bevel",at=tt.mult(ut?1:-1);at._mult(yt);const mt=_e.mult(ut?-1:1),it=ie.mult(ut?-1:1),Lt=this.evaluateLineProgressFeatures(this.distance);if(Ee==null&&(this.addHalfVertex(G,at.x,at.y,!1,!ut,0,V,Lt),$e||this.addHalfVertex(G,at.x+2*it.x,at.y+2*it.y,!1,ut,0,V,Lt)),ze==="fakeround"){const Vt=Math.round(180*ht/Math.PI/20);this.addHalfVertex(G,it.x,it.y,!1,ut,0,V,Lt);for(let kt=0;kt<Vt;kt++){let St=kt/Vt;if(St!==.5){const At=St-.5;St+=St*At*(St-1)*((1.0904+Ke*(Ke*(3.55645-1.43519*Ke)-3.2452))*At*At+(.848013+Ke*(.215638*Ke-1.06021)))}const wr=mt.sub(it)._mult(St)._add(it)._unit();this.addHalfVertex(G,wr.x,wr.y,!1,ut,0,V,Lt)}this.addHalfVertex(G,mt.x,mt.y,!1,ut,0,V,Lt)}$e||Ee!=null||this.addHalfVertex(G,at.x+2*mt.x,at.y+2*mt.y,!1,ut,0,V,Lt),Ee!=null&&Y&&this.addCurrentVertex(G,ue||_e,1,1,V,Ee)}else if(ze==="butt")this.addCurrentVertex(G,tt,0,0,V,Ee);else if(ze==="square"){if(!X){const $e=C?0:-1;this.addCurrentVertex(G,tt,$e,$e,V,Ee)}if(this.addCurrentVertex(G,tt,0,0,V,Ee),X){const $e=P?0:1;this.addCurrentVertex(G,tt,$e,$e,V,Ee)}}else if(ze==="round"){if(X){const $e=!Ze&&be?be:ie;this.addCurrentVertex(G,$e,0,0,V,Ee),!Ze&&P||this.addCurrentVertex(G,$e,1,1,V,Ee,!0)}if(Y){const $e=!Ze&&ue?ue:_e;!Ze&&C||this.addCurrentVertex(G,$e,-1,-1,V,Ee,!0),this.addCurrentVertex(G,$e,0,0,V,Ee)}}}}addVerticesTo(e,n,c,u,p,m,y,b,T,A){const C=(n.w-e.w)/this.tessellationStep|0;let P=0;const D=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const N=(n.x-e.x)/C,V=(n.y-e.y)/C,G=(n.z-e.z)/C,X=(n.w-e.w)/C;for(let Y=1;Y<C;++Y){e.x+=N,e.y+=V,e.z+=G,this.lineSoFar+=X,P+=X;const ie=this.evaluateLineProgressFeatures(this.prevDistance+P);this.scaledDistance=(this.prevDistance+P)/this.totalDistance,this.addHalfVertex(e,c,u,A,!1,y,T,ie),this.addHalfVertex(e,p,m,A,!0,-b,T,ie)}}this.lineSoFar=n.w,this.scaledDistance=D;const L=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,c,u,A,!1,y,T,L),this.addHalfVertex(n,p,m,A,!0,-b,T,L)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):or(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:n}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}}addCurrentVertex(e,n,c,u,p,m,y=!1){const b=n.x+n.y*c,T=n.y-n.x*c,A=n.y*u-n.x,C=-n.y-n.x*u;if(m!=null){const P=this.elevationType==="offset",D=-10,L=xt+10,N=m.zOffset,V=new eC(e.x,e.y,N,this.lineSoFar),G=!!P&&_T(e,D,L),X=this.lineSoFar,Y=this.distance;if(this.currentVertex)if(G){const ie=this.currentVertexIsOutside,_e=this.currentVertex,ue=new eC(e.x,e.y,N,this.lineSoFar);if(rC(_e,ue,D,L),!_T(ue,D,L)){if(ie){this.e1=this.e2=-1,this.distance-=_e.dist(V),this.lineSoFar=_e.w;const be=this.evaluateLineProgressFeatures(_e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(_e,b,T,y,!1,c,p,be),this.addHalfVertex(_e,A,C,y,!0,-u,p,be),this.prevDistance=this.distance}this.distance=this.prevDistance+_e.dist(ue),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(_e,ue,b,T,A,C,c,u,p,y),this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}}else{const ie=this.currentVertex;if(this.currentVertexIsOutside){rC(ie,V,D,L),this.e1=this.e2=-1,this.distance-=ie.dist(V),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ie.w;const _e=this.evaluateLineProgressFeatures(ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ie,b,T,y,!1,c,p,_e),this.addHalfVertex(ie,A,C,y,!0,-u,p,_e),this.prevDistance=this.distance,this.distance=Y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ie,V,b,T,A,C,c,u,p,y)}else G||(this.addHalfVertex(e,b,T,y,!1,c,p,m),this.addHalfVertex(e,A,C,y,!0,-u,p,m));this.currentVertex=V,this.currentVertexIsOutside=G,this.lineSoFar=X}else this.addHalfVertex(e,b,T,y,!1,c,p,m),this.addHalfVertex(e,A,C,y,!0,-u,p,m)}addHalfVertex({x:e,y:n},c,u,p,m,y,b,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(n<<1)+(m?1:0),Math.round(63*c)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=pr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const A=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),b.primitiveLength++),m?this.e2=A:this.e1=A,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function _T(s,e,n){return s.x<e||s.x>n||s.y<e||s.y>n}let DC,LC;function zC(s,e,n){return e*(xt/(s.tileSize*Math.pow(2,n-s.tileID.overscaledZ)))}zt(gT,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const FC=(s,e,n)=>(1-n)*s+n*e;function BC(s,e){return 1/zC(s,1,e.tileZoom)}function NC(s,e,n,c){return s.translatePosMatrix(c||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const jC=s=>{const e=[];VC(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=s.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const c=s.layout.get("line-join").constantOr("miter")==="none",u=!!s.paint.get("line-pattern").constantOr(1);return c&&u&&e.push("LINE_JOIN_NONE"),e};function VC(s){const e=s.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let yT;const UC=()=>yT||(yT={layout:DC||(DC=new gn({"line-cap":new Pt(Le.layout_line["line-cap"]),"line-join":new Pt(Le.layout_line["line-join"]),"line-miter-limit":new ft(Le.layout_line["line-miter-limit"]),"line-round-limit":new ft(Le.layout_line["line-round-limit"]),"line-sort-key":new Pt(Le.layout_line["line-sort-key"]),"line-z-offset":new Pt(Le.layout_line["line-z-offset"]),"line-elevation-reference":new ft(Le.layout_line["line-elevation-reference"]),"line-cross-slope":new ft(Le.layout_line["line-cross-slope"]),visibility:new ft(Le.layout_line.visibility),"line-width-unit":new ft(Le.layout_line["line-width-unit"])})),paint:LC||(LC=new gn({"line-opacity":new Pt(Le.paint_line["line-opacity"]),"line-color":new Pt(Le.paint_line["line-color"]),"line-translate":new ft(Le.paint_line["line-translate"]),"line-translate-anchor":new ft(Le.paint_line["line-translate-anchor"]),"line-width":new Pt(Le.paint_line["line-width"]),"line-gap-width":new Pt(Le.paint_line["line-gap-width"]),"line-offset":new Pt(Le.paint_line["line-offset"]),"line-blur":new Pt(Le.paint_line["line-blur"]),"line-dasharray":new Pt(Le.paint_line["line-dasharray"]),"line-pattern":new Pt(Le.paint_line["line-pattern"]),"line-pattern-cross-fade":new ft(Le.paint_line["line-pattern-cross-fade"]),"line-gradient":new Vu(Le.paint_line["line-gradient"]),"line-trim-offset":new ft(Le.paint_line["line-trim-offset"]),"line-trim-fade-range":new ft(Le.paint_line["line-trim-fade-range"]),"line-trim-color":new ft(Le.paint_line["line-trim-color"]),"line-emissive-strength":new ft(Le.paint_line["line-emissive-strength"]),"line-border-width":new Pt(Le.paint_line["line-border-width"]),"line-border-color":new Pt(Le.paint_line["line-border-color"]),"line-occlusion-opacity":new ft(Le.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},yT);class i5 extends Pt{possiblyEvaluate(e,n){return n=new Ui(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition,worldview:n.worldview}),super.possiblyEvaluate(e,n)}evaluate(e,n,c,u){return n=Object.assign({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,c,u)}}let $_;function $C(s,e){return e>0?e+2*s:s}const n5=Vr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),s5=Vr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),o5=Vr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Vr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const a5=Vr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),l5=Vr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),c5=Vr([{name:"a_texb",components:2,type:"Uint16"}]),u5=Vr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),h5=Vr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const GC=Vr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),d5=Vr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Vr([{name:"triangle",components:3,type:"Uint16"}]),Vr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Vr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Vr([{type:"Float32",name:"offsetX"}]),Vr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vs=24;function f5(s,e,n){return s.sections.forEach(c=>{c.text=function(u,p,m){const y=p.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),So.applyArabicShaping&&(u=So.applyArabicShaping(u)),u}(c.text,e,n)}),s}const G_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function p5(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function m5(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}const vT=4294967296,HC=1/vT,qC=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Xv=class{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,e,n=this.length){for(;this.pos<n;){const c=this.readVarint(),u=c>>3,p=this.pos;this.type=7&c,s(u,e,this),this.pos===p&&this.skip(c)}return e}readMessage(s,e){return this.readFields(s,e,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*vT;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*vT;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const e=this.buf;let n,c;return c=e[this.pos++],n=127&c,c<128?n:(c=e[this.pos++],n|=(127&c)<<7,c<128?n:(c=e[this.pos++],n|=(127&c)<<14,c<128?n:(c=e[this.pos++],n|=(127&c)<<21,c<128?n:(c=e[this.pos],n|=(15&c)<<28,function(u,p,m){const y=m.buf;let b,T;if(T=y[m.pos++],b=(112&T)>>4,T<128||(T=y[m.pos++],b|=(127&T)<<3,T<128)||(T=y[m.pos++],b|=(127&T)<<10,T<128)||(T=y[m.pos++],b|=(127&T)<<17,T<128)||(T=y[m.pos++],b|=(127&T)<<24,T<128)||(T=y[m.pos++],b|=(1&T)<<31,T<128))return Bp(u,b,p);throw new Error("Expected varint not more than 10 bytes")}(n,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&qC?qC.decode(this.buf.subarray(e,s)):function(n,c,u){let p="",m=c;for(;m<u;){const y=n[m];let b,T,A,C=null,P=y>239?4:y>223?3:y>191?2:1;if(m+P>u)break;P===1?y<128&&(C=y):P===2?(b=n[m+1],(192&b)==128&&(C=(31&y)<<6|63&b,C<=127&&(C=null))):P===3?(b=n[m+1],T=n[m+2],(192&b)==128&&(192&T)==128&&(C=(15&y)<<12|(63&b)<<6|63&T,(C<=2047||C>=55296&&C<=57343)&&(C=null))):P===4&&(b=n[m+1],T=n[m+2],A=n[m+3],(192&b)==128&&(192&T)==128&&(192&A)==128&&(C=(15&y)<<18|(63&b)<<12|(63&T)<<6|63&A,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,P=1):C>65535&&(C-=65536,p+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),p+=String.fromCharCode(C),m+=P}return p}(this.buf,e,s)}readBytes(){const s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e}readPackedVarint(s=[],e){const n=this.readPackedEnd();for(;this.pos<n;)s.push(this.readVarint(e));return s}readPackedSVarint(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const e=7&s;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(s,e){this.writeVarint(s<<3|e)}realloc(s){let e=this.length||16;for(;e<this.pos+s;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*HC),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*HC),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?function(e,n){let c,u;if(e>=0?(c=e%4294967296|0,u=e/4294967296|0):(c=~(-e%4294967296),u=~(-e/4294967296),4294967295^c?c=c+1|0:(c=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(p,m,y){y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,y.buf[y.pos]=127&(p>>>=7)}(c,0,n),function(p,m){const y=(7&p)<<4;m.buf[m.pos++]|=y|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(u,n)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const e=this.pos;this.pos=function(c,u,p){for(let m,y,b=0;b<u.length;b++){if(m=u.charCodeAt(b),m>55295&&m<57344){if(!y){m>56319||b+1===u.length?(c[p++]=239,c[p++]=191,c[p++]=189):y=m;continue}if(m<56320){c[p++]=239,c[p++]=191,c[p++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(c[p++]=239,c[p++]=191,c[p++]=189,y=null);m<128?c[p++]=m:(m<2048?c[p++]=m>>6|192:(m<65536?c[p++]=m>>12|224:(c[p++]=m>>18|240,c[p++]=m>>12&63|128),c[p++]=m>>6&63|128),c[p++]=63&m|128)}return p}(this.buf,s,this.pos);const n=this.pos-e;n>=128&&WC(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const e=s.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=s[n]}writeRawMessage(s,e){this.pos++;const n=this.pos;s(e,this);const c=this.pos-n;c>=128&&WC(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeMessage(s,e,n){this.writeTag(s,2),this.writeRawMessage(e,n)}writePackedVarint(s,e){e.length&&this.writeMessage(s,g5,e)}writePackedSVarint(s,e){e.length&&this.writeMessage(s,_5,e)}writePackedBoolean(s,e){e.length&&this.writeMessage(s,x5,e)}writePackedFloat(s,e){e.length&&this.writeMessage(s,y5,e)}writePackedDouble(s,e){e.length&&this.writeMessage(s,v5,e)}writePackedFixed32(s,e){e.length&&this.writeMessage(s,w5,e)}writePackedSFixed32(s,e){e.length&&this.writeMessage(s,b5,e)}writePackedFixed64(s,e){e.length&&this.writeMessage(s,T5,e)}writePackedSFixed64(s,e){e.length&&this.writeMessage(s,S5,e)}writeBytesField(s,e){this.writeTag(s,2),this.writeBytes(e)}writeFixed32Field(s,e){this.writeTag(s,5),this.writeFixed32(e)}writeSFixed32Field(s,e){this.writeTag(s,5),this.writeSFixed32(e)}writeFixed64Field(s,e){this.writeTag(s,1),this.writeFixed64(e)}writeSFixed64Field(s,e){this.writeTag(s,1),this.writeSFixed64(e)}writeVarintField(s,e){this.writeTag(s,0),this.writeVarint(e)}writeSVarintField(s,e){this.writeTag(s,0),this.writeSVarint(e)}writeStringField(s,e){this.writeTag(s,2),this.writeString(e)}writeFloatField(s,e){this.writeTag(s,5),this.writeFloat(e)}writeDoubleField(s,e){this.writeTag(s,1),this.writeDouble(e)}writeBooleanField(s,e){this.writeVarintField(s,+e)}};function Bp(s,e,n){return n?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function WC(s,e,n){const c=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(c);for(let u=n.pos-1;u>=s;u--)n.buf[u+c]=n.buf[u]}function g5(s,e){for(let n=0;n<s.length;n++)e.writeVarint(s[n])}function _5(s,e){for(let n=0;n<s.length;n++)e.writeSVarint(s[n])}function y5(s,e){for(let n=0;n<s.length;n++)e.writeFloat(s[n])}function v5(s,e){for(let n=0;n<s.length;n++)e.writeDouble(s[n])}function x5(s,e){for(let n=0;n<s.length;n++)e.writeBoolean(s[n])}function w5(s,e){for(let n=0;n<s.length;n++)e.writeFixed32(s[n])}function b5(s,e){for(let n=0;n<s.length;n++)e.writeSFixed32(s[n])}function T5(s,e){for(let n=0;n<s.length;n++)e.writeFixed64(s[n])}function S5(s,e){for(let n=0;n<s.length;n++)e.writeSFixed64(s[n])}const xT=3;function E5(s,e,n){e.glyphs=[],s===1&&n.readMessage(I5,e)}function I5(s,e,n){if(s===3){const{id:c,bitmap:u,width:p,height:m,left:y,top:b,advance:T}=n.readMessage(A5,{});e.glyphs.push({id:c,bitmap:new ih({width:p+2*xT,height:m+2*xT},u),metrics:{width:p,height:m,left:y,top:b,advance:T}})}else s===4?e.ascender=n.readSVarint():s===5&&(e.descender=n.readSVarint())}function A5(s,e,n){s===1?e.id=n.readVarint():s===2?e.bitmap=n.readBytes():s===3?e.width=n.readVarint():s===4?e.height=n.readVarint():s===5?e.left=n.readSVarint():s===6?e.top=n.readSVarint():s===7&&(e.advance=n.readVarint())}const ZC=xT,Zo={horizontal:1,vertical:2,horizontalOnly:3};class H_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const c=new H_;return c.scale=e||1,c.fontStack=n,c}static forImage(e){const n=new H_;return n.image=e,n}}class Np{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,c){const u=new Np;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?u.addImageSection(m,c):u.addTextSection(m,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,c){let u="";for(let p=0;p<n.length;p++){const m=n.charCodeAt(p+1)||null,y=n.charCodeAt(p-1)||null;u+=!c&&(m&&Xg(m)&&!G_[n[p+1]]||y&&Xg(y)&&!G_[n[p-1]])||!G_[n[p]]?n[p]:G_[n[p]]}return u}(this.text,e)}trim(){let e=0;for(let c=0;c<this.text.length&&Kv[this.text.charCodeAt(c)];c++)e++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=e&&Kv[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const c=new Np;return c.text=this.text.substring(e,n),c.sectionIndex=this.sectionIndex.slice(e,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(H_.forText(e.scale,e.fontStack||n));const c=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(c)}addImageSection(e,n){const c=e.image?e.image.getPrimary():null;if(!c)return void or("Can't add FormattedSection with an empty image.");c.scaleSelf(n);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(H_.forImage(c)),this.sectionIndex.push(this.sections.length-1)):or("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wT(s,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N=1){const V=Np.fromFeature(s,u,N);C===Zo.vertical&&V.verticalizePunctuation(P);let G=[];const X=function(be,Ee,Ae,Ze,ze,Ke){if(!be)return[];const tt=[],st=function(ut,He,$e,at,mt,it){let Lt=0;for(let Vt=0;Vt<ut.length();Vt++){const kt=ut.getSection(Vt);Lt+=XC(ut.getCodePoint(Vt),kt,at,mt,He,it)}return Lt/Math.max(1,Math.ceil(Lt/$e))}(be,Ee,Ae,Ze,ze,Ke),yt=be.text.indexOf("")>=0;let ht=0;for(let ut=0;ut<be.length();ut++){const He=be.getSection(ut),$e=be.getCodePoint(ut);if(Kv[$e]||(ht+=XC($e,He,Ze,ze,Ee,Ke)),ut<be.length()-1){const at=!((rt=$e)<11904||!(ar["Bopomofo Extended"](rt)||ar.Bopomofo(rt)||ar["CJK Compatibility Forms"](rt)||ar["CJK Compatibility Ideographs"](rt)||ar["CJK Compatibility"](rt)||ar["CJK Radicals Supplement"](rt)||ar["CJK Strokes"](rt)||ar["CJK Symbols and Punctuation"](rt)||ar["CJK Unified Ideographs Extension A"](rt)||ar["CJK Unified Ideographs"](rt)||ar["Enclosed CJK Letters and Months"](rt)||ar["Halfwidth and Fullwidth Forms"](rt)||ar.Hiragana(rt)||ar["Ideographic Description Characters"](rt)||ar["Kangxi Radicals"](rt)||ar["Katakana Phonetic Extensions"](rt)||ar.Katakana(rt)||ar["Vertical Forms"](rt)||ar["Yi Radicals"](rt)||ar["Yi Syllables"](rt)));(C5[$e]||at||He.image)&&tt.push(YC(ut+1,ht,st,tt,P5($e,be.getCodePoint(ut+1),at&&yt),!1))}}var rt;return JC(YC(be.length(),ht,st,tt,0,!0))}(V,T,p,e,c,D),{processBidirectionalText:Y,processStyledBidirectionalText:ie}=So;if(Y&&V.sections.length===1){const be=Y(V.toString(),X);for(const Ee of be){const Ae=new Np;Ae.text=Ee,Ae.sections=V.sections;for(let Ze=0;Ze<Ee.length;Ze++)Ae.sectionIndex.push(0);G.push(Ae)}}else if(ie){const be=ie(V.text,V.sectionIndex,X);for(const Ee of be){const Ae=new Np;Ae.text=Ee[0],Ae.sectionIndex=Ee[1],Ae.sections=V.sections,G.push(Ae)}}else G=function(be,Ee){const Ae=[],Ze=be.text;let ze=0;for(const Ke of Ee)Ae.push(be.substring(ze,Ke)),ze=Ke;return ze<Ze.length&&Ae.push(be.substring(ze,Ze.length)),Ae}(V,X);const _e=[],ue={positionedLines:_e,text:V.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(be,Ee,Ae,Ze,ze,Ke,tt,st,yt,ht,rt,ut){let He=0,$e=0,at=0;const mt=st==="right"?1:st==="left"?0:.5;let it=!1;for(const At of ze){const ir=At.getSections();for(const Er of ir){if(Er.image)continue;const Fr=Ee[Er.fontStack];if(Fr&&(it=Fr.ascender!==void 0&&Fr.descender!==void 0,!it))break}if(!it)break}let Lt=0;for(const At of ze){At.trim();const ir=At.getMaxScale(),Er=(ir-1)*vs,Fr={positionedGlyphs:[],lineOffset:0};be.positionedLines[Lt]=Fr;const ii=Fr.positionedGlyphs;let Ar=0;if(!At.length()){$e+=Ke,++Lt;continue}let li=0,ci=0;for(let he=0;he<At.length();he++){const ae=At.getSection(he),Ye=At.getSectionIndex(he),Tt=At.getCodePoint(he);let Je=ae.scale,Et=null,Kt=null,Wt=null,Cr=vs,hr=0,Ht=yt;Ht===Zo.vertical&&((Vt=Tt)===12312||Vt===12313||Vt===12316||Vt===12540||Vt===12448)&&(Ht=Zo.horizontal);const ai=!(Ht===Zo.horizontal||!rt&&!dp(Tt)||rt&&(Kv[Tt]||Kg(Tt)));if(ae.image){const ki=Ze.get(ae.image.toString());if(!ki)continue;Wt=ae.image,be.iconsInText=be.iconsInText||!0,Kt=ki.paddedRect;const fr=ki.displaySize;Je=Je*vs/ut,Et={width:fr[0],height:fr[1],left:0,top:-ZC,advance:ai?fr[1]:fr[0],localGlyph:!1},hr=it?-Et.height*Je:ir*vs-17-fr[1]*Je,Cr=Et.advance;const ei=(ai?fr[0]:fr[1])*Je-vs*ir;ei>0&&ei>Ar&&(Ar=ei)}else{const ki=Ae[ae.fontStack];if(!ki)continue;ki[Tt]&&(Kt=ki[Tt]);const fr=Ee[ae.fontStack];if(!fr)continue;const ei=fr.glyphs[Tt];if(!ei)continue;if(Et=ei.metrics,Cr=Tt!==8203?vs:0,it){const Mi=fr.ascender!==void 0?Math.abs(fr.ascender):0,vi=fr.descender!==void 0?Math.abs(fr.descender):0,pn=(Mi+vi)*Je;li<pn&&(li=pn,ci=(Mi-vi)/2*Je),hr=-Mi*Je}else hr=(ir-Je)*vs-17}ai?(be.verticalizable=!0,ii.push({glyph:Tt,image:Wt,x:He,y:$e+hr,vertical:ai,scale:Je,localGlyph:Et.localGlyph,fontStack:ae.fontStack,sectionIndex:Ye,metrics:Et,rect:Kt}),He+=Cr*Je+ht):(ii.push({glyph:Tt,image:Wt,x:He,y:$e+hr,vertical:ai,scale:Je,localGlyph:Et.localGlyph,fontStack:ae.fontStack,sectionIndex:Ye,metrics:Et,rect:Kt}),He+=Et.advance*Je+ht)}ii.length!==0&&(at=Math.max(He-ht,at),it?QC(ii,mt,Ar,ci,Ke*ir/2):QC(ii,mt,Ar,0,Ke/2)),He=0;const an=Ke*ir+Ar;Fr.lineOffset=Math.max(Ar,Er),$e+=an,++Lt}var Vt;const kt=$e,{horizontalAlign:St,verticalAlign:wr}=bT(tt);(function(At,ir,Er,Fr,ii,Ar){const li=(ir-Er)*ii,ci=-Ar*Fr;for(const an of At)for(const he of an.positionedGlyphs)he.x+=li,he.y+=ci})(be.positionedLines,mt,St,wr,at,kt),be.top+=-wr*kt,be.bottom=be.top+kt,be.left+=-St*at,be.right=be.left+at,be.hasBaseline=it}(ue,e,n,c,G,m,y,b,C,T,P,L),!function(be){for(const Ee of be)if(Ee.positionedGlyphs.length!==0)return!1;return!0}(_e))return ue}const Kv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},C5={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function XC(s,e,n,c,u,p){if(e.image){const m=c.get(e.image.toString());return m?m.displaySize[0]*e.scale*vs/p+u:0}{const m=n[e.fontStack],y=m&&m.glyphs[s];return y?y.metrics.advance*e.scale+u:0}}function KC(s,e,n,c){const u=Math.pow(s-e,2);return c?s<e?u/2:2*u:u+Math.abs(n)*n}function P5(s,e,n){let c=0;return s===10&&(c-=1e4),n&&(c+=150),s!==40&&s!==65288||(c+=50),e!==41&&e!==65289||(c+=50),c}function YC(s,e,n,c,u,p){let m=null,y=KC(e,n,u,p);for(const b of c){const T=KC(e-b.x,n,u,p)+b.badness;T<=y&&(m=b,y=T)}return{index:s,x:e,priorBreak:m,badness:y}}function JC(s){return s?JC(s.priorBreak).concat(s.index):[]}function bT(s){let e=.5,n=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function QC(s,e,n,c,u){if(!(e||n||c||u))return;const p=s.length-1,m=s[p],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=p;b++)s[b].x-=y,s[b].y+=n+c+u}function eP(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function Yv(s,e,n,c){const{horizontalAlign:u,verticalAlign:p}=bT(c),m=n[0]-s.displaySize[0]*u,y=n[1]-s.displaySize[1]*p;return{imagePrimary:s,imageSecondary:e,top:y,bottom:y+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function TT(s,e,n,c,u,p){const m=s.imagePrimary;let y;if(m.content){const V=m.content,G=m.pixelRatio||1;y=[V[0]/G,V[1]/G,m.displaySize[0]-V[2]/G,m.displaySize[1]-V[3]/G]}const b=e.left*p,T=e.right*p;let A,C,P,D;n==="width"||n==="both"?(D=u[0]+b-c[3],C=u[0]+T+c[1]):(D=u[0]+(b+T-m.displaySize[0])/2,C=D+m.displaySize[0]);const L=e.top*p,N=e.bottom*p;return n==="height"||n==="both"?(A=u[1]+L-c[0],P=u[1]+N+c[2]):(A=u[1]+(L+N-m.displaySize[1])/2,P=A+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:A,right:C,bottom:P,left:D,collisionPadding:y}}function tP(s){return!s.imagePrimary.stretchX}function rP(s){return!s.imagePrimary.stretchY}function iP(s){return{width:s.right-s.left,height:s.bottom-s.top}}const Al=128;function jp(s,e,n){const{expression:c}=e;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Ui(s+1,{worldview:n}))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=c;let m=0;for(;m<u.length&&u[m]<=s;)m++;m=Math.max(0,m-1);let y=m;for(;y<u.length&&u[y]<s+1;)y++;y=Math.min(u.length-1,y);const b=u[m],T=u[y];return c.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:T,minSize:c.evaluate(new Ui(b,{worldview:n})),maxSize:c.evaluate(new Ui(T,{worldview:n})),interpolationType:p}}}function ST(s,{uSize:e,uSizeT:n},{lowerSize:c,upperSize:u}){return s.kind==="source"?c/Al:s.kind==="composite"?pr(c/Al,u/Al,n):e}function Vp(s,e,n=1){let c=0,u=0;if(s.kind==="constant")u=s.layoutSize*n;else if(s.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:y}=s,b=p?W(No.interpolationFactor(p,e,m,y),0,1):0;s.kind==="camera"?u=pr(s.minSize,s.maxSize,b)*n:c=b*n}return{uSizeT:c,uSize:u}}class Jc extends nt{constructor(e,n,c,u,p){super(e,n),this.angle=u,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new Jc(this.x,this.y,this.z,this.angle,this.segment)}}function nP(s,e,n,c,u){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,y=0;for(;y>-n/2;){if(m--,m<0)return!1;y-=s[m].dist(p),p=s[m]}y+=s[m].dist(s[m+1]),m++;const b=[];let T=0;for(;y<n/2;){const A=s[m],C=s[m+1];if(!C)return!1;let P=s[m-1].angleTo(A)-A.angleTo(C);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),T+=P;y-b[0].distance>c;)T-=b.shift().angleDelta;if(T>u)return!1;m++,y+=A.dist(C)}return!0}function sP(s){let e=0;for(let n=0;n<s.length-1;n++)e+=s[n].dist(s[n+1]);return e}function oP(s,e,n){return s?.6*e*n:0}function aP(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function R5(s,e,n,c,u,p){const m=oP(n,u,p),y=aP(n,c)*p;let b=0;const T=sP(s)/2;for(let A=0;A<s.length-1;A++){const C=s[A],P=s[A+1],D=C.dist(P);if(b+D>T){const L=(T-b)/D,N=pr(C.x,P.x,L),V=pr(C.y,P.y,L),G=new Jc(N,V,0,P.angleTo(C),A);return!m||nP(s,G,y,m,e)?G:void 0}b+=D}}function k5(s,e,n,c,u,p,m,y,b){const T=oP(c,p,m),A=aP(c,u),C=A*m,P=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-C<e/4&&(e=C+e/4),lP(s,P?e/2*y%e:(A/2+2*p)*m*y%e,e,T,n,C,P,!1,b)}function lP(s,e,n,c,u,p,m,y,b){const T=p/2,A=sP(s);let C=0,P=e-n,D=[];for(let L=0;L<s.length-1;L++){const N=s[L],V=s[L+1],G=N.dist(V),X=V.angleTo(N);for(;P+n<C+G;){P+=n;const Y=(P-C)/G,ie=pr(N.x,V.x,Y),_e=pr(N.y,V.y,Y);if(ie>=0&&ie<b&&_e>=0&&_e<b&&P-T>=0&&P+T<=A){const ue=new Jc(ie,_e,0,X,L);c&&!nP(s,ue,p,c,u)||D.push(ue)}}C+=G}return y||D.length||m||(D=lP(s,C/2,n,c,u,p,m,!0,b)),D}function cP(s){let e=0,n=0;for(const m of s)e+=m.w*m.h,n=Math.max(n,m.w);s.sort((m,y)=>y.h-m.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,p=0;for(const m of s)for(let y=c.length-1;y>=0;y--){const b=c[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const T=c.pop();T&&y<c.length&&(c[y]=T)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(c.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}zt(Jc,"Anchor");const qd=1;class q_{static getImagePositionScale(e,n,c){if(n&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:c,y:c}}constructor(e,n,c,u){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:y,stretchY:b,content:T,sdf:A,usvg:C}=n;this.pixelRatio=p,this.stretchX=y,this.stretchY=b,this.content=T,this.version=m,this.padding=c,this.sdf=A,this.usvg=C,this.scale=q_.getImagePositionScale(u,C,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function ET(s,e,n){const c=gl.parse(s),u=function(p,m,y=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*y[0])+2*m,h:(p.data?p.data.height:p.height*y[1])+2*m}}(e,n,[c.options.transform.a,c.options.transform.d]);return{bin:u,imagePosition:new q_(u,e,n,c),imageVariant:c}}class uP{constructor(e,n,c){const u=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,u,qd,m),this.addImages(n,p,2,m);const{w:y,h:b}=cP(m),T=new Ds({width:y||1,height:b||1});for(const[A,C]of e.entries()){const P=u.get(A).paddedRect;Ds.copy(C.data,T,{x:0,y:0},{x:P.x+qd,y:P.y+qd},C.data,null,C.sdf)}for(const[A,C]of n.entries()){const P=p.get(A),D=P.paddedRect;let L=P.padding;const N=D.x+L,V=D.y+L,G=C.data.width,X=C.data.height;L=L>1?L-1:L,Ds.copy(C.data,T,{x:0,y:0},{x:N,y:V},C.data,c),Ds.copy(C.data,T,{x:0,y:X-L},{x:N,y:V-L},{width:G,height:L},c),Ds.copy(C.data,T,{x:0,y:0},{x:N,y:V+X},{width:G,height:L},c),Ds.copy(C.data,T,{x:G-L,y:0},{x:N-L,y:V},{width:L,height:X},c),Ds.copy(C.data,T,{x:0,y:0},{x:N+G,y:V},{width:L,height:X},c),Ds.copy(C.data,T,{x:G-L,y:X-L},{x:N-L,y:V-L},{width:L,height:L},c),Ds.copy(C.data,T,{x:0,y:X-L},{x:N+G,y:V-L},{width:L,height:L},c),Ds.copy(C.data,T,{x:0,y:0},{x:N+G,y:V+X},{width:L,height:L},c),Ds.copy(C.data,T,{x:G-L,y:0},{x:N-L,y:V+X},{width:L,height:L},c)}this.lut=c,this.image=T,this.iconPositions=u,this.patternPositions=p}addImages(e,n,c,u){for(const[p,m]of e.entries()){const{bin:y,imagePosition:b,imageVariant:T}=ET(p,m,c);n.set(p,b),u.push(y),m.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,n,c){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,c)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,c);for(const u of e.getUpdatedImages(c)){for(const p of this.iconPositions.keys()){const m=gl.parse(p);if(Wn.isEqual(m.id,u)){const y=e.getImage(u,c);this.patchUpdatedImage(this.iconPositions.get(p),y,n,null)}}for(const p of this.patternPositions.keys()){const m=gl.parse(p);if(Wn.isEqual(m.id,u)){const y=e.getImage(u,c);this.patchUpdatedImage(this.patternPositions.get(p),y,n,this.lut)}}}}patchUpdatedImage(e,n,c,u=null){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,m]=e.tl,y=e.sdf;if(this.lut||y){const b={width:n.data.width,height:n.data.height},T=new Ds(b);Ds.copy(n.data,T,{x:0,y:0},{x:0,y:0},b,u,y),c.update(T,{position:{x:p,y:m}})}else c.update(n.data,{position:{x:p,y:m}})}}zt(q_,"ImagePosition"),zt(uP,"ImageAtlas");const W_=1e20;function hP(s,e,n,c,u,p,m,y,b){for(let T=e;T<e+c;T++)dP(s,n*p+T,p,u,m,y,b);for(let T=n;T<n+u;T++)dP(s,T*p+e,1,c,m,y,b)}function dP(s,e,n,c,u,p,m){p[0]=0,m[0]=-W_,m[1]=W_,u[0]=s[e];for(let y=1,b=0,T=0;y<c;y++){u[y]=s[e+y*n];const A=y*y;do{const C=p[b];T=(u[y]-u[C]+A-C*C)/(y-C)/2}while(T<=m[b]&&--b>-1);b++,p[b]=y,m[b]=T,m[b+1]=W_}for(let y=0,b=0;y<c;y++){for(;m[b+1]<y;)b++;const T=p[b],A=y-T;s[e+y*n]=u[T]+A*A}}const Cl=2,IT={none:0,ideographs:1,all:2};class Up{constructor(e,n,c){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=c,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const c=[],u=this.url||Wi.GLYPHS_URL;for(const p in e)for(const m of e[p])c.push({stack:p,id:m});Te(c,({stack:p,id:m},y)=>{let b=this.entries[p];b||(b=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[m];if(T!==void 0)return void y(null,{stack:p,id:m,glyph:T});if(T=this._tinySDF(b,p,m),T)return b.glyphs[m]=T,void y(null,{stack:p,id:m,glyph:T});const A=Math.floor(m/256);if(256*A>65535)return or("glyphs > 65535 not supported"),void y(null,{stack:p,id:m,glyph:T});if(b.ranges[A])return void y(null,{stack:p,id:m,glyph:T});let C=b.requests[A];C||(C=b.requests[A]=[],Up.loadGlyphRange(p,A,u,this.requestManager,(P,D)=>{if(D){b.ascender=D.ascender,b.descender=D.descender;for(const L in D.glyphs)this._doesCharSupportLocalGlyph(+L)||(b.glyphs[+L]=D.glyphs[+L]);b.ranges[A]=!0}for(const L of C)L(P,D);delete b.requests[A]})),C.push((P,D)=>{P?y(P):D&&y(null,{stack:p,id:m,glyph:D.glyphs[m]||null})})},(p,m)=>{if(p)n(p);else if(m){const y={};for(const{stack:b,id:T,glyph:A}of m)y[b]===void 0&&(y[b]={}),y[b].glyphs===void 0&&(y[b].glyphs={}),y[b].glyphs[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},y[b].ascender=this.entries[b].ascender,y[b].descender=this.entries[b].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==IT.none&&(this.localGlyphMode===IT.all?!!this.localFontFamily:!!this.localFontFamily&&(ar["CJK Unified Ideographs"](e)||ar["Hangul Syllables"](e)||ar.Hiragana(e)||ar.Katakana(e)||ar["CJK Symbols and Punctuation"](e)||ar["CJK Unified Ideographs Extension A"](e)||ar["CJK Unified Ideographs Extension B"](e)||ar.Osage(e)))}_tinySDF(e,n,c){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(c))return;let p=e.tinySDF;if(!p){let N="400";/bold/i.test(n)?N="900":/medium/i.test(n)?N="500":/light/i.test(n)&&(N="200"),p=e.tinySDF=new Up.TinySDF({fontFamily:u,fontWeight:N,fontSize:24*Cl,buffer:3*Cl,radius:8*Cl}),p.fontWeight=N}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const m=String.fromCodePoint(c),{data:y,width:b,height:T,glyphWidth:A,glyphHeight:C,glyphLeft:P,glyphTop:D,glyphAdvance:L}=p.draw(m);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new ih({width:b,height:T},y),metrics:{width:A/Cl,height:C/Cl,left:P/Cl,top:D/Cl-27,advance:L/Cl,localGlyph:!0}}}}Up.loadGlyphRange=function(s,e,n,c,u){const p=256*e,m=p+255,y=c.transformRequest(c.normalizeGlyphsURL(n).replace("{fontstack}",s).replace("{range}",`${p}-${m}`),Mc.Glyphs);vu(y,(b,T)=>{if(b)u(b);else if(T){const A={},C=function(P){return new Xv(P).readFields(E5,{})}(T);for(const P of C.glyphs)A[P.id]=P;u(null,{glyphs:A,ascender:C.ascender,descender:C.descender})}})},Up.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:n=8,cutoff:c=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:m="normal",lang:y=null}={}){this.buffer=e,this.cutoff=c,this.radius=n,this.lang=y;const b=this.size=s+4*e,T=this._createCanvas(b),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${m} ${p} ${s}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:c,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(s),m=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),b=Math.min(this.size-this.buffer,m+Math.ceil(c)),T=y+2*this.buffer,A=b+2*this.buffer,C=Math.max(T*A,0),P=new Uint8ClampedArray(C),D={data:P,width:T,height:A,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return D;const{ctx:L,buffer:N,gridInner:V,gridOuter:G}=this;this.lang&&(L.lang=this.lang),L.clearRect(N,N,y,b),L.fillText(s,N,N+m);const X=L.getImageData(N,N,y,b);G.fill(W_,0,C),V.fill(0,0,C);for(let Y=0;Y<b;Y++)for(let ie=0;ie<y;ie++){const _e=X.data[4*(Y*y+ie)+3]/255;if(_e===0)continue;const ue=(Y+N)*T+ie+N;if(_e===1)G[ue]=0,V[ue]=W_;else{const be=.5-_e;G[ue]=be>0?be*be:0,V[ue]=be<0?be*be:0}}hP(G,0,0,T,A,T,this.f,this.v,this.z),hP(V,N,N,y,b,T,this.f,this.v,this.z);for(let Y=0;Y<C;Y++){const ie=Math.sqrt(G[Y])-Math.sqrt(V[Y]);P[Y]=Math.round(255-255*(ie/this.radius+this.cutoff))}return D}};const dc=qd;function fP(s,e){return s+e[1]-e[0]}function AT(s,e,n,c,u=1){const p=[],m=s.imagePrimary,y=m.pixelRatio,b=m.paddedRect.w-2*dc,T=m.paddedRect.h-2*dc,A=(s.right-s.left)*u,C=(s.bottom-s.top)*u,P=m.stretchX||[[0,b]],D=m.stretchY||[[0,T]],L=P.reduce(fP,0),N=D.reduce(fP,0),V=b-L,G=T-N;let X=0,Y=L,ie=0,_e=N,ue=0,be=V,Ee=0,Ae=G;if(m.content&&c){const ze=m.content;X=Jv(P,0,ze[0]),ie=Jv(D,0,ze[1]),Y=Jv(P,ze[0],ze[2]),_e=Jv(D,ze[1],ze[3]),ue=ze[0]-X,Ee=ze[1]-ie,be=ze[2]-ze[0]-Y,Ae=ze[3]-ze[1]-_e}const Ze=(ze,Ke,tt,st)=>{const yt=Qv(ze.stretch-X,Y,A,s.left*u),ht=ex(ze.fixed-ue,be,ze.stretch,L),rt=Qv(Ke.stretch-ie,_e,C,s.top*u),ut=ex(Ke.fixed-Ee,Ae,Ke.stretch,N),He=Qv(tt.stretch-X,Y,A,s.left*u),$e=ex(tt.fixed-ue,be,tt.stretch,L),at=Qv(st.stretch-ie,_e,C,s.top*u),mt=ex(st.fixed-Ee,Ae,st.stretch,N),it=new nt(yt,rt),Lt=new nt(He,rt),Vt=new nt(He,at),kt=new nt(yt,at),St=new nt(ht/y,ut/y),wr=new nt($e/y,mt/y),At=e*Math.PI/180;if(At){const li=Math.sin(At),ci=Math.cos(At),an=[ci,-li,li,ci];it._matMult(an),Lt._matMult(an),kt._matMult(an),Vt._matMult(an)}const ir=ze.stretch+ze.fixed,Er=tt.stretch+tt.fixed,Fr=Ke.stretch+Ke.fixed,ii=st.stretch+st.fixed,Ar=s.imageSecondary;return{tl:it,tr:Lt,bl:kt,br:Vt,texPrimary:{x:m.paddedRect.x+dc+ir,y:m.paddedRect.y+dc+Fr,w:Er-ir,h:ii-Fr},texSecondary:Ar?{x:Ar.paddedRect.x+dc+ir,y:Ar.paddedRect.y+dc+Fr,w:Er-ir,h:ii-Fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:St,pixelOffsetBR:wr,minFontScaleX:be/y/A,minFontScaleY:Ae/y/C,isSDF:n}};if(c&&(m.stretchX||m.stretchY)){const ze=pP(P,V,L),Ke=pP(D,G,N);for(let tt=0;tt<ze.length-1;tt++){const st=ze[tt],yt=ze[tt+1];for(let ht=0;ht<Ke.length-1;ht++)p.push(Ze(st,Ke[ht],yt,Ke[ht+1]))}}else p.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return p}function M5(s,e){const n=s.stretchY||[[0,s.paddedRect.h-2*dc]];return e&&(s.stretchX||s.stretchY)?mP(s.stretchX||[[0,s.paddedRect.w-2*dc]])*mP(n):1}function Jv(s,e,n){let c=0;for(const u of s)c+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return c}function pP(s,e,n){const c=[{fixed:-dc,stretch:0}];for(const[u,p]of s){const m=c[c.length-1];c.push({fixed:u-m.stretch,stretch:m.stretch}),c.push({fixed:u-m.stretch,stretch:m.stretch+(p-u)})}return c.push({fixed:e+dc,stretch:n}),c}function mP(s){return 2*s.length+1}function Qv(s,e,n,c){return s/e*n+c}function ex(s,e,n,c){return s-e*n/c}function O5(s,e,n,c){const u=e+s.positionedLines[c].lineOffset;return c===0?n+u/2:n+(u+(e+s.positionedLines[c-1].lineOffset))/2}function D5(s,e=1,n=!1){let c=1/0,u=1/0,p=-1/0,m=-1/0;const y=s[0];for(let D=0;D<y.length;D++){const L=y[D];(!D||L.x<c)&&(c=L.x),(!D||L.y<u)&&(u=L.y),(!D||L.x>p)&&(p=L.x),(!D||L.y>m)&&(m=L.y)}const b=Math.min(p-c,m-u);let T=b/2;const A=new Bf([],L5);if(b===0)return new nt(c,u);for(let D=c;D<p;D+=b)for(let L=u;L<m;L+=b)A.push(new $p(D+T,L+T,T,s));let C=function(D){let L=0,N=0,V=0;const G=D[0];for(let X=0,Y=G.length,ie=Y-1;X<Y;ie=X++){const _e=G[X],ue=G[ie],be=_e.x*ue.y-ue.x*_e.y;N+=(_e.x+ue.x)*be,V+=(_e.y+ue.y)*be,L+=3*be}return new $p(N/L,V/L,0,D)}(s),P=A.length;for(;A.length;){const D=A.pop();(D.d>C.d||!C.d)&&(C=D,n&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,P)),D.max-C.d<=e||(T=D.h/2,A.push(new $p(D.p.x-T,D.p.y-T,T,s)),A.push(new $p(D.p.x+T,D.p.y-T,T,s)),A.push(new $p(D.p.x-T,D.p.y+T,T,s)),A.push(new $p(D.p.x+T,D.p.y+T,T,s)),P+=4)}return n&&(console.log(`num probes: ${P}`),console.log(`best distance: ${C.d}`)),C.p}function L5(s,e){return e.max-s.max}class $p{constructor(e,n,c,u){this.p=new nt(e,n),this.h=c,this.d=function(p,m){let y=!1,b=1/0;for(let T=0;T<m.length;T++){const A=m[T];for(let C=0,P=A.length,D=P-1;C<P;D=C++){const L=A[C],N=A[D];L.y>p.y!=N.y>p.y&&p.x<(N.x-L.x)*(p.y-L.y)/(N.y-L.y)+L.x&&(y=!y),b=Math.min(b,$o(p,L,N))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const z5=Object.keys,CT=Number.POSITIVE_INFINITY,F5=Math.sqrt(2);function tx(s,e,n,c){const u=s.collisionPadding||[0,0,0,0],p={top:s.top-u[1],bottom:s.bottom+u[3],left:s.left-u[0],right:s.right+u[2],scaled:!1};return c!==void 0&&function(m,y){m.top*=y,m.bottom*=y,m.left*=y,m.right*=y,m.scaled=!0}(p,c),n&&function(m,y){if(!y)return;const b=Nr(y),T=new nt(m.left,m.top),A=new nt(m.right,m.top),C=new nt(m.left,m.bottom),P=new nt(m.right,m.bottom);T._rotateAround(b,new nt(0,0)),A._rotateAround(b,new nt(0,0)),C._rotateAround(b,new nt(0,0)),P._rotateAround(b,new nt(0,0)),m.left=Math.min(T.x,A.x,C.x,P.x),m.right=Math.max(T.x,A.x,C.x,P.x),m.top=Math.min(T.y,A.y,C.y,P.y),m.bottom=Math.max(T.y,A.y,C.y,P.y)}(p,n),e?{top:Math.min(e.top,p.top),bottom:Math.max(e.bottom,p.bottom),left:Math.min(e.left,p.left),right:Math.max(e.right,p.right),scaled:e.scaled||p.scaled}:p}function gP(s,[e,n]){let c=0,u=0;if(n===CT){e<0&&(e=0);const p=e/F5;switch(s){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(s){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=e;break;case"right":c=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),s){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(s){case"top-right":case"bottom-right":case"right":c=-e;break;case"top-left":case"bottom-left":case"left":c=e}}return[c,u]}function B5(s,e,n,c,u,p,m,y,b,T,A){const C=s.layers[0],P=C.appearances;if(P.length===0)return{iconBBox:null,iconVerticalBBox:null};let D=null,L=null;const N=c.get("icon-rotate").evaluate(u,{},p);e&&(D=tx(e,D,N,m),n)&&(L=tx(n,L,N+90,m));const[V,G]=c.get("icon-size-scale-range"),X=W(1,V,G);for(const Y of P){const ie=Y.getUnevaluatedProperties(),_e=ie._values["icon-image"].value!==void 0,ue=ie._values["icon-size"].value!==void 0,be=ie._values["icon-offset"].value!==void 0,Ee=ie._values["icon-rotate"].value!==void 0;if(_e||ue||be||Ee){const Ae=be?C.getAppearanceValueAndResolveTokens(Y,"icon-offset",u,p,[]):null,Ze=Ae&&Array.isArray(Ae)?Ae:y,ze=Ee?C.getAppearanceValueAndResolveTokens(Y,"icon-rotate",u,p,[]):null,Ke=typeof ze=="number"?ze:N,tt=ue?C.getAppearanceValueAndResolveTokens(Y,"icon-size",u,p,[]):null,st=typeof tt=="number"?tt*b.iconScaleFactor:m;let yt=null,ht=null,rt=null;if(_e){const ut=C.getAppearanceValueAndResolveTokens(Y,"icon-image",u,p,[]);if(ut){const He=s.getResolvedImageFromTokens(ut),$e=ie._values["icon-size"],at=Z_(He,jp(s.zoom,$e,s.worldview),$e,p,s.zoom,u,s.pixelRatio,X,s.worldview);rt=T.get(at.iconPrimary.toString())}}else e&&(rt=e.imagePrimary);rt&&(yt=Yv(rt,null,Ze,A),s.allowVerticalPlacement&&(ht=Yv(rt,null,Ze,A))),yt&&(D=tx(yt,D,Ke,st)),ht&&(L=tx(ht,L,Ke+90,st))}}return{iconBBox:D,iconVerticalBBox:L}}function rx(s,e,n,c,u,p,m,y,b){if(!e||!e.usvg)return;const T=iP(c),A=iP(u),C=p!=="both"&&p!=="width"||!tP(c)?1:A.width/T.width,P=p!=="both"&&p!=="height"||!rP(c)?1:A.height/T.height;n.scaleSelf(C,P);const D=n.toString();m.set(D,n),y.set(D,e);const{imagePosition:L}=ET(D,e,qd);b.set(D,L)}function _P(s,e,n,c,u,p,m,y,b){if(!s)return;const T=function(A,C,P,D,L,N){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const V=C.possiblyEvaluate(new Ui(A.maxZoom,{worldview:N}),P).evaluate(L,{},P),G=C.possiblyEvaluate(new Ui(A.minZoom,{worldview:N}),P).evaluate(L,{},P);return Math.max(V,G)}return C.possiblyEvaluate(new Ui(D,{worldview:N})).evaluate(L,{},P)}(e,n,c,u,p,b);return s.scaleSelf(T*y*m)}function Z_(s,e,n,c,u,p,m,y,b){return{iconPrimary:_P(s.getPrimary(),e,n,c,u,p,m,y,b),iconSecondary:_P(s.getSecondary(),e,n,c,u,p,m,y,b)}}function N5(s,e,n){if(!e)return;const c=n.get(s.toString()),u=n.get(e.toString());c&&u&&(c.paddedRect.w===u.paddedRect.w&&c.paddedRect.h===u.paddedRect.h||or(`Mismatch in icon variant sizes: ${s.toString()} and ${e.toString()}`),c.usvg!==u.usvg&&or(`Mismatch in icon variant image types: ${s.id} and ${e.id}`))}function yP(s,e,n,c){if(!s)return;const u=e.get(n.toString());if(s.imagePrimary=u,c){const p=e.get(c.toString());s.imageSecondary=p}}function j5(s,e){for(const n in s.horizontal)vP(s.horizontal[n],e);vP(s.vertical,e)}function vP(s,e){if(s){for(const n of s.positionedLines)for(const c of n.positionedGlyphs)if(c.image!==null){const u=c.image.toString();c.rect=e.get(u).paddedRect}}}function PT(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function V5(s,e,n,c,u,p,m,y,b){const T=RT(p.horizontal)||p.vertical,A=n.get("icon-text-fit-padding").evaluate(c,{},u);let C,P=e;return e&&b!=="none"&&(s.allowVerticalPlacement&&p.vertical&&(C=TT(e,p.vertical,b,A,y,m)),T&&(P=TT(e,T,b,A,y,m))),{defaultShapedIcon:P,verticallyShapedIcon:C}}function U5(s,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X,Y,ie,_e){let ue=m.textMaxSize.evaluate(e,{},P);ue===void 0?ue=y*m.textScaleFactor:ue*=m.textScaleFactor;const be=s.layers[0].layout,Ee=vs,Ae=y*m.textScaleFactor/Ee,Ze=RT(n.horizontal)||n.vertical;if(V!=="none"&&s.appearanceFeatureData&&e.index<s.appearanceFeatureData.length){const it=s.appearanceFeatureData[e.index];it&&(it.textShaping=Ze,it.iconTextFitPadding=be.get("icon-text-fit-padding").evaluate(e,{},P),it.fontScale=Ae)}const ze=D.name==="globe",Ke=s.tilePixelRatio*ue/Ee,tt=(He=s.overscaling,s.zoom>18&&He>2&&(He>>=1),Math.max(xt/(512*He),1)*be.get("symbol-spacing")),st=be.get("text-padding")*s.tilePixelRatio,yt=be.get("icon-padding")*s.tilePixelRatio,ht=Nr(be.get("text-max-angle")),rt=be.get("icon-rotation-alignment")==="map"&&Y!=="point",ut=tt/2;var He;s.hasAnyIconTextFit===!1&&V!=="none"&&(s.hasAnyIconTextFit=!0);const $e=e.properties?+e.properties[Rt]:null,at=$e&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get($e):65535,mt=(it,Lt,Vt)=>{if(Lt.x<0||Lt.x>=xt||Lt.y<0||Lt.y>=xt)return;let kt=null;if(ze){const{x:St,y:wr,z:At}=D.projectTilePoint(Lt.x,Lt.y,Vt);kt={anchor:new Jc(St,wr,At,0,void 0),up:D.upVector(Vt,Lt.x,Lt.y)}}(function(St,wr,At,ir,Er,Fr,ii,Ar,li,ci,an,he,ae,Ye,Tt,Je,Et,Kt,Wt,Cr,hr,Ht,ai,ki,fr,ei,Mi,vi,pn,Xi,Bi){const Ii=St.addToLineVertexArray(wr,ir);let ui,Pr,hi,Ni,dr,ni,Ki,wn=0,kn=0,$n=0,Yi=0,Nn=-1,Eo=-1;const jn={};let Xo=ad("");const Ls=At?At.anchor:wr,za=vi!=="none";let Io=0,Ko=0;if(li._unevaluatedLayout.getValue("text-radial-offset")===void 0){const xs=li.layout.get("text-offset").evaluate(hr,{},fr);Io=xs[0]*vs,Ko=xs[1]*vs}else Io=li.layout.get("text-radial-offset").evaluate(hr,{},fr)*vs,Ko=CT;if(St.allowVerticalPlacement&&Er.vertical){const xs=Er.vertical;if(Tt)ni=kT(xs),Ar&&(Ki=kT(Ar));else{const so=li.layout.get("text-rotate").evaluate(hr,{},fr)+90;hi=ix(ci,Ls,wr,an,he,ae,xs,Ye,so,Je),Ar&&(Ni=ix(ci,Ls,wr,an,he,ae,Ar,Kt,so,null,Bi))}}if(Fr){const xs=St.iconSizeData,so=li.layout.get("icon-rotate").evaluate(hr,{},fr),fc=AT(Fr,so,ai,za,Ht.iconScaleFactor),lh=Ar?AT(Ar,so,ai,za,Ht.iconScaleFactor):void 0;Pr=ix(ci,Ls,wr,an,he,ae,Fr,Kt,so,null,Xi);const Kp=function(pc,xx,Yp,tj,BR,NR,rj,ij){const jR=pc.layers[0],VR=jR.appearances;let Jp=xx.length;if(Yp&&(Jp=Math.max(Jp,Yp.length)),VR.length===0)return Jp;const[nj,sj]=tj.get("icon-size-scale-range"),oj=W(1,nj,sj);for(const UR of VR){const $R=UR.getUnevaluatedProperties();if($R._values["icon-image"].value!==void 0){const GR=jR.getAppearanceValueAndResolveTokens(UR,"icon-image",BR,NR,[]);if(GR){const HR=pc.getResolvedImageFromTokens(GR);if(HR){const qR=$R._values["icon-size"],aj=Z_(HR,jp(pc.zoom,qR,pc.worldview),qR,NR,pc.zoom,BR,pc.pixelRatio,oj,pc.worldview),lj=rj.get(aj.iconPrimary.toString());Jp=Math.max(Jp,M5(lj,ij))}}}}return Jp}(St,fc,lh,li.layout,hr,fr,St.iconAtlasPositions,za);wn=4*Kp;let ch=null;xs.kind==="source"?(ch=[Al*li.layout.get("icon-size").evaluate(hr,{},fr)*Ht.iconScaleFactor],ch[0]>Qc&&or(`${St.layerIds[0]}: Value for "icon-size" is >= ${X_}. Reduce your "icon-size".`)):xs.kind==="composite"&&(ch=[Al*Ht.compositeIconSizes[0].evaluate(hr,{},fr)*Ht.iconScaleFactor,Al*Ht.compositeIconSizes[1].evaluate(hr,{},fr)*Ht.iconScaleFactor],(ch[0]>Qc||ch[1]>Qc)&&or(`${St.layerIds[0]}: Value for "icon-size" is >= ${X_}. Reduce your "icon-size".`)),St.addSymbols(St.icon,fc,ch,Cr,Wt,hr,void 0,At,wr,Ii.lineStartIndex,Ii.lineLength,-1,ki,fr,ei,Mi,St.symbolInstances.length,Kp),Nn=St.icon.placedSymbolArray.length-1,lh&&(kn=4*Kp,St.addSymbols(St.icon,lh,ch,Cr,Wt,hr,Zo.vertical,At,wr,Ii.lineStartIndex,Ii.lineLength,-1,ki,fr,ei,Mi,St.symbolInstances.length,Kp),Eo=St.icon.placedSymbolArray.length-1)}for(const xs in Er.horizontal){const so=xs,fc=Er.horizontal[so];ui||(Xo=ad(fc.text),Tt?dr=kT(fc):ui=ix(ci,Ls,wr,an,he,ae,fc,Ye,li.layout.get("text-rotate").evaluate(hr,{},fr),Je));const lh=fc.positionedLines.length===1;if($n+=xP(St,At,wr,fc,ii,li,Tt,hr,Je,Ii,Er.vertical?Zo.horizontal:Zo.horizontalOnly,lh?z5(Er.horizontal):[so],jn,Nn,Ht,ki,fr,St.symbolInstances.length,ei),lh)break}Er.vertical&&(Yi+=xP(St,At,wr,Er.vertical,ii,li,Tt,hr,Je,Ii,Zo.vertical,["vertical"],jn,Eo,Ht,ki,fr,St.symbolInstances.length,ei));let zs=-1;const Yo=(xs,so)=>xs?Math.max(xs,so):so;zs=Yo(dr,zs),zs=Yo(ni,zs),zs=Yo(Ki,zs);const Fa=zs>-1?1:0;St.glyphOffsetArray.length>=65535&&or("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&St.addToSortKeyRanges(St.symbolInstances.length,hr.sortKey),St.symbolInstances.emplaceBack(wr.x,wr.y,Ls.x,Ls.y,Ls.z,jn.right>=0?jn.right:-1,jn.center>=0?jn.center:-1,jn.left>=0?jn.left:-1,jn.vertical>=0?jn.vertical:-1,Nn,Eo,Xo,ui!==void 0?ui:St.collisionBoxArray.length,ui!==void 0?ui+1:St.collisionBoxArray.length,hi!==void 0?hi:St.collisionBoxArray.length,hi!==void 0?hi+1:St.collisionBoxArray.length,Pr!==void 0?Pr:St.collisionBoxArray.length,Pr!==void 0?Pr+1:St.collisionBoxArray.length,Ni||St.collisionBoxArray.length,Ni?Ni+1:St.collisionBoxArray.length,an,$n,Yi,wn,kn,Fa,0,Io,Ko,zs,0,za?1:0,pn)})(s,Lt,kt,it,n,c,p,u,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,st,X,T,0,yt,rt,G,e,m,A,C,P,L,N,V,at,ie,_e)};if(Y==="line")for(const it of Bv(e.geometry,0,0,xt,xt)){const Lt=k5(it,tt,ht,n.vertical||Ze,c,Ee,Ke,s.overscaling,xt);for(const Vt of Lt)Ze&&$5(s,Ze.text,ut,Vt)||mt(it,Vt,P)}else if(Y==="line-center"){for(const it of e.geometry)if(it.length>1){const Lt=R5(it,ht,n.vertical||Ze,c,Ee,Ke);Lt&&mt(it,Lt,P)}}else if(e.type==="Polygon")for(const it of k_(e.geometry,0)){const Lt=D5(it,16);mt(it[0],new Jc(Lt.x,Lt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const it of e.geometry)mt(it,new Jc(it[0].x,it[0].y,0,0,void 0),P);else if(e.type==="Point")for(const it of e.geometry)for(const Lt of it)mt([Lt],new Jc(Lt.x,Lt.y,0,0,void 0),P)}const X_=255,Qc=X_*Al;function xP(s,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X){const Y=function(ue,be,Ee,Ae,Ze,ze,Ke,tt){const st=[];if(be.positionedLines.length===0)return st;const yt=Ae.layout.get("text-rotate").evaluate(ze,{})*Math.PI/180,ht=function(at){const mt=at[0],it=at[1],Lt=mt*it;return Lt>0?[mt,-it]:Lt<0?[-mt,it]:mt===0?[it,mt]:[it,-mt]}(Ee);let rt=Math.abs(be.top-be.bottom);for(const at of be.positionedLines)rt-=at.lineOffset;const ut=be.positionedLines.length,He=rt/ut;let $e=be.top-Ee[1];for(let at=0;at<ut;++at){const mt=be.positionedLines[at];$e=O5(be,He,$e,at);for(const it of mt.positionedGlyphs){if(!it.rect)continue;const Lt=it.rect||{};let Vt=ZC+1,kt=!0,St=1,wr=0;if(it.image){const Wt=Ke.get(it.image.toString());if(!Wt)continue;if(Wt.sdf){or("SDF images are not supported in formatted text and will be ignored.");continue}kt=!1,St=Wt.pixelRatio,Vt=qd/St}const At=(Ze||tt)&&it.vertical,ir=it.metrics.advance*it.scale/2,Er=it.metrics,Fr=it.rect;if(Fr===null)continue;tt&&be.verticalizable&&(wr=it.image?ir-it.metrics.width*it.scale/2:0);const ii=Ze?[it.x+ir,it.y]:[0,0];let Ar=[0,0],li=[0,0],ci=!1;Ze||(At?(li=[it.x+ir+ht[0],it.y+ht[1]-wr],ci=!0):Ar=[it.x+ir+Ee[0],it.y+Ee[1]-wr]);const an=Fr.w*it.scale/(St*(it.localGlyph?Cl:1)),he=Fr.h*it.scale/(St*(it.localGlyph?Cl:1));let ae,Ye,Tt,Je;if(At){const Wt=it.y-$e,Cr=new nt(-ir,ir-Wt),hr=-Math.PI/2,Ht=new nt(...li);ae=new nt(-ir+Ar[0],Ar[1]),ae._rotateAround(hr,Cr)._add(Ht),ae.x+=-Wt+ir,ae.y-=(Er.left-Vt)*it.scale;const ai=it.image?Er.advance*it.scale:vs*it.scale,ki=String.fromCodePoint(it.glyph);p5(ki)?ae.x+=(1-Vt)*it.scale:m5(ki)?ae.x+=ai-Er.height*it.scale+(-Vt-1)*it.scale:ae.x+=it.image||Er.width+2*Vt===Fr.w&&Er.height+2*Vt===Fr.h?(ai-he)/2:(ai-(Er.height+2*Vt)*it.scale)/2,Ye=new nt(ae.x,ae.y-an),Tt=new nt(ae.x+he,ae.y),Je=new nt(ae.x+he,ae.y-an)}else{const Wt=(Er.left-Vt)*it.scale-ir+Ar[0],Cr=(-Er.top-Vt)*it.scale+Ar[1],hr=Wt+an,Ht=Cr+he;ae=new nt(Wt,Cr),Ye=new nt(hr,Cr),Tt=new nt(Wt,Ht),Je=new nt(hr,Ht)}if(yt){let Wt;Wt=Ze?new nt(0,0):ci?new nt(ht[0],ht[1]):new nt(Ee[0],Ee[1]),ae._rotateAround(yt,Wt),Ye._rotateAround(yt,Wt),Tt._rotateAround(yt,Wt),Je._rotateAround(yt,Wt)}const Et=new nt(0,0),Kt=new nt(0,0);st.push({tl:ae,tr:Ye,bl:Tt,br:Je,texPrimary:Lt,texSecondary:void 0,writingMode:be.writingMode,glyphOffset:ii,sectionIndex:it.sectionIndex,isSDF:kt,pixelOffsetTL:Et,pixelOffsetBR:Kt,minFontScaleX:0,minFontScaleY:0})}}return st}(0,c,b,p,m,y,u,s.allowVerticalPlacement),ie=s.textSizeData;let _e=null;ie.kind==="source"?(_e=[Al*p.layout.get("text-size").evaluate(y,{},V)*L.textScaleFactor],_e[0]>Qc&&or(`${s.layerIds[0]}: Value for "text-size" is >= ${X_}. Reduce your "text-size".`)):ie.kind==="composite"&&(_e=[Al*L.compositeTextSizes[0].evaluate(y,{},V)*L.textScaleFactor,Al*L.compositeTextSizes[1].evaluate(y,{},V)*L.textScaleFactor],(_e[0]>Qc||_e[1]>Qc)&&or(`${s.layerIds[0]}: Value for "text-size" is >= ${X_}. Reduce your "text-size".`)),s.addSymbols(s.text,Y,_e,b,m,y,A,e,n,T.lineStartIndex,T.lineLength,D,N,V,X,!1,G,Y.length);for(const ue of C)P[ue]=s.text.placedSymbolArray.length-1;return 4*Y.length}function RT(s){for(const e in s)return s[e];return null}function ix(s,e,n,c,u,p,m,y,b,T,A){let C,P,D,L;if(C=A?A.top:m.top,P=A?A.bottom:m.bottom,D=A?A.left:m.left,L=A?A.right:m.right,eP(m)&&m.collisionPadding){const N=m.collisionPadding;D-=N[0],C-=N[1],L+=N[2],P+=N[3]}if(b){const N=new nt(D,C),V=new nt(L,C),G=new nt(D,P),X=new nt(L,P),Y=Nr(b);let ie=new nt(0,0);T&&(ie=new nt(T[0],T[1])),N._rotateAround(Y,ie),V._rotateAround(Y,ie),G._rotateAround(Y,ie),X._rotateAround(Y,ie),D=Math.min(N.x,V.x,G.x,X.x),L=Math.max(N.x,V.x,G.x,X.x),C=Math.min(N.y,V.y,G.y,X.y),P=Math.max(N.y,V.y,G.y,X.y)}return s.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,C,L,P,y,c,u,p),s.length-1}function kT(s){eP(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function $5(s,e,n,c){const u=s.compareText;if(e in u){const p=u[e];for(let m=p.length-1;m>=0;m--)if(c.dist(p[m])<n)return!0}else u[e]=[];return u[e].push(c),!1}function wP(s,e){const n=s.fovAboveCenter,c=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,u=(s._camera.position[2]*s.worldSize-c)/Math.cos(s._pitch),p=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-s._pitch-n,.01));let m=Math.sin(s._pitch)*p+u;const y=u*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let b=Math.max(s.zoom-17,0);s.isOrthographic&&(b/=10),m*=1+b}return Math.min(1.01*m,y)}function K_(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const n=Math.pow(2,-s.z),c=s.x*n,u=(s.x+1)*n,p=s.y*n,m=(s.y+1)*n,y=ne(c),b=ne(u),T=ee(p),A=ee(m),C=e.project(y,T),P=e.project(b,T),D=e.project(b,A),L=e.project(y,A);let N=Math.min(C.x,P.x,D.x,L.x),V=Math.min(C.y,P.y,D.y,L.y),G=Math.max(C.x,P.x,D.x,L.x),X=Math.max(C.y,P.y,D.y,L.y);const Y=n/16;function ie(ue,be,Ee,Ae,Ze,ze){const Ke=(Ee+Ze)/2,tt=(Ae+ze)/2,st=e.project(ne(Ke),ee(tt)),yt=Math.max(0,N-st.x,V-st.y,st.x-G,st.y-X);N=Math.min(N,st.x),G=Math.max(G,st.x),V=Math.min(V,st.y),X=Math.max(X,st.y),yt>Y&&(ie(ue,st,Ee,Ae,Ke,tt),ie(st,be,Ke,tt,Ze,ze))}ie(C,P,c,p,u,p),ie(P,D,u,p,u,m),ie(D,L,u,m,c,m),ie(L,C,c,m,c,p),N-=Y,V-=Y,G+=Y,X+=Y;const _e=1/Math.max(G-N,X-V);return{scale:_e,x:N*_e,y:V*_e,x2:G*_e,y2:X*_e,projection:e}}function bP(s,{x:e,y:n},c=0){return new nt(((e-c)*s.scale-s.x)*xt,(n*s.scale-s.y)*xt)}const G5=me(new Float32Array(16));class oh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new z(0,0)}projectTilePoint(e,n,c){return{x:e,y:n,z:0}}locationPoint(e,n,c,u=!0){return e._coordinatePoint(e.locationCoordinate(n,c),u)}pixelsPerMeter(e,n){return K(1,e)*n}pixelSpaceConversion(e,n,c){return 1}farthestPixelDistance(e){return wP(e,e.pixelsPerMeter)}pointCoordinate(e,n,c,u){const p=e.horizonLineFromTop(!1),m=new nt(n,Math.max(p,c));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,n,c){const u=new nt(n,c);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const c=e.horizonLineFromTop();return n.y<c}createInversionMatrix(e,n){return G5}createTileMatrix(e,n,c){let u,p,m;const y=c.canonical,b=me(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=K_(y,this);u=1,p=T.x+c.wrap*T.scale,m=T.y,Oe(b,b,[u/T.scale,u/T.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),p=(y.x+Math.pow(2,y.z)*c.wrap)*u,m=y.y*u;return de(b,b,[p,m,0]),Oe(b,b,[u/xt,u/xt,1]),b}upVector(e,n,c){return[0,0,1]}upVectorScale(e,n,c){return{metersToTile:1}}}class H5 extends oh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,c]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Nr(n));this.n=(u+Math.sin(Nr(c)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:c,c:u,r0:p}=this,m=Nr(e-this.center[0]),y=Nr(n),b=Math.sqrt(u-2*c*Math.sin(y))/c;return{x:b*Math.sin(m*c),y:b*Math.cos(m*c)-p,z:0}}unproject(e,n){const{n:c,c:u,r0:p}=this,m=p+n;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*c<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=Nr(this.center[0])*c;y=Se(y,-Math.PI-b,Math.PI-b);const T=W($s(y/c)+this.center[0],-180,180),A=Math.asin(W((u-(e*e+m*m)*c*c)/(2*c),-1,1)),C=W($s(A),-oe,oe);return new z(T,C)}}const Y_=1.340264,J_=-.081106,Q_=893e-6,ey=.003796,nx=Math.sqrt(3)/2;class q5 extends oh{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const c=Math.asin(nx*Math.sin(n)),u=c*c,p=u*u*u;return{x:.5*(e*Math.cos(c)/(nx*(Y_+3*J_*u+p*(7*Q_+9*ey*u)))/Math.PI+.5),y:1-.5*(c*(Y_+J_*u+p*(Q_+ey*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,u=c*c,p=u*u*u;for(let A,C,P,D=0;D<12&&(C=c*(Y_+J_*u+p*(Q_+ey*u))-n,P=Y_+3*J_*u+p*(7*Q_+9*ey*u),A=C/P,c=W(c-A,-Math.PI/3,Math.PI/3),u=c*c,p=u*u*u,!(Math.abs(A)<1e-12));++D);const m=nx*e*(Y_+3*J_*u+p*(7*Q_+9*ey*u))/Math.cos(c),y=Math.asin(Math.sin(c)/nx),b=W(180*m/Math.PI,-180,180),T=W(180*y/Math.PI,-oe,oe);return new z(b,T)}}class W5 extends oh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const c=360*(e-.5),u=W(360*(.5-n),-oe,oe);return new z(c,u)}}const Gp=Math.PI/2;function sx(s){return Math.tan((Gp+s)/2)}class Z5 extends oh{constructor(e){super(e),this.center=e.center||[0,30];const[n,c]=this.parallels=e.parallels||[30,30];let u=Nr(n),p=Nr(c);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const m=Math.cos(u),y=sx(u);this.n=u===p?Math.sin(u):Math.log(m/Math.cos(p))/Math.log(sx(p)/y),this.f=m*Math.pow(sx(u),this.n)/this.n}project(e,n){n=Nr(n),this.southernCenter&&(n=-n),e=Nr(e-this.center[0]);const c=1e-6,{n:u,f:p}=this;p>0?n<-Gp+c&&(n=-Gp+c):n>Gp-c&&(n=Gp-c);const m=p/Math.pow(sx(n),u);let y=m*Math.sin(u*e),b=p-m*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:c,f:u}=this,p=u-n,m=Math.sign(p),y=Math.sign(c)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*m;p*c<0&&(b-=Math.PI*Math.sign(e)*m);const T=W($s(b/c)+this.center[0],-180,180),A=W($s(2*Math.atan(Math.pow(u/y,1/c))-Gp),-oe,oe);return new z(T,this.southernCenter?-A:A)}}class TP extends oh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Z(e),y:q(n),z:0}}unproject(e,n){const c=ne(e),u=ee(n);return new z(c,u)}}const SP=Nr(oe);class X5 extends oh{project(e,n){const c=(n=Nr(n))*n,u=c*c;return{x:.5*((e=Nr(e))*(.8707-.131979*c+u*(u*(.003971*c-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+c*(.015085+u*(.028874*c-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let c=n=(2*(1-n)-1)*Math.PI,u=25,p=0,m=c*c;do{m=c*c;const T=m*m;p=(c*(1.007226+m*(.015085+T*(.028874*m-.044475-.005916*T)))-n)/(1.007226+m*(.045255+T*(.259866*m-.311325-.005916*11*T))),c=W(c-p,-SP,SP)}while(Math.abs(p)>1e-6&&--u>0);m=c*c;const y=W($s(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=$s(c);return new z(y,b)}}const EP=Nr(oe);class K5 extends oh{project(e,n){n=Nr(n),e=Nr(e);const c=Math.cos(n),u=2/Math.PI,p=Math.acos(c*Math.cos(e/2)),m=Math.sin(p)/p,y=.5*(e*u+2*c*Math.sin(e/2)/m)||0,b=.5*(n+Math.sin(n)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let c=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,p=25;const m=1e-6;let y=0,b=0;do{const T=Math.cos(u),A=Math.sin(u),C=2*A*T,P=A*A,D=T*T,L=Math.cos(c/2),N=Math.sin(c/2),V=2*L*N,G=N*N,X=1-D*L*L,Y=X?1/X:0,ie=X?Math.acos(T*L)*Math.sqrt(1/X):0,_e=.5*(2*ie*T*N+2*c/Math.PI)-e,ue=.5*(ie*A+u)-n,be=.5*Y*(D*G+ie*T*L*P)+1/Math.PI,Ee=Y*(V*C/4-ie*A*N),Ae=.125*Y*(C*N-ie*A*D*V),Ze=.5*Y*(P*L+ie*G*T)+.5,ze=Ee*Ae-Ze*be;y=(ue*Ee-_e*Ze)/ze,b=(_e*Ae-ue*be)/ze,c=W(c-y,-Math.PI,Math.PI),u=W(u-b,-EP,EP)}while((Math.abs(y)>m||Math.abs(b)>m)&&--p>0);return new z($s(c),$s(u))}}class IP extends oh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Nr(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:c,cosPhi:u}=this;return{x:Nr(e)*u*c+.5,y:-Math.sin(Nr(n))/u*c+.5,z:0}}unproject(e,n){const{scale:c,cosPhi:u}=this,p=-(n-.5)/c,m=W($s((e-.5)/c)/u,-180,180),y=Math.asin(W(p*u,-1,1)),b=W($s(y),-oe,oe);return new z(m,b)}}class Y5 extends TP{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,c){const u=E_(e,n,c);return bi(u,u,Pv(uc(c))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n,c){const u=I(n.lat,n.lng),p=Hr([],u),m=c?e._centerAltitude+c:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;ti(u,u,p,K(1,0)*xt*m);const y=me(new Float64Array(16));return re(y,e.pixelMatrix,e.globeMatrix),bi(u,u,y),new nt(u[0],u[1])}pixelsPerMeter(e,n){return K(1,0)*n}pixelSpaceConversion(e,n,c){const u=K(1,e)*n,p=pr(K(1,45)*n,u,c);return this.pixelsPerMeter(e,n)/p}createTileMatrix(e,n,c){const u=Fb(uc(c.canonical));return re(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:c}=e,u=Pv(uc(n));return qe(u,u,Nr(c.lng)),Xe(u,u,Nr(c.lat)),Oe(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,c,u){return KI(e,n,c,!0)||new Me(0,0)}pointCoordinate3D(e,n,c){const u=this.pointCoordinate(e,n,c,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!KI(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,p){const m=u.cameraToCenterDistance,y=u._centerAltitude*p,b=u._camera,T=u._camera.forward(),A=dt([],Sr([],T,-m),[0,0,y]),C=u.worldSize/(2*Math.PI),P=[0,0,-C],D=u.width/u.height,L=Math.tan(u.fovAboveCenter),N=Sr([],b.up(),L),V=Sr([],b.right(),L*D),G=Hr([],dt([],dt([],T,N),V)),X=[];let Y;if(new kr(A,G).closestPointOnSphere(P,C,X)){const ie=dt([],X,P),_e=Gi([],ie,A);Y=Math.cos(u.fovAboveCenter)*mr(_e)}else{const ie=Gi([],A,P),_e=Gi([],P,A);Hr(_e,_e);const ue=mr(ie)-C;Y=Math.sqrt(ue*(ue+2*C));const be=Math.acos(Y/(C+ue))-Math.acos(Pi(T,_e));Y*=Math.cos(be)}return 1.01*Y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),c=rh(e.zoom);if(c>0){const u=wP(e,K(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return pr(n,u+p*(1-Math.cos(m)),Math.pow(c,10))}return n}upVector(e,n,c){return E_(n,c,e,1)}upVectorScale(e){return{metersToTile:Iv(Cv(uc(e)))}}}function AP(s){const e=s.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new TP(s);case"equirectangular":return new W5(s);case"naturalEarth":return new X5(s);case"equalEarth":return new q5(s);case"winkelTripel":return new K5(s);case"albers":return n?new IP(s):new H5(s);case"lambertConformalConic":return n?new IP(s):new Z5(s);case"globe":return new Y5(s)}throw new Error(`Invalid projection name: ${s.name}`)}const J5=ot.types,Q5=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ty(s,e,n,c,u,p,m,y,b,T,A,C,P){const D=y?Math.min(Qc,Math.round(y[0])):0,L=y?Math.min(Qc,Math.round(y[1])):0;s.emplaceBack(e,n,Math.round(32*c),Math.round(32*u),p,m,(D<<1)+(b?1:0),0+(L<<1),16*T,16*A,256*C,256*P)}function ry(s,e,n){s.emplaceBack(e,n)}function iy(s,e,n,c,u,p,m){s.emplaceBack(e,n,c,u,p,m)}const ox=(s,e,n,c)=>{for(let u=0;u<e;u++)s.emplaceBack(n[0],n[1],n[2],c[0],c[1],c[2])};function Hp(s,e,n,c,u){s.emplaceBack(e,n,c,u),s.emplaceBack(e,n,c,u),s.emplaceBack(e,n,c,u),s.emplaceBack(e,n,c,u)}function e4(s){for(const e of s.sections)if(xb(e.text))return!0;return!1}class MT{constructor(e){this.layoutVertexArray=new vp,this.indexArray=new rn,this.programConfigurations=e,this.segments=new cn,this.dynamicLayoutVertexArray=new lc,this.opacityVertexArray=new c_,this.placedSymbolArray=new Ld,this.iconTransitioningVertexArray=new _a,this.globeExtVertexArray=new Wu,this.zOffsetVertexArray=new bl,this.orientationVertexArray=new d_,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,n){const c=[],u=this.layoutVertexArray.uint16;for(let p=0;p<n;++p){const m=12*(e+p);c.push(...u.slice(m,m+12))}return c}updateIconVertexData(e,n,c,u,p,m,y,b,T,A,C,P,D){const L=this.layoutVertexArray.uint16,N=12*e;L[N]=n,L[N+1]=c,L[N+2]=u,L[N+3]=p,L[N+4]=m,L[N+5]=y,L[N+6]=b,L[N+7]=T,L[N+8]=A,L[N+9]=C,L[N+10]=P,L[N+11]=D}upload(e,n,c,u,p,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n5.members,!!m),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,o5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Q5,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,c5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,s5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,a5.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,l5.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}zt(MT,"SymbolBuffers");class OT{constructor(e,n,c){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new c,this.segments=new cn,this.collisionVertexArray=new Xu,this.collisionVertexArrayExt=new lc}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,u5.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,h5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}zt(OT,"CollisionBuffers");class ax{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=me([]),this.placementViewportMatrix=me([]);const n=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=jp(this.zoom,n["text-size"],this.worldview),this.iconSizeData=jp(this.zoom,n["icon-size"],this.worldview);const c=this.layers[0].layout,u=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.lut=e.lut,this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(m=>Zo[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const n=this.layers[0].getAppearances();return!(!n||n.length===0)&&n.some(c=>c.getProperty(e)!=null)}createArrays(){this.text=new MT(new Da(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new MT(new Da(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new v_,this.lineVertexArray=new gv,this.symbolInstances=new mv}calculateGlyphDependencies(e,n,c,u,p){for(const m of e){const y=m.codePointAt(0);if(y===void 0)break;if(n[y]=!0,u&&p&&y<=65535){const b=G_[m];b&&(n[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,n,c,u,p,m){let y=1;const b=e.getUnevaluatedProperties()._values["icon-size"],T=jp(this.zoom,b,this.worldview),A=Vp(T,n);if(T.kind!=="constant"&&T.kind!=="camera"||(y=A.uSize),T.kind==="composite"){const{minZoom:C,maxZoom:P}=T,D=b.possiblyEvaluate(new Ui(C,{worldview:this.worldview}),u),L=b.possiblyEvaluate(new Ui(P,{worldview:this.worldview}),u),N=D.evaluate(c,{},u,p);y=N+(L.evaluate(c,{},u,p)-N)*A.uSizeT}return T.kind==="source"&&(y=b.possiblyEvaluate(new Ui(this.zoom,{worldview:this.worldview}),u).evaluate(c,{},u,p)),y*m}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Lv(this.activeReplacements,c)&&(this.activeReplacements=c,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?ho.build(e):e}populate(e,n,c,u){const p=this.layers[0],m=p.layout,y=this.projection.name==="globe",b=m.get("text-font"),T=m.get("text-field"),A=m.get("icon-image"),[C,P]=m.get("icon-size-scale-range"),D=W(n.scaleFactor||1,C,P),L=(T.value.kind!=="constant"||T.value.value instanceof as&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),N=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,V=this.hasAnyAppearanceProperty("icon-image"),G=m.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!L&&!N&&!V)return;const X=n.iconDependencies,Y=n.glyphDependencies,ie=n.availableImages,_e=new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),ue=be=>{const Ee=be.id.toString();X.has(Ee)?X.get(Ee).push(be):X.set(Ee,[be])};for(const be of e){const{feature:Ee,id:Ae,index:Ze,sourceLayerIndex:ze}=be,Ke=p._featureFilter.needGeometry,tt=je(Ee,Ke);if(!p._featureFilter.filter(_e,tt,c))continue;if(Ke||(tt.geometry=et(Ee,c,u)),y&&Ee.type!==1&&c.z<=5){const at=tt.geometry,mt=.98078528056,it=(Lt,Vt)=>Pi(E_(Lt.x,Lt.y,c,1),E_(Vt.x,Vt.y,c,1))<mt;for(let Lt=0;Lt<at.length;Lt++)at[Lt]=Qe(at[Lt],it)}let st,yt;if(L){const at=p.getValueAndResolveTokens("text-field",tt,c,ie),mt=as.factory(at);e4(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||e_()==="unavailable"||this.hasRTLText&&So.isParsed())&&(st=f5(mt,p,tt))}if(N){const at=p.getValueAndResolveTokens("icon-image",tt,c,ie);yt=this.getResolvedImageFromTokens(at)}const ht=this.layers[0];let rt=!1;if(!yt&&V){const at=ht.getAppearances();for(const mt of at)if(mt.getProperty("icon-image")){const it=ht.getAppearanceValueAndResolveTokens(mt,"icon-image",tt,c,ie);if(it){yt=this.getResolvedImageFromTokens(it),rt=!0;break}}}if(!st&&!yt)continue;const ut=this.sortFeaturesByKey?G.evaluate(tt,{},c):void 0,He={id:Ae,text:st,icon:yt,index:Ze,sourceLayerIndex:ze,geometry:tt.geometry,properties:Ee.properties,type:J5[Ee.type],sortKey:ut};if(this.features.push(He),this.appearanceFeatureData.push({id:Ae,properties:Ee.properties,usesAppearanceIconAsPlaceholder:rt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),yt){const at=ht._unevaluatedLayout._values,{iconPrimary:mt,iconSecondary:it}=Z_(yt,this.iconSizeData,at["icon-size"],c,this.zoom,He,this.pixelRatio,D,this.worldview);ue(mt),it&&(this.hasAnySecondaryIcon=!0,ue(it))}const $e=ht.getAppearances();if($e.length!==0&&$e.forEach(at=>{if(!at.getProperty("icon-image"))return;const mt=this.getCombinedIconPrimary(at,ht,tt,c,ie,He,D);mt&&ue(mt)}),st){const at=b.evaluate(tt,{},c).join(","),mt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zo.vertical)>=0;for(const it of st.sections)if(it.image){const Lt=it.image.getPrimary().scaleSelf(this.pixelRatio),Vt=Lt.id.toString(),kt=X.get(Vt)||[];kt.push(Lt),X.set(Vt,kt)}else{const Lt=Zg(st.toString()),Vt=it.fontStack||at,kt=Y[Vt]=Y[Vt]||{};this.calculateGlyphDependencies(it.text,kt,mt,this.allowVerticalPlacement,Lt)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(be){const Ee={},Ae={},Ze=[];let ze=0;function Ke(ht){Ze.push(be[ht]),ze++}function tt(ht,rt,ut){const He=Ae[ht];return delete Ae[ht],Ae[rt]=He,Ze[He].geometry[0].pop(),Ze[He].geometry[0]=Ze[He].geometry[0].concat(ut[0]),He}function st(ht,rt,ut){const He=Ee[rt];return delete Ee[rt],Ee[ht]=He,Ze[He].geometry[0].shift(),Ze[He].geometry[0]=ut[0].concat(Ze[He].geometry[0]),He}function yt(ht,rt,ut){const He=ut?rt[0][rt[0].length-1]:rt[0][0];return`${ht}:${He.x}:${He.y}`}for(let ht=0;ht<be.length;ht++){const rt=be[ht],ut=rt.geometry,He=rt.text?rt.text.toString():null;if(!He){Ke(ht);continue}const $e=yt(He,ut),at=yt(He,ut,!0);if($e in Ae&&at in Ee&&Ae[$e]!==Ee[at]){const mt=st($e,at,ut),it=tt($e,at,Ze[mt].geometry);delete Ee[$e],delete Ae[at],Ae[yt(He,Ze[it].geometry,!0)]=it,Ze[mt].geometry=null}else $e in Ae?tt($e,at,ut):at in Ee?st($e,at,ut):(Ke(ht),Ee[$e]=ze-1,Ae[at]=ze-1)}return Ze.filter(ht=>ht.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const be of n.elevationFeatures)this.elevationFeatureIdToIndex.set(be.id,this.elevationFeatures.length),this.elevationFeatures.push(be)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((be,Ee)=>be.sortKey-Ee.sortKey)}getCombinedIconPrimary(e,n,c,u,p,m,y){let b,T;const A=e.getUnevaluatedProperties();if(A._values["icon-image"].value!==void 0){const C=n.getAppearanceValueAndResolveTokens(e,"icon-image",c,u,p);b=this.getResolvedImageFromTokens(C)}else{const C=n.getValueAndResolveTokens("icon-image",c,u,p);b=this.getResolvedImageFromTokens(C)}if(b){const C=A._values["icon-size"]||n._unevaluatedLayout._values["icon-size"];T=Z_(b,jp(this.zoom,C,this.worldview),C,u,this.zoom,m,this.pixelRatio,y,this.worldview).iconPrimary}return T}updateAppearanceBasedIconTextures(e,n,c,u){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const p=this.layers[0];let m=!1,y=0;const b=p.layout,[T,A]=b.get("icon-size-scale-range"),C=W(1,T,A);for(let P=0;P<this.symbolInstances.length;P++){const D=this.symbolInstances.get(P),L=this.appearanceFeatureData[D.featureIndex];if(L&&D.placedIconSymbolIndex>=0){const N=L.id,V=n&&N!==void 0?n[String(N)]:void 0,G={type:"Point",id:L.id,properties:L.properties,geometry:[]},X=this.layers[0].appearances&&this.layers[0].appearances.find(Y=>Y.isActive({globals:u,feature:G,canonical:e,featureState:V}));if(L.activeAppearance===X)continue;if(X){L.activeAppearance=X;const Y={sortKey:void 0,text:void 0,icon:null,index:D.featureIndex,sourceLayerIndex:D.featureIndex,geometry:[],properties:L.properties,type:"Point",id:L.id};if(!X.hasCachedIconPrimary()){const be=this.getCombinedIconPrimary(X,p,G,e,c,Y,C);X.setCachedIconPrimary(be)}const ie=X.getCachedIconPrimary();if(!ie)continue;const _e=ie.toString(),ue=this.iconAtlasPositions&&this.iconAtlasPositions.get(_e);if(ue){const be=p.getAppearanceValueAndResolveTokens(X,"icon-offset",G,e,c),Ee=be&&Array.isArray(be)?be:[0,0];let Ae=Yv(ue,void 0,Ee,p.layout.get("icon-anchor").evaluate(G,{},e));const Ze=p.getAppearanceValueAndResolveTokens(X,"icon-rotate",G,e,c),ze=typeof Ze=="number"?Ze:0,Ke=ue.sdf,tt=p.layout.get("icon-text-fit").constantOr("none");tt!=="none"&&L.textShaping&&L.iconTextFitPadding&&L.fontScale&&(Ae=TT(Ae,L.textShaping,tt,L.iconTextFitPadding,Ee,L.fontScale));const st=this.calculateEffectiveAppearanceIconSize(X,u.zoom,G,e,c,C),yt=0,ht=1+(Math.min(Qc,Math.round(st*Al))<<1),rt=AT(Ae,ze,Ke,tt!=="none",C);L.isUsingAppearanceVertexData||(L.isUsingAppearanceVertexData=!0,L.layoutBasedVertexData=this.icon.getIconVertexData(y,D.numIconVertices));for(let He=0;He<rt.length;++He){const $e=rt[He],at=L.layoutBasedVertexData[0]||D.tileAnchorX,mt=L.layoutBasedVertexData[1]||D.tileAnchorY,it=16*$e.pixelOffsetTL.x,Lt=16*$e.pixelOffsetTL.y,Vt=16*$e.pixelOffsetBR.x,kt=16*$e.pixelOffsetBR.y,St=16*$e.minFontScaleX,wr=16*$e.minFontScaleY;this.icon.updateIconVertexData(y,at,mt,Math.round(32*$e.tl.x),Math.round(32*$e.tl.y),$e.texPrimary.x,$e.texPrimary.y,yt,ht,it,Lt,St,wr),this.icon.updateIconVertexData(y+1,at,mt,Math.round(32*$e.tr.x),Math.round(32*$e.tr.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y,yt,ht,Vt,Lt,St,wr),this.icon.updateIconVertexData(y+2,at,mt,Math.round(32*$e.bl.x),Math.round(32*$e.bl.y),$e.texPrimary.x,$e.texPrimary.y+$e.texPrimary.h,yt,ht,it,kt,St,wr),this.icon.updateIconVertexData(y+3,at,mt,Math.round(32*$e.br.x),Math.round(32*$e.br.y),$e.texPrimary.x+$e.texPrimary.w,$e.texPrimary.y+$e.texPrimary.h,yt,ht,Vt,kt,St,wr),y+=4}const ut=D.numIconVertices-4*rt.length;for(let He=0;He<ut;++He)this.icon.updateIconVertexData(y+He,0,0,0,0,0,0,0,0,0,0,0,0);m=!0}else y+=D.numIconVertices}else if(L.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(y,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(y+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(y+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(y+3,0,0,0,0,0,0,0,0,0,0,0,0),m=!0),y+=D.numIconVertices,L.activeAppearance=null;else if(L.isUsingAppearanceVertexData){const ie=L.layoutBasedVertexData.length/12;for(let _e=0;_e<ie;++_e){const ue=_e*12;this.icon.updateIconVertexData(y+_e,L.layoutBasedVertexData[ue+0],L.layoutBasedVertexData[ue+1],L.layoutBasedVertexData[ue+2],L.layoutBasedVertexData[ue+3],L.layoutBasedVertexData[ue+4],L.layoutBasedVertexData[ue+5],L.layoutBasedVertexData[ue+6],L.layoutBasedVertexData[ue+7],L.layoutBasedVertexData[ue+8],L.layoutBasedVertexData[ue+9],L.layoutBasedVertexData[ue+10],L.layoutBasedVertexData[ue+11])}y+=ie,L.isUsingAppearanceVertexData=!1,L.activeAppearance=null,m=!0}else y+=D.numIconVertices,L.activeAppearance=null}}return m}update(e,n,c,u,p,m,y){this.text.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,n,p,c,u,m,y,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let n=!1;const c=xe(e),u=1/c;let p=!1,m=!1;for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y),T=Qt(1,0,0),A=Qt(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:P,numIconVertices:D,numVerticalIconVertices:L}=b,N=C>0||P>0,V=D>0,G=this.elevationFeatures[b.elevationFeatureIndex];if(G){const X=new nt(b.tileAnchorX,b.tileAnchorY),Y=.075+G.pointElevation(X);b.zOffset!==Y&&(n=!0,b.zOffset=Y),Y!==0&&(this.hasAnyZOffset=!0);const ie=G.computeSlopeNormal(X,u),_e=vo(rr(),Qt(0,0,1),ie);ss(T,T,_e),ss(A,A,_e),T[2]*=c,A[2]*=c,T[0]===1&&T[1]===0&&T[2]===0&&A[0]===0&&A[1]===1&&A[2]===0||(p=p||N,m=m||V)}if(N&&(ox(this.text.orientationVertexArray,C,T,A),ox(this.text.orientationVertexArray,P,T,A)),V){const{placedIconSymbolIndex:X,verticalPlacedIconSymbolIndex:Y}=b;X>=0&&ox(this.icon.orientationVertexArray,D,T,A),Y>=0&&ox(this.icon.orientationVertexArray,L,T,A)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),n&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,y)=>{c+=m,c>p.length&&p.resize(c);for(let b=-m;b<0;b++)p.emplace(b+c,y)},n=(p,m,y)=>{u+=m,u>p.length&&p.resize(u);for(let b=-m;b<0;b++)p.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let c=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:T}=m,A=m.zOffset,C=T>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,A),e(this.text.zOffsetVertexArray,b,A)),C){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:D}=m;P>=0&&n(this.icon.zOffsetVertexArray,T,A),D>=0&&n(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,n,c,u,p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(m=>m.appearances&&m.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,n,c,u){return!!(e&&n&&c)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,n,c,u)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=AP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const c=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of n)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(e,n,c,u,p,m,y,b,T,A,C,P,D,L,N,V,G,X){const Y=e.indexArray,ie=e.layoutVertexArray,_e=e.globeExtVertexArray,ue=e.segments.prepareSegment(4*X,ie,Y,this.canOverlap?m.sortKey:void 0),be=this.glyphOffsetArray.length,Ee=ue.vertexLength,Ae=this.allowVerticalPlacement&&y===Zo.vertical?Math.PI/2:0,Ze=m.text&&m.text.sections;for(let tt=0;tt<n.length;tt++){const{tl:st,tr:yt,bl:ht,br:rt,texPrimary:ut,texSecondary:He,pixelOffsetTL:$e,pixelOffsetBR:at,minFontScaleX:mt,minFontScaleY:it,glyphOffset:Lt,isSDF:Vt,sectionIndex:kt}=n[tt],St=ue.vertexLength,wr=Lt[1];if(ty(ie,T.x,T.y,st.x,wr+st.y,ut.x,ut.y,c,Vt,$e.x,$e.y,mt,it),ty(ie,T.x,T.y,yt.x,wr+yt.y,ut.x+ut.w,ut.y,c,Vt,at.x,$e.y,mt,it),ty(ie,T.x,T.y,ht.x,wr+ht.y,ut.x,ut.y+ut.h,c,Vt,$e.x,at.y,mt,it),ty(ie,T.x,T.y,rt.x,wr+rt.y,ut.x+ut.w,ut.y+ut.h,c,Vt,at.x,at.y,mt,it),b){const{x:At,y:ir,z:Er}=b.anchor,[Fr,ii,Ar]=b.up;iy(_e,At,ir,Er,Fr,ii,Ar),iy(_e,At,ir,Er,Fr,ii,Ar),iy(_e,At,ir,Er,Fr,ii,Ar),iy(_e,At,ir,Er,Fr,ii,Ar),Hp(e.dynamicLayoutVertexArray,At,ir,Er,Ae)}else Hp(e.dynamicLayoutVertexArray,T.x,T.y,T.z,Ae);if(V){const At=He||ut;ry(e.iconTransitioningVertexArray,At.x,At.y),ry(e.iconTransitioningVertexArray,At.x+At.w,At.y),ry(e.iconTransitioningVertexArray,At.x,At.y+At.h),ry(e.iconTransitioningVertexArray,At.x+At.w,At.y+At.h)}Y.emplaceBack(St,St+1,St+2),Y.emplaceBack(St+1,St+2,St+3),ue.vertexLength+=4,ue.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Lt[0]),tt!==n.length-1&&kt===n[tt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,m,m.index,{},D,L,N,Ze&&Ze[kt],this.worldview)}const ze=X-n.length;ze!==0&&this._addNullVertices(ze,ie,c,b,_e,e,V,ue,Y);const Ke=b?b.anchor:T;e.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,T.x,T.y,be,this.glyphOffsetArray.length-be,Ee,A,C,T.segment,c?c[0]:0,c?c[1]:0,u[0],u[1],y,0,0,0,P,0),e.symbolInstanceIndices.push(G)}_addNullVertices(e,n,c,u,p,m,y,b,T){for(let A=0;A<e;A++){for(let P=0;P<4;P++)ty(n,0,0,0,0,0,0,c,!1,0,0,0,0),u&&iy(p,0,0,0,0,0,0),Hp(m.dynamicLayoutVertexArray,0,0,0,0),y&&ry(m.iconTransitioningVertexArray,0,0);const C=b.vertexLength;T.emplaceBack(C,C+1,C+2),T.emplaceBack(C+1,C+2,C+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,n,c,u,p,m,y){e.emplaceBack(n,c,u,p,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,c,u,p,m,y){const b=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),T=b.vertexLength,A=y.tileAnchorX,C=y.tileAnchorY;for(let D=0;D<4;D++)c.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(c.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,A,C,new nt(e.x1,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,A,C,new nt(e.x2,e.y1)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,A,C,new nt(e.x2,e.y2)),this._commitLayoutVertex(c.layoutVertexArray,u,p,m,A,C,new nt(e.x1,e.y2)),b.vertexLength+=4;const P=c.indexArray;P.emplaceBack(T,T+1),P.emplaceBack(T+1,T+2),P.emplaceBack(T+2,T+3),P.emplaceBack(T+3,T),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,c,u,p,m){for(let y=u;y<p;y++){const b=c.get(y),T=this.getSymbolInstanceTextSize(e,m,n,y);this._addCollisionDebugVertices(b,T,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,n,c,u,p,m){for(let y=u;y<p;y++){const b=c.get(y),T=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,T,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,n,c){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new OT(xp,GC.members,_a),this.iconCollisionBox=new OT(xp,GC.members,_a);const u=Vp(this.iconSizeData,e),p=Vp(this.textSizeData,e,c);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(p,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,c,u){const p=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),m=ST(this.textSizeData,e,p)/vs;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,n,c){const u=this.icon.placedSymbolArray.get(c),p=ST(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,n,c,u){e.emplaceBack(n,-c,-c,u),e.emplaceBack(n,c,-c,u),e.emplaceBack(n,c,c,u),e.emplaceBack(n,-c,c,u)}_updateTextDebugCollisionBoxes(e,n,c,u,p,m,y){for(let b=u;b<p;b++){const T=c.get(b),A=this.getSymbolInstanceTextSize(e,m,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,n,c,u,p,m,y){for(let b=u;b<p;b++){const T=c.get(b),A=this.getSymbolInstanceIconSize(e,n,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,T.padding,m.zOffset)}}updateCollisionDebugBuffers(e,n,c,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=Vp(this.iconSizeData,e,u),m=Vp(this.textSizeData,e,c);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(m,e,n,b.textBoxStartIndex,b.textBoxEndIndex,b,c),this._updateTextDebugCollisionBoxes(m,e,n,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,c),this._updateIconDebugCollisionBoxes(p,e,n,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(p,e,n,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,c,u,p,m,y,b,T){const A={};if(n<c){const{x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie,featureIndex:_e}=e.get(n);A.textBox={x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie},A.textFeatureIndex=_e}if(u<p){const{x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie,featureIndex:_e}=e.get(u);A.verticalTextBox={x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie},A.verticalTextFeatureIndex=_e}if(m<y){const{x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie,featureIndex:_e}=e.get(m);A.iconBox={x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie},A.iconFeatureIndex=_e}if(b<T){const{x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie,featureIndex:_e}=e.get(b);A.verticalIconBox={x1:C,y1:P,x2:D,y2:L,padding:N,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:X,tileAnchorX:Y,tileAnchorY:ie},A.verticalIconFeatureIndex=_e}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const c=e.placedSymbolArray.get(n),u=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),c=Math.cos(e),u=[],p=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+c*b.tileAnchorY)),p.push(b.featureIndex)}return m.sort((y,b)=>u[y]-u[b]||p[b]-p[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:T}=c;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const n=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let c;return this.elevationFeatures&&n<this.elevationFeatures.length&&(c=this.elevationFeatures[n]),c}}function CP(s,e){return e.replace(/{([^{}]+)}/g,(n,c)=>c in s?String(s[c]):"")}let PP,RP,DT;zt(ax,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),ax.addDynamicAttributes=Hp;class kP{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:wu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}zt(kP,"FormatSectionOverride",{omit:["defaultValue"]});const LT=()=>DT||(DT={layout:PP||(PP=new gn({"symbol-placement":new ft(Le.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(Le.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(Le.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pt(Le.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(Le.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ft(Le.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ft(Le.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ft(Le.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ft(Le.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(Le.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(Le.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pt(Le.layout_symbol["icon-size"]),"icon-size-scale-range":new ft(Le.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Pt(Le.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(Le.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pt(Le.layout_symbol["icon-image"]),"icon-image-use-theme":new ft({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Pt(Le.layout_symbol["icon-rotate"]),"icon-padding":new ft(Le.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(Le.layout_symbol["icon-keep-upright"]),"icon-offset":new Pt(Le.layout_symbol["icon-offset"]),"icon-anchor":new Pt(Le.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(Le.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(Le.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(Le.layout_symbol["text-rotation-alignment"]),"text-field":new Pt(Le.layout_symbol["text-field"]),"text-font":new Pt(Le.layout_symbol["text-font"]),"text-size":new Pt(Le.layout_symbol["text-size"]),"text-size-scale-range":new ft(Le.layout_symbol["text-size-scale-range"]),"text-max-width":new Pt(Le.layout_symbol["text-max-width"]),"text-line-height":new Pt(Le.layout_symbol["text-line-height"]),"text-letter-spacing":new Pt(Le.layout_symbol["text-letter-spacing"]),"text-justify":new Pt(Le.layout_symbol["text-justify"]),"text-radial-offset":new Pt(Le.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(Le.layout_symbol["text-variable-anchor"]),"text-anchor":new Pt(Le.layout_symbol["text-anchor"]),"text-max-angle":new ft(Le.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(Le.layout_symbol["text-writing-mode"]),"text-rotate":new Pt(Le.layout_symbol["text-rotate"]),"text-padding":new ft(Le.layout_symbol["text-padding"]),"text-keep-upright":new ft(Le.layout_symbol["text-keep-upright"]),"text-transform":new Pt(Le.layout_symbol["text-transform"]),"text-offset":new Pt(Le.layout_symbol["text-offset"]),"text-allow-overlap":new ft(Le.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ft(Le.layout_symbol["text-ignore-placement"]),"text-optional":new ft(Le.layout_symbol["text-optional"]),visibility:new ft(Le.layout_symbol.visibility)})),paint:RP||(RP=new gn({"icon-opacity":new Pt(Le.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Pt(Le.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Pt(Le.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Pt(Le.paint_symbol["text-emissive-strength"]),"icon-color":new Pt(Le.paint_symbol["icon-color"]),"icon-halo-color":new Pt(Le.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pt(Le.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pt(Le.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(Le.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(Le.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ft(Le.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Pt(Le.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Pt(Le.paint_symbol["text-occlusion-opacity"]),"text-color":new Pt(Le.paint_symbol["text-color"],{runtimeType:bo,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Pt(Le.paint_symbol["text-halo-color"]),"text-halo-width":new Pt(Le.paint_symbol["text-halo-width"]),"text-halo-blur":new Pt(Le.paint_symbol["text-halo-blur"]),"text-translate":new ft(Le.paint_symbol["text-translate"]),"text-translate-anchor":new ft(Le.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ft(Le.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ft(Le.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ft(Le.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ft(Le.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Pt(Le.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},DT);class lx extends qs{constructor(e,n,c,u){super(e,LT(),n,c,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=me([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,n){super.recalculate(e,n),this.appearances&&this.appearances.forEach(u=>{u.recalculate(e,n,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const u=[];for(const p of c)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,c,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===c&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(p,m,y,b){p=hn(p),m=qi(m);const T=we(),A=p/3,C=1-2*A,P=[C,A,A,0,A,C,A,0,A,A,C,0,0,0,0,1],D=.5-.5*m,L=b-y;return re(T,[L,0,0,0,0,L,0,0,0,0,L,0,y,y,y,1],[m,0,0,0,0,m,0,0,0,0,m,0,D,D,D,1]),re(T,T,P),T}(e,n,c,u),this._saturation=e,this._contrast=n,this._brightnessMin=c,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,c,u){const p=this.layout.get(e).evaluate(n,{},c,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||ap(m.value)||!p?p:CP(n.properties,p)}getAppearanceValueAndResolveTokens(e,n,c,u,p){const m=e.getProperty(n);if(!m)return;const y=m.evaluate(c,{},u,p),b=e.getUnevaluatedProperties()._values[n];return b.isDataDriven()||ap(b.value)||!y||typeof y!="string"?y:CP(c.properties,y)}createBucket(e){return new ax(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of LT().paint.overridableProperties){if(!lx.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),c=new kP(n),u=new op(c,n.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=n.value.kind==="constant"||n.value.kind==="source"?new Pd("source",u):new ic("composite",u,n.value.zoomStops,n.value.interpolationType),this.paint._values[e]=new ga(n.property,p,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&lx.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const c=e.get("text-field"),u=LT().paint.properties[n];let p=!1;const m=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof as)m(c.value.value.sections);else if(c.value.kind==="source"){const y=T=>{p||(T instanceof _l&&ts(T.value)===Lc?m(T.value.sections):T instanceof zc?m(T.sections):T.eachChild(y))},b=c.value;b._styleExpression&&y(b._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,c){return{config:new Sl(this,{zoom:n,lut:c}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let MP,OP,DP,LP;var zT=Vr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function cx(s,e,n,c,u,p,m,y){const b=[s,e,1,n,c,1,u,p,1],T=[m,y,1],A=te([],b),[C,P,D]=ns(T,T,A);return J(b,b,[C,0,0,0,P,0,0,0,D])}function zP(s,e,n,c,u,p,m,y){const b=function(T,A,C,P,D,L,N,V){const G=cx(0,0,1,0,1,1,0,1),X=cx(T,A,C,P,D,L,N,V);return J(X,X,te([],G))}(s,e,n,c,u,p,m,y);return[b[2]/b[8]/xt,b[5]/b[8]/xt]}function ux(s){return[s[0],Math.min(Math.max(s[1],-oe),oe)]}class FP extends pl{constructor(e,n,c,u){super(),this.id=e,this.dispatcher=c,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Fo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=fg(this.map._requestManager.transformRequest(this.url,Mc.Image),(c,u)=>{this._imageRequest=null,this._loaded=!0,c?this.fire(new ld(c)):u&&(this.image=u instanceof HTMLImageElement?wo.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new V_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Fo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof V_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],c=e[0][1];for(const p of e)p[1]>c&&(c=p[1]),p[1]<n&&(n=p[1]);const u=(c+n)/2;if(u>oe?this.onNorthPole=!0:u<-oe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Me.fromLngLat);this.tileID=function(m){let y=1/0,b=1/0,T=-1/0,A=-1/0;for(const N of m)y=Math.min(y,N.x),b=Math.min(b,N.y),T=Math.max(T,N.x),A=Math.max(A,N.y);const C=Math.max(T-y,A-b),P=Math.max(0,Math.floor(-Math.log2(C))),D=Math.pow(2,P);let L=Math.floor((y+T)/2*D);return L>1&&(L-=1),new Ho(P,L,Math.floor((b+A)/2*D))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Fo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof V_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const G in this.tiles){const X=this.tiles[G];X.state!=="loaded"&&(X.state="loaded",X.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=K_(new Ho(0,0,0),this.map.transform.projection),c=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(G){const X=G[1].x-G[0].x,Y=G[1].y-G[0].y,ie=G[2].x-G[1].x,_e=G[2].y-G[1].y,ue=G[3].x-G[2].x,be=G[3].y-G[2].y,Ee=G[0].x-G[3].x,Ae=G[0].y-G[3].y,Ze=X*_e-ie*Y,ze=ie*be-ue*_e,Ke=ue*Ae-Ee*be,tt=Ee*Y-X*Ae;return Ze>0&&ze>0&&Ke>0&&tt>0||Ze<0&&ze<0&&Ke<0&&tt<0}(c))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=K_(this.tileID,this.map.transform.projection),[p,m,y,b]=this.coordinates.map(G=>{const X=u.projection.project(G[0],G[1]);return bP(u,X)._round()});this.perspectiveTransform=zP(p.x,p.y,m.x,m.y,y.x,y.y,b.x,b.y);const T=this._boundsArray=new qu;T.emplaceBack(p.x,p.y,0,0),T.emplaceBack(m.x,m.y,xt,0),T.emplaceBack(b.x,b.y,0,xt),T.emplaceBack(y.x,y.y,xt,xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,zT.members),this.boundsSegments=cn.simpleSegment(0,0,4,2);const A=[],C=[ux((P=this.coordinates)[0]),ux(P[1]),ux(P[2]),ux(P[3])];var P;const[D,L,N,V]=function(G){let X=G[0][0],Y=X,ie=G[0][1],_e=ie;for(let ue=1;ue<G.length;ue++)G[ue][0]<X?X=G[ue][0]:G[ue][0]>Y&&(Y=G[ue][0]),G[ue][1]<ie?ie=G[ue][1]:G[ue][1]>_e&&(_e=G[ue][1]);return[X,ie,Y-X,_e-ie]}(C);{const G=new qu,[X,Y,ie,_e]=function(rt){let ut=rt[0].x,He=ut,$e=rt[0].y,at=$e;for(let mt=1;mt<rt.length;mt++)rt[mt].x<ut?ut=rt[mt].x:rt[mt].x>He&&(He=rt[mt].x),rt[mt].y<$e?$e=rt[mt].y:rt[mt].y>at&&(at=rt[mt].y);return[ut,$e,He-ut,at-$e]}(c),ue=rt=>[(rt.x-X)/ie,(rt.y-Y)/_e],[be,Ee,Ae,Ze]=c.map(ue),ze=function(rt,ut,He,$e,at,mt,it,Lt){const Vt=cx(0,0,1,0,1,1,0,1);return J(Vt,Vt,te([],cx(rt,ut,He,$e,at,mt,it,Lt)))}(be[0],be[1],Ee[0],Ee[1],Ae[0],Ae[1],Ze[0],Ze[1]);this.elevatedGlobePerspectiveTransform=zP(be[0],be[1],Ee[0],Ee[1],Ae[0],Ae[1],Ze[0],Ze[1]);const Ke=(rt,ut)=>{A.push(rt.lng);const He=Math.round((rt.lng-D)/N*xt),$e=Math.round((rt.lat-L)/V*xt),at=ue(ut),mt=ns([],[at[0],at[1],1],ze),it=Math.round(mt[0]/mt[2]*xt),Lt=Math.round(mt[1]/mt[2]*xt);G.emplaceBack(He,$e,it,Lt)},tt=c[3].x-c[0].x,st=c[3].y-c[0].y,yt=c[2].x-c[1].x,ht=c[2].y-c[1].y;for(let rt=0;rt<65;rt++){const ut=rt/64,He=[c[0].x+ut*tt,c[0].y+ut*st],$e=[c[1].x+ut*yt,c[1].y+ut*ht],at=$e[0]-He[0],mt=$e[1]-He[1];for(let it=0;it<65;it++){const Lt=it/64,Vt={x:He[0]+at*Lt,y:He[1]+mt*Lt};Ke(n.projection.unproject(Vt.x,Vt.y),Vt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(G,zT.members)}{this.maxLongitudeTriangleSize=0;let G=[],X=new rn;const Y=(ie,_e,ue)=>{X.emplaceBack(ie,_e,ue);const be=A[ie],Ee=A[_e],Ae=A[ue],Ze=Math.min(Math.min(be,Ee),Ae),ze=Math.max(Math.max(be,Ee),Ae)-Ze;ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ze),G.push(Ze+ze/2)};for(let ie=0;ie<64;ie++)for(let _e=0;_e<64;_e++){const ue=65*ie+_e,be=ue+1,Ee=ue+65,Ae=Ee+1;Y(ue,Ee,be),Y(be,Ee,Ae)}[G,X]=function(ie,_e){const ue=Array.from({length:ie.length},(Ae,Ze)=>Ze);ue.sort((Ae,Ze)=>ie[Ae]-ie[Ze]);const be=[],Ee=new rn;for(let Ae=0;Ae<ue.length;Ae++){const Ze=ue[Ae];be.push(ie[Ze]);const ze=3*Ze,Ke=ze+1;Ee.emplaceBack(_e.uint16[ze],_e.uint16[Ke],_e.uint16[Ke+1])}return[be,Ee]}(G,X),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(X)}this.elevatedGlobeSegments=cn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,N/xt,0,V/xt,0,0,L,D,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,c=n.gl;!this._dirty||this.texture instanceof V_||(this.texture?this.texture.update(this.image):(this.texture=new lT(n,this.image,c.RGBA8),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const c=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=e+180)+360*Math.round((c[0]-p)/360);var p;const m=new cn,y=(C,P)=>{m.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:n.segments[0].vertexLength,primitiveLength:P,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(c[0]-u)<=b){const C=Xr(c,0,c.length,u+b);return C===c.length||y(C,Ei(c,C+1,c.length,u+360-b)-C),m}u<c[0]&&(u+=360);const T=Ei(c,0,c.length,u-b);if(T===c.length)return y(0,c.length),m;y(0,T-0);const A=Xr(c,T+1,c.length,u+b);return A!==c.length&&y(A,c.length-A),m}}const t4=(Math.pow(256,2)-1)/16907520;class BP extends qs{constructor(e,n,c,u){super(e,{layout:DP||(DP=new gn({visibility:new ft(Le.layout_raster.visibility)})),paint:LP||(LP=new gn({"raster-opacity":new ft(Le.paint_raster["raster-opacity"]),"raster-color":new Vu(Le.paint_raster["raster-color"]),"raster-color-mix":new ft(Le.paint_raster["raster-color-mix"]),"raster-color-range":new ft(Le.paint_raster["raster-color-range"]),"raster-hue-rotate":new ft(Le.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(Le.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(Le.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(Le.paint_raster["raster-saturation"]),"raster-contrast":new ft(Le.paint_raster["raster-contrast"]),"raster-resampling":new ft(Le.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(Le.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ft(Le.paint_raster["raster-emissive-strength"]),"raster-array-band":new ft(Le.paint_raster["raster-array-band"]),"raster-elevation":new ft(Le.paint_raster["raster-elevation"]),"raster-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},n,c,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof FP&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[c,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(c)&&isNaN(u)||c===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=I_({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:c,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[c,u])}}let NP,jP,VP,UP,$P;class GP extends qs{constructor(e,n,c,u){super(e,{layout:NP||(NP=new gn({visibility:new ft(Le["layout_raster-particle"].visibility)})),paint:jP||(jP=new gn({"raster-particle-array-band":new ft(Le["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ft(Le["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Vu(Le["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ft(Le["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ft(Le["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ft(Le["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ft(Le["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ft(Le["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},n,c,u),this._updateColorRamp(),this.lastInvalidatedAt=wo.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=I_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=wo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class r4 extends qs{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function FT(s,e,n){const c=[0,0,1],u=br([]);return Hi(u,u,n?-Nr(s)+Math.PI:Nr(s)),_i(u,u,-Nr(e)),ss(c,c,u),Hr(c,c)}const HP={None:0,Model:1,Symbol:2,FillExtrusion:4};class hx{constructor(e,n,c,u){this.message=(e?`${e}: `:"")+c,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function BT(s,e){const n=s.indexOf("://")===-1;try{return new URL(s,n&&e?"http://example.com":void 0),!0}catch{return!1}}class qP{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WP{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new bp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const n=16*e,c=this.instancedDataArray.float32;let u=Math.floor(c[n+2]);const p=1.05*(c[n+2]-u);return u/=100,[c[n]%1*1.05,c[n+1]%1*1.05,p,u]}tileCoordinatesForInstance(e){const n=16*e,c=this.instancedDataArray.float32;let u=c[n+0];return u=u>xt?u-xt:u,new nt(Math.trunc(u),Math.trunc(c[n+1]))}translationForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+4],c[n+5],c[n+6]]}rotationScaleForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+7],c[n+8],c[n+9],c[n+10],c[n+11],c[n+12],c[n+13],c[n+14],c[n+15]]}transformForInstance(e){const n=16*e,c=this.instancedDataArray.float32;return[c[n+7],c[n+8],c[n+9],c[n+4],c[n+10],c[n+11],c[n+12],c[n+5],c[n+13],c[n+14],c[n+15],c[n+6],0,0,0,1]}}class NT{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,n){}updateAppearances(e,n,c,u){}populate(e,n,c,u){this.tileToMeter=xe(c);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:y,index:b,sourceLayerIndex:T}of e){const A=y??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),C=je(m,p);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{worldview:this.worldview,activeFloors:n.activeFloors}),C,c))continue;const P={id:A,sourceLayerIndex:T,index:b,geometry:p?C.geometry:et(m,c,u),properties:m.properties,type:m.type,patterns:{}},D=this.addFeature(P,P.geometry,C);D&&n.featureIndex.insert(m,P.geometry,b,T,this.index,this.instancesPerModel[D].instancedDataArray.length,xt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,n=this.layers[0].scope;let c=0;for(const u of this.modelUris){const p=e.getModel(u,n);if(!p)continue;const m=this.instancesPerModel[u];if(m){const y=.5*Vi(p.aabb.max,p.aabb.min)*m.maxScale+m.maxXYTranslationDistance,b=Math.min(xt,Math.max(y/this.tileToMeter,xt/32));c=Math.max(b,c)}}return c}update(e,n,c,u){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];for(const u of c.features){const p=this.layers[0],m=u.feature,y=this.canonical,b=p.paint.get("model-rotation").evaluate(m,{},y),T=p.paint.get("model-scale").evaluate(m,{},y),A=p.paint.get("model-translation").evaluate(m,{},y);Ss(u.rotation,b)&&Ss(u.scale,T)&&Ss(u.translation,A)||(this.evaluate(u,u.featureStates,c,!0),e=!0)}}return e}updateReplacement(e,n,c,u){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const p=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Lv(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const y in this.instancesPerModel){const b=this.instancesPerModel[y],T=b.instancedDataArray;for(const A of b.features){const C=A.instancedDataOffset,P=A.instancedDataCount;for(let D=0;D<P;D++){const L=16*(D+C);let N=T.float32[L+0];const V=N>xt;N=V?N-xt:N;const G=Math.floor(N),X=Math.floor(T.float32[L+1]);let Y=!1;for(const ie of this.activeReplacements)if(!MA(ie,c,HP.Model,u)&&!(ie.min.x>G||G>ie.max.x||ie.min.y>X||X>ie.max.y)&&(Y=Kb(zA(G,X,e.canonical,ie.footprintTileId.canonical),ie.footprint),Y))break;T.float32[L]=Y?N+xt:N,m=m||Y!==V}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length<0||c.instancedDataArray.length===0||(c.instancedDataBuffer?c.instancedDataBuffer.updateData(c.instancedDataArray):c.instancedDataBuffer=e.createVertexBuffer(c.instancedDataArray,PN.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const c=this.instancesPerModel[n];c.instancedDataArray.length!==0&&c.instancedDataBuffer&&c.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const n of this.modelUris)e.removeModel(n,"",!0)}addFeature(e,n,c){const u=this.layers[0],p=u.layout.get("model-id").evaluate(c,{},this.canonical);if(!p)return or(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;(BT(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new WP);const m=this.instancesPerModel[p],y=m.instancedDataArray,b=new qP(c,y.length);for(const T of n)for(const A of T){if(A.x<0||A.x>=xt||A.y<0||A.y>=xt)continue;if(this.lookupDim!==0){const P=(this.lookupDim-1)/xt,D=this.lookupDim*(A.y*P|0)+A.x*P|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}}this.instanceCount++;const C=y.length;y.resize(C+1),m.instancesEvaluatedElevation.push(0),y.float32[16*C]=A.x,y.float32[16*C+1]=A.y}return b.instancedDataCount=m.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(b),this.evaluate(b,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,n,c,u){const p=this.layers[0],m=e.feature,y=this.canonical,b=e.rotation=p.paint.get("model-rotation").evaluate(m,n,y),T=e.scale=p.paint.get("model-scale").evaluate(m,n,y),A=e.translation=p.paint.get("model-translation").evaluate(m,n,y),C=Object.assign({},p.paint.get("model-color").evaluate(m,n,y));C.a=p.paint.get("model-color-mix-intensity").evaluate(m,n,y);const P=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]);const D=A[0]*A[0]+A[1]*A[1],L=D>0?Math.sqrt(D):0;c.maxScale=Math.max(Math.max(c.maxScale,T[0]),Math.max(T[1],T[2])),c.maxXYTranslationDistance=Math.max(c.maxXYTranslationDistance,L),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),bC(P,b,T);const N=Math.round(100*C.a)+C.b/1.05;for(let V=0;V<e.instancedDataCount;++V){const G=e.instancedDataOffset+V,X=16*G,Y=c.instancedDataArray.float32;let ie=0;u&&(ie=Y[X+6]-c.instancesEvaluatedElevation[G]);const _e=0|Y[X+1];Y[X]=(0|Y[X])+C.r/1.05,Y[X+1]=_e+C.g/1.05,Y[X+2]=N,Y[X+3]=1/(y.z>10?this.tileToMeter:xe(y,_e)),Y[X+4]=A[0],Y[X+5]=A[1],Y[X+6]=A[2]+ie,Y[X+7]=P[0],Y[X+8]=P[1],Y[X+9]=P[2],Y[X+10]=P[4],Y[X+11]=P[5],Y[X+12]=P[6],Y[X+13]=P[8],Y[X+14]=P[9],Y[X+15]=P[10],c.instancesEvaluatedElevation[G]=A[2]}}}let ZP,XP;zt(NT,"ModelBucket",{omit:["layers"]}),zt(WP,"PerModelAttributes"),zt(qP,"ModelFeature");class qp{constructor(e,n,c){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=c}static create(e,n,c){const u=c||e.findDEMTileFor(n);if(!u||!u.dem)return;const p=u.dem,m=u.tileID,y=1<<n.canonical.z-m.canonical.z;return new qp(u,p.dim/xt/y,[(n.canonical.x/y-m.canonical.x)*p.dim,(n.canonical.y/y-m.canonical.y)*p.dim])}tileCoordToPixel(e,n){const c=n*this._scale+this._offset[1];return new nt(Math.floor(e*this._scale+this._offset[0]),Math.floor(c))}getElevationAt(e,n,c,u){const p=e*this._scale+this._offset[0],m=n*this._scale+this._offset[1],y=Math.floor(p),b=Math.floor(m),T=this._dem;return u=!!u,c?pr(pr(T.get(y,b,u),T.get(y,b+1,u),m-b),pr(T.get(y+1,b,u),T.get(y+1,b+1,u),m-b),p-y):T.get(y,b,u)}getElevationAtPixel(e,n,c){return this._dem.get(e,n,!!c)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*K(1,e)*this._dem.stride}}const jT=new Float32Array(262144),Wd=new Uint8Array(262144);function KP(s){let e=0;if(s.meshes)for(const n of s.meshes)e=Math.max(e,n.aabb.max[2]);if(s.children)for(const n of s.children)e=Math.max(e,KP(n));return e}function YP(s,e,n){if(s.meshes)for(const c of s.meshes){if(c.aabb.min[0]===1/0)continue;const u=Lr.applyTransform(c.aabb,s.globalMatrix);n.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(s.children)for(const c of s.children)YP(c,e,n)}const JP=["","wall","door","roof","window","lamp","logo"];class QP{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:KP(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new Lr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const c of this.node.meshes)this.node.lightMeshIndex!==e&&(c.transformedAabb=Lr.applyTransformFast(c.aabb,this.node.globalMatrix),n.encapsulate(c.transformedAabb)),e++;this.aabb=n}return this.aabb}}class dx{constructor(e,n,c,u,p,m,y,b){this.id=c,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Fp.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Fp.HasMapboxMeshFeatures),p&&(this.modelTraits|=Fp.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of n)this.nodesInfo.push(new QP(T)),YP(T,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,n){for(const c of this.getNodesInfo()){const u=c.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}updateAppearances(e,n,c,u){}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const c=n?this.stateDependentLayers:this.layers;if(!ks(e,this.states))for(const u of c)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const c of n){const u=c.node;this.uploaded?this.updatePbrBuffer(u):hT(u,e,!0)}for(const c of n)Wv(c.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const c of e.meshes)c.pbrBuffer&&(c.pbrBuffer.updateData(c.featureArray),n=!0);return n}needsReEvaluation(e,n,c){const u=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||u.name!==this.projection.name||ny(c.paint.get("model-color").value,m)||ny(c.paint.get("model-color-mix-intensity").value,m)||ny(c.paint.get("model-roughness").value,m)||ny(c.paint.get("model-emissive-strength").value,m)||ny(c.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=u,this.brightness=p;const y=this.getNodesInfo();for(const b of y)b.state=null;return!0}return!1}evaluateTransform(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const c=this.getNodesInfo(),u=this.id.canonical;for(const p of c){const m=p.feature;p.evaluatedTranslation=n.paint.get("model-translation").evaluate(m,{},u),p.evaluatedScale=n.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e,n){const c=this.getNodesInfo();for(const u of c){if(!u.node.meshes)continue;const p=u.feature,m=n&&n[p.id];if(ks(m,u.state))continue;u.state=structuredClone(m);const y=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],T=u.evaluatedRMEA[2],A=this.id.canonical;if(u.hasTranslucentParts=!1,y){for(let C=0;C<JP.length;C++){const P=JP[C];P.length&&(p.properties.part=P);const D=e.paint.get("model-color").evaluate(p,m,A).toPremultipliedRenderColor(null),L=e.paint.get("model-color-mix-intensity").evaluate(p,m,A);u.evaluatedColor[C]=[D.r,D.g,D.b,L],u.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(p,m,A),u.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(p,m,A),u.evaluatedRMEA[C][3]=D.a,u.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,A),!u.hasTranslucentParts&&D.a<1&&(u.hasTranslucentParts=!0)}delete p.properties.part,n4(u,b!==u.evaluatedColor[2]||T!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,A);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,A),u.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,A),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,c,u){const p=e.findDEMTileFor(c);if(p&&(p.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=qp.create(e,c,p);if(!m)return;this.modelTraits&Fp.HasMapboxMeshFeatures&&this.updateDEM(e,m,c,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const T=b.footprint.vertices;let A=m.getElevationAt(T[0].x,T[0].y,!0,!0);for(let C=1;C<T.length;C++)A=Math.min(A,m.getElevationAt(T[C].x,T[C].y,!0,!0));b.elevation=A}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,c,u){let p=n._dem._modifiedForSources[u];if(p===void 0&&(n._dem._modifiedForSources[u]=[],p=n._dem._modifiedForSources[u]),p.includes(c.canonical))return;const m=n._dem.dim;p.push(c.canonical);let y=!1;for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.grid)continue;const A=T.footprint.grid,C=n.tileCoordToPixel(A.min.x,A.min.y),P=n.tileCoordToPixel(A.max.x,A.max.y),D=Math.min(Math.min(m-P.y,C.x),Math.min(C.y,m-P.x));if(D<0)continue;const L=W(D,2,5);let N=Math.max(0,C.x-L),V=Math.max(0,C.y-L),G=Math.min(P.x+L,m-1),X=Math.min(P.y+L,m-1);for(let ue=V;ue<=X;++ue)for(let be=N;be<=G;++be)Wd[ue*m+be]=255;let Y=0,ie=0;for(let ue=0;ue<A.cellsY;++ue)for(let be=0;be<A.cellsX;++be){if(!A.cells[ue*A.cellsX+be])continue;const Ee=n.tileCoordToPixel(A.min.x+be/A.xScale,A.min.y+ue/A.yScale),Ae=n.tileCoordToPixel(A.min.x+(be+1)/A.xScale,A.min.y+(ue+1)/A.yScale);for(let Ze=Ee.y;Ze<=Math.min(Ae.y+1,m-1);++Ze)for(let ze=Ee.x;ze<=Math.min(Ae.x+1,m-1);++ze)Wd[Ze*m+ze]===255&&(Wd[Ze*m+ze]=0,Y+=n.getElevationAtPixel(ze,Ze),ie++)}const _e=Y/ie;N=Math.max(1,C.x-L),V=Math.max(1,C.y-L),G=Math.min(P.x+L,m-2),X=Math.min(P.y+L,m-2),y=!0;for(let ue=V;ue<=X;++ue)for(let be=N;be<=G;++be)Wd[ue*m+be]===0&&(jT[ue*m+be]=n._dem.set(be,ue,_e));for(let ue=1;ue<L;++ue){N=Math.max(1,C.x-ue),V=Math.max(1,C.y-ue),G=Math.min(P.x+ue,m-2),X=Math.min(P.y+ue,m-2);for(let be=V;be<=X;++be)for(let Ee=N;Ee<=G;++Ee){const Ae=be*m+Ee;if(Wd[Ae]===255){let Ze=0,ze=0,Ke=-1,tt=-1;for(let st=-1;st<=1;++st)for(let yt=-1;yt<=1;++yt){const ht=(be+st)*m+Ee+yt;if(Wd[ht]>=ue)continue;const rt=jT[ht],ut=Math.abs(rt);ut>ze&&(Ze=rt,ze=ut,Ke=yt,tt=st)}if(ze>.1){const st=1-(ue+.5*Math.abs(Ke*tt))/L;let yt=n._dem.get(Ee,be)+Ze*st;const ht=n._dem.get(Ee+Ke,be+tt),rt=n._dem.get(Ee-Ke,be-tt,!0);(yt-ht)*(yt-rt)>0&&(yt=(ht+rt)/2),jT[Ae]=n._dem.set(Ee,be,yt),Wd[Ae]=ue}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=wo.now())}setFilter(e){this.filter=e?fp(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Ui(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Wv(n.node),dT(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const p=u.node.footprint;u.hiddenByReplacement=!!p&&!c.find(m=>m.footprint===p)}}getHeightAtTileCoord(e,n){const c=[],u=[0,0,0],p=me([]);for(const m of this.getNodesInfo()){const y=m.node.meshes[0],b=y.transformedAabb;if(e<b.min[0]||n<b.min[1]||e>b.max[0]||n>b.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};fe(p,m.node.globalMatrix),u[0]=e,u[1]=n,bi(u,u,p);const T=(u[0]-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*Gd|0,A=Math.min(63,(u[1]-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*Gd|0)*Gd+Math.min(63,T),C=y.heightmap[A];if(!(C<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:C,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new nt(e,n),new nt(e,n),c),c.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function ny(s,e){return s instanceof Pd&&!s.isLightConstant&&e}function i4(s,e,n,c,u,p,m,y){let b=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,A=240&e|(240&e)>>4;n[3]>0&&(b=pr(b,255*n[0],n[3]),T=pr(T,255*n[1],n[3]),A=pr(A,255*n[2],n[3]));const C=b<<8|T,P=A<<8|Math.floor(255*c[3]),D=function(ue){const be=W(ue,0,2);return Math.min(Math.round(.5*be*255),255)}(c[2])<<8|15*c[0]<<4|15*c[1],L=W(u[0],0,1),N=W(u[1],0,1),V=W(u[2],0,1),G=W(u[3],0,1);let X,Y,ie,_e;if(L!==N&&m!==p&&N!==L){const ue=m-p;Y=1/(ue*(N-L)),ie=-(p+ue*L)/(ue*(N-L));const be=W(u[4],-1,1);_e=Math.pow(10,be),X=255*V<<8|255*G}else X=65535,Y=0,ie=1,_e=1;if(s.emplaceBack(C,P,D,X,Y,ie,_e),y){const ue=y.length;y.clear();for(let be=0;be<ue;be++)y.emplaceBack(C,P,D,X,Y,ie,_e)}}function n4(s,e,n){const c=s.node;let u=0;const p=n&Fp.HasMeshoptCompression;for(const m of c.meshes){if(c.lights&&c.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new Yu,m.featureArray.reserve(m.featureData.length);let y=e;for(const b of m.featureData){const T=p?65535&b:b>>16&65535,A=p?b>>16&65535:65535&b,C=(15&A)<8?15&A:0,P=s.evaluatedRMEA[C],D=s.evaluatedColor[C],L=s.emissionHeightBasedParams[C];let N;if(y&&C===2&&c.lights&&(N=new Yu,N.resize(10*c.lights.length)),i4(m.featureArray,T,D,P,L,m.aabb.min[2],m.aabb.max[2],N),N&&y){y=!1;const V=c.meshes[c.lightMeshIndex];V.featureArray=N,V.featureArray._trim()}}m.featureArray._trim(),u++}}zt(dx,"Tiled3dModelBucket",{omit:["layers"]}),zt(QP,"Tiled3dModelFeature");const s4=["id","tile","layer","source","sourceLayer","state"];class Zd{constructor(e,n,c,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=c,this._y=u,this.properties=e?e.properties:{},this.id=p}clone(){const e=new Zd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of s4)this[n]!==void 0&&(e[n]=this[n]);return e}}class Xd extends pl{constructor(e,n,c,u){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=n,this._modelsInfo=new Map}load(){const e=[];for(const n in this._options.models){const c=this._options.models[n],u=this._modelsInfo.get(n);if(u){const p=u.model;p.position=c.position!=null?new z(c.position[0],c.position[1]):new z(0,0),p.orientation=c.orientation!=null?c.orientation:[0,0,0],u.modelSpec=c,Xd.applyModelSpecification(p,c),p.computeBoundsAndApplyParent(),this.models.push(p)}else{const p=yC(this.map._requestManager.transformRequest(c.uri,Mc.Model).url).then(m=>{if(!m)return;const y=pT(m),b=new TC(n,c.uri,c.position,c.orientation,y);Xd.applyModelSpecification(b,c),b.computeBoundsAndApplyParent(),this.models.push(b),this._modelsInfo.set(n,{modelSpec:c,model:b})}).catch(m=>{this.fire(new ld(new Error(`Could not load model ${n} from ${c.uri}: ${m.message}`)))});e.push(p)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Fo("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this._loaded=!0,this.fire(new ld(new Error(`Could not load models: ${n.message}`)))})}static applyModelSpecification(e,n){n.nodeOverrides&&Xd.convertNodeOverrides(e,n.nodeOverrides),n.materialOverrides&&Xd.convertMaterialOverrides(e,n.materialOverrides),n.nodeOverrideNames&&(e.nodeOverrideNames=[...n.nodeOverrideNames]),n.materialOverrideNames&&(e.materialOverrideNames=[...n.materialOverrideNames]),n.featureProperties&&(e.featureProperties=n.featureProperties)}static convertNodeOverrides(e,n){if(Array.isArray(n)&&n.every(c=>typeof c=="string")){e.nodeOverrideNames=[];for(const c of n)e.nodeOverrideNames.push(c)}else Object.entries(n).forEach(([c,u])=>{const p={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const m=u.orientation;m&&(p.orientation=m)}e.nodeOverrides.set(c,p)})}static convertMaterialOverrides(e,n){if(Array.isArray(n)&&n.every(c=>typeof c=="string")){e.materialOverrideNames=[];for(const c of n)e.materialOverrideNames.push(c)}else Object.entries(n).forEach(([c,u])=>{const p={color:new yi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},m=u["model-color"];m!==void 0&&(p.color.r=m[0],p.color.g=m[1],p.color.b=m[2]);const y=u["model-color-mix-intensity"];y!==void 0&&(p.colorMix=y);const b=u["model-emissive-strength"];b!==void 0&&(p.emissionStrength=b);const T=u["model-opacity"];T!==void 0&&(p.opacity=T),e.materialOverrides.set(c,p)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,n){}serialize(){return this._options}setProperty(e,n){return!1}reload(){const e=Hc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const n=new Map;for(const c in e){const u=e[c];if(this._modelsInfo.has(c)){const p=this._modelsInfo.get(c);p&&p.modelSpec.uri===u.uri&&n.set(c,p)}}this._modelsInfo=n,this._options.models=e,this._loaded=!1,this.load()}}function VT(s,e,n,c){const u=1<<s.z;e.lat=ee((c/xt+s.y)/u),e.lng=ne((n/xt+s.x)/u)}function o4(s,e,n,c){const u=s.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let p=Number.MAX_VALUE;const m=u.node,y=n.tile,b=c.calculatePosMatrix(y.tileID.toUnwrapped(),c.worldSize),T=u.evaluatedScale;let A=0;c.elevation&&m.elevation&&(A=m.elevation*c.elevation.exaggeration()),de(b,b,[(m.anchor?m.anchor[0]:0)*(T[0]-1),(m.anchor?m.anchor[1]:0)*(T[1]-1),A]),Oe(b,b,T);const C=n.queryGeometry,P=C.isPointQuery()?C.screenBounds:C.screenGeometry,D=function(N){const V=re([],b,N.globalMatrix);re(V,c.expandedFarZProjMatrix,V);for(let G=0;G<N.meshes.length;++G){const X=N.meshes[G];if(G===N.lightMeshIndex)continue;const Y=uT(P,c,V,X.aabb);Y!=null&&(p=Math.min(Y,p))}if(N.children)for(const G of N.children)D(G)};if(D(m),p===Number.MAX_VALUE)return;const L=new z(0,0);return VT(y.tileID.canonical,L,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:p,position:L,feature:u.feature}}const a4={circle:class extends qs{constructor(s,e,n,c){super(s,{layout:El||(El=new gn({"circle-sort-key":new Pt(Le.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ft(Le.layout_circle["circle-elevation-reference"]),visibility:new ft(Le.layout_circle.visibility)})),paint:eh||(eh=new gn({"circle-radius":new Pt(Le.paint_circle["circle-radius"]),"circle-color":new Pt(Le.paint_circle["circle-color"]),"circle-blur":new Pt(Le.paint_circle["circle-blur"]),"circle-opacity":new Pt(Le.paint_circle["circle-opacity"]),"circle-translate":new ft(Le.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(Le.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(Le.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(Le.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pt(Le.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pt(Le.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pt(Le.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ft(Le.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}createBucket(s){return new on(s)}queryRadius(s){const e=s;return cs("circle-radius",this,e)+cs("circle-stroke-width",this,e)+fn(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,n,c,u,p,m,y){const b=Qu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return sA(s,c,p,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,n){const c=nA(this);return{config:new Sl(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends qs{createBucket(s){return new aA(s)}constructor(s,e,n,c){super(s,{layout:lA||(lA=new gn({visibility:new ft(Le.layout_heatmap.visibility)})),paint:cA||(cA=new gn({"heatmap-radius":new Pt(Le.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pt(Le.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(Le.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vu(Le.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(Le.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(s){return cs("heatmap-radius",this,s)}queryIntersectsFeature(s,e,n,c,u,p,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,n);return sA(s,c,p,m,y,!0,!0,new nt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,n){return s==="heatmap"?{config:new Sl(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends qs{constructor(s,e,n,c){super(s,{layout:uA||(uA=new gn({visibility:new ft(Le.layout_hillshade.visibility)})),paint:hA||(hA=new gn({"hillshade-illumination-direction":new ft(Le.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(Le.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(Le.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(Le.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(Le.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(Le.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ft(Le.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,n){return{overrideFog:!1}}},fill:class extends qs{constructor(s,e,n,c){super(s,{layout:IA||(IA=new gn({"fill-sort-key":new Pt(Le.layout_fill["fill-sort-key"]),visibility:new ft(Le.layout_fill.visibility),"fill-elevation-reference":new ft(Le.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Pt(Le.layout_fill["fill-construct-bridge-guard-rail"])})),paint:AA||(AA=new gn({"fill-antialias":new ft(Le.paint_fill["fill-antialias"]),"fill-opacity":new Pt(Le.paint_fill["fill-opacity"]),"fill-color":new Pt(Le.paint_fill["fill-color"]),"fill-outline-color":new Pt(Le.paint_fill["fill-outline-color"]),"fill-translate":new ft(Le.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(Le.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pt(Le.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ft(Le.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ft(Le.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Pt(Le.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Pt(Le.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Pt(Le.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(s,e,n){return{config:new Sl(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Wb(s)}queryRadius(){return fn(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,n,c,u,p){return!s.queryGeometry.isAboveHorizon&&_n(Go(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),c)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?e&&!s:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends qs{constructor(s,e,n,c){super(s,{layout:JA||(JA=new gn({visibility:new ft(Le["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ft(Le["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:QA||(QA=new gn({"fill-extrusion-opacity":new ft(Le["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(Le["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(Le["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ft(Le["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ft(Le["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ft(Le["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ft(Le["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ft(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ft(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ft(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ft(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ft(Le["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ft(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ft(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ft(Le["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ft(Le["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ft(Le["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ft(Le["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Pt(Le["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ft(Le["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Fv(s)}queryRadius(){return fn(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,n,c,u,p,m,y,b){const T=Qu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),P=[0,0],D=y&&p.elevation,L=p.elevation?p.elevation.exaggeration():1,N=s.tile.getBucket(this);if(D&&N instanceof Fv){const ie=N.centroidVertexArray,_e=b+1;_e<ie.length&&(P[0]=ie.geta_centroid_pos0(_e),P[1]=ie.geta_centroid_pos1(_e))}if(P[0]===0&&P[1]===1)return!1;p.projection.name==="globe"&&(c=YA([c],[new nt(0,0),new nt(xt,xt)],s.tileID.canonical).map(ie=>ie.polygon).flat());const V=D?y:null,[G,X]=oC(p,c,C,A,T,m,V,P,L,p.center.lat,s.tileID.canonical),Y=s.queryGeometry;return sC(G,X,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},building:class extends qs{constructor(s,e,n,c){super(s,{layout:kC||(kC=new gn({visibility:new ft(Le.layout_building.visibility),"building-facade":new Pt(Le.layout_building["building-facade"]),"building-facade-floors":new Pt(Le.layout_building["building-facade-floors"]),"building-facade-unit-width":new Pt(Le.layout_building["building-facade-unit-width"]),"building-facade-window":new Pt(Le.layout_building["building-facade-window"]),"building-roof-shape":new Pt(Le.layout_building["building-roof-shape"]),"building-height":new Pt(Le.layout_building["building-height"]),"building-base":new Pt(Le.layout_building["building-base"]),"building-flood-light-wall-radius":new Pt(Le.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Pt(Le.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Pt(Le.layout_building["building-flip-roof-orientation"])})),paint:MC||(MC=new gn({"building-opacity":new ft(Le.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ft(Le.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ft(Le.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ft(Le.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ft(Le.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ft(Le.paint_building["building-vertical-scale"]),"building-cast-shadows":new ft(Le.paint_building["building-cast-shadows"]),"building-color":new Pt(Le.paint_building["building-color"]),"building-emissive-strength":new Pt(Le.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ft(Le.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ft(Le.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ft(Le.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ft(Le.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ft(Le.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new RC(s)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(s){return!0}queryRadius(s){return 0}queryIntersectsFeature(s,e,n,c,u,p,m,y,b){let T=this.layout.get("building-height").evaluate(e,n);const A=this.layout.get("building-base").evaluate(e,n),C=s.tile.getBucket(this).getFootprint(e);if(C){if(C.hiddenFlags!==0)return!1;T=C.height}const[P,D]=oC(p,c,A,T,new nt(0,0),m,null,[0,0],1,p.center.lat,s.tileID.canonical),L=s.queryGeometry;return sC(P,D,L.isPointQuery()?L.screenBounds:L.screenGeometry)}},line:class extends qs{constructor(s,e,n,c){const u=UC();super(s,u,e,n,c),u.layout&&(this.layout=new Gc(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Td,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if($_)return $_;const n=UC();return $_=new i5(n.paint.properties["line-width"].specification),$_.useIntegerZoom=!0,$_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new gT(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,n){const c=jC(this);return{config:new Sl(this,{zoom:e,lut:n}),defines:c,overrideFog:!1}}queryRadius(s){const e=s,n=$C(cs("line-width",this,e),cs("line-gap-width",this,e)),c=cs("line-offset",this,e);return n/2+Math.abs(c)+fn(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,n,c,u,p){if(s.queryGeometry.isAboveHorizon)return!1;const m=Go(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,s.pixelToTileUnitsFactor),y=s.pixelToTileUnitsFactor/2*$C(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(c=function(T,A){const C=[],P=new nt(0,0);for(let D=0;D<T.length;D++){const L=T[D],N=[];for(let V=0;V<L.length;V++){const G=L[V],X=L[V+1],Y=V===0?P:G.sub(L[V-1])._unit()._perp(),ie=V===L.length-1?P:X.sub(G)._unit()._perp(),_e=Y._add(ie)._unit();_e._mult(1/(_e.x*ie.x+_e.y*ie.y)),N.push(_e._mult(A)._add(G))}C.push(N)}return C}(c,b*s.pixelToTileUnitsFactor)),function(T,A,C){for(let P=0;P<A.length;P++){const D=A[P];if(T.length>=3){for(let L=0;L<D.length;L++)if(ls(T,D[L]))return!0}if(mo(T,D,C))return!0}return!1}(m,c,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:lx,background:class extends qs{constructor(s,e,n,c){super(s,{layout:MP||(MP=new gn({visibility:new ft(Le.layout_background.visibility)})),paint:OP||(OP=new gn({"background-pitch-alignment":new ft(Le.paint_background["background-pitch-alignment"]),"background-color":new ft(Le.paint_background["background-color"]),"background-pattern":new ft(Le.paint_background["background-pattern"]),"background-opacity":new ft(Le.paint_background["background-opacity"]),"background-emissive-strength":new ft(Le.paint_background["background-emissive-strength"]),"background-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,n){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:BP,"raster-particle":GP,sky:class extends qs{constructor(s,e,n,c){super(s,{layout:VP||(VP=new gn({visibility:new ft(Le.layout_sky.visibility)})),paint:UP||(UP=new gn({"sky-type":new ft(Le.paint_sky["sky-type"]),"sky-atmosphere-sun":new ft(Le.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ft(Le.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ft(Le.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ft(Le.paint_sky["sky-gradient-radius"]),"sky-gradient":new Vu(Le.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ft(Le.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ft(Le.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ft(Le.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=I_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),u=!c,p=s.style.light,m=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&or("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?FT(m.azimuthal,90-m.polar,e):FT(c[0],90-c[1],e)}const n=this.paint.get("sky-gradient-center");return FT(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends qs{constructor(s,e,n,c){super(s,{paint:$P||($P=new gn({}))},e,null)}},model:class extends qs{constructor(s,e,n,c){super(s,{layout:ZP||(ZP=new gn({visibility:new ft(Le.layout_model.visibility),"model-id":new Pt(Le.layout_model["model-id"])})),paint:XP||(XP=new gn({"model-opacity":new Pt(Le.paint_model["model-opacity"]),"model-rotation":new Pt(Le.paint_model["model-rotation"]),"model-scale":new Pt(Le.paint_model["model-scale"]),"model-translation":new Pt(Le.paint_model["model-translation"]),"model-color":new Pt(Le.paint_model["model-color"]),"model-color-mix-intensity":new Pt(Le.paint_model["model-color-mix-intensity"]),"model-type":new ft(Le.paint_model["model-type"]),"model-cast-shadows":new ft(Le.paint_model["model-cast-shadows"]),"model-receive-shadows":new ft(Le.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ft(Le.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Pt(Le.paint_model["model-emissive-strength"]),"model-roughness":new Pt(Le.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Pt(Le.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ft(Le.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ft(Le.paint_model["model-front-cutoff"]),"model-elevation-reference":new ft(Le.paint_model["model-elevation-reference"]),"model-color-use-theme":new Pt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,c),this.layer=s,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new NT(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof dx?xt-1:0}queryRenderedFeatures(s,e,n){const c=e.getSource();if(!(c&&c instanceof Xd))return{};const u=c,p={};p[this.id]=[];const m=p[this.id];let y=0;for(const b of u.models){const T=e.getFeatureState(this.sourceLayer,b.id),A={type:"Unknown",id:b.id,properties:b.featureProperties},C=this.paint.get("model-rotation").evaluate(A,T),P=this.paint.get("model-scale").evaluate(A,T),D=this.paint.get("model-translation").evaluate(A,T),L=this.paint.get("model-elevation-reference");let N=[];qv(N,b,n,b.position,C,P,D,L==="ground",L==="ground",!1),n.projection.name==="globe"&&(N=Hv(N,n));const V=re([],n.projMatrix,N),G=uT(s.isPointQuery()?s.screenBounds:s.screenGeometry,n,V,b.aabb);if(G!=null){const X=new Zd(void 0,0,0,0,b.id);X.layer=this.layer,X.properties=structuredClone(b.featureProperties),X.properties.layer=this.id,X.properties.uri=b.uri,X.properties.orientation=b.orientation,X.sourceLayer=this.sourceLayer,X.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},X.state=T,X.source=this.source,m.push({featureIndex:y,feature:X,intersectionZ:G})}++y}return p}queryIntersectsFeature(s,e,n,c,u,p){if(!this.modelManager)return!1;const m=this.modelManager,y=s.tile.getBucket(this);if(!(y&&y instanceof NT))return!1;for(const b in y.instancesPerModel){const T=y.instancesPerModel[b],A=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(A)){const C=T.features[T.idToFeaturesIndex[A]],P=m.getModel(b,this.scope);if(!P)return!1;let D=[];const L=new z(0,0),N=y.canonical;let V=Number.MAX_VALUE;for(let G=0;G<C.instancedDataCount;++G){const X=16*(C.instancedDataOffset+G),Y=T.instancedDataArray.float32,ie=[Y[X+4],Y[X+5],Y[X+6]];VT(N,L,Math.floor(Y[X]),Math.floor(Y[X+1])),qv(D,P,p,L,C.rotation,C.scale,ie,!1,!1,!1),p.projection.name==="globe"&&(D=Hv(D,p));const _e=re([],p.projMatrix,D),ue=s.queryGeometry,be=uT(ue.isPointQuery()?ue.screenBounds:ue.screenGeometry,p,_e,P.aabb);be!=null&&(V=Math.min(be,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(s,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ic}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends qs{constructor(s,e,n,c){super(s,{layout:CA||(CA=new gn({"clip-layer-types":new ft(Le.layout_clip["clip-layer-types"]),"clip-layer-scope":new ft(Le.layout_clip["clip-layer-scope"])})),paint:PA||(PA=new gn({}))},e,n,c)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new RA(s)}is3D(s){return!0}}},UT=new yi(0,0,0),$T={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},GT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},fx={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},l4={PAINT_ORDER_FILL_AND_STROKE:1},sy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},eR={MASK_TYPE_LUMINANCE:1};function c4(s,e,n){s===1&&e.icons.push(function(c,u){return function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:y}=m;y.left==null&&(y.left=0),y.top==null&&(y.top=y.left),y.width==null&&(y.width=p.usvg_tree.width),y.height==null&&(y.height=y.width)}if(m.text_placeholder){const{text_placeholder:y}=m;y.top==null&&(y.top=y.left),y.height==null&&(y.height=y.width)}return m.stretch_x&&m.stretch_x.length&&tR(m,"x"),m.stretch_y&&m.stretch_y.length&&tR(m,"y"),p}(c.readFields(u4,{name:void 0},u))}(n,n.readVarint()+n.pos))}function tR(s,e){const n=[],c=s[`stretch_${e}`];let u=null;for(let p=0;p<c.length;p++)u===null?u=n.length===0?c[0]:n[n.length-1][1]+c[p]:(n.push([u,u+c[p]]),u=null);s[`stretch_${e}_areas`]=n}function u4(s,e,n){s===1?e.name=n.readString():s===2?e.metadata=function(c,u){return c.readFields(h4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(n,n.readVarint()+n.pos):s===3&&(e.usvg_tree=function(c,u){return c.readFields(p4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function h4(s,e,n){s===1?e.stretch_x=n.readPackedVarint():s===2?e.stretch_y=n.readPackedVarint():s===3?e.content_area=rR(n,n.readVarint()+n.pos):s===4?e.variables.push(function(c,u){return c.readFields(f4,{name:void 0},u)}(n,n.readVarint()+n.pos)):s===5&&(e.text_placeholder=rR(n,n.readVarint()+n.pos))}function rR(s,e){return s.readFields(d4,{},e)}function d4(s,e,n){s===1?e.left=n.readVarint():s===2?e.width=n.readVarint():s===3?e.top=n.readVarint():s===4&&(e.height=n.readVarint())}function f4(s,e,n){s===1?e.name=n.readString():s===2&&(e.rgb_color=gx(n.readVarint()),e.value="rgb_color")}function p4(s,e,n){s===1?e.width=e.height=n.readVarint():s===2?e.height=n.readVarint():s===3?e.children.push(px(n,n.readVarint()+n.pos)):s===4?e.linear_gradients.push(function(c,u){return c.readFields(w4,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(n,n.readVarint()+n.pos)):s===5?e.radial_gradients.push(function(c,u){return c.readFields(T4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(n,n.readVarint()+n.pos)):s===7?e.clip_paths.push(function(c,u){return c.readFields(S4,{children:[]},u)}(n,n.readVarint()+n.pos)):s===8&&e.masks.push(function(c,u){const p=c.readFields(E4,{left:0,width:20,mask_type:eR.MASK_TYPE_LUMINANCE,children:[]},u);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p}(n,n.readVarint()+n.pos))}function px(s,e){return s.readFields(m4,{},e)}function m4(s,e,n){s===1?(e.group=function(c,u){return c.readFields(g4,{opacity:255,children:[]},u)}(n,n.readVarint()+n.pos),e.node="group"):s===2&&(e.path=function(c,u){return c.readFields(y4,{paint_order:1,commands:[],step:1,diffs:[],rule:$T.PATH_RULE_NON_ZERO},u)}(n,n.readVarint()+n.pos),e.node="path")}function g4(s,e,n){s===1?e.transform=mx(n,n.readVarint()+n.pos):s===2?e.opacity=n.readVarint():s===5?e.clip_path_idx=n.readVarint():s===6?e.mask_idx=n.readVarint():s===7&&e.children.push(px(n,n.readVarint()+n.pos))}function mx(s,e){return s.readFields(_4,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function _4(s,e,n){s===1?e.sx=n.readFloat():s===2?e.ky=n.readFloat():s===3?e.kx=n.readFloat():s===4?e.sy=n.readFloat():s===5?e.tx=n.readFloat():s===6&&(e.ty=n.readFloat())}function y4(s,e,n){s===1?e.fill=function(c,u){return c.readFields(v4,{rgb_color:UT,paint:"rgb_color",opacity:255},u)}(n,n.readVarint()+n.pos):s===2?e.stroke=function(c,u){return c.readFields(x4,{rgb_color:UT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(n,n.readVarint()+n.pos):s===3?e.paint_order=n.readVarint():s===5?n.readPackedVarint(e.commands):s===6?e.step=n.readFloat():s===7?n.readPackedSVarint(e.diffs):s===8&&(e.rule=n.readVarint())}function v4(s,e,n){s===1?(e.rgb_color=gx(n.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=n.readVarint())}function gx(s){return new yi((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function x4(s,e,n){s===1?(e.rgb_color=gx(n.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):s===5?n.readPackedFloat(e.dasharray):s===6?e.dashoffset=n.readFloat():s===7?e.miterlimit=n.readFloat():s===8?e.opacity=n.readVarint():s===9?e.width=n.readFloat():s===10?e.linecap=n.readVarint():s===11&&(e.linejoin=n.readVarint())}function w4(s,e,n){s===1?e.transform=mx(n,n.readVarint()+n.pos):s===2?e.spread_method=n.readVarint():s===3?e.stops.push(iR(n,n.readVarint()+n.pos)):s===4?e.x1=n.readFloat():s===5?e.y1=n.readFloat():s===6?e.x2=n.readFloat():s===7&&(e.y2=n.readFloat())}function iR(s,e){return s.readFields(b4,{offset:0,opacity:255,rgb_color:UT},e)}function b4(s,e,n){s===1?e.offset=n.readFloat():s===2?e.opacity=n.readVarint():s===3&&(e.rgb_color=gx(n.readVarint()))}function T4(s,e,n){s===1?e.transform=mx(n,n.readVarint()+n.pos):s===2?e.spread_method=n.readVarint():s===3?e.stops.push(iR(n,n.readVarint()+n.pos)):s===4?e.cx=n.readFloat():s===5?e.cy=n.readFloat():s===6?e.r=n.readFloat():s===7?e.fx=n.readFloat():s===8?e.fy=n.readFloat():s===9&&(e.fr=n.readFloat())}function S4(s,e,n){s===1?e.transform=mx(n,n.readVarint()+n.pos):s===2?e.clip_path_idx=n.readVarint():s===3&&e.children.push(px(n,n.readVarint()+n.pos))}function E4(s,e,n){s===1?e.left=e.top=n.readFloat():s===2?e.width=e.height=n.readFloat():s===3?e.top=n.readFloat():s===4?e.height=n.readFloat():s===5?e.mask_type=n.readVarint():s===6?e.mask_idx=n.readVarint():s===7&&e.children.push(px(n,n.readVarint()+n.pos))}class I4{static calculate(e={},n=[]){const c=new Map,u=new Map;if(Object.keys(e).length===0)return c;n.forEach(p=>{u.set(p.name,p.rgb_color||new yi(0,0,0))});for(const[p,m]of Object.entries(e))u.has(p)?c.set(u.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return c}}function Wp(s,e=255,n){const c=e/255,u=s.toString(),p=n.has(u)?n.get(u).clone():s.clone();return p.a*=c,p.toString()}function oy(s,e){if(!xo()){const n=document.createElement("canvas");return n.width=s,n.height=e,n}return new OffscreenCanvas(s,e)}function A4(s,e){const n=I4.calculate(e.params,s.metadata?s.metadata.variables:[]),c=s.usvg_tree,u=c.width,p=c.height,m=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(u*m.a)),b=Math.max(1,Math.round(p*m.d)),T=new DOMMatrix([y/u,0,0,b/p,0,0]),A=oy(y,b).getContext("2d");return HT(A,T,c,c,n),A.getImageData(0,0,y,b)}function HT(s,e,n,c,u){for(const p of c.children)nR(s,e,n,p,u)}function nR(s,e,n,c,u){c.group?(s.save(),function(p,m,y,b,T){const A=b.mask_idx!=null?y.masks[b.mask_idx]:null,C=b.clip_path_idx!=null?y.clip_paths[b.clip_path_idx]:null;if(b.transform&&(m=Zp(b.transform).preMultiplySelf(m)),!function(L,N,V){return L.opacity!==255||N||V}(b,C!=null,A!=null))return void HT(p,m,y,b,T);const P=oy(p.canvas.width,p.canvas.height),D=P.getContext("2d");HT(D,m,y,b,T),C&&hR(D,m,y,C),A&&dR(D,m,y,A,T),p.globalAlpha=b.opacity/255,p.drawImage(P,0,0)}(s,e,n,c.group,u),s.restore()):c.path&&(s.save(),function(p,m,y,b,T){p.setTransform(m),b.paint_order===l4.PAINT_ORDER_FILL_AND_STROKE?(sR(p,y,b,T),aR(p,y,b,T)):(aR(p,y,b,T),sR(p,y,b,T))}(s,e,n,c.path,u),s.restore())}function sR(s,e,n,c){const u=n.fill;if(!u)return;const p=u.opacity/255;switch(s.save(),s.beginPath(),fR(n,s),u.paint){case"rgb_color":s.fillStyle=Wp(u.rgb_color,u.opacity,c);break;case"linear_gradient_idx":{const m=e.linear_gradients[u.linear_gradient_idx];m.transform&&s.setTransform(Zp(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=lR(s,m,p,c);break}case"radial_gradient_idx":{const m=e.radial_gradients[u.radial_gradient_idx];m.transform&&s.setTransform(Zp(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=cR(s,m,p,c)}}s.fill(oR(n)),s.restore()}function oR(s){return s.rule===$T.PATH_RULE_NON_ZERO?"nonzero":s.rule===$T.PATH_RULE_EVEN_ODD?"evenodd":void 0}function aR(s,e,n,c){const u=n.stroke;if(!u)return;const p=pR(n);s.lineWidth=u.width,s.miterLimit=u.miterlimit,s.setLineDash(u.dasharray),s.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":s.strokeStyle=Wp(u.rgb_color,u.opacity,c);break;case"linear_gradient_idx":s.strokeStyle=lR(s,e.linear_gradients[u.linear_gradient_idx],m,c,!0);break;case"radial_gradient_idx":s.strokeStyle=cR(s,e.radial_gradients[u.radial_gradient_idx],m,c,!0)}switch(u.linejoin){case fx.LINE_JOIN_MITER_CLIP:case fx.LINE_JOIN_MITER:s.lineJoin="miter";break;case fx.LINE_JOIN_ROUND:s.lineJoin="round";break;case fx.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(u.linecap){case GT.LINE_CAP_BUTT:s.lineCap="butt";break;case GT.LINE_CAP_ROUND:s.lineCap="round";break;case GT.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(p)}function lR(s,e,n,c,u=!1){if(e.stops.length===1){const P=e.stops[0];return Wp(P.rgb_color,P.opacity*n,c)}const{x1:p,y1:m,x2:y,y2:b}=e;let T=new DOMPoint(p,m),A=new DOMPoint(y,b);if(u){const P=Zp(e.transform);T=P.transformPoint(T),A=P.transformPoint(A)}const C=s.createLinearGradient(T.x,T.y,A.x,A.y);for(const P of e.stops)C.addColorStop(P.offset,Wp(P.rgb_color,P.opacity*n,c));return C}function cR(s,e,n,c,u=!1){if(e.stops.length===1){const G=e.stops[0];return Wp(G.rgb_color,G.opacity*n,c)}const p=Zp(e.transform),{fx:m,fy:y,fr:b,cx:T,cy:A,r:C}=e;let P=new DOMPoint(m,y),D=new DOMPoint(T,A),L=b,N=C;if(u){P=p.transformPoint(P),D=p.transformPoint(D);const G=(p.a+p.d)/2;L=b*G,N=e.r*G}const V=s.createRadialGradient(P.x,P.y,L,D.x,D.y,N);for(const G of e.stops)V.addColorStop(G.offset,Wp(G.rgb_color,G.opacity*n,c));return V}function uR(s,e,n,c){const u=c.transform?Zp(c.transform).preMultiplySelf(e):e,p=oy(s.canvas.width,s.canvas.height),m=p.getContext("2d");for(const b of c.children)if(b.group)uR(m,u,n,b.group);else if(b.path){const T=b.path,A=new Path2D;A.addPath(pR(T),u),m.fill(A,oR(T))}const y=c.clip_path_idx!=null?n.clip_paths[c.clip_path_idx]:null;y&&hR(m,u,n,y),s.globalCompositeOperation="source-over",s.drawImage(p,0,0)}function hR(s,e,n,c){const u=oy(s.canvas.width,s.canvas.height);uR(u.getContext("2d"),e,n,c),s.globalCompositeOperation="destination-in",s.drawImage(u,0,0)}function dR(s,e,n,c,u){if(c.children.length===0)return;const p=c.mask_idx!=null?n.masks[c.mask_idx]:null;p&&dR(s,e,n,p,u);const m=s.canvas.width,y=s.canvas.height,b=oy(m,y),T=b.getContext("2d"),A=c.width,C=c.height,P=c.left,D=c.top,L=new Path2D,N=new Path2D;N.rect(P,D,A,C),L.addPath(N,e),T.clip(L);for(const X of c.children)nR(T,e,n,X,u);const V=T.getImageData(0,0,m,y),G=V.data;if(c.mask_type===eR.MASK_TYPE_LUMINANCE)for(let X=0;X<G.length;X+=4)G[X+3]=G[X+3]/255*(.2126*G[X]+.7152*G[X+1]+.0722*G[X+2]);T.putImageData(V,0,0),s.globalCompositeOperation="destination-in",s.drawImage(b,0,0)}function Zp(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function fR(s,e){const n=s.step;let c=s.diffs[0]*n,u=s.diffs[1]*n;e.moveTo(c,u);for(let p=0,m=2;p<s.commands.length;p++)switch(s.commands[p]){case sy.PATH_COMMAND_MOVE:c+=s.diffs[m++]*n,u+=s.diffs[m++]*n,e.moveTo(c,u);break;case sy.PATH_COMMAND_LINE:c+=s.diffs[m++]*n,u+=s.diffs[m++]*n,e.lineTo(c,u);break;case sy.PATH_COMMAND_QUAD:{const y=c+s.diffs[m++]*n,b=u+s.diffs[m++]*n;c=y+s.diffs[m++]*n,u=b+s.diffs[m++]*n,e.quadraticCurveTo(y,b,c,u);break}case sy.PATH_COMMAND_CUBIC:{const y=c+s.diffs[m++]*n,b=u+s.diffs[m++]*n,T=y+s.diffs[m++]*n,A=b+s.diffs[m++]*n;c=T+s.diffs[m++]*n,u=A+s.diffs[m++]*n,e.bezierCurveTo(y,b,T,A,c,u);break}case sy.PATH_COMMAND_CLOSE:e.closePath()}return e}function pR(s){return fR(s,new Path2D)}class _x{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}zt(_x,"LRUCache");class qT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Ds(e,e.data)}getFromCache(e,n,c){return this.cacheMap.has(c)||this.cacheMap.set(c,new _x(150)),this.cacheMap.get(c).get(Hc(e.toString(),n))}setInCache(e,n,c,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new _x(150));const p=this.cacheDependenciesMap.get(u),m=Hc(e.id.toString(),c);p.get(m)||p.set(m,new Set);const y=this.cacheMap.get(u),b=e.toString();p.get(m).add(b),y.put(Hc(e.toString(),c),n)}removeImagesFromCacheByIds(e,n,c=0){if(!this.cacheMap.has(c)||!this.cacheDependenciesMap.has(c))return;const u=this.cacheMap.get(c),p=this.cacheDependenciesMap.get(c);for(const m of e){const y=Hc(m.toString(),n);if(p.has(y)){for(const b of p.get(y))u.delete(b);p.delete(y)}}}rasterize(e,n,c,u,p=A4){const m=this.getFromCache(e,c,u);if(m)return m.clone();const y=p(n.icon,e.options),b=qT._getImage(y);return this.setInCache(e,b,c,u),b.clone()}}class mR{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const c=this.toIdx(e,n);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function gR(s,e,n,c){let u=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(c[m])<1e-15){if(n[m]<s[m]||n[m]>e[m])return null}else{const y=1/c[m];let b=(s[m]-n[m])*y,T=(e[m]-n[m])*y;if(b>T){const A=b;b=T,T=A}if(b>u&&(u=b),T<p&&(p=T),u>p)return null}return u}function _R(s,e,n,c,u,p,m,y,b,T,A){const C=c-s,P=u-e,D=p-n,L=m-s,N=y-e,V=b-n,G=A[1]*V-A[2]*N,X=A[2]*L-A[0]*V,Y=A[0]*N-A[1]*L,ie=C*G+P*X+D*Y;if(Math.abs(ie)<1e-15)return null;const _e=1/ie,ue=T[0]-s,be=T[1]-e,Ee=T[2]-n,Ae=(ue*G+be*X+Ee*Y)*_e;if(Ae<0||Ae>1)return null;const Ze=be*D-Ee*P,ze=Ee*C-ue*D,Ke=ue*P-be*C,tt=(A[0]*Ze+A[1]*ze+A[2]*Ke)*_e;return tt<0||Ae+tt>1?null:(L*Ze+N*ze+V*Ke)*_e}function yR(s,e,n){return(s-e)/(n-e)}function vR(s,e,n,c,u,p,m,y,b){const T=1<<n,A=p-c,C=m-u,P=(s+1)/T*A+c,D=(e+0)/T*C+u,L=(e+1)/T*C+u;y[0]=(s+0)/T*A+c,y[1]=D,b[0]=P,b[1]=L}class xR{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(p){const m=Math.ceil(Math.log2(p.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const T=1/b,A=(D,L,N,V,G)=>{const X=V?1:0,Y=(D+1)*N-X,ie=L*N,_e=(L+1)*N-X;G[0]=D*N,G[1]=ie,G[2]=Y,G[3]=_e};let C=new mR(b);const P=[];for(let D=0;D<b*b;D++){A(D%b,Math.floor(D/b),T,!1,P);const L=ah(P[0],P[1],p),N=ah(P[2],P[1],p),V=ah(P[2],P[3],p),G=ah(P[0],P[3],p);C.minimums.push(Math.min(L,N,V,G)),C.maximums.push(Math.max(L,N,V,G)),C.leaves.push(1)}for(y.push(C),b/=2;b>=1;b/=2){const D=y[y.length-1];C=new mR(b);for(let L=0;L<b*b;L++){A(L%b,Math.floor(L/b),2,!0,P);const N=D.getElevation(P[0],P[1]),V=D.getElevation(P[2],P[1]),G=D.getElevation(P[2],P[3]),X=D.getElevation(P[0],P[3]),Y=D.isLeaf(P[0],P[1]),ie=D.isLeaf(P[2],P[1]),_e=D.isLeaf(P[2],P[3]),ue=D.isLeaf(P[0],P[3]),be=Math.min(N.min,V.min,G.min,X.min),Ee=Math.max(N.max,V.max,G.max,X.max),Ae=Y&&ie&&_e&&ue;C.maximums.push(Ee),C.minimums.push(be),C.leaves.push(Ee-be<=5&&Ae?1:0)}y.push(C)}return y}(this.dem),c=n.length-1,u=n[c];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,c,0)}raycastRoot(e,n,c,u,p,m,y=1){return gR([e,n,-100],[c,u,this.maximums[0]*y],p,m)}raycast(e,n,c,u,p,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,c,u,p,m,y);if(b==null)return null;const T=[],A=[],C=[],P=[],D=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;D.length>0;){const{idx:L,t:N,nodex:V,nodey:G,depth:X}=D.pop();if(this.leaves[L]){vR(V,G,X,e,n,c,u,C,P);const ie=1<<X,_e=(V+0)/ie,ue=(V+1)/ie,be=(G+0)/ie,Ee=(G+1)/ie,Ae=ah(_e,be,this.dem)*y,Ze=ah(ue,be,this.dem)*y,ze=ah(ue,Ee,this.dem)*y,Ke=ah(_e,Ee,this.dem)*y,tt=_R(C[0],C[1],Ae,P[0],C[1],Ze,P[0],P[1],ze,p,m),st=_R(P[0],P[1],ze,C[0],P[1],Ke,C[0],C[1],Ae,p,m),yt=Math.min(tt!==null?tt:Number.MAX_VALUE,st!==null?st:Number.MAX_VALUE);if(yt!==Number.MAX_VALUE)return yt;{const ht=ti([],p,m,N);if(wR(Ae,Ze,Ke,ze,yR(ht[0],C[0],P[0]),yR(ht[1],C[1],P[1]))>=ht[2])return N}continue}let Y=0;for(let ie=0;ie<this._siblingOffset.length;ie++){vR((V<<1)+this._siblingOffset[ie][0],(G<<1)+this._siblingOffset[ie][1],X+1,e,n,c,u,C,P),C[2]=-100,P[2]=this.maximums[this.childOffsets[L]+ie]*y;const _e=gR(C,P,p,m);if(_e!=null){const ue=_e;T[ie]=ue;let be=!1;for(let Ee=0;Ee<Y&&!be;Ee++)ue>=T[A[Ee]]&&(A.splice(Ee,0,ie),be=!0);be||(A[Y]=ie),Y++}}for(let ie=0;ie<Y;ie++){const _e=A[ie];D.push({idx:this.childOffsets[L]+_e,t:T[_e],nodex:(V<<1)+this._siblingOffset[_e][0],nodey:(G<<1)+this._siblingOffset[_e][1],depth:X+1})}}return null}_addNode(e,n,c){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,c,u,p){if(e[u].isLeaf(n,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=u-1,y=e[m];let b=0,T=0;for(let A=0;A<this._siblingOffset.length;A++){const C=2*n+this._siblingOffset[A][0],P=2*c+this._siblingOffset[A][1],D=y.getElevation(C,P),L=y.isLeaf(C,P),N=this._addNode(D.min,D.max,L);L&&(b|=1<<A),T||(T=N)}for(let A=0;A<this._siblingOffset.length;A++)b&1<<A||this._construct(e,2*n+this._siblingOffset[A][0],2*c+this._siblingOffset[A][1],m,T+A)}}function wR(s,e,n,c,u,p){return pr(pr(s,n,p),pr(e,c,p),u)}function ah(s,e,n){const c=n.dim,u=W(s*c-.5,0,c-1),p=W(e*c-.5,0,c-1),m=Math.floor(u),y=Math.floor(p),b=Math.min(m+1,c-1),T=Math.min(y+1,c-1);return wR(n.get(m,y),n.get(b,y),n.get(m,T),n.get(b,T),u-m,p-y)}const C4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function P4(s,e,n){return(256*s*256+256*e+n)/10-1e4}function R4(s,e,n){return 256*s+e+n/256-32768}class yx{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,c,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return void or(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2,m=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<p;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(p,b)]=m[this._idx(p-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,p)]=m[this._idx(b,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const y=c==="terrarium"?R4:P4;for(let b=0;b<m.length;++b){const T=4*b;this.floatView[b]=y(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=wo.now()}_buildQuadTree(){this._tree=new xR(this)}get(e,n,c=!1){c&&(e=W(e,-1,this.dim),n=W(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,c){const u=this._idx(e,n),p=this.floatView[u];return this.floatView[u]=c,c-p}static getUnpackVector(e){return C4[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const c=[0,0,0,0],u=yx.getUnpackVector(n);let p=Math.floor((e+u[3])/u[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new pA({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,c){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,p=n*this.dim+this.dim,m=c*this.dim,y=c*this.dim+this.dim;switch(n){case-1:u=p-1;break;case 1:p=u+1}switch(c){case-1:m=y-1;break;case 1:y=m+1}const b=-n*this.dim,T=-c*this.dim;for(let A=m;A<y;A++)for(let C=u;C<p;C++){const P=4*this._idx(C,A),D=4*this._idx(C+b,A+T);this.pixels[P+0]=e.pixels[D+0],this.pixels[P+1]=e.pixels[D+1],this.pixels[P+2]=e.pixels[D+2],this.pixels[P+3]=e.pixels[D+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function k4(s,e,n){s===1?e.headerLength=n.readFixed32():s===2?e.x=n.readVarint():s===3?e.y=n.readVarint():s===4?e.z=n.readVarint():s===5&&e.layers.push(function(c,u){return c.readFields(z4,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(n,n.readVarint()+n.pos))}function M4(s,e,n){s===1?(e.delta_filter=function(c,u){return c.readFields(O4,{blockSize:0},u)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):s===2?(n.readVarint(),e.filter="zigzag_filter"):s===3?(n.readVarint(),e.filter="bitshuffle_filter"):s===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function O4(s,e,n){s===1&&(e.blockSize=n.readVarint())}function D4(s,e,n){s===1?(n.readVarint(),e.codec="gzip_data"):s===2?(n.readVarint(),e.codec="jpeg_image"):s===3?(n.readVarint(),e.codec="webp_image"):s===4&&(n.readVarint(),e.codec="png_image")}function L4(s,e,n){let c=0,u=0;s===1?e.firstByte=n.readFixed64():s===2?e.lastByte=n.readFixed64():s===3?e.filters.push(function(p,m){return p.readFields(M4,{},m)}(n,n.readVarint()+n.pos)):s===4?e.codec=function(p,m){return p.readFields(D4,{},m)}(n,n.readVarint()+n.pos):s===5?u=n.readFloat():s===6?c=n.readFloat():s===7?e.bands.push(n.readString()):s===8?e.offset=n.readDouble():s===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=c)}function z4(s,e,n){s===1?e.version=n.readVarint():s===2?e.name=n.readString():s===3?e.units=n.readString():s===4?e.tileSize=n.readVarint():s===5?e.buffer=n.readVarint():s===6?e.pixelFormat=n.readVarint():s===7&&e.dataIndex.push(function(c,u){return c.readFields(L4,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(n,n.readVarint()+n.pos))}function F4(s,e,n){if(s===2)(function(c,u,p){c.readFields(B4,p,u)})(n,n.readVarint()+n.pos,e);else if(s===3)throw new Error("Not implemented")}function B4(s,e,n){if(s===1){let c=0;const u=n.readVarint()+n.pos;for(;n.pos<u;)e[c++]=n.readVarint()}}function N4(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let c=2;c>=1;c--){const u=c===1?1:0,p=c===2?1:0;for(let m=0;m<e[0];m++){const y=e[1]*m;for(let b=u;b<e[1];b++){const T=e[2]*(b+y);for(let A=p;A<e[2];A++){const C=e[3]*(A+T);for(let P=0;P<e[3];P++){const D=C+P;s[D]+=s[D-n]}}}}n*=e[c]}return s}function j4(s){for(let e=0,n=s.length;e<n;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function V4(s,e){switch(e){case"uint32":return s;case"uint16":for(let n=0;n<s.length;n+=2){const c=s[n],u=s[n+1];s[n]=(240&c)>>4|(61440&c)>>8|(240&u)<<4|61440&u,s[n+1]=15&c|(3840&c)>>4|(15&u)<<8|(3840&u)<<4}return s;case"uint8":for(let n=0;n<s.length;n+=4){const c=s[n],u=s[n+1],p=s[n+2],m=s[n+3];s[n+0]=(192&c)>>6|(192&u)>>4|(192&p)>>2|192&m,s[n+1]=(48&c)>>4|(48&u)>>2|48&p|(48&m)<<2,s[n+2]=(12&c)>>2|12&u|(12&p)<<2|(12&m)<<4,s[n+3]=3&c|(3&u)<<2|(3&p)<<4|(3&m)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}zt(yx,"DEMData"),zt(xR,"DemMinMaxQuadTree",{omit:["dem"]});var La=Uint8Array,ay=Uint16Array,U4=Int32Array,bR=new La([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),TR=new La([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$4=new La([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),SR=function(s,e){for(var n=new ay(31),c=0;c<31;++c)n[c]=e+=1<<s[c-1];var u=new U4(n[30]);for(c=1;c<30;++c)for(var p=n[c];p<n[c+1];++p)u[p]=p-n[c]<<5|c;return{b:n,r:u}},ER=SR(bR,2),IR=ER.b,G4=ER.r;IR[28]=258,G4[258]=28;for(var H4=SR(TR,0).b,AR=new ay(32768),Zn=0;Zn<32768;++Zn){var Xp=(43690&Zn)>>1|(21845&Zn)<<1;AR[Zn]=((65280&(Xp=(61680&(Xp=(52428&Xp)>>2|(13107&Xp)<<2))>>4|(3855&Xp)<<4))>>8|(255&Xp)<<8)>>1}var ly=function(s,e,n){for(var c=s.length,u=0,p=new ay(e);u<c;++u)s[u]&&++p[s[u]-1];var m,y=new ay(e);for(u=1;u<e;++u)y[u]=y[u-1]+p[u-1]<<1;m=new ay(1<<e);var b=15-e;for(u=0;u<c;++u)if(s[u])for(var T=u<<4|s[u],A=e-s[u],C=y[s[u]-1]++<<A,P=C|(1<<A)-1;C<=P;++C)m[AR[C]>>b]=T;return m},cy=new La(288);for(Zn=0;Zn<144;++Zn)cy[Zn]=8;for(Zn=144;Zn<256;++Zn)cy[Zn]=9;for(Zn=256;Zn<280;++Zn)cy[Zn]=7;for(Zn=280;Zn<288;++Zn)cy[Zn]=8;var CR=new La(32);for(Zn=0;Zn<32;++Zn)CR[Zn]=5;var q4=ly(cy,9),W4=ly(CR,5),WT=function(s){for(var e=s[0],n=1;n<s.length;++n)s[n]>e&&(e=s[n]);return e},Pl=function(s,e,n){var c=e/8|0;return(s[c]|s[c+1]<<8)>>(7&e)&n},ZT=function(s,e){var n=e/8|0;return(s[n]|s[n+1]<<8|s[n+2]<<16)>>(7&e)},Z4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rl=function(s,e,n){var c=new Error(e||Z4[s]);if(c.code=s,Error.captureStackTrace&&Error.captureStackTrace(c,Rl),!n)throw c;return c},X4=new La(0),K4=typeof TextDecoder<"u"&&new TextDecoder;try{K4.decode(X4,{stream:!0})}catch{}const Y4={gzip_data:"gzip"};class nl extends Error{constructor(e){super(e),this.name="MRTError"}}const J4={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},PR={uint32:1,uint16:2,uint8:4},Q4={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let XT;class vx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new nl(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),c=new DataView(e);if(n[0]!==13)throw new nl("File is not a valid MRT.");return c.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),c=this.getHeaderLength(e);if(n.length<c)throw new nl(`Expected header with length >= ${c} but got buffer of length ${n.length}`);const u=new XT(n.subarray(0,c)).readFields(k4,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new nl(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new RR(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],c=this.getLayer(e.layerName);for(let u of e.blockIndices){const p=c.dataIndex[u],m=p.firstByte-e.firstByte,y=p.lastByte-e.firstByte;if(c._blocksInProgress.has(u))continue;const b={layerName:c.name,firstByte:m,lastByte:y,pixelFormat:c.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(c.bandShape),buffer:c.buffer,codec:p.codec.codec,filters:p.filters.map(T=>T.filter)};c._blocksInProgress.add(u),n.push(b)}return new kR(n,()=>{n.forEach(u=>c._blocksInProgress.delete(u.blockIndex))},(u,p)=>{if(n.forEach(m=>c._blocksInProgress.delete(m.blockIndex)),u)throw u;p.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class RR{constructor({version:e,name:n,units:c,tileSize:u,pixelFormat:p,buffer:m,dataIndex:y},b){if(this.version=e,this.version!==1)throw new nl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=c,this.tileSize=u,this.buffer=m,this.pixelFormat=J4[p],this.dataIndex=y,this.bandShape=[u+2*m,u+2*m,PR[this.pixelFormat]],this._decodedBlocks=new _x(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return PR[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[c,u]of this.dataIndex.entries()){for(const[p,m]of u.bands.entries())if(m===e)return{bandIndex:n+p,blockIndex:c,blockBandIndex:p};n+=u.bands.length}break;case"number":for(const[c,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:c,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new nl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let n=1/0,c=-1/0;const u=[],p=new Set;for(const m of e){const{blockIndex:y}=this.getBlockForBand(m);if(y<0)throw new nl(`Invalid band: ${JSON.stringify(m)}`);const b=this.dataIndex[y];u.includes(y)||u.push(y),p.add(y),n=Math.min(n,b.firstByte),c=Math.max(c,b.lastByte)}if(p.size>this.cacheSize)throw new nl(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:c,blockIndices:u}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:c}=this.getBlockForBand(e);if(n<0)throw new nl(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(n.toString());if(!u)throw new nl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[n],m=this.bandShape.reduce((T,A)=>T*A,1),y=c*m,b=u.subarray(y,y+m);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}vx.setPbf=function(s){XT=s};class kR{constructor(e,n,c){this.tasks=e,this._onCancel=n,this._onComplete=c,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}vx.performDecoding=function(s,e){const n=new Uint8Array(s);return Promise.all(e.tasks.map(c=>{const{layerName:u,firstByte:p,lastByte:m,pixelFormat:y,blockShape:b,blockIndex:T,filters:A,codec:C}=c,P=n.subarray(p,m+1),D=new Uint32Array(b[0]*b[1]*b[2]);let L;if(C!=="gzip_data")throw new nl(`Unhandled codec: ${C}`);return L=function(N,V){if(!globalThis.DecompressionStream&&V==="gzip_data")return Promise.resolve(((ie=function(be){be[0]==31&&be[1]==139&&be[2]==8||Rl(6,"invalid gzip data");var Ee=be[3],Ae=10;4&Ee&&(Ae+=2+(be[10]|be[11]<<8));for(var Ze=(Ee>>3&1)+(Ee>>4&1);Ze>0;Ze-=!be[Ae++]);return Ae+(2&Ee)}(Y=N))+8>Y.length&&Rl(6,"invalid gzip data"),function(be,Ee,Ae,Ze){var ze=be.length;if(!ze||Ee.f&&!Ee.l)return Ae||new La(0);var Ke=!Ae,tt=Ke||Ee.i!=2,st=Ee.i;Ke&&(Ae=new La(3*ze));var yt,ht,rt=function(pn){var Xi=Ae.length;if(pn>Xi){var Bi=new La(Math.max(2*Xi,pn));Bi.set(Ae),Ae=Bi}},ut=Ee.f||0,He=Ee.p||0,$e=Ee.b||0,at=Ee.l,mt=Ee.d,it=Ee.m,Lt=Ee.n,Vt=8*ze;do{if(!at){ut=Pl(be,He,1);var kt=Pl(be,He+1,3);if(He+=3,!kt){var St=be[(he=4+((He+7)/8|0))-4]|be[he-3]<<8,wr=he+St;if(wr>ze){st&&Rl(0);break}tt&&rt($e+St),Ae.set(be.subarray(he,wr),$e),Ee.b=$e+=St,Ee.p=He=8*wr,Ee.f=ut;continue}if(kt==1)at=q4,mt=W4,it=9,Lt=5;else if(kt==2){var At=Pl(be,He,31)+257,ir=Pl(be,He+10,15)+4,Er=At+Pl(be,He+5,31)+1;He+=14;for(var Fr=new La(Er),ii=new La(19),Ar=0;Ar<ir;++Ar)ii[$4[Ar]]=Pl(be,He+3*Ar,7);He+=3*ir;var li=WT(ii),ci=(1<<li)-1,an=ly(ii,li);for(Ar=0;Ar<Er;){var he,ae=an[Pl(be,He,ci)];if(He+=15&ae,(he=ae>>4)<16)Fr[Ar++]=he;else{var Ye=0,Tt=0;for(he==16?(Tt=3+Pl(be,He,3),He+=2,Ye=Fr[Ar-1]):he==17?(Tt=3+Pl(be,He,7),He+=3):he==18&&(Tt=11+Pl(be,He,127),He+=7);Tt--;)Fr[Ar++]=Ye}}var Je=Fr.subarray(0,At),Et=Fr.subarray(At);it=WT(Je),Lt=WT(Et),at=ly(Je,it),mt=ly(Et,Lt)}else Rl(1);if(He>Vt){st&&Rl(0);break}}tt&&rt($e+131072);for(var Kt=(1<<it)-1,Wt=(1<<Lt)-1,Cr=He;;Cr=He){var hr=(Ye=at[ZT(be,He)&Kt])>>4;if((He+=15&Ye)>Vt){st&&Rl(0);break}if(Ye||Rl(2),hr<256)Ae[$e++]=hr;else{if(hr==256){Cr=He,at=null;break}var Ht=hr-254;hr>264&&(Ht=Pl(be,He,(1<<(fr=bR[Ar=hr-257]))-1)+IR[Ar],He+=fr);var ai=mt[ZT(be,He)&Wt],ki=ai>>4;if(ai||Rl(3),He+=15&ai,Et=H4[ki],ki>3){var fr=TR[ki];Et+=ZT(be,He)&(1<<fr)-1,He+=fr}if(He>Vt){st&&Rl(0);break}tt&&rt($e+131072);var ei=$e+Ht;if($e<Et){var Mi=0-Et,vi=Math.min(Et,ei);for(Mi+$e<0&&Rl(3);$e<vi;++$e)Ae[$e]=(void 0)[Mi+$e]}for(;$e<ei;++$e)Ae[$e]=Ae[$e-Et]}}Ee.l=at,Ee.p=Cr,Ee.b=$e,Ee.f=ut,at&&(ut=1,Ee.m=it,Ee.d=mt,Ee.n=Lt)}while(!ut);return $e!=Ae.length&&Ke?(yt=Ae,((ht=$e)==null||ht>yt.length)&&(ht=yt.length),new La(yt.subarray(0,ht))):Ae.subarray(0,$e)}(Y.subarray(ie,-8),{i:2},new La(((G=Y)[(X=G.length)-4]|G[X-3]<<8|G[X-2]<<16|G[X-1]<<24)>>>0))));var G,X,Y,ie;const _e=Y4[V];if(!_e)throw new Error(`Unhandled codec: ${V}`);const ue=new globalThis.DecompressionStream(_e);return new Response(new Blob([N]).stream().pipeThrough(ue)).arrayBuffer().then(be=>new Uint8Array(be))}(P,C).then(N=>(function(V,G){V.readFields(F4,G)}(new XT(N),D),new Q4[y](D.buffer))),L.then(N=>{for(let V=A.length-1;V>=0;V--)switch(A[V]){case"delta_filter":N4(N,b);break;case"zigzag_filter":j4(N);break;case"bitshuffle_filter":V4(N,y);break;default:throw new nl(`Unhandled filter "${A[V]}"`)}return{layerName:u,blockIndex:T,data:N}}).catch(N=>{throw N})}))},zt(kR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),zt(vx,"MapboxRasterTile"),zt(RR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class MR{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const c=e[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class OR{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $c(xt,16,0),this.featureIndexArray=new _v,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,c,u,p,m=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,u,p,m);const T=this.grid;for(let A=0;A<n.length;A++){const C=n[A],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<C.length;D++){const L=C[D];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}y!==0&&(P[0]-=y,P[1]-=y,P[2]+=y,P[3]+=y),P[0]<xt&&P[1]<xt&&P[2]>=0&&P[3]>=0&&T.insert(b,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $t(new Xv(this.rawTileData)).layers,this.sourceLayerCoder=new MR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:c,transform:u,tileTransform:p,pixelPosMatrix:m,availableImages:y,worldview:b}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const T=n.queryRadius?n.queryRadius:0,A=c.bufferedTilespaceBounds,C=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(N,V,G,X)=>dn(c.bufferedTilespaceGeometry,N-T,V-T,G+T,X+T));C.sort(ej);let P=null;u.elevation&&C.length>0&&(P=qp.create(u.elevation,this.tileID));const D={};let L;for(let N=0;N<C.length;N++){const V=C[N];if(V===L)continue;L=V;const G=this.featureIndexArray.get(V);let X=null;this.is3DTile?this.loadMatchingModelFeature(D,G,e,c,u,b):this.loadMatchingFeature(D,G,e,y,b,(Y,ie,_e,ue=0)=>(X||(X=et(Y,this.tileID.canonical,p)),ie.queryIntersectsFeature(c,Y,_e,X,this.z,u,m,P,ue)))}return D}loadMatchingFeature(e,n,c,u,p,m){const{featureIndex:y,bucketIndex:b,sourceLayerIndex:T,layoutVertexArrayOffset:A}=n,C=this.bucketLayerIDs[b],P=c.layers,D=Object.keys(P);if(D.length&&!vr(D,C))return;const L=c.sourceCache,N=this.sourceLayerCoder.decode(T),V=this.vtLayers[N].feature(y),G=this.getId(V,N);for(let X=0;X<C.length;X++){const Y=C[X];if(!P[Y])continue;const{styleLayer:ie,targets:_e}=P[Y];let ue={};G!==void 0&&(ue=L.getFeatureState(ie.sourceLayer,G));const be=!m||m(V,ie,ue,A);if(!be)continue;const Ee=new Zd(V,this.z,this.x,this.y,G);Ee.tile=this.tileID.canonical,Ee.state=ue;let Ae=this.serializedLayersCache.get(Y);Ae||(Ae=ie.serialize(),Ae.id=Y,this.serializedLayersCache.set(Y,Ae)),Ee.source=Ae.source,Ee.sourceLayer=Ae["source-layer"],Ee.layer=Object.assign({},Ae),Ee.layer.paint=DR(Ae.paint,ie.paint,V,ue,u),Ee.layer.layout=DR(Ae.layout,ie.layout,V,ue,u);let Ze=!1;for(const ze of _e){this.updateFeatureProperties(Ee,ze);const{filter:Ke}=ze;if(Ke){if(V.properties=Ee.properties,Ke.needGeometry){const tt=je(V,!0);if(!Ke.filter(new Ui(this.tileID.overscaledZ,{worldview:p}),tt,this.tileID.canonical))continue}else if(!Ke.filter(new Ui(this.tileID.overscaledZ,{worldview:p}),V))continue}Ze=!0,ze.targetId&&this.addFeatureVariant(Ee,ze)}Ze&&this.appendToResult(e,Y,y,Ee,be)}}loadMatchingModelFeature(e,n,c,u,p,m){const{featureIndex:y,bucketIndex:b}=n,T=this.bucketLayerIDs[b],A=c.layers,C=Object.keys(A);if(!C.length||vr(C,T))for(let P=0;P<T.length;P++){const D=T[P],{styleLayer:L,targets:N}=A[D];if(L.type!=="model")continue;const V=u.tile,G=V.getBucket(L);if(!(G&&G instanceof dx))continue;const X=o4(G,y,u,p);if(!X)continue;const{z:Y,x:ie,y:_e}=V.tileID.canonical,{feature:ue,intersectionZ:be,position:Ee}=X;let Ae={};ue.id!==void 0&&(Ae=c.sourceCache.getFeatureState(L.sourceLayer,ue.id));const Ze=new Zd({},Y,ie,_e,ue.id);Ze.tile=this.tileID.canonical,Ze.state=Ae,Ze.properties=ue.properties,Ze.geometry={type:"Point",coordinates:[Ee.lng,Ee.lat]};let ze=this.serializedLayersCache.get(D);ze||(ze=L.serialize(),ze.id=D,this.serializedLayersCache.set(D,ze)),Ze.source=ze.source,Ze.sourceLayer=ze["source-layer"],Ze.layer=Object.assign({},ze);let Ke=!1;for(const tt of N){this.updateFeatureProperties(Ze,tt);const{filter:st}=tt;if(st){if(ue.properties=Ze.properties,st.needGeometry){if(!st.filter(new Ui(this.tileID.overscaledZ,{worldview:m}),ue,this.tileID.canonical))continue}else if(!st.filter(new Ui(this.tileID.overscaledZ,{worldview:m}),ue))continue}Ke=!0,tt.targetId&&this.addFeatureVariant(Ze,tt)}Ke&&this.appendToResult(e,D,y,Ze,be)}}updateFeatureProperties(e,n,c){if(n.properties){const u={};for(const p in n.properties){const m=n.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,c);m!=null&&(u[p]=m)}e.properties=u}}addFeatureVariant(e,n,c){const u={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(u)}appendToResult(e,n,c,u,p){let m=e[n];m===void 0&&(m=e[n]=[]),m.push({featureIndex:c,feature:u,intersectionZ:p})}lookupSymbolFeatures(e,n,c,u,p,m){const y={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:c,featureIndex:b,layoutVertexArrayOffset:0},u,p,m);return y}loadFeature(e){const{featureIndex:n,sourceLayerIndex:c}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(c),p=this.vtFeatures[u];if(p[n])return p[n];const m=this.vtLayers[u].feature(n);return p[n]=m,m}hasLayer(e){for(const n of this.bucketLayerIDs)for(const c of n)if(e===c)return!0;return!1}getId(e,n){let c=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const p=tl(u);if(p.result!=="success"){const m=p.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void or(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}c=this.promoteIdExpression.evaluate({zoom:0},e)}else c=e.properties[u];typeof c=="boolean"&&(c=Number(c))}return c}}function DR(s,e,n,c,u){return gt(s,(p,m)=>{const y=e instanceof Gc?e.get(m):null;return y&&y.evaluate?y.evaluate(n,c,void 0,u):y})}function ej(s,e){return e-s}zt(OR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const LR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class KT{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=c>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=LR[15&c];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new KT(y,m,p,e)}constructor(e,n=64,c=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=LR.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=e,this.coords[this._pos++]=n,c}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return YT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,c,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:y}=this,b=[0,p.length-1,0],T=[];for(;b.length;){const A=b.pop()||0,C=b.pop()||0,P=b.pop()||0;if(C-P<=y){for(let V=P;V<=C;V++){const G=m[2*V],X=m[2*V+1];G>=e&&G<=c&&X>=n&&X<=u&&T.push(p[V])}continue}const D=P+C>>1,L=m[2*D],N=m[2*D+1];L>=e&&L<=c&&N>=n&&N<=u&&T.push(p[D]),(A===0?e<=L:n<=N)&&(b.push(P),b.push(D-1),b.push(1-A)),(A===0?c>=L:u>=N)&&(b.push(D+1),b.push(C),b.push(1-A))}return T}within(e,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:m}=this,y=[0,u.length-1,0],b=[],T=c*c;for(;y.length;){const A=y.pop()||0,C=y.pop()||0,P=y.pop()||0;if(C-P<=m){for(let V=P;V<=C;V++)FR(p[2*V],p[2*V+1],e,n)<=T&&b.push(u[V]);continue}const D=P+C>>1,L=p[2*D],N=p[2*D+1];FR(L,N,e,n)<=T&&b.push(u[D]),(A===0?e-c<=L:n-c<=N)&&(y.push(P),y.push(D-1),y.push(1-A)),(A===0?e+c>=L:n+c>=N)&&(y.push(D+1),y.push(C),y.push(1-A))}return b}}function YT(s,e,n,c,u,p){if(u-c<=n)return;const m=c+u>>1;zR(s,e,m,c,u,p),YT(s,e,n,c,m-1,1-p),YT(s,e,n,m+1,u,1-p)}function zR(s,e,n,c,u,p){for(;u>c;){if(u-c>600){const T=u-c+1,A=n-c+1,C=Math.log(T),P=.5*Math.exp(2*C/3),D=.5*Math.sqrt(C*P*(T-P)/T)*(A-T/2<0?-1:1);zR(s,e,n,Math.max(c,Math.floor(n-A*P/T+D)),Math.min(u,Math.floor(n+(T-A)*P/T+D)),p)}const m=e[2*n+p];let y=c,b=u;for(uy(s,e,c,n),e[2*u+p]>m&&uy(s,e,c,u);y<b;){for(uy(s,e,y,b),y++,b--;e[2*y+p]<m;)y++;for(;e[2*b+p]>m;)b--}e[2*c+p]===m?uy(s,e,c,b):(b++,uy(s,e,b,u)),b<=n&&(c=b+1),n<=b&&(u=b-1)}}function uy(s,e,n,c){JT(s,n,c),JT(e,2*n,2*c),JT(e,2*n+1,2*c+1)}function JT(s,e,n){const c=s[e];s[e]=s[n],s[n]=c}function FR(s,e,n,c){const u=s-n,p=e-c;return u*u+p*p}o.$=Of,o.A=gl,o.B=Hc,o.C=2,o.D=Op,o.E=pl,o.F=q_,o.G=cP,o.H=Mf,o.I=Wn,o.J=i_,o.K=Su,o.L=gd,o.M=ip,o.N=rp,o.O=Gg,o.P=nt,o.Q=ap,o.R=Mc,o.S=Uu,o.T=lT,o.U=tl,o.V=hx,o.W=qg,o.X=Mu,o.Y=ku,o.Z=bd,o._=Hs,o.a=function(s){return Wi.API_CDN_URL_REGEX.test(s)},o.a$=qu,o.a0=_r,o.a1=gg,o.a2=$u,o.a3=class extends hx{},o.a4=np,o.a5=$g,o.a6=Le,o.a7=function(s){const e=s.value;return e?_r(e)?BT(e,!0)?[]:[new hx(s.key,e,`invalid url "${e}"`)]:[new hx(s.key,e,`string expected, "${Su(e)}" found`)]:[]},o.a8=ov,o.a9=gn,o.aA=W,o.aB=re,o.aC=Nt,o.aD=po,o.aE=ls,o.aF=Z,o.aG=We,o.aH=function(s,e){const n={};for(let c=0;c<e.length;c++){const u=e[c];u in s&&(n[u]=s[u])}return n},o.aI=M,o.aJ=q,o.aK=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,n,c){const u=this.entries[s]=this.entries[s]||{callbacks:[]};if(u.result){const[p,m]=u.result;return this.scheduler?this.scheduler.add(()=>{c(p,m)},e):c(p,m),()=>{}}return u.callbacks.push(c),u.cancel||(u.cancel=n((p,m)=>{u.result=[p,m];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(p,m)},e):y(p,m);setTimeout(()=>delete this.entries[s],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(p=>p!==c),u.callbacks.length||(u.cancel(),delete this.entries[s]))}}},o.aL=function(s,e,n){const c=JSON.stringify(s.request);return s.data&&(this.deduped.entries[c]={result:[null,s.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},u=>{const p=vu(s.request,(m,y,b)=>{m?u(m):y&&u(null,{vectorTile:n?void 0:new $t(new Xv(y)),rawData:y,responseHeaders:new Map(b.entries())})});return()=>{p.cancel(),u()}},e)},o.aM=function(s){return s?{cacheControl:s.get("Cache-Control"),expires:s.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=function(s){Af++,Af>uo&&(s.getActor().send("enforceCacheSizeLimit",ed),Af=0)},o.aO=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log2(s)))},o.aP=rs,o.aQ=BP,o.aR=GP,o.aS=z,o.aT=FP,o.aU=function(s,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let c=0;c<s.length;c++){const u=document.createElement("source");fi(s[c])||(n.crossOrigin="Anonymous"),u.src=s[c],n.appendChild(u)}return{cancel:()=>{}}},o.aV=V_,o.aW=Xd,o.aX=Ue,o.aY=K_,o.aZ=ne,o.a_=ee,o.aa=ft,o.ab=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Ai(s.expression.evaluate(e))}interpolate(s,e,n){return{x:pr(s.x,e.x,n),y:pr(s.y,e.y,n),z:pr(s.z,e.z,n),azimuthal:pr(s.azimuthal,e.azimuthal,n),polar:pr(s.polar,e.polar,n)}}},o.ac=Ui,o.ad=ic,o.ae=Me,o.af=bi,o.ag=mr,o.ah=le,o.ai=Gc,o.aj=rh,o.ak=pr,o.al=xt,o.am=ud,o.an=Nr,o.ao=yi,o.ap=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([n,c]){const u=Ai([1,n,c]);return{x:u.x,y:u.y,z:u.z}}(s.expression.evaluate(e))}interpolate(s,e,n){return{x:pr(s.x,e.x,n),y:pr(s.y,e.y,n),z:pr(s.z,e.z,n)}}},o.aq=function(s,e,n=0,c=!0){const u=new nt(n,n),p=s.sub(u),m=e.add(u),y=[p,new nt(m.x,p.y),m,new nt(p.x,m.y)];return c&&y.push(p.clone()),y},o.ar=function(s,e){const n=[];for(let c=0;c<s.length;c++){const u=Se(c-1,-1,s.length-1),p=Se(c+1,-1,s.length-1),m=s[c],y=s[p],b=s[u].sub(m).unit(),T=y.sub(m).unit(),A=T.angleWithSep(b.x,b.y),C=b.add(T).unit().mult(-1*e/Math.sin(A/2));n.push(m.add(C))}return n},o.as=bP,o.at=dn,o.au=function(s,e,n=0){return Qt(((e.x-n)*s.scale-s.x)*xt,(e.y*s.scale-s.y)*xt,ge(e.z,e.y))},o.av=Gi,o.aw=Hr,o.ax=kr,o.ay=zC,o.az=function(s){let e=1/0,n=1/0,c=-1/0,u=-1/0;for(const p of s)e=Math.min(e,p.x),n=Math.min(n,p.y),c=Math.max(c,p.x),u=Math.max(u,p.y);return{min:new nt(e,n),max:new nt(c,u)}},o.b=function(s){return Wi.API_FONTS_REGEX.test(s)},o.b$=Kb,o.b0=rn,o.b1=Ge,o.b2=pv,o.b3=ax,o.b4=function(){So.isLoading()||So.isLoaded()||e_()!=="deferred"||t_()},o.b5=fp,o.b6=je,o.b7=Zd,o.b8=Bn,o.b9=gT,o.bA=Be,o.bB=we,o.bC=function(s,e){const{x:n,y:c}=s.point,u=tA(n,c,s.worldSize/s._pixelsPerMercatorPixel,0,0);return re(u,u,Fb(uc(e)))},o.bD=$,o.bE=Qn,o.bF=Vi,o.bG=ti,o.bH=Qi,o.bI=Pi,o.bJ=Vp,o.bK=Zo,o.bL=ST,o.bM=function(s,e,n,c,u){const p=5*e+2;s.float32[p+0]=n,s.float32[p+1]=c,s.float32[p+2]=u},o.bN=Hp,o.bO=aa,o.bP=lo,o.bQ=Do,o.bR=di,o.bS=Se,o.bT=function(s,e,n,c){var u=new F(4);return u[0]=s,u[1]=e,u[2]=n,u[3]=c,u},o.bU=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const n=e.getSource().maxzoom,c=1<<n,u=Math.floor(s.x),p=Math.floor((s.x-u)*c),m=Math.floor(s.y*c),y=this.findDEMTileFor(new rs(n,u,n,p,m));return!(!y||!y.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const c=this._source();if(!c||s.y<0||s.y>1)return e;const u=c.getSource().maxzoom,p=1<<u,m=Math.floor(s.x),y=s.x-m,b=new rs(u,m,u,Math.floor(y*p),Math.floor(s.y*p)),T=this.findDEMTileFor(b);if(!T||!T.dem)return e;const A=T.dem,C=1<<T.tileID.canonical.z,P=(y*C-T.tileID.canonical.x)*A.dim,D=(s.y*C-T.tileID.canonical.y)*A.dim,L=Math.floor(P),N=Math.floor(D);return(n?this.exaggeration():1)*pr(pr(A.get(L,N),A.get(L,N+1),D-N),pr(A.get(L+1,N),A.get(L+1,N+1),D-N),P-L)}static getAtTileOffset(s,e,n,c){const u=1<<s.canonical.z;return c?c.pointElevation(e):n?n.getAtPointOrZero(new Me(s.wrap+(s.canonical.x+e.x/xt)/u,(s.canonical.y+e.y/xt)/u)):0}static getAtTileOffsetFunc(s,e,n,c){return(u,p,m)=>{const y=this.getAtTileOffset(s,u,p,m),b=c.upVector(s.canonical,u.x,u.y);return Sr(b,b,y*c.upVectorScale(s.canonical,e,n).metersToTile),b}}getForTilePoints(s,e,n,c){if(this.isUsingMockSource())return!1;const u=qp.create(this,s,c);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],n)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const n=e.dem.tree,c=e.tileID,u=1<<s.canonical.z-c.canonical.z;let p=s.canonical.x/u-c.canonical.x,m=s.canonical.y/u-c.canonical.y,y=0;for(let b=0;b<s.canonical.z-c.canonical.z&&!n.leaves[y];b++){p*=2,m*=2;const T=2*Math.floor(m)+Math.floor(p);y=n.childOffsets[y]+T,p%=1,m%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,n=Number.MAX_VALUE,c=Number.MIN_VALUE;for(const u of s){const p=this.getMinMaxForTile(u.tileID);p&&(n=Math.min(n,p.min),c=Math.max(c,p.max),e=!0)}return e?{min:n,max:c}:null}},o.bV=Bv,o.bW=En,o.bX=vs,o.bY=MA,o.bZ=HP,o.b_=zA,o.ba=Wb,o.bb=et,o.bc=fo,o.bd=wp,o.be=XI,o.bf=cn,o.bg=kp,o.bh=zT,o.bi=function(s,e){const n=rh(e.zoom);if(n===0)return uc(s);const c=Av(s),u=zb(c),p=Z(c.getWest())*e.worldSize,m=Z(c.getEast())*e.worldSize,y=q(c.getNorth())*e.worldSize,b=q(c.getSouth())*e.worldSize,T=[p,y,0],A=[m,y,0],C=[p,b,0],P=[m,b,0],D=fe([],e.globeMatrix);return bi(T,T,D),bi(A,A,D),bi(C,C,D),bi(P,P,D),u[0]=Kc(u[0],C,n),u[1]=Kc(u[1],P,n),u[2]=Kc(u[2],A,n),u[3]=Kc(u[3],T,n),Lr.fromPoints(u)},o.bj=Pv,o.bk=fe,o.bl=E_,o.bm=Kc,o.bn=qc,o.bo=EB,o.bp=bt,o.bq=de,o.br=vx,o.bs=Xv,o.bt=vu,o.bu=function(s,e){const n=[];for(const c in s)c in e||n.push(c);return n},o.bv=Te,o.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bx=ks,o.by=se,o.bz=me,o.c=Gs,o.c$=function(s){return s*s*s*s*s},o.c0=bT,o.c1=gP,o.c2=PT,o.c3=KT,o.c4=Sr,o.c5=Ve,o.c6=br,o.c7=function(s,e,n){n*=.5;var c=e[0],u=e[1],p=e[2],m=e[3],y=Math.sin(n),b=Math.cos(n);return s[0]=c*b+u*y,s[1]=u*b-c*y,s[2]=p*b+m*y,s[3]=m*b-p*y,s},o.c8=_i,o.c9=Sn,o.cA=pi,o.cB=xC,o.cC=Ho,o.cD=JI,o.cE=function(s,e,n,c,u,p,m,y,b){if(b.name==="globe")return JI(s,e,new Ho(n,c,u),!1);const T=K_({z:n,x:c,y:u},b);return new Lr([(p+T.x/T.scale)*e,e*(T.y/T.scale),m],[(p+T.x2/T.scale)*e,e*(T.y2/T.scale),y])},o.cF=function(s,e,n){return s[0]=Math.min(e[0],n[0]),s[1]=Math.min(e[1],n[1]),s[2]=Math.min(e[2],n[2]),s[3]=Math.min(e[3],n[3]),s},o.cG=function(s,e,n){return s[0]=Math.max(e[0],n[0]),s[1]=Math.max(e[1],n[1]),s[2]=Math.max(e[2],n[2]),s[3]=Math.max(e[3],n[3]),s},o.cH=function(s){const e=Math.round((s+45+360)%360/90)%4;return lg[e]},o.cI=oe,o.cJ=Ct,o.cK=r,o.cL=function(s){const e=me(new Float64Array(16));re(e,s.pixelMatrix,s.globeMatrix);const n=[0,x,0],c=[0,w,0];return bi(n,n,e),bi(c,c,e),[n[0]>0&&n[0]<=s.width&&n[1]>0&&n[1]<=s.height&&!Nb(s,new z(s.center.lat,90)),c[0]>0&&c[0]<=s.width&&c[1]>0&&c[1]<=s.height&&!Nb(s,new z(s.center.lat,-90))]},o.cM=function(s,e){const{scale:n}=s.tileTransform,c=n*xt/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return function(u,p,m){var y=p[1],b=p[2],T=p[3],A=m[0],C=m[1];return u[0]=p[0]*A,u[1]=y*A,u[2]=b*C,u[3]=T*C,u}(new Float32Array(4),e.inverseAdjustmentMatrix,[c,c])},o.cN=$v,o.cO=Gt,o.cP=vC,o.cQ=function(s){const e=vC(s,!0);return $([],[e[0],e[1],e[4],e[5]])},o.cR=Oe,o.cS=Si,o.cT=Xe,o.cU=function(s){const{x:e,y:n}=s.point,{lng:c,lat:u}=s._center;return tA(e,n,s.worldSize,c,u)},o.cV=tr,o.cW=$s,o.cX=qo,o.cY=In,o.cZ=d,o.c_=function(s,e,n){let c=0;for(let u=0;u<2;++u)s[u]>0&&(c+=(s[u]-0)*(s[u]-0)),e[u]<0&&(c+=(0-e[u])*(0-e[u]));return c},o.ca=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},o.cb=nr,o.cc=function(s,e,n,c,u){var p=1/Math.tan(e/2);if(s[0]=p/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,u!=null&&u!==1/0){var m=1/(c-u);s[10]=(u+c)*m,s[14]=2*u*c*m}else s[10]=-1,s[14]=-2*c;return s},o.cd=function(s,e,n,c,u,p,m){var y=1/(e-n),b=1/(c-u),T=1/(p-m);return s[0]=-2*y,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*T,s[11]=0,s[12]=(e+n)*y,s[13]=(u+c)*b,s[14]=(m+p)*T,s[15]=1,s},o.ce=K,o.cf=function(s,e,n){s[4*e+0]=n[0],s[4*e+1]=n[1],s[4*e+2]=n[2],s[4*e+3]=n[3]},o.cg=Ap,o.ch=Ju,o.ci=Dn,o.cj=rl,o.ck=Nd,o.cl=AP,o.cm=function(){var s=new F(4);return F!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},o.cn=function(s,e,n){var c=e[0],u=e[1],p=e[2],m=e[3],y=Math.sin(n),b=Math.cos(n);return s[0]=c*b+p*y,s[1]=u*b+m*y,s[2]=c*-y+p*b,s[3]=u*-y+m*b,s},o.co=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},o.cp=Ss,o.cq=function(s){var e=s[0],n=s[1],c=s[2],u=s[3];return Math.sqrt(e*e+n*n+c*c+u*u)},o.cr=Pa,o.cs=ss,o.ct=il,o.cu=3,o.cv=2,o.cw=7,o.cx=6,o.cy=Fn,o.cz=Mt,o.d=function(s){return Wi.API_TILEJSON_REGEX.test(s)},o.d$=nA,o.d0=U,o.d1=45,o.d2=Bd,o.d3=function(s,e,n){const c=Math.sqrt(s*s+e*e+n*n),u=c>0?Math.acos(n/c)*Us:0;let p=s!==0||e!==0?Math.atan2(-e,-s)*Us+90:0;return p<0&&(p+=360),[c,p,u]},o.d4=Qt,o.d5=Ai,o.d6=xe,o.d7=dt,o.d8=Lr,o.d9=It,o.dA=w_,o.dB=class extends ya{constructor(s){super(s),this.current=Rb}set(s,e,n){if(this.fetchUniformLocation(s,e)){for(let c=0;c<9;c++)if(n[c]!==this.current[c]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},o.dC=Yh,o.dD=function(s,e,n){const c=rh(n.zoom),u=s.style.map._antialias,p=s.terrain&&s.terrain.exaggeration()>0;return c===0&&!u&&!p},o.dE=function(s){const e=s.pixelsPerMeter,n=e/K(1,s.center.lat),c=me(new Float64Array(16));return de(c,c,[s.point.x,s.point.y,0]),Oe(c,c,[n,n,e]),Float32Array.from(c)},o.dF=Av,o.dG=function(s){const e=oe-5;s=W(s,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Nr(s))),3);return Math.round(n*(_.length-1))},o.dH=function(s,e,n,c){const u=e.getNorth(),p=e.getSouth(),m=e.getWest(),y=e.getEast(),b=1<<s.z,T=y-m,A=u-p,C=T/f,P=-A/_[n],D=[0,C,0,P,0,0,u,m,0];if(s.z>0){const L=180/c;J(D,D,[L/T+1,0,0,0,L/A+1,0,-.5*L/C,.5*L/P,1])}return D[2]=b,D[5]=s.x,D[8]=s.y,D},o.dI=uc,o.dJ=function(s,e,n){const c=me(new Float64Array(16)),u=(e/(1<<s)-.5)*Math.PI*2;return qe(c,n.globeMatrix,u),Float32Array.from(c)},o.dK=pA,o.dL=Iv,o.dM=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},o.dN=Q,o.dO=function(s,e){var n=Math.sin(e),c=Math.cos(e);return s[0]=c,s[1]=n,s[2]=0,s[3]=-n,s[4]=c,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.dP=ns,o.dQ=eA,o.dR=qi,o.dS=hn,o.dT=256,o.dU=function(s,e){const n=[0,0,0];return bi(n,n,Pv(uc(e.canonical))),bi(n,n,s),n},o.dV=s=>({u_matrix:new Nd(s),u_texsize:new rl(s),u_pixels_to_tile_units:new b_(s),u_device_pixel_ratio:new Dn(s),u_width_scale:new Dn(s),u_floor_width_scale:new Dn(s),u_image:new Ap(s),u_units_to_pixels:new rl(s),u_tile_units_to_pixels:new Dn(s),u_alpha_discard_threshold:new Dn(s),u_trim_offset:new rl(s),u_trim_fade_range:new rl(s),u_trim_color:new Bd(s),u_emissive_strength:new Dn(s),u_zbias_factor:new Dn(s),u_tile_to_meter:new Dn(s),u_ground_shadow_factor:new Ju(s),u_pattern_transition:new Dn(s)}),o.dW=s=>({u_matrix:new Nd(s),u_pixels_to_tile_units:new b_(s),u_device_pixel_ratio:new Dn(s),u_width_scale:new Dn(s),u_floor_width_scale:new Dn(s),u_units_to_pixels:new rl(s),u_dash_image:new Ap(s),u_gradient_image:new Ap(s),u_image_height:new Dn(s),u_texsize:new rl(s),u_tile_units_to_pixels:new Dn(s),u_alpha_discard_threshold:new Dn(s),u_trim_offset:new rl(s),u_trim_fade_range:new rl(s),u_trim_color:new Bd(s),u_emissive_strength:new Dn(s),u_zbias_factor:new Dn(s),u_tile_to_meter:new Dn(s),u_ground_shadow_factor:new Ju(s)}),o.dX=s=>({u_camera_to_center_distance:new Dn(s),u_extrude_scale:new b_(s),u_device_pixel_ratio:new Dn(s),u_matrix:new Nd(s),u_inv_rot_matrix:new Nd(s),u_merc_center:new rl(s),u_tile_id:new Ju(s),u_zoom_transition:new Dn(s),u_up_dir:new Ju(s),u_emissive_strength:new Dn(s)}),o.dY=Zu,o.dZ=d5,o.d_=class{constructor(s,e,n,c){this.context=s,this.format=c,this.size=n,this.texture=s.gl.createTexture();const[u,p,m]=this.size,{gl:y}=s;y.bindTexture(y.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&y.texImage3D(y.TEXTURE_3D,0,this.format,u,p,m,0,oT(this.format),aT(this.format),e.data)}bind(s,e){const{context:n}=this,{gl:c}=n;c.bindTexture(c.TEXTURE_3D,this.texture),s!==this.minFilter&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,s),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,e),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},o.da=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},o.db=yC,o.dc=pT,o.dd=TC,o.de=BT,o.df=function(s,e){return s.readFields(c4,{icons:[]},e)},o.dg=Nv,o.dh=Up,o.di=IT,o.dj=hg,o.dk=sv,o.dl=Jh,o.dm=ad,o.dn=Xt,o.dp=function(s){const e=s.indexOf(Md);return e>=0?s.slice(0,e):s},o.dq=function(s){return s.indexOf(Md)>=0},o.dr=function(s){const e=s.lastIndexOf(Md);return e>=0?s.slice(e+1):""},o.ds=function(s){const e=[],n=s.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dt=function(s,e,n,c){return s.type==="custom"?new r4(s,e):new a4[s.type](s,e,n,c)},o.du=lt,o.dv=function(s){const e=s.indexOf(Md);return e>=0?s.slice(e+1):""},o.dw=class extends Zd{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},o.dx=Qg,o.dy=td,o.dz=function(s){return s({pluginStatus:io,pluginURL:oc}),Qg.on("pluginStateChange",s),s},o.e=Wi,o.e$=function([s,e,n]){const c=Math.hypot(s,e,n),u=Math.atan2(s,n),p=.5*Math.PI-Math.acos(-e/c);return new z($s(u),$s(p))},o.e0=(s,e,n,c,u,p)=>{const m=s.transform,y=m.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(y){const A=eA(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([A,0,0,A])}else b=m.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(m.projection),u_matrix:s.translatePosMatrix(e.projMatrix,n,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:wo.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:RB,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(y){T.u_inv_rot_matrix=c,T.u_merc_center=u,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=rh(m.zoom);const A=u[0]*xt,C=u[1]*xt;T.u_up_dir=m.projection.upVector(new Ho(0,0,0),A,C)}return T},o.e1=jC,o.e2=ho,o.e3=(s,e,n,c,u,p,m,y,b,T)=>{const A=s.transform,C=A.pitch<15?FC(.07,.7,W((14-A.zoom)/5,0,1)):.07,P=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:NC(s,e,n,c),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:BC(e,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:T}},o.e4=(s,e,n,c,u,p,m,y,b,T)=>{const A=s.transform,C=A.calculatePixelsToTileUnitsMatrix(e),P=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",D=A.pitch<15?FC(.07,.7,W((14-A.zoom)/5,0,1)):.07;return{u_matrix:NC(s,e,n,c),u_pixels_to_tile_units:C,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:y,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:VC(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:BC(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toPremultipliedRenderColor(P?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:xe(e.tileID.canonical,0),u_ground_shadow_factor:T}},o.e5=Re,o.e6=I_,o.e7=ge,o.e8=Xc,o.e9=Fv,o.eA=VT,o.eB=qv,o.eC=Hv,o.eD=[1,1,1],o.eE=qp,o.eF=ct,o.eG=function(s,e,n,c){var u=e[0],p=e[1],m=e[2],y=e[3];return s[0]=u+c*(n[0]-u),s[1]=p+c*(n[1]-p),s[2]=m+c*(n[2]-m),s[3]=y+c*(n[3]-y),s},o.eH=Fp,o.eI=_a,o.eJ=cc,o.eK=function(s,e,n,c,u,p,m,y,b,T,A,C,P,D,L,N){var V=new F(16);return V[0]=s,V[1]=e,V[2]=n,V[3]=c,V[4]=u,V[5]=p,V[6]=m,V[7]=y,V[8]=b,V[9]=T,V[10]=A,V[11]=C,V[12]=P,V[13]=D,V[14]=L,V[15]=N,V},o.eL=R,o.eM=p_,o.eN=Dd,o.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new nt(1/0,1/0),max:new nt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const n=DA(new nt(0,0),new nt(xt,xt),s),c=[];if(e&&!Zb(n,this._globalClipBounds))return c;for(const u of this._activeRegions){if(u.hiddenByOverlap||!Zb(n,u))continue;const p=sN(u.min,u.max,s);c.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return c}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const c of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(c).buckets[e.layer];u&&u.updateFootprints(c.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const n=s.getOrder(),c=s.getClipMask(),u=s.getClipScope();for(const p of e){if(!p.footprint)continue;const m=DA(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:n,clipMask:c,clipScope:u})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||Dv(e.min,n.min)||Dv(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(c,u){const p=(m,y)=>m+y;return c.length-u.length||c.reduce(p,"").localeCompare(u.reduce(p,""))}(e.clipScope,n.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const n=this._activeRegions[e],c=this._prevRegions[e];s=n.priority!==c.priority||!OA(n,c)||n.order!==c.order||n.clipMask!==c.clipMask||!ks(n.clipScope,c.clipScope),this._activeRegions[e].hiddenByOverlap=c.hiddenByOverlap,++e}}if(s){++this._updateTime;for(const n of this._activeRegions)n.order!==M_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const c=this._activeRegions;if(n>=c.length)return n;const u=c[n].priority;for(;n<c.length&&c[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,c=e(n);for(;n!==c;){let u=n;const p=n;for(;u!==c;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let y=0;y<p;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&m.order===M_&&Zb(m,b)&&(m.hiddenByOverlap=LA(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++u}n=c,c=e(n)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},o.eP=M_,o.eQ=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const n=new fo,c=new rn,u=[],p=s+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),b=(T,A,C)=>{let P=T===p-1?T-2:T===0?T:T-1;return P+=C?24575:0,[P,A]};for(let T=0;T<p;++T)n.emplaceBack(...b(T,0,!0));for(let T=0;T<m;++T)for(let A=0;A<p;++A)n.emplaceBack(...b(A,T,(A===0||A===p-1)&&!0));for(let T=0;T<e.length;++T){const A=e[T];for(let C=0;C<p;++C)n.emplaceBack(...b(C,A,!0))}for(let T=0;T<e.length;++T){const A=c.length,C=e[T]+1+2,P=new rn;for(let N=0;N<C-1;N++){const V=N===C-2,G=V?p*(y-e.length+T-N):p;for(let X=0;X<p-1;X++){const Y=N*p+X;N===0||V||X===0||X===p-2?(P.emplaceBack(Y+1,Y,Y+G),P.emplaceBack(Y+G,Y+G+1,Y+1)):(c.emplaceBack(Y+1,Y,Y+G),c.emplaceBack(Y+G,Y+G+1,Y+1))}}const D=cn.simpleSegment(0,A,n.length,c.length-A);for(let N=0;N<P.uint16.length;N+=3)c.emplaceBack(P.uint16[N],P.uint16[N+1],P.uint16[N+2]);const L=cn.simpleSegment(0,A,n.length,c.length-A);u.push({withoutSkirts:D,withSkirts:L})}return{vertices:n,indices:c,segments:u}}_createGrid(s){const e=this._fillGridMeshWithLods(f,_);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,XI.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new rn;for(let m=0;m<=f;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const n=new Zc,c=new Zc,u=new Zc,p=new Zc;this._poleSegments=[];for(let m=0,y=0;m<d;m++){const b=360/(1<<m);n.emplaceBack(0,-po,0,.5,0),c.emplaceBack(0,-po,0,.5,1),u.emplaceBack(0,-po,0,.5,.5),p.emplaceBack(0,-po,0,.5,.5);for(let T=0;T<=f;T++){let A=T/f,C=0;const P=pr(0,b,A),[D,L,N]=S(CB,PB,P,po);n.emplaceBack(D,L,N,A,C),c.emplaceBack(D,L,N,A,1-C);const V=Nr(P);A=.5+.5*Math.sin(V),C=.5+.5*Math.cos(V),u.emplaceBack(D,L,N,A,C),p.emplaceBack(D,L,N,A,1-C)}this._poleSegments.push(cn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(n,Rp,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(c,Rp,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(u,Rp,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(p,Rp,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},o.eR=kA,o.eS=De,o.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eU=H,o.eV=ce,o.eW=function(s,e,n){return s[0]=e[0]/n[0],s[1]=e[1]/n[1],s[2]=e[2]/n[2],s},o.eX=Js,o.eY=I,o.eZ=wi,o.e_=er,o.ea=KA,o.eb=nh,o.ec=jA,o.ed=NA,o.ee=pe,o.ef=function(s,e){if(s===e){var n=e[1],c=e[2],u=e[3],p=e[6],m=e[7],y=e[11];s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=n,s[6]=e[9],s[7]=e[13],s[8]=c,s[9]=p,s[11]=e[14],s[12]=u,s[13]=m,s[14]=y}else s[0]=e[0],s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=e[1],s[5]=e[5],s[6]=e[9],s[7]=e[13],s[8]=e[2],s[9]=e[6],s[10]=e[10],s[11]=e[14],s[12]=e[3],s[13]=e[7],s[14]=e[11],s[15]=e[15];return s},o.eg=t4,o.eh=Vr,o.ei=g_,o.ej=256,o.ek=Fb,o.el=Vo,o.em=qe,o.en=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},o.eo=Zc,o.ep=f_,o.eq=J0,o.er=function(s,e,n,c,u){return W((s-e)/(n-e)*(u-c)+c,c,u)},o.es=Hi,o.et=function(s,e){var n=e[0],c=e[1],u=e[2],p=e[3],m=e[4],y=e[5],b=e[6],T=e[7],A=e[8],C=A*m-y*T,P=-A*p+y*b,D=T*p-m*b,L=n*C+c*P+u*D;return L?(s[0]=C*(L=1/L),s[1]=(-A*c+u*T)*L,s[2]=(y*c-u*m)*L,s[3]=P*L,s[4]=(A*n-u*b)*L,s[5]=(-y*n+u*p)*L,s[6]=D*L,s[7]=(-T*n+c*b)*L,s[8]=(m*n-c*p)*L,s):null},o.eu=2,o.ev=Vn,o.ew=rr,o.ex=Jt,o.ey=function(s,e){var n=new F(3);Jt(n,e);var c=1/n[0],u=1/n[1],p=1/n[2],m=e[0]*c,y=e[1]*u,b=e[2]*p,T=e[4]*c,A=e[5]*u,C=e[6]*p,P=e[8]*c,D=e[9]*u,L=e[10]*p,N=m+A+L,V=0;return N>0?(V=2*Math.sqrt(N+1),s[3]=.25*V,s[0]=(C-D)/V,s[1]=(P-b)/V,s[2]=(y-T)/V):m>A&&m>L?(V=2*Math.sqrt(1+m-A-L),s[3]=(C-D)/V,s[0]=.25*V,s[1]=(y+T)/V,s[2]=(P+b)/V):A>L?(V=2*Math.sqrt(1+A-m-L),s[3]=(P-b)/V,s[0]=(y+T)/V,s[1]=.25*V,s[2]=(C+D)/V):(V=2*Math.sqrt(1+L-m-A),s[3]=(y-T)/V,s[0]=(P+b)/V,s[1]=(C+D)/V,s[2]=.25*V),s},o.ez=function(s,e){var n=2*Math.acos(e[3]),c=Math.sin(n/2);return c>O?(s[0]=e[0]/c,s[1]=e[1]/c,s[2]=e[2]/c):(s[0]=1,s[1]=0,s[2]=0),n},o.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},o.f0=cr,o.f1=cT,o.f2=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(n){if(Cn==null){const c=n.navigator?n.navigator.userAgent:null;Cn=!!n.safari||!(!c||!(/\b(iPad|iPhone|iPod)\b/.test(c)||c.match("Safari")&&!c.match("Chrome")))}return Cn}(s)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f3=function(s,e){ed=s,uo=e},o.f4=Nb,o.f5=rA,o.f6=function(s){const e=[0,0,0],n=me(new Float64Array(16));return re(n,s.pixelMatrix,s.globeMatrix),bi(e,e,n),new nt(e[0],e[1])},o.f7=function(){const s=B_;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(tT),B_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f8=function(){Nv().acquire(tT)},o.f9=e_,o.fA=ot,o.fB=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==fC){const n=new Uint32Array(s,0,7),[,,c,u,p,m]=n;e=n.byteLength+u+p+m+p,(c!==s.byteLength||e>=s.byteLength)&&or("Invalid b3dm header information.")}return _C(s,e)},o.fC=function(s,e){const n=pT(s);for(const c of n){for(const u of c.meshes)zN(u);c.lights&&(c.lightMeshIndex=c.meshes.length,c.meshes.push(FN(c.lights,e)))}return n},o.fD=dx,o.fE=mn,o.fF=lC,o.fG=So,o.fH=To,o.fI=function(s){kc(),ro!=null&&ro.then(e=>{e.keys().then(n=>{for(let c=0;c<n.length-s;c++)e.delete(n[c]).catch(u=>or(u.message))}).catch(n=>or(n.message))}).catch(e=>or(e.message))},o.fa=function(s,e,n=!1){if(io===To.deferred||io===To.loading||io===To.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");oc=wo.resolveURL(s),io=To.deferred,Yg=e,Jg(),n||t_()},o.fb=function(s){Dp=wo.resolveURL(s),Lp||(Lp=new Op(Nv(),new pl)),Lp.broadcast("setMeshoptUrl",Dp)},o.fc=hC,o.fd=function(s){iT=wo.resolveURL(s),Lp||(Lp=new Op(Nv(),new pl)),Lp.broadcast("setDracoUrl",iT)},o.fe=uC,o.ff=F_,o.fg=function(s){const e=fl();if(!e)return;const n=e.delete(Qh);s&&n.then(()=>s()).catch(s)},o.fh=$d,o.fi=zt,o.fj=ih,o.fk=Cl,o.fl=MR,o.fm=OR,o.fn=OC,o.fo=Rt,o.fp="hd_road_elevation",o.fq=xr,o.fr=gt,o.fs=Yc,o.ft=ET,o.fu=qd,o.fv=function(s,e,n,c,u,p,m,y=1,b,T,A){s.createArrays(),s.tilePixelRatio=xt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const C=s.layers[0].layout,P=s.layers[0]._unevaluatedLayout._values,D={};D.scaleFactor=y,D.textSizeScaleRange=C.get("text-size-scale-range"),D.iconSizeScaleRange=C.get("icon-size-scale-range");const[L,N]=D.textSizeScaleRange,[V,G]=D.iconSizeScaleRange;D.textScaleFactor=W(D.scaleFactor,L,N),D.iconScaleFactor=W(D.scaleFactor,V,G);const X=P["text-size"],Y=P["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:Ze}=s.textSizeData;D.compositeTextSizes=[X.possiblyEvaluate(new Ui(Ae,{worldview:A}),p),X.possiblyEvaluate(new Ui(Ze,{worldview:A}),p)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:Ze}=s.iconSizeData;D.compositeIconSizes=[Y.possiblyEvaluate(new Ui(Ae,{worldview:A}),p),Y.possiblyEvaluate(new Ui(Ze,{worldview:A}),p)]}D.layoutTextSize=X.possiblyEvaluate(new Ui(m+1,{worldview:A}),p),D.layoutIconSize=Y.possiblyEvaluate(new Ui(m+1,{worldview:A}),p),D.textMaxSize=X.possiblyEvaluate(new Ui(18,{worldview:A}),p);const ie=C.get("symbol-placement"),_e=C.get("text-rotation-alignment")==="map"&&ie!=="point",ue=C.get("text-size");let be=!1;const Ee=[];for(const Ae of s.features){const Ze=C.get("text-font").evaluate(Ae,{},p).join(","),ze=ue.evaluate(Ae,{},p)*D.textScaleFactor,Ke=D.layoutTextSize.evaluate(Ae,{},p)*D.textScaleFactor,tt=D.layoutIconSize.evaluate(Ae,{},p)*D.iconScaleFactor,st={horizontal:{},vertical:void 0},yt=Ae.text;let ht,rt=[0,0];if(yt){const Fr=yt.toString(),ii=C.get("text-letter-spacing").evaluate(Ae,{},p)*vs,Ar=C.get("text-line-height").evaluate(Ae,{},p)*vs,li=iv(Fr)?ii:0,ci=C.get("text-anchor").evaluate(Ae,{},p),an=C.get("text-variable-anchor");if(!an){const Je=C.get("text-radial-offset").evaluate(Ae,{},p);if(Je)rt=gP(ci,[Je*vs,CT]);else{const Et=C.get("text-offset").evaluate(Ae,{},p);rt=[Et[0]*vs,Et[1]*vs]}}let he=_e?"center":C.get("text-justify").evaluate(Ae,{},p);const ae=ie==="point",Ye=ae?C.get("text-max-width").evaluate(Ae,{},p)*vs:1/0,Tt=Je=>{s.allowVerticalPlacement&&Zg(Fr)&&(st.vertical=wT(yt,e,n,u,Ze,Ye,Ar,ci,Je,li,rt,Zo.vertical,!0,Ke,ze,b))};if(!_e&&an){const Je=he==="auto"?an.map(Kt=>PT(Kt)):[he];let Et=!1;for(let Kt=0;Kt<Je.length;Kt++){const Wt=Je[Kt];if(!st.horizontal[Wt])if(Et)st.horizontal[Wt]=st.horizontal[0];else{const Cr=wT(yt,e,n,u,Ze,Ye,Ar,"center",Wt,li,rt,Zo.horizontal,!1,Ke,ze,b);Cr&&(st.horizontal[Wt]=Cr,Et=Cr.positionedLines.length===1)}}Tt("left")}else{if(he==="auto"&&(he=PT(ci)),ae||C.get("text-writing-mode").indexOf("horizontal")>=0||!Zg(Fr)){const Je=wT(yt,e,n,u,Ze,Ye,Ar,ci,he,li,rt,Zo.horizontal,!1,Ke,ze,b);Je&&(st.horizontal[he]=Je)}Tt(ae?"left":he)}}let ut,He,$e,at,mt,it,Lt=!1;const Vt=C.get("icon-text-fit").evaluate(Ae,{},p);if(Ae.icon&&Ae.icon.hasPrimary()){const Fr=Z_(Ae.icon,s.iconSizeData,P["icon-size"],p,s.zoom,Ae,b,D.iconScaleFactor,A);ut=Fr.iconPrimary,$e=Fr.iconSecondary;const ii=ut.toString();if(He=c.get(ii),He&&(mt=C.get("icon-offset").evaluate(Ae,{},p),it=C.get("icon-anchor").evaluate(Ae,{},p),ht=Yv(u.get(ii),$e?u.get($e.toString()):void 0,mt,it),Lt=He.sdf,s.sdfIcons===void 0?s.sdfIcons=He.sdf:s.sdfIcons!==He.sdf&&or("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(He.pixelRatio!==s.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),$e){const Ar=$e.toString();at=c.get(Ar)}}be=be||!(!Ae.icon||!Ae.icon.hasSecondary());const kt=RT(st.horizontal)||st.vertical;s.iconsInText||(s.iconsInText=!!kt&&kt.iconsInText);const St=Ke*D.textScaleFactor/vs,{defaultShapedIcon:wr,verticallyShapedIcon:At}=V5(s,ht,C,Ae,p,st,St,mt,Vt);Vt!=="none"&&ht&&(tP(ht)||rP(ht))&&(rx(0,He,ut,ht,wr,Vt,T,c,u),rx(0,at,$e,ht,wr,Vt,T,c,u),At&&(rx(0,He,ut,ht,At,Vt,T,c,u),rx(0,at,$e,ht,At,Vt,T,c,u))),ht=wr;const{iconBBox:ir,iconVerticalBBox:Er}=B5(s,ht,At,C,Ae,p,tt,mt,D,u,it);Ee.push({feature:Ae,shapedTextOrientations:st,shapedText:kt,shapedIcon:ht,iconPrimary:ut,iconSecondary:$e,iconOffset:mt,iconAnchor:it,verticallyShapedIcon:At,layoutTextSize:Ke,layoutIconSize:tt,textOffset:rt,isSDFIcon:Lt,iconTextFit:Vt,iconCollisionBounds:ir,iconVerticalCollisionBounds:Er})}return{featureData:Ee,sizes:D,hasAnySecondaryIcon:be,textAlongLine:_e,symbolPlacement:ie}},o.fw=uP,o.fx=function(s,e,n,c,u,p,m,y,b,T){s.iconAtlasPositions=T.iconPositions;const{featureData:A,hasAnySecondaryIcon:C,sizes:P,textAlongLine:D,symbolPlacement:L}=e;for(const N of A){const{shapedIcon:V,verticallyShapedIcon:G,feature:X,shapedTextOrientations:Y,shapedText:ie,layoutTextSize:_e,textOffset:ue,isSDFIcon:be,iconPrimary:Ee,iconSecondary:Ae,iconTextFit:Ze,iconOffset:ze,iconCollisionBounds:Ke,iconVerticalCollisionBounds:tt}=N;yP(V,T.iconPositions,Ee,Ae),yP(G,T.iconPositions,Ee,Ae),j5(Y,T.iconPositions),N5(Ee,Ae,T.iconPositions),(ie||V)&&U5(s,X,Y,V,G,b,P,_e,0,ue,be,c,u,m,y,C,Ze,ze,D,L,Ke,tt)}n&&s.generateCollisionDebugBuffers(p,s.collisionBoxArray,P.textScaleFactor)},o.fy=$t,o.fz=yx,o.g=function(s,e){return td(Object.assign(s,{method:"GET"}),e)},o.h=function(s){return s.indexOf("mapbox:")===0},o.i=function(s){return Wi.API_STYLE_REGEX.test(s)&&!Gs(s)},o.j=qn,o.k=Cf,o.l=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(s,e){return td(Object.assign(s,{type:"json"}),e)},o.n=fg,o.o=wo,o.p=function(s,e){return td(Object.assign(s,{method:"POST"}),e)},o.q=Ds,o.r=xo,o.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return rT||(rT=new $d),rT},o.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},o.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},o.w=or,o.x=qT,o.y=ld,o.z=Fo}),v(["./shared"],function(o){function O(De){const H=De?De.url.toString():void 0;return H?performance.getEntriesByName(H):[]}function F(De){if(typeof De=="number"||typeof De=="boolean"||typeof De=="string"||De==null)return JSON.stringify(De);if(Array.isArray(De)){let W="[";for(const le of De)W+=`${F(le)},`;return`${W}]`}let H="{";for(const W of Object.keys(De).sort())H+=`${W}:${F(De[W])},`;return`${H}}`}function $(De){let H="";for(const W of o.bw)H+=`/${F(De[W])}`;return H}class Q{constructor(H){this.keyCache={},this._layers={},this._layerConfigs={},H&&this.replace(H)}replace(H,W){this._layerConfigs={},this._layers={},this.update(H,[],W)}update(H,W,le){this._options=le;for(const Te of H)this._layerConfigs[Te.id]=Te,(this._layers[Te.id]=o.dt(Te,this.scope,null,this._options)).compileFilter(le),this.keyCache[Te.id]&&delete this.keyCache[Te.id];for(const Te of W)delete this.keyCache[Te],delete this._layerConfigs[Te],delete this._layers[Te];this.familiesBySource={};const Se=function(Te,Pe){const Ge={};for(let Ue=0;Ue<Te.length;Ue++){const gt=Te[Ue];let lt=Pe&&Pe[gt.id];lt||(gt.type==="symbol"?lt=gt.id:(lt=$(gt),gt.type==="line"&&gt.paint&&function vr(gr){return typeof gr=="string"&&gr==="line-progress"||(Array.isArray(gr)?gr.some(vr):!(!gr||typeof gr!="object")&&Object.values(gr).some(vr))}(gt.paint["line-width"])&&(lt+=`/${F(gt.paint["line-width"])}`))),Pe&&(Pe[gt.id]=lt);let Xt=Ge[lt];Xt||(Xt=Ge[lt]=[]),Xt.push(gt)}const Re=[];for(const Ue in Ge)Re.push(Ge[Ue]);return Re}(Object.values(this._layerConfigs),this.keyCache);for(const Te of Se){const Pe=Te.map(Xt=>this._layers[Xt.id]),Ge=Pe[0];if(Ge.visibility==="none")continue;const Re=Ge.source||"";let Ue=this.familiesBySource[Re];Ue||(Ue=this.familiesBySource[Re]={});const gt=Ge.sourceLayer||"_geojsonTileLayer";let lt=Ue[gt];lt||(lt=Ue[gt]=[]),lt.push(Pe)}}}const te=1*o.fk;class J{constructor(H){const W={},le=[];for(const Ge in H){const Re=H[Ge],Ue=W[Ge]={};for(const gt in Re.glyphs){const lt=Re.glyphs[+gt];if(!lt||lt.bitmap.width===0||lt.bitmap.height===0)continue;const Xt=lt.metrics.localGlyph?te:1,vr={x:0,y:0,w:lt.bitmap.width+2*Xt,h:lt.bitmap.height+2*Xt};le.push(vr),Ue[gt]=vr}}const{w:Se,h:Te}=o.G(le),Pe=new o.fj({width:Se||1,height:Te||1});for(const Ge in H){const Re=H[Ge];for(const Ue in Re.glyphs){const gt=Re.glyphs[+Ue];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const lt=W[Ge][Ue],Xt=gt.metrics.localGlyph?te:1;o.fj.copy(gt.bitmap,Pe,{x:0,y:0},{x:lt.x+Xt,y:lt.y+Xt},gt.bitmap)}}this.image=Pe,this.positions=W}}function we(De,H,W){De[H]?W&&(De[H].center=W):De[H]={floorIds:new Set,center:W||[0,0],floors:{}}}function se(De,H,W,le){for(const Se of H)we(De,Se),De[Se].floors[W]=le,De[Se].floorIds.add(W)}function me(De){return{id:De.properties.id.toString(),center:De.properties.center.toString().split(";").map(Number)}}function fe(De){return{id:De.properties.id.toString(),isDefault:!!De.properties.is_default&&De.properties.is_default,connections:De.properties.connected_floor_ids?new Set(De.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:De.properties.conflicted_floor_ids?new Set(De.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:De.properties.building_ids?new Set(De.properties.building_ids.toString().split(";")):new Set,name:De.properties.name.toString(),zIndex:De.properties.z_index}}function re(De,H){return H.every(W=>De.properties&&De.properties[W]!=null)}function de(De){return re(De,["type","id","name"])&&De.properties.type==="building"}function Oe(De){return re(De,["type","id","name","z_index"])&&De.properties.type==="floor"}o.fi(J,"GlyphAtlas");class Xe{constructor(H){this.tileID=new o.aP(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.lut=H.lut,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.scope=H.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.request&&H.request.collectResourceTiming,this.promoteId=H.promoteId,this.isSymbolTile=H.isSymbolTile,this.tileTransform=o.aY(H.tileID.canonical,H.projection),this.projection=H.projection,this.worldview=H.worldview,this.localizableLayerIds=H.localizableLayerIds,this.brightness=H.brightness,this.extraShadowCaster=!!H.extraShadowCaster,this.tessellationStep=H.tessellationStep,this.scaleFactor=H.scaleFactor,this.worldview=H.worldview,this.indoor=H.indoor}parse(H,W,le,Se,Te,Pe){this.status="parsing",this.data=H,this.collisionBoxArray=new o.b2;const Ge=new o.fl(Object.keys(H.layers).sort()),Re=new o.fm(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const Ue={},gt=new o.fn(256,256),lt={featureIndex:Re,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gt,availableImages:le,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const or=this.indoor.indoorState.activeFloorsVisible,zr=function(jr,Ai,mn){const Bn=function(Ei,Xr){if(!Ei)return o.w("No source layers defined in indoor specification"),Xr;if(Ei.size===0)return Xr;const qi=Ei.difference(Xr);for(const hn of qi)o.w(`Missing source layer required in indoor specification: ${hn}`);return Xr.intersection(Xr)}(Ai.sourceLayers,new Set(Object.keys(jr.layers))),Cn=Ai.indoorState,Sn=function(Ei,Xr,qi,hn){const Ri=new Set,Wi=new Set,qn=new Set,Gs=new Map,la={},Rc=es=>{const ca=Gs.get(es)||new Set;for(const to of Ri)if((Gs.get(to)||new Set).has(es)||ca.has(to))return!0;return!1};for(const es of Xr){const ca=Ei.layers[es];if(ca)for(let to=0;to<ca.length;to++){const ka=ca.feature(to);if(de(ka)){const{id:xo,center:wo}=me(ka);we(la,xo,wo),Ri.add(xo)}else if(Oe(ka)){const{id:xo,isDefault:wo,connections:If,conflicts:Jh,buildings:Qh,name:ed,zIndex:uo}=fe(ka);se(la,Qh,xo,{name:ed,zIndex:uo}),Gs.set(xo,Jh),(xo===hn||If.has(hn))&&Ri.add(xo),Wi.add(xo),wo&&qn.add(xo)}}else o.w(`indoor source layer not found: ${es}`)}if(qi)for(const es of qi)Wi.has(es)&&(Rc(es)||Ri.add(es));for(const es of qn)Ri.has(es)||Rc(es)||Ri.add(es);return{buildings:la,activeFloors:Ri}}(jr,Bn,Cn.lastActiveFloors,Cn.selectedFloorId);return mn.send("setIndoorData",Sn),Sn}(H,this.indoor,Te);lt.activeFloors=or?zr.activeFloors:void 0}const Xt=[],vr=W.familiesBySource[this.source];for(const or in vr){const zr=H.layers[or];if(!zr)continue;let jr=!1,Ai=!1,mn=!1;for(const Ei of vr[or])Ei[0].type==="symbol"?jr=!0:Ai=!0,Ei[0].is3D()&&Ei[0].type!=="model"&&(mn=!0);if(this.extraShadowCaster&&!mn||this.isSymbolTile===!0&&!jr||this.isSymbolTile===!1&&!Ai)continue;zr.version===1&&o.w(`Vector tile source "${this.source}" layer "${or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bn=Ge.encode(or),Cn=[];let Sn=!1;for(let Ei=0,Xr=0;Ei<zr.length;Ei++){const qi=zr.feature(Ei),hn=Re.getId(qi,or);if(this.localizableLayerIds&&this.localizableLayerIds.has(or)){const Ri=qi.properties?qi.properties.worldview:null;if(this.worldview&&typeof Ri=="string")if(Ri==="all")qi.properties.$localized=!0;else{if(!Ri.split(",").includes(this.worldview))continue;qi.properties.$localized=!0,qi.properties.worldview=this.worldview}}!Sn&&qi.properties&&qi.properties.hasOwnProperty(o.fo)&&(Sn=!0),Cn.push({feature:qi,id:hn,index:Xr,sourceLayerIndex:Bn}),Xr++}Sn&&!lt.elevationFeatures&&H.layers.hasOwnProperty(o.fp)&&(lt.elevationFeatures=o.fq.parseFrom(H.layers[o.fp],this.canonical));for(const Ei of vr[or]){const Xr=Ei[0];if(this.extraShadowCaster&&(!Xr.is3D()||Xr.type==="model")||this.isSymbolTile!==void 0&&Xr.type==="symbol"!==this.isSymbolTile||Xr.minzoom&&this.zoom<Math.floor(Xr.minzoom)||Xr.maxzoom&&this.zoom>=Xr.maxzoom||Xr.visibility==="none")continue;qe(Ei,this.zoom,lt.brightness,le,this.worldview);const qi=Ue[Xr.id]=Xr.createBucket({index:Re.bucketLayerIDs.length,layers:Ei,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Se,worldview:this.worldview});Re.bucketLayerIDs.push(Ei.map(Ri=>o.B(Ri.id,Ri.scope)));let hn=qi.prepare?qi.prepare():null;hn!=null?(hn=hn.then(()=>qi.populate(Cn,lt,this.tileID.canonical,this.tileTransform)),Xt.push(hn)):qi.populate(Cn,lt,this.tileID.canonical,this.tileTransform)}}const gr=()=>{let or,zr,jr,Ai,mn,Bn;gt.trim();const Cn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Sn=()=>{if(or)return this.status="done",Pe(or);if(this.extraShadowCaster)this.status="done",Pe(null,{buckets:Object.values(Ue).filter(Xr=>!Xr.isEmpty()),featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:lt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(zr&&jr&&Ai){const Xr=new J(zr),qi=new Map;for(const[Wi,qn]of jr.entries()){const{imagePosition:Gs}=o.ft(Wi,qn,o.fu);qi.set(Wi,Gs)}const hn={};for(const Wi in Ue){const qn=Ue[Wi];qn instanceof o.b3&&(qe(qn.layers,this.zoom,lt.brightness,le,this.worldview),hn[Wi]=o.fv(qn,zr,Xr.positions,jr,qi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,mn,this.worldview))}const Ri={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Te,jr,mn,()=>{Ri.iconsPending=!1,Ei(hn,Xr,Ri)}),this.rasterizeIfNeeded(Te,Ai,Bn,()=>{Ri.patternsPending=!1,Ei(hn,Xr,Ri)})}},Ei=(Xr,qi,hn,Ri)=>{if(hn.iconsPending||hn.patternsPending)return;const Wi=new o.fw(jr,Ai,this.lut);for(const qn in Ue){const Gs=Ue[qn];if(qn in Xr)o.fx(Gs,Xr[qn],this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,jr,Wi);else if(Gs.hasPattern&&(Gs instanceof o.b9||Gs instanceof o.ba||Gs instanceof o.e9)){qe(Gs.layers,this.zoom,lt.brightness,le,this.worldview);const la=Object.fromEntries(Wi.patternPositions);Gs.addFeatures(lt,this.tileID.canonical,la,le,this.tileTransform,this.brightness)}}this.status="done",Pe(null,{buckets:Object.values(Ue).filter(qn=>!qn.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qi.image,lineAtlas:gt,imageAtlas:Wi,brightness:lt.brightness})};if(!this.extraShadowCaster){const Xr=o.fr(lt.glyphDependencies,Ri=>Object.keys(Ri).map(Number));Object.keys(Xr).length?Te.send("getGlyphs",{uid:this.uid,stacks:Xr},(Ri,Wi)=>{or||(or=Ri,zr=Wi,Sn())},void 0,!1,Cn):zr={};const qi=Array.from(lt.iconDependencies.keys()).map(Ri=>o.I.parse(Ri));qi.length?Te.send("getImages",{images:qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ri,Wi)=>{or||(or=Ri,jr=new Map,mn=this.updateImageMapAndGetImageTaskQueue(jr,Wi,lt.iconDependencies),Sn())},void 0,!1,Cn):(jr=new Map,mn=new Map);const hn=Array.from(lt.patternDependencies.keys()).map(Ri=>o.I.parse(Ri));hn.length?Te.send("getImages",{images:hn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ri,Wi)=>{or||(or=Ri,Ai=new Map,Bn=this.updateImageMapAndGetImageTaskQueue(Ai,Wi,lt.patternDependencies),Sn())},void 0,!1,Cn):(Ai=new Map,Bn=new Map)}if(lt.elevationFeatures&&lt.elevationFeatures.length>0){const Xr=[];for(const hn of Object.values(Ue))if(hn instanceof o.ba){const Ri=hn.getUnevaluatedPortalGraph();Ri&&Xr.push(Ri)}const qi=o.fs.evaluate(Xr);for(const hn of Object.values(Ue))if(hn instanceof o.ba){const Ri=H.layers[Ge.decode(hn.sourceLayerIndex)];hn.setEvaluatedPortalGraph(qi,Ri,this.tileID.canonical,lt.availableImages,lt.brightness)}}Sn()};Xt.length>0?Promise.allSettled(Xt).then(gr).catch(Pe):gr()}updateParameters(H){this.scaleFactor=H.scaleFactor,this.showCollisionBoxes=H.showCollisionBoxes,this.projection=H.projection,this.brightness=H.brightness,this.tileTransform=o.aY(H.tileID.canonical,H.projection),this.extraShadowCaster=H.extraShadowCaster,this.lut=H.lut,this.worldview=H.worldview,this.indoor=H.indoor}rasterizeIfNeeded(H,W,le,Se){Array.from(W.values()).some(Te=>Te.usvg)?this.rasterize(H,W,le,Se):Se()}updateImageMapAndGetImageTaskQueue(H,W,le){const Se=new Map;for(const Te of W.keys()){const Pe=le.get(Te)||[];for(const Ge of Pe){const Re=Ge.toString(),Ue=W.get(Ge.id.toString());Ue.usvg?Se.has(Re)||(Se.set(Re,Ge),H.set(Re,Object.assign({},Ue))):H.set(Re,Ue)}}return Se}rasterize(H,W,le,Se){this.rasterizeTask=H.send("rasterizeImages",{scope:this.scope,tasks:le},(Te,Pe)=>{if(!Te)for(const[Ge,Re]of Pe.entries()){const Ue=Object.assign(W.get(Ge),{data:Re});W.set(Ge,Ue)}Se()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function qe(De,H,W,le,Se){const Te=new o.ac(H,{brightness:W,worldview:Se});for(const Pe of De)Pe.recalculate(Te,le)}class Be extends o.E{constructor(H,W,le,Se,Te,Pe,Ge){super(),this.actor=H,this.layerIndex=W,this.availableImages=le,this.availableModels=Se,this.loadVectorData=Pe||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(H.scheduler),this.isSpriteLoaded=Te,this.scheduler=H.scheduler,this.brightness=Ge}loadTile(H,W){const le=H.uid,Se=H&&H.request,Te=Se&&Se.collectResourceTiming,Pe=this.loading[le]=new Xe(H);Pe.abort=this.loadVectorData(H,(Ge,Re)=>{const Ue=!this.loading[le];if(delete this.loading[le],Pe.cancelRasterize(),Ue||Ge||!Re)return Pe.status="done",Ue||(this.loaded[le]=Pe),W(Ge);const gt=Re.rawData,lt={},Xt=o.aM(Re.responseHeaders);Xt&&Xt.expires&&(lt.expires=Xt.expires),Xt&&Xt.cacheControl&&(lt.cacheControl=Xt.cacheControl),Pe.vectorTile=Re.vectorTile||new o.fy(new o.bs(gt));const vr=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(gr,or)=>{if(gr||!or)return W(gr);const zr={};if(Te){const jr=O(Se);jr.length>0&&(zr.resourceTiming=JSON.parse(JSON.stringify(jr)))}W(null,Object.assign({rawTileData:gt.slice(0),responseHeaders:Re.responseHeaders},or,lt,zr))})};this.isSpriteLoaded?vr():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(vr,{type:"parseTile",isSymbolTile:H.isSymbolTile,zoom:H.tileZoom}):vr()}),this.loaded=this.loaded||{},this.loaded[le]=Pe})}reloadTile(H,W){const le=this.loaded,Se=H.uid;if(le&&le[Se]){const Te=le[Se];Te.updateParameters(H);const Pe=(Ge,Re)=>{const Ue=Te.reloadCallback;Ue&&(delete Te.reloadCallback,Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ue)),W(Ge,Re)};Te.status==="parsing"?Te.reloadCallback=Pe:Te.status==="done"&&(Te.vectorTile?Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Pe):Pe())}else W(null,void 0)}abortTile(H,W){const le=H.uid,Se=this.loading[le];Se&&(Se.abort&&Se.abort(),delete this.loading[le]),W()}removeTile(H,W){const le=this.loaded,Se=H.uid;le&&le[Se]&&delete le[Se],W()}}class bt{loadTile(H,W){const{uid:le,encoding:Se,rawImageData:Te,padding:Pe}=H,Ge=ImageBitmap&&Te instanceof ImageBitmap?this.getImageData(Te,Pe):Te;W(null,new o.fz(le,Ge,Se,Pe<1))}reloadTile(H,W){W(null,null)}abortTile(H,W){W()}removeTile(H,W){W()}getImageData(H,W){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const le=this.offscreenCanvasContext.getImageData(-W,-W,H.width+2*W,H.height+2*W);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}o.br.setPbf(o.bs);class Bt{constructor(H){this._mrt=new o.br(H.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=H.uid,this.tileID=H.tileID,this.source=H.source}parse(H,W){const le=this._mrt;this.status="parsing",this._entireBuffer=H;try{le.parseHeader(H),this._isHeaderLoaded=!0;const Se=[];for(const Te in le.layers){const Pe=le.getLayer(Te),Ge=Pe.getDataRange(Pe.getBandList()),Re=le.createDecodingTask(Ge),Ue=H.slice(Ge.firstByte,Ge.lastByte+1),gt=o.br.performDecoding(Ue,Re).then(lt=>Re.complete(null,lt)).catch(lt=>Re.complete(lt,null));Se.push(gt)}Promise.allSettled(Se).then(()=>W(null,le)).catch(Te=>W(Te))}catch(Se){W(Se)}}}class Jt{constructor(H){this.actor=H,this.loading={},this.loaded={}}loadTile(H,W){const le=H.uid,Se=H.request,Te=this.loading[le]=new Bt(H),{cancel:Pe}=o.bt(Se,(Ge,Re,Ue)=>{const gt=!this.loading[le];if(delete this.loading[le],gt||Ge||!Re)return Te.status="done",gt||(this.loaded[le]=Te),W(Ge);Te.parse(Re,(lt,Xt)=>{if(lt||!Xt)return W(lt);W(null,Xt,Ue)}),this.loaded[le]=Te});Te.abort=Pe}reloadTile(H,W){W(null,void 0)}abortTile(H,W){const le=H.uid,Se=this.loading[le];Se&&(Se.abort&&Se.abort(),delete this.loading[le]),W()}removeTile(H,W){const le=H.uid;this.loaded[le]&&delete this.loaded[le],W()}decodeRasterArray(H,W){o.br.performDecoding(H.buffer,H.task).then(le=>W(null,le)).catch(le=>W(le))}}const nr=o.fA.prototype.toGeoJSON;class Gt{constructor(H){this._feature=H,this.extent=o.al,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){const H=[];for(const W of this._feature.geometry)H.push([new o.P(W[0],W[1])]);return H}{const H=[];for(const W of this._feature.geometry){const le=[];for(const Se of W)le.push(new o.P(Se[0],Se[1]));H.push(le)}return H}}toGeoJSON(H,W,le){return nr.call(this,H,W,le)}}class Mt{constructor(H,W){this.name=H,this.extent=o.al,this.length=W.length,this._jsonFeatures=W}feature(H){return new Gt(this._jsonFeatures[H])}}class Zt{constructor(H){this.layers={},this.extent=o.al;for(const W of Object.keys(H))this.layers[W]=new Mt(W,H[W])}}const mr=64/4096,Qt=128;class er{constructor(){this.features=new Map}clear(){this.features.clear()}load(H=[],W){for(const le of H){const Se=le.id;if(Se==null)continue;let Te=this.features.get(Se);Te&&this.updateCache(Te,W),le.geometry?(Te=It(le),this.updateCache(Te,W),this.features.set(Se,Te)):this.features.delete(Se),this.updateCache(Te,W)}}updateCache(H,W){for(const{canonical:le,uid:Se}of Object.values(W)){const{z:Te,x:Pe,y:Ge}=le;dt(H,Math.pow(2,Te),Pe,Ge)&&delete W[Se]}}getTile(H,W,le){const Se=Math.pow(2,H),Te=[];for(const Pe of this.features.values())dt(Pe,Se,W,le)&&Te.push(Sr(Pe,Se,W,le));return{features:Te}}getFeatures(){return[...this.features.values()]}}function dt({minX:De,minY:H,maxX:W,maxY:le},Se,Te,Pe){return De<(Te+1+mr)/Se&&H<(Pe+1+mr)/Se&&W>(Te-mr)/Se&&le>(Pe-mr)/Se}function It(De){const{id:H,geometry:W,properties:le}=De;if(!W)return;if(W.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Se,coordinates:Te}=W,Pe={id:H,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Pe.geometry;if(Se==="Point")tr(Te,Ge,Pe);else if(Se==="MultiPoint")for(const Re of Te)tr(Re,Ge,Pe);else if(Se==="LineString")Pe.type=2,Gr(Te,Ge,Pe);else if(Se==="MultiLineString")Pe.type=2,Rr(Te,Ge,Pe);else if(Se==="Polygon")Pe.type=3,Rr(Te,Ge,Pe,!0);else{if(Se!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const Re of Te)Rr(Re,Ge,Pe,!0)}return Pe}function tr([De,H],W,le){const Se=o.aF(De);let Te=o.aJ(H);Te=Te<0?0:Te>1?1:Te,W.push(Se,Te),le.minX=Math.min(le.minX,Se),le.minY=Math.min(le.minY,Te),le.maxX=Math.max(le.maxX,Se),le.maxY=Math.max(le.maxY,Te)}function Gr(De,H,W,le=!1,Se=!1){const Te=[];for(const Pe of De)tr(Pe,Te,W);H.push(Te),le&&function(Pe,Ge){let Re=0;for(let Ue=0,gt=Pe.length,lt=gt-2;Ue<gt;lt=Ue,Ue+=2)Re+=(Pe[Ue]-Pe[lt])*(Pe[Ue+1]+Pe[lt+1]);if(Re>0===Ge)for(let Ue=0,gt=Pe.length;Ue<gt/2;Ue+=2){const lt=Pe[Ue],Xt=Pe[Ue+1];Pe[Ue]=Pe[gt-2-Ue],Pe[Ue+1]=Pe[gt-1-Ue],Pe[gt-2-Ue]=lt,Pe[gt-1-Ue]=Xt}}(Te,Se)}function Rr(De,H,W,le=!1){for(let Se=0;Se<De.length;Se++)Gr(De[Se],H,W,le,Se===0)}function Sr(De,H,W,le){const{id:Se,type:Te,geometry:Pe,tags:Ge}=De,Re=[];if(Te===1)(function(Ue,gt,lt,Xt,vr){for(let gr=0;gr<Ue.length;gr+=2){const or=Math.round(o.al*(Ue[gr+0]*gt-lt)),zr=Math.round(o.al*(Ue[gr+1]*gt-Xt));vr.push([or,zr])}})(Pe,H,W,le,Re);else for(const Ue of Pe)ti(Ue,H,W,le,Re);return{id:Se,type:Te,geometry:Re,tags:Ge}}function ti(De,H,W,le,Se){const Te=-Qt,Pe=o.al+Qt;let Ge;for(let Re=0;Re<De.length-2;Re+=2){let Ue=Math.round(o.al*(De[Re+0]*H-W)),gt=Math.round(o.al*(De[Re+1]*H-le)),lt=Math.round(o.al*(De[Re+2]*H-W)),Xt=Math.round(o.al*(De[Re+3]*H-le));const vr=lt-Ue,gr=Xt-gt;Ue<Te&&lt<Te||(Ue<Te?(gt+=Math.round(gr*((Te-Ue)/vr)),Ue=Te):lt<Te&&(Xt=gt+Math.round(gr*((Te-Ue)/vr)),lt=Te),gt<Te&&Xt<Te||(gt<Te?(Ue+=Math.round(vr*((Te-gt)/gr)),gt=Te):Xt<Te&&(lt=Ue+Math.round(vr*((Te-gt)/gr)),Xt=Te),Ue>=Pe&&lt>=Pe||(Ue>=Pe?(gt+=Math.round(gr*((Pe-Ue)/vr)),Ue=Pe):lt>=Pe&&(Xt=gt+Math.round(gr*((Pe-Ue)/vr)),lt=Pe),gt>=Pe&&Xt>=Pe||(gt>=Pe?(Ue+=Math.round(vr*((Pe-gt)/gr)),gt=Pe):Xt>=Pe&&(lt=Ue+Math.round(vr*((Pe-gt)/gr)),Xt=Pe),Ge&&Ue===Ge[Ge.length-1][0]&&gt===Ge[Ge.length-1][1]||(Ge=[[Ue,gt]],Se.push(Ge)),Ge.push([lt,Xt])))))}}function Vi({name:De,features:H},W){W.writeStringField(1,De),W.writeVarintField(5,o.al);const le=new Map,Se=new Map,Te={keys:le,values:Se,feature:null};for(const Pe of H)Te.feature=Pe,W.writeMessage(2,On,Te);for(const Pe of le.keys())W.writeStringField(3,Pe);for(const Pe of Se.keys())W.writeMessage(4,Qi,Pe)}function On(De,H){const W=De.feature;W.id!==void 0&&Number.isSafeInteger(+W.id)&&H.writeVarintField(1,+W.id),W.tags&&H.writeMessage(2,wi,De),H.writeVarintField(3,W.type),H.writeMessage(4,Pi,W)}function wi({keys:De,values:H,feature:W},le){for(const Se of Object.keys(W.tags)){let Te=W.tags[Se];if(Te===null)continue;let Pe=De.get(Se);Pe===void 0&&(Pe=De.size,De.set(Se,Pe)),le.writeVarint(Pe);const Ge=typeof Te;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(Te=JSON.stringify(Te));let Re=H.get(Te);Re===void 0&&(Re=H.size,H.set(Te,Re)),le.writeVarint(Re)}}function Vn(De,H){return(H<<3)+(7&De)}function Hr(De){return De<<1^De>>31}function Pi(De,H){const{geometry:W,type:le}=De;let Se=0,Te=0;if(le===1){H.writeVarint(Vn(1,W.length));for(const Pe of W){const Ge=Pe[0]-Se,Re=Pe[1]-Te;H.writeVarint(Hr(Ge)),H.writeVarint(Hr(Re)),Se+=Ge,Te+=Re}}else for(const Pe of W){H.writeVarint(Vn(1,1));const Ge=Pe.length-(le===3?1:0);for(let Re=0;Re<Ge;Re++){Re===1&&H.writeVarint(Vn(2,Ge-1));const Ue=Pe[Re][0]-Se,gt=Pe[Re][1]-Te;H.writeVarint(Hr(Ue)),H.writeVarint(Hr(gt)),Se+=Ue,Te+=gt}le===3&&H.writeVarint(Vn(7,1))}}function Qi(De,H){const W=typeof De;W==="string"?H.writeStringField(1,De):W==="boolean"?H.writeBooleanField(7,De):W==="number"&&(De%1!=0?H.writeDoubleField(3,De):De<0?H.writeSVarintField(6,De):H.writeVarintField(5,De))}const Fn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},bi=Math.fround||(ns=new Float32Array(1),De=>(ns[0]=+De,ns[0]));var ns;const ss=3,Qn=5,Ss=6;class Gi{constructor(H){this.options=Object.assign(Object.create(Fn),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:W,minZoom:le,maxZoom:Se}=this.options;W&&console.time("total time");const Te=`prepare ${H.length} points`;W&&console.time(Te),this.points=H;const Pe=[];for(let Re=0;Re<H.length;Re++){const Ue=H[Re];if(!Ue.geometry)continue;const[gt,lt]=Ue.geometry.coordinates,Xt=bi(ct(gt)),vr=bi(Ct(lt));Pe.push(Xt,vr,1/0,Re,-1,1),this.options.reduce&&Pe.push(0)}let Ge=this.trees[Se+1]=this._createTree(Pe);W&&console.timeEnd(Te);for(let Re=Se;Re>=le;Re--){const Ue=+Date.now();Ge=this.trees[Re]=this._createTree(this._cluster(Ge,Re)),W&&console.log("z%d: %d clusters in %dms",Re,Ge.numItems,+Date.now()-Ue)}return W&&console.timeEnd("total time"),this}getClusters(H,W){let le=((H[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,H[1]));let Te=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)le=-180,Te=180;else if(le>Te){const lt=this.getClusters([le,Se,180,Pe],W),Xt=this.getClusters([-180,Se,Te,Pe],W);return lt.concat(Xt)}const Ge=this.trees[this._limitZoom(W)],Re=Ge.range(ct(le),Ct(Pe),ct(Te),Ct(Se)),Ue=Ge.data,gt=[];for(const lt of Re){const Xt=this.stride*lt;gt.push(Ue[Xt+Qn]>1?Js(Ue,Xt,this.clusterProps):this.points[Ue[Xt+ss]])}return gt}getChildren(H){const W=this._getOriginId(H),le=this._getOriginZoom(H),Se="No cluster with the specified id.",Te=this.trees[le];if(!Te)throw new Error(Se);const Pe=Te.data;if(W*this.stride>=Pe.length)throw new Error(Se);const Ge=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Re=Te.within(Pe[W*this.stride],Pe[W*this.stride+1],Ge),Ue=[];for(const gt of Re){const lt=gt*this.stride;Pe[lt+4]===H&&Ue.push(Pe[lt+Qn]>1?Js(Pe,lt,this.clusterProps):this.points[Pe[lt+ss]])}if(Ue.length===0)throw new Error(Se);return Ue}getLeaves(H,W,le){const Se=[];return this._appendLeaves(Se,H,W=W||10,le=le||0,0),Se}getTile(H,W,le){const Se=this.trees[this._limitZoom(H)],Te=Math.pow(2,H),{extent:Pe,radius:Ge}=this.options,Re=Ge/Pe,Ue=(le-Re)/Te,gt=(le+1+Re)/Te,lt={features:[]};return this._addTileFeatures(Se.range((W-Re)/Te,Ue,(W+1+Re)/Te,gt),Se.data,W,le,Te,lt),W===0&&this._addTileFeatures(Se.range(1-Re/Te,Ue,1,gt),Se.data,Te,le,Te,lt),W===Te-1&&this._addTileFeatures(Se.range(0,Ue,Re/Te,gt),Se.data,-1,le,Te,lt),lt.features.length?lt:null}getClusterExpansionZoom(H){let W=this._getOriginZoom(H)-1;for(;W<=this.options.maxZoom;){const le=this.getChildren(H);if(W++,le.length!==1)break;H=le[0].properties.cluster_id}return W}_appendLeaves(H,W,le,Se,Te){const Pe=this.getChildren(W);for(const Ge of Pe){const Re=Ge.properties;if(Re&&Re.cluster?Te+Re.point_count<=Se?Te+=Re.point_count:Te=this._appendLeaves(H,Re.cluster_id,le,Se,Te):Te<Se?Te++:H.push(Ge),H.length===le)break}return Te}_createTree(H){const W=new o.c3(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<H.length;le+=this.stride)W.add(H[le],H[le+1]);return W.finish(),W.data=H,W}_addTileFeatures(H,W,le,Se,Te,Pe){for(const Ge of H){const Re=Ge*this.stride,Ue=W[Re+Qn]>1;let gt,lt,Xt;if(Ue)gt=Ve(W,Re,this.clusterProps),lt=W[Re],Xt=W[Re+1];else{const or=this.points[W[Re+ss]];gt=or.properties;const[zr,jr]=or.geometry.coordinates;lt=ct(zr),Xt=Ct(jr)}const vr={type:1,geometry:[[Math.round(this.options.extent*(lt*Te-le)),Math.round(this.options.extent*(Xt*Te-Se))]],tags:gt};let gr;gr=Ue||this.options.generateId?W[Re+ss]:this.points[W[Re+ss]].id,gr!==void 0&&(vr.id=gr),Pe.features.push(vr)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,W){const{radius:le,extent:Se,reduce:Te,minPoints:Pe}=this.options,Ge=le/(Se*Math.pow(2,W)),Re=H.data,Ue=[],gt=this.stride;for(let lt=0;lt<Re.length;lt+=gt){if(Re[lt+2]<=W)continue;Re[lt+2]=W;const Xt=Re[lt],vr=Re[lt+1],gr=H.within(Re[lt],Re[lt+1],Ge),or=Re[lt+Qn];let zr=or;for(const jr of gr){const Ai=jr*gt;Re[Ai+2]>W&&(zr+=Re[Ai+Qn])}if(zr>or&&zr>=Pe){let jr,Ai=Xt*or,mn=vr*or,Bn=-1;const Cn=(lt/gt<<5)+(W+1)+this.points.length;for(const Sn of gr){const Ei=Sn*gt;if(Re[Ei+2]<=W)continue;Re[Ei+2]=W;const Xr=Re[Ei+Qn];Ai+=Re[Ei]*Xr,mn+=Re[Ei+1]*Xr,Re[Ei+4]=Cn,Te&&(jr||(jr=this._map(Re,lt,!0),Bn=this.clusterProps.length,this.clusterProps.push(jr)),Te(jr,this._map(Re,Ei)))}Re[lt+4]=Cn,Ue.push(Ai/zr,mn/zr,1/0,Cn,-1,zr),Te&&Ue.push(Bn)}else{for(let jr=0;jr<gt;jr++)Ue.push(Re[lt+jr]);if(zr>1)for(const jr of gr){const Ai=jr*gt;if(!(Re[Ai+2]<=W)){Re[Ai+2]=W;for(let mn=0;mn<gt;mn++)Ue.push(Re[Ai+mn])}}}}return Ue}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,W,le){if(H[W+Qn]>1){const Pe=this.clusterProps[H[W+Ss]];return le?Object.assign({},Pe):Pe}const Se=this.points[H[W+ss]].properties,Te=this.options.map(Se);return le&&Te===Se?Object.assign({},Te):Te}}function Js(De,H,W){return{type:"Feature",id:De[H+ss],properties:Ve(De,H,W),geometry:{type:"Point",coordinates:[(le=De[H],360*(le-.5)),cr(De[H+1])]}};var le}function Ve(De,H,W){const le=De[H+Qn],Se=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,Te=De[H+Ss],Pe=Te===-1?{}:Object.assign({},W[Te]);return Object.assign(Pe,{cluster:!0,cluster_id:De[H+ss],point_count:le,point_count_abbreviated:Se})}function ct(De){return De/360+.5}function Ct(De){const H=Math.sin(De*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function cr(De){const H=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function Nt(De,H,W,le){let Se=le;const Te=H+(W-H>>1);let Pe,Ge=W-H;const Re=De[H],Ue=De[H+1],gt=De[W],lt=De[W+1];for(let Xt=H+3;Xt<W;Xt+=3){const vr=rr(De[Xt],De[Xt+1],Re,Ue,gt,lt);if(vr>Se)Pe=Xt,Se=vr;else if(vr===Se){const gr=Math.abs(Xt-Te);gr<Ge&&(Pe=Xt,Ge=gr)}}Se>le&&(Pe-H>3&&Nt(De,H,Pe,le),De[Pe+2]=Se,W-Pe>3&&Nt(De,Pe,W,le))}function rr(De,H,W,le,Se,Te){let Pe=Se-W,Ge=Te-le;if(Pe!==0||Ge!==0){const Re=((De-W)*Pe+(H-le)*Ge)/(Pe*Pe+Ge*Ge);Re>1?(W=Se,le=Te):Re>0&&(W+=Pe*Re,le+=Ge*Re)}return Pe=De-W,Ge=H-le,Pe*Pe+Ge*Ge}function br(De,H,W,le){const Se={id:De??null,type:H,geometry:W,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")_i(Se,W);else if(H==="Polygon")_i(Se,W[0]);else if(H==="MultiLineString")for(const Te of W)_i(Se,Te);else if(H==="MultiPolygon")for(const Te of W)_i(Se,Te[0]);return Se}function _i(De,H){for(let W=0;W<H.length;W+=3)De.minX=Math.min(De.minX,H[W]),De.minY=Math.min(De.minY,H[W+1]),De.maxX=Math.max(De.maxX,H[W]),De.maxY=Math.max(De.maxY,H[W+1])}function Hi(De,H,W,le){if(!H.geometry)return;const Se=H.geometry.coordinates;if(Se&&Se.length===0)return;const Te=H.geometry.type,Pe=Math.pow(W.tolerance/((1<<W.maxZoom)*W.extent),2);let Ge=[],Re=H.id;if(W.promoteId?Re=H.properties[W.promoteId]:W.generateId&&(Re=le||0),Te==="Point")xn(Se,Ge);else if(Te==="MultiPoint")for(const Ue of Se)xn(Ue,Ge);else if(Te==="LineString")js(Se,Ge,Pe,!1);else if(Te==="MultiLineString"){if(W.lineMetrics){for(const Ue of Se)Ge=[],js(Ue,Ge,Pe,!1),De.push(br(Re,"LineString",Ge,H.properties));return}os(Se,Ge,Pe,!1)}else if(Te==="Polygon")os(Se,Ge,Pe,!0);else{if(Te!=="MultiPolygon"){if(Te==="GeometryCollection"){for(const Ue of H.geometry.geometries)Hi(De,{id:Re,geometry:Ue,properties:H.properties},W,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ue of Se){const gt=[];os(Ue,gt,Pe,!0),Ge.push(gt)}}De.push(br(Re,Te,Ge,H.properties))}function xn(De,H){H.push(Pa(De[0]),vo(De[1]),0)}function js(De,H,W,le){let Se,Te,Pe=0;for(let Re=0;Re<De.length;Re++){const Ue=Pa(De[Re][0]),gt=vo(De[Re][1]);H.push(Ue,gt,0),Re>0&&(Pe+=le?(Se*gt-Ue*Te)/2:Math.sqrt(Math.pow(Ue-Se,2)+Math.pow(gt-Te,2))),Se=Ue,Te=gt}const Ge=H.length-3;H[2]=1,Nt(H,0,Ge,W),H[Ge+2]=1,H.size=Math.abs(Pe),H.start=0,H.end=H.size}function os(De,H,W,le){for(let Se=0;Se<De.length;Se++){const Te=[];js(De[Se],Te,W,le),H.push(Te)}}function Pa(De){return De/360+.5}function vo(De){const H=Math.sin(De*Math.PI/180),W=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return W<0?0:W>1?1:W}function en(De,H,W,le,Se,Te,Pe,Ge){if(le/=H,Te>=(W/=H)&&Pe<le)return De;if(Pe<W||Te>=le)return null;const Re=[];for(const Ue of De){const gt=Ue.geometry;let lt=Ue.type;const Xt=Se===0?Ue.minX:Ue.minY,vr=Se===0?Ue.maxX:Ue.maxY;if(Xt>=W&&vr<le){Re.push(Ue);continue}if(vr<W||Xt>=le)continue;let gr=[];if(lt==="Point"||lt==="MultiPoint")aa(gt,gr,W,le,Se);else if(lt==="LineString")Qs(gt,gr,W,le,Se,!1,Ge.lineMetrics);else if(lt==="MultiLineString")eo(gt,gr,W,le,Se,!1);else if(lt==="Polygon")eo(gt,gr,W,le,Se,!0);else if(lt==="MultiPolygon")for(const or of gt){const zr=[];eo(or,zr,W,le,Se,!0),zr.length&&gr.push(zr)}if(gr.length){if(Ge.lineMetrics&&lt==="LineString"){for(const or of gr)Re.push(br(Ue.id,lt,or,Ue.tags));continue}lt!=="LineString"&&lt!=="MultiLineString"||(gr.length===1?(lt="LineString",gr=gr[0]):lt="MultiLineString"),lt!=="Point"&&lt!=="MultiPoint"||(lt=gr.length===3?"Point":"MultiPoint"),Re.push(br(Ue.id,lt,gr,Ue.tags))}}return Re.length?Re:null}function aa(De,H,W,le,Se){for(let Te=0;Te<De.length;Te+=3){const Pe=De[Te+Se];Pe>=W&&Pe<=le&&lo(H,De[Te],De[Te+1],De[Te+2])}}function Qs(De,H,W,le,Se,Te,Pe){let Ge=Do(De);const Re=Se===0?tn:ms;let Ue,gt,lt=De.start;for(let zr=0;zr<De.length-3;zr+=3){const jr=De[zr],Ai=De[zr+1],mn=De[zr+2],Bn=De[zr+3],Cn=De[zr+4],Sn=Se===0?jr:Ai,Ei=Se===0?Bn:Cn;let Xr=!1;Pe&&(Ue=Math.sqrt(Math.pow(jr-Bn,2)+Math.pow(Ai-Cn,2))),Sn<W?Ei>W&&(gt=Re(Ge,jr,Ai,Bn,Cn,W),Pe&&(Ge.start=lt+Ue*gt)):Sn>le?Ei<le&&(gt=Re(Ge,jr,Ai,Bn,Cn,le),Pe&&(Ge.start=lt+Ue*gt)):lo(Ge,jr,Ai,mn),Ei<W&&Sn>=W&&(gt=Re(Ge,jr,Ai,Bn,Cn,W),Xr=!0),Ei>le&&Sn<=le&&(gt=Re(Ge,jr,Ai,Bn,Cn,le),Xr=!0),!Te&&Xr&&(Pe&&(Ge.end=lt+Ue*gt),H.push(Ge),Ge=Do(De)),Pe&&(lt+=Ue)}let Xt=De.length-3;const vr=De[Xt],gr=De[Xt+1],or=Se===0?vr:gr;or>=W&&or<=le&&lo(Ge,vr,gr,De[Xt+2]),Xt=Ge.length-3,Te&&Xt>=3&&(Ge[Xt]!==Ge[0]||Ge[Xt+1]!==Ge[1])&&lo(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&H.push(Ge)}function Do(De){const H=[];return H.size=De.size,H.start=De.start,H.end=De.end,H}function eo(De,H,W,le,Se,Te){for(const Pe of De)Qs(Pe,H,W,le,Se,Te,!1)}function lo(De,H,W,le){De.push(H,W,le)}function tn(De,H,W,le,Se,Te){const Pe=(Te-H)/(le-H);return lo(De,Te,W+(Se-W)*Pe,1),Pe}function ms(De,H,W,le,Se,Te){const Pe=(Te-W)/(Se-W);return lo(De,H+(le-H)*Pe,Te,1),Pe}function Ra(De,H){const W=[];for(let le=0;le<De.length;le++){const Se=De[le],Te=Se.type;let Pe;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")Pe=Vs(Se.geometry,H);else if(Te==="MultiLineString"||Te==="Polygon"){Pe=[];for(const Ge of Se.geometry)Pe.push(Vs(Ge,H))}else if(Te==="MultiPolygon"){Pe=[];for(const Ge of Se.geometry){const Re=[];for(const Ue of Ge)Re.push(Vs(Ue,H));Pe.push(Re)}}W.push(br(Se.id,Te,Pe,Se.tags))}return W}function Vs(De,H){const W=[];W.size=De.size,De.start!==void 0&&(W.start=De.start,W.end=De.end);for(let le=0;le<De.length;le+=3)W.push(De[le]+H,De[le+1],De[le+2]);return W}function co(De,H){if(De.transformed)return De;const W=1<<De.z,le=De.x,Se=De.y;for(const Te of De.features){const Pe=Te.geometry,Ge=Te.type;if(Te.geometry=[],Ge===1)for(let Re=0;Re<Pe.length;Re+=2)Te.geometry.push(di(Pe[Re],Pe[Re+1],H,W,le,Se));else for(let Re=0;Re<Pe.length;Re++){const Ue=[];for(let gt=0;gt<Pe[Re].length;gt+=2)Ue.push(di(Pe[Re][gt],Pe[Re][gt+1],H,W,le,Se));Te.geometry.push(Ue)}}return De.transformed=!0,De}function di(De,H,W,le,Se,Te){return[Math.round(W*(De*le-Se)),Math.round(W*(H*le-Te))]}function sn(De,H,W,le,Se){const Te=H===Se.maxZoom?0:Se.tolerance/((1<<H)*Se.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:W,y:le,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of De)An(Pe,Ge,Te,Se);return Pe}function An(De,H,W,le){const Se=H.geometry,Te=H.type,Pe=[];if(De.minX=Math.min(De.minX,H.minX),De.minY=Math.min(De.minY,H.minY),De.maxX=Math.max(De.maxX,H.maxX),De.maxY=Math.max(De.maxY,H.maxY),Te==="Point"||Te==="MultiPoint")for(let Ge=0;Ge<Se.length;Ge+=3)Pe.push(Se[Ge],Se[Ge+1]),De.numPoints++,De.numSimplified++;else if(Te==="LineString")Rs(Pe,Se,De,W,!1,!1);else if(Te==="MultiLineString"||Te==="Polygon")for(let Ge=0;Ge<Se.length;Ge++)Rs(Pe,Se[Ge],De,W,Te==="Polygon",Ge===0);else if(Te==="MultiPolygon")for(let Ge=0;Ge<Se.length;Ge++){const Re=Se[Ge];for(let Ue=0;Ue<Re.length;Ue++)Rs(Pe,Re[Ue],De,W,!0,Ue===0)}if(Pe.length){let Ge=H.tags||null;if(Te==="LineString"&&le.lineMetrics){Ge={};for(const Ue in H.tags)Ge[Ue]=H.tags[Ue];Ge.mapbox_clip_start=Se.start/Se.size,Ge.mapbox_clip_end=Se.end/Se.size}const Re={geometry:Pe,type:Te==="Polygon"||Te==="MultiPolygon"?3:Te==="LineString"||Te==="MultiLineString"?2:1,tags:Ge};H.id!==null&&(Re.id=H.id),De.features.push(Re)}}function Rs(De,H,W,le,Se,Te){const Pe=le*le;if(le>0&&H.size<(Se?Pe:le))return void(W.numPoints+=H.length/3);const Ge=[];for(let Re=0;Re<H.length;Re+=3)(le===0||H[Re+2]>Pe)&&(W.numSimplified++,Ge.push(H[Re],H[Re+1])),W.numPoints++;Se&&function(Re,Ue){let gt=0;for(let lt=0,Xt=Re.length,vr=Xt-2;lt<Xt;vr=lt,lt+=2)gt+=(Re[lt]-Re[vr])*(Re[lt+1]+Re[vr+1]);if(gt>0===Ue)for(let lt=0,Xt=Re.length;lt<Xt/2;lt+=2){const vr=Re[lt],gr=Re[lt+1];Re[lt]=Re[Xt-2-lt],Re[lt+1]=Re[Xt-1-lt],Re[Xt-2-lt]=vr,Re[Xt-1-lt]=gr}}(Ge,Te),De.push(Ge)}const nt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ks{constructor(H,W){const le=(W=this.options=function(Te,Pe){for(const Ge in Pe)Te[Ge]=Pe[Ge];return Te}(Object.create(nt),W)).debug;if(le&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=function(Te,Pe){const Ge=[];if(Te.type==="FeatureCollection")for(let Re=0;Re<Te.features.length;Re++)Hi(Ge,Te.features[Re],Pe,Re);else Hi(Ge,Te.type==="Feature"?Te:{geometry:Te},Pe);return Ge}(H,W);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=function(Te,Pe){const Ge=Pe.buffer/Pe.extent;let Re=Te;const Ue=en(Te,1,-1-Ge,Ge,0,-1,2,Pe),gt=en(Te,1,1-Ge,2+Ge,0,-1,2,Pe);return(Ue||gt)&&(Re=en(Te,1,-Ge,1+Ge,0,-1,2,Pe)||[],Ue&&(Re=Ra(Ue,1).concat(Re)),gt&&(Re=Re.concat(Ra(gt,-1)))),Re}(Se,W),Se.length&&this.splitTile(Se,0,0,0),le&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,W,le,Se,Te,Pe,Ge){const Re=[H,W,le,Se],Ue=this.options,gt=Ue.debug;for(;Re.length;){Se=Re.pop(),le=Re.pop(),W=Re.pop(),H=Re.pop();const lt=1<<W,Xt=Lo(W,le,Se);let vr=this.tiles[Xt];if(!vr&&(gt>1&&console.time("creation"),vr=this.tiles[Xt]=sn(H,W,le,Se,Ue),this.tileCoords.push({z:W,x:le,y:Se}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,le,Se,vr.numFeatures,vr.numPoints,vr.numSimplified),console.timeEnd("creation"));const Xr=`z${W}`;this.stats[Xr]=(this.stats[Xr]||0)+1,this.total++}if(vr.source=H,Te==null){if(W===Ue.indexMaxZoom||vr.numPoints<=Ue.indexMaxPoints)continue}else{if(W===Ue.maxZoom||W===Te)continue;if(Te!=null){const Xr=Te-W;if(le!==Pe>>Xr||Se!==Ge>>Xr)continue}}if(vr.source=null,H.length===0)continue;gt>1&&console.time("clipping");const gr=.5*Ue.buffer/Ue.extent,or=.5-gr,zr=.5+gr,jr=1+gr;let Ai=null,mn=null,Bn=null,Cn=null,Sn=en(H,lt,le-gr,le+zr,0,vr.minX,vr.maxX,Ue),Ei=en(H,lt,le+or,le+jr,0,vr.minX,vr.maxX,Ue);H=null,Sn&&(Ai=en(Sn,lt,Se-gr,Se+zr,1,vr.minY,vr.maxY,Ue),mn=en(Sn,lt,Se+or,Se+jr,1,vr.minY,vr.maxY,Ue),Sn=null),Ei&&(Bn=en(Ei,lt,Se-gr,Se+zr,1,vr.minY,vr.maxY,Ue),Cn=en(Ei,lt,Se+or,Se+jr,1,vr.minY,vr.maxY,Ue),Ei=null),gt>1&&console.timeEnd("clipping"),Re.push(Ai||[],W+1,2*le,2*Se),Re.push(mn||[],W+1,2*le,2*Se+1),Re.push(Bn||[],W+1,2*le+1,2*Se),Re.push(Cn||[],W+1,2*le+1,2*Se+1)}}getTile(H,W,le){H=+H,W=+W,le=+le;const Se=this.options,{extent:Te,debug:Pe}=Se;if(H<0||H>24)return null;const Ge=1<<H,Re=Lo(H,W=W+Ge&Ge-1,le);if(this.tiles[Re])return co(this.tiles[Re],Te);Pe>1&&console.log("drilling down to z%d-%d-%d",H,W,le);let Ue,gt=H,lt=W,Xt=le;for(;!Ue&&gt>0;)gt--,lt>>=1,Xt>>=1,Ue=this.tiles[Lo(gt,lt,Xt)];return Ue&&Ue.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",gt,lt,Xt),console.time("drilling down")),this.splitTile(Ue.source,gt,lt,Xt,H,W,le),Pe>1&&console.timeEnd("drilling down"),this.tiles[Re]?co(this.tiles[Re],Te):null):null}}function Lo(De,H,W){return 32*((1<<De)*W+H)+De}function Us(De,H){const W=De.tileID.canonical;if(!this._geoJSONIndex)return void H(null,null);const le=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!le)return void H(null,null);const Se=Ue=>Ue.tags&&"3d_elevation_id"in Ue.tags&&"source"in Ue.tags&&Ue.tags.source==="elevation",Te=le.features.filter(Ue=>Se(Ue));let Pe={_geojsonTileLayer:le.features};Te.length>0&&(Pe={_geojsonTileLayer:le.features.filter(Ue=>!Se(Ue)),hd_road_elevation:Te});const Ge=new Zt(Pe),Re=function(Ue){const gt=new o.bs;for(const lt of Object.keys(Ue))gt.writeMessage(3,Vi,{name:lt,features:Ue[lt]});return gt.finish()}(Pe).buffer;H(null,{vectorTile:Ge,rawData:Re})}class Nr extends Be{constructor(H,W,le,Se,Te,Pe,Ge){super(H,W,le,Se,Te,Us,Ge),Pe&&(this.loadGeoJSON=Pe),this._dynamicIndex=new er}loadData(H,W){const le=H&&H.request,Se=le&&le.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(H,(Te,Pe)=>{if(Te||!Pe)return W(Te);if(typeof Pe!="object")return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{try{if(H.filter){const Re=o.U(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));Pe.features=Pe.features.filter(Ue=>Re.value.evaluate({zoom:0},Ue))}H.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),H.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),H.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=H.cluster?new Gi(function({superclusterOptions:Re,clusterProperties:Ue}){if(!Ue||!Re)return Re;const gt={},lt={},Xt={accumulated:null,zoom:0},vr={properties:null},gr=Object.keys(Ue);for(const or of gr){const[zr,jr]=Ue[or],Ai=o.U(jr),mn=o.U(typeof zr=="string"?[zr,["accumulated"],["get",or]]:zr);gt[or]=Ai.value,lt[or]=mn.value}return Re.map=or=>{vr.properties=or;const zr={};for(const jr of gr)zr[jr]=gt[jr].evaluate(Xt,vr);return zr},Re.reduce=(or,zr)=>{vr.properties=zr;for(const jr of gr)Xt.accumulated=or[jr],or[jr]=lt[jr].evaluate(Xt,vr)},Re}(H)).load(Pe.features):H.dynamic?this._dynamicIndex:function(Re,Ue){return new ks(Re,Ue)}(Pe,H.geojsonVtOptions)}catch(Re){return W(Re)}const Ge={};if(Se){const Re=O(le);Re&&(Ge.resourceTiming={},Ge.resourceTiming[H.source]=JSON.parse(JSON.stringify(Re)))}W(null,Ge)}})}reloadTile(H,W){const le=this.loaded;return le&&le[H.uid]?H.partial?W(null,void 0):super.reloadTile(H,W):this.loadTile(H,W)}loadGeoJSON(H,W){if(H.request)o.m(H.request,W);else{if(typeof H.data!="string")return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return W(null,JSON.parse(H.data))}catch{return W(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(H,W){try{W(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(le){W(le)}}getClusterChildren(H,W){try{W(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(le){W(le)}}getClusterLeaves(H,W){try{W(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(le){W(le)}}}class $s{constructor(H,W,le){this.tileID=new o.aP(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.tileZoom=H.tileZoom,this.uid=H.uid,this.zoom=H.zoom,this.canonical=H.tileID.canonical,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=H.projection,this.brightness=W,this.worldview=le}parse(H,W,le,Se){this.status="parsing";const Te=new o.aP(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Pe=[],Ge=W.familiesBySource[le.source],Re=new o.fm(Te,le.promoteId);Re.bucketLayerIDs=[],Re.is3DTile=!0,o.fB(H).then(Ue=>{if(!Ue)return Se(new Error("Could not parse tile"));const gt=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("MAPBOX_mesh_features")||Ue.json.asset.extras&&Ue.json.asset.extras.MAPBOX_mesh_features,lt=Ue.json.extensionsUsed&&Ue.json.extensionsUsed.includes("EXT_meshopt_compression"),Xt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const vr in Ge)for(const gr of Ge[vr]){const or=gr[0];Re.bucketLayerIDs.push(gr.map(Ai=>o.B(Ai.id,Ai.scope))),or.recalculate(Xt,[]);const zr=o.fC(Ue,1/o.d6(le.tileID.canonical)),jr=new o.fD(gr,zr,Te,gt,lt,this.brightness,Re,this.worldview);gt||(jr.needsUpload=!0),Pe.push(jr),jr.evaluate(or)}this.status="done",Se(null,{buckets:Pe,featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Ue=>Se(new Error(Ue.message)))}}class lg{constructor(H,W,le,Se,Te,Pe,Ge,Re){this.actor=H,this.layerIndex=W,this.availableImages=le,this.availableModels=Se,this.brightness=Ge,this.loading={},this.loaded={},this.worldview=Re}loadTile(H,W){const le=H.uid,Se=this.loading[le]=new $s(H,this.brightness,this.worldview);o.bt(H.request,(Te,Pe)=>{const Ge=!this.loading[le];return delete this.loading[le],Ge||Te?(Se.status="done",Ge||(this.loaded[le]=Se),W(Te)):Pe&&Pe.byteLength!==0?void Se.parse(Pe,this.layerIndex,H,(Re,Ue)=>{Se.status="done",this.loaded=this.loaded||{},this.loaded[le]=Se,Re||!Ue?W(Re):W(null,Ue)}):(Se.status="done",this.loaded[le]=Se,W())})}reloadTile(H,W){const le=this.loaded,Se=H.uid;if(le&&le[Se]){const Te=le[Se];Te.projection=H.projection,Te.brightness=H.brightness;const Pe=(Ge,Re)=>{Te.reloadCallback&&(delete Te.reloadCallback,this.loadTile(H,W)),W(Ge,Re)};Te.status==="parsing"?Te.reloadCallback=Pe:Te.status==="done"&&this.loadTile(H,W)}}abortTile(H,W){const le=H.uid;this.loading[le]&&delete this.loading[le],W()}removeTile(H,W){const le=this.loaded,Se=H.uid;le&&le[Se]&&delete le[Se],W()}}class Yh{constructor(H){this.self=H,this.actor=new o.fF(H,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cl({name:"mercator"}),this.workerSourceTypes={vector:Be,geojson:Nr,"raster-dem":bt,"raster-array":Jt,"batched-model":lg},this.workerSources={},this.self.registerWorkerSource=(W,le)=>{if(this.workerSourceTypes[W])throw new Error(`Worker source with name "${W}" already registered.`);this.workerSourceTypes[W]=le},this.self.registerRTLTextPlugin=W=>{if(o.fG.isParsed())throw new Error("RTL text plugin already registered.");o.fG.setState({pluginStatus:o.fH.parsed,pluginURL:o.fG.getPluginURL()}),o.fG.applyArabicShaping=W.applyArabicShaping,o.fG.processBidirectionalText=W.processBidirectionalText,o.fG.processStyledBidirectionalText=W.processStyledBidirectionalText;for(const le of this.rtlPluginParsingListeners)le(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(H,W,le){delete this.layerIndexes[H],delete this.availableImages[H],delete this.availableModels[H],delete this.workerSources[H],le()}checkIfReady(H,W,le){le()}setReferrer(H,W){this.referrer=W}spriteLoaded(H,W){this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={});const{scope:le,isLoaded:Se}=W;if(this.isSpriteLoaded[H][le]=Se,this.workerSources[H]&&this.workerSources[H][le])for(const Te in this.workerSources[H][le]){const Pe=this.workerSources[H][le][Te];for(const Ge in Pe){const Re=Pe[Ge];Re instanceof Be&&(Re.isSpriteLoaded=Se,Re.fire(new o.z("isSpriteLoaded")))}}}setImages(H,W,le){this.availableImages[H]||(this.availableImages[H]={});const{scope:Se,images:Te}=W;if(this.availableImages[H][Se]=Te,this.workerSources[H]&&this.workerSources[H][Se]){for(const Pe in this.workerSources[H][Se]){const Ge=this.workerSources[H][Se][Pe];for(const Re in Ge)Ge[Re].availableImages=Te}le()}else le()}setModels(H,{scope:W,models:le},Se){if(this.availableModels[H]||(this.availableModels[H]={}),this.availableModels[H][W]=le,this.workerSources[H]&&this.workerSources[H][W]){for(const Te in this.workerSources[H][W]){const Pe=this.workerSources[H][W][Te];for(const Ge in Pe)Pe[Ge].availableModels=le}Se()}else Se()}setProjection(H,W){this.projections[H]=o.cl(W)}setBrightness(H,W,le){this.brightness=W,le()}setWorldview(H,W,le){this.worldview=W,le()}setLayers(H,W,le){this.getLayerIndex(H,W.scope).replace(W.layers,W.options),le()}updateLayers(H,W,le){this.getLayerIndex(H,W.scope).update(W.layers,W.removedIds,W.options),le()}loadTile(H,W,le){W.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,W.type,W.source,W.scope).loadTile(W,le)}decodeRasterArray(H,W,le){this.getWorkerSource(H,W.type,W.source,W.scope).decodeRasterArray(W,le)}reloadTile(H,W,le){W.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,W.type,W.source,W.scope).reloadTile(W,le)}abortTile(H,W,le){this.getWorkerSource(H,W.type,W.source,W.scope).abortTile(W,le)}removeTile(H,W,le){this.getWorkerSource(H,W.type,W.source,W.scope).removeTile(W,le)}removeSource(H,W,le){if(!(this.workerSources[H]&&this.workerSources[H][W.scope]&&this.workerSources[H][W.scope][W.type]&&this.workerSources[H][W.scope][W.type][W.source]))return;const Se=this.workerSources[H][W.scope][W.type][W.source];delete this.workerSources[H][W.scope][W.type][W.source],Se.removeSource!==void 0?Se.removeSource(W,le):le()}loadWorkerSource(H,W,le){try{this.self.importScripts(W.url),le()}catch(Se){le(Se.toString())}}syncRTLPluginState(H,W,le){if(o.fG.isParsed())le(null,!0);else if(o.fG.isParsing())this.rtlPluginParsingListeners.push(le);else try{o.fG.setState(W);const Se=o.fG.getPluginURL();!o.fG.isLoaded()||o.fG.isParsed()||o.fG.isParsing()||Se==null||(o.fG.setState({pluginStatus:o.fH.parsing,pluginURL:o.fG.getPluginURL()}),this.self.importScripts(Se),o.fG.isParsed()?le(null,!0):this.rtlPluginParsingListeners.push(le))}catch(Se){le(Se.toString())}}setDracoUrl(H,W){this.dracoUrl=W}getAvailableImages(H,W){this.availableImages[H]||(this.availableImages[H]={});let le=this.availableImages[H][W];return le||(le=[]),le}getAvailableModels(H,W){this.availableModels[H]||(this.availableModels[H]={});let le=this.availableModels[H][W];return le||(le={}),le}getLayerIndex(H,W){this.layerIndexes[H]||(this.layerIndexes[H]={});let le=this.layerIndexes[H][W];return le||(le=this.layerIndexes[H][W]=new Q,le.scope=W),le}getWorkerSource(H,W,le,Se){const Te=this.workerSources;return Te[H]||(Te[H]={}),Te[H][Se]||(Te[H][Se]={}),Te[H][Se][W]||(Te[H][Se][W]={}),this.isSpriteLoaded[H]||(this.isSpriteLoaded[H]={}),Te[H][Se][W][le]||(Te[H][Se][W][le]=new this.workerSourceTypes[W]({send:(Pe,Ge,Re,Ue,gt,lt)=>this.actor.send(Pe,Ge,Re,H,gt,lt),scheduler:this.actor.scheduler},this.getLayerIndex(H,Se),this.getAvailableImages(H,Se),this.getAvailableModels(H,Se),this.isSpriteLoaded[H][Se],void 0,this.brightness,this.worldview)),Te[H][Se][W][le]}rasterizeImagesWorker(H,W,le){const Se=new Map;for(const[Te,{image:Pe,imageVariant:Ge}]of W.tasks.entries()){const Re=this.imageRasterizer.rasterize(Ge,Pe,W.scope,H);Se.set(Te,Re)}le(void 0,Se)}removeRasterizedImages(H,W,le){this.imageRasterizer.removeImagesFromCacheByIds(W.imageIds,W.scope,H),le()}enforceCacheSizeLimit(H,W){o.fI(W)}getWorkerPerformanceMetrics(H,W,le){le(void 0,void 0)}}return o.fE(self)&&(self.worker=new Yh(self)),Yh}),v(["./shared"],function(o){var O="3.16.0";const F={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(d){performance.mark(d)},measure(d,r,l){performance.measure(d,r,l)}};function Q(d){const r=d.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var te,J={},we=function(){if(te)return J;function d(f){return!r(f)}function r(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,w,S=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(S);try{w=new Worker(I),x=!0}catch{x=!1}return w&&w.terminate(),URL.revokeObjectURL(I),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var w=x.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===x.width}()?(l[_=f&&f.failIfMajorPerformanceCaveat]===void 0&&(l[_]=function(x){var w,S=function(I){var R=document.createElement("canvas"),k=Object.create(d.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=I,R.getContext("webgl2",k)}(x);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(_)),l[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}te=1,J.supported=d,J.notSupportedReason=r;var l={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},J}();function se(d,r,l){const f=document.createElement(d);return r!=null&&(f.className=r),l&&l.appendChild(f),f}function me(d,r,l){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const _ of Object.keys(r))f.setAttributeNS(null,_,String(r[_]));return l&&l.appendChild(f),f}const fe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,re=fe&&fe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let de;function Oe(){fe&&re&&(de=fe[re],fe[re]="none")}function Xe(){fe&&re&&(fe[re]=de)}function qe(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",qe,!0)}function Be(){window.addEventListener("click",qe,!0),window.setTimeout(()=>{window.removeEventListener("click",qe,!0)},0)}function bt(d,r){const l=d.getBoundingClientRect();return nr(d,l,r)}function Bt(d,r){const l=d.getBoundingClientRect(),f=[];for(let _=0;_<r.length;_++)f.push(nr(d,l,r[_]));return f}function Jt(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function nr(d,r,l){const f=d.offsetWidth===r.width?1:d.offsetWidth/r.width;return new o.P((l.clientX-r.left)*f,(l.clientY-r.top)*f)}const Gt="01",Mt="NO_ACCESS_TOKEN";class Zt{constructor(r,l,f){this._transformRequestFn=r,this._customAccessToken=l,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const r=function(){let l="";for(let f=0;f<10;f++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Gt,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,l){return this._transformRequestFn&&this._transformRequestFn(r,l)||{url:r}}normalizeStyleURL(r,l){if(!o.h(r))return r;const f=Qt(r);return f.params.push(`sdk=js-${O}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||l)}normalizeGlyphsURL(r,l){if(!o.h(r))return r;const f=Qt(r);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||l)}normalizeModelURL(r,l){if(!o.h(r))return r;const f=Qt(r);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||l)}normalizeSourceURL(r,l,f,_){if(!o.h(r))return r;const x=Qt(r);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),f&&x.params.push(`language=${f}`),_&&x.params.push(`worldview=${_}`),this._makeAPIURL(x,this._customAccessToken||l)}normalizeIconsetURL(r,l){const f=Qt(r);return o.h(r)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||l)):er(f)}normalizeSpriteURL(r,l,f,_){const x=Qt(r);return o.h(r)?(x.path=`/styles/v1${x.path}/sprite${l}${f}`,this._makeAPIURL(x,this._customAccessToken||_)):(x.path+=`${l}${f}`,er(x))}normalizeTileURL(r,l,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.h(r))return r;const _=Qt(r);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||f&&_.authority!=="raster"&&f===512?"@2x":""}${o.k.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${o.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${o.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${o.e.TILE_URL_VERSION}${_.path}`);const x=this._customAccessToken||function(w){for(const S of w){const I=S.match(/^access_token=(.*)$/);if(I)return I[1]}return null}(_.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,x)}canonicalizeTileURL(r,l){const f=Qt(r);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return r;let _="mapbox://";f.path.match(/^\/raster\/v1\//)?_+=`raster/${f.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${f.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${f.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=f.params;return l&&(x=x.filter(w=>!w.match(/^access_token=/))),x.length&&(_+=`?${x.join("&")}`),_}canonicalizeTileset(r,l){const f=!!l&&o.h(l),_=[];for(const x of r.tiles||[])o.j(x)?_.push(this.canonicalizeTileURL(x,f)):_.push(x);return _}_makeAPIURL(r,l){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Qt(o.e.API_URL);if(r.protocol=_.protocol,r.authority=_.authority,r.protocol==="http"){const x=r.params.indexOf("secure");x>=0&&r.params.splice(x,1)}if(_.path!=="/"&&(r.path=`${_.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return er(r);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return r.params=r.params.filter(x=>x.indexOf("access_token")===-1),r.params.push(`access_token=${l||""}`),er(r)}}const mr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qt(d){const r=d.match(mr);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function er(d){const r=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${r}`}const dt="mapbox.eventData";function It(d){if(!d)return null;const r=d.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.l(r[1]))}catch{return null}}class tr{constructor(r){this.type=r,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const l=It(o.e.ACCESS_TOKEN);let f="";return f=l&&l.u?o.f(l.u):o.e.ACCESS_TOKEN||"",r?`${dt}.${r}:${f}`:`${dt}:${f}`}fetchEventData(){const r=o.s("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp");if(r)try{const x=localStorage.getItem(l);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(f);w&&(this.anonId=w);const S=localStorage.getItem(_);S&&(this.anonIdTimestamp=Number(S));const I=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<I)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const r=o.s("localStorage"),l=this.getStorageKey(),f=this.getStorageKey("uuid"),_=this.getStorageKey("uuidTimestamp"),x=this.anonId,w=this.anonIdTimestamp;if(r&&x)try{localStorage.setItem(f,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData)),w&&localStorage.setItem(_,w.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,l,f,_){if(!o.e.EVENTS_URL)return;const x=Qt(o.e.EVENTS_URL);x.params.push(`access_token=${_||o.e.ACCESS_TOKEN||""}`);const w={event:this.type,created:new Date(r).toISOString()},S=l?Object.assign(w,l):w,I={url:er(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=o.p(I,R=>{this.pendingRequest=null,f(R),this.saveEventData(),this.processRequests(_)})}queueRequest(r,l){this.queue.push(r),this.processRequests(l)}}const Gr=new class extends tr{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(l=>o.h(l)||o.j(l))&&this.queueRequest(Date.now(),r)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=It(o.e.ACCESS_TOKEN),l=r?r.u:o.e.ACCESS_TOKEN;let f=l!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),f=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),w=new Date(_),S=(_-this.eventData.lastSuccess)/864e5;f=f||S>=1||S<-1||x.getDate()!==w.getDate()}else f=!0;f?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:Gt,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=_,this.eventData.tokenU=l)},d):this.processRequests()}},Rr=Gr.postTurnstileEvent.bind(Gr),Sr=new class extends tr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,r,l,f){this.skuToken=r,this.errorCb=f,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},l):this.errorCb(new Error(Mt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:Gt,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d))}remove(){this.errorCb=null}},ti=Sr.postMapLoadEvent.bind(Sr),Vi=new class extends tr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let r=this.mapInstanceIdMap.get(d);return r||(r=o.u(),this.mapInstanceIdMap.set(d,r)),r}getEventId(d){const r=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,r+1),r}postStyleLoadEvent(d,r){const{map:l,style:f,importedStyles:_}=r;if(!o.e.EVENTS_URL||!d&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(l),w={mapInstanceId:x,eventId:this.getEventId(x),style:f};_.length&&(w.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:w},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:l}=this.queue.shift();this.postEvent(r,l,()=>{},d)}},On=Vi.postStyleLoadEvent.bind(Vi),wi=new class extends tr{constructor(d){super("metrics"),d&&(this.data=d)}postMetricsEvent(d){if(!o.e.EVENTS_URL||!d&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const r=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:r},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:l}=this.queue.shift();this.postEvent(r,l,()=>{},d)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Vn=wi.postMetricsEvent.bind(wi),Hr=new class extends tr{constructor(){super("gljs.performance")}postPerformanceEvent(d,r){o.e.EVENTS_URL&&(d||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:l}=this.queue.shift(),f=function(_){const x=performance.getEntriesByType("resource"),w=performance.getEntriesByType("mark"),S=function(B){const j={};if(B){for(const U in B)if(U!=="other")for(const Z of B[U]){const q=`${U}ResolveRangeMin`,K=`${U}ResolveRangeMax`,ne=`${U}RequestCount`,ee=`${U}RequestCachedCount`;j[q]=Math.min(j[q]||1/0,Z.startTime),j[K]=Math.max(j[K]||-1/0,Z.responseEnd);const ge=oe=>{j[oe]===void 0&&(j[oe]=0),++j[oe]};Z.transferSize!==void 0&&Z.transferSize===0&&ge(ee),ge(ne)}}return j}(function(B,j){const U={};if(B)for(const Z of B){const q=j(Z);U[q]===void 0&&(U[q]=[]),U[q].push(Z)}return U}(x,Q)),I=window.devicePixelRatio,R=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=R?R.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},M=(B,j,U)=>{U!=null&&B.push({name:j,value:U.toString()})};for(const B in S)M(z.counters,B,S[B]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(M(z.counters,"interactionRangeMin",_.interactionRange[0]),M(z.counters,"interactionRangeMax",_.interactionRange[1])),w)for(const B of Object.values(F)){const j=w.find(U=>U.name===B);j&&M(z.counters,B,j.startTime)}return M(z.counters,"visibilityHidden",_.visibilityHidden),M(z.attributes,"style",function(B){if(B)for(const j of B){const U=j.name.split("?")[0];if(o.i(U)){const Z=U.split("/").slice(-2);if(Z.length===2)return`mapbox://styles/${Z[0]}/${Z[1]}`}}}(x)),M(z.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),M(z.attributes,"fogEnabled",_.fogEnabled?"true":"false"),M(z.attributes,"projection",_.projection),M(z.attributes,"zoom",_.zoom),M(z.metadata,"devicePixelRatio",I),M(z.metadata,"connectionEffectiveType",k),M(z.metadata,"navigatorUserAgent",navigator.userAgent),M(z.metadata,"screenWidth",window.screen.width),M(z.metadata,"screenHeight",window.screen.height),M(z.metadata,"windowWidth",window.innerWidth),M(z.metadata,"windowHeight",window.innerHeight),M(z.metadata,"mapWidth",_.width/I),M(z.metadata,"mapHeight",_.height/I),M(z.metadata,"webglRenderer",_.renderer),M(z.metadata,"webglVendor",_.vendor),M(z.metadata,"sdkVersion",O),M(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(l);for(const _ of f.metadata);for(const _ of f.counters);for(const _ of f.attributes);this.postEvent(r,f,()=>{},d)}},Pi=Hr.postPerformanceEvent.bind(Hr),Qi=new class extends tr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,r,l,f){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const _=Qt(o.e.API_URL+o.e.SESSION_PATH);_.params.push(`sku=${r||""}`),_.params.push(`access_token=${f||o.e.ACCESS_TOKEN||""}`);const x={url:er(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,w=>{this.pendingRequest=null,l(w),this.saveEventData(),this.processRequests(f)})}getSessionAPI(d,r,l,f){this.skuToken=r,this.errorCb=f,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},l):this.errorCb(new Error(Mt)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:l}=this.queue.shift();r&&this.success[r]||this.getSession(l,this.skuToken,f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},d)}remove(){this.errorCb=null}},Fn=Qi.getSessionAPI.bind(Qi),bi=new Set;function ns(d,r){r?bi.add(d):bi.delete(d)}class ss{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,l){this._updatedSourceCaches[r]=l,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const l=r.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(r.id),this.setDirty()}removeLayer(r){const l=r.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][r.id]=r,this._updatedLayers[l].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const l in this._updatedLayers)r[l]=r[l]||{},r[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)r[l]=r[l]||{},r[l].removedIds=Object.keys(this._removedLayers[l]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Qn(d){const{userImage:r}=d;return!!(r&&r.render&&r.render())&&(d.data.replace(new Uint8Array(r.data.buffer)),!0)}class Ss extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.q({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const l=this.atlasTexture.get(r);l&&(l.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(r.id,r)}removeImageProvider(r,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(r)}getPendingImageProviders(){const r=[];for(const l of this.imageProviders.values())for(const f of l.values())f.hasPendingRequests()&&r.push(f);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,l){if(this.loaded.get(l)!==r&&(this.loaded.set(l,r),r)){for(const{ids:f,callback:_}of this.requestors)this._notify(f,l,_);this.requestors=[]}}hasImage(r,l){return!!this.getImage(r,l)}getImage(r,l){return this.images.get(l).get(r.toString())}addImage(r,l,f){this._validate(r,f)&&this.images.get(l).set(r.toString(),f)}_validate(r,l){let f=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(l.content,l)||(this.fire(new o.y(new Error(`Image "${r.name}" has invalid "content" value`))),f=!1),f}_validateStretch(r,l){if(!r)return!0;let f=0;for(const _ of r){if(_[0]<f||_[1]<_[0]||l<_[1])return!1;f=_[1]}return!0}_validateContent(r,l){return r?r.length!==4||!l.usvg&&(r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,l,f){const _=this.images.get(l).get(r.toString());f.version=_.version+1,this.images.get(l).set(r.toString(),f),this.updatedImages.get(l).add(r),this.removeFromImageRasterizerCache(r,l)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,l){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([r],l))}removeImage(r,l){const f=this.images.get(l),_=f.get(r.toString());f.delete(r.toString()),this.patterns.get(l).delete(r.toString()),this.removeFromImageRasterizerCache(r,l),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(l=>o.I.from(l))}getImages(r,l,f){const _=[],x=[],w=this.imageProviders.get(l);for(const k of r){if(!k.iconsetId){_.push(k);continue}const z=w.get(k.iconsetId);z&&(this.getImage(k,l)?x.push(k):z.addPendingRequest(k))}if(_.length===0)return void this._notify(x,l,f);let S=!0;const I=!!this.loaded.get(l),R=this.images.get(l);if(!I)for(const k of _)R.has(k.toString())||(S=!1);I||S?this._notify(_,l,f):this.requestors.push({ids:_,scope:l,callback:f})}rasterizeImages(r,l){const f=new Map,{tasks:_,scope:x}=r;for(const[w,S]of _.entries()){const I=this.getImage(S.id,x);I&&f.set(w,{image:I,imageVariant:S})}this._rasterizeImages(x,f,l)}_rasterizeImages(r,l,f){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:r},f);else{const _=new Map;for(const[x,{image:w,imageVariant:S}]of l.entries())_.set(x,this.imageRasterizer.rasterize(S,w,r,0));f(void 0,_)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,l,f){const _=this.images.get(l),x=new Map;for(const w of r){if(!_.get(w.toString())){if(w.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:w.name}))}const S=_.get(w.toString());if(!S){o.w(`Image "${w.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const I={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(I,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),x.set(o.I.toString(w),I)}f(null,x)}getPixelSize(r){const{width:l,height:f}=this.atlasImage.get(r);return{width:l,height:f}}getPattern(r,l,f){const _=r.toString(),x=this.patterns.get(l),w=x.get(_),S=this.getImage(r,l);if(!S)return null;if(w){if(w.position.version===S.version)return w.position;w.position.version=S.version}else{if(S.usvg&&!S.data){const I=this.getPatternInFlightId(_,l);if(this.patternsInFlight.has(I))return null;this.patternsInFlight.add(I);const R=new o.A(r).scaleSelf(o.o.devicePixelRatio),k=new Map([[R.toString(),{image:S,imageVariant:R}]]);return this._rasterizeImages(l,k,(z,M)=>this.storePatternImage(R,l,S,f,M)),null}this.storePattern(r,l,S)}return this._updatePatternAtlas(l,f),x.get(_).position}getPatternInFlightId(r,l){return o.B(r,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,l,f,_,x){const w=r.toString(),S=x?x.get(w):void 0;S&&(f.data=S,this.storePattern(r.id,l,f),this._updatePatternAtlas(l,_),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),l)))}storePattern(r,l,f){const _={w:f.data.width+2*o.C,h:f.data.height+2*o.C,x:0,y:0},x=new o.F(_,f,o.C);this.patterns.get(l).set(r.toString(),{bin:_,position:x})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,l){const f=r.gl;let _=this.atlasTexture.get(l);_?this.dirty&&(_.update(this.atlasImage.get(l)),this.dirty=!1):(_=new o.T(r,this.atlasImage.get(l),f.RGBA8),this.atlasTexture.set(l,_)),_.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,l){const f=this.patterns.get(r),_=Array.from(f.values()).map(({bin:R})=>R),{w:x,h:w}=o.G(_),S=this.atlasImage.get(r);S.resize({width:x||1,height:w||1});const I=this.images.get(r);for(const[R,{bin:k,position:z}]of f.entries()){let M=z.padding;const B=k.x+M,j=k.y+M,U=I.get(R).data,Z=U.width,q=U.height;M=M>1?M-1:M,o.q.copy(U,S,{x:0,y:0},{x:B,y:j},{width:Z,height:q},l),o.q.copy(U,S,{x:0,y:q-M},{x:B,y:j-M},{width:Z,height:M},l),o.q.copy(U,S,{x:0,y:0},{x:B,y:j+q},{width:Z,height:M},l),o.q.copy(U,S,{x:Z-M,y:0},{x:B-M,y:j},{width:M,height:q},l),o.q.copy(U,S,{x:0,y:0},{x:B+Z,y:j},{width:M,height:q},l),o.q.copy(U,S,{x:Z-M,y:q-M},{x:B-M,y:j-M},{width:M,height:M},l),o.q.copy(U,S,{x:0,y:q-M},{x:B+Z,y:j-M},{width:M,height:M},l),o.q.copy(U,S,{x:0,y:0},{x:B+Z,y:j+q},{width:M,height:M},l),o.q.copy(U,S,{x:Z-M,y:0},{x:B-M,y:j+q},{width:M,height:M},l)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,l){const f=this.images.get(l);for(const _ of r){if(this.callbackDispatchedThisFrame.get(l).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(_.toString());const x=f.get(_.toString());Qn(x)&&this.updateImage(_,l,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Gi(d){const r=d.value,l=d.valueSpec,f=d.style,_=d.styleSpec,x=d.key,w=d.arrayElementValidator||tn;if(!Array.isArray(r))return[new o.V(x,r,`array expected, ${o.K(r)} found`)];if(l.length&&r.length!==l.length)return[new o.V(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new o.V(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let S={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(S.function=l.function),o.H(l.value)&&(S=l.value);let I=[];for(let R=0;R<r.length;R++)I=I.concat(w({array:r,arrayIndex:R,value:r[R],valueSpec:S,style:f,styleSpec:_,key:`${x}[${R}]`},!0));return I}function Js(d){const r=d.key,l=d.value,f=d.valueSpec;if(!o.L(l))return[new o.V(r,l,`number expected, ${o.K(l)} found`)];if(l!=l)return[new o.V(r,l,"number expected, NaN found")];if("minimum"in f){let _=f.minimum;if(Array.isArray(f.minimum)&&(_=f.minimum[d.arrayIndex]),l<_)return[new o.V(r,l,`${l} is less than the minimum value ${_}`)]}if("maximum"in f){let _=f.maximum;if(Array.isArray(f.maximum)&&(_=f.maximum[d.arrayIndex]),l>_)return[new o.V(r,l,`${l} is greater than the maximum value ${_}`)]}return[]}function Ve(d){const r=d.key,l=d.value;if(!o.H(l))return[new o.V(r,l,`object expected, ${o.K(l)} found`)];const f=d.valueSpec,_=o.J(l.type);let x,w,S,I={};const R=_!=="categorical"&&l.property===void 0,k=!R,z=function(U){const Z=U.stops;return Array.isArray(Z)&&Array.isArray(Z[0])&&o.H(Z[0][0])}(l),M=ms({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(U){if(_==="identity")return[new o.V(U.key,U.value,'identity function may not have a "stops" property')];let Z=[];const q=U.value;return Z=Z.concat(Gi({key:U.key,value:q,valueSpec:U.valueSpec,style:U.style,styleSpec:U.styleSpec,arrayElementValidator:B})),Array.isArray(q)&&q.length===0&&Z.push(new o.V(U.key,q,"array must have at least one stop")),Z},default:function(U){return tn({key:U.key,value:U.value,valueSpec:f,style:U.style,styleSpec:U.styleSpec})}}});return _==="identity"&&R&&M.push(new o.V(d.key,d.value,'missing required property "property"')),_==="identity"||l.stops||M.push(new o.V(d.key,d.value,'missing required property "stops"')),_==="exponential"&&f.expression&&!o.M(f)&&M.push(new o.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(k&&!o.N(f)?M.push(new o.V(d.key,d.value,"property functions not supported")):R&&!o.O(f)&&M.push(new o.V(d.key,d.value,"zoom functions not supported"))),_!=="categorical"&&!z||l.property!==void 0||M.push(new o.V(d.key,d.value,'"property" property is required')),M;function B(U){let Z=[];const q=U.value,K=U.key;if(!Array.isArray(q))return[new o.V(K,q,`array expected, ${o.K(q)} found`)];if(q.length!==2)return[new o.V(K,q,`array length 2 expected, length ${q.length} found`)];if(z){if(!o.H(q[0]))return[new o.V(K,q,`object expected, ${o.K(q[0])} found`)];const ne=q[0];if(ne.zoom===void 0)return[new o.V(K,q,"object stop key must have zoom")];if(ne.value===void 0)return[new o.V(K,q,"object stop key must have value")];const ee=o.J(ne.zoom);if(typeof ee!="number")return[new o.V(K,ne.zoom,"stop zoom values must be numbers")];if(S&&S>ee)return[new o.V(K,ne.zoom,"stop zoom values must appear in ascending order")];ee!==S&&(S=ee,w=void 0,I={}),Z=Z.concat(ms({key:`${K}[0]`,value:q[0],valueSpec:{zoom:{}},style:U.style,styleSpec:U.styleSpec,objectElementValidators:{zoom:Js,value:j}}))}else Z=Z.concat(j({key:`${K}[0]`,value:q[0],style:U.style,styleSpec:U.styleSpec},q));return o.Q(o.S(q[1]))?Z.concat([new o.V(`${K}[1]`,q[1],"expressions are not allowed in function stops.")]):Z.concat(tn({key:`${K}[1]`,value:q[1],valueSpec:f,style:U.style,styleSpec:U.styleSpec}))}function j(U,Z){const q=o.K(U.value),K=o.J(U.value),ne=U.value!==null?U.value:Z;if(x){if(q!==x)return[new o.V(U.key,ne,`${q} stop domain type must match previous stop domain type ${x}`)]}else x=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof K!="number"&&typeof K!="string"&&typeof K!="boolean")return[new o.V(U.key,ne,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&_!=="categorical"){let ee=`number expected, ${q} found`;return o.N(f)&&_===void 0&&(ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(U.key,ne,ee)]}return _!=="categorical"||q!=="number"||typeof K=="number"&&isFinite(K)&&Math.floor(K)===K?_!=="categorical"&&q==="number"&&typeof K=="number"&&typeof w=="number"&&w!==void 0&&K<w?[new o.V(U.key,ne,"stop domain values must appear in ascending order")]:(w=K,_==="categorical"&&K in I?[new o.V(U.key,ne,"stop domain values must be unique")]:(I[K]=!0,[])):[new o.V(U.key,ne,`integer expected, found ${String(K)}`)]}}function ct(d){const r=(d.expressionContext==="property"?o.W:o.U)(o.S(d.value),d.valueSpec);if(r.result==="error")return r.value.map(f=>new o.V(`${d.key}${f.key}`,d.value,f.message));const l=r.value.expression||r.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!o.Z(l))return[new o.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Ct(l,d);if(d.expressionContext==="appearance")return cr(l,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!o.X(l,["zoom","feature-state"]))return[new o.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!o.Y(l))return[new o.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ct(d,r){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)l.delete(_);if(l.size===0)return[];const f=[];return d instanceof o._&&l.has(d.name)?[new o.V(r.key,r.value,`["${d.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(d.eachChild(_=>{f.push(...Ct(_,r))}),f)}function cr(d,r){const l=new Set;if(r.valueSpec&&r.valueSpec.expression)for(const _ of r.valueSpec.expression.parameters)l.add(_);if(l.size===0)return[];const f=[];return d instanceof o._&&!l.has(d.name)?[new o.V(r.key,r.value,`["${d.name}"] is not an allowed parameter`)]:(d.eachChild(_=>{f.push(...cr(_,r))}),f)}function Nt(d){const r=d.key,l=d.value,f=d.valueSpec,_=[];return Array.isArray(f.values)?f.values.indexOf(o.J(l))===-1&&_.push(new o.V(r,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(o.J(l))===-1&&_.push(new o.V(r,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function rr(d){return o.a2(o.S(d.value))?ct(Object.assign({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):br(d)}function br(d){const r=d.value,l=d.key;if(!Array.isArray(r))return[new o.V(l,r,`array expected, ${o.K(r)} found`)];if(r.length<1)return[new o.V(l,r,"filter array must have at least 1 element")];const f=d.styleSpec;let _=Nt({key:`${l}[0]`,value:r[0],valueSpec:f.filter_operator});switch(o.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.J(r[1])==="$type"&&_.push(new o.V(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&_.push(new o.V(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(o.a0(r[1])||_.push(new o.V(`${l}[1]`,r[1],`string expected, ${o.K(r[1])} found`)));for(let x=2;x<r.length;x++)o.J(r[1])==="$type"?_=_.concat(Nt({key:`${l}[${x}]`,value:r[x],valueSpec:f.geometry_type})):o.a0(r[x])||o.L(r[x])||o.$(r[x])||_.push(new o.V(`${l}[${x}]`,r[x],`string, number, or boolean expected, ${o.K(r[x])} found.`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(br({key:`${l}[${x}]`,value:r[x],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":r.length!==2?_.push(new o.V(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):o.a0(r[1])||_.push(new o.V(`${l}[1]`,r[1],`string expected, ${o.K(r[1])} found`))}return _}function _i(d,r){const l=d.key,f=d.style,_=d.layer,x=d.styleSpec,w=d.value,S=d.objectKey,I=x[`${r}_${d.layerType}`];if(!I)return[];const R=S.match(/^(.*)-use-theme$/);if(R&&I[R[1]])return o.Q(o.S(w))?[].concat(tn({key:l,value:w,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:S})):tn({key:l,value:w,valueSpec:{type:"string"},style:f,styleSpec:x});const k=S.match(/^(.*)-transition$/);if(r==="paint"&&k&&I[k[1]]&&I[k[1]].transition)return tn({key:l,value:w,valueSpec:x.transition,style:f,styleSpec:x});const z=d.valueSpec||I[S];if(!z)return[new o.a3(l,w,`unknown property "${S}"`)];let M;if(o.a0(w)&&o.N(z)&&!z.tokens&&(M=/^{([^}]+)}$/.exec(w))){const j=`\`{ "type": "identity", "property": ${M?JSON.stringify(M[1]):'"_"'} }\``;return[new o.V(l,w,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${j}.`)]}const B=[];if(d.layerType==="symbol")S!=="text-field"||!f||f.glyphs||f.imports||B.push(new o.V(l,w,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&o.a4(o.S(w))&&o.J(w.type)==="identity"&&B.push(new o.V(l,w,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&r==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&o.N(z)&&(o.a5(z)||o.O(z))){const j=o.W(o.S(w),z).value,U="expression"in j&&j.expression||"_styleExpression"in j&&j._styleExpression&&j._styleExpression.expression;U&&!o.X(U,["measure-light"])&&(S==="model-emissive-strength"&&o.Y(U)&&o.Z(U)||B.push(new o.V(l,w,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(tn({key:d.key,value:w,valueSpec:z,style:f,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:S}))}function Hi(d){return _i(d,"paint")}function xn(d){return _i(d,"layout")}function js(d){let r=[];const l=d.value,f=d.key,_=d.style,x=d.styleSpec;if(!o.H(l))return[new o.V(f,l,"object expected")];l.type||l.ref||r.push(new o.V(f,l,'either "type" or "ref" is required'));let w=o.J(l.type);const S=o.J(l.ref);if(l.id){const I=o.J(l.id);for(let R=0;R<d.arrayIndex;R++){const k=_.layers[R];o.J(k.id)===I&&r.push(new o.V(f,l.id,`duplicate layer id "${I}", previously used at line ${k.id.__line__}`))}}if("ref"in l){let I;["type","source","source-layer","filter","layout"].forEach(R=>{R in l&&r.push(new o.V(f,l[R],`"${R}" is prohibited for ref layers`))}),_.layers.forEach(R=>{o.J(R.id)===S&&(I=R)}),I?I.ref?r.push(new o.V(f,l.ref,"ref cannot reference another ref layer")):w=o.J(I.type):typeof S=="string"&&r.push(new o.V(f,l.ref,`ref layer "${S}" not found`))}else if(w!=="background"&&w!=="sky"&&w!=="slot")if(l.source)if(o.a0(l.source)){const I=_.sources&&_.sources[l.source],R=I&&o.J(I.type);I?R==="vector"&&w==="raster"?r.push(new o.V(f,l.source,`layer "${l.id}" requires a raster source`)):R==="raster"&&w!=="raster"?r.push(new o.V(f,l.source,`layer "${l.id}" requires a vector source`)):R!=="vector"||l["source-layer"]?R==="raster-dem"&&w!=="hillshade"?r.push(new o.V(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="raster-array"||["raster","raster-particle"].includes(w)?w==="line"&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&R==="geojson"&&!I.lineMetrics?r.push(new o.V(f,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):w==="raster-particle"&&R!=="raster-array"&&r.push(new o.V(f,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):r.push(new o.V(f,l.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(f,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new o.V(f,l.source,`source "${l.source}" not found`))}else r.push(new o.V(`${f}.source`,l.source,'"source" must be a string'));else r.push(new o.V(f,l,'missing required property "source"'));return r=r.concat(ms({key:f,value:l,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>tn({key:`${f}.type`,value:l.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:l,objectKey:"type"}),filter:I=>rr(Object.assign({layerType:w},I)),layout:I=>ms({layer:l,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":R=>xn(Object.assign({layerType:w},R))}}),paint:I=>ms({layer:l,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":R=>Hi(Object.assign({layerType:w,layer:l},R))}}),appearances(I){const R=Gi({key:I.key,value:I.value,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:M=>function(B){const{key:j,layer:U,layerType:Z}=B,q=o.J(B.value),K=o.J(q.name),ne=o.J(q.condition),ee=ms({key:j,value:q,valueSpec:B.styleSpec.appearance,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{condition:ge=>function(oe){const ve=[];return ve.push(...ct({key:oe.key,value:oe.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ve}(Object.assign({layer:U,layerType:Z},ge)),properties:ge=>function(oe){const ve=[],{styleSpec:pe,layer:ce,layerType:xe}=oe,Me=pe[`paint_${xe}`],Ce=pe[`layout_${xe}`],We=oe.object[oe.objectKey];for(const Ne in We){const Qe=Ne in Me?"paint":Ne in Ce?"layout":void 0;if(!Qe){ve.push(new o.V(oe.key,Ne,`unknown property "${Ne}" for layer type "${xe}"`));continue}const _t=Object.assign({},oe,{key:`${oe.key}.${Ne}`,object:We,objectKey:Ne,layer:ce,layerType:xe,value:We[Ne],valueSpec:Qe==="paint"?Me[Ne]:Ce[Ne]});ve.push(..._i(_t,Qe))}return ve}(Object.assign({layer:U,layerType:Z},ge))}});return K!=="hidden"&&ne===void 0&&ee.push(new o.V(B.key,"name",'Appearance with name different than "hidden" must have a condition')),ee}(Object.assign({layerType:w,layer:l},M))}),k=Array.isArray(I.value)?I.value:[],z=new Set;return k.forEach((M,B)=>{const j=o.J(M.name);if(j)if(z.has(j)){const U=o.J(l.id);R.push(new o.V(I.key,j,`Duplicated appearance name "${j}" for layer "${U}"`))}else z.add(j)}),R}}})),r}function os({key:d,value:r}){return o.a0(r)?[]:[new o.V(d,r,`string expected, ${o.K(r)} found`)]}const Pa={promoteId:function d({key:r,value:l}){if(o.a0(l))return os({key:r,value:l});if(Array.isArray(l)){const _=[],x=o.S(l),w=o.U(x);return w.result==="error"&&w.value.forEach(S=>{_.push(new o.V(`${r}${S.key}`,null,`${S.message}`))}),o.X(w.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||_.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),_}if(!o.H(l))return[new o.V(r,l,`string, expression or object expected, "${o.K(l)}" found`)];const f=[];for(const _ in l)f.push(...d({key:`${r}.${_}`,value:l[_]}));return f}};function vo(d){const r=d.value,l=d.key,f=d.styleSpec,_=d.style;if(!o.H(r))return[new o.V(l,r,`object expected, ${o.K(r)} found`)];if(!("type"in r))return[new o.V(l,r,'"type" is required')];const x=o.J(r.type);let w=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&("url"in r||"tiles"in r||w.push(new o.a3(l,r,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return w=w.concat(ms({key:l,value:r,valueSpec:f[`source_${x.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Pa})),w;case"geojson":if(w=ms({key:l,value:r,valueSpec:f.source_geojson,style:_,styleSpec:f,objectElementValidators:Pa}),"cluster"in r&&"clusterProperties"in r){if(!o.H(r.clusterProperties))return[new o.V(`${l}.clusterProperties`,r,`object expected, ${o.K(r)} found`)];for(const S in r.clusterProperties){const I=r.clusterProperties[S];if(!Array.isArray(I))return[new o.V(`${l}.clusterProperties.${S}`,I,"array expected")];const[R,k]=I,z=typeof R=="string"?[R,["accumulated"],["get",S]]:R;w.push(...ct({key:`${l}.${S}.map`,value:k,expressionContext:"cluster-map"})),w.push(...ct({key:`${l}.${S}.reduce`,value:z,expressionContext:"cluster-reduce"}))}}return w;case"video":return ms({key:l,value:r,valueSpec:f.source_video,style:_,styleSpec:f});case"image":return ms({key:l,value:r,valueSpec:f.source_image,style:_,styleSpec:f});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nt({key:`${l}.type`,value:r.type,valueSpec:{values:en(f)}})}}function en(d){return d.source.reduce((r,l)=>{const f=d[l];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values||{}))),r},[])}function aa(d){const r=d.value,l=d.styleSpec,f=l.light,_=d.style;if(r===void 0)return[];if(!o.H(r))return[new o.V("light",r,`object expected, ${o.K(r)} found`)];let x=[];for(const w in r){const S=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);x=x.concat(I&&f[I[1]]?tn({key:w,value:r[w],valueSpec:{type:"string"},style:_,styleSpec:l}):S&&f[S[1]]&&f[S[1]].transition?tn({key:w,value:r[w],valueSpec:l.transition,style:_,styleSpec:l}):f[w]?tn({key:w,value:r[w],valueSpec:f[w],style:_,styleSpec:l}):[new o.V(w,r[w],`unknown property "${w}"`)])}return x}function Qs(d){const r=d.value;if(!r)return[];const l=d.key;if(!o.H(r))return[new o.V(l,r,`object expected, ${o.K(r)} found`)];let f=[];const _=d.styleSpec,x=_["light-3d"],w=d.style,S=d.style.lights;for(const k of["type","id"])if(!(k in r))return f=f.concat([new o.V(l,r,`missing property "${k}"`)]),f;if(!o.a0(r.type))return f=f.concat([new o.V(`${l}.type`,r.type,"string expected")]),f;if(S)for(let k=0;k<d.arrayIndex;k++){const z=o.J(r.type),M=S[k];o.J(M.type)===z&&f.push(new o.V(l,r.id,`duplicate light type "${r.type}", previously defined at line ${M.id.__line__}`))}const I=`properties_light_${r.type}`;if(!(I in _))return f=f.concat([new o.V(`${l}.type`,r,`Invalid light type ${r.type}`)]),f;const R=_[I];for(const k in r)if(k==="properties"){const z=r[k];if(!o.H(z))return f=f.concat([new o.V("properties",z,`object expected, ${o.K(z)} found`)]),f;for(const M in z){const B=M.match(/^(.*)-transition$/),j=M.match(/^(.*)-use-theme$/);f=f.concat(j&&R[j[1]]?tn({key:k,value:z[M],valueSpec:{type:"string"},style:w,styleSpec:_}):B&&R[B[1]]&&R[B[1]].transition?tn({key:k,value:r[k],valueSpec:_.transition,style:w,styleSpec:_}):R[M]?tn({key:M,value:z[M],valueSpec:R[M],style:w,styleSpec:_}):[new o.a3(d.key,z[M],`unknown property "${M}"`)])}}else f=f.concat(x[k]?tn({key:k,value:r[k],valueSpec:x[k],style:w,styleSpec:_}):[new o.a3(k,r[k],`unknown property "${k}"`)]);return f}function Do(d){const r=d.value,l=d.key,f=d.style,_=d.styleSpec,x=_.terrain;if(r==null)return[];if(!o.H(r))return[new o.V("terrain",r,`object expected, ${o.K(r)} found`)];let w=[];for(const S in r){const I=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);w=w.concat(R&&x[R[1]]?tn({key:S,value:r[S],valueSpec:{type:"string"},style:f,styleSpec:_}):I&&x[I[1]]&&x[I[1]].transition?tn({key:S,value:r[S],valueSpec:_.transition,style:f,styleSpec:_}):x[S]?tn({key:S,value:r[S],valueSpec:x[S],style:f,styleSpec:_}):[new o.a3(S,r[S],`unknown property "${S}"`)])}if(r.source)if(o.a0(r.source)){const S=f.sources&&f.sources[r.source],I=S&&o.J(S.type);S?I!=="raster-dem"&&w.push(new o.V(`${l}.source`,r.source,`terrain cannot be used with a source of type ${I}, it only be used with a "raster-dem" source type`)):w.push(new o.V(`${l}.source`,r.source,`source "${r.source}" not found`))}else w.push(new o.V(`${l}.source`,r.source,"source must be a string"));else w.push(new o.V(l,r,'terrain is missing required property "source"'));return w}function eo(d){const r=d.value,l=d.style,f=d.styleSpec,_=f.fog;if(r===void 0)return[];if(!o.H(r))return[new o.V("fog",r,`object expected, ${o.K(r)} found`)];let x=[];for(const w in r){const S=w.match(/^(.*)-transition$/),I=w.match(/^(.*)-use-theme$/);x=x.concat(I&&_[I[1]]?tn({key:w,value:r[w],valueSpec:{type:"string"},style:l,styleSpec:f}):S&&_[S[1]]&&_[S[1]].transition?tn({key:w,value:r[w],valueSpec:f.transition,style:l,styleSpec:f}):_[w]?tn({key:w,value:r[w],valueSpec:_[w],style:l,styleSpec:f}):[new o.a3(w,r[w],`unknown property "${w}"`)])}return x}const lo={"*":()=>[],array:Gi,boolean:function(d){const r=d.value,l=d.key;return o.$(r)?[]:[new o.V(l,r,`boolean expected, ${o.K(r)} found`)]},number:Js,color:function({key:d,value:r}){return o.a0(r)?o.a1.parseCSSColor(r)===null?[new o.V(d,r,`color expected, "${r}" found`)]:[]:[new o.V(d,r,`color expected, ${o.K(r)} found`)]},enum:Nt,filter:rr,function:Ve,layer:js,object:ms,source:vo,model:o.a7,light:aa,"light-3d":Qs,terrain:Do,fog:eo,string:os,formatted:function(d){return os(d).length===0?[]:ct(d)},resolvedImage:function(d){return os(d).length===0?[]:ct(d)},projection:function(d){const r=d.value,l=d.styleSpec,f=l.projection,_=d.style;if(o.H(r)){let x=[];for(const w in r)x=x.concat(tn({key:w,value:r[w],valueSpec:f[w],style:_,styleSpec:l}));return x}return o.a0(r)?[]:[new o.V("projection",r,`object or string expected, ${o.K(r)} found`)]},import:function(d){const r=d.key,{value:l,styleSpec:f}=d;if(!o.H(l))return[new o.V(r,l,"import must be an object")];const{data:_,...x}=l;Object.defineProperty(x,"__line__",{value:l.__line__,enumerable:!1});let w=ms(Object.assign({},d,{value:x,valueSpec:f.import}));return o.J(x.id)===""&&w.push(new o.V(`${d.key}.id`,x,"import id can't be an empty string")),_&&(w=w.concat(Vs(_,f,{key:`${d.key}.data`}))),w},iconset:function(d){const r=d.value,l=d.key,f=d.styleSpec,_=d.style;if(!o.H(r))return[new o.V(l,r,"object expected")];if(!r.type)return[new o.V(l,r,'"type" is required')];const x=o.J(r.type);let w=[];if(w=w.concat(ms({key:l,value:r,valueSpec:f[`iconset_${x}`],style:_,styleSpec:f})),function(S,I){return!(S!=="source"||!I.source)}(x,r)){const S=_.sources&&_.sources[r.source],I=S&&o.J(S.type);S?I!=="raster-array"&&w.push(new o.V(l,r.source,`iconset cannot be used with a source of type ${String(I)}, it only be used with a "raster-array" source type`)):w.push(new o.V(l,r.source,`source "${r.source}" not found`))}return w}};function tn(d,r=!1){const l=d.value,f=d.valueSpec,_=d.styleSpec;if(f.expression){if(o.a4(o.J(l)))return Ve(d);if(o.Q(o.S(l)))return ct(d)}if(f.type&&lo[f.type]){const x=lo[f.type](d);return r===!0&&x.length>0&&Array.isArray(d.value)?ct(d):x}return ms(Object.assign({},d,{valueSpec:f.type?_[f.type]:f}))}function ms(d){const r=d.key,l=d.value,f=d.valueSpec||{},_=d.objectElementValidators||{},x=d.style,w=d.styleSpec;if(!o.H(l))return[new o.V(r,l,`object expected, ${o.K(l)} found`)];let S=[];for(const I in l){const R=I.split(".")[0];let k;_[R]?k=_[R]:f[R]?k=tn:_["*"]?k=_["*"]:f["*"]&&(k=tn),k?S=S.concat(k({key:(r&&`${r}.`)+I,value:l[I],valueSpec:f[R]||f["*"],style:x,styleSpec:w,object:l,objectKey:I},l)):S.push(new o.a3(r,l[I],`unknown property "${I}"`))}for(const I in f){if(_[I])continue;const R=f[I];R.required&&R.default===void 0&&l[I]===void 0&&S.push(new o.V(r,l,`missing required property "${I}"`))}return S}function Ra({key:d,value:r}){const l=os({key:d,value:r});if(l.length)return l;const f=r;return f.indexOf("{fontstack}")===-1&&l.push(new o.V(d,r,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&l.push(new o.V(d,r,'"glyphs" url must include a "{range}" token')),l}function Vs(d,r=o.a6,l={}){return ms({key:l.key||"",value:d,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:d,objectElementValidators:{glyphs:Ra}})}function co(d,r=o.a6){return De(Vs(d,r))}const di=d=>De(vo(d)),sn=d=>De(aa(d)),An=d=>De(Qs(d)),Rs=d=>De(Do(d)),nt=d=>De(eo(d)),ks=d=>De(function(r){const l=r.value,f=r.style,_=r.styleSpec,x=_.snow;if(l===void 0)return[];if(!o.H(l))return[new o.V("snow",l,`object expected, ${o.K(l)} found`)];let w=[];for(const S in l){const I=S.match(/^(.*)-transition$/);w=w.concat(I&&x[I[1]]&&x[I[1]].transition?tn({key:S,value:l[S],valueSpec:_.transition,style:f,styleSpec:_}):x[S]?tn({key:S,value:l[S],valueSpec:x[S],style:f,styleSpec:_}):[new o.a3(S,l[S],`unknown property "${S}"`)])}return w}(d)),Lo=d=>De(function(r){const l=r.value,f=r.style,_=r.styleSpec,x=_.rain;if(l===void 0)return[];if(!o.H(l))return[new o.V("rain",l,`object expected, ${o.K(l)} found`)];let w=[];for(const S in l){const I=S.match(/^(.*)-transition$/);w=w.concat(I&&x[I[1]]&&x[I[1]].transition?tn({key:S,value:l[S],valueSpec:_.transition,style:f,styleSpec:_}):x[S]?tn({key:S,value:l[S],valueSpec:x[S],style:f,styleSpec:_}):[new o.a3(S,l[S],`unknown property "${S}"`)])}return w}(d)),Us=d=>De(js(d)),Nr=d=>De(rr(d)),$s=d=>De(Hi(d)),lg=d=>De(xn(d)),Yh=d=>De(o.a7(d));function De(d){return d.slice().sort((r,l)=>r.line&&l.line?r.line-l.line:0)}function H(d,r){let l=!1;if(r&&r.length)for(const f of r)f instanceof o.a3?o.w(f.message):(d.fire(new o.y(new Error(f.message))),l=!0);return l}const W=o.a6.light;let le;class Se extends o.E{constructor(r,l="flat"){super(),this._transitionable=new o.a8(le||(le=new o.a9({anchor:new o.aa(W.anchor),position:new o.ab(W.position),color:new o.aa(W.color),intensity:new o.aa(W.intensity)}))),this.setLight(r,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l,f={}){this._validate(sn,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=l)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&H(this,r.call(co,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Te=o.a6.terrain;let Pe=class extends o.E{constructor(d,r,l,f,_){super(),this.scope=l,this._transitionable=new o.a8(new o.a9({source:new o.aa(Te.source),exaggeration:new o.aa(Te.exaggeration)}),l,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=_}get(){return this._transitionable.serialize()}set(d,r){this._transitionable.setTransitionOrValue(d,r)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new o.ac(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const r=d.value.expression;if(!r)return null;let l=-1,f=-1,_=1;for(const x of r.zoomStops)_=r.evaluate(new o.ac(x,{worldview:this.worldview})),_>.01?(l=x,f=-1):f=x;return _<.01&&l>0&&f>l?[l,f]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof o.ad}};const Ge=45,Re=65,Ue=.05;function gt(d,r,l,f){const _=o.ah(Ge,Re,l),[x,w]=lt(d,f);let S=1-Math.min(1,Math.exp((r-x)/(w-x)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*_*d.alpha}function lt(d,r){const l=.5/Math.tan(.5*r);return[d.range[0]+l,d.range[1]+l]}function Xt(d,r,l,f,_){const x=o.af([],[r,l,f],_.mercatorFogMatrix);return gt(d,o.ag(x),_.pitch,_._fov)}function vr(d,r,l,f,_,x,w){const S=[[l,f,0],[_,f,0],[_,x,0],[l,x,0]];let I=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(const k of S){const z=o.af([],k,r),M=o.ag(z);I=Math.min(I,M),R=Math.max(R,M)}return[gt(d,I,w.pitch,w._fov),gt(d,R,w.pitch,w._fov)]}const gr=o.a6.fog;class or extends o.E{constructor(r,l,f,_){super();const x=new o.a9({range:new o.aa(gr.range),color:new o.aa(gr.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(gr["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(gr["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(gr["horizon-blend"]),"star-intensity":new o.aa(gr["star-intensity"]),"vertical-range":new o.aa(gr["vertical-range"])});this._transitionable=new o.a8(x,f,new Map(_)),this.set(r,_),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.ai(x),this.scope=f}get state(){const r=this._transform,l=r.projection.name==="globe",f=o.aj(r.zoom),_=this.properties.get("range"),x=[.5,3];return{range:l?[o.ak(x[0],_[0],f),o.ak(x[1],_[1],f)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l,f={}){if(this._validate(nt,r,f))return;const _=Object.assign({},r);for(const x of Object.keys(gr))_[x]===void 0&&(_[x]=gr[x].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Ge,Re,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(f,_,x){const w=o.ae.fromLngLat(_),S=x.elevation?x.elevation.getAtPointOrZero(w):0;return Xt(f,w.x,w.y,S,x)}(this.state,r,l):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(r.toUnwrapped());return vr(this.state,l,0,0,o.al,o.al,this._transform)}getOpacityForBounds(r,l,f,_,x){return this._transform.projection.supportsFog?vr(this.state,r,l,f,_,x,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?lt(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const f of l){const _=r.points[f];let x;if(_[2]>=0)x=_;else{const w=r.points[f-4];x=o.am(w,_,w[2]/(w[2]-_[2]))}if(Xt(this.state,x[0],x[1],0,this._transform)>=Ue)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,f){return(!f||f.validate!==!1)&&H(this,r.call(co,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let zr,jr,Ai,mn,Bn=class extends o.E{constructor(d,r,l,f){super();const _=zr||(zr=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(_,l,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(_),this.scope=l}get state(){const d=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),f=o.an(l[0]),_=-Math.max(o.an(l[1]),.01),x=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=w,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(d,r,l={}){if(this._validate(ks,d,l))return;const f=Object.assign({},d),_=o.a6.snow;for(const x of Object.keys(_))f[x]===void 0&&(f[x]=_[x].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,r,l){return(!l||l.validate!==!1)&&H(this,d.call(co,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},Cn=class extends o.E{constructor(d,r,l,f){super();const _=jr||(jr=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(_,l,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(_),this.scope=l}get state(){const d=this.properties.get("opacity"),r=this.properties.get("color"),l=this.properties.get("direction"),f=o.an(l[0]),_=-Math.max(o.an(l[1]),.01),x=[Math.cos(f)*Math.cos(_),Math.sin(f)*Math.cos(_),Math.sin(_)],w=this.properties.get("vignette-color");return w.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(r.r,r.g,r.b,r.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(d,r,l={}){if(this._validate(Lo,d,l))return;const f=Object.assign({},d),_=o.a6.rain;for(const x of Object.keys(_))f[x]===void 0&&(f[x]=_[x].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,r,l){return(!l||l.validate!==!1)&&H(this,d.call(co,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Sn extends o.E{constructor(r,l,f,_){super(),this.scope=f,this._options=r,this.properties=new o.ai(l),this._transitionable=new o.a8(l,f,new Map(_)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,l){this._options=r,this._transitionable.setTransitionOrValue(r.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ei{constructor(r,l,f){this.screenBounds=r,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(r,l){let f,_;if(r instanceof o.P||typeof r[0]=="number"){const x=o.P.convert(r);f=[x],_=l.isPointAboveHorizon(x)}else{const x=o.P.convert(r[0]),w=o.P.convert(r[1]),S=x.add(w)._div(2);f=[x,w],_=o.aq(x,w).every(I=>l.isPointAboveHorizon(I))&&l.isPointAboveHorizon(S)}return new Ei(f,_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.aq(l,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<f.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),o.ar(_,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],_=o.aq(l,f,r),x=this.cameraPoint.clone();switch(3*((x.y>l.y)+(x.y>f.y))+((x.x>l.x)+(x.x>f.x))){case 0:_[0]=x,_[4]=x.clone();break;case 1:_.splice(1,0,x);break;case 2:_[1]=x;break;case 3:_.splice(4,0,x);break;case 5:_.splice(2,0,x);break;case 6:_[3]=x;break;case 7:_.splice(3,0,x);break;case 8:_[2]=x}return _}containsTile(r,l,f,_=0){const x=Math.max(r.queryPadding,r.evaluateQueryRenderedFeaturePadding())/l._pixelsPerMercatorPixel+1,w=f?this._bufferedCameraMercator(x,l):this._bufferedScreenMercator(x,l);let S=r.tileID.wrap+(w.unwrapped?_:0);const I=w.polygon.map(Z=>o.as(r.tileTransform,Z,S));if(!o.at(I,0,0,o.al,o.al))return;S=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const R=this.screenGeometryMercator.polygon.map(Z=>o.au(r.tileTransform,Z,S)),k=R.map(Z=>new o.P(Z[0],Z[1])),z=l.getFreeCameraOptions().position||new o.ae(0,0,0),M=o.au(r.tileTransform,z,S),B=R.map(Z=>{const q=o.av(Z,Z,M);return o.aw(q,q),new o.ax(M,q)}),j=o.ay(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:B,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(U=o.az(I),U.min.x=o.aA(U.min.x,0,o.al),U.min.y=o.aA(U.min.y,0,o.al),U.max.x=o.aA(U.max.x,0,o.al),U.max.y=o.aA(U.max.y,0,o.al),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(r,l){const f=hn(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[f]=_,_}}_bufferedCameraMercator(r,l){const f=hn(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(x=>l.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[f]=_,_}}_projectAndResample(r,l){const f=function(x,w){const S=o.aB([],w.pixelMatrix,w.globeMatrix),I=[0,-o.aD,0,1],R=[0,o.aD,0,1],k=[0,0,0,1];o.aC(I,I,S),o.aC(R,R,S),o.aC(k,k,S);const z=new o.P(I[0]/I[3],I[1]/I[3]),M=new o.P(R[0]/R[3],R[1]/R[3]),B=o.aE(x,z)&&I[3]<k[3],j=o.aE(x,M)&&R[3]<k[3];if(!B&&!j)return null;const U=function(ve,pe,ce){for(let xe=1;xe<ve.length;xe++){const Me=qi(pe.pointCoordinate3D(ve[xe-1]).x),Ce=qi(pe.pointCoordinate3D(ve[xe]).x);if(ce<0){if(Me<Ce)return{idx:xe,t:-Me/(Ce-1-Me)}}else if(Ce<Me)return{idx:xe,t:(1-Me)/(Ce+1-Me)}}return null}(x,w,B?-1:1);if(!U)return null;const{idx:Z,t:q}=U;let K=Z>1?Xr(x.slice(0,Z),w):[],ne=Z<x.length?Xr(x.slice(Z),w):[];K=K.map(ve=>new o.P(qi(ve.x),ve.y)),ne=ne.map(ve=>new o.P(qi(ve.x),ve.y));const ee=[...K];ee.length===0&&ee.push(ne[ne.length-1]);const ge=o.ak(ee[ee.length-1].y,(ne.length===0?K[0]:ne[0]).y,q);let oe;return oe=B?[new o.P(0,ge),new o.P(0,0),new o.P(1,0),new o.P(1,ge)]:[new o.P(1,ge),new o.P(1,1),new o.P(0,1),new o.P(0,ge)],ee.push(...oe),ne.length===0?ee.push(K[0]):ee.push(...ne),{polygon:ee.map(ve=>new o.ae(ve.x,ve.y)),unwrapped:!1}}(r,l);if(f)return f;const _=function(x,w){let S=!1,I=-1/0,R=0;for(let z=0;z<x.length-1;z++)x[z].x>I&&(I=x[z].x,R=z);for(let z=0;z<x.length-1;z++){const M=(R+z)%(x.length-1),B=x[M],j=x[M+1];Math.abs(B.x-j.x)>.5&&(B.x<j.x?(B.x+=1,M===0&&(x[x.length-1].x+=1)):(j.x+=1,M+1===x.length-1&&(x[0].x+=1)),S=!0)}const k=o.aF(w.center.lng);return S&&k<Math.abs(k-1)&&x.forEach(z=>{z.x-=1}),{polygon:x,unwrapped:S}}(Xr(r,l).map(x=>new o.P(qi(x.x),x.y)),l);return{polygon:_.polygon.map(x=>new o.ae(x.x,x.y)),unwrapped:_.unwrapped}}}function Xr(d,r){return o.aG(d,l=>{const f=r.pointCoordinate3D(l);l.x=f.x,l.y=f.y},1/256)}function qi(d){return d<0?1+d%1:d%1}function hn(d){return 100*d|0}function Ri(d,r,l,f,_){const x=function(S,I){if(S)return _(S);if(I){if(d.url&&I.tiles&&d.tiles&&delete d.tiles,I.variants){if(!Array.isArray(I.variants))return _(new Error("variants must be an array"));for(const k of I.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return _(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){I=Object.assign(I,k);break}}}const R=o.aH(Object.assign({},I,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);R.tiles=r.canonicalizeTileset(R,d.url),_(null,R)}},w=function(S,I,R){if(!S)return null;if(!I&&!R)return S;R=R||S.worldview_default;const k=Object.values(S.language||{});if(k.length===0)return null;const z=Object.values(S.worldview||{});if(z.length===0)return null;const M=k.every(j=>j===I),B=z.every(j=>j===R);return M&&B?S:I in(S.language_options||{})||R in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(d.data,l,f);return w?o.o.frame(()=>x(null,w)):d.url?o.m(r.transformRequest(r.normalizeSourceURL(d.url,null,l,f),o.R.Source),x):o.o.frame(()=>{const{data:S,...I}=d;x(null,I)})}function Wi(d,r){const l=Math.pow(2,r.z),f=Math.floor(o.aF(d.getWest())*l),_=Math.floor(o.aJ(d.getNorth())*l),x=Math.ceil(o.aF(d.getEast())*l),w=Math.ceil(o.aJ(d.getSouth())*l);return r.x>=f&&r.x<x&&r.y>=_&&r.y<w}class qn{constructor(r,l,f){this.bounds=r?o.aI.convert(this.validateBounds(r)):null,this.minzoom=l||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const l of r)this.extraBounds.push(o.aI.convert(this.validateBounds(l)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!Wi(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(Wi(l,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const l=new qn(r.bounds,r.minzoom,r.maxzoom);return l.addExtraBounds(r.extra_bounds),l}}class Gs extends o.E{constructor(r,l,f,_){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(l,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new o.aK}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=Ri(this._options,this.map._requestManager,l,f,(_,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new o.y(_));else if(x){if(Object.assign(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const w of x.vector_layers)this.vectorLayerIds.push(w.id),x.worldview&&x.worldview[w.source]&&this.localizableLayerIds.add(w.id)}this.tileBounds=qn.fromTileJSON(x),Rr(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}r&&r(_)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(r,l){const f=r.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(f),x=this.map._requestManager.transformRequest(_,o.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,S=w?{image:w.image.clone()}:null,I={request:x,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(f)&&(I.localizableLayerIds=this.localizableLayerIds),I.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=l:r.request=r.actor.send("reloadTile",I,R.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",I,R.bind(this),void 0,!0);else{const k=o.aL.call({deduped:this._deduped},I,(z,M)=>{if(z||!M)R.call(this,z);else{const B=o.aM(M.responseHeaders);I.data={cacheControl:B.cacheControl,expires:B.expires,rawData:M.rawData.slice(0)},r.actor&&r.actor.send("loadTile",I,R.bind(this),void 0,!0)}},!0);r.request={cancel:k}}function R(k,z){return delete r.request,r.aborted?l(null):k&&k.status!==404?l(k):(z&&z.resourceTiming&&(r.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&r.setExpiryData(z),r.loadVectorData(z,this.map.painter),o.aN(this.dispatcher),l(null,z),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class la extends o.E{constructor(r,l,f,_){super(),this.id=r,this.dispatcher=f,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},l),Object.assign(this,o.aH(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=Ri(this._options,this.map._requestManager,null,l,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.y(f)):_&&(Object.assign(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),this.tileBounds=qn.fromTileJSON(_),Rr(_.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),r&&r(f)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const f=o.o.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=o.n(this.map._requestManager.transformRequest(_,o.R.Tile),(x,w,S)=>{if(delete r.request,r.aborted)return r.state="unloaded",l(null);if(x)return r.state="errored",l(x);if(!w)return l(null);const I=o.aM(S);this.map._refreshExpiredTiles&&r.setExpiryData(I),r.setTexture(w,this.map.painter),r.state="loaded",o.aN(this.dispatcher),l(null)})}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l&&l()}unloadTile(r,l){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Rc([d,r],l,f,{scaled:_=!0}={}){const{tileSize:x,buffer:w}=f,{x:S,y:I,z:R}=l;if(!isFinite(S)||!isFinite(I)||!isFinite(R))throw new Error("Invalid MRT header");const k=2**R,z=k*o.aF(d),M=k*o.aJ(r);return function([B,j],U,{scaled:Z=!0}={}){if(!U)throw new Error("bandView is undefined");const{data:q,tileSize:K,buffer:ne,offset:ee,scale:ge,dimension:oe}=U;if(B<-ne||B>K+ne||j<-ne||j>K+ne)throw new Error(`Point (${B}, ${j}) out of bounds for tileSize=${K}, buffer=${ne}`);const ve=(j+ne)*(K+2*ne)+(B+ne);if(new Uint32Array(q.buffer)[ve]===4294967295)return null;let pe=[];pe=Z?[]:new U.data.constructor(oe);for(let ce=0;ce<oe;ce++)pe[ce]=Math.round(1e12*(q[oe*ve+ce]*ge+ee))/1e12;return pe}([Math.min(Math.max(-w,Math.floor((z-S)*x)),x-1+w),Math.min(Math.max(-w,Math.floor((M-I)*x)),x-1+w)],f,{scaled:_})}class es extends la{constructor(r,l,f,_){super(r,l,f,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},l)}triggerRepaint(r){const l=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);l&&l.enabled&&f&&l._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,l){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,o.R.Tile),x={request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=_,r.actor||(r.actor=this.dispatcher.getActor());const w=(S,I,R)=>{if(delete r.request,r.aborted)return r.state="unloaded",l(null);if(S)return S.name==="AbortError"?void 0:(r.state="errored",l(S));if(this.map._refreshExpiredTiles&&I){const k=o.aM(R);r.setExpiryData(k)}if(this.partial&&r.state!=="expired")r.state="empty";else if(!this.partial){if(!I)return l(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=I}l(null)};r.request=this.partial?r.fetchHeader(void 0,w.bind(this)):r.actor.send("loadTile",x,w.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,l){const f=r.texturePerLayer;if(r.flushAllQueues(),f.size){r.destroy(!0);for(const _ of f.values())this.map.painter.saveTileTexture(_)}else r.destroy()}prepareTile(r,l,f,_){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBandForRender(l,f,_,(x,w)=>{if(x)return r.state="errored",this.fire(new o.y(x)),void this.triggerRepaint(r);w&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(f,w,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:x})=>x===r),f=l&&l.fields,_=f&&f.bands&&f.bands;return _?_[0]:0}getTextureDescriptor(r,l,f){if(!r)return;const _=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let x=null;l instanceof o.aQ?x=l.paint.get("raster-array-band"):l instanceof o.aR&&(x=l.paint.get("raster-particle-array-band"));const w=x||this.getInitialBand(_);if(w==null)return;if(!r.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(r,_,l.id,w);if(r.updateNeeded(l.id,w)&&!f)return;const S=r.textureDescriptorPerLayer.get(l.id);return Object.assign({},S,{texture:r.texturePerLayer.get(l.id)})}getImages(r,l){const f=new Map;for(const _ of r)for(const x of l){const[w,S]=x.split("/"),I=_.getLayer(w);if(!I||!I.hasBand(S)||!I.hasDataForBand(S))continue;const{bytes:R,tileSize:k,buffer:z}=I.getBandView(S),M=k+2*z,B={data:new o.q({width:M,height:M},R),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(x,B)}return f}queryRasterArrayValueByBandId(r,l,f){const _=l._mrt;return new Promise(x=>{const w={},S=new Set;for(const[I,R]of Object.entries(_.layers)){if(f.layerName&&I!==f.layerName)continue;const k={};w[I]=k;for(const{bands:z}of R.dataIndex)for(const M of z)f.bands&&!f.bands.includes(M)||(S.add(o.B(I,M)),l.fetchBand(I,null,M,B=>{o.o.frame(()=>{k[M]=B?null:Rc([r.lng,r.lat],_,R.getBandView(M)),S.delete(o.B(I,M)),S.size===0&&x(w)})},!1))}S.size===0&&x(w)})}_loadTileForQuery(r,l){if(this._loadTileLoaded[r.uid])return void l(null,r._mrt);if(this._loadTilePending[r.uid])return void this._loadTilePending[r.uid].push(l);this._loadTilePending[r.uid]=[l];const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(f,o.R.Tile);r.actor.send("loadTile",{request:_,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(x,w,S)=>{if(x)return this._loadTilePending[r.uid].forEach(I=>I(x,null)),void delete this._loadTilePending[r.uid];if(!w)return this._loadTilePending[r.uid].forEach(I=>I(null,null)),void delete this._loadTilePending[r.uid];if(this.map._refreshExpiredTiles&&w){const I=o.aM(S);r.setExpiryData(I)}r._mrt=w,r._isHeaderLoaded=!0,r.state="loaded",this._loadTilePending[r.uid].forEach(I=>I(null,w)),this._loadTileLoaded[r.uid]=!0,delete this._loadTilePending[r.uid]},void 0,!0)}queryRasterArrayValueByAllBands(r,l,f){return new Promise((_,x)=>{this._loadTileForQuery(l,(w,S)=>{w?x(w):_(S?this.queryRasterArrayValueByBandId(r,l,f):null)})})}queryRasterArrayValue(r,l){const f=o.aS.convert(r),_=this.findLoadedParent(f);return _&&_._mrt?l.bands||!this.partial?this.queryRasterArrayValueByBandId(f,_,l):this.queryRasterArrayValueByAllBands(f,_,l):Promise.resolve(null)}findLoadedParent(r){const l=o.ae.fromLngLat(r,this.map.transform.tileSize),f=this.maxzoom+1,_=1<<f,x=Math.floor(l.x),w=Math.floor((l.x-x)*_),S=Math.floor(l.y*_),I=this.map.style.getSourceCache(this.id),R=new o.aP(f,x,f,w,S);return I.findLoadedParent(R,this.minzoom)}}const ca={vector:Gs,raster:la,"raster-dem":class extends la{constructor(d,r,l,f){super(d,r,l,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(d,r){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(_,x){_&&(d.state="errored",r(_)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",r(null))}d.request=o.n(this.map._requestManager.transformRequest(l,o.R.Tile),(function(_,x,w){if(delete d.request,d.aborted)d.state="unloaded",r(null);else if(_)d.state="errored",r(_);else if(x){const S=o.aM(w);this.map._refreshExpiredTiles&&d.setExpiryData(S);const I=ImageBitmap&&x instanceof ImageBitmap&&o.r(),R=1-(x.width-o.aO(x.width))/2;R<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const k=I?x:o.o.getImageData(x,R),z={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:R};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",z,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const r=d.canonical,l=Math.pow(2,r.z),f=(r.x-1+l)%l,_=r.x===0?d.wrap-1:d.wrap,x=(r.x+1+l)%l,w=r.x+1===l?d.wrap+1:d.wrap,S={};return S[new o.aP(d.overscaledZ,_,r.z,f,r.y).key]={backfilled:!1},S[new o.aP(d.overscaledZ,w,r.z,x,r.y).key]={backfilled:!1},r.y>0&&(S[new o.aP(d.overscaledZ,_,r.z,f,r.y-1).key]={backfilled:!1},S[new o.aP(d.overscaledZ,d.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},S[new o.aP(d.overscaledZ,w,r.z,x,r.y-1).key]={backfilled:!1}),r.y+1<l&&(S[new o.aP(d.overscaledZ,_,r.z,f,r.y+1).key]={backfilled:!1},S[new o.aP(d.overscaledZ,d.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},S[new o.aP(d.overscaledZ,w,r.z,x,r.y+1).key]={backfilled:!1}),S}},"raster-array":es,geojson:class extends o.E{constructor(d,r,l,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(f),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const _=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*_,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*_,extent:o.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.al,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*_,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const l of this._data.features)r.set(l.id,l);for(const l of d.features)r.set(l.id,l);this._data.features=[...r.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterChildren(d,r){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},r),this}getClusterLeaves(d,r,l,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:r,offset:l},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=Object.assign({append:d},this.workerOptions);r.scope=this.scope;const l=this._data;typeof l=="string"?(r.request=this.map._requestManager.transformRequest(o.o.resolveURL(l),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,_)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.y(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(x.resourceTiming=_.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new o.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=o.B(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,r){const l=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,_=f?{image:f.image.clone()}:null,x=this._partialReload,w={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};d.request=this.actor.send(l,w,(S,I)=>x&&!I?(d.state="loaded",r(null)):(delete d.request,d.destroy(),d.aborted?r(null):S?r(S):(d.loadVectorData(I,this.map.painter,l==="reloadTile"),r(null))),void 0,l==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,r){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aT{constructor(d,r,l,f){super(d,r,l,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const r of d.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aU(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new o.y(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const r=this.video.seekable;d<r.start(0)||d>r.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,r=d.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(d,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aT,model:o.aW,"batched-model":class extends o.E{constructor(d,r,l,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Ri(this._options,this.map._requestManager,r,l,(f,_)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.y(f))):_&&(Object.assign(this,_),_.bounds&&(this.tileBounds=new qn(_.bounds,this.minzoom,this.maxzoom)),Rr(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,r){const l=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=r;else{if(d.buckets){const x=Object.values(d.buckets);for(const w of x)w.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,_.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,_.bind(this),void 0,!0);function _(x,w){return d.aborted?r(null):x&&x.status!==404?r(x):(this.map._refreshExpiredTiles&&w&&d.setExpiryData(w),d.loadModelData(w,this.map.painter),d.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aT{constructor(d,r,l,f){super(d,r,l,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(x=>typeof x!="number"))||this.fire(new o.y(new o.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${d}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof o.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends o.E{constructor(d,r,l,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new qn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:r,y:l,z:f}=d.canonical;return this._implementation.hasTile({x:r,y:l,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,r){const{x:l,y:f,z:_}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:l,y:f,z:_},{signal:x.signal})).then((function(w){return delete d.request,d.aborted?(d.state="unloaded",r(null)):w===void 0?(d.state="errored",r(null)):w===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",r(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(w)?(this.loadTileData(d,w),d.state="loaded",void r(null)):(d.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(w=>{w.name!=="AbortError"&&(d.state="errored",r(w))}),d.request.cancel=()=>x.abort()}loadTileData(d,r){d.setTexture(r,this.map.painter)}unloadTile(d,r){if(d.texture&&d.texture instanceof o.T?(d.destroy(!0),d.texture&&d.texture instanceof o.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:l,y:f,z:_}=d.tileID.canonical;this._implementation.unloadTile({x:l,y:f,z:_})}r&&r()}abortTile(d,r){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=o.B(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},to=function(d,r,l,f){const _=new ca[r.type](d,r,l,f);if(_.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${_.id}`);return o.aX(["load","abort","unload","serialize","prepare"],_),_};function ka(d,r,l=""){return`${l}:${r.id||""}:${r.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:_,importId:x}=f;return`featureset:${_}${x?`:import:${x}`:""}`}}(d.target)}`}function xo(d,r,l,f=""){if(d.uniqueFeatureID){const _=ka(d,r,f);if(l.has(_))return!0;l.add(_)}return!1}function wo(d,r,l,f,_=!1){const x=r.sourceCache.transform,w=r.sourceCache.tilesIn(d,r.has3DLayers,_);w.sort(Qh);const S=[];for(const I of w){const R=I.tile.queryRenderedFeatures(r,I,l,f,x,_);Object.keys(R).length&&S.push({wrappedTileID:I.tile.tileID.wrapped().key,queryResults:R})}for(const I in r.layers){const R=r.layers[I];if(R.styleLayer){const k=R.styleLayer.queryRenderedFeatures(d,r.sourceCache,f);Object.keys(k).length&&S.push({wrappedTileID:0,queryResults:k})}}return S.length===0?{}:function(I){const R={},k={};for(const z of I){const M=z.queryResults,B=z.wrappedTileID,j=k[B]=k[B]||{};for(const U in M){const Z=M[U],q=j[U]=j[U]||{},K=R[U]=R[U]||[];for(const ne of Z)q[ne.featureIndex]||(q[ne.featureIndex]=!0,K.push(ne))}}return R}(S)}function If(d,r,l,f,_,x){const w={},S=f.queryRenderedSymbols(d),I=[];for(const R of Object.keys(S).map(Number))I.push(_[R]);I.sort(Qh);for(const R of I){const k=R.featureIndex.lookupSymbolFeatures(S[R.bucketInstanceId],R.bucketIndex,R.sourceLayerIndex,r,l,x);for(const z in k){const M=w[z]=w[z]||[],B=k[z];B.sort((j,U)=>{const Z=R.featureSortOrder;if(Z){const q=Z.indexOf(j.featureIndex);return Z.indexOf(U.featureIndex)-q}return U.featureIndex-j.featureIndex});for(const j of B)M.push(j)}}return w}function Jh(d,r){const l=d.getRenderableIds().map(x=>d.getTileByID(x)),f=[],_={};for(let x=0;x<l.length;x++){const w=l[x],S=w.tileID.canonical.key;_[S]||(_[S]=!0,w.querySourceFeatures(f,r))}return f}function Qh(d,r){const l=d.tileID,f=r.tileID;return l.overscaledZ-f.overscaledZ||l.canonical.y-f.canonical.y||l.wrap-f.wrap||l.canonical.x-f.canonical.x}function ed(d,r){const l={};if(!r)return l;for(const f of d){const _=f.layerIds.map(x=>r.getLayer(x)).filter(Boolean);if(_.length!==0){f.layers=_,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(x=>_.filter(w=>w.id===x)[0]));for(const x of _)l[x.fqid]=f}}return l}const uo=32,Ma=33,ro=new Uint16Array(8184);for(let d=0;d<2046;d++){let r=d+2,l=0,f=0,_=0,x=0,w=0,S=0;for(1&r?_=x=w=uo:l=f=S=uo;(r>>=1)>1;){const R=l+_>>1,k=f+x>>1;1&r?(_=l,x=f,l=w,f=S):(l=_,f=x,_=w,x=S),w=R,S=k}const I=4*d;ro[I+0]=l,ro[I+1]=f,ro[I+2]=_,ro[I+3]=x}const zo=new Uint16Array(2178),fl=new Uint8Array(1089),kc=new Uint16Array(1089);function Af(d){return d===0?-.03125:d===32?.03125:0}const Cf={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class Ya{constructor(r,l,f,_,x,w){this.tileID=r,this.uid=o.b1(),this.uses=0,this.tileSize=l,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=w,this._hasAppearances=null}registerFadeDuration(r){const l=r+this.timeAdded;l<o.o.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,l,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=ed(r.buckets,l.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.b3){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const x=this.buckets[_];if(x instanceof o.b3&&x.hasRTLText){this.hasRTLText=!0,o.b4();break}}this.queryPadding=0;for(const _ in this.buckets){const x=this.buckets[_],w=l.style.getOwnLayer(_);if(!w)continue;const S=w.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,S)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b2}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,l,f){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,ed(r.buckets,l.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r,l){for(const x in this.buckets){const w=this.buckets[x];if(w.uploadPending()){let S={},I=[],R={zoom:0,pitch:0,brightness:0,worldview:""};if(l){if(l.style){I=l.style.listImages();const k=w.layers[0],z=k.sourceLayer||"_geojsonTileLayer",M=l.style.getLayerSourceCache(k);M&&(S=M._state.getState(z,void 0))}R={zoom:l.transform.zoom||0,pitch:l.transform.pitch||0,brightness:l.style.getBrightness()||0,worldview:l.worldview||""}}w.upload(r,this.tileID.canonical,S,I,R)}}const f=r.gl,_=this.imageAtlas;_&&!_.uploaded&&(this.imageAtlasTexture=new o.T(r,_.image,f.RGBA8,{useMipmap:!!_.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(r,l,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=l.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(l)),(this._lastUpdatedBrightness||_||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}evaluateQueryRenderedFeaturePadding(){let r=0;for(const l in this.buckets){const f=this.buckets[l];f.evaluateQueryRenderedFeaturePadding&&(r=Math.max(r,f.evaluateQueryRenderedFeaturePadding()))}return r}queryRenderedFeatures(r,l,f,_,x,w){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=this.evaluateQueryRenderedFeaturePadding(),I=function(R,k){const z=o.bp([],[.5*R.width,.5*-R.height,1]);return o.bq(z,z,[1,-1,0]),o.aB(z,z,R.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(z)}(x,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:l,pixelPosMatrix:I,transform:_,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:S})}querySourceFeatures(r,l){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const _=f.loadVTLayers(),x=l?l.sourceLayer:"",w=_._geojsonTileLayer||_[x];if(!w)return;const S=o.b5(l&&l.filter),{z:I,x:R,y:k}=this.tileID.canonical,z={z:I,x:R,y:k};for(let M=0;M<w.length;M++){const B=w.feature(M);if(S.needGeometry){const Z=o.b6(B,!0);if(!S.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Z,this.tileID.canonical))continue}else if(!S.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),B))continue;const j=f.getId(B,x),U=new o.b7(B,I,R,k,j);U.tile=z,r.push(U)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const l=this.expirationTime;if(r.cacheControl){const f=o.b8(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let _=!1;if(this.expirationTime>f)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{const x=this.expirationTime-l;x?this.expirationTime=f+Math.max(x,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}hasAppearances(r){for(const l in this.buckets)if(r.style.hasLayer(l)&&this.buckets[l].layers.some(f=>f.appearances&&f.appearances.length>0))return!0;return!1}updateBuckets(r,l){if(!this.latestFeatureIndex||!r.style)return;const f=this.latestFeatureIndex.loadVTLayers(),_=r.style.listImages(),x=r.style.getBrightness();for(const w in this.buckets){if(!r.style.hasLayer(w))continue;const S=this.buckets[w],I=S.layers[0],R=I.sourceLayer||"_geojsonTileLayer",k=f[R],z=r.style.getLayerSourceCache(I);let M={};z&&(M=z._state.getState(R,void 0));const B=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},j=Object.keys(M).length>0&&!l;if(S.hasAppearances=S.layers.some(Z=>Z.appearances&&Z.appearances.length>0),(j&&S.stateDependentLayers.length!==0||l)&&S.update(M,k,_,B,j?S.stateDependentLayers:S.layers,l,x),j&&S.stateDependentLayers.length!==0||l||S.hasAppearances){const Z={zoom:r.transform.zoom,pitch:r.transform.pitch,brightness:r.style.getBrightness()||0,worldview:r.worldview};S.updateAppearances(this.tileID.canonical,M,_,Z)}(S instanceof o.b9||S instanceof o.ba)&&r._terrain&&r._terrain.enabled&&z&&S.uploadPending()&&r._terrain._clearRenderCacheForTile(z.id,this.tileID);const U=r&&r.style&&r.style.getOwnLayer(w);U&&(this.queryPadding=Math.max(this.queryPadding,U.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.o.now()+r}setTexture(r,l){const f=l.context,_=f.gl;this.texture=this.texture||l.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(f,r,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(r,l){const f={};for(const _ of l)f[_]=!0;this.dependencies[r]=f}hasDependency(r,l){for(const f of r){const _=this.dependencies[f];if(_){for(const x of l)if(_[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const f=o.bb(Cf,this.tileID.canonical,this.tileTransform)[0],_=new o.bc,x=new o.bd;for(let w=0;w<f.length;w++){const{x:S,y:I}=f[w];_.emplaceBack(S,I),x.emplaceBack(w)}x.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(x),this._tileDebugBuffer=r.createVertexBuffer(_,o.be.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,_.length,x.length)}_makeTileBoundsBuffers(r,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const f=o.bb(Cf,this.tileID.canonical,this.tileTransform)[0];let _,x;if(this.isRaster){const w=function(S,I){const R=o.aY(S,I),k=Math.pow(2,S.z);for(let Z=0;Z<Ma;Z++)for(let q=0;q<Ma;q++){const K=o.aZ((S.x+(q+Af(q))/uo)/k),ne=o.a_((S.y+(Z+Af(Z))/uo)/k),ee=I.project(K,ne),ge=Z*Ma+q;zo[2*ge+0]=Math.round((ee.x*R.scale-R.x)*o.al),zo[2*ge+1]=Math.round((ee.y*R.scale-R.y)*o.al)}fl.fill(0),kc.fill(0);for(let Z=2045;Z>=0;Z--){const q=4*Z,K=ro[q+0],ne=ro[q+1],ee=ro[q+2],ge=ro[q+3],oe=K+ee>>1,ve=ne+ge>>1,pe=oe+ve-ne,ce=ve+K-oe,xe=ne*Ma+K,Me=ge*Ma+ee,Ce=ve*Ma+oe,We=Math.hypot((zo[2*xe+0]+zo[2*Me+0])/2-zo[2*Ce+0],(zo[2*xe+1]+zo[2*Me+1])/2-zo[2*Ce+1])>=16;fl[Ce]=fl[Ce]||(We?1:0),Z<1022&&(fl[Ce]=fl[Ce]||fl[(ne+ce>>1)*Ma+(K+pe>>1)]||fl[(ge+ce>>1)*Ma+(ee+pe>>1)])}const z=new o.a$,M=new o.b0;let B=0;function j(Z,q){const K=q*Ma+Z;return kc[K]===0&&(z.emplaceBack(zo[2*K+0],zo[2*K+1],Z*o.al/uo,q*o.al/uo),kc[K]=++B),kc[K]-1}function U(Z,q,K,ne,ee,ge){const oe=Z+K>>1,ve=q+ne>>1;if(Math.abs(Z-ee)+Math.abs(q-ge)>1&&fl[ve*Ma+oe])U(ee,ge,Z,q,oe,ve),U(K,ne,ee,ge,oe,ve);else{const pe=j(Z,q),ce=j(K,ne),xe=j(ee,ge);M.emplaceBack(pe,ce,xe)}}return U(0,0,uo,uo,uo,0),U(uo,uo,0,0,0,uo),{vertices:z,indices:M}}(this.tileID.canonical,l);_=w.vertices,x=w.indices}else{_=new o.a$,x=new o.b0;for(const{x:S,y:I}of f)_.emplaceBack(S,I,0,0);const w=o.bg(_.int16.subarray(0,4*_.length),void 0,4);for(let S=0;S<w.length;S+=3)x.emplaceBack(w[S],w[S+1],w[S+2])}this._tileBoundsBuffer=r.createVertexBuffer(_,o.bh.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(x),this._tileBoundsSegments=o.bf.simpleSegment(0,0,_.length,x.length)}_makeGlobeTileDebugBuffers(r,l){const f=l.projection;if(!f||f.name!=="globe"||l.freezeTileCoverage)return;const _=this.tileID.canonical,x=o.bi(_,l),w=o.bj(x),S=o.aj(l.zoom);let I;S>0&&(I=o.bk(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,_,l,w,I,S),this._makeGlobeTileDebugTextBuffer(r,_,l,w,I,S)}_globePoint(r,l,f,_,x,w,S){let I=o.bl(r,l,f);if(w){const R=1<<f.z,k=o.aF(_.center.lng),z=o.aJ(_.center.lat),M=(f.x+.5)/R-k;let B=0;M>.5?B=-1:M<-.5&&(B=1);let j=(r/o.al+f.x)/R+B,U=(l/o.al+f.y)/R;j=(j-k)*_._pixelsPerMercatorPixel+k,U=(U-z)*_._pixelsPerMercatorPixel+z;const Z=[j*_.worldSize,U*_.worldSize,0];o.af(Z,Z,w),I=o.bm(I,Z,S)}return o.af(I,I,x)}_makeGlobeTileDebugBorderBuffer(r,l,f,_,x,w){const S=new o.bc,I=new o.bd,R=new o.bn,k=(M,B,j,U,Z)=>{const q=(j-M)/(Z-1),K=(U-B)/(Z-1),ne=S.length;for(let ee=0;ee<Z;ee++){const ge=M+ee*q,oe=B+ee*K;S.emplaceBack(ge,oe);const ve=this._globePoint(ge,oe,l,f,_,x,w);R.emplaceBack(ve[0],ve[1],ve[2]),I.emplaceBack(ne+ee)}},z=o.al;k(0,0,z,0,16),k(z,0,z,z,16),k(z,z,0,z,16),k(0,z,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(I),this._tileDebugBuffer=r.createVertexBuffer(S,o.be.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(R,o.bo.members),this._tileDebugSegments=o.bf.simpleSegment(0,0,S.length,I.length)}_makeGlobeTileDebugTextBuffer(r,l,f,_,x,w){const S=o.al/4,I=new o.bc,R=new o.b0,k=new o.bn,z=25;R.reserve(32),I.reserve(z),k.reserve(z);const M=(B,j)=>z*B+j;for(let B=0;B<z;B++){const j=B*S;for(let U=0;U<z;U++){const Z=U*S;I.emplaceBack(Z,j);const q=this._globePoint(Z,j,l,f,_,x,w);k.emplaceBack(q[0],q[1],q[2])}}for(let B=0;B<4;B++)for(let j=0;j<4;j++){const U=M(B,j),Z=M(B,j+1),q=M(B+1,j),K=M(B+1,j+1);R.emplaceBack(U,Z,q),R.emplaceBack(q,Z,K)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(R),this._tileDebugTextBuffer=r.createVertexBuffer(I,o.be.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(k,o.bo.members),this._tileDebugTextSegments=o.bf.simpleSegment(0,0,z,32)}destroy(r=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.br.setPbf(o.bs);class Yl extends Ya{constructor(r,l,f,_,x){super(r,l,f,_,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,l,f){const _=f.context,x=_.gl;let w=this.texturePerLayer.get(r)||f.getTileTexture(l.width);w&&w instanceof o.T?w.update(l,{premultiply:!1}):w=new o.T(_,l,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,w)}flushQueues(r){const l=this._workQueuePerLayer.get(r)||[],f=this._fetchQueuePerLayer.get(r)||[];for(;l.length;)l.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(r)||[];for(;l.length;)l.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(r)||[];for(;l.length;)l.pop()()}}fetchHeader(r=16384,l){const f=this._mrt=new o.br(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.bt(_,(x,w,S)=>{if(x)l(x);else try{const I=f.getHeaderLength(w);if(I>r)return void(this.request=this.fetchHeader(I,l));f.parseHeader(w),this._isHeaderLoaded=!0;let R=0;for(const k of Object.values(f.layers))R=Math.max(R,k.dataIndex[k.dataIndex.length-1].lastByte);w.byteLength>=R&&(this.entireBuffer=w),l(null,this.entireBuffer||w,S)}catch(I){l(I)}}),this.request}fetchBandForRender(r,l,f,_){this.fetchBand(r,l,f,x=>{if(x)return void _(x);this.updateTextureDescriptor(r,l,f);const w=this.textureDescriptorPerLayer.get(l);_(null,w?w.img:null)})}fetchBand(r,l,f,_,x=!0){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void _(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void _(new Error("Can't fetch tile band without an actor"));let I;const R=o.B(String(f),o.B(this.tileID.key,r));let k=this._taskQueue.get(R);k?k.add(_):(k=new Set,k.add(_),this._taskQueue.set(R,k));const z=(U,Z)=>{I.complete(U,Z),U?_(U):(k.values().forEach(q=>q(null,Z)),this._taskQueue.delete(R))},M=(U,Z)=>{if(U)return _(U);const q=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:Z,task:I},z,void 0,!0);if(l!==null){const K=this._workQueuePerLayer.get(l)||[];K.push(()=>{q&&q.cancel(),I.cancel()}),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,K)}};let B;try{B=w.getLayer(r)}catch(U){if(this.state==="reloading")return;throw U}if(!B)return void _(new Error(`Unknown sourceLayer "${r}"`));if(B.hasDataForBand(f))return k.values().forEach(U=>U(null,null)),void this._taskQueue.delete(R);const j=B.getDataRange([f]);if(I=w.createDecodingTask(j),!I||I.tasks.length)if(l!==null&&this.flushQueues(l),this.entireBuffer)M(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const U=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),Z=o.bt(U,M);if(l!==null){const q=this._fetchQueuePerLayer.get(l)||[];q.push(()=>{Z.cancel(),I.cancel()}),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,q)}}}updateNeeded(r,l){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==l||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(r,l,f){if(!this._mrt)return;const _=this._mrt.getLayer(r);if(!_||!_.hasBand(f)||!_.hasDataForBand(f))return;const{bytes:x,tileSize:w,buffer:S,offset:I,scale:R}=_.getBandView(f),k=w+2*S,z=new o.q({width:k,height:k},x),M=this.texturePerLayer.get(l);M&&M instanceof o.T&&M.update(z,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:r,band:f,img:z,buffer:S,offset:I,tileSize:w,format:_.pixelFormat,mix:[R,256*R,65536*R,16777216*R]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const l of this.texturePerLayer.values())l&&l instanceof o.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class cg{constructor(r,l){this.max=r,this.onRemove=l,this.reset()}reset(){for(const r in this.data)for(const l of this.data[r])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(r,l,f){const _=r.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const x={value:l,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(r,x)},f)),this.data[_].push(x),this.order.push(_),this.order.length>this.max){const w=this._getAndRemoveByKey(this.order[0]);w&&this.onRemove(w)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const l=this.data[r].shift();return l.timeout&&clearTimeout(l.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),l.value}getByKey(r){const l=this.data[r];return l?l[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,l){if(!this.has(r))return this;const f=r.wrapped().key,_=l===void 0?0:this.data[f].indexOf(l),x=this.data[f][_];return this.data[f].splice(_,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(r){const l=[];for(const f in this.data)for(const _ of this.data[f])r(_.value)||l.push(_);for(const f of l)this.remove(f.value.tileID,f)}}class R0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,l,f){const _=String(l);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][_]=this.stateChanges[r][_]||{},Object.assign(this.stateChanges[r][_],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const x in this.state[r])x!==_&&(this.deletedStates[r][x]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][_]===null){this.deletedStates[r][_]={};for(const x in this.state[r][_])f[x]||(this.deletedStates[r][_][x]=null)}else for(const x in f)this.deletedStates[r]&&this.deletedStates[r][_]&&this.deletedStates[r][_][x]===null&&delete this.deletedStates[r][_][x]}removeFeatureState(r,l,f){if(this.deletedStates[r]===null)return;const _=String(l);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&l!==void 0)this.deletedStates[r][_]!==null&&(this.deletedStates[r][_]=this.deletedStates[r][_]||{},this.deletedStates[r][_][f]=null);else if(l!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][_])for(f in this.deletedStates[r][_]={},this.stateChanges[r][_])this.deletedStates[r][_][f]=null;else this.deletedStates[r][_]=null;else this.deletedStates[r]=null}getState(r,l){const f=this.state[r]||{},_=this.stateChanges[r]||{},x=this.deletedStates[r];if(x===null)return{};if(l!==void 0){const S=String(l),I=Object.assign({},f[S],_[S]);if(x){const R=x[l];if(R===null)return{};for(const k in R)delete I[k]}return I}const w=Object.assign({},f,_);if(x)for(const S in x)delete w[S];return w}initializeTileState(r,l){r.refreshFeatureState(l)}coalesceChanges(r,l){const f={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const x={};for(const w in this.stateChanges[_])this.state[_][w]||(this.state[_][w]={}),Object.assign(this.state[_][w],this.stateChanges[_][w]),x[w]=this.state[_][w];f[_]=x}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const x={};if(this.deletedStates[_]===null)for(const w in this.state[_])x[w]={},this.state[_][w]={};else for(const w in this.deletedStates[_]){if(this.deletedStates[_][w]===null)this.state[_][w]={};else if(this.state[_][w])for(const S of Object.keys(this.deletedStates[_][w]))delete this.state[_][w][S];x[w]=this.state[_][w]}f[_]=f[_]||{},Object.assign(f[_],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const _ in r)r[_].refreshFeatureState(l)}}class ua extends o.E{constructor(r,l,f){super(),this.id=r,this._onlySymbols=f,l.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new cg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new R0,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,l){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,l)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const f=this._tiles[l];f.upload(r,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(ug).map(r=>r.key)}getRenderableIds(r,l){const f=[];for(const _ in this._tiles)this._isIdRenderable(+_,r,l)&&f.push(this._tiles[_]);return r?f.sort((_,x)=>{const w=_.tileID,S=x.tileID,I=new o.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),R=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||R.y-I.y||R.x-I.x}).map(_=>_.tileID.key):f.map(_=>_.tileID).sort(ug).map(_=>_.key)}hasRenderableParent(r){const l=this.findLoadedParent(r,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(r,l,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(l||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,l){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=l),this._loadTile(f,this._tileLoaded.bind(this,f,r,l)))}_tileLoaded(r,l,f,_,x){if(_){if(r.state="errored",_.status!==404)this._source.fire(new o.y(_,{tile:r}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const S=this.map.painter.terrain;this.update(this.transform,S.getScaledDemTileSize(),!0),S.resetTileLookupCache(this.id)}else this.update(this.transform)}return}r.timeAdded=o.o.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(l,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null);let w=new Map;x&&x.responseHeaders&&(w=x.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id,responseHeaders:w}))}_backfillDEM(r){const l=this.getRenderableIds();for(let _=0;_<l.length;_++){const x=l[_];if(r.neighboringTiles&&r.neighboringTiles[x]){const w=this.getTileByID(x);f(r,w),f(w,r)}}function f(_,x){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let w=x.tileID.canonical.x-_.tileID.canonical.x;const S=x.tileID.canonical.y-_.tileID.canonical.y,I=Math.pow(2,_.tileID.canonical.z),R=x.tileID.key;w===0&&S===0||Math.abs(S)>1||(Math.abs(w)>1&&(Math.abs(w+I)===1?w+=I:Math.abs(w-I)===1&&(w-=I)),x.dem&&_.dem&&(_.dem.backfillBorder(x.dem,w,S),_.neighboringTiles&&_.neighboringTiles[R]&&(_.neighboringTiles[R].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,l,f,_){for(const x in this._tiles){let w=this._tiles[x];if(_[x]||!w.hasData()||w.tileID.overscaledZ<=l||w.tileID.overscaledZ>f)continue;let S=w.tileID;for(;w&&w.tileID.overscaledZ>l+1;){const R=w.tileID.scaledTo(w.tileID.overscaledZ-1);w=this._tiles[R.key],w&&w.hasData()&&(S=R)}let I=S;for(;I.overscaledZ>l;)if(I=I.scaledTo(I.overscaledZ-1),r[I.key]){_[S.key]=S;break}}}findLoadedParent(r,l){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=l?f:null}for(let f=r.overscaledZ-1;f>=l;f--){const _=r.scaledTo(f),x=this._getLoadedTile(_);if(x)return x}}_getLoadedTile(r){const l=this._tiles[r.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,l){l=l||this._source.tileSize;const f=Math.ceil(r.width/l)+1,_=Math.ceil(r.height/l)+1,x=Math.floor(f*_*5),w=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(S)}handleWrapJump(r){const l=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,l){const f={};for(const _ in this._tiles){const x=this._tiles[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),f[x.tileID.key]=x}this._tiles=f;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(r,l,f,_,x){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(r,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let S,I=this._source.maxzoom;const R=this.map&&this.map.painter?this.map.painter._terrain:null;if(R&&R.sourceCache===this&&R.attenuationRange()){const M=R.attenuationRange()[0],B=Math.floor(M)-Math.log2(R.getDemUpscale());I>B&&(I=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new o.aP(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y));else if(this.tileCoverLift!==0){const M=r.clone();M.tileCoverLift=this.tileCoverLift,S=M.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&r.projection.name==="globe"&&(S.push(new o.aP(1,0,1,0,0)),S.push(new o.aP(1,0,1,1,0)),S.push(new o.aP(1,0,1,0,1)),S.push(new o.aP(1,0,1,1,1)))}else if(S=r.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const M=this._source.hasTile.bind(this._source);S=S.filter(B=>M(B))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Mc(this._source.type)){const M=r.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),B=Math.min(M,this._source.maxzoom);if(w){const j=r.extendTileCover(S,B);for(const U of j)S.push(U)}else if(x){const j=r.extendTileCoverToNearPlane(S,this.transform.getFrustum(B),B);for(const U of j)S.push(U)}else if(this.castsShadows&&_){const j=r.extendTileCover(S,B,_);for(const U of j)this._shadowCasterTiles[U.key]=!0,S.push(U)}}const k=this._updateRetainedTiles(S);if(Mc(this._source.type)&&S.length!==0){const M={},B={},j=Object.keys(k);for(const Z of j){const q=k[Z],K=this._tiles[Z];if(!K||K.fadeEndTime&&K.fadeEndTime<=o.o.now())continue;const ne=this.findLoadedParent(q,Math.max(q.overscaledZ-ua.maxOverzooming,this._source.minzoom));ne&&(this._addTile(ne.tileID),M[ne.tileID.key]=ne.tileID),B[Z]=q}const U=S[S.length-1].overscaledZ;for(const Z in this._tiles){const q=this._tiles[Z];if(k[Z]||!q.hasData())continue;let K=q.tileID;for(;K.overscaledZ>U;){K=K.scaledTo(K.overscaledZ-1);const ne=this._tiles[K.key];if(ne&&ne.hasData()&&B[K.key]){k[Z]=q.tileID;break}}}for(const Z in M)k[Z]||(this._coveredTiles[Z]=!0,k[Z]=M[Z])}for(const M in k)this._tiles[M].clearFadeHold();const z=o.bu(this._tiles,k);for(const M of z){const B=this._tiles[M];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const l={};if(r.length===0)return l;const f={},_=r.reduce((R,k)=>Math.min(R,k.overscaledZ),1/0),x=r[0].overscaledZ,w=Math.max(x-ua.maxOverzooming,this._source.minzoom),S=Math.max(x+ua.maxUnderzooming,this._source.minzoom),I={};for(const R of r){const k=this._addTile(R);l[R.key]=R,k.hasData()||_<this._source.maxzoom&&(I[R.key]=R)}this._retainLoadedChildren(I,_,S,l);for(const R of r){let k=this._tiles[R.key];if(k.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const M=R.children(this._source.maxzoom)[0],B=this.getTile(M);if(B&&B.hasData()){l[M.key]=M;continue}}else{const M=R.children(this._source.maxzoom);if(l[M[0].key]&&l[M[1].key]&&l[M[2].key]&&l[M[3].key])continue}let z=k.wasRequested();for(let M=R.overscaledZ-1;M>=w;--M){const B=R.scaledTo(M);if(f[B.key]||(f[B.key]=!0,k=this.getTile(B),!k&&z&&(k=this._addTile(B)),k&&(l[B.key]=B,z=k.wasRequested(),k.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const l=[];let f,_=this._tiles[r].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){f=this._loadedParentTiles[_.key];break}l.push(_.key);const x=_.scaledTo(_.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;_=x}for(const x of l)this._loadedParentTiles[x]=f}}_addTile(r){let l=this._tiles[r.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),l;l=this._cache.getAndRemove(r),l&&(this._setTileReloadTimer(r.key,l),l.tileID=r,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,l)));const f=!!l;if(!f){const _=this.map?this.map.painter:null,x=this._source.tileSize*r.overscaleFactor();l=this._source.type==="raster-array"?new Yl(r,x,this.transform.tileZoom,_,this._isRaster):new Ya(r,x,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,r.key,l.state))}return l.uses++,this._tiles[r.key]=l,f||this._source.fire(new o.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(r,l){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=l.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const l=this._tiles[r];l&&(l.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,l,f){const _=[],x=this.transform;if(!x)return _;const w=x.projection.name==="globe",S=o.aF(x.center.lng);for(const I in this._tiles){const R=this._tiles[I];if(f&&R.clearQueryDebugViz(),R.holdingForFade())continue;let k;if(w){const z=R.tileID.canonical;if(z.z===0){const M=[Math.abs(o.aA(S,...Oc(z,-1))-S),Math.abs(o.aA(S,...Oc(z,1))-S)];k=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(o.aA(S,...Oc(z,-1))-S),Math.abs(o.aA(S,...Oc(z,0))-S),Math.abs(o.aA(S,...Oc(z,1))-S)];k=[M.indexOf(Math.min(...M))-1]}}else k=[0];for(const z of k){const M=r.containsTile(R,x,l,z);M&&_.push(M)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,l){const f=this.getRenderableIds(r,l).map(x=>this._tiles[x].tileID),_=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=_?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(r){const l=r.slice(),f=this.transform._camera.position,_=this.transform._camera.forward(),x={};for(const w of l){const S=1/(1<<w.canonical.z);x[w.key]=((w.canonical.x+.5)*S+w.wrap-f[0])*_[0]+((w.canonical.y+.5)*S-f[1])*_[1]-f[2]*_[2]}return l.sort((w,S)=>x[w.key]-x[S.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Mc(this._source.type))for(const r in this._tiles){const l=this._tiles[r];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(r,l,f){this._state.updateState(r=r||"_geojsonTileLayer",l,f)}removeFeatureState(r,l,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",l,f)}getFeatureState(r,l){return this._state.getState(r=r||"_geojsonTileLayer",l)}setDependencies(r,l,f){const _=this._tiles[r];_&&_.setDependencies(l,f)}reloadTilesForDependencies(r,l){for(const f in this._tiles)this._tiles[f].hasDependency(r,l)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,l))}_preloadTiles(r,l){if(!this._sourceLoaded){const I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(r,l))};return void this._source.on("data",I)}const f=new Map,_=Array.isArray(r)?r:[r],x=this.map.painter.terrain,w=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const I of _){const R=I.coveringTiles({tileSize:w,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of R)f.set(k.key,k);this.usedForTerrain&&I.updateElevation(!1)}const S=Array.from(f.values());o.bv(S,(I,R)=>{const k=new Ya(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,z=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),R(z,k)})},l)}}function ug(d,r){const l=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return d.overscaledZ-r.overscaledZ||f-l||r.canonical.y-d.canonical.y||r.canonical.x-d.canonical.x}function Mc(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Oc(d,r){const l=1<<d.z;return[d.x/l+r,(d.x+1)/l+r]}ua.maxOverzooming=10,ua.maxUnderzooming=3;class hg{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,l=!1;for(const f in this.style._mergedLayers){const _=this.style._mergedLayers[f];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:r,visibilityChanged:l});else if(_.type==="model"){const x=this.style.getLayerSource(_);x&&x.type==="batched-model"&&this.layers.push({layer:_,visible:r,visibilityChanged:l})}}}onNewFrame(r){this.layersGotHidden=!1;for(const l of this.layers){const f=l.layer;let _=!1;f.type==="fill-extrusion"?_=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?_=!f.isHidden(r)&&f.paint.get("building-opacity")>0:f.type==="model"&&(_=!f.isHidden(r)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&l.visible,l.visible=_}}updateZOffset(r,l){this.currentBuildingBuckets=[];for(const _ of this.layers){const x=_.layer,w=this.style.getLayerSourceCache(x);let S=1;x.type==="fill-extrusion"?S=_.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(S=_.visible?x.paint.get("building-vertical-scale"):0);let I=w?w.getTile(l):null;if(!I&&w)for(const R in w._tiles){const k=w._tiles[R];if(l.canonical.isChildOf(k.tileID.canonical)){I=k;break}}this.currentBuildingBuckets.push({bucket:I?I.getBucket(x):null,tileID:I?I.tileID:l,verticalScale:S})}r.hasAnyZOffset=!1;let f=!1;for(let _=0;_<r.symbolInstances.length;_++){const x=r.symbolInstances.get(_),w=x.zOffset,S=this._getHeightAtTileOffset(l,x.tileAnchorX,x.tileAnchorY);x.zOffset=S!==Number.NEGATIVE_INFINITY?S:w,f||w===x.zOffset||(f=!0),r.hasAnyZOffset||x.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,l,f,_){let x=l,w=f;if(r.canonical.z!==_.canonical.z){const S=_.canonical,I=1/(1<<r.canonical.z-S.z);x=(l+r.canonical.x*o.al)*I-S.x*o.al|0,w=(f+r.canonical.y*o.al)*I-S.y*o.al|0}return{tileX:x,tileY:w}}_getHeightAtTileOffset(r,l,f){let _,x;for(let w=0;w<this.layers.length;++w){const S=this.layers[w].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:I,tileID:R,verticalScale:k}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:z,tileY:M}=this._mapCoordToOverlappingTile(r,l,f,R),B=I.getHeightAtTileCoord(z,M);B&&B.height!==void 0&&(B.hidden?_=B.height:x=Math.max(B.height*k,x||0))}if(x!==void 0)return x;for(let w=0;w<this.layers.length;++w){const S=this.layers[w];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:I,tileID:R}=this.currentBuildingBuckets[w];if(!I)continue;const{tileX:k,tileY:z}=this._mapCoordToOverlappingTile(r,l,f,R),M=I.getHeightAtTileCoord(k,z);if(M&&!M.hidden)return M.height===void 0&&_!==void 0?Math.min(M.maxHeight,_)*M.verticalScale:M.height?M.height*M.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function td(d,r){const l={};for(const f in d)f!=="ref"&&(l[f]=d[f]);return o.bw.forEach(f=>{f in r&&(l[f]=r[f])}),l}function vu(d){d=d.slice();const r=Object.create(null);for(let l=0;l<d.length;l++)r[d[l].id]=d[l];for(let l=0;l<d.length;l++)"ref"in d[l]&&(d[l]=td(d[l],r[d[l].ref]));return d}const fi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function dg(d,r,l){l.push({command:fi.addSource,args:[d,r[d]]})}function rd(d,r,l){r.push({command:fi.removeSource,args:[d]}),l[d]=!0}function id(d,r,l,f){rd(d,l,f),dg(d,r,l)}function fg(d,r,l){let f;for(f in d[l])if(d[l].hasOwnProperty(f)&&f!=="data"&&!o.bx(d[l][f],r[l][f]))return!1;for(f in r[l])if(r[l].hasOwnProperty(f)&&f!=="data"&&!o.bx(d[l][f],r[l][f]))return!1;return!0}function nd(d,r,l,f,_,x){let w;for(w in r=r||{},d=d||{})d.hasOwnProperty(w)&&(o.bx(d[w],r[w])||l.push({command:x,args:[f,w,r[w],_]}));for(w in r)r.hasOwnProperty(w)&&!d.hasOwnProperty(w)&&(o.bx(d[w],r[w])||l.push({command:x,args:[f,w,r[w],_]}))}function sd(d){return d.id}function od(d,r){return d[r.id]=r,d}function Dc(d,r,l){const f=r.createTileMatrix(d,d.worldSize,l.toUnwrapped());return o.aB(new Float32Array(16),d.projMatrix,f)}function k0(d,r,l){if(r.projection.name===l.projection.name)return d.projMatrix;const f=l.clone();return f.setProjection(r.projection),Dc(f,r.getProjection(),d)}function Pf(d,r,l){return r.name===l.projection.name?d.projMatrix:Dc(l,r,d)}class Kw{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aA(r,0,1);let l=1,f=this._distances[l];const _=r*this.paddedLength+this.padding;for(;f<_&&l<this._distances.length;)f=this._distances[++l];const x=l-1,w=this._distances[x],S=f-w,I=S>0?(_-w)/S:0;return this.points[x].mult(1-I).add(this.points[l].mult(I))}}class ad{constructor(r,l,f){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(l/f);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,f,_,x){this._forEachCell(l,f,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(r,l,f,_){this._forEachCell(l-_,f-_,l+_,f+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(f),this.circles.push(_)}_insertBoxCell(r,l,f,_,x,w){this.boxCells[x].push(w)}_insertCircleCell(r,l,f,_,x,w){this.circleCells[x].push(w)}_query(r,l,f,_,x,w){if(f<0||r>this.width||_<0||l>this.height)return!x&&[];const S=[];if(r<=0&&l<=0&&this.width<=f&&this.height<=_){if(x)return!0;for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const R=this.circles[3*I],k=this.circles[3*I+1],z=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:R-z,y1:k-z,x2:R+z,y2:k+z})}return w?S.filter(w):S}return this._forEachCell(r,l,f,_,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?S.length>0:S}_queryCircle(r,l,f,_,x){const w=r-f,S=r+f,I=l-f,R=l+f;if(S<0||w>this.width||R<0||I>this.height)return!_&&[];const k=[];return this._forEachCell(w,I,S,R,this._queryCellCircle,k,{hitTest:_,circle:{x:r,y:l,radius:f},seenUids:{box:{},circle:{}}},x),_?k.length>0:k}query(r,l,f,_,x){return this._query(r,l,f,_,!1,x)}hitTest(r,l,f,_,x){return this._query(r,l,f,_,!0,x)}hitTestCircle(r,l,f,_){return this._queryCircle(r,l,f,!0,_)}_queryCell(r,l,f,_,x,w,S,I){const R=S.seenUids,k=this.boxCells[x];if(k!==null){const M=this.bboxes;for(const B of k)if(!R.box[B]){R.box[B]=!0;const j=4*B;if(r<=M[j+2]&&l<=M[j+3]&&f>=M[j+0]&&_>=M[j+1]&&(!I||I(this.boxKeys[B]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[B],x1:M[j],y1:M[j+1],x2:M[j+2],y2:M[j+3]})}}}const z=this.circleCells[x];if(z!==null){const M=this.circles;for(const B of z)if(!R.circle[B]){R.circle[B]=!0;const j=3*B;if(this._circleAndRectCollide(M[j],M[j+1],M[j+2],r,l,f,_)&&(!I||I(this.circleKeys[B]))){if(S.hitTest)return w.push(!0),!0;{const U=M[j],Z=M[j+1],q=M[j+2];w.push({key:this.circleKeys[B],x1:U-q,y1:Z-q,x2:U+q,y2:Z+q})}}}}}_queryCellCircle(r,l,f,_,x,w,S,I){const R=S.circle,k=S.seenUids,z=this.boxCells[x];if(z!==null){const B=this.bboxes;for(const j of z)if(!k.box[j]){k.box[j]=!0;const U=4*j;if(this._circleAndRectCollide(R.x,R.y,R.radius,B[U+0],B[U+1],B[U+2],B[U+3])&&(!I||I(this.boxKeys[j])))return w.push(!0),!0}}const M=this.circleCells[x];if(M!==null){const B=this.circles;for(const j of M)if(!k.circle[j]){k.circle[j]=!0;const U=3*j;if(this._circlesCollide(B[U],B[U+1],B[U+2],R.x,R.y,R.radius)&&(!I||I(this.circleKeys[j])))return w.push(!0),!0}}}_forEachCell(r,l,f,_,x,w,S,I){const R=this._convertToXCellCoord(r),k=this._convertToYCellCoord(l),z=this._convertToXCellCoord(f),M=this._convertToYCellCoord(_);for(let B=R;B<=z;B++)for(let j=k;j<=M;j++)if(x.call(this,r,l,f,_,this.xCellCount*j+B,w,S,I))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,f,_,x,w){const S=_-r,I=x-l,R=f+w;return R*R>S*S+I*I}_circleAndRectCollide(r,l,f,_,x,w,S){const I=(w-_)/2,R=Math.abs(r-(_+I));if(R>I+f)return!1;const k=(S-x)/2,z=Math.abs(l-(x+k));if(z>k+f)return!1;if(R<=I||z<=k)return!0;const M=R-I,B=z-k;return M*M+B*B<=f*f}}const Fo={unknown:0,flipRequired:1,flipNotRequired:2},ld=Math.tan(85*Math.PI/180);function xu(d,r,l,f,_,x,w){const S=o.bB();if(l)if(x.name==="globe"){const I=o.bC(_,r);o.aB(S,S,I)}else{const I=o.bD([],w);S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],f||o.bA(S,S,_.angle)}else o.aB(S,_.labelPlaneMatrix,d);return S}function cd(d,r,l,f,_,x,w){const S=xu(d,r,l,f,_,x,w);return x.name==="globe"&&l||(S[2]=S[6]=S[10]=S[14]=0),S}function pl(d,r,l,f,_,x,w){if(l){if(x.name==="globe"){const S=xu(d,r,l,f,_,x,w);return o.bk(S,S),o.aB(S,d,S),S}{const S=o.by(d),I=o.bz([]);return I[0]=w[0],I[1]=w[1],I[4]=w[2],I[5]=w[3],o.aB(S,S,I),f||o.bA(S,S,-_.angle),S}}return _.glCoordMatrix}function Wn(d,r,l,f){const _=[d,r,l,1];l?o.aC(_,_,f):ha(_,_,f);const x=_[3];return _[0]/=x,_[1]/=x,_[2]/=x,_}function pg(d,r){return Math.min(.5+d/r*.5,1.5)}function mg(d,r){const l=d[0]/d[3],f=d[1]/d[3];return l>=-r[0]&&l<=r[0]&&f>=-r[1]&&f<=r[1]}function gg(d,r,l,f,_,x,w,S,I,R,k=1){const z=l.transform,M=f?d.textSizeData:d.iconSizeData,B=o.bJ(M,l.transform.zoom,k),j=z.projection.name==="globe",U=[256/l.width*2+1,256/l.height*2+1],Z=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;Z.clear();let q=null;j&&(q=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const K=d.lineVertexArray,ne=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,ee=l.transform.width/l.transform.height;let ge,oe=!1;for(let ve=0;ve<ne.length;ve++){const pe=ne.get(ve),{numGlyphs:ce,writingMode:xe}=pe;if(xe!==o.bK.vertical||oe||ge===o.bK.horizontal||(oe=!0),ge=xe,(pe.hidden||xe===o.bK.vertical)&&!oe){ml(ce,Z);continue}oe=!1;const Me=new o.P(pe.tileAnchorX,pe.tileAnchorY),Ce=d.elevationType==="road",We=!!z.elevation||Ce;let{x:Ne,y:Qe,z:_t}=z.projection.projectTilePoint(Me.x,Me.y,R.canonical),Fe=null;if(We){const Dt=Ce?d.getElevationFeatureForText(ve):null;Fe={getElevation:I,elevation:z.elevation,elevationFeature:Dt};const[lr,Ur,Jr]=I(Me,z.elevation,Dt);Ne+=lr,Qe+=Ur,_t+=Jr}const Ie=[Ne,Qe,_t,1];if(o.aC(Ie,Ie,r),!mg(Ie,U)){ml(ce,Z);continue}const et=Ie[3],je=pg(l.transform.getCameraToCenterDistance(z.projection),et),ot=o.bL(M,B,pe),wt=w?ot/je:ot*je,jt=Wn(Ne,Qe,_t,_);if(jt[3]<=0){ml(ce,Z);continue}let pt={};const vt=o.an(d.layers[0].layout.get("text-max-angle")),$t=Math.cos(vt),Ot=w?null:Fe,Rt=M0(pe,wt,!1,S,r,_,x,d.glyphOffsetArray,K,Z,q,jt,Me,pt,ee,Ot,z.projection,R,w,$t);oe=Rt.useVertical,Ot&&Rt.needsFlipping&&(pt={}),(Rt.notEnoughRoom||oe||Rt.needsFlipping&&M0(pe,wt,!0,S,r,_,x,d.glyphOffsetArray,K,Z,q,jt,Me,pt,ee,Ot,z.projection,R,w,$t).notEnoughRoom)&&ml(ce,Z)}f?(d.text.dynamicLayoutVertexBuffer.updateData(Z),q&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(q)):(d.icon.dynamicLayoutVertexBuffer.updateData(Z),q&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(q))}function yi(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z){const{lineStartIndex:q,glyphStartIndex:K,segment:ne}=S,ee=K+S.numGlyphs,ge=q+S.lineLength,oe=r.getoffsetX(K),ve=r.getoffsetX(ee-1),pe=ud(d*oe,l,f,_,x,w,ne,q,ge,I,R,k,z,M,!0,B,j,U,Z);if(!pe)return null;const ce=ud(d*ve,l,f,_,x,w,ne,q,ge,I,R,k,z,M,!0,B,j,U,Z);return ce?{first:pe,last:ce}:null}function _g(d,r,l,f){return d===o.bK.horizontal&&Math.abs(f)>Math.abs(l)?{useVertical:!0}:d===o.bK.vertical?f>0?{needsFlipping:!0}:null:r!==Fo.unknown&&function(_,x){return _===0||Math.abs(x/_)>ld}(l,f)?r===Fo.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function M0(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K,ne){const ee=r/24,ge=d.lineOffsetX*ee,oe=d.lineOffsetY*ee,{lineStartIndex:ve,glyphStartIndex:pe,numGlyphs:ce,segment:xe,writingMode:Me,flipState:Ce}=d,We=ve+d.lineLength,Ne=Qe=>{if(k){const[et,je,ot]=Qe.up,wt=R.length;o.bM(k,wt+0,et,je,ot),o.bM(k,wt+1,et,je,ot),o.bM(k,wt+2,et,je,ot),o.bM(k,wt+3,et,je,ot)}const[_t,Fe,Ie]=Qe.point;o.bN(R,_t,Fe,Ie,Qe.angle)};if(ce>1){const Qe=yi(ee,S,ge,oe,l,z,M,d,I,x,B,U,!1,Z,q,K,ne);if(!Qe)return{notEnoughRoom:!0};if(f&&!l){let[_t,Fe,Ie]=Qe.first.point,[et,je,ot]=Qe.last.point;[_t,Fe]=Wn(_t,Fe,Ie,w),[et,je]=Wn(et,je,ot,w);const wt=_g(Me,Ce,(et-_t)*j,je-Fe);if(d.flipState=wt&&wt.needsFlipping?Fo.flipRequired:Fo.flipNotRequired,wt)return wt}Ne(Qe.first);for(let _t=pe+1;_t<pe+ce-1;_t++){const Fe=ud(ee*S.getoffsetX(_t),ge,oe,l,z,M,xe,ve,We,I,x,B,U,!1,!1,Z,q,K,ne);if(!Fe)return R.length-=4*(_t-pe),{notEnoughRoom:!0};Ne(Fe)}Ne(Qe.last)}else{if(f&&!l){const _t=Wn(M.x,M.y,0,_),Fe=ve+xe+1,Ie=new o.P(I.getx(Fe),I.gety(Fe)),et=Wn(Ie.x,Ie.y,0,_),je=et[3]>0?et:pr(M,Ie,_t,1,_,void 0,Z,q.canonical),ot=_g(Me,Ce,(je[0]-_t[0])*j,je[1]-_t[1]);if(d.flipState=ot&&ot.needsFlipping?Fo.flipRequired:Fo.flipNotRequired,ot)return ot}const Qe=ud(ee*S.getoffsetX(pe),ge,oe,l,z,M,xe,ve,We,I,x,B,U,!1,!1,Z,q,K,ne);if(!Qe)return{notEnoughRoom:!0};Ne(Qe)}return{}}function O0(d,r,l,f,_){const{x,y:w,z:S}=f.projectTilePoint(d.x,d.y,r);if(!_)return Wn(x,w,S,l);const[I,R,k]=_.getElevation(d,_.elevation,_.elevationFeature);return Wn(x+I,w+R,S+k,l)}function pr(d,r,l,f,_,x,w,S){const I=O0(d.sub(r)._unit()._add(d),S,_,w,x);return o.av(I,l,I),o.aw(I,I),o.bG(I,l,I,f)}function ud(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K){const ne=f?d-r:d+r;let ee=ne>0?1:-1,ge=0;f&&(ee*=-1,ge=Math.PI),ee<0&&(ge+=Math.PI);let oe=S+w+(ee>0?0:1)|0,ve=_,pe=_,ce=0,xe=0;const Me=Math.abs(ne),Ce=[],We=[];let Ne=x,Qe=Ne,_t=o.bE([]);const Fe=()=>pr(Qe,Ne,pe,Me-ce+1,k,M,U,Z.canonical);for(;ce+xe<=Me;){if(oe+=ee,oe<S||oe>=I)return null;if(pe=ve,Qe=Ne,Ce.push(pe),B&&We.push(Qe),Ne=new o.P(R.getx(oe),R.gety(oe)),ve=z[oe],!ve){const Ot=O0(Ne,Z.canonical,k,U,M);ve=Ot[3]>0?z[oe]=Ot:Fe()}ce+=xe;const vt=o.av([],ve,pe),$t=o.bF(pe,ve);if(l&&$t>0&&xe>0&&o.bI(_t,vt)/(xe*$t)<K)return null;xe=$t,_t=vt}j&&M&&(z[oe]&&(ve=Fe(),xe=o.bF(pe,ve),_t=o.av([],ve,pe)),z[oe]=ve);const Ie=(Me-ce)/xe,et=Ne.sub(Qe)._mult(Ie)._add(Qe),je=o.bG([],pe,_t,Ie);let ot=[0,0,1],wt=_t[0],jt=_t[1];if(q&&(ot=U.upVector(Z.canonical,et.x,et.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const vt=[ot[2],0,-ot[0]],$t=o.bH([],ot,vt);o.aw(vt,vt),o.aw($t,$t),wt=o.bI(_t,vt),jt=o.bI(_t,$t)}if(l){const vt=o.bH([],ot,_t);o.aw(vt,vt),o.bG(je,je,vt,l*ee)}const pt=ge+Math.atan2(jt,wt);return Ce.push(je),B&&We.push(et),{point:je,angle:pt,path:Ce,tilePath:We,up:ot}}function ml(d,r){const l=r.length,f=l+4*d;r.resize(f),r.float32.fill(-1/0,4*l,4*f)}function ha(d,r,l){const f=r[0],_=r[1];return d[0]=l[0]*f+l[4]*_+l[12],d[1]=l[1]*f+l[5]*_+l[13],d[3]=l[3]*f+l[7]*_+l[15],d}const da=100;class wu{constructor(r,l,f=new ad(r.width+200,r.height+200,25),_=new ad(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=_,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+da,this.screenBottomBoundary=r.height+da,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,f,_,x,w,S,I,R,k,z){let M=f.projectedAnchorX,B=f.projectedAnchorY,j=f.projectedAnchorZ;const U=f.tileAnchorX,Z=f.tileAnchorY,q=f.elevation,K=f.tileID,ne=r.getProjection();if(q&&K){const[We,Ne,Qe]=ne.upVector(K.canonical,f.tileAnchorX,f.tileAnchorY),_t=ne.upVectorScale(K.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;M+=We*q*_t,B+=Ne*q*_t,j+=Qe*q*_t}const ee=r.projection.name==="globe",ge=r.projection.name==="globe"?o.aj(this.transform.zoom):0;if(K&&ee&&ge<1&&!w){const We=1<<K.canonical.z,Ne=o.bO(U,Z);o.bP(Ne,Ne,1/o.al),o.bQ(Ne,Ne,o.bO(K.canonical.x,K.canonical.y)),o.bP(Ne,Ne,1/We),o.bR(Ne,Ne,o.bO(_[0],_[1])),Ne[0]=o.bS(Ne[0],-.5,.5),o.bP(Ne,Ne,o.al);const Qe=o.bT(Ne[0],Ne[1],o.al/(2*Math.PI),1);o.aC(Qe,Qe,x),M=o.ak(M,Qe[0],ge),B=o.ak(B,Qe[1],ge),j=o.ak(j,Qe[2],ge)}const oe=this.projectAndGetPerspectiveRatio(k,M,B,j,f.tileID,ne.name==="globe"||!!q||this.transform.pitch>0,ne),ve=R*oe.perspectiveRatio,pe=(f.x1*l+S.x-f.padding)*ve+oe.point.x,ce=(f.y1*l+S.y-f.padding)*ve+oe.point.y,xe=(f.x2*l+S.x+f.padding)*ve+oe.point.x,Me=(f.y2*l+S.y+f.padding)*ve+oe.point.y,Ce=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(pe,ce,xe,Me)||!I&&this.grid.hitTest(pe,ce,xe,Me,z)||Ce?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[pe,ce,xe,Me],offscreen:this.isOffscreen(pe,ce,xe,Me),occluded:!1}}placeCollisionCircles(r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z){const q=[],K=this.transform.elevation,ne=r.getProjection(),ee=r.elevationType==="road",ge=!!K||ee,oe=o.bU.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,ne),ve=new o.P(f.tileAnchorX,f.tileAnchorY),pe=new o.P(f.tileAnchorX,f.tileAnchorY);let{x:ce,y:xe,z:Me}=ne.projectTilePoint(pe.x,pe.y,Z.canonical),Ce=null;if(ge){const $t=ee?r.getElevationFeatureForText(_):null;Ce={getElevation:oe,elevation:K,elevationFeature:$t};const[Ot,Rt,Dt]=oe(ve,K,$t);ce+=Ot,xe+=Rt,Me+=Dt}const We=ne.name==="globe",Ne=this.projectAndGetPerspectiveRatio(I,ce,xe,Me,Z,We||!!K||this.transform.pitch>0,ne),{perspectiveRatio:Qe}=Ne,_t=(M?S/Qe:S*Qe)/o.bX,Fe=Wn(ce,xe,Me,R),Ie=f.lineOffsetX*_t,et=f.lineOffsetY*_t,je=o.an(r.layers[0].layout.get("text-max-angle")),ot=Math.cos(je),wt=Ne.signedDistanceFromCamera>0?yi(_t,w,Ie,et,ee&&f.flipState===1,Fe,pe,f,x,R,{},ge&&!M?Ce:null,M&&ge,ne,Z,M,ot):null;let jt=!1,pt=!1,vt=!0;if(wt&&!Ne.occluded){const $t=.5*j*Qe+U,Ot=new o.P(-100,-100),Rt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new Kw,{first:lr,last:Ur}=wt,Jr=lr.path.length;let Ci=[];for(let kr=Jr-1;kr>=1;kr--)Ci.push(lr.path[kr]);for(let kr=1;kr<Ur.path.length;kr++)Ci.push(Ur.path[kr]);const yr=2.5*$t;k&&(Ci=Ci.map(([kr,Si,Qr],Fi)=>(ge&&!We&&(Qr=oe(Fi<Jr-1?lr.tilePath[Jr-1-Fi]:Ur.tilePath[Fi-Jr+2],K,Ce.elevationFeature)[2]),Wn(kr,Si,Qr,k))),Ci.some(kr=>kr[3]<=0)&&(Ci=[]));let Kr=[];if(Ci.length>0){let kr=1/0,Si=-1/0,Qr=1/0,Fi=-1/0;for(const oi of Ci)kr=Math.min(kr,oi[0]),Qr=Math.min(Qr,oi[1]),Si=Math.max(Si,oi[0]),Fi=Math.max(Fi,oi[1]);Si>=Ot.x&&kr<=Rt.x&&Fi>=Ot.y&&Qr<=Rt.y&&(Kr=[Ci.map(oi=>new o.P(oi[0],oi[1]))],(kr<Ot.x||Si>Rt.x||Qr<Ot.y||Fi>Rt.y)&&(Kr=o.bV(Kr,Ot.x,Ot.y,Rt.x,Rt.y)))}for(const kr of Kr){Dt.reset(kr,.25*$t);let Si=0;Si=Dt.length<=.5*$t?1:Math.ceil(Dt.paddedLength/yr)+1;for(let Qr=0;Qr<Si;Qr++){const Fi=Qr/Math.max(Si-1,1),oi=Dt.lerp(Fi),Mr=oi.x+da,pi=oi.y+da;q.push(Mr,pi,$t,0);const Lr=Mr-$t,$i=pi-$t,gi=Mr+$t,xr=pi+$t;if(vt=vt&&this.isOffscreen(Lr,$i,gi,xr),pt=pt||this.isInsideGrid(Lr,$i,gi,xr),!l&&this.grid.hitTestCircle(Mr,pi,$t,B)&&(jt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:jt,occluded:!1}}}}return{circles:!z&&jt||!pt?[]:q,offscreen:vt,collisionDetected:jt,occluded:Ne.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let f=1/0,_=1/0,x=-1/0,w=-1/0;for(const k of r){const z=new o.P(k.x+da,k.y+da);f=Math.min(f,z.x),_=Math.min(_,z.y),x=Math.max(x,z.x),w=Math.max(w,z.y),l.push(z)}const S=this.grid.query(f,_,x,w).concat(this.ignoredGrid.query(f,_,x,w)),I={},R={};for(const k of S){const z=k.key;if(I[z.bucketInstanceId]===void 0&&(I[z.bucketInstanceId]={}),I[z.bucketInstanceId][z.featureIndex])continue;const M=[new o.P(k.x1,k.y1),new o.P(k.x2,k.y1),new o.P(k.x2,k.y2),new o.P(k.x1,k.y2)];o.bW(l,M)&&(I[z.bucketInstanceId][z.featureIndex]=!0,R[z.bucketInstanceId]===void 0&&(R[z.bucketInstanceId]=[]),R[z.bucketInstanceId].push(z.featureIndex))}return R}insertCollisionBox(r,l,f,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:_,collisionGroupID:x},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,f,_,x){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:f,featureIndex:_,collisionGroupID:x};for(let I=0;I<r.length;I+=4)w.insertCircle(S,r[I],r[I+1],r[I+2])}projectAndGetPerspectiveRatio(r,l,f,_,x,w,S){const I=[l,f,_,1];let R=!1;_||this.transform.pitch>0?(o.aC(I,I,r),this.fogState&&x&&S.name!=="globe"&&(R=function(M,B,j,U,Z,q){const K=q.calculateFogTileMatrix(Z),ne=[B,j,U];return o.af(ne,ne,K),gt(M,o.ag(ne),q.pitch,q._fov)}(this.fogState,l,f,_,x.toUnwrapped(),this.transform)>.9)):ha(I,I,r);const k=I[3];return{point:new o.P((I[0]/k+1)/2*this.transform.width+da,(-I[1]/k+1)/2*this.transform.height+da),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/k*.5,1.5),signedDistanceFromCamera:k,occluded:w&&I[2]>k||R}}isOffscreen(r,l,f,_){return f<da||r>=this.screenRightBoundary||_<da||l>this.screenBottomBoundary}isInsideGrid(r,l,f,_){return f>=0&&r<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=o.bz([]);return o.bq(r,r,[-100,-100,0]),r}}class Yt{constructor(r,l,f,_){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):_&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class si{constructor(r,l,f,_,x,w=!1){this.text=new Yt(r?r.text:null,l,f,x),this.icon=new Yt(r?r.icon:null,l,_,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class mi{constructor(r,l,f,_=!1){this.text=r,this.icon=l,this.skipFade=f,this.clipped=_}}class bo{constructor(){this.invProjMatrix=o.bB(),this.viewportMatrix=o.bB(),this.circles=[]}}class bu{constructor(r,l,f,_,x){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=f,this.bucketIndex=_,this.tileID=x}}class Ti{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:f=>f.collisionGroupID===l}}return this.collisionGroups[r]}}function hd(d,r,l,f,_){const{horizontalAlign:x,verticalAlign:w}=o.c0(d),S=-(x-.5)*r,I=-(w-.5)*l,R=o.c1(d,f);return new o.P(S+R[0]*_,I+R[1]*_)}function Lc(d,r,l,f,_){const x=new o.P(d,r);return l&&x._rotate(f?_:-_),x}class dd{constructor(r,l,f,_,x,w){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new wu(this.transform,x),this.buildingIndex=w,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ti(f),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,f,_,x=1){const w=f.getBucket(l),S=f.latestFeatureIndex;if(!w||!S||l.fqid!==w.layerIds[0])return;const I=w.layers[0].layout,R=w.layers[0].paint,k=f.collisionBoxArray,z=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),M=f.tileSize/o.al,B=f.tileID.toUnwrapped();this.transform.setProjection(w.projection);const j=(U=f.tileID,Z=w.getProjection(),q=this.transform,Z.name===this.projection?q.calculateProjMatrix(U.toUnwrapped()):Dc(q,Z,U));var U,Z,q;const K=I.get("text-pitch-alignment")==="map",ne=I.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const ee=l.dynamicFilter(),ge=l.dynamicFilterNeedsFeature(),oe=this.transform.calculatePixelsToTileUnitsMatrix(f),ve=cd(j,f.tileID.canonical,K,ne,this.transform,w.getProjection(),oe);let pe=null;const ce=w.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(K){const Ie=pl(j,f.tileID.canonical,K,ne,this.transform,w.getProjection(),oe);pe=o.aB([],this.transform.labelPlaneMatrix,Ie)}let xe=null;ee&&f.latestFeatureIndex&&(xe={unwrappedTileID:B,dynamicFilter:ee,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[w.bucketInstanceId]=new bu(w.bucketInstanceId,S,w.sourceLayerIndex,w.index,f.tileID);const[Me,Ce]=w.layers[0].layout.get("text-size-scale-range"),We=o.aA(x,Me,Ce),[Ne,Qe]=I.get("icon-size-scale-range"),_t=o.aA(x,Ne,Qe),Fe={bucket:w,layout:I,paint:R,posMatrix:j,invMatrix:ce,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ve,labelToScreenMatrix:pe,clippingData:xe,scale:z,textPixelRatio:M,holdingForFade:f.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:o.bJ(w.textSizeData,this.transform.zoom,We),partiallyEvaluatedIconSize:o.bJ(w.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(_)for(const Ie of w.sortKeyRanges){const{sortKey:et,symbolInstanceStart:je,symbolInstanceEnd:ot}=Ie;r.push({sortKey:et,symbolInstanceStart:je,symbolInstanceEnd:ot,parameters:Fe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K,ne,ee,ge){const{textOffset0:oe,textOffset1:ve,crossTileID:pe}=U,ce=[oe,ve],xe=hd(r,w,S,ce,I),Me=this.collisionIndex.placeCollisionBox(q,I,l,f,_,x,Lc(xe.x,xe.y,R,k,this.transform.angle),j,z,M,B.predicate);if(ne){const Ce=q.getSymbolInstanceIconSize(ge,this.transform.zoom,U.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(q,Ce,ne,f,_,x,Lc(xe.x,xe.y,R,k,this.transform.angle),j,z,M,B.predicate).box.length===0)return}if(Me.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[pe]&&this.prevPlacement.placements[pe]&&this.prevPlacement.placements[pe].text&&(Ce=this.prevPlacement.variableOffsets[pe].anchor),this.variableOffsets[pe]={textOffset:ce,width:w,height:S,anchor:r,textScale:I,prevAnchor:Ce},this.markUsedJustification(q,r,U,K),q.allowVerticalPlacement&&(this.markUsedOrientation(q,K,U),this.placedOrientations[pe]=K),{shift:xe,placedGlyphBoxes:Me}}}placeLayerBucketPart(r,l,f,_,x=1){const{bucket:w,layout:S,paint:I,posMatrix:R,textLabelPlaneMatrix:k,labelToScreenMatrix:z,clippingData:M,textPixelRatio:B,mercatorCenter:j,invMatrix:U,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:ne,collisionGroup:ee,latestFeatureIndex:ge}=r.parameters,oe=S.get("text-optional"),ve=S.get("icon-optional"),pe=S.get("text-allow-overlap"),ce=S.get("icon-allow-overlap"),xe=S.get("text-rotation-alignment")==="map",Me=S.get("icon-rotation-alignment")==="map",Ce=S.get("text-pitch-alignment")==="map",We=I.get("symbol-z-offset"),Ne=S.get("symbol-elevation-reference")==="sea",Qe=S.get("symbol-placement"),[_t,Fe]=S.get("text-size-scale-range"),[Ie,et]=S.get("icon-size-scale-range"),je=o.aA(x,_t,Fe),ot=o.aA(x,Ie,et),wt=S.get("text-variable-anchor"),jt=xe&&Qe!=="point",pt=Me&&Qe!=="point",vt=wt&&w.hasTextData(),$t=w.hasIconTextFit()&&vt&&w.hasIconData();this.transform.setProjection(w.projection);const Ot=vt||jt,Rt=pt||$t;let Dt=pe&&(ce||!w.hasIconData()||ve),lr=ce&&(pe||!w.hasTextData()||oe);const Ur=!We.isConstant();!w.collisionArrays&&q&&w.deserializeCollisionBoxes(q),f&&_&&w.updateCollisionDebugBuffers(this.transform.zoom,q,je,ot);const Jr=(yr,Kr,kr)=>{const{crossTileID:Si,numVerticalGlyphVertices:Qr}=yr;let Fi=null;if(M&&M.dynamicFilterNeedsFeature||Ur){const dn=this.retainedQueryData[w.bucketInstanceId];Fi=ge.loadFeature({featureIndex:yr.featureIndex,bucketIndex:dn.bucketIndex,sourceLayerIndex:dn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(M&&!(0,M.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:w.worldview},Fi,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new o.P(yr.tileAnchorX,yr.tileAnchorY),this.transform.calculateDistanceTileData(M.unwrappedTileID)))return this.placements[Si]=new mi(!1,!1,!1,!0),void l.add(Si);const oi=We.evaluate(Fi,{});if(l.has(Si))return;if(Z)return void(this.placements[Si]=new mi(!1,!1,!1));let Mr=!1,pi=!1,Lr=!0,$i=!1,gi=!1,xr=null,ri={box:null,offscreen:null,occluded:null},on={box:null},En=null,un=null,_n=null,mo=0,no=0,Es=0;kr.textFeatureIndex?mo=kr.textFeatureIndex:yr.useRuntimeCollisionCircles&&(mo=yr.featureIndex),kr.verticalTextFeatureIndex&&(no=kr.verticalTextFeatureIndex);const Os=w.elevationFeatures?w.elevationFeatures[yr.elevationFeatureIndex]:void 0,Uo=dn=>{dn.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const In=this.transform.elevation;dn.elevation=Ne?oi:oi+o.bU.getAtTileOffset(dn.tileID,new o.P(dn.tileAnchorX,dn.tileAnchorY),In,Os),dn.elevation+=yr.zOffset},Is=kr.textBox;if(Is){Uo(Is);const dn=Li=>{let Rn=o.bK.horizontal;if(w.allowVerticalPlacement&&!Li&&this.prevPlacement){const cs=this.prevPlacement.placedOrientations[Si];cs&&(this.placedOrientations[Si]=cs,Rn=cs,this.markUsedOrientation(w,Rn,yr))}return Rn},In=(Li,Rn)=>{if(w.allowVerticalPlacement&&Qr>0&&kr.verticalTextBox){for(const cs of w.writingModes)if(cs===o.bK.vertical?(ri=Rn(),on=ri):ri=Li(),ri&&ri.box&&ri.box.length)break}else ri=Li()};if(wt){let Li=wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Si]){const fn=this.prevPlacement.variableOffsets[Si];Li.indexOf(fn.anchor)>0&&(Li=Li.filter(Go=>Go!==fn.anchor),Li.unshift(fn.anchor))}const Rn=(fn,Go,Qu)=>{const El=w.getSymbolInstanceTextSize(K,yr,this.transform.zoom,Kr),eh=(fn.x2-fn.x1)*El+2*fn.padding,th=(fn.y2-fn.y1)*El+2*fn.padding,Ho=yr.hasIconTextFit&&!ce?Go:null;Ho&&Uo(Ho);let il={box:[],offscreen:!1,occluded:!1};const rs=pe?2*Li.length:Li.length;for(let qo=0;qo<rs;++qo){const Xc=this.attemptAnchorPlacement(Li[qo%Li.length],fn,j,U,Ot,eh,th,El,xe,Ce,B,R,ee,qo>=Li.length,yr,Kr,w,Qu,Ho,K,ne);if(Xc&&(il=Xc.placedGlyphBoxes,il&&il.box&&il.box.length)){Mr=!0,xr=Xc.shift;break}}return il};In(()=>Rn(Is,kr.iconBox,o.bK.horizontal),()=>{const fn=kr.verticalTextBox;return fn&&Uo(fn),w.allowVerticalPlacement&&!(ri&&ri.box&&ri.box.length)&&Qr>0&&fn?Rn(fn,kr.verticalIconBox,o.bK.vertical):{box:null,offscreen:null,occluded:null}}),ri&&(Mr=ri.box,Lr=ri.offscreen,$i=ri.occluded);const cs=dn(!(!ri||!ri.box));if(!Mr&&this.prevPlacement){const fn=this.prevPlacement.variableOffsets[Si];fn&&(this.variableOffsets[Si]=fn,this.markUsedJustification(w,fn.anchor,yr,cs))}}else{const Li=(Rn,cs)=>{const fn=w.getSymbolInstanceTextSize(K,yr,this.transform.zoom,Kr),Go=this.collisionIndex.placeCollisionBox(w,fn,Rn,j,U,Ot,new o.P(0,0),pe,B,R,ee.predicate);return Go&&Go.box&&Go.box.length&&(this.markUsedOrientation(w,cs,yr),this.placedOrientations[Si]=cs),Go};In(()=>Li(Is,o.bK.horizontal),()=>{const Rn=kr.verticalTextBox;return w.allowVerticalPlacement&&Qr>0&&Rn?(Uo(Rn),Li(Rn,o.bK.vertical)):{box:null,offscreen:null,occluded:null}}),dn(!!(ri&&ri.box&&ri.box.length))}}if(En=ri,Mr=En&&En.box&&En.box.length>0,Lr=En&&En.offscreen,$i=En&&En.occluded,yr.useRuntimeCollisionCircles){const dn=yr.centerJustifiedTextSymbolIndex>=0?yr.centerJustifiedTextSymbolIndex:yr.verticalPlacedTextSymbolIndex,In=w.text.placedSymbolArray.get(dn),Li=o.bL(w.textSizeData,K,In),Rn=S.get("text-padding");un=this.collisionIndex.placeCollisionCircles(w,pe,In,dn,w.lineVertexArray,w.glyphOffsetArray,Li,R,k,z,f,Ce,ee.predicate,yr.collisionCircleDiameter*Li/o.bX,Rn,this.retainedQueryData[w.bucketInstanceId].tileID),Mr=pe||un.circles.length>0&&!un.collisionDetected,Lr=Lr&&un.offscreen,$i=un.occluded}if(kr.iconFeatureIndex&&(Es=kr.iconFeatureIndex),kr.iconBox){const dn=In=>{Uo(In);const Li=yr.hasIconTextFit&&xr?Lc(xr.x,xr.y,xe,Ce,this.transform.angle):new o.P(0,0),Rn=w.getSymbolInstanceIconSize(ne,this.transform.zoom,yr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Rn,In,j,U,Rt,Li,ce,B,R,ee.predicate)};on&&on.box&&on.box.length&&kr.verticalIconBox?(_n=dn(kr.verticalIconBox),pi=_n.box.length>0):(_n=dn(kr.iconBox),pi=_n.box.length>0),Lr=Lr&&_n.offscreen,gi=_n.occluded}const $o=oe||yr.numHorizontalGlyphVertices===0&&Qr===0,va=ve||yr.numIconVertices===0;if($o||va?va?$o||(pi=pi&&Mr):Mr=pi&&Mr:pi=Mr=pi&&Mr,Mr&&En&&En.box&&this.collisionIndex.insertCollisionBox(En.box,S.get("text-ignore-placement"),w.bucketInstanceId,on&&on.box&&no?no:mo,ee.ID),pi&&_n&&this.collisionIndex.insertCollisionBox(_n.box,S.get("icon-ignore-placement"),w.bucketInstanceId,Es,ee.ID),un&&(Mr&&this.collisionIndex.insertCollisionCircles(un.circles,S.get("text-ignore-placement"),w.bucketInstanceId,mo,ee.ID),f)){const dn=w.bucketInstanceId;let In=this.collisionCircleArrays[dn];In===void 0&&(In=this.collisionCircleArrays[dn]=new bo);for(let Li=0;Li<un.circles.length;Li+=4)In.circles.push(un.circles[Li+0]),In.circles.push(un.circles[Li+1]),In.circles.push(un.circles[Li+2]),In.circles.push(un.collisionDetected?1:0)}const ls=w.projection.name!=="globe";Dt=Dt&&(ls||!$i),lr=lr&&(ls||!gi),this.placements[Si]=new mi(Mr||Dt,pi||lr,Lr||w.justReloaded),l.add(Si)},Ci=this.retainedQueryData[w.bucketInstanceId].tileID;if(w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,Ci),w.elevationType==="road"&&w.updateRoadElevation(Ci.canonical),w.updateZOffset(),w.sortFeaturesByY){const yr=w.getSortedSymbolIndexes(this.transform.angle);for(let Kr=yr.length-1;Kr>=0;--Kr){const kr=yr[Kr];Jr(w.symbolInstances.get(kr),kr,w.collisionArrays[kr])}w.hasAnyZOffset&&o.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const yr=w.getSortedIndexesByZOffset();for(let Kr=0;Kr<yr.length;++Kr){const kr=yr[Kr];Jr(w.symbolInstances.get(kr),kr,w.collisionArrays[kr])}}else for(let yr=r.symbolInstanceStart;yr<r.symbolInstanceEnd;yr++)Jr(w.symbolInstances.get(yr),yr,w.collisionArrays[yr]);if(f&&w.bucketInstanceId in this.collisionCircleArrays){const yr=this.collisionCircleArrays[w.bucketInstanceId];o.bk(yr.invProjMatrix,R),yr.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(r,l,f,_){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:I,crossTileID:R}=f,k=o.c2(l),z=_===o.bK.vertical?I:k==="left"?x:k==="center"?w:k==="right"?S:-1;x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:R),w>=0&&(r.text.placedSymbolArray.get(w).crossTileID=z>=0&&w!==z?0:R),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:R),I>=0&&(r.text.placedSymbolArray.get(I).crossTileID=z>=0&&I!==z?0:R)}markUsedOrientation(r,l,f){const _=l===o.bK.horizontal||l===o.bK.horizontalOnly?l:0,x=l===o.bK.vertical?l:0,{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:R}=f,k=r.text.placedSymbolArray;w>=0&&(k.get(w).placedOrientation=_),S>=0&&(k.get(S).placedOrientation=_),I>=0&&(k.get(I).placedOrientation=_),R>=0&&(k.get(R).placedOrientation=x)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let f=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(r):1,x=l?l.opacities:{},w=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const I in this.placements){const R=this.placements[I],k=x[I];k?(this.opacities[I]=new si(k,_,R.text,R.icon,null,R.clipped),f=f||R.text!==k.text.placed||R.icon!==k.icon.placed):(this.opacities[I]=new si(null,_,R.text,R.icon,R.skipFade,R.clipped),f=f||R.text||R.icon)}for(const I in x){const R=x[I];if(!this.opacities[I]){const k=new si(R,_,!1,!1);k.isHidden()||(this.opacities[I]=k,f=f||R.text.placed||R.icon.placed)}}for(const I in w)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=w[I]);for(const I in S)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=S[I]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l,f,_){const x=new Set;for(const w of l){const S=w.getBucket(r);S&&w.latestFeatureIndex&&r.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,x,w,w.collisionBoxArray,f,_,w.tileID,r.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,w.tileID),S.elevationType==="road"&&S.updateRoadElevation(w.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(r,l,f,_,x,w,S,I){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const R=r.layers[0].layout,k=r.layers[0].paint,z=!!r.layers[0].dynamicFilter(),M=new si(null,0,!1,!1,!0),B=R.get("text-allow-overlap"),j=R.get("icon-allow-overlap"),U=R.get("text-variable-anchor"),Z=R.get("text-rotation-alignment")==="map",q=R.get("text-pitch-alignment")==="map",K=k.get("symbol-z-offset"),ne=R.get("symbol-elevation-reference")==="sea",ee=!K.isConstant(),ge=new si(null,0,B&&(j||!r.hasIconData()||R.get("icon-optional")),j&&(B||!r.hasTextData()||R.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const oe=(pe,ce,xe)=>{for(let Me=0;Me<ce/4;Me++)pe.opacityVertexArray.emplaceBack(xe)};let ve=0;w&&r.updateReplacement(S,w);for(let pe=0;pe<r.symbolInstances.length;pe++){const ce=r.symbolInstances.get(pe),{numHorizontalGlyphVertices:xe,numVerticalGlyphVertices:Me,crossTileID:Ce,numIconVertices:We,tileAnchorX:Ne,tileAnchorY:Qe}=ce;let _t=null;const Fe=this.retainedQueryData[r.bucketInstanceId];ee&&ce&&Fe&&(_t=f.latestFeatureIndex.loadFeature({featureIndex:ce.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ie=K.evaluate(_t,{}),et=l.has(Ce);let je=this.opacities[Ce];et?je=M:je||(je=ge,this.opacities[Ce]=je),l.add(Ce);const ot=xe>0||Me>0,wt=We>0,jt=this.placedOrientations[Ce],pt=jt===o.bK.vertical,vt=jt===o.bK.horizontal||jt===o.bK.horizontalOnly;!ot&&!wt||je.isHidden()||ve++;let $t=!1;if((ot||wt)&&w)for(const Ot of r.activeReplacements){if(o.bY(Ot,x,o.bZ.Symbol,I)||Ot.min.x>Ne||Ne>Ot.max.x||Ot.min.y>Qe||Qe>Ot.max.y)continue;const Rt=o.b_(Ne,Qe,S.canonical,Ot.footprintTileId.canonical);if($t=o.b$(Rt,Ot.footprint),$t)break}if(ot){const Ot=$t?as:md(je.text);oe(r.text,xe,pt?as:Ot),oe(r.text,Me,vt?as:Ot);const Rt=je.text.isHidden(),{leftJustifiedTextSymbolIndex:Dt,centerJustifiedTextSymbolIndex:lr,rightJustifiedTextSymbolIndex:Ur,verticalPlacedTextSymbolIndex:Jr}=ce,Ci=r.text.placedSymbolArray,yr=Rt||pt?1:0;Dt>=0&&(Ci.get(Dt).hidden=yr),lr>=0&&(Ci.get(lr).hidden=yr),Ur>=0&&(Ci.get(Ur).hidden=yr),Jr>=0&&(Ci.get(Jr).hidden=Rt||vt?1:0);const Kr=this.variableOffsets[Ce];Kr&&this.markUsedJustification(r,Kr.anchor,ce,jt);const kr=this.placedOrientations[Ce];kr&&(this.markUsedJustification(r,"left",ce,kr),this.markUsedOrientation(r,kr,ce))}if(wt){const Ot=$t?as:md(je.icon),{placedIconSymbolIndex:Rt,verticalPlacedIconSymbolIndex:Dt}=ce,lr=r.icon.placedSymbolArray,Ur=je.icon.isHidden()?1:0;Rt>=0&&(oe(r.icon,We,pt?as:Ot),lr.get(Rt).hidden=Ur),Dt>=0&&(oe(r.icon,ce.numVerticalIconVertices,vt?as:Ot),lr.get(Dt).hidden=Ur)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ot=r.collisionArrays[pe];if(Ot){let Rt=new o.P(0,0),Dt=!0;if(Ot.textBox||Ot.verticalTextBox){if(U){const Ur=this.variableOffsets[Ce];Ur?(Rt=hd(Ur.anchor,Ur.width,Ur.height,Ur.textOffset,Ur.textScale),Z&&Rt._rotate(q?this.transform.angle:-this.transform.angle)):Dt=!1}z&&(Dt=!je.clipped),Ot.textBox&&gs(r.textCollisionBox.collisionVertexArray,je.text.placed,!Dt||pt,Ie,ne,Rt.x,Rt.y),Ot.verticalTextBox&&gs(r.textCollisionBox.collisionVertexArray,je.text.placed,!Dt||vt,Ie,ne,Rt.x,Rt.y)}const lr=Dt&&!!(!vt&&Ot.verticalIconBox);Ot.iconBox&&gs(r.iconCollisionBox.collisionVertexArray,je.icon.placed,lr,Ie,ne,ce.hasIconTextFit?Rt.x:0,ce.hasIconTextFit?Rt.y:0),Ot.verticalIconBox&&gs(r.iconCollisionBox.collisionVertexArray,je.icon.placed,!lr,Ie,ne,ce.hasIconTextFit?Rt.x:0,ce.hasIconTextFit?Rt.y:0)}}}if(r.fullyClipped=ve===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=pe.invProjMatrix,r.placementViewportMatrix=pe.viewportMatrix,r.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const f=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function gs(d,r,l,f,_,x,w){d.emplaceBack(r?1:0,l?1:0,x||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,l?1:0,x||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,l?1:0,x||0,w||0,f,_?1:0),d.emplaceBack(r?1:0,l?1:0,x||0,w||0,f,_?1:0)}const Un=Math.pow(2,25),Yw=Math.pow(2,24),fd=Math.pow(2,17),yg=Math.pow(2,16),pd=Math.pow(2,9),Rf=Math.pow(2,8),vg=Math.pow(2,1);function md(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const r=d.placed?1:0,l=Math.floor(127*d.opacity);return l*Un+r*Yw+l*fd+r*yg+l*pd+r*Rf+l*vg+r}const as=0;class gl{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,l,f,_,x,w){const S=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(S,_,r[this._currentTileIndex],this._sortAcrossTiles,w),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,R)=>I.sortKey-R.sortKey));this._currentPartIndex<S.length;){const I=S[this._currentPartIndex];if(l.placeLayerBucketPart(I,this._seenCrossTileIDs,f,I.symbolInstanceStart===0,w),this._currentPartIndex++,x())return!0}return!1}}class ho{constructor(r,l,f,_,x,w,S,I,R){this.placement=new dd(r,x,w,S,I,R),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(r,l,f,_,x){const w=o.o.now(),S=()=>{const I=o.o.now()-w;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=l[r[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=R)&&(!I.maxzoom||I.maxzoom>R)){const k=I,z=k.layout.get("symbol-z-elevate"),M=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,B=k.layout.get("symbol-z-order"),j=B==="viewport-y"||B==="auto"&&!(B!=="viewport-y"&&M),U=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),Z=j&&U,q=this._inProgressLayer=this._inProgressLayer||new gl(k),K=o.B(I.source,I.scope);if(q.continuePlacement(z||Z?_[K]:f[K],this.placement,this._showCollisionBoxes,I,S,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const kf=512/o.al/2;class Tu{constructor(r,l,f){this.tileID=r,this.bucketInstanceId=f,this.index=new o.c3(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=r.canonical.x*o.al,x=r.canonical.y*o.al;for(let w=0;w<l.length;w++){const{key:S,crossTileID:I,tileAnchorX:R,tileAnchorY:k}=l.get(w),z=Math.floor((_+R)*kf),M=Math.floor((x+k)*kf);this.index.add(z,M),this.keys.push(S),this.crossTileIDs.push(I)}this.index.finish()}findMatches(r,l,f){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),x=kf/Math.pow(2,l.canonical.z-this.tileID.canonical.z),w=l.canonical.x*o.al,S=l.canonical.y*o.al;for(let I=0;I<r.length;I++){const R=r.get(I);if(R.crossTileID)continue;const{key:k,tileAnchorX:z,tileAnchorY:M}=R,B=Math.floor((w+z)*x),j=Math.floor((S+M)*x),U=this.index.range(B-_,j-_,B+_,j+_).sort((Z,q)=>Z-q);for(const Z of U){const q=this.crossTileIDs[Z];if(this.keys[Z]===k&&!f.has(q)){f.add(q),R.crossTileID=q;break}}}}}class ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ja{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(l!==0)for(const f in this.indexes){const _=this.indexes[f],x={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),x[S.tileID.key]=S}this.indexes[f]=x}this.lng=r}addBucket(r,l,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const _=this.usedCrossTileIDs[r.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>r.overscaledZ)for(const S in w){const I=w[S];I.tileID.isChildOf(r)&&I.findMatches(l.symbolInstances,r,_)}else{const S=w[r.scaledTo(Number(x)).key];S&&S.findMatches(l.symbolInstances,r,_)}}for(let x=0;x<l.symbolInstances.length;x++){const w=l.symbolInstances.get(x);w.crossTileID||(w.crossTileID=f.generate(),_.add(w.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Tu(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const f of l.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let l=!1;for(const f in this.indexes){const _=this.indexes[f];for(const x in _)r[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,_[x]),delete _[x],l=!0)}return l}}class _l{constructor(){this.layerIndexes={},this.crossTileIDs=new ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,f,_){let x=this.layerIndexes[r.fqid];x===void 0&&(x=this.layerIndexes[r.fqid]=new Ja);let w=!1;const S={};_.name!=="globe"&&x.handleWrapJump(f);for(const I of l){const R=I.getBucket(r);R&&r.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(I.tileID,R,this.crossTileIDs)&&(w=!0),S[R.bucketInstanceId]=!0)}return x.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(r){const l={};r.forEach(f=>{l[f]=!0});for(const f in this.layerIndexes)l[f]||delete this.layerIndexes[f]}}const Pn=771;class Dr{constructor(r,l,f,_){this.blendFunction=r,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=_}}Dr.Replace=[1,0,1,0],Dr.disabled=new Dr(Dr.Replace,o.ao.transparent,[!1,!1,!1,!1]),Dr.unblended=new Dr(Dr.Replace,o.ao.transparent,[!0,!0,!0,!0]),Dr.alphaBlended=new Dr([1,Pn,1,Pn],o.ao.transparent,[!0,!0,!0,!0]),Dr.alphaBlendedNonPremultiplied=new Dr([770,Pn,770,Pn],o.ao.transparent,[!0,!0,!0,!0]),Dr.multiply=new Dr([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),Dr.additive=new Dr([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class qt{constructor(r,l,f){this.func=r,this.mask=l,this.range=f}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const zc=7680;class Tr{constructor(r,l,f,_,x,w){this.test=r,this.ref=l,this.mask=f,this.fail=_,this.depthFail=x,this.pass=w}}Tr.disabled=new Tr({func:519,mask:0},0,0,zc,zc,zc);const Su=1029,Mf=2305;class _r{constructor(r,l,f){this.enable=r,this.mode=l,this.frontFace=f}}function gd(d,r){const l=o.c9(d,3);o.cb(d,r),o.cf(d,3,l)}function Of(d,r){const l=o.c6([]);return o.c7(l,l,-r),o.c8(l,l,-d),l}function D0(d,r){const l=[d[0],d[1],0],f=[r[0],r[1],0];if(o.ag(l)>=1e-15){const w=o.aw([],l);o.c4(f,w,o.bI(f,w)),r[0]=f[0],r[1]=f[1]}const _=o.bH([],r,d);if(o.c5(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return Of(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}_r.disabled=new _r(!1,Su,Mf),_r.backCCW=new _r(!0,Su,Mf),_r.backCW=new _r(!0,Su,2304),_r.frontCW=new _r(!0,1028,2304),_r.frontCCW=new _r(!0,1028,Mf);class Qa{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof o.ae?r:new o.ae(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=o.bS(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l,f){if(this.orientation=null,!this.position)return;const _=this.position,x=f||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(r)):0),w=o.ae.fromLngLat(r,x),S=[w.x-_.x,w.y-_.y,w.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=D0(S,l)}setPitchBearing(r,l){this.orientation=Of(o.an(r),o.an(-l))}}class Df{constructor(r,l){this._transform=o.bz([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new o.ae(r[0],r[1],r[2])}get position(){const r=o.c9(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&o.cf(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.c6([]),r&&gd(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=Of(r,l),gd(this._transform,this._orientation)}forward(){const r=o.c9(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.c9(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.c9(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const f=new Float64Array(16);return o.bk(f,this.getWorldToCamera(r,l)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,l,f){const _=this.position;o.c4(_,_,-r);const x=new Float64Array(16);return o.bp(x,[f,f,f]),o.bq(x,x,_),x[10]*=l,x}getWorldToCamera(r,l){const f=new Float64Array(16),_=new Float64Array(4),x=this.position;return o.ca(_,this._orientation),o.c4(x,x,-r),o.cb(f,_),o.bq(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=l,f[9]*=l,f[10]*=l,f[11]*=l,f}getCameraToClipPerspective(r,l,f,_){const x=new Float64Array(16);return o.cc(x,r,l,f,_),x}getCameraToClipOrthographic(r,l,f,_,x,w){const S=new Float64Array(16);return o.cd(S,r,l,f,_,x,w),S}getDistanceToElevation(r,l=!1){const f=r===0?0:o.ce(r,l?o.a_(this.position[1]):this.position[1]),_=this.forward();return(f-this.position[2])/_[2]}clone(){return new Df([...this.position],[...this.orientation])}}const _s={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Hs{constructor(r=0,l=0,f=0,_=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(f)||f<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=f,this.right=_}interpolate(r,l,f){return l.top!=null&&r.top!=null&&(this.top=o.ak(r.top,l.top,f)),l.bottom!=null&&r.bottom!=null&&(this.bottom=o.ak(r.bottom,l.bottom,f)),l.left!=null&&r.left!=null&&(this.left=o.ak(r.left,l.left,f)),l.right!=null&&r.right!=null&&(this.right=o.ak(r.right,l.right,f)),this}getCenter(r,l){const f=o.aA((this.left+r-this.right)/2,0,r),_=o.aA((this.top+l-this.bottom)/2,0,l);return new o.P(f,_)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Hs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Fc=15;class Eu{constructor(r,l,f,_,x,w,S){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=f??0,this._maxPitch=_??60,this.setProjection(w),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new o.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Hs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Df,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new Eu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Fc}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,l=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.cl(this.projectionOptions);const f=this.getProjection(),_=!o.bx(l,f);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cl({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bS(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.cm(),o.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=o.aA(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.an(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let _=0,x=0;for(let w=0;w<l.length;w++){const S=new o.P(l[w][0]*this.width,f+l[w][1]*(this.height-f)),I=r.pointCoordinate(S);if(!I)continue;const R=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);_+=I[3]*R,x+=R}return x===0?NaN:_/x}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(r),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-f,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const _=o.ag(o.av([],this._camera.position,f));return o.aA(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!o.co(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];o.cp(f,this._camera.position)||(this._setCameraPosition(f),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new Qa;return l.position=new o.ae(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!o.cq(r))return!1;o.cr(r,r);const l=o.cs([],[0,0,-1],r),f=o.cs([],[0,-1,0],r);if(f[2]<0)return!1;const _=D0(l,f);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;r[2]=o.aA(r[2],_/f,_/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,f){this._unmodified=!1,this._edgeInsets.interpolate(r,l,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new o.ct(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),_=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),w=this.pointCoordinate(new o.P(0,this.height)),S=Math.floor(Math.min(f.x,_.x,x.x,w.x)),I=Math.floor(Math.max(f.x,_.x,x.x,w.x)),R=1;for(let k=S-R;k<=I+R;k++)k!==0&&l.push(new o.ct(k,r))}return l}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,l,f){let _=[];const x=f!=null,w=!x;if(w&&this.zoom<l||x&&f[0]===0&&f[1]===0)return _;const S=new Set,I=(k,z,M,B,j)=>{const U=o.cX(z,k,M,B,j);S.has(U)||(_.push(new o.aP(k,z,M,B,j)),S.add(U))};for(let k=0;k<r.length;k++){const z=r[k];if(w&&z.canonical.z!==l)continue;const M=z.canonical,B=z.overscaledZ,j=z.wrap,U=1<<M.z,Z=M.x+1<U,q=M.x>0,K=M.y+1<U,ne=M.y>0,ee=z.wrap-(q?0:1),ge=z.wrap+(Z?0:1),oe=q?M.x-1:U-1,ve=Z?M.x+1:0;if(x)f[0]<0?(I(B,ge,M.z,ve,M.y),f[1]<0&&K&&(I(B,j,M.z,M.x,M.y+1),I(B,ge,M.z,ve,M.y+1)),f[1]>0&&ne&&(I(B,j,M.z,M.x,M.y-1),I(B,ge,M.z,ve,M.y-1))):f[0]>0?(I(B,ee,M.z,oe,M.y),f[1]<0&&K&&(I(B,j,M.z,M.x,M.y+1),I(B,ee,M.z,oe,M.y+1)),f[1]>0&&ne&&(I(B,j,M.z,M.x,M.y-1),I(B,ee,M.z,oe,M.y-1))):f[1]<0&&K?I(B,j,M.z,M.x,M.y+1):ne&&I(B,j,M.z,M.x,M.y-1);else{const pe=z.visibleQuadrants;1&pe&&(I(B,ee,M.z,oe,M.y),ne&&(I(B,j,M.z,M.x,M.y-1),I(B,ee,M.z,oe,M.y-1))),2&pe&&(I(B,ge,M.z,ve,M.y),ne&&(I(B,j,M.z,M.x,M.y-1),I(B,ge,M.z,ve,M.y-1))),4&pe&&(I(B,ee,M.z,oe,M.y),K&&(I(B,j,M.z,M.x,M.y+1),I(B,ee,M.z,oe,M.y+1))),8&pe&&(I(B,ge,M.z,ve,M.y),K&&(I(B,j,M.z,M.x,M.y+1),I(B,ge,M.z,ve,M.y+1)))}}const R=[];for(const k of _)_.some(z=>k.isChildOf(z))||R.push(k);if(_=R.filter(k=>!r.some(z=>!!(k.overscaledZ<l&&z.isChildOf(k))||k.equals(z)||k.isChildOf(z))),w){const k=1<<l,z=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),M=[k*z.x,k*z.y],B=4,j=B*B;_=_.filter(U=>{const Z=U.canonical.x+.5-M[0],q=U.canonical.y+.5-M[1];return Z*Z+q*q<j})}return _}extendTileCoverToNearPlane(r,l,f){const _=[],x=new Set;for(const K of r)x.add(K.key);const w=(K,ne,ee,ge,oe)=>{const ve=o.cX(ne,K,ee,ge,oe);x.has(ve)||(_.push(new o.aP(K,ne,ee,ge,oe)),x.add(ve))},S=r.reduce((K,ne)=>Math.max(K,ne.overscaledZ),f),I=1<<f,R=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],k=new o.P(0,0),z=new o.P(0,0),M=(K,ne)=>{const ee=Math.floor(K[0]),ge=Math.floor(K[1]),oe=(K[0]-ee)*o.al,ve=(K[1]-ge)*o.al,pe=Math.floor(ne[0]),ce=Math.floor(ne[1]),xe=(ne[0]-pe)*o.al,Me=(ne[1]-ce)*o.al;for(let Ce=-1;Ce<=1;Ce++){const We=ee+Ce;if(!(We<0||We>=I)){k.x=oe-Ce*o.al,z.x=xe-(We-pe)*o.al;for(let Ne=-1;Ne<=1;Ne++){const Qe=ge+Ne;k.y=ve-Ne*o.al,z.y=Me-(Qe-ce)*o.al,o.cY(k,z,R)&&w(S,0,f,We,Qe)}}}},B=l.points,j=B[o.cu],U=B[o.cv],Z=this._projectToGround(j,B[o.cw]),q=this._projectToGround(U,B[o.cx]);return M(j,Z),M(U,q),_}_projectToGround(r,l){return o.cy(o.cz(),r,l,r[2]/(r[2]-l[2]))}coveringTiles(r){let l=this.coveringZoomLevel(r);const f=l,_=this.elevation&&this.elevation.exaggeration(),x=_&&!r.isTerrainDEM,w=this.projection.name==="mercator";if(r.minzoom!==void 0&&l<r.minzoom)return[];r.maxzoom!==void 0&&l>r.maxzoom&&(l=r.maxzoom);const S=this.locationCoordinate(this.center),I=this.center.lat,R=1<<l,k=[R*S.x,R*S.y,0],z=this.projection.name==="globe",M=!z,B=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,M),j=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=R*o.ce(1,this.center.lat),Z=this._camera.position[2]/o.ce(1,this.center.lat),q=[R*j.x,R*j.y,Z*(M?1:U)],K=z||_,ne=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),ee=this.isLODDisabled(!0)?l:0;let ge;if(this._elevation&&r.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const Ie=this._elevation.getMinMaxForVisibleTiles();ge=Ie?Ie.max:this._centerAltitude}else ge=this._centerAltitude;const oe=r.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?o.cB(this):1,pe=Ie=>{const je=new o.ae(Ie.x+25e-6,Ie.y,Ie.z),ot=new o.ae(Ie.x,Ie.y+25e-6,Ie.z),wt=Ie.toLngLat(),jt=je.toLngLat(),pt=ot.toLngLat(),vt=this.locationCoordinate(wt),$t=this.locationCoordinate(jt),Ot=this.locationCoordinate(pt),Rt=Math.hypot($t.x-vt.x,$t.y-vt.y),Dt=Math.hypot(Ot.x-vt.x,Ot.y-vt.y);return Math.sqrt(Rt*Dt)*ve/25e-6},ce=Ie=>{const et=ge,je=oe;return{aabb:o.cE(this,R,0,0,0,Ie,je,et,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:et,wrap:Ie,fullyVisible:!1}},xe=[];let Me=[];const Ce=l,We=r.reparseOverscaled?f:l,Ne=(Z-this._centerAltitude)*U,Qe=Ie=>{if(!this._elevation||!Ie.tileID||!w)return;const et=this._elevation.getMinMaxForTile(Ie.tileID),je=Ie.aabb;et?(je.min[2]=et.min,je.max[2]=et.max,je.center[2]=(je.min[2]+je.max[2])/2):(Ie.shouldSplit=Fe(Ie),Ie.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},_t=(Ie,et)=>{if(.707*et<Ie)return 1;const je=et/Ie;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Ie=>{if(Ie.zoom<ee)return!0;if(Ie.zoom===Ce)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const et=Ie.aabb.distanceX(q),je=Ie.aabb.distanceY(q);let ot=Ne,wt=1;if(z){ot=Ie.aabb.distanceZ(q);const Dt=Math.pow(2,Ie.zoom),lr=o.a_((Ie.y+1)/Dt),Ur=o.a_(Ie.y/Dt),Jr=Math.min(Math.max(I,lr),Ur),Ci=o.d0(Jr)/o.d0(I);if(wt=Jr===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ci/this._mercatorScaleRatio),this.zoom<=o.cZ&&Ie.zoom===Ce-1&&Ci>=.9)return!0}else if(x&&(ot=Ie.aabb.distanceZ(q)*U),this.projection.isReprojectedInTileSpace&&f<=5){const Dt=Math.pow(2,Ie.zoom),lr=pe(new o.ae((Ie.x+.5)/Dt,(Ie.y+.5)/Dt));wt=lr>.85?1:lr}if(!w&&!z){const Dt=Math.sqrt(et*et+je*je+ot*ot);let lr=(1<<Ce-Ie.zoom)*ne*wt;return lr*=_t(Math.max(ot,Ne),Dt),Dt<lr}let jt=Number.MAX_VALUE,pt=0;const vt=Ie.aabb.getCorners(),$t=[];for(const Dt of vt){o.av($t,Dt,q),z||(x?$t[2]*=U:$t[2]=Ne);const lr=o.bI($t,this._camera.forward());lr<jt&&(jt=lr,pt=Math.abs($t[2]))}let Ot=(1<<Ce-Ie.zoom)*ne*wt;if(Ot*=_t(Math.max(pt,Ne),jt),jt<Ot)return!0;const Rt=Ie.aabb.closestPoint(k);return Rt[0]===k[0]&&Rt[1]===k[1]};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)xe.push(ce(-Ie)),xe.push(ce(Ie));for(xe.push(ce(0));xe.length>0;){const Ie=xe.pop(),et=Ie.x,je=Ie.y;let ot=Ie.fullyVisible;const wt=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!ot){let jt=K?Ie.aabb.intersects(B):Ie.aabb.intersectsFlat(B);if(jt===0&&wt()){const pt=new o.cC(Ie.zoom,et,je);jt=o.cD(this,R,pt,!0).intersects(B)}if(jt===0)continue;ot=jt===2}if(Ie.zoom!==Ce&&Fe(Ie))for(let jt=0;jt<4;jt++){const pt=(et<<1)+jt%2,vt=(je<<1)+(jt>>1),$t={aabb:w?Ie.aabb.quadrant(jt):o.cE(this,R,Ie.zoom+1,pt,vt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:pt,y:vt,wrap:Ie.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};x&&!z&&($t.tileID=new o.aP(Ie.zoom+1===Ce?We:Ie.zoom+1,Ie.wrap,Ie.zoom+1,pt,vt),Qe($t)),xe.push($t)}else{const jt=Ie.zoom===Ce?We:Ie.zoom;if(r.minzoom&&r.minzoom>jt)continue;let pt=0;if(!ot){let Rt=K?Ie.aabb.intersectsPrecise(B):Ie.aabb.intersectsPreciseFlat(B);if(Rt===0&&wt()){const Dt=new o.cC(Ie.zoom,et,je);Rt=o.cD(this,R,Dt,!0).intersectsPrecise(B)}if(Rt===0)continue;if(r.calculateQuadrantVisibility)if(B.containsPoint(Ie.aabb.center))pt=15;else for(let Dt=0;Dt<4;Dt++)Ie.aabb.quadrant(Dt).intersects(B)!==0&&(pt|=1<<Dt)}const vt=k[0]-(.5+et+(Ie.wrap<<Ie.zoom))*(1<<l-Ie.zoom),$t=k[1]-.5-je,Ot=Ie.tileID?Ie.tileID:new o.aP(jt,Ie.wrap,Ie.zoom,et,je);r.calculateQuadrantVisibility&&(Ot.visibleQuadrants=pt),Me.push({tileID:Ot,distanceSq:vt*vt+$t*$t})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,et=this.horizonLineFromTop();Me=Me.filter(je=>{const ot=[0,0,0,1],wt=[o.al,o.al,0,1],jt=this.calculateFogTileMatrix(je.tileID.toUnwrapped());o.aC(ot,ot,jt),o.aC(wt,wt,jt);const pt=o.cF([],ot,wt),vt=o.cG([],ot,wt),$t=o.c_(pt,vt);if($t===0)return!0;let Ot=!1;const Rt=this._elevation;if(Rt&&$t>Ie&&et!==0){const Dt=this.calculateProjMatrix(je.tileID.toUnwrapped());let lr;r.isTerrainDEM||(lr=Rt.getMinMaxForTile(je.tileID)),lr||(lr={min:oe,max:ge});const Ur=o.cH(this.rotation),Jr=[Ur[0]*o.al,Ur[1]*o.al,lr.max];o.af(Jr,Jr,Dt),Ot=(1-Jr[1])*this.height*.5<et}return $t<Ie||Ot})}return Me.sort((Ie,et)=>Ie.distanceSq-et.distanceSq).map(Ie=>Ie.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log2(r)}project(r){const l=o.aA(r.lat,-o.cI,o.cI),f=this.projection.project(r.lng,l);return new o.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let f,_;const x=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;f=(l.x-x.x)/S,_=(l.y-x.y)/S}else{const S=this.pointCoordinate(l),I=this.pointCoordinate(x);f=S.x-I.x,_=S.y-I.y}const w=this.locationCoordinate(r);this.setLocation(new o.ae(w.x-f,w.y-_))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,l){return this.projection.locationPoint(this,r,l)}locationPoint3D(r,l){return this.projection.locationPoint(this,r,l,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,l){return this.coordinateLocation(this.pointCoordinate3D(r,l))}locationCoordinate(r,l){const f=l?o.ce(l,r.lat):void 0,_=this.projection.project(r.lng,r.lat);return new o.ae(_.x,_.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const f=l??this._centerAltitude,_=[r.x,r.y,0,1],x=[r.x,r.y,1,1];o.aC(_,_,this.pixelMatrixInverse),o.aC(x,x,this.pixelMatrixInverse);const w=x[3];o.cJ(_,_,1/_[3]),o.cJ(x,x,1/w);const S=_[2],I=x[2];return{p0:_,p1:x,t:S===I?0:(f-S)/(I-S)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return o.aC(l,l,this.pixelMatrixInverse),o.aC(f,f,this.pixelMatrixInverse),o.cJ(l,l,1/l[3]),o.cJ(f,f,1/f[3]),l[2]=o.ce(l[2],this._center.lat)*this.worldSize,f[2]=o.ce(f[2],this._center.lat)*this.worldSize,o.cJ(l,l,1/this.worldSize),o.cJ(f,f,1/this.worldSize),new o.ax([l[0],l[1],l[2]],o.aw([],o.av([],f,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:f,t:_}=r,x=o.ce(l[2],this._center.lat),w=o.ce(f[2],this._center.lat);return new o.ae(o.ak(l[0],f[0],_)/this.worldSize,o.ak(l[1],f[1],_)/this.worldSize,o.ak(x,w,_))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r,l){if(!this.elevation)return this.pointCoordinate(r,l);let f=this.projection.pointCoordinate3D(this,r.x,r.y);if(f)return new o.ae(f[0],f[1],f[2]);let _=0,x=this.horizonLineFromTop();if(r.y>x)return this.pointCoordinate(r,l);const w=.02*x,S=r.clone();for(let I=0;I<10&&x-_>w;I++){S.y=o.ak(_,x,.66);const R=this.projection.pointCoordinate3D(this,S.x,S.y);R?(x=S.y,f=R):_=S.y}return f?new o.ae(f[0],f[1],f[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cK)return!this.isPointAboveHorizon(r);const l=this.pointCoordinate(r);return l.y>=0&&l.y<=1}_coordinatePoint(r,l){const f=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,_=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return o.aC(_,_,this.pixelMatrix),_[3]>0?new o.P(_[0]/_[3],_[1]/_[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(l,r)),w=this.pointLocation3D(new o.P(_,r)),S=this.pointLocation3D(new o.P(_,f)),I=this.pointLocation3D(new o.P(l,f));let R=Math.min(x.lng,w.lng,S.lng,I.lng),k=Math.max(x.lng,w.lng,S.lng,I.lng),z=Math.min(x.lat,w.lat,S.lat,I.lat),M=Math.max(x.lat,w.lat,S.lat,I.lat);const B=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=(Z,q,K,ne,ee)=>{const ge=(Z+K)/2,oe=(q+ne)/2,ve=new o.P(ge,oe),{lng:pe,lat:ce}=this.pointLocation3D(ve),xe=Math.max(0,R-pe,z-ce,pe-k,ce-M);R=Math.min(R,pe),k=Math.max(k,pe),z=Math.min(z,ce),M=Math.max(M,ce),(ee<j||xe>B)&&(U(Z,q,ge,oe,ee+1),U(ge,oe,K,ne,ee+1))};if(U(l,r,_,r,1),U(_,r,_,f,1),U(_,f,l,f,1),U(l,f,l,r,1),this.projection.name==="globe"){const[Z,q]=o.cL(this);Z?(M=90,k=180,R=-180):q&&(z=-90,k=180,R=-180)}return new o.aI(new o.aS(R,z),new o.aS(k,M))}_getBoundsRectangular(r,l){const{top:f,left:_}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=new o.P(_,f),I=new o.P(w,f),R=new o.P(w,x),k=new o.P(_,x);let z=this.pointCoordinate(S,r),M=this.pointCoordinate(I,r);const B=this.pointCoordinate(R,l),j=this.pointCoordinate(k,l),U=(Z,q)=>(q.y-Z.y)/(q.x-Z.x);return z.y>1&&M.y>=0?z=new o.ae((1-j.y)/U(j,z)+j.x,1):z.y<0&&M.y<=1&&(z=new o.ae(-j.y/U(j,z)+j.x,0)),M.y>1&&z.y>=0?M=new o.ae((1-B.y)/U(B,M)+B.x,1):M.y<0&&z.y<=1&&(M=new o.ae(-B.y/U(B,M)+B.x,0)),new o.aI().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((f,_)=>{if(_.dem){const x=_.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cI,this.maxLat=o.cI,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,f=this._distanceTileDataCache;if(f[l])return f[l];const _=r.canonical,x=1/this.height,w=this.cameraWorldSize,S=w/this.zoomScale(_.z),I=(_.x+Math.pow(2,_.z)*r.wrap)*S,R=_.y*S,k=this.point;k.x*=w/this.worldSize,k.y*=w/this.worldSize;const z=this.angle,M=Math.sin(-z),B=-Math.cos(-z);return f[l]={bearing:[M,B],center:[(k.x-I)*x,(k.y-R)*x],scale:S/o.al*x},f[l]}calculateFogTileMatrix(r){const l=r.key,f=this._fogTileMatrixCache;if(f[l])return f[l];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.aB(_,this.worldToFogMatrix,_),f[l]=new Float32Array(_),f[l]}calculateProjMatrix(r,l=!1,f=!1){const _=r.key;let x;if(x=f?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,x[_])return x[_];const w=this.calculatePosMatrix(r,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.aB(w,S,w),x[_]=new Float32Array(w),x[_]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[l])return f[l];const _=o.cM(r,this);return f[l]=_,f[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,l=o.bp([],[r,r,r]);return o.aB(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const l=o.ce(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(l),_=this._camera.forward(),x=o.ce(1,this._center.lat);f[2]/=x,_[2]/=x,o.aw(_,_);const w=r.raycast(f,_,r.exaggeration());if(w){const S=o.bG([],f,_,w),I=new o.ae(S[0],S[1],o.ce(S[2],o.a_(S[1]))),R=(I.z+o.ag([I.x-f[0],I.y-f[1],I.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,f=o.ce(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(f),x=l.getAtPointOrZero(new o.ae(..._)),w=this.pixelsPerMeter/this.worldSize*x,S=this._minimumHeightOverTerrain(),I=_[2]-w;if(I<=S)if(I<0||r){const R=this.locationCoordinate(this._center,this._centerAltitude),k=[_[0],_[1],R.z-_[2]],z=o.ag(k);k[2]-=(S-I)/this._pixelsPerMercatorPixel;const M=o.ag(k);if(M===0)return;o.c4(k,k,z/M*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],R.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const M=this.center;return M.lat=o.aA(M.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(M.lng=o.aA(M.lng,this.minLng,this.maxLng)),this.center=M,void(this._constraining=!1)}const l=this._unmodified,{x:f,y:_}=this.point;let x=0,w=f,S=_;const I=this.width/2,R=this.height/2,k=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(_-R<k&&(S=k+R),_+R>z&&(S=z-R),z-k<this.height&&(x=Math.max(x,this.height/(z-k)),S=(z+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const M=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,j=this.worldSize/2-(M+B)/2;w=(f+j+this.worldSize)%this.worldSize-j,w-I<M&&(w=M+I),w+I>B&&(w=B-I),B-M<this.width&&(x=Math.max(x,this.width/(B-M)),w=(B+M)/2)}w===f&&S===_||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(w,S))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.ce(1,this.center.lat)/o.ce(1,o.d1));const _=o.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,w=this._camera.getWorldToCamera(this.worldSize,x);let S;const I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-r.x/this.width,I[9]=2*r.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),xe=ce*this.aspect,Me=-xe,Ce=-ce;xe-=r.x,Me-=r.x,ce+=r.y,Ce+=r.y,S=this._camera.getCameraToClipOrthographic(Me,xe,Ce,ce,this._nearZ,this._farZ),((We,Ne,Qe,_t)=>{for(let Fe=0;Fe<16;Fe++)We[Fe]=o.ak(Ne[Fe],Qe[Fe],_t)})(S,S,I,o.c$(this.pitch>=Fc?1:this.pitch/Fc))}else S=I;const R=o.cO([],I,w);let k=o.cO([],S,w);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),xe=o.bz([]);o.bq(xe,xe,[ce.x*this.worldSize,ce.y*this.worldSize,0]),o.aB(xe,xe,o.cP(this)),o.bq(xe,xe,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),o.aB(k,k,xe),o.aB(R,R,xe),this.inverseAdjustmentMatrix=o.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cR([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=o.bk(new Float64Array(16),this.projMatrix),l){const ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-r.x/this.width,ce[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cO([],ce,w)}else this.expandedFarZProjMatrix=this.projMatrix;const z=o.bk([],S);this.frustumCorners=o.cS.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const M=new Float32Array(16);o.bz(M),o.cR(M,M,[1,-1,1]),o.cT(M,M,this._pitch),o.bA(M,M,this.angle);const B=o.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.by(B);const j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-r.x/this.width,B[9]=2*(r.y+j)/this.height,this.skyboxMatrix=o.aB(M,B,M);const U=this.point,Z=U.x,q=U.y,K=this.width%2/2,ne=this.height%2/2,ee=Math.cos(this.angle),ge=Math.sin(this.angle),oe=Z-Math.round(Z)+ee*K+ge*ne,ve=q-Math.round(q)+ee*ne+ge*K,pe=new Float64Array(k);if(o.bq(pe,pe,[oe>.5?oe-1:oe,ve>.5?ve-1:ve,0]),this.alignedProjMatrix=pe,k=o.bB(),o.cR(k,k,[this.width/2,-this.height/2,1]),o.bq(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=o.bB(),o.cR(k,k,[1,-1,1]),o.bq(k,k,[-1,-1,0]),o.cR(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},k=o.bk(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cU(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(ce,ce,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,f=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,x=[r,r,l];o.c4(x,x,_),o.c4(f,f,-1),o.cV(f,f,x);const w=o.bB();o.bq(w,w,f),o.cR(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,_)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-f[0]*x,_.y/this.worldSize-f[1]*x,r/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],_=r[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(x=Math.min((l-f)/_,1)),this._camera.position=o.bG([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:f,bearing:_}=this._camera.getPitchBearing(),x=o.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),S=Math.max((r[2]-x)/Math.cos(f),w),I=this._zoomFromMercatorZ(S);o.bG(r,r,l,S),this._pitch=o.aA(f,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bS(_,-Math.PI,Math.PI),this._setZoom(o.aA(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,f=o.cK,_=0,x=1/0;for(;f-l>1e-6&&f>l;){const w=l+.5*(f-l),S=this.tileSize*Math.pow(2,w),I=this.getCameraToCenterDistance(this.projection,w,S),R=this.scaleZoom(I/(Math.max(0,r)*this.tileSize)),k=Math.abs(w-R);k<x&&(x=k,_=w),w<R?l=w:f=w}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const f=Math.min(r.x,l.x),_=Math.max(r.x,l.x),x=Math.min(r.y,l.y),w=Math.max(r.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new o.P(f,x),new o.P(_,w),new o.P(f,w),new o.P(_,x)],I=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const k of S){const z=this.pointRayIntersection(k);if(z.t<0)return!0;const M=this.rayIntersectionCoordinate(z);if(M.x<I||M.y<0||M.x>R||M.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,l){const f=o.ag(o.av([],this._camera.position,r)),_=this._zoomFromMercatorZ(f)+l;return f-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([l,f,_],x){const w=[l,f,_,1];o.aC(w,w,x);const S=w[3]=Math.max(w[3],1e-6);return w[0]/=S,w[1]/=S,w[2]/=S,w}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,l=this.zoom,f=this.worldSize){const _=o.cN(r,l,this.width,this.height,1024),x=r.pixelSpaceConversion(this.center.lat,f,_);let w=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(w=o.ak(1,w,o.c$(this.pitch>=Fc?1:this.pitch/Fc))),w}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(r,r,this.globeMatrix),r}getFrustum(r){return o.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const yl=(d,r)=>{if(r>0&&d.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=d.transform,f=Math.max(Math.abs(l._zoom-(d.minCutoffZoom-1)),1),_=l.isLODDisabled(!1)?o.ah(60,45,l.pitch):o.ah(30,15,l.pitch),x=l._farZ-l._nearZ,w=r*l.height,S=((1-(I=_))*l.cameraToCenterDistance+I*(l._farZ+w))*f;var I;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(S-l._nearZ)/x,(S-w-l._nearZ)/x]}}},ys={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Jw{constructor(r,l){this.aabb=r,this.lastCascade=l}}class Qw{add(r,l){const f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],l.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],l.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],l.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],l.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],l.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],l.max[2])):this.receivers[r.key]=new Jw(l,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,l,f){const _=o.d8.fromPoints(r.points);let x=0;for(const w in this.receivers){const S=this.receivers[w];if(!S||!_.intersectsAabb(S.aabb))continue;S.aabb.min=_.closestPoint(S.aabb.min),S.aabb.max=_.closestPoint(S.aabb.max);const I=S.aabb.getCorners();for(let R=0;R<f.length;R++){let k=!0;for(const z of I){const M=[z[0]*l,z[1]*l,z[2]];if(o.af(M,M,f[R].matrix),M[0]<-1||M[0]>1||M[1]<-1||M[1]>1){k=!1;break}}if(S.lastCascade=R,x=Math.max(x,R),k)break}}return x+1}}class _d{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Qw,this._depthMode=new qt(r.context.gl.LEQUAL,qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(ys,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(ys,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(ys,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,l){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const _=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||_<=0||(this._shadowLayerCount=f.style.order.reduce((j,U)=>{const Z=f.style._mergedLayers[U];return j+(Z.hasShadowPass()&&!Z.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=f.context,w=ys.shadowMapResolution,S=ys.shadowMapResolution;if(this._cascades.length===0||ys.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<ys.cascadeCount;++j){const U=f._shadowMapDebug,Z=x.gl,q=x.createFramebuffer(w,S,U,"texture"),K=new o.T(x,{width:w,height:S,data:null},Z.DEPTH_COMPONENT16);if(q.depthAttachment.set(K.texture),U){const ne=new o.T(x,{width:w,height:S,data:null},Z.RGBA8);q.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:q,texture:K,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cA,scale:0})}}this.shadowDirection=L0(l);let I=0;if(r.elevation){const j=r.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter(Z=>Z.dem).forEach(Z=>{const q=Z.dem.tree;U[0]=Math.min(U[0],q.minimums[0]),U[1]=Math.max(U[1],q.maximums[0])}),U[0]!==1e4&&(I=(U[1]-U[0])*j.exaggeration())}const R=1.5*r.cameraToCenterDistance,k=3*R,z=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){const U=this._cascades[j];let Z=r.height/50,q=1;ys.cascadeCount===1?q=k:j===0?q=R:(Z=R,q=k);const[K,ne]=z0(r,this.shadowDirection,Z,q,ys.shadowMapResolution,I);U.scale=r.scale,U.matrix=K,U.boundingSphereRadius=ne,o.bk(z,U.matrix),U.frustum=o.cA.fromInvProjectionMatrix(z,1,0,!0),U.far=q}const M=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[M].far,this._cascades[M].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ys.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ys.shadowMapResolution,this._uniformValues.u_shadowmap_0=_s.ShadowMap0,this._uniformValues.u_shadowmap_1=_s.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const B=f.transform.elevation;for(const j of this._groundShadowTiles){let U={min:0,max:0};if(B){const Z=B.getMinMaxForTile(j);Z&&(U=Z)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,l){if(!this.enabled)return;const f=this.painter,_=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),_.viewport.set([0,0,ys.shadowMapResolution,ys.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,_.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),_.clear({color:o.ao.white,depth:1});for(const w of r.order){const S=r._mergedLayers[w];if(!S.hasShadowPass()||S.isHidden(f.transform.zoom))continue;const I=r.getLayerSourceCache(S),R=I?l[I.id]:void 0;(S.type==="model"||R&&R.length)&&f.renderLayer(f,I,S,R)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,l=r.style,f=r.context,_=f.gl,x=l.directionalLight,w=l.ambientLight;if(!x||!w)return;const S=[],I=yl(r,r.longestCutoffRange);I.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const R=fa(l,x,w),k=new qt(_.LEQUAL,qt.ReadOnly,r.depthRangeFor3D),z=new Tr({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const M of this._groundShadowTiles){const B=M.toUnwrapped(),j=r.isTileAffectedByFog(M),U=r.getOrCreateProgram("groundShadow",{defines:S,overrideFog:j});this.setupShadows(B,U),r.uploadCommonUniforms(f,U,B,null,I);const Z={u_matrix:r.transform.calculateProjMatrix(B),u_ground_shadow_factor:R};U.draw(r,_.TRIANGLES,k,z,Dr.multiply,_r.disabled,Z,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dr.unblended:Dr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const l=this.painter.transform,f=l.calculatePosMatrix(r,l.worldSize);return o.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){const l=o.by(r);return o.aB(l,this._cascades[this.painter.currentShadowCascade].matrix,r),l}setupShadows(r,l,f){if(!this.enabled)return;const _=this.painter.transform,x=this.painter.context,w=x.gl,S=this._uniformValues,I=new Float64Array(16),R=_.calculatePosMatrix(r,_.worldSize);for(let k=0;k<this._cascades.length;k++)o.aB(I,this._cascades[k].matrix,R),S[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(w.TEXTURE0+_s.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const k=o.d6(r.canonical),z=2/_.tileSize*o.al/ys.shadowMapResolution,M=z*this._cascades[0].boundingSphereRadius,B=z*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(f==="vector-tile"?1:3)*function(U,Z,q,K,ne){const ee=o.aA((U-22)/-22,0,1);return .125*(1-ee)+4*ee}(_.zoom);S.u_shadow_normal_offset=[k,M*j,B*j],S.u_shadow_bias=[1e-4,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(x,S)}setupShadowsFromMatrix(r,l,f=!1){if(!this.enabled)return;const _=this.painter.context,x=_.gl,w=this._uniformValues,S=new Float64Array(16);for(let I=0;I<ys.cascadeCount;I++)o.aB(S,this._cascades[I].matrix,r),w[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),_.activeTexture.set(x.TEXTURE0+_s.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=f,f){const I=ys.normalOffset;w.u_shadow_normal_offset=[1,I,I],w.u_shadow_bias=[6e-5,.0012,.012]}else w.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(_,w)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,l,f,_){if(_[2]>=0)return{};const x=function(I,R,k){const z=k/(1<<I.canonical.z);return new o.d8([I.canonical.x*z+I.wrap*k,I.canonical.y*z+I.wrap*k,0],[(I.canonical.x+1)*z+I.wrap*k,(I.canonical.y+1)*z+I.wrap*k,R])}(r,l,f).getCorners(),w=l/-_[2];_[0]<0?(o.d7(x[0],x[0],[_[0]*w,0,0]),o.d7(x[3],x[3],[_[0]*w,0,0])):_[0]>0&&(o.d7(x[1],x[1],[_[0]*w,0,0]),o.d7(x[2],x[2],[_[0]*w,0,0])),_[1]<0?(o.d7(x[0],x[0],[0,_[1]*w,0]),o.d7(x[1],x[1],[0,_[1]*w,0])):_[1]>0&&(o.d7(x[2],x[2],[0,_[1]*w,0]),o.d7(x[3],x[3],[0,_[1]*w,0]));const S={};return S.vertices=x,S.planes=[Jl(x[1],x[0],x[4]),Jl(x[2],x[1],x[5]),Jl(x[3],x[2],x[6]),Jl(x[0],x[3],x[7])],S}addShadowReceiver(r,l,f){this._receivers.add(r,o.d8.fromTileIdAndHeight(r,l,f))}getMaxCascadeForTile(r){const l=this._receivers.get(r);return l&&l.lastCascade?l.lastCascade:0}}function Jl(d,r,l){const f=o.av([],l,r),_=o.av([],d,r),x=o.bH([],f,_),w=o.ag(x);return w===0?[0,0,1,0]:(o.c4(x,x,1/w),[x[0],x[1],x[2],-o.bI(x,r)])}function L0(d){const r=d.properties.get("direction"),l=o.d3(r.x,r.y,r.z);l[2]=o.aA(l[2],0,75);const f=o.d5([l[0],l[1],l[2]]);return o.d4(f.x,f.y,f.z)}function fa(d,r,l){const f=r.properties.get("color-use-theme")==="none",_=r.properties.get("color"),x=r.properties.get("intensity"),w=r.properties.get("direction"),S=[w.x,w.y,w.z],I=l.properties.get("color-use-theme")==="none",R=l.properties.get("color"),k=l.properties.get("intensity"),z=Math.max(o.bI([0,0,1],S),0),M=[0,0,0];o.c4(M,R.toPremultipliedRenderColor(I?null:d.getLut(r.scope)).toArray01Linear().slice(0,3),k);const B=[0,0,0];return o.c4(B,_.toPremultipliedRenderColor(f?null:d.getLut(l.scope)).toArray01Linear().slice(0,3),z*x),o.da([M[0]>0?M[0]/(M[0]+B[0]):0,M[1]>0?M[1]/(M[1]+B[1]):0,M[2]>0?M[2]/(M[2]+B[2]):0])}function z0(d,r,l,f,_,x){const w=d.zoom,S=d.scale,I=d.worldSize,R=1/I,k=d.aspect,z=Math.sqrt(1+k*k)*Math.tan(.5*d.fovX),M=z*z,B=f-l,j=f+l;let U,Z;M>B/j?(U=f,Z=f*z):(U=.5*j*(1+M),Z=.5*Math.sqrt(B*B+2*(f*f+l*l)*M+j*j*M*M));const q=d.projection.pixelsPerMeter(d.center.lat,I),K=d._camera.getCameraToWorldMercator(),ne=[0,0,-U*R];o.af(ne,ne,K);let ee=Z*R;const ge=d._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const ot=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?q:1),wt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,l,f);wt[8]=2*-d.centerOffset.x/d.width,wt[9]=2*d.centerOffset.y/d.height;const jt=new Float64Array(16);o.cO(jt,wt,ot);const pt=new Float64Array(16);o.bk(pt,jt);const vt=o.cA.fromInvProjectionMatrix(pt,I,w,!0);for(const $t of vt.points){const Ot=((oe=$t)[0]/=S,oe[1]/=S,oe[2]=o.ce(oe[2],d._center.lat),oe);ee=Math.max(ee,o.c5(o.d9([],ne,Ot)))}}var oe;ee*=_/(_-1);const ve=Math.acos(r[2]),pe=Math.atan2(-r[0],-r[1]),ce=new Df;ce.position=ne,ce.setPitchBearing(ve,pe);const xe=ce.getWorldToCamera(I,q),Me=ee*I,Ce=Math.min(d._mercatorZfromZoom(17)*I*-2,-2*Me),We=ce.getCameraToClipOrthographic(-Me,Me,-Me,Me,Ce,(Me+x*q)/r[2]),Ne=new Float64Array(16);o.aB(Ne,We,xe);const Qe=o.d4(Math.floor(1e6*ne[0])/1e6*I,Math.floor(1e6*ne[1])/1e6*I,0),_t=.5*_,Fe=[0,0,0];o.af(Fe,Qe,Ne),o.c4(Fe,Fe,_t);const Ie=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],et=[0,0,0];o.av(et,Fe,Ie),o.c4(et,et,-1/_t);const je=new Float64Array(16);return o.bz(je),o.bq(je,je,et),o.aB(Ne,je,Ne),[Ne,Me]}class Lf extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,l){return o.db(this.requestManager.transformRequest(l,o.R.Model).url).then(f=>{if(!f)return;const _=o.dc(f),x=new o.dd(r,l,void 0,void 0,_);return x.computeBoundsAndApplyParent(),x}).catch(f=>{if(f&&f.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${r} from ${l}: ${f.message}`)))})}load(r,l,f={forceReload:!1}){this.models[l]||(this.models[l]={});const _=Object.keys(r),x=[],w=[];for(const S of _){const I=r[S];this.hasURLBeenRequested(I)&&!f.forceReload||(this.modelByURL[I]={modelId:S,scope:l},x.push(this.loadModel(S,I)),w.push(S)),this.models[l][S]||(this.models[l][S]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+w.length,Promise.allSettled(x).then(S=>{for(let I=0;I<S.length;I++){const{status:R}=S[I];if(R==="rejected")continue;const{value:k}=S[I];this.models[l][w[I]]||(this.models[l][w[I]]={model:null,numReferences:1}),this.models[l][w[I]].model=k}this.numModelsLoading[l]-=w.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(S=>{this.fire(new o.y(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,l,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(r,l):this.getModelByURL(this.modelUris[l][r]))}getModel(r,l){return this.models[l]||(this.models[l]={}),this.models[l][r]?this.models[l][r].model:void 0}getModelByURL(r){if(!r)return null;const l=this.modelByURL[r];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(r,l){return this.models[l]&&this.models[l][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,l,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const _=this.requestManager.normalizeModelURL(l);if((this.hasModel(r,f,{exactIdMatch:!0})||this.hasModelBeenAdded(r,f))&&this.modelUris[f][r]===_)this.models[f][r].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:x,modelId:w}=this.modelByURL[_];this.models[x][w].numReferences++}else this.modelUris[f][r]=_,this.load({[r]:this.modelUris[f][r]},f)}addModelURLs(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const f=this.modelUris[l];for(const _ in r)f[_]=this.requestManager.normalizeModelURL(r[_])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const f={};for(const _ of r)this.hasModel(_,l,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[l][_].numReferences++:this.modelUris[l][_]&&!this.hasURLBeenRequested(_)?f[_]=this.modelUris[l][_]:!this.hasURLBeenRequested(_)&&o.de(_,!1)&&(this.modelUris[l][_]=this.requestManager.normalizeModelURL(_),f[_]=this.modelUris[l][_]);this.load(f,l)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,l,f=!1,_=!1){if(this.models[l]&&this.models[l][r]&&(this.models[l][r].numReferences--,this.models[l][r].numReferences===0||_)){const x=this.modelUris[l][r];f||delete this.modelUris[l][r],delete this.modelByURL[x];const w=this.models[l][r].model;if(!w)return;delete this.models[l][r],w.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const l of Object.keys(this.models[r])){const f=this.models[r][l].model;delete this.models[r][l],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,l){this.models[l]||(this.models[l]={});for(const f in this.models[l])this.models[l][f].model&&this.models[l][f].model.upload(r.context)}}const yd=o.a6.colorTheme,Ql=new o.a9({data:new o.aa(yd.data)});function eb(d){if(!d.metadata||!d.metadata.content_area)return;const r=o.o.devicePixelRatio,{left:l,top:f,width:_,height:x}=d.metadata.content_area,w=l*r,S=f*r;return[w,S,w+_*r,S+x*r]}function F0(d){if(d)return d.map(([r,l])=>[r*o.o.devicePixelRatio,l*o.o.devicePixelRatio])}class tb{constructor(r,l,f){this.id=r,this.scope=l,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return r;const f=this.sourceCache.getSource();if(!(f instanceof es))return r;const _=l.map(w=>this.sourceCache.getTile(w)),x=f.getImages(_,Array.from(this.pendingRequests));for(const[w,S]of x)r.set(o.I.from({name:w,iconsetId:this.id}),S),this.pendingRequests.delete(w);for(const w of this.pendingRequests)this.missingRequests.add(w);return this.pendingRequests.clear(),r}}const ec=(d,r)=>H(d,r&&r.filter(l=>l.identifier!=="source.canvas")),rb=o.aH(fi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),xg=o.aH(fi,["setCenter","setZoom","setBearing","setPitch"]),zf=new Set(["background","sky","slot","custom"]),wg={version:8,layers:[],sources:{}},bg={duration:300,delay:0};class pa extends o.E{constructor(r,l={}){super(),this.map=r,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=Object.assign({},bg),this._buildingIndex=new hg(this),this.crossTileSymbolIndex=new _l,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=l.styleChanges||new ss,this.dispatcher=l.dispatcher?l.dispatcher:new o.D(o.dg(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Ss(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.dh(r._requestManager,l.localFontFamily?o.di.all:l.localIdeographFontFamily?o.di.ideographs:o.di.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Lf(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._indoorDependentLayers=l.indoorDependentLayers?l.indoorDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.dj());const f=this;this._rtlTextPluginCallback=pa.registerForPluginStateChange(_=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,w)=>{if(o.dk(x),w&&w.every(S=>S))for(const S in f._sourceCaches){const I=f._sourceCaches[S],R=I.getSource().type;R!=="vector"&&R!=="geojson"||I.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const x=this.getOwnSource(_.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===x.id&&this._validateLayer(S)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.h(r))return r;const l=o.dl(r);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.dm(JSON.stringify(r))}`}_diffStyle(r,l,f){this.globalId=this._getGlobalId(r);const _=(x,w)=>{try{w(null,this.setState(x,f))}catch(S){w(S,!1)}};if(typeof r=="string"){const x=this.map._requestManager.normalizeStyleURL(r),w=this.map._requestManager.transformRequest(x,o.R.Style);o.m(w,(S,I)=>{S?this.fire(new o.y(S)):I&&_(I,l)})}else typeof r=="object"&&_(r,l)}loadURL(r,l={}){this.fire(new o.z("dataloading",{dataType:"style"}));const f=typeof l.validate=="boolean"?l.validate:!o.h(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,l.accessToken),this.resolvedImports.add(r);const _=this.importsCache.get(r);if(_)return this._load(_,f);const x=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.m(x,(w,S)=>{if(this._request=null,w)this.fire(new o.y(w));else if(S)return this.importsCache.set(r,S),this._load(S,f)})}loadJSON(r,l={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.o.frame(()=>{this._request=null,this._load(r,l.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(wg,!1)}_loadImports(r,l,f){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const x of r){const w=this._createFragmentStyle(x),S=new Promise(k=>{w.once("style.import.load",k),w.once("error",k)}).then(()=>this.mergeAll());if(_.push(S),this.resolvedImports.has(x.url)){w.loadEmpty();continue}const I=x.data||this.importsCache.get(x.url);I?(w.loadJSON(I,{validate:l}),this._isInternalStyle(I)&&(w.globalId=null)):x.url?w.loadURL(x.url,{validate:l}):w.loadEmpty();const R={style:w,id:x.id,config:x.config};if(f){const k=this.fragments.findIndex(({id:z})=>z===f);this.fragments=this.fragments.slice(0,k).concat(R).concat(this.fragments.slice(k))}else this.fragments.push(R)}return Promise.allSettled(_)}getImportGlobalIds(r=this,l=new Set){for(const f of r.fragments)f.style.globalId&&l.add(f.style.globalId),this.getImportGlobalIds(f.style,l);return[...l.values()]}_createFragmentStyle(r){const l=this.scope?o.B(r.id,this.scope):r.id;let f;const _=this._initialConfig&&this._initialConfig[l];(r.config||_)&&(f=Object.assign({},r.config,_));const x=new pa(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,l){if(this._isInternalStyle(r)){const x=Object.assign({},wg,{imports:[{id:"basemap",data:r,url:""}]},r.center?{center:r.center}:{},r.bearing?{bearing:r.bearing}:{},r.pitch?{pitch:r.pitch}:{},r.zoom?{zoom:r.zoom}:{},r.light?{light:r.light}:{});return this._importedAsBasemap=!0,void this._load(x,l)}if(this.updateConfig(this._config,r.schema),l&&ec(this,co(r)))return;this._loaded=!0,this.stylesheet=o.dn(r);const f=()=>{for(const I in r.sources)this.addSource(I,r.sources[I],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const I in r.iconsets)this.addIconset(I,r.iconsets[I]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const x=vu(this.stylesheet.layers);if(this._order=x.map(I=>I.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const I=this.stylesheet.lights[0];this.light=new Se(I.properties,I.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Se(this.stylesheet.light)),this._layers={};for(const I of x){const R=o.dt(I,this.scope,this._styleColorTheme.lut,this.options);R.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(R.fqid),R.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(R.fqid),this._hasAppearances=this._hasAppearances||R.getAppearances().length!==0,R.setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R;const k=this.getOwnLayerSourceCache(R),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&R.canCastShadows()&&z&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const S=this.isRootStyle();r.imports?this._loadImports(r.imports,l).then(()=>{this._reloadImports(),this.fire(new o.z(S?"style.load":"style.import.load"))}).catch(I=>{this.fire(new o.y(new Error("Failed to load imports",I))),this.fire(new o.z(S?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(S?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const x=this._evaluateColorThemeData(_);this._loadColorTheme(x).then(()=>{f()}).catch(w=>{o.w(`Couldn't load color theme from the stylesheet: ${w}`),f()})}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let r,l,f,_,x,w,S,I,R,k;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(M=>{if(M.stylesheet){if(M.light!=null&&(r=M.light),M.stylesheet.lights)for(const B of M.stylesheet.lights)B.type==="ambient"&&M.ambientLight!=null&&(l=M.ambientLight),B.type==="directional"&&M.directionalLight!=null&&(f=M.directionalLight);_=this._prioritizeTerrain(_,M.terrain,M.stylesheet.terrain),M.stylesheet.fog&&M.fog!=null&&(x=M.fog),M.stylesheet.snow&&M.snow!=null&&(w=M.snow),M.stylesheet.rain&&M.rain!=null&&(S=M.rain),M.stylesheet.camera!=null&&(k=M.stylesheet.camera),M.stylesheet.projection!=null&&(I=M.stylesheet.projection),M.stylesheet.transition!=null&&(R=M.stylesheet.transition),z[M.scope]=M._styleColorTheme}}),this.light=r,this.ambientLight=l,this.directionalLight=f,this.fog=x,this.snow=w,this.rain=S,this._styleColorThemeForScope=z,_===null?delete this.terrain:this.terrain=_,this.camera=k||{"camera-projection":"perspective"},this.projection=I||{name:"mercator"},this.transition=Object.assign({},bg,R),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(r){const l=f=>{for(const _ of f.fragments)l(_.style);r(f)};l(this)}_prioritizeTerrain(r,l,f){const _=r&&r.drapeRenderMode===0;return f===null?l&&l.drapeRenderMode===0?l:_?r:null:l!=null&&(!r||_||l&&l.drapeRenderMode===1)?l:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{r=this._prioritizeTerrain(r,l.terrain,l.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(r=l.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},l={},f={};this.forEachFragmentStyle(_=>{for(const x in _._sourceCaches){const w=o.B(x,_.scope);r[w]=_._sourceCaches[x]}for(const x in _._otherSourceCaches){const w=o.B(x,_.scope);l[w]=_._otherSourceCaches[x]}for(const x in _._symbolSourceCaches){const w=o.B(x,_.scope);f[w]=_._symbolSourceCaches[x]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle(r=>{if(r.stylesheet&&r.stylesheet.indoor)for(const l of Object.values(r.stylesheet.indoor)){const f=l,_=o.B(f.sourceId,r.scope);this._mergedIndoor[_]=new Set(f.sourceLayers||[])}})}mergeLayers(){const r={},l=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const S of w._order){const I=w._layers[S];if(I.type==="slot"){const R=o.dp(S);if(r[R])continue;r[R]=[]}I.slot&&r[I.slot]?r[I.slot].push(I):l.push(I)}}),this._mergedOrder=[];let _=-1;const x=(w=[])=>{for(const S of w)if(S.type==="slot"){const I=o.dp(S.id);r[I]&&x(r[I]),this._mergedSlots.push(I)}else{const I=o.B(S.id,S.scope);this._mergedOrder.push(I),f[I]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0,_=this._mergedOrder.length-1),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};if(x(l),this._has3DLayers){const w={};for(let S=0;S<this._mergedOrder.length;++S){const I=this._mergedOrder[S];w[I]=S===_?1:S<_?f[I].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((S,I)=>w[S]-w[I])}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(l,f,_,x){const w=Object.assign({},f);for(const I of Object.keys(yd))w[I]===void 0&&(w[I]=yd[I].default);const S=new o.a8(Ql,l,new Map(_));return S.setTransitionOrValue(w,_),S.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,_)=>{const x="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let w=r;w.startsWith(x)||(w=x+w);const S=o.I.from("mapbox-reserved-lut"),I=new Image;I.src=w,I.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},I.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void f();this._styleColorTheme.lutLoading=!1;const{width:R,height:k,data:z}=o.o.getImageData(I);if(k>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(R!==k*k)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new o.q({width:R,height:k},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const M=this.imageManager.getImage(S,this.scope);M?(this._styleColorTheme.lut={image:M.data,data:r},f()):_(new Error("Missing LUT image."))}})}getLut(r){const l=this._styleColorThemeForScope[r];return l?l.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(l,f,_){let x,w,S;const I=o.o.devicePixelRatio>1?"@2x":"";let R=o.m(f.transformRequest(f.normalizeSpriteURL(l,I,".json"),o.R.SpriteJSON),(M,B)=>{R=null,S||(S=M,x=B,z())}),k=o.n(f.transformRequest(f.normalizeSpriteURL(l,I,".png"),o.R.SpriteImage),(M,B)=>{k=null,S||(S=M,w=B,z())});function z(){if(S)_(S);else if(x&&w){const M=o.o.getImageData(w),B={};for(const j in x){const{width:U,height:Z,x:q,y:K,sdf:ne,pixelRatio:ee,stretchX:ge,stretchY:oe,content:ve}=x[j],pe=new o.q({width:U,height:Z});o.q.copy(M,pe,{x:q,y:K},{x:0,y:0},{width:U,height:Z},null),B[j]={data:pe,pixelRatio:ee!==void 0?ee:1,sdf:ne!==void 0&&ne,stretchX:ge,stretchY:oe,content:ve,usvg:!1,version:0}}_(null,B)}}return{cancel(){R&&(R.cancel(),R=null),k&&(k.cancel(),k=null)}}}(r,this.map._requestManager,(l,f)=>{if(this._spriteRequest=null,l)this.fire(new o.y(l));else if(f){const _=new Map;for(const x in f)_.set(o.I.from(x),f[x]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(r,l){if(l.type==="sprite")return void this._loadSprite(l.url);const f=this.getOwnSourceCache(l.source);if(!f)return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const _=f.getSource();if(_.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const x=new tb(r,this.scope,f);this.imageManager.addImageProvider(x,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.h(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const l=this.map._spriteFormat==="auto";var f,_;this._spriteRequest=(_=(x,w)=>{if(this._spriteRequest=null,x)l?this._loadSprite(r):this.fire(new o.y(x));else if(w){const S=new Map;for(const I in w)S.set(o.I.from(I),w[I]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bt((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(r),o.R.Iconset),(x,w)=>{if(x)return void _(x);const S={},I=o.df(new o.bs(w));for(const R of I.icons){const k={version:1,pixelRatio:o.o.devicePixelRatio,content:eb(R),stretchX:R.metadata?F0(R.metadata.stretch_x_areas):void 0,stretchY:R.metadata?F0(R.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:R};S[R.name]=k}_(null,S)}))}_validateLayer(r){const l=this.getOwnSource(r.source);if(!l)return;const f=r.sourceLayer;f&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.y(new Error(`Source layer "${f}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,l)=>{const f=this.fragments[l];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){const r={};for(const l in this._sourceCaches){const f=this._sourceCaches[l].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){const l=[];for(const f of r){const _=this._layers[f];_&&_.type!=="custom"&&l.push(_.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const l=this.getOwnLayer(r);if(l)return l;this.fire(new o.y(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const l=this.getOwnSource(r);if(l)return l;this.fire(new o.y(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,l){const f=this.map.painter;if(f)for(let _=r.minzoom||0;_<(r.maxzoom||25.5);_++){const x=r.getProgramIds();if(x)for(const w of x){const S=r.getDefaultProgramParams(w,l.zoom,this._styleColorTheme.lut);S&&(f.style=this,this.fog&&(f._fogVisible=!0,S.overrideFog=!0,f.getOrCreateProgram(w,S)),f._fogVisible=!1,S.overrideFog=!1,f.getOrCreateProgram(w,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,f.getOrCreateProgram(w,S)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const l=this.calculateLightsBrightness();r.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const I in S){const{updatedIds:R,removedIds:k}=S[I];(R||k)&&(this._updateWorkerLayers(I,R,k),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const x={};for(const S in this._mergedSourceCaches){const I=this._mergedSourceCaches[S];x[S]=I.used,I.used=!1,I.tileCoverLift=0}for(const S of this._mergedOrder){const I=this._mergedLayers[S];if(I.recalculate(r,this._availableImages),!I.isHidden(r.zoom)){const R=this.getLayerSourceCache(I);R&&(R.used=!0,R.tileCoverLift=Math.max(R.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,r)}):this.precompilePrograms(I,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const w=this.imageManager.getPendingImageProviders();for(const S of w)S.sourceCache.used=!0;for(const S in x){const I=this._mergedSourceCaches[S];x[S]!==I.used&&I.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const l of r){const f=l.resolvePendingRequests(),_=this.getFragmentStyle(l.scope);_&&_.addImages(f)}}_updateTilesForChangedImages(){const r={};for(const l in this._mergedSourceCaches){const f=this._mergedSourceCaches[l].getSource().scope;r[f]=r[f]||this._changes.getUpdatedImages(f),r[f].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r[f])}for(const l in r)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(r,l,f){const _=this.getFragmentStyle(r);_&&this.dispatcher.broadcast("updateLayers",{layers:l?_._serializeLayers(l):[],scope:r,removedIds:f||[],options:_.options})}setState(r,l){if(this._checkLoaded(),ec(this,co(r)))return!1;(r=o.dn(r)).layers=vu(r.layers);const f=function(w,S){if(!w)return[{command:fi.setStyle,args:[S]}];let I=[];try{if(!o.bx(w.version,S.version))return[{command:fi.setStyle,args:[S]}];if(o.bx(w.center,S.center)||I.push({command:fi.setCenter,args:[S.center]}),o.bx(w.zoom,S.zoom)||I.push({command:fi.setZoom,args:[S.zoom]}),o.bx(w.bearing,S.bearing)||I.push({command:fi.setBearing,args:[S.bearing]}),o.bx(w.pitch,S.pitch)||I.push({command:fi.setPitch,args:[S.pitch]}),o.bx(w.sprite,S.sprite)||I.push({command:fi.setSprite,args:[S.sprite]}),o.bx(w.glyphs,S.glyphs)||I.push({command:fi.setGlyphs,args:[S.glyphs]}),o.bx(w.imports,S.imports)||function(B=[],j=[],U){j=j||[];const Z=(B=B||[]).map(sd),q=j.map(sd),K=B.reduce(od,{}),ne=j.reduce(od,{}),ee=Z.slice();let ge,oe,ve,pe;for(ge=0,oe=0;ge<Z.length;ge++)ve=Z[ge],ne.hasOwnProperty(ve)?oe++:(U.push({command:fi.removeImport,args:[ve]}),ee.splice(ee.indexOf(ve,oe),1));for(ge=0,oe=0;ge<q.length;ge++)ve=q[q.length-1-ge],ee[ee.length-1-ge]!==ve&&(K.hasOwnProperty(ve)?(U.push({command:fi.removeImport,args:[ve]}),ee.splice(ee.lastIndexOf(ve,ee.length-oe),1)):oe++,pe=ee[ee.length-ge],U.push({command:fi.addImport,args:[ne[ve],pe]}),ee.splice(ee.length-ge,0,ve));for(const ce of j){const xe=K[ce.id];xe&&(delete xe.data,o.bx(xe,ce)||U.push({command:fi.updateImport,args:[ce.id,ce]}))}}(w.imports,S.imports,I),o.bx(w.transition,S.transition)||I.push({command:fi.setTransition,args:[S.transition]}),o.bx(w.light,S.light)||I.push({command:fi.setLight,args:[S.light]}),o.bx(w.fog,S.fog)||I.push({command:fi.setFog,args:[S.fog]}),o.bx(w.snow,S.snow)||I.push({command:fi.setSnow,args:[S.snow]}),o.bx(w.rain,S.rain)||I.push({command:fi.setRain,args:[S.rain]}),o.bx(w.projection,S.projection)||I.push({command:fi.setProjection,args:[S.projection]}),o.bx(w.lights,S.lights)||I.push({command:fi.setLights,args:[S.lights]}),o.bx(w.camera,S.camera)||I.push({command:fi.setCamera,args:[S.camera]}),o.bx(w.iconsets,S.iconsets)||function(B,j,U){let Z;for(Z in j=j||{},B=B||{})B.hasOwnProperty(Z)&&(j.hasOwnProperty(Z)||U.push({command:fi.removeIconset,args:[Z]}));for(Z in j){if(!j.hasOwnProperty(Z))continue;const q=j[Z];B.hasOwnProperty(Z)?o.bx(B[Z],q)||(U.push({command:fi.removeIconset,args:[Z]}),U.push({command:fi.addIconset,args:[Z,q]})):U.push({command:fi.addIconset,args:[Z,q]})}}(w.iconsets,S.iconsets,I),!o.bx(w["color-theme"],S["color-theme"]))return[{command:fi.setStyle,args:[S]}];const R={},k=[];(function(B,j,U,Z){let q;for(q in j=j||{},B=B||{})B.hasOwnProperty(q)&&(j.hasOwnProperty(q)||rd(q,U,Z));for(q in j){if(!j.hasOwnProperty(q))continue;const K=j[q];B.hasOwnProperty(q)?o.bx(B[q],K)||(B[q].type==="geojson"&&K.type==="geojson"&&fg(B,j,q)?U.push({command:fi.setGeoJSONSourceData,args:[q,K.data]}):id(q,j,U,Z)):dg(q,j,U)}})(w.sources,S.sources,k,R);const z=[];w.layers&&w.layers.forEach(B=>{B.source&&R[B.source]?I.push({command:fi.removeLayer,args:[B.id]}):z.push(B)});let M=w.terrain;M&&R[M.source]&&(I.push({command:fi.setTerrain,args:[void 0]}),M=void 0),I=I.concat(k),o.bx(M,S.terrain)||I.push({command:fi.setTerrain,args:[S.terrain]}),function(B,j,U){j=j||[];const Z=(B=B||[]).map(sd),q=j.map(sd),K=B.reduce(od,{}),ne=j.reduce(od,{}),ee=Z.slice(),ge=Object.create(null);let oe,ve,pe,ce,xe,Me,Ce;for(oe=0,ve=0;oe<Z.length;oe++)pe=Z[oe],ne.hasOwnProperty(pe)?ve++:(U.push({command:fi.removeLayer,args:[pe]}),ee.splice(ee.indexOf(pe,ve),1));for(oe=0,ve=0;oe<q.length;oe++)pe=q[q.length-1-oe],ee[ee.length-1-oe]!==pe&&(K.hasOwnProperty(pe)?(U.push({command:fi.removeLayer,args:[pe]}),ee.splice(ee.lastIndexOf(pe,ee.length-ve),1)):ve++,Me=ee[ee.length-oe],U.push({command:fi.addLayer,args:[ne[pe],Me]}),ee.splice(ee.length-oe,0,pe),ge[pe]=!0);for(oe=0;oe<q.length;oe++)if(pe=q[oe],ce=K[pe],xe=ne[pe],!ge[pe]&&!o.bx(ce,xe))if(o.bx(ce.source,xe.source)&&o.bx(ce["source-layer"],xe["source-layer"])&&o.bx(ce.type,xe.type)){for(Ce in nd(ce.layout,xe.layout,U,pe,null,fi.setLayoutProperty),nd(ce.paint,xe.paint,U,pe,null,fi.setPaintProperty),o.bx(ce.slot,xe.slot)||U.push({command:fi.setSlot,args:[pe,xe.slot]}),o.bx(ce.filter,xe.filter)||U.push({command:fi.setFilter,args:[pe,xe.filter]}),o.bx(ce.minzoom,xe.minzoom)&&o.bx(ce.maxzoom,xe.maxzoom)||U.push({command:fi.setLayerZoomRange,args:[pe,xe.minzoom,xe.maxzoom]}),ce)ce.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?nd(ce[Ce],xe[Ce],U,pe,Ce.slice(6),fi.setPaintProperty):o.bx(ce[Ce],xe[Ce])||U.push({command:fi.setLayerProperty,args:[pe,Ce,xe[Ce]]}));for(Ce in xe)xe.hasOwnProperty(Ce)&&!ce.hasOwnProperty(Ce)&&Ce!=="layout"&&Ce!=="paint"&&Ce!=="filter"&&Ce!=="metadata"&&Ce!=="minzoom"&&Ce!=="maxzoom"&&Ce!=="slot"&&(Ce.indexOf("paint.")===0?nd(ce[Ce],xe[Ce],U,pe,Ce.slice(6),fi.setPaintProperty):o.bx(ce[Ce],xe[Ce])||U.push({command:fi.setLayerProperty,args:[pe,Ce,xe[Ce]]}))}else U.push({command:fi.removeLayer,args:[pe]}),Me=ee[ee.lastIndexOf(pe)+1],U.push({command:fi.addLayer,args:[xe,Me]})}(z,S.layers,I)}catch(R){console.warn("Unable to compute style diff:",R),I=[{command:fi.setStyle,args:[S]}]}return I}(this.serialize(),r).filter(w=>!(w.command in xg));if(f.length===0)return!1;const _=f.filter(w=>!(w.command in rb));if(_.length>0)throw new Error(`Unimplemented: ${_.map(w=>w.command).join(", ")}.`);const x=[];return f.forEach(w=>{x.push(this[w.command](...w.args))}),l&&Promise.all(x).then(l).catch(l),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(const[l,f]of r.entries()){if(this.getImage(l))return this.fire(new o.y(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,f),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(r,l){return this.getImage(r)?this.fire(new o.y(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,l),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(r,l,f=!1){this.imageManager.updateImage(r,this.scope,l),f&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(r,l,f={}){return this._checkLoaded(),this._validate(Yh,`models.${r}`,l,null,f)||(this.modelManager.addModel(r,l,this.scope),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope,!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,l,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(di,`sources.${r}`,l,null,f))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=to(r,l,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const x=w=>{const S=(w?"symbol:":"other:")+_.id,I=o.B(S,this.scope),R=this._sourceCaches[S]=new ua(I,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=R,R.onAdd(this.map)};x(!1),l.type!=="vector"&&l.type!=="geojson"||x(!0),_.onAdd&&_.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const l=this.getOwnSource(r);if(!l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([x,w])=>w.type==="source"&&w.source===r);if(_)return this.fire(new o.y(new Error(`Source "${r}" cannot be removed while iconset "${_[0]}" is using it.`)))}const f=this.getOwnSourceCaches(r);for(const _ of f){const x=o.dp(_.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(_.id),_.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getOwnSource(r).setData(l),this._changes.setDirty()}getOwnSource(r){const l=this.getOwnSourceCache(r);return l&&l.getSource()}getOwnSources(){const r=[];for(const l in this._otherSourceCaches){const f=this.getOwnSourceCache(l);f&&r.push(f.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const l in r){const f=r[l]._tiles;for(const _ in f){const x=f[_];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const x of r){if(this._validate(An,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(x),w.updateTransitions(l)}else this.ambientLight=new Sn(x,Ai||(Ai=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(x),w.updateTransitions(l)}else this.directionalLight=new Sn(x,mn||(mn=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(l,{worldview:this.map.getWorldview()}),_=new o.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,l=this.ambientLight;if(!r||!l)return;const f=M=>.2126*(M[0]<=.03928?M[0]/12.92:Math.pow((M[0]+.055)/1.055,2.4))+.7152*(M[1]<=.03928?M[1]/12.92:Math.pow((M[1]+.055)/1.055,2.4))+.0722*(M[2]<=.03928?M[2]/12.92:Math.pow((M[2]+.055)/1.055,2.4)),_=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=r.properties.get("intensity"),w=r.properties.get("direction"),S=1-o.d3(w.x,w.y,w.z)[2]/90,I=f(_)*x*S,R=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=l.properties.get("intensity"),z=f(R)*k;return Number(((I+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.dq(r)){const l=o.dr(r),f=this.fragments.find(({id:x})=>x===l);if(!f)return;const _=o.dp(r);return f.style.getFragmentStyle(_)}{const l=this.fragments.find(({id:f})=>f===r);return l?l.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const l={},f=(_,x="")=>`${_}::${x}`;this._featuresetSelectors={};for(const _ in r){const x=this._featuresetSelectors[_]=[];for(const w of r[_].selectors){if(w.featureNamespace){const I=this.getOwnLayer(w.layer);if(!I){o.w(`Layer is undefined for selector: ${w.layer}`);continue}const R=f(I.source,I.sourceLayer);if(R in l&&l[R]!==w.featureNamespace){o.w(`"featureNamespace ${w.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}l[R]=w.featureNamespace}let S;if(w.properties)for(const I in w.properties){const R=o.U(w.properties[I]);R.result==="success"&&(S=S||{},S[I]=R.value)}x.push({layerId:w.layer,namespace:w.featureNamespace,properties:S,uniqueFeatureID:w._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const l=this.getFragmentStyle(r);if(!l||!l.stylesheet.featuresets)return[];const f=[];for(const _ in l.stylesheet.featuresets)f.push({featuresetId:_,importId:l.scope?l.scope:void 0});return f}getFeaturesetLayers(r,l){const f=this.getFragmentStyle(l),_=f.stylesheet.featuresets;if(!_||!_[r])return this.fire(new o.y(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const w of _[r].selectors){const S=f.getOwnLayer(w.layer);S&&x.push(S)}return x}getConfigProperty(r,l){const f=this.getFragmentStyle(r);if(!f)return null;const _=o.B(l,f.scope),x=f.options.get(_),w=x?x.value||x.default:null;return w?w.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(r,l){const f=o.B(r,l);return this._mergedIndoor[f]}setIndoorData(r,l){this.map.indoor.setIndoorData(l)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(r,l,f){const _=this.getFragmentStyle(r);if(!_)return;const x=_.stylesheet.schema;if(!x||!x[l])return;const w=o.U(f);if(w.result!=="success")return void ec(this,w.value);const S=w.value.expression,I=o.B(l,_.scope),R=_.options.get(I);if(!R)return;let k;const{minValue:z,maxValue:M,stepValue:B,type:j,values:U}=x[l],Z=o.U(x[l].default);Z.result==="success"&&(k=Z.value.expression),k?(this.options.set(I,Object.assign({},R,{value:S,default:k,minValue:z,maxValue:M,stepValue:B,type:j,values:U})),this.updateConfigDependencies(l)):this.fire(new o.y(new Error(`No schema defined for the config option "${l}" in the "${r}" fragment.`)))}getConfig(r){const l=this.getFragmentStyle(r);if(!l)return null;const f=l.stylesheet.schema;if(!f)return null;const _={};for(const x in f){const w=o.B(x,l.scope),S=l.options.get(w),I=S?S.value||S.default:null;_[x]=I?I.serialize():null}return _}setConfig(r,l){const f=this.getFragmentStyle(r);f&&(f.updateConfig(l,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const l=this.getFragmentStyle(r);return l?l.stylesheet.schema:null}setSchema(r,l){const f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=l,f.updateConfig(f._config,l),this.updateConfigDependencies())}updateConfig(r,l){if(this._config=r,r||l)if(l)for(const f in l){let _,x;const w=o.U(l[f].default);if(w.result==="success"&&(_=w.value.expression),r&&r[f]!==void 0){const M=o.U(r[f]);M.result==="success"&&(x=M.value.expression)}const{minValue:S,maxValue:I,stepValue:R,type:k,values:z}=l[f];if(_){const M=o.B(f,this.scope);this.options.set(M,{default:_,value:x,minValue:S,maxValue:I,stepValue:R,type:k,values:z})}else this.fire(new o.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(r,l=()=>!0){for(const f of r){const _=this.getLayer(f);_&&l(_)&&(_.possiblyEvaluateVisibility(),this._updateLayer(_),this._changes.setDirty())}}updateConfigDependencies(r){this._updateLayers(this._configDependentLayers,l=>!r||l.expressionDependencies.configDependencies.has(r)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const f=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(f){const _=l._evaluateColorThemeData(f);(!l._styleColorTheme.lut&&_!==""||l._styleColorTheme.lut&&_!==l._styleColorTheme.lut.data)&&l.setColorTheme(f)}}),this._changes.setDirty()}addLayer(r,l,f={}){this._checkLoaded();const _=r.id;if(this._layers[_])return void this.fire(new o.y(new Error(`Layer with id "${_}" already exists on this map`)));let x;if(r.type==="custom"){if(ec(this,o.ds(r)))return;x=o.dt(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(_,r.source),r=o.dn(r),r=Object.assign(r,{source:_})),this._validate(Us,`layers.${_}`,r,{arrayIndex:-1},f))return;x=o.dt(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}})}const w=o.B(x.source,x.scope);x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(w),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(w);let S=this._order.length;if(l){const z=this._order.indexOf(l);if(z===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));x.slot===this._layers[l].slot?S=z:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const I=this.getOwnLayerSourceCache(x),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&x.canCastShadows()&&R&&(I.castsShadows=!0);const k=this._changes.getRemovedLayer(x);if(k&&x.source&&I&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const z=o.B(x.source,x.scope);k.type!==x.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),I.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(r,l){this._checkLoaded();const f=this._checkLayer(r);if(!f||r===l)return;const _=this._order.indexOf(r);this._order.splice(_,1);let x=this._order.length;if(l){const w=this._order.indexOf(l);if(w===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));f.slot===this._layers[l].slot?x=w:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const l=this._checkLayer(r);if(!l)return;l.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._indoorDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const _=this.getOwnLayerSourceCache(l);if(_&&_.castsShadows){let x=!1;for(const w in this._layers)if(this._layers[w].source===l.source&&this._layers[w].canCastShadows()){x=!0;break}_.castsShadows=x}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,f){this._checkLoaded();const _=this._checkLayer(r);_&&(_.minzoom===l&&_.maxzoom===f||(l!=null&&(_.minzoom=l),f!=null&&(_.maxzoom=f),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,l){this._checkLoaded();const f=this._checkLayer(r);f&&f.slot!==l&&(f.slot=l,this._updateLayer(f))}setFilter(r,l,f={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!o.bx(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Nr,`layers.${_.id}.filter`,l,{layerType:_.type},f)||(_.filter=o.dn(l),this._updateLayer(_)))}getFilter(r){const l=this._checkLayer(r);if(l)return o.dn(l.filter)}setLayoutProperty(r,l,f,_={}){this._checkLoaded();const x=this._checkLayer(r);if(x&&!o.bx(x.getLayoutProperty(l),f)){if(f!=null&&(!_||_.validate!==!1)&&ec(x,lg.call(co,{key:`layers.${r}.layout.${l}`,layerType:x.type,objectKey:l,value:f,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(l,f),x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x.fqid),this._updateLayer(x)}}setLayerProperty(r,l,f,_={}){this._checkLoaded();const x=this._checkLayer(r);x&&(l==="appearances"?(x.setAppearances(f),this._changes.setDirty()):x.isPaintProperty(l)?this.setPaintProperty(r,l,f,_):this.setLayoutProperty(r,l,f,_))}getLayoutProperty(r,l){const f=this._checkLayer(r);if(f)return f.getLayoutProperty(l)}setPaintProperty(r,l,f,_={}){this._checkLoaded();const x=this._checkLayer(r);if(!x||o.bx(x.getPaintProperty(l),f)||f!=null&&(!_||_.validate!==!1)&&ec(x,$s.call(co,{key:`layers.${r}.paint.${l}`,layerType:x.type,objectKey:l,value:f,styleSpec:o.a6})))return;const w=x.setPaintProperty(l,f);x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x.fqid),w&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(r,l){const f=this._checkLayer(r);if(f)return f.getPaintProperty(l)}setFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:I,importId:R}=r.target,k=this.getFragmentStyle(R),z=k.getFeaturesetLayers(I);for(const{source:M,sourceLayer:B}of z)k.setFeatureState({id:r.id,source:M,sourceLayer:B},l)}else if("layerId"in r.target){const{layerId:I}=r.target,R=this.getLayer(I);this.setFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},l)}return}const f=r.source,_=r.sourceLayer,x=this._checkSource(f);if(!x)return;const w=x.type;if(w==="geojson"&&_)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(w==="vector"&&!_)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(f);for(const I of S)I.setFeatureState(_,r.id,l)}removeFeatureState(r,l){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:I,importId:R}=r.target,k=this.getFragmentStyle(R),z=k.getFeaturesetLayers(I);for(const{source:M,sourceLayer:B}of z)k.removeFeatureState({id:r.id,source:M,sourceLayer:B},l)}else if("layerId"in r.target){const{layerId:I}=r.target,R=this.getLayer(I);this.removeFeatureState({id:r.id,source:R.source,sourceLayer:R.sourceLayer},l)}return}const f=r.source,_=this._checkSource(f);if(!_)return;const x=_.type,w=x==="vector"?r.sourceLayer:void 0;if(x==="vector"&&!w)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(f);for(const I of S)I.removeFeatureState(w,r.id,l)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let x;if("featuresetId"in r.target){const{featuresetId:w,importId:S}=r.target,I=this.getFragmentStyle(S),R=I.getFeaturesetLayers(w);for(const{source:k,sourceLayer:z}of R){const M=I.getFeatureState({id:r.id,source:k,sourceLayer:z});if(M&&!x)x=M;else if(!o.bx(x,M))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:w}=r.target,S=this.getLayer(w);x=this.getFeatureState({id:r.id,source:S.source,sourceLayer:S.sourceLayer})}return x}const l=r.source,f=r.sourceLayer,_=this._checkSource(l);if(_){if(_.type!=="vector"||f)return r.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(f,r.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),l=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(r){for(const l of Object.values(this._mergedLayers))r(l)&&this._updateLayer(l)}_updateLayer(r){this._changes.updateLayer(r);const l=this.getLayerSourceCache(r),f=o.B(r.source,r.scope),_=this._changes.getUpdatedSourceCaches();r.source&&!_[f]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),l.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=S=>this._mergedLayers[S].is3D(!!this.terrain),f=this.order,_={},x=[];for(let S=f.length-1;S>=0;S--){const I=f[S];if(l(I)){_[I]=S;for(const R of r){const k=R[I];if(k)for(const z of k)x.push(z)}}}x.sort((S,I)=>I.intersectionZ-S.intersectionZ);const w=[];for(let S=f.length-1;S>=0;S--){const I=f[S];if(l(I))for(let R=x.length-1;R>=0;R--){const k=x[R].feature;if(k.layer&&_[k.layer.id]<S)break;w.push(k),x.pop()}else for(const R of r){const k=R[I];if(k)for(const z of k)w.push(z.feature)}}return w}queryRasterValue(r,l,f){const _=this.getOwnSource(r);return _?_.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):_.queryRasterArrayValue(l,f):(this.fire(new o.y(new Error(`Source with id "${r}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(r,l,f){let _;l&&!Array.isArray(l)&&l.filter&&(this._validate(Nr,"queryRenderedFeatures.filter",l.filter,null,l),_=o.b5(l.filter));const x={},w=k=>{if(zf.has(k.type))return;const z=this.getOwnLayerSourceCache(k),M=x[z.id]=x[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(M.has3DLayers=!0),M.layers[k.fqid]=M.layers[k.fqid]||{styleLayer:k,targets:[]},M.layers[k.fqid].targets.push({filter:_})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const k of l.layers){const z=this._layers[k];if(!z)return this.fire(new o.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];w(z)}}else for(const k in this._layers)w(this._layers[k]);const S=this._queryRenderedFeatures(r,x,f),I=this._flattenAndSortRenderedFeatures(S),R=[];for(const k of I)o.dv(k.layer.id)===this.scope&&R.push(k);return R}queryRenderedFeatureset(r,l,f){let _;l&&!Array.isArray(l)&&l.filter&&(this._validate(Nr,"queryRenderedFeatures.filter",l.filter,null,l),_=o.b5(l.filter));const x="mock",w=[];if(l&&l.target)w.push(Object.assign({},l,{targetId:x,filter:_}));else{const k=this.getFeaturesetDescriptors();for(const z of k)w.push({targetId:x,filter:_,target:z});for(const{style:z}of this.fragments){const M=z.getFeaturesetDescriptors();for(const B of M)w.push({targetId:x,filter:_,target:B})}}const S=this.queryRenderedTargets(r,w,f),I=[],R=new Set;for(const k of S)for(const z of k.variants[x])xo(z,k,R)||I.push(new o.dw(k,z));return I}queryRenderedTargets(r,l,f){const _={},x=(S,I,R,k)=>{const z=_[I.id]=_[I.id]||{sourceCache:I,layers:{},has3DLayers:!1};if(z.layers[S.fqid]=z.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(z.has3DLayers=!0),!k)return R.uniqueFeatureID=!1,void z.layers[S.fqid].targets.push(R);z.layers[S.fqid].targets.push(Object.assign({},R,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const S of l)if("featuresetId"in S.target){const{featuresetId:I,importId:R}=S.target,k=this.getFragmentStyle(R);if(!k||!k._featuresetSelectors)continue;const z=k._featuresetSelectors[I];if(!z){this.fire(new o.y(new Error(`The featureset '${I}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const M of z){const B=k.getOwnLayer(M.layerId);B&&!zf.has(B.type)&&x(B,k.getOwnLayerSourceCache(B),S,M)}}else if("layerId"in S.target){const{layerId:I}=S.target,R=this.getLayer(I);if(!R||zf.has(R.type))continue;x(R,this.getLayerSourceCache(R),S)}const w=this._queryRenderedFeatures(r,_,f);return this._flattenAndSortRenderedFeatures(w)}_queryRenderedFeatures(r,l,f){const _=[],x=!!this.map._showQueryGeometry,w=Ei.createFromScreenPoints(r,f);for(const S in l){const I=wo(w,l[S],this._availableImages,f,x);Object.keys(I).length&&_.push(I)}if(this.placement)for(const S in l){if(!l[S].sourceCache._onlySymbols)continue;const I=If(w.screenGeometry,l[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(I).length&&_.push(I)}return _}querySourceFeatures(r,l){const f=l&&l.filter;f&&this._validate(Nr,"querySourceFeatures.filter",f,null,l);let _=[];const x=this.getOwnSourceCaches(r);for(const w of x)_=_.concat(Jh(w,l));return _}addSourceType(r,l,f){return pa.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(pa.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,l,f={}){this._checkLoaded();const _=this.light.getLight();let x=!1;for(const S in r)if(!o.bx(r[S],_[S])){x=!0;break}if(!x)return;const w=this._getTransitionParameters();this.light.setLight(r,l,f),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,l=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r;const _=r.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const S="terrain-dem-src";this.addSource(S,f.source),f=o.dn(f),f=Object.assign(f,{source:S})}const x=Object.assign({},f),w={};if(this.terrain&&_){x.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(w.style=S.serialize())}if(this._validate(Rs,"terrain",x,w))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&l!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,l),this.fire(new o.z("data",{dataType:"style"}))}else{const x=this.terrain,w=x.get();for(const S of Object.keys(o.a6.terrain))!f.hasOwnProperty(S)&&o.a6.terrain[S].default&&(f[S]=o.a6.terrain[S].default);for(const S in r)if(!o.bx(r[S],w[S])){x.set(r,this.options),this.stylesheet.terrain=r;const I=this._getTransitionParameters({duration:0});x.updateTransitions(I),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new or(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}_createSnow(r){const l=this.snow=new Bn(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}_createRain(r){const l=this.rain=new Cn(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.bx(l.get(),r)){l.set(r,this.options),this.stylesheet.fog=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!o.bx(l.get(),r)){l.set(r,this.options),this.stylesheet.snow=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!o.bx(l.get(),r)){l.set(r,this.options),this.stylesheet.rain=l.get();const f=this._getTransitionParameters({duration:0});l.updateTransitions(f)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void r();const f=this._evaluateColorThemeData(l);this._loadColorTheme(f).then(()=>{this.fire(new o.z("colorthemeset")),r()}).catch(_=>{o.w(`Couldn't set color theme: ${_}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,l){const f=this.getFragmentStyle(r);f&&(f._styleColorTheme.colorThemeOverride=l,f._reloadColorTheme())}_getTransitionParameters(r){return{now:o.o.now(),transition:Object.assign(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],l=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?r.push(f):l.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const f=this.terrain=new Pe(r,l,this.scope,this.options,this.map.getWorldview());l===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});f.updateTransitions(_)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];l.type==="symbol"&&this._updateLayer(l)}}_validate(r,l,f,_,x={}){if(x&&x.validate===!1)return!1;const w=Object.assign({},this.serialize());return ec(this,r.call(co,Object.assign({key:l,style:w,value:f,styleSpec:o.a6},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const l=this.getSourceCaches(r);for(const f of l)f.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const l=this._mergedLayers[r];l._clear&&l._clear()}}reloadSource(r){const l=this.getSourceCaches(r);for(const f of l)f.resume(),f.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let l;this.directionalLight&&(l=L0(this.directionalLight));const f=new Set;for(const _ in this._mergedLayers){const x=this._mergedLayers[_];x.hasElevation()&&!f.has(x.source)&&f.add(x.source)}for(const _ in this._mergedSourceCaches){const x=this._mergedSourceCaches[_],w=f.has(x._source.id);x.update(r,void 0,void 0,l,w)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,f,_,x,w,S=!1){let I=!1,R=!1;const k={},z={};for(const M of this._mergedOrder){const B=this._mergedLayers[M];if(B.type!=="symbol")continue;const j=o.B(B.source,B.scope);let U=k[j];if(!U){const q=this.getLayerSourceCache(B);if(!q)continue;const K=q.getRenderableIds(!0).map(ne=>q.getTileByID(ne));z[j]=K.slice(),U=k[j]=K.sort((ne,ee)=>ee.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ee.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(B,U,l.center.lng,l.projection);I=I||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new o.z("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),l.zoom))&&(this.pauseablePlacement=new ho(l,this._mergedOrder,S,f,_,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,z,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),R=!0),I&&this.pauseablePlacement.placement.setStale()),R||I){this._buildingIndex.onNewFrame(l.zoom);for(let M=0;M<this._mergedOrder.length;M++){const B=this._mergedLayers[this._mergedOrder[M]];if(B.type!=="symbol")continue;const j=this.isLayerClipped(B);this.placement.updateLayerOpacities(B,k[o.B(B.source,B.scope)],M,j?w:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,l){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:x})=>x===r.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!l)return f.push(r),this._loadImports([r],!0);const _=f.findIndex(({id:x})=>x===l);return _===-1&&this.fire(new o.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,_).concat(r).concat(f.slice(_)),this._loadImports([r],!0,l)}updateImport(r,l){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);return _===-1?this:typeof l=="string"?(this.setImportUrl(r,l),this):(l.url&&l.url!==f[_].url&&this.setImportUrl(r,l.url),o.bx(l.config,f[_].config)||this.setImportConfig(r,l.config,l.data.schema),o.bx(l.data,f[_].data)||this.setImportData(r,l.data),this)}moveImport(r,l){this._checkLoaded();let f=this.stylesheet.imports||[];const _=this.getImportIndex(r);if(_===-1)return this;const x=this.getImportIndex(l);if(x===-1)return this;const w=f[_],S=this.fragments[_];return f=f.filter(({id:I})=>I!==r),this.fragments=this.fragments.filter(({id:I})=>I!==r),this.stylesheet.imports=f.slice(0,x).concat(w).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(S).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(r,l){this._checkLoaded();const f=this.stylesheet.imports||[],_=this.getImportIndex(r);if(_===-1)return this;f[_].url=l;const x=this.fragments[_];return x.style=this._createFragmentStyle(f[_]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(l),this}setImportData(r,l){this._checkLoaded();const f=this.getImportIndex(r),_=this.stylesheet.imports||[];return f===-1?this:l?(this.fragments[f].style.setState(l),this._reloadImports(),this):(delete _[f].data,this.setImportUrl(r,_[f].url))}setImportConfig(r,l,f){this._checkLoaded();const _=this.getImportIndex(r),x=this.stylesheet.imports||[];if(_===-1)return this;l?x[_].config=l:delete x[_].config;const w=this.fragments[_];f&&w.style.stylesheet&&(w.style.stylesheet.schema=f);const S=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=l,w.style.updateConfig(l,S),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const l=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(l.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){const l=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return l===-1&&this.fire(new o.y(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),l}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const l in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[l];f&&r.push(f.getSource())}return r}getSource(r,l){const f=this.getSourceCache(r,l);return f&&f.getSource()}getLayerSource(r){const l=this.getLayerSourceCache(r);return l&&l.getSource()}getSourceCache(r,l){const f=o.B(r,l);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){const l=o.B(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[r]&&l.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&l.push(this._mergedSymbolSourceCaches[r]),l}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const l in r){const f=r[l];f==="reload"?this.reloadSource(l):f==="clear"&&this.clearSource(l)}}updateLayers(r){const l=this._changes.getUpdatedPaintProperties();for(const f of l){const _=this.getLayer(f);_&&_.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,l,f){this.imageManager.getImages(l.images,l.scope,f),this._updateTilesForChangedImages();const _=w=>{if(w){const S=l.images.map(I=>o.I.toString(I));w.setDependencies(l.tileID.key,l.type,S)}},x=o.B(l.source,l.scope);_(this._mergedOtherSourceCaches[x]),_(this._mergedSymbolSourceCaches[x]),l.images.some(w=>w.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(r,l,f){this.imageManager.rasterizeImages(l,f)}getGlyphs(r,l,f){this.glyphManager.getGlyphs(l.stacks,f)}getResource(r,l,f){return o.dy(l,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this.getOwnSourceCaches(r);return l.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${r}'`))),!1):l.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,l){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const f=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),_=r.type==="building";if(r.is3D(!!this.terrain)){if(f||_||l&&l.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}pa.getSourceType=function(d){return ca[d]},pa.setSourceType=function(d,r){ca[d]=r},pa.registerForPluginStateChange=o.dz;class Bc extends o.E{constructor(r){super(),this._style=r,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(r){r===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=r,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(r){this._activeFloorsVisible=r,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(r){for(const[l,f]of Object.entries(r.buildings))if(this._buildings[l])for(const _ of f.floorIds)this._buildings[l].floors[_]||(this._buildings[l].floors[_]=f.floors[_]);else this._buildings[l]=f;for(const l of r.activeFloors)this._activeFloors.add(l);this._updateIndoorSelector()}getIndoorTileOptions(r,l){const f=this._style.getIndoorSourceLayers(r,l);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(r,l,f){const _=function(x,w,S,I){let R=null,k=Number.MAX_SAFE_INTEGER;if(I<16)return null;for(const[z,M]of Object.entries(x)){const B=M.center;if(B){const j=w.distanceTo(o.aS.convert(B));j<k&&S.contains(B)&&(k=j,R=z)}}return R}(this._buildings,l,f,r);_!==this._closestBuildingId&&(this._closestBuildingId=_,this._updateIndoorSelector())}_updateIndoorSelector(){const r=this._buildings,l=this._closestBuildingId,f=l&&r?r[l]:void 0;if(!f)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let _=null;for(const w of f.floorIds)if(this._activeFloors&&this._activeFloors.has(w)){_=w;break}const x=Array.from(f.floorIds).map(w=>({id:w,name:f.floors[w].name,zIndex:f.floors[w].zIndex})).sort((w,S)=>S.zIndex-w.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:_,activeFloorsVisible:this._activeFloorsVisible,floors:x}))}_updateActiveFloors(){const r=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:r,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var vd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Tg=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Sg=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Iu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Au=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Eg=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ff=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Bo=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Bf=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,xt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Ig=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Cu=[];ma(vd,Cu),ma(Sg,Cu),ma(Tg,Cu);const Pu={"_prelude_fog.vertex.glsl":Eg,"_prelude_terrain.vertex.glsl":Au,"_prelude_shadow.vertex.glsl":xt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ff,"_prelude_shadow.fragment.glsl":Ig,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Bo,"_prelude_raster_particle.glsl":Bf},xd={};Zr("",Au),Zr(Ff,Eg),Zr(Ig,xt),Zr(Bo,""),Zr(Bf,"");const wd=Zr(Tg,Sg),el=vd;var Nf={background:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Zr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Zr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Zr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Zr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Zr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Zr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Zr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Zr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Zr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Zr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Zr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Zr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Zr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Zr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Zr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Zr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Iu),skyboxGradient:Zr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Iu),skyboxCapture:Zr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Zr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Zr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Zr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Zr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Zr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Zr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Zr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Zr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function ma(d,r){const l=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of l)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=f.split(" ");for(const x of _)r.includes(x)||r.push(x)}}function Zr(d,r){const l=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_={},x=[],w=[];if(d=d.replace(l,(I,R)=>(w.push(R),"")),(r=r.replace(l,(I,R)=>(x.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Cu];ma(d,S),ma(r,S);for(const I of[...x,...w])Pu[I]||console.error(`Undefined include: ${I}`),xd[I]||(xd[I]=[],ma(Pu[I],xd[I])),S=[...S,...xd[I]];return{fragmentSource:d=d.replace(f,(I,R,k,z,M)=>(_[M]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${M}
in ${k} ${z} ${M};
#else
uniform ${k} ${z} u_${M};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${M}
    ${k} ${z} ${M} = u_${M};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    in ${k} ${z} ${M};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(I,R,k,z,M)=>{const B=`MATERIAL_ATTRIBUTE_OFFSET_${M}`,j=z==="float"?"vec2":z,U=`GET_ATTRIBUTE_${j}(a_${M}, materialInfo, ${B})`,Z=M.match(/color/)?"color":j;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${M}
in ${k} ${z} a_${M};
#endif
`:_[M]?R==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
    #if !defined(${B})
        in ${k} ${j} a_${M};
    #endif
out ${k} ${z} ${M};
#else
uniform ${k} ${z} u_${M};
#endif
`:R==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    ${M} = a_${M};
#else
    ${k} ${z} ${M} = u_${M};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${M}) 
    #ifdef ${B}
        ${M} = unpack_mix_${Z}(${U}, u_${M}_t);
    #else
        ${M} = unpack_mix_${Z}(a_${M}, u_${M}_t);
    #endif
#else
    ${k} ${z} ${M} = u_${M};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    in ${k} ${z} a_${M};
    out ${k} ${z} ${M};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    ${M} = a_${M};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${M}
uniform lowp float u_${M}_t;
    #if !defined(${B})
        in ${k} ${j} a_${M};
    #endif  
#else
uniform ${k} ${z} u_${M};
#endif
`:R==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${M}0;
in vec4 a_${M}1;
in vec4 a_${M}2;
in vec4 a_${M}3;
#else
uniform ${k} ${z} u_${M};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${j} a_${M};
#else
uniform ${k} ${z} u_${M};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${M}
    ${k} ${z} ${M} = a_${M};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${M}
    #ifdef ${B}
        ${k} ${z} ${M} = ${U};
    #else
        ${k} ${z} ${M} = a_${M};
    #endif
#else
    ${k} ${z} ${M} = u_${M};
#endif
`:`
#ifndef HAS_UNIFORM_u_${M}
    #ifdef ${B}
        ${k} ${z} ${M} = unpack_mix_${Z}(${U}, u_${M}_t);
    #else
        ${k} ${z} ${M} = unpack_mix_${Z}(a_${M}, u_${M}_t);
    #endif
#else
    ${k} ${z} ${M} = u_${M};
#endif
`}),usedDefines:S,vertexIncludes:x,fragmentIncludes:w}}class Ru{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,f,_,x,w,S,I){this.context=r;let R=this.boundPaintVertexBuffers.length!==_.length;for(let z=0;!R&&z<_.length;z++)this.boundPaintVertexBuffers[z]!==_[z]&&(R=!0);let k=this.boundDynamicVertexBuffers.length!==S.length;for(let z=0;!k&&z<S.length;z++)this.boundDynamicVertexBuffers[z]!==S[z]&&(k=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==f||R||k||this.boundIndexBuffer!==x||this.boundVertexOffset!==w)this.freshBind(l,f,_,x,w,S,I);else{r.bindVertexArrayOES.set(this.vao);for(const z of S)z&&(z.bind(),I&&z.instanceCount&&z.setVertexAttribDivisor(r.gl,l,I));x&&x.dynamicDraw&&x.bind()}}freshBind(r,l,f,_,x,w,S){const I=this.context,R=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=w,l.enableAttributes(R,r),l.bind(),l.setVertexAttribPointers(R,r,x);for(const k of f)k.enableAttributes(R,r),k.bind(),k.setVertexAttribPointers(R,r,x);for(const k of w)k&&(k.enableAttributes(R,r),k.bind(),k.setVertexAttribPointers(R,r,x),S&&k.instanceCount&&k.setVertexAttribDivisor(R,r,S));_&&_.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ib(d,r){const l=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.ae(0,f/l).toLngLat().lat,new o.ae(0,(f+1)/l).toLngLat().lat]}function nb(d,r,l,f,_,x,w){const S=d.context,I=S.gl,R=l.hillshadeFBO;if(!R)return;d.prepareDrawTile();const k=d.isTileAffectedByFog(r),z=d.getOrCreateProgram("hillshade",{overrideFog:k});S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,R.colorAttachment.get());const M=((Z,q,K,ne)=>{const ee=K.paint.get("hillshade-shadow-color"),ge=K.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",oe=K.paint.get("hillshade-highlight-color"),ve=K.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pe=K.paint.get("hillshade-accent-color"),ce=K.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",xe=K.paint.get("hillshade-emissive-strength");let Me=o.an(K.paint.get("hillshade-illumination-direction"));if(K.paint.get("hillshade-illumination-anchor")==="viewport")Me-=Z.transform.angle;else if(Z.style&&Z.style.enable3dLights()&&Z.style.directionalLight){const We=Z.style.directionalLight.properties.get("direction"),Ne=o.d3(We.x,We.y,We.z);Me=o.an(Ne[1])}const Ce=!Z.options.moving;return{u_matrix:ne||Z.transform.calculateProjMatrix(q.tileID.toUnwrapped(),Ce),u_image:0,u_latrange:ib(0,q.tileID),u_light:[K.paint.get("hillshade-exaggeration"),Me],u_shadow:ee.toPremultipliedRenderColor(ge?null:K.lut),u_highlight:oe.toPremultipliedRenderColor(ve?null:K.lut),u_emissive_strength:xe,u_accent:pe.toPremultipliedRenderColor(ce?null:K.lut)}})(d,l,f,d.terrain?r.projMatrix:null);d.uploadCommonUniforms(S,z,r.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:U}=d.getTileBoundsBuffers(l);z.draw(d,I.TRIANGLES,_,x,w,_r.disabled,M,f.id,B,j,U)}function jf(d,r,l){if(!r.needsDEMTextureUpload)return;const f=d.context,_=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||d.getTileTexture(l.stride);const x=l.getPixels();r.demTexture?r.demTexture.update(x,{premultiply:!1}):r.demTexture=new o.T(f,x,_.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function sb(d,r,l){const f=d.context,_=f.gl;if(!r.dem)return;const x=r.dem;if(f.activeTexture.set(_.TEXTURE1),jf(d,r,x),!r.demTexture)return;r.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const w=x.dim;f.activeTexture.set(_.TEXTURE0);let S=r.hillshadeFBO;if(!S){const M=new o.T(f,{width:w,height:w,data:null},_.RGBA8);M.bind(_.LINEAR,_.CLAMP_TO_EDGE),S=r.hillshadeFBO=f.createFramebuffer(w,w,!0,"renderbuffer"),S.colorAttachment.set(M.texture)}f.bindFramebuffer.set(S.framebuffer),f.viewport.set([0,0,w,w]);const{tileBoundsBuffer:I,tileBoundsIndexBuffer:R,tileBoundsSegments:k}=d.getMercatorTileBoundsBuffers(),z=[];d.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(d,_.TRIANGLES,qt.disabled,Tr.disabled,Dr.unblended,_r.disabled,((M,B)=>{const j=B.stride,U=o.bB();return o.cd(U,0,o.al,-o.al,0,0,1),o.bq(U,U,[0,-o.al,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:M.overscaledZ}})(r.tileID,x),l.id,I,R,k),r.needsHillshadePrepare=!1}class ln{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class B0 extends ln{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ag extends ln{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class ob extends ln{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class ab extends ln{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class lb extends ln{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class cb extends ln{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class N0 extends ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class ub extends ln{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Vf extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class hb extends ln{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class j0 extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class Cg extends ln{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Uf extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Pg extends ln{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Nc extends ln{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ku extends ln{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class bd extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Mu extends ln{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class V0 extends ln{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Rg=class extends ln{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class U0 extends ln{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ou extends ln{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $f extends ln{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Gf extends ln{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class kg extends ln{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Hf extends ln{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Td extends ln{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class $0 extends ln{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class G0 extends ln{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class H0 extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Du extends ln{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class qf extends ln{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class db extends qf{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class q0 extends qf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class fb extends qf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Mg extends q0{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Og=(d,r,l)=>({u_matrix:d,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:l}),Wf=(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:x,u_image0:0,u_frustum_tl:w,u_frustum_tr:S,u_frustum_br:I,u_frustum_bl:R,u_globe_pos:k,u_globe_radius:z,u_viewport:M,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:j});function Zf(d,r){return d!=null&&r!=null&&!(!d.hasData()||!r.hasData())&&d.demTexture!=null&&r.demTexture!=null&&d.tileID.key!==r.tileID.key}const jc=new class{constructor(){this.operations={}}newMorphing(d,r,l,f,_){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[d]={startTime:f,phase:0,duration:_,from:r,to:l,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const r=this.operations[d];return{from:r.from,to:r.to,phase:r.phase}}update(d){for(const r in this.operations){const l=this.operations[r];for(l.phase=(d-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,d)){delete this.operations[r];break}}}_nextOp(d,r){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=r,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},Dg={0:null,1:"TERRAIN_VERTEX_MORPHING"};function W0(d,r,l){if(r===0)return 0;const f=r<1&&l===514?.25/r:1;return 6*Math.pow(1.5,22-d)*Math.max(r,1)*f}function Sd(d,r){const l=1<<d.z;return!r&&(d.x===0||d.x===l-1)||d.y===0||d.y===l-1}const Vc=d=>({u_matrix:d});function Xf(d,r,l,f,_){if(_>0){const x=o.o.now(),w=(x-d.timeAdded)/_,S=r?(x-r.timeAdded)/_:-1,I=l.getSource(),R=f.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),k=!r||Math.abs(r.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),z=k&&d.refreshedUponExpiration?1:o.aA(k?w:1-S,0,1);return r?{opacity:1,mix:1-z,isFading:w<1}:{opacity:z,mix:0,isFading:w<1}}return{opacity:1,mix:0,isFading:!1}}class No extends ua{constructor(r){const l=to("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class Lg extends ua{constructor(r){const l=to("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,f){if(r.freezeTileCoverage)return;this.transform=r;const _=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const S=new Ya(w,this._source.tileSize*w.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[w.key]=S}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(r){const l=this.proxyCachedFBO[r];if(l!==void 0){const f=Object.values(l);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ed extends o.aP{constructor(r,l,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=f}}class Id extends o.bU{constructor(r,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,_,x]=function(I){const R=new o.bc,k=new o.b0,z=131;R.reserve(17161),k.reserve(33800);const M=o.al/128,B=o.al+M/2,j=B+M;for(let Z=-M;Z<j;Z+=M)for(let q=-M;q<j;q+=M){const K=q<0||q>B||Z<0||Z>B?24575:0,ne=o.aA(Math.round(q),0,o.al),ee=o.aA(Math.round(Z),0,o.al);R.emplaceBack(ne+K,ee)}const U=(Z,q)=>{const K=q*z+Z;k.emplaceBack(K+1,K,K+z),k.emplaceBack(K+z,K+z+1,K+1)};for(let Z=1;Z<129;Z++)for(let q=1;q<129;q++)U(q,Z);return[0,129].forEach(Z=>{for(let q=0;q<130;q++)U(q,Z),U(Z,q)}),[R,k,32768]}(),w=r.context;this.gridBuffer=w.createVertexBuffer(f,o.be.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=o.bf.simpleSegment(0,0,f.length,_.length),this.gridNoSkirtSegments=o.bf.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Lg(l.map),this.orthoMatrix=o.bB(),o.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const S=w.gl;this._overlapStencilMode=new Tr({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new No(l.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const _=r.terrain.properties,x=r.terrain.drapeRenderMode===0,w=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const S=r.terrain&&r.terrain.scope,I=_.get("source"),R=x?this._mockSourceCache:r.getSourceCache(I,S);if(!R)return void o.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=R,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=w?this.calculateExaggeration(l):_.get("exaggeration"),!l.projection.requiresDraping&&w&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(l,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),l.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const l=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;const _=l!=null?f-l:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const x=r.zoom,w=this._style.terrain;if(!this._previousUpdateTimestamp)return w.getExaggeration(x);let S=x-this._previousZoom;const I=this._previousUpdateTimestamp;let R=x;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(x-R)>.5&&(S=.5*(x-R+S)),S*_<0&&(R+=S)),this._evaluationZoom=R;const k=w.getExaggeration(R),z=k===w.getExaggeration(Math.max(0,R-.1));if(z&&Math.abs(k-this._exaggeration)<.01)return k;let M=Math.min(.1,.00375*(this._updateTimestamp-I));return(z||k<.1||Math.abs(S)<1e-4)&&(M=Math.min(.2,4*M)),o.ak(this._exaggeration,k,M)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.dataType==="source"&&r.coord?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(I=>{const R=l.getTileByID(I).tileID;return R.projMatrix=f.calculateProjMatrix(R.toUnwrapped()),R});(function(I,R){const k=R.transform.pointCoordinate(R.transform.getCameraPoint()),z=new o.P(k.x,k.y);I.sort((M,B)=>{if(B.overscaledZ-M.overscaledZ)return B.overscaledZ-M.overscaledZ;const j=new o.P(M.canonical.x+(1<<M.canonical.z)*M.wrap,M.canonical.y),U=new o.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Z=z.mult(1<<M.canonical.z);return Z.x-=.5,Z.y-=.5,Z.distSqr(j)-Z.distSqr(U)})})(_,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};const w=this._style._mergedSourceCaches;for(const I in w){const R=w[I];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,r[I],x),R.usedForTerrain))continue;const k=r[I];R.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[l.id]=_.map(I=>new Ed(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const I of this.proxyCoords){const R=this.terrainTileForTile[I.key];if(!R)continue;const k=R.tileID.key;k in S||(this._visibleDemTiles.push(R),S[k]=k)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const f=this._findTileCoveringTileID(l,this.sourceCache);f&&(this.terrainTileForTile[l.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const f in this.terrainTileForTile){const _=this.terrainTileForTile[f],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),jf(this.painter,_,x))}}_prepareDemTileUniforms(r,l,f,_){if(!l||l.demTexture==null)return!1;const x=r.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-x.z),S=_||"";return f[`u_dem_tl${S}`]=[x.x*w%1,x.y*w%1],f[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const l=this._visibleDemTiles.reduce((f,_)=>{if(!_.dem)return f;const x=_.dem.tree.minimums[0];return x>0&&r++,f+x},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const f=this._getLoadedAreaMinimum(),_=new o.dK({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(r,_,l.R32F,{premultiply:!1}),x}setupElevationDraw(r,l,f){const _=this.painter.context,x=_.gl,w={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};w.u_exaggeration=this.exaggeration();let S=null,I=null,R=1;if(f&&f.morphing&&this._useVertexMorphing){const B=f.morphing.srcDemTile,j=f.morphing.dstDemTile;R=f.morphing.phase,B&&j&&(this._prepareDemTileUniforms(r,B,w,"_prev")&&(I=B),this._prepareDemTileUniforms(r,j,w)&&(S=j))}const k=B=>B&&B.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let z=null;var M;if(this.enabled?I&&S?(z=S.demTexture,_.activeTexture.set(x.TEXTURE4),I.demTexture.bind(k(I),x.CLAMP_TO_EDGE),w.u_dem_lerp=R):(S=this.terrainTileForTile[r.tileID.key],z=this._prepareDemTileUniforms(r,S,w)?S.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,_.activeTexture.set(x.TEXTURE2),z&&(w.u_dem_size=(M=z).size[0]===1?1:M.size[0]-2,z.bind(k(S),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,l,w),f&&f.useMeterToDem&&S){const B=(1<<S.tileID.canonical.z)*o.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=B}if(f&&f.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),l.setTerrainUniformValues(_,w),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,B)}}globeUniformValues(r,l,f){const _=r.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,o.al,0),u_tile_br_up:_.upVector(l,o.al,o.al),u_tile_bl_up:_.upVector(l,0,o.al),u_tile_up_scale:f?o.dL(1):_.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,x,w,S,I){if(_.transform.projection.name==="globe")(function(R,k,z,M,B){const j=R.context,U=j.gl;let Z,q;const K=R.transform,ne=o.dD(R,j,K),ee=(We,Ne)=>{if(q===Ne)return;const Qe=[Dg[Ne],"PROJECTION_GLOBE_VIEW"];ne&&Qe.push("CUSTOM_ANTIALIASING");const _t=R.isTileAffectedByFog(We);Z=R.getOrCreateProgram("globeRaster",{defines:Qe,overrideFog:_t}),q=Ne},ge=R.colorModeForRenderPass(),oe=new qt(U.LEQUAL,qt.ReadWrite,R.depthRangeFor3D);jc.update(B);const ve=o.dE(K),pe=[o.aF(K.center.lng),o.aJ(K.center.lat)],ce=R.globeSharedBuffers,xe=[K.width*o.o.devicePixelRatio,K.height*o.o.devicePixelRatio],Me=Float32Array.from(K.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};{const We=R.transform,Ne=W0(We.zoom,k.exaggeration(),k.sourceCache._source.tileSize);q=-1;const Qe=U.TRIANGLES;for(const _t of M){const Fe=z.getTile(_t),Ie=Tr.disabled,et=k.prevTerrainTileForTile[_t.key],je=k.terrainTileForTile[_t.key];Zf(et,je)&&jc.newMorphing(_t.key,et,je,B,250),j.activeTexture.set(U.TEXTURE0),Fe.texture&&Fe.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ot=jc.getMorphValuesForProxy(_t.key),wt=ot?1:0;ot&&Object.assign(Ce,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:o.dC(ot.phase)}});const jt=o.dF(_t.canonical),pt=o.dG(jt.getCenter().lat),vt=o.dH(_t.canonical,jt,pt,We.worldSize/We._pixelsPerMercatorPixel),$t=o.bj(o.dI(_t.canonical)),Ot=Wf(We.expandedFarZProjMatrix,Me,ve,$t,o.aj(We.zoom),pe,We.frustumCorners.TL,We.frustumCorners.TR,We.frustumCorners.BR,We.frustumCorners.BL,We.globeCenterInViewSpace,We.globeRadius,xe,Ne,We._farZ,vt);if(ee(_t,wt),Z&&(k.setupElevationDraw(Fe,Z,Ce),R.uploadCommonUniforms(j,Z,_t.toUnwrapped()),ce)){const[Rt,Dt,lr]=ce.getGridBuffers(pt,Ne!==0);Z.draw(R,Qe,oe,Ie,ge,_r.backCCW,Ot,"globe_raster",Rt,Dt,lr)}}}if(ce&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&We.push("CUSTOM_ANTIALIASING"),Z=R.getOrCreateProgram("globeRaster",{defines:We});for(const Ne of M){const{x:Qe,y:_t,z:Fe}=Ne.canonical,Ie=_t===0,et=_t===(1<<Fe)-1,[je,ot,wt,jt]=ce.getPoleBuffers(Fe,!1);if(jt&&(Ie||et)){const pt=z.getTile(Ne);j.activeTexture.set(U.TEXTURE0),pt.texture&&pt.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let vt=o.dJ(Fe,Qe,K);const $t=o.bj(o.dI(Ne.canonical)),Ot=(Rt,Dt)=>Rt.draw(R,U.TRIANGLES,oe,Tr.disabled,ge,_r.disabled,Wf(K.expandedFarZProjMatrix,vt,vt,$t,0,pe,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,xe,0,K._farZ),"globe_pole_raster",Dt,wt,jt);k.setupElevationDraw(pt,Z,Ce),R.uploadCommonUniforms(j,Z,Ne.toUnwrapped()),Ie&&R.renderDefaultNorthPole&&Ot(Z,je),et&&R.renderDefaultSouthPole&&(vt=o.cR(o.bB(),vt,[1,-1,1]),Ot(Z,ot))}}}})(_,x,w,S,I);else{const R=_.context,k=R.gl;let z,M;const B=_.shadowRenderer,j=yl(_,_.longestCutoffRange),U=ge=>{if(M===ge)return;const oe=[];oe.push(Dg[ge]),j.shouldRenderCutoff&&oe.push("RENDER_CUTOFF"),B&&(oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&oe.push("NORMAL_OFFSET")),z=_.getOrCreateProgram("terrainRaster",{defines:oe}),M=ge},Z=_.colorModeForRenderPass(),q=new qt(k.LEQUAL,qt.ReadWrite,_.depthRangeFor3D);jc.update(I);const K=_.transform,ne=W0(K.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ee=[0,0,0];if(B){const ge=_.style.directionalLight,oe=_.style.ambientLight;ge&&oe&&(ee=fa(_.style,ge,oe))}{M=-1;const ge=k.TRIANGLES,[oe,ve]=[x.gridIndexBuffer,x.gridSegments];for(const pe of S){const ce=w.getTile(pe),xe=Tr.disabled,Me=x.prevTerrainTileForTile[pe.key],Ce=x.terrainTileForTile[pe.key];Zf(Me,Ce)&&jc.newMorphing(pe.key,Me,Ce,I,250),R.activeTexture.set(k.TEXTURE0),ce.texture&&ce.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const We=jc.getMorphValuesForProxy(pe.key),Ne=We?1:0;let Qe;We&&(Qe={morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:o.dC(We.phase)}});const _t=Og(pe.projMatrix,Sd(pe.canonical,K.renderWorldCopies)?ne/10:ne,ee);if(U(Ne),!z)continue;x.setupElevationDraw(ce,z,Qe);const Fe=pe.toUnwrapped();B&&B.setupShadows(Fe,z),_.uploadCommonUniforms(R,z,Fe,null,j),z.draw(_,ge,q,xe,Z,_r.backCCW,_t,"terrain_raster",x.gridBuffer,oe,ve)}}}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const l=this.painter,f=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),S=l.style.order,I=[];let R=0;for(const k of x){const z=_.getTileByID(k.proxyTileKey),M=_.proxyCachedFBO[k.key]?_.proxyCachedFBO[k.key][r]:void 0,B=M!==void 0?_.renderCache[M]:this.pool[R++],j=M!==void 0;if(z.texture=B.tex,j&&!B.dirty){I.push(z.tileID);continue}let U;f.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(f.clear({color:o.ao.transparent,stencil:0}),B.dirty=!1);for(let Z=w.start;Z<=w.end;++Z){const q=l.style._mergedLayers[S[Z]];if(q.isHidden(l.transform.zoom))continue;const K=l.style.getLayerSourceCache(q),ne=K?this.proxyToSource[k.key][K.id]:[k];if(!ne)continue;const ee=ne;f.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(K?K.id:null)&&(this._setupStencil(B,ne,q,K),U=K?K.id:null),l.renderLayer(l,K,q,ee)}if(this._drapedRenderBatches.length===0)for(const Z of this._pendingGroundEffectLayers){const q=l.style._mergedLayers[S[Z]];if(q.isHidden(l.transform.zoom))continue;const K=l.style.getLayerSourceCache(q),ne=K?this.proxyToSource[k.key][K.id]:[k];if(!ne)continue;const ee=ne;f.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(K?K.id:null)&&(this._setupStencil(B,ne,q,K),U=K?K.id:null),l.renderLayer(l,K,q,ee)}this.renderedToTile?(B.dirty=!0,I.push(z.tileID)):j||--R,R===5&&(R=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}isLayerOrderingCorrect(r){const l=r.order.length;let f=-1,_=l;for(let x=0;x<l;++x)this._style.isLayerDraped(r._mergedLayers[r.order[x]])?f=Math.max(f,x):_=Math.min(_,x);return _>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,l,f){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const w=x.tileID,S=1<<w.overscaledZ,{x:I,y:R}=w.canonical,k=I/S,z=(I+1)/S,M=R/S,B=(R+1)/S;return{minx:k,miny:M,maxx:z,maxy:B,t:x.dem.tree.raycastRoot(k,M,z,B,r,l,f),tile:x}});_.sort((x,w)=>(x.t!==null?x.t:Number.MAX_VALUE)-(w.t!==null?w.t:Number.MAX_VALUE));for(const x of _){if(x.t==null)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,r,l,f);if(w!=null)return w}return null}_createFBO(){const r=this.painter.context,l=r.gl,f=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const _=new o.T(r,{width:f[0],height:f[1],data:null},l.RGBA8);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=r.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(_.texture),x.depthAttachment=new Mg(r,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._mergedLayers[r],f=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!f&&l.shouldRedrape():!f&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const f of this._style.getSources())if(f instanceof Gs){r=!0;break}if(!r)return;const l={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(_);if(x&&!l[x.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof o.ad){l[x.id]=!0;for(const w of this.proxyCoords){const S=this.proxyToSource[w.key][x.id];if(S)for(const I of S)this._clearRenderCacheForTile(x.id,I)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof la){r=!0;break}if(!r)return;const l={};for(let f=0;f<this._style.order.length;++f){const _=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(_);if(!x||l[x.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const w=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const I=this.proxyToSource[S.key][x.id];if(I)for(const R of I){const k=Xf(x.getTile(R),x.findLoadedParent(R,0),x,this.painter.transform,w);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(x.id,R)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,l=r.length;if(l===0)return;const f=[];this._pendingGroundEffectLayers=[];let _,x=0,w=this._style._mergedLayers[r[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<l;)w=this._style._mergedLayers[r[x]];for(;x<l;++x){const S=this._style._mergedLayers[r[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=x):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),_!==void 0&&(f.push({start:_,end:x-1}),_=void 0)))}if(_!==void 0&&f.push({start:_,end:x-1}),f.length!==0){const S=f[f.length-1];this._pendingGroundEffectLayers.every(I=>I>S.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<w.length;++S){const I=Object.values(w[S]);l.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,_=this._tilesDirty;for(let w=f.length-1;w>=0;w--){const S=f[w];if(l.getTileByID(S.key),l.proxyCachedFBO[S.key]!==void 0){const I=r[S.key],R=this.proxyToSource[S.key];let k=0;for(const z in R){const M=R[z],B=I[z];if(!B||B.length!==M.length||M.some((j,U)=>j!==B[U]||_[z]&&_[z].hasOwnProperty(j.key))){k=-1;break}++k}for(const z in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][z]].dirty=k<0||k!==Object.values(I).length}}const x=[...this._drapedRenderBatches];x.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of x)for(const S of f){if(l.proxyCachedFBO[S.key])continue;let I=l.renderCachePool.pop();I===void 0&&l.renderCache.length<50&&(I=l.renderCache.length,l.renderCache.push(this._createFBO())),I!==void 0&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][w.start]=I,l.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,f,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(f.isTileClipped())S=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Tr.disabled}_renderTileClippingMasks(r,l){const f=this.painter,_=this.painter.context,x=_.gl;f._tileClippingMaskIDs={},_.setColorMode(Dr.disabled),_.setDepthMode(qt.disabled);const w=f.getOrCreateProgram("clippingMask");for(const S of r){const I=f._tileClippingMaskIDs[S.key]=--l;w.draw(f,x.TRIANGLES,qt.disabled,new Tr({func:x.ALWAYS,mask:0},I,255,x.KEEP,x.KEEP,x.REPLACE),Dr.disabled,_r.disabled,Vc(S.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const f=[r.x,r.y,1,1];o.aC(f,f,l.pixelMatrixInverse),o.cJ(f,f,1/f[3]),f[0]/=l.worldSize,f[1]/=l.worldSize;const _=l._camera.position,x=o.ce(1,l.center.lat),w=[_[0],_[1],_[2]/x,0],S=o.d9([],f.slice(0,3),w);o.aw(S,S);const I=this.raycast(w,S,this._exaggeration);return I!==null&&I?(o.bG(w,w,S,I),w[3]=w[2],w[2]*=x,w):null}_setupProxiedCoordsForOrtho(r,l,f){if(r.getSource()instanceof o.aT)return this._setupProxiedCoordsForImageSource(r,l,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords;for(let I=0;I<x.length;I++){const R=x[I],k=this._findTileCoveringTileID(R,r);if(k){const z=this._createProxiedId(R,k,f[R.key]&&f[R.key][r.id]);_.push(z),this.proxyToSource[R.key][r.id]=[z]}}let w=!1;const S=new Set;for(let I=0;I<l.length;I++){const R=r.getTile(l[I]);if(!R||!R.hasData())continue;const k=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==R.tileID.canonical.z){const z=this.proxyToSource[k.tileID.key][r.id],M=this._createProxiedId(k.tileID,R,f[k.tileID.key]&&f[k.tileID.key][r.id]);z?z.splice(z.length-1,0,M):this.proxyToSource[k.tileID.key][r.id]=[M];const B=this.proxyToSource[k.tileID.key][r.id];S.has(B)||S.add(B),_.push(M),w=!0}}if(this._sourceTilesOverlap[r.id]=w,w&&this._debugParams.sortTilesHiZFirst)for(const I of S)I.sort((R,k)=>k.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(r,l,f){if(!r.getSource().loaded())return;const _=this.proxiedCoords[r.id]=[],x=this.proxyCoords,w=r.getSource(),S=w.tileID;if(!S)return;const I=new o.P(S.x,S.y)._div(1<<S.z),R=w.coordinates.map(o.ae.fromLngLat).reduce((z,M)=>(z.min.x=Math.min(z.min.x,M.x-I.x),z.min.y=Math.min(z.min.y,M.y-I.y),z.max.x=Math.max(z.max.x,M.x-I.x),z.max.y=Math.max(z.max.y,M.y-I.y),z),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(z,M)=>{const B=z.wrap+z.canonical.x/(1<<z.canonical.z),j=z.canonical.y/(1<<z.canonical.z),U=o.al/(1<<z.canonical.z),Z=M.wrap+M.canonical.x/(1<<M.canonical.z),q=M.canonical.y/(1<<M.canonical.z);return B+U<Z+R.min.x||B>Z+R.max.x||j+U<q+R.min.y||j>q+R.max.y};for(let z=0;z<x.length;z++){const M=x[z];for(let B=0;B<l.length;B++){const j=r.getTile(l[B]);if(!j||!j.hasData()||k(M,j.tileID))continue;const U=this._createProxiedId(M,j,f[M.key]&&f[M.key][r.id]),Z=this.proxyToSource[M.key][r.id];Z?Z.push(U):this.proxyToSource[M.key][r.id]=[U],_.push(U)}}}_createProxiedId(r,l,f){let _=this.orthoMatrix;if(f){const x=f.find(w=>w.key===l.tileID.key);if(x)return x}if(l.tileID.key!==r.key){const x=r.canonical.z-l.tileID.canonical.z;let w,S,I;_=o.bB();const R=l.tileID.wrap-r.wrap<<r.overscaledZ;x>0?(w=o.al>>x,S=w*((l.tileID.canonical.x<<x)-r.canonical.x+R),I=w*((l.tileID.canonical.y<<x)-r.canonical.y)):(w=o.al<<-x,S=o.al*(l.tileID.canonical.x-(r.canonical.x+R<<-x)),I=o.al*(l.tileID.canonical.y-(r.canonical.y<<-x))),o.cd(_,0,w,0,w,0,1),o.bq(_,_,[S,I,0])}return new Ed(l.tileID,r.key,_)}_findTileCoveringTileID(r,l){let f=l.getTile(r);if(f&&f.hasData())return f;const _=this._findCoveringTileCache[l.id],x=_[r.key];if(f=x?l.getTileByID(x):null,f&&f.hasData()||x===null)return f;let w=f?f.tileID:r,S=w.overscaledZ;const I=l.getSource().minzoom,R=[];if(!x){const z=l.getSource().maxzoom;if(r.canonical.z>=z){const M=r.canonical.z-z;l.getSource().reparseOverscaled?(S=Math.max(r.canonical.z+2,l.transform.tileZoom),w=new o.aP(S,r.wrap,z,r.canonical.x>>M,r.canonical.y>>M)):M!==0&&(S=z,w=new o.aP(S,r.wrap,z,r.canonical.x>>M,r.canonical.y>>M))}w.key!==r.key&&(R.push(w.key),f=l.getTile(w))}const k=z=>{R.forEach(M=>{_[M]=z}),R.length=0};for(S-=1;S>=I&&(!f||!f.hasData());S--){f&&k(f.tileID.key);const z=w.calculateScaledKey(S);if(f=l.getTileByID(z),f&&f.hasData())break;const M=_[z];if(M===null)break;M===void 0?R.push(z):f=l.getTileByID(M)}return k(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[l.key]=!0}}function zg(d,r,l){const f=function(S,I,R){const k=o.bI(I,S),z=o.bI(R,[.2126,.7152,.0722]),M=(j,U,Z)=>(1-Z)*j+Z*U,B=M(1-.3*Math.min(z,1),1,Math.min(k+1,1));return M(.92,1,Math.asin(o.aA(I[2],-1,1))/Math.PI+.5)*B}(d,[0,0,1],r),_=[0,0,0];o.c4(_,l.slice(0,3),f);const x=[0,0,0];o.c4(x,r.slice(0,3),d[2]);const w=[0,0,0];return o.d7(w,_,x),o.da(w)}const Fg=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Bg=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ad{static cacheKey(r,l,f,_){let x=`${l}${_?_.cacheKey:""}`;for(const w of f)r.usedDefines.includes(w)&&(x+=`/${w}`);return x}constructor(r,l,f,_,x,w){const S=r.gl;this.program=S.createProgram(),this.configuration=_,this.name=l,this.fixedDefines=[...w];let I=_?_.defines():[];I=I.concat(w.map(j=>`#define ${j}`));const R=`#version 300 es
`;let k=R+I.concat("precision mediump float;",el,wd.fragmentSource).join(`
`);for(const j of f.fragmentIncludes)k+=`
${Pu[j]}`;k+=`
${f.fragmentSource}`;let z=R+I.concat("precision highp float;",el,wd.vertexSource).join(`
`);for(const j of f.vertexIncludes)z+=`
${Pu[j]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(z+=`
uniform int u_instanceID;
`),z+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(z=z.replaceAll("gl_InstanceID","u_instanceID"));const M=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(M,k),S.compileShader(M),S.attachShader(this.program,M);const B=S.createShader(S.VERTEX_SHADER);S.isContextLost()?this.failedToCreate=!0:(S.shaderSource(B,z),S.compileShader(B),S.attachShader(this.program,B),this.attributes={},S.linkProgram(this.program),S.deleteShader(B),S.deleteShader(M),this.fixedUniforms=x(r),this.binderUniforms=_?_.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(j=>({u_instanceID:new o.cg(j)}))(r)),(w.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(j=>({u_dem:new o.cg(j),u_dem_prev:new o.cg(j),u_dem_tl:new o.cj(j),u_dem_scale:new o.ci(j),u_dem_tl_prev:new o.cj(j),u_dem_scale_prev:new o.ci(j),u_dem_size:new o.ci(j),u_dem_lerp:new o.ci(j),u_exaggeration:new o.ci(j),u_depth:new o.cg(j),u_depth_size_inv:new o.cj(j),u_depth_range_unpack:new o.cj(j),u_occluder_half_size:new o.ci(j),u_occlusion_depth_offset:new o.ci(j),u_meter_to_dem:new o.ci(j),u_label_plane_matrix_inv:new o.ck(j)}))(r)),w.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new o.ch(j),u_tile_tr_up:new o.ch(j),u_tile_br_up:new o.ch(j),u_tile_bl_up:new o.ch(j),u_tile_up_scale:new o.ci(j)}))(r)),w.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new o.ck(j),u_fog_range:new o.cj(j),u_fog_color:new o.d2(j),u_fog_horizon_blend:new o.ci(j),u_fog_vertical_limit:new o.cj(j),u_fog_temporal_offset:new o.ci(j),u_frustum_tl:new o.ch(j),u_frustum_tr:new o.ch(j),u_frustum_br:new o.ch(j),u_frustum_bl:new o.ch(j),u_globe_pos:new o.ch(j),u_globe_radius:new o.ci(j),u_globe_transition:new o.ci(j),u_is_globe:new o.cg(j),u_viewport:new o.cj(j)}))(r)),w.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(j=>({u_cutoff_params:new o.d2(j)}))(r)),w.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(j=>({u_lighting_ambient_color:new o.ch(j),u_lighting_directional_dir:new o.ch(j),u_lighting_directional_color:new o.ch(j),u_ground_radiance:new o.ch(j)}))(r)),w.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(j=>({u_light_matrix_0:new o.ck(j),u_light_matrix_1:new o.ck(j),u_fade_range:new o.cj(j),u_shadow_normal_offset:new o.ch(j),u_shadow_intensity:new o.ci(j),u_shadow_texel_size:new o.ci(j),u_shadow_map_resolution:new o.ci(j),u_shadow_direction:new o.ch(j),u_shadow_bias:new o.ch(j),u_shadowmap_0:new o.cg(j),u_shadowmap_1:new o.cg(j)}))(r)))}getAttributeLocation(r,l){let f=this.attributes[l];return f===void 0&&(f=this.attributes[l]=r.getAttribLocation(this.program,l)),f}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_]&&f[_].set(this.program,_,l[_])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_]&&f[_].set(this.program,_,l[_])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_].set(this.program,_,l[_])}}setCutoffUniformValues(r,l){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_].set(this.program,_,l[_])}}setLightsUniformValues(r,l){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const _ in l)f[_].set(this.program,_,l[_])}}setShadowUniformValues(r,l){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;r.program.set(this.program);for(const _ in l)f[_].set(this.program,_,l[_])}_drawDebugWireframe(r,l,f,_,x,w,S,I,R,k){const z=r.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const M=r.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||r._terrain&&r._terrain.renderingToTexture||!Fg.includes(this.name))||!(!z.layers3D||!Bg.includes(this.name))))return;const B=M.gl,j=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,x,M);if(!j)return;const U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");const Z=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});M.program.set(Z.program);const q=(ee,ge,oe)=>{if(ge[ee]&&oe[ee])for(const ve in ge[ee])oe[ee][ve]&&oe[ee][ve].set(oe.program,ve,ge[ee][ve].current)};R&&R.setUniforms(Z.program,M,Z.binderUniforms,S,{zoom:I}),q("fixedUniforms",this,Z),q("terrainUniforms",this,Z),q("globeUniforms",this,Z),q("fogUniforms",this,Z),q("lightsUniforms",this,Z),q("shadowUniforms",this,Z),j.bind(),M.setColorMode(new Dr([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],o.ao.transparent,[!0,!0,!0,!1])),M.setDepthMode(new qt(l.func===B.LESS?B.LEQUAL:l.func,qt.ReadOnly,l.range)),M.setStencilMode(Tr.disabled);const K=3*w.primitiveLength*2,ne=3*w.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ee=k||1;for(let ge=0;ge<ee;++ge)Z.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),B.drawElements(B.LINES,K,B.UNSIGNED_SHORT,ne)}else k&&k>1?B.drawElementsInstanced(B.LINES,K,B.UNSIGNED_SHORT,ne,k):B.drawElements(B.LINES,K,B.UNSIGNED_SHORT,ne);x.bind(),M.program.set(this.program),M.setDepthMode(l),M.setStencilMode(f),M.setColorMode(_)}checkUniforms(r,l,f){if(this.fixedDefines.includes(l)){for(const _ of Object.keys(f))if(!f[_].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${_} not set but required by ${l} being defined`)}}draw(r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z){const q=r.context,K=q.gl;if(this.failedToCreate)return;q.program.set(this.program),q.setDepthMode(f),q.setStencilMode(_),q.setColorMode(x),q.setCullFace(w);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,S[ge]);j&&j.setUniforms(this.program,q,this.binderUniforms,M,{zoom:B});const ne={[K.POINTS]:1,[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[l];this.checkUniforms(I,"RENDER_SHADOWS",this.shadowUniforms);const ee=Z&&Z>0?1:void 0;for(const ge of z.get()){const oe=ge.vaos||(ge.vaos={});if((oe[I]||(oe[I]=new Ru)).bind(q,this,R,j?j.getPaintVertexBuffers():[],k,ge.vertexOffset,U||[],ee),this.forceManualRenderingForInstanceIDShaders){const ve=Z||1;for(let pe=0;pe<ve;++pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pe),k?K.drawElements(l,ge.primitiveLength*ne,K.UNSIGNED_SHORT,ge.primitiveOffset*ne*2):K.drawArrays(l,ge.vertexOffset,ge.vertexLength)}else Z&&Z>1?K.drawElementsInstanced(l,ge.primitiveLength*ne,K.UNSIGNED_SHORT,ge.primitiveOffset*ne*2,Z):k?K.drawElements(l,ge.primitiveLength*ne,K.UNSIGNED_SHORT,ge.primitiveOffset*ne*2):K.drawArrays(l,ge.vertexOffset,ge.vertexLength);l===K.TRIANGLES&&k&&this._drawDebugWireframe(r,f,_,x,k,ge,M,B,j,Z)}}}function Kf(d,r,l=0){const f=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,d.transform.tileZoom)/f,x=_*(r.tileID.canonical.x+r.tileID.wrap*f),w=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(r,1,d.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w],u_pattern_transition:l}}const Lu={terrain:0,flat:1},Yf=o.bB(),Jf=(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q)=>{const K=r.style.light,ne=K.properties.get("position"),ee=[ne.x,ne.y,ne.z],ge=o.dN();K.properties.get("anchor")==="viewport"&&(o.dO(ge,-r.transform.angle),o.dP(ee,ee,ge));const oe=K.properties.get("color").toPremultipliedRenderColor(null),ve=r.transform,pe={u_matrix:d,u_lightpos:ee,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_vertical_gradient:+l,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Yf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Lu[R],u_base_type:Lu[k],u_ao:_,u_edge_radius:x,u_width_scale:w,u_flood_light_color:j,u_vertical_scale:U,u_flood_light_intensity:Z,u_ground_shadow_factor:q};return ve.projection.name==="globe"&&(pe.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],pe.u_zoom_transition=z,pe.u_inv_rot_matrix=B,pe.u_merc_center=M,pe.u_up_dir=ve.projection.upVector(new o.cC(0,0,0),M[0]*o.al,M[1]*o.al),pe.u_height_lift=I),pe},Z0=(d,r,l,f,_,x)=>({u_matrix:d,u_edge_radius:r,u_width_scale:l,u_vertical_scale:f,u_height_type:Lu[_],u_base_type:Lu[x]}),X0=(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q)=>{const K=Jf(d,r,l,f,_,x,w,S,R,k,z,M,B,j,U,Z,1,[0,0,0]),ne={u_height_factor:-Math.pow(2,S.overscaledZ)/I.tileSize/8};return Object.assign(K,Kf(r,I,q),ne)},zu=(d,r,l,f,_,x,w,S,I,R,k)=>({u_matrix:r,u_opacity:l,u_ao_pass:f?1:0,u_meter_to_tile:_,u_ao:x,u_flood_light_intensity:w,u_flood_light_color:S,u_attenuation:I,u_edge_radius:R,u_fb:0,u_fb_size:k,u_dynamic_offset:1}),K0=(d,r,l)=>({u_matrix:d,u_emissive_strength:r,u_ground_shadow_factor:l}),Y0=(d,r,l,f,_,x=0)=>Object.assign(K0(d,r,_),Kf(l,f,x)),pb=(d,r,l,f)=>({u_matrix:d,u_world:l,u_emissive_strength:r,u_ground_shadow_factor:f}),mb=(d,r,l,f,_,x,w=0)=>Object.assign(Y0(d,r,l,f,x,w),{u_world:_}),gb=(d,r)=>({u_matrix:d,u_ground_shadow_factor:r}),Qf=(d,r,l,f,_)=>({u_matrix:d,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:l,u_height_scale:f,u_reset_depth:_}),Ng=(d,r,l,f,_,x,w,S,I)=>({u_matrix:d,u_normal_matrix:r,u_opacity:l,u_faux_facade_ao_intensity:f,u_camera_pos:_,u_tile_to_meter:x,u_facade_emissive_chance:w,u_flood_light_color:S,u_flood_light_intensity:I}),jg=d=>({u_matrix:d}),J0=d=>({u_matrix:d}),Fu=(d,r,l,f,_,x,w,S)=>{const I=o.al/x.tileSize;return{u_matrix:d,u_inv_rot_matrix:r,u_camera_to_center_distance:l.getCameraToCenterDistance(S),u_extrude_scale:[l.pixelsToGLUnits[0]/I,l.pixelsToGLUnits[1]/I],u_zoom_transition:f,u_tile_id:w,u_merc_center:_}},Vg=(d,r,l=1)=>({u_matrix:d,u_color:r,u_overlay:0,u_overlay_scale:l}),Q0=o.bB(),ev=(d,r,l,f,_,x,w)=>{const S=d.transform,I=S.projection.name==="globe",R=I?o.dQ(S.zoom,r.canonical)*S._pixelsPerMercatorPixel:o.ay(l,1,x),k={u_matrix:r.projMatrix,u_extrude_scale:R,u_intensity:w,u_inv_rot_matrix:Q0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){k.u_inv_rot_matrix=f,k.u_merc_center=_,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=o.aj(S.zoom);const z=_[0]*o.al,M=_[1]*o.al;k.u_up_dir=S.projection.upVector(new o.cC(0,0,0),z,M)}return k};function ep(d,[r,l,f,_],[x,w]){if(x===w)return[0,0,0,0];const S=255*(d-1)/(d*(w-x));return[r*S,l*S,f*S,_*S]}function vl(d,r,[l,f]){return l===f?0:.5/d+(r-l)*(d-1)/(d*(f-l))}const Cd=(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K,ne,ee)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:o.dS(z.paint.get("raster-saturation")),u_contrast_factor:o.dR(z.paint.get("raster-contrast")),u_spin_weights:tp(z.paint.get("raster-hue-rotate")),u_perspective_transform:M,u_raster_elevation:B,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:I,u_colorization_mix:ep(o.dT,U,q),u_colorization_offset:vl(o.dT,Z,q),u_color_ramp:j,u_texture_offset:[ne/(K+2*ne),K/(K+2*ne)],u_texture_res:[K+2*ne,K+2*ne],u_emissive_strength:ee});function tp(d){d*=Math.PI/180;const r=Math.sin(d),l=Math.cos(d);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const Uc=.05,tc=(d,r,l,f,_,x,w,S,I,R,k,z)=>({u_matrix:d,u_normalize_matrix:r,u_globe_matrix:l,u_merc_matrix:f,u_grid_matrix:_,u_tl_parent:x,u_scale_parent:R,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:w,u_merc_center:S,u_cutoff_params:I}),Ug=(d,r,l,f,_,x,w,S,I,R)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_tile_offset:l,u_velocity:f,u_color_ramp:x,u_velocity_res:_,u_max_speed:w,u_uv_offset:S,u_data_scale:[255*I[0],255*I[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uc,Uc]}),rp=(d,r,l,f,_,x,w,S,I,R)=>({u_particle_texture:d,u_particle_texture_side_len:r,u_velocity:l,u_velocity_res:f,u_max_speed:_,u_speed_factor:x,u_reset_rate:w,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*I[0],255*I[1]],u_data_offset:R,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uc,Uc]}),$g=o.bB(),Gg=(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K,ne,ee,ge,oe,ve)=>{const pe=_.transform,ce={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(K),u_rotate_symbol:+l,u_aspect_ratio:pe.width/pe.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+R,u_elevation_from_sea:I?1:0,u_pitch_with_map:+f,u_texsize:k,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:$g,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:$g,u_up_vector:[0,-1,0],u_color_adj_mat:ge,u_icon_transition:oe||0,u_gamma_scale:f?_.transform.getCameraToCenterDistance(K)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ve||1,u_ground_shadow_factor:ne,u_inv_matrix:o.bk(o.bB(),w),u_normal_scale:ee,u_lutTexture:_s.LUT};return K.name==="globe"&&(ce.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],ce.u_zoom_transition=j,ce.u_inv_rot_matrix=Z,ce.u_merc_center=U,ce.u_camera_forward=pe._camera.forward(),ce.u_ecef_origin=o.dU(pe.globeMatrix,B.toUnwrapped()),ce.u_tile_matrix=Float32Array.from(pe.globeMatrix),ce.u_up_vector=q),ce},ip=(d,r,l,f)=>({u_matrix:d,u_emissive_strength:r,u_opacity:l,u_color:f}),np=(d,r,l,f,_,x,w,S,I)=>Object.assign(function(R,k,z,M,B,j){const{width:U,height:Z}=M.imageManager.getPixelSize(k),q=Math.pow(2,j.tileID.overscaledZ),K=j.tileSize*Math.pow(2,M.transform.tileZoom)/q,ne=K*(j.tileID.canonical.x+j.tileID.wrap*q),ee=K*j.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[U,Z],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:B?[M.transform.width,-1*M.transform.height]:[1/o.ay(j,1,M.transform.tileZoom),1/o.ay(j,1,M.transform.tileZoom)],u_pixel_coord_upper:[ne>>16,ee>>16],u_pixel_coord_lower:[65535&ne,65535&ee]}}(0,x,w,f,S,I),{u_matrix:d,u_emissive_strength:r,u_opacity:l}),Hg=new Float32Array(o.bz([])),sp=(d,r,l,f,_,x,w,S,I,R,k,z,M,B=[0,0,0],j,U,Z)=>{const q=_.style.light,K=q.properties.get("position"),ne=[-K.x,-K.y,K.z],ee=o.dN();q.properties.get("anchor")==="viewport"&&(o.dO(ee,-_.transform.angle),o.dP(ne,ne,ee));const ge=k.alphaMode==="MASK",oe=q.properties.get("color").toNonPremultipliedRenderColor(null),ve=M.paint.get("model-ambient-occlusion-intensity"),pe=M.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return pe.a=M.paint.get("model-color-mix-intensity").constantOr(0),Z&&(pe.r=Z[0],pe.g=Z[1],pe.b=Z[2],pe.a=Z[3]),U&&(pe.r=U.color.r,pe.g=U.color.g,pe.b=U.color.b,pe.a=U.colorMix,z=U.emissionStrength,x=U.opacity),{u_matrix:d,u_lighting_matrix:r,u_normal_matrix:l,u_node_matrix:f||Hg,u_lightpos:ne,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_camera_pos:B,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+ge,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:I,u_roughnessFactor:R,u_baseColorTexture:_s.BaseColor,u_metallicRoughnessTexture:_s.MetallicRoughness,u_normalTexture:_s.Normal,u_occlusionTexture:_s.Occlusion,u_emissionTexture:_s.Emission,u_lutTexture:_s.LUT,u_color_mix:pe.toArray01(),u_aoIntensity:ve,u_emissive_strength:z,u_occlusionTextureTransform:j||[0,0,0,0]}},Bu=(d,r=Hg,l=Hg)=>({u_matrix:d,u_instance:r,u_node_matrix:l}),_b={fillExtrusion:d=>({u_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_vertical_gradient:new o.ci(d),u_opacity:new o.ci(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_ao:new o.cj(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_up_dir:new o.ch(d),u_height_lift:new o.ci(d),u_flood_light_color:new o.ch(d),u_vertical_scale:new o.ci(d),u_flood_light_intensity:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),fillExtrusionDepth:d=>({u_matrix:new o.ck(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_vertical_scale:new o.ci(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d)}),fillExtrusionPattern:d=>({u_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_vertical_gradient:new o.ci(d),u_height_factor:new o.ci(d),u_edge_radius:new o.ci(d),u_width_scale:new o.ci(d),u_ao:new o.cj(d),u_height_type:new o.cg(d),u_base_type:new o.cg(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_up_dir:new o.ch(d),u_height_lift:new o.ci(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_opacity:new o.ci(d),u_pattern_transition:new o.ci(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new o.ck(d),u_opacity:new o.ci(d),u_ao_pass:new o.ci(d),u_meter_to_tile:new o.ci(d),u_ao:new o.cj(d),u_flood_light_intensity:new o.ci(d),u_flood_light_color:new o.ch(d),u_attenuation:new o.ci(d),u_edge_radius:new o.ci(d),u_fb:new o.cg(d),u_fb_size:new o.ci(d),u_dynamic_offset:new o.ci(d)}),fill:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),fillPattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_pattern_transition:new o.ci(d)}),fillOutline:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_world:new o.cj(d),u_ground_shadow_factor:new o.ch(d)}),fillOutlinePattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_world:new o.cj(d),u_image:new o.cg(d),u_texsize:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_tile_units_to_pixels:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_pattern_transition:new o.ci(d)}),building:d=>({u_matrix:new o.ck(d),u_normal_matrix:new o.ck(d),u_opacity:new o.ci(d),u_faux_facade_ao_intensity:new o.ci(d),u_camera_pos:new o.ch(d),u_tile_to_meter:new o.ci(d),u_facade_emissive_chance:new o.ci(d),u_flood_light_color:new o.ch(d),u_flood_light_intensity:new o.ci(d)}),buildingBloom:d=>({u_matrix:new o.ck(d)}),buildingDepth:d=>({u_matrix:new o.ck(d)}),elevatedStructuresDepth:d=>({u_matrix:new o.ck(d),u_depth_bias:new o.ci(d)}),elevatedStructures:d=>({u_matrix:new o.ck(d),u_ground_shadow_factor:new o.ch(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new o.ck(d),u_camera_pos:new o.ch(d),u_depth_bias:new o.ci(d),u_height_scale:new o.ci(d),u_reset_depth:new o.ci(d)}),circle:o.dX,collisionBox:d=>({u_matrix:new o.ck(d),u_inv_rot_matrix:new o.ck(d),u_camera_to_center_distance:new o.ci(d),u_extrude_scale:new o.cj(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_tile_id:new o.ch(d)}),collisionCircle:d=>({u_matrix:new o.ck(d),u_inv_matrix:new o.ck(d),u_camera_to_center_distance:new o.ci(d),u_viewport_size:new o.cj(d)}),debug:d=>({u_color:new o.dA(d),u_matrix:new o.ck(d),u_overlay:new o.cg(d),u_overlay_scale:new o.ci(d)}),clippingMask:d=>({u_matrix:new o.ck(d)}),heatmap:d=>({u_extrude_scale:new o.ci(d),u_intensity:new o.ci(d),u_matrix:new o.ck(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_up_dir:new o.ch(d)}),heatmapTexture:d=>({u_image:new o.cg(d),u_color_ramp:new o.cg(d),u_opacity:new o.ci(d)}),hillshade:d=>({u_matrix:new o.ck(d),u_image:new o.cg(d),u_latrange:new o.cj(d),u_light:new o.cj(d),u_shadow:new o.dA(d),u_highlight:new o.dA(d),u_emissive_strength:new o.ci(d),u_accent:new o.dA(d)}),hillshadePrepare:d=>({u_matrix:new o.ck(d),u_image:new o.cg(d),u_dimension:new o.cj(d),u_zoom:new o.ci(d)}),line:o.dW,linePattern:o.dV,raster:d=>({u_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_grid_matrix:new o.dB(d),u_tl_parent:new o.cj(d),u_scale_parent:new o.ci(d),u_fade_t:new o.ci(d),u_opacity:new o.ci(d),u_image0:new o.cg(d),u_image1:new o.cg(d),u_brightness_low:new o.ci(d),u_brightness_high:new o.ci(d),u_saturation_factor:new o.ci(d),u_contrast_factor:new o.ci(d),u_spin_weights:new o.ch(d),u_perspective_transform:new o.cj(d),u_raster_elevation:new o.ci(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_cutoff_params:new o.d2(d),u_colorization_mix:new o.d2(d),u_colorization_offset:new o.ci(d),u_color_ramp:new o.cg(d),u_texture_offset:new o.cj(d),u_texture_res:new o.cj(d),u_emissive_strength:new o.ci(d)}),rasterParticle:d=>({u_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_grid_matrix:new o.dB(d),u_tl_parent:new o.cj(d),u_scale_parent:new o.ci(d),u_fade_t:new o.ci(d),u_opacity:new o.ci(d),u_image0:new o.cg(d),u_image1:new o.cg(d),u_raster_elevation:new o.ci(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_cutoff_params:new o.d2(d)}),rasterParticleTexture:d=>({u_texture:new o.cg(d),u_opacity:new o.ci(d)}),rasterParticleDraw:d=>({u_particle_texture:new o.cg(d),u_particle_texture_side_len:new o.ci(d),u_tile_offset:new o.cj(d),u_velocity:new o.cg(d),u_color_ramp:new o.cg(d),u_velocity_res:new o.cj(d),u_max_speed:new o.ci(d),u_uv_offset:new o.cj(d),u_data_scale:new o.cj(d),u_data_offset:new o.ci(d),u_particle_pos_scale:new o.ci(d),u_particle_pos_offset:new o.cj(d)}),rasterParticleUpdate:d=>({u_particle_texture:new o.cg(d),u_particle_texture_side_len:new o.ci(d),u_velocity:new o.cg(d),u_velocity_res:new o.cj(d),u_max_speed:new o.ci(d),u_speed_factor:new o.ci(d),u_reset_rate:new o.ci(d),u_rand_seed:new o.ci(d),u_uv_offset:new o.cj(d),u_data_scale:new o.cj(d),u_data_offset:new o.ci(d),u_particle_pos_scale:new o.ci(d),u_particle_pos_offset:new o.cj(d)}),symbol:d=>({u_is_size_zoom_constant:new o.cg(d),u_is_size_feature_constant:new o.cg(d),u_size_t:new o.ci(d),u_size:new o.ci(d),u_camera_to_center_distance:new o.ci(d),u_rotate_symbol:new o.cg(d),u_aspect_ratio:new o.ci(d),u_fade_change:new o.ci(d),u_matrix:new o.ck(d),u_label_plane_matrix:new o.ck(d),u_coord_matrix:new o.ck(d),u_is_text:new o.cg(d),u_elevation_from_sea:new o.cg(d),u_pitch_with_map:new o.cg(d),u_texsize:new o.cj(d),u_texsize_icon:new o.cj(d),u_texture:new o.cg(d),u_texture_icon:new o.cg(d),u_gamma_scale:new o.ci(d),u_device_pixel_ratio:new o.ci(d),u_tile_id:new o.ch(d),u_zoom_transition:new o.ci(d),u_inv_rot_matrix:new o.ck(d),u_merc_center:new o.cj(d),u_camera_forward:new o.ch(d),u_tile_matrix:new o.ck(d),u_up_vector:new o.ch(d),u_ecef_origin:new o.ch(d),u_is_halo:new o.cg(d),u_icon_transition:new o.ci(d),u_color_adj_mat:new o.ck(d),u_scale_factor:new o.ci(d),u_ground_shadow_factor:new o.ch(d),u_inv_matrix:new o.ck(d),u_normal_scale:new o.ci(d),u_lutTexture:new o.cg(d)}),background:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_opacity:new o.ci(d),u_color:new o.dA(d)}),backgroundPattern:d=>({u_matrix:new o.ck(d),u_emissive_strength:new o.ci(d),u_opacity:new o.ci(d),u_image:new o.cg(d),u_pattern_tl:new o.cj(d),u_pattern_br:new o.cj(d),u_texsize:new o.cj(d),u_pattern_size:new o.cj(d),u_pixel_coord_upper:new o.cj(d),u_pixel_coord_lower:new o.cj(d),u_pattern_units_to_pixels:new o.cj(d)}),terrainRaster:d=>({u_matrix:new o.ck(d),u_image0:new o.cg(d),u_skirt_height:new o.ci(d),u_ground_shadow_factor:new o.ch(d)}),skybox:d=>({u_matrix:new o.ck(d),u_sun_direction:new o.ch(d),u_cubemap:new o.cg(d),u_opacity:new o.ci(d),u_temporal_offset:new o.ci(d)}),skyboxGradient:d=>({u_matrix:new o.ck(d),u_color_ramp:new o.cg(d),u_center_direction:new o.ch(d),u_radius:new o.ci(d),u_opacity:new o.ci(d),u_temporal_offset:new o.ci(d)}),skyboxCapture:d=>({u_matrix_3f:new o.dB(d),u_sun_direction:new o.ch(d),u_sun_intensity:new o.ci(d),u_color_tint_r:new o.d2(d),u_color_tint_m:new o.d2(d),u_luminance:new o.ci(d)}),globeRaster:d=>({u_proj_matrix:new o.ck(d),u_globe_matrix:new o.ck(d),u_normalize_matrix:new o.ck(d),u_merc_matrix:new o.ck(d),u_zoom_transition:new o.ci(d),u_merc_center:new o.cj(d),u_image0:new o.cg(d),u_grid_matrix:new o.dB(d),u_skirt_height:new o.ci(d),u_far_z_cutoff:new o.ci(d),u_frustum_tl:new o.ch(d),u_frustum_tr:new o.ch(d),u_frustum_br:new o.ch(d),u_frustum_bl:new o.ch(d),u_globe_pos:new o.ch(d),u_globe_radius:new o.ci(d),u_viewport:new o.cj(d)}),globeAtmosphere:d=>({u_frustum_tl:new o.ch(d),u_frustum_tr:new o.ch(d),u_frustum_br:new o.ch(d),u_frustum_bl:new o.ch(d),u_horizon:new o.ci(d),u_transition:new o.ci(d),u_fadeout_range:new o.ci(d),u_atmosphere_fog_color:new o.d2(d),u_high_color:new o.d2(d),u_space_color:new o.d2(d),u_temporal_offset:new o.ci(d),u_horizon_angle:new o.ci(d)}),model:d=>({u_matrix:new o.ck(d),u_lighting_matrix:new o.ck(d),u_normal_matrix:new o.ck(d),u_node_matrix:new o.ck(d),u_lightpos:new o.ch(d),u_lightintensity:new o.ci(d),u_lightcolor:new o.ch(d),u_camera_pos:new o.ch(d),u_opacity:new o.ci(d),u_baseColorFactor:new o.d2(d),u_emissiveFactor:new o.d2(d),u_metallicFactor:new o.ci(d),u_roughnessFactor:new o.ci(d),u_baseTextureIsAlpha:new o.cg(d),u_alphaMask:new o.cg(d),u_alphaCutoff:new o.ci(d),u_baseColorTexture:new o.cg(d),u_metallicRoughnessTexture:new o.cg(d),u_normalTexture:new o.cg(d),u_occlusionTexture:new o.cg(d),u_emissionTexture:new o.cg(d),u_lutTexture:new o.cg(d),u_color_mix:new o.d2(d),u_aoIntensity:new o.ci(d),u_emissive_strength:new o.ci(d),u_occlusionTextureTransform:new o.d2(d)}),modelDepth:d=>({u_matrix:new o.ck(d),u_instance:new o.ck(d),u_node_matrix:new o.ck(d)}),groundShadow:d=>({u_matrix:new o.ck(d),u_ground_shadow_factor:new o.ch(d)}),stars:d=>({u_matrix:new o.ck(d),u_up:new o.ch(d),u_right:new o.ch(d),u_intensity_multiplier:new o.ci(d)}),snowParticle:d=>({u_modelview:new o.ck(d),u_projection:new o.ck(d),u_time:new o.ci(d),u_cam_pos:new o.ch(d),u_velocityConeAperture:new o.ci(d),u_velocity:new o.ci(d),u_horizontalOscillationRadius:new o.ci(d),u_horizontalOscillationRate:new o.ci(d),u_boxSize:new o.ci(d),u_billboardSize:new o.ci(d),u_simpleShapeParameters:new o.cj(d),u_screenSize:new o.cj(d),u_thinningCenterPos:new o.cj(d),u_thinningShape:new o.ch(d),u_thinningAffectedRatio:new o.ci(d),u_thinningParticleOffset:new o.ci(d),u_particleColor:new o.d2(d),u_direction:new o.ch(d)}),rainParticle:d=>({u_modelview:new o.ck(d),u_projection:new o.ck(d),u_time:new o.ci(d),u_cam_pos:new o.ch(d),u_texScreen:new o.cg(d),u_velocityConeAperture:new o.ci(d),u_velocity:new o.ci(d),u_boxSize:new o.ci(d),u_rainDropletSize:new o.cj(d),u_distortionStrength:new o.ci(d),u_rainDirection:new o.ch(d),u_color:new o.d2(d),u_screenSize:new o.cj(d),u_thinningCenterPos:new o.cj(d),u_thinningShape:new o.ch(d),u_thinningAffectedRatio:new o.ci(d),u_thinningParticleOffset:new o.ci(d),u_shapeDirectionalPower:new o.ci(d),u_shapeNormalPower:new o.ci(d),u_mode:new o.ci(d)}),vignette:d=>({u_vignetteShape:new o.ch(d),u_vignetteColor:new o.d2(d)}),occlusion:d=>({u_matrix:new o.ck(d),u_anchorPos:new o.ch(d),u_screenSizePx:new o.cj(d),u_occluderSizePx:new o.cj(d),u_color:new o.d2(d)})};class rc{constructor(r,l,f,_){this.id=rc.uniqueIdxCounter,rc.uniqueIdxCounter++,this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||_||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=rc.uniqueIdxCounter,rc.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}rc.uniqueIdxCounter=0;const tv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class yb{constructor(r,l,f,_,x,w){this.length=l.length,this.attributes=f,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.instanceCount=w,this.context=r;const S=r.gl;this.buffer=S.createBuffer(),r.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||x||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let f=0;f<this.attributes.length;f++){const _=l.getAttributeLocation(r,this.attributes[f].name);_!==-1&&r.enableVertexAttribArray(_)}}setVertexAttribPointers(r,l,f){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],w=l.getAttributeLocation(r,x.name);w!==-1&&r.vertexAttribPointer(w,x.components,r[tv[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,l,f){for(let _=0;_<this.attributes.length;_++){const x=l.getAttributeLocation(r,this.attributes[_].name);x!==-1&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class op{constructor(r,l,f,_,x){this.context=r,this.width=l,this.height=f;const w=this.framebuffer=r.gl.createFramebuffer();_&&(this.colorAttachment=new db(r,w)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new q0(r,w):new fb(r,w))}destroy(){const r=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&r.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&r.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&r.deleteTexture(l)}r.deleteFramebuffer(this.framebuffer)}}class ap{constructor(r,l){this.gl=r,this.clearColor=new B0(this),this.clearDepth=new Ag(this),this.clearStencil=new ob(this),this.colorMask=new ab(this),this.depthMask=new lb(this),this.stencilMask=new cb(this),this.stencilFunc=new N0(this),this.stencilOp=new ub(this),this.stencilTest=new Vf(this),this.depthRange=new hb(this),this.depthTest=new j0(this),this.depthFunc=new Cg(this),this.blend=new Uf(this),this.blendFunc=new Pg(this),this.blendColor=new Nc(this),this.blendEquation=new ku(this),this.cullFace=new bd(this),this.cullFaceSide=new Mu(this),this.frontFace=new V0(this),this.program=new Rg(this),this.activeTexture=new U0(this),this.viewport=new Ou(this),this.bindFramebuffer=new $f(this),this.bindRenderbuffer=new Gf(this),this.bindTexture=new kg(this),this.bindVertexBuffer=new Hf(this),this.bindElementBuffer=new Td(this),this.bindVertexArrayOES=new $0(this),this.pixelStoreUnpack=new G0(this),this.pixelStoreUnpackPremultiplyAlpha=new H0(this),this.pixelStoreUnpackFlipY=new Du(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l,f){return new rc(this,r,l,f)}createVertexBuffer(r,l,f,_,x){return new yb(this,r,l,f,_,x)}createRenderbuffer(r,l,f){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,r,l,f),this.bindRenderbuffer.set(null),x}createFramebuffer(r,l,f,_){return new op(this,r,l,f,_)}clear({color:r,depth:l,stencil:f,colorMask:_}){const x=this.gl;let w=0;r&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),l!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),f!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(w)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bx(r.blendFunction,Dr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let tl;function Pd(d,r,l,f,_,x,w){const S=d.context,I=S.gl,R=d.transform,k=[o.aF(R.center.lng),o.aJ(R.center.lat)],z=l.layout.get("symbol-placement"),M=l.layout.get("text-variable-anchor"),B=l.layout.get("icon-rotation-alignment")==="map",j=l.layout.get("text-rotation-alignment")==="map",U=z!=="point",Z=[];let q=0,K=0;for(let ce=0;ce<f.length;ce++){const xe=f[ce],Me=r.getTile(xe),Ce=Me.getBucket(l);if(!Ce)continue;const We=Ce.getProjection().createInversionMatrix(R,xe.canonical),Ne=[],Qe=k0(xe,Ce,R),_t=!w&&B&&U,Fe=w&&j&&U,Ie=M&&Ce.hasTextData(),et=Ce.hasIconTextFit()&&Ie&&Ce.hasIconData(),je=_t||Fe||w&&Ie||et,ot=Ce.projection.name==="globe",wt=ot?o.aj(R.zoom):0;ot&&(Ne.push("PROJECTION_GLOBE_VIEW"),je&&Ne.push("PROJECTED_POS_ON_VIEWPORT"));const jt=d.getOrCreateProgram("collisionBox",{defines:Ne});let pt=Qe;_[0]===0&&_[1]===0||(pt=d.translatePosMatrix(Qe,Me,_,x));const vt=w?Ce.textCollisionBox:Ce.iconCollisionBox,$t=Ce.collisionCircleArray;if($t.length>0){const Rt=o.bB(),Dt=pt;o.cO(Rt,Ce.placementInvProjMatrix,R.glCoordMatrix),o.cO(Rt,Rt,Ce.placementViewportMatrix),Z.push({circleArray:$t,circleOffset:K,transform:Dt,invTransform:Rt,projection:Ce.getProjection()}),q+=$t.length/4,K=q}if(!vt)continue;d.terrain&&d.terrain.setupElevationDraw(Me,jt);const Ot=ot?[xe.canonical.x,xe.canonical.y,1<<xe.canonical.z]:[0,0,0];jt.draw(d,I.LINES,qt.disabled,Tr.disabled,d.colorModeForRenderPass(),_r.disabled,Fu(pt,We,R,wt,k,Me,Ot,Ce.getProjection()),l.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,null,R.zoom,null,[vt.collisionVertexBuffer,vt.collisionVertexBufferExt])}if(!w||!Z.length)return;const ne=d.getOrCreateProgram("collisionCircle"),ee=new o.dY;ee.resize(4*q),ee._trim();let ge=0;for(const ce of Z)for(let xe=0;xe<ce.circleArray.length/4;xe++){const Me=4*xe,Ce=ce.circleArray[Me+0],We=ce.circleArray[Me+1],Ne=ce.circleArray[Me+2],Qe=ce.circleArray[Me+3];ee.emplace(ge++,Ce,We,Ne,Qe,0),ee.emplace(ge++,Ce,We,Ne,Qe,1),ee.emplace(ge++,Ce,We,Ne,Qe,2),ee.emplace(ge++,Ce,We,Ne,Qe,3)}(!tl||tl.length<2*q)&&(tl=function(ce){const xe=2*ce,Me=new o.b0;Me.resize(xe),Me._trim();for(let Ce=0;Ce<xe;Ce++){const We=6*Ce;Me.uint16[We+0]=4*Ce+0,Me.uint16[We+1]=4*Ce+1,Me.uint16[We+2]=4*Ce+2,Me.uint16[We+3]=4*Ce+2,Me.uint16[We+4]=4*Ce+3,Me.uint16[We+5]=4*Ce+0}return Me}(q));const oe=S.createIndexBuffer(tl,!0),ve=S.createVertexBuffer(ee,o.dZ.members,!0);for(const ce of Z){const xe={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(pe=R).getCameraToCenterDistance(ce.projection),u_viewport_size:[pe.width,pe.height]};ne.draw(d,I.TRIANGLES,qt.disabled,Tr.disabled,d.colorModeForRenderPass(),_r.disabled,xe,l.id,ve,oe,o.bf.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,R.zoom)}var pe;ve.destroy(),oe.destroy()}const ic=o.bB();function qg(d){const r=d._camera.getWorldToCamera(d.worldSize,1),l=o.aB([],r,d.globeMatrix);o.bk(l,l);const f=[0,0,0],_=[0,1,0,0];return o.aC(_,_,l),f[0]=_[0],f[1]=_[1],f[2]=_[2],o.aw(f,f),f}function lp({width:d,height:r,anchor:l,textOffset:f,textScale:_},x){const{horizontalAlign:w,verticalAlign:S}=o.c0(l),I=-(w-.5)*d,R=-(S-.5)*r,k=o.c1(l,f);return new o.P((I/_+k[0])*x,(R/_+k[1])*x)}function cp(d,r,l,f,_,x,w,S,I,R){const k=d.text.placedSymbolArray,z=d.text.dynamicLayoutVertexArray,M=d.icon.dynamicLayoutVertexArray,B={},j=d.getProjection(),U=Pf(w,j,_),Z=_.elevation,q=j.upVectorScale(w.canonical,_.center.lat,_.worldSize).metersToTile;z.clear();for(let K=0;K<k.length;K++){const ne=k.get(K),{tileAnchorX:ee,tileAnchorY:ge,numGlyphs:oe}=ne,ve=ne.hidden||!ne.crossTileID||d.allowVerticalPlacement&&!ne.placedOrientation?null:f[ne.crossTileID];if(ve){let pe=0,ce=0,xe=0;const Me=d.elevationType==="road";if(Z||Me){const je=Me?d.getElevationFeatureForText(K):null,ot=o.bU.getAtTileOffset(w,new o.P(ee,ge),Z,je),[wt,jt,pt]=j.upVector(w.canonical,ee,ge);pe=ot*wt*q,ce=ot*jt*q,xe=ot*pt*q}let[Ce,We,Ne,Qe]=Wn(ne.projectedAnchorX+pe,ne.projectedAnchorY+ce,ne.projectedAnchorZ+xe,l?U:x);const _t=pg(_.getCameraToCenterDistance(j),Qe);let Fe=o.bL(d.textSizeData,I,ne)*_t/o.bX;l&&(Fe*=d.tilePixelRatio/S);const Ie=lp(ve,Fe);l?({x:Ce,y:We,z:Ne}=j.projectTilePoint(ee+Ie.x,ge+Ie.y,w.canonical),[Ce,We,Ne]=Wn(Ce+pe,We+ce,Ne+xe,x)):(r&&Ie._rotate(-_.angle),Ce+=Ie.x,We+=Ie.y,Ne=0);const et=d.allowVerticalPlacement&&ne.placedOrientation===o.bK.vertical?Math.PI/2:0;for(let je=0;je<oe;je++)o.bN(z,Ce,We,Ne,et);R&&ne.associatedIconIndex>=0&&(B[ne.associatedIconIndex]={x:Ce,y:We,z:Ne,angle:et})}else ml(oe,z)}if(R){M.clear();const K=d.icon.placedSymbolArray;for(let ne=0;ne<K.length;ne++){const ee=K.get(ne),{numGlyphs:ge}=ee,oe=B[ne];if(ee.hidden||!oe)ml(ge,M);else{const{x:ve,y:pe,z:ce,angle:xe}=oe;for(let Me=0;Me<ge;Me++)o.bN(M,ve,pe,ce,xe)}}d.icon.dynamicLayoutVertexBuffer.updateData(M)}d.text.dynamicLayoutVertexBuffer.updateData(z)}function Rd(d,r,l,f,_,x,w={}){const S=l.paint.get("icon-translate"),I=l.paint.get("text-translate"),R=l.paint.get("icon-translate-anchor"),k=l.paint.get("text-translate-anchor"),z=l.layout.get("icon-rotation-alignment"),M=l.layout.get("text-rotation-alignment"),B=l.layout.get("icon-pitch-alignment"),j=l.layout.get("text-pitch-alignment"),U=l.layout.get("icon-keep-upright"),Z=l.layout.get("text-keep-upright"),q=l.paint.get("icon-color-saturation"),K=l.paint.get("icon-color-contrast"),ne=l.paint.get("icon-color-brightness-min"),ee=l.paint.get("icon-color-brightness-max"),ge=l.layout.get("symbol-elevation-reference")==="sea",oe=l.layout.get("icon-image-use-theme")==="none",ve=d.context,pe=ve.gl,ce=d.transform,xe=z==="map",Me=M==="map",Ce=B==="map",We=j==="map",Ne=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Qe=!1;const _t=d.depthModeForSublayer(0,qt.ReadOnly),Fe=new qt(d.context.gl.LEQUAL,qt.ReadOnly,d.depthRangeFor3D),Ie=[o.aF(ce.center.lng),o.aJ(ce.center.lat)],et=l.layout.get("text-variable-anchor"),je=ce.projection.name==="globe",ot=[],wt=[0,-1,0];for(const jt of f){const pt=r.getTile(jt),vt=pt.getBucket(l);if(!vt||vt.projection.name==="mercator"&&je||vt.fullyClipped)continue;const $t=vt.projection.name==="globe",Ot=$t?o.aj(ce.zoom):0,Rt=Pf(jt,vt.getProjection(),ce),Dt=ce.calculatePixelsToTileUnitsMatrix(pt),lr=et&&vt.hasTextData(),Ur=vt.hasIconTextFit()&&lr&&vt.hasIconData(),Jr=vt.getProjection().createInversionMatrix(ce,jt.canonical),Ci=(1<<pt.tileID.canonical.z)*o.al/d.transform.worldSize,yr=gi=>{let xr=[0,0,0];if(gi){const ri=d.style.directionalLight,on=d.style.ambientLight;ri&&on&&(xr=fa(d.style,ri,on))}return xr},Kr=gi=>{ce.depthOcclusionForSymbolsAndCircles&&(l.hasOcclusionOpacityProperties||d.terrain)&&(gi.push("DEPTH_D24"),gi.push("DEPTH_OCCLUSION"))},kr=gi=>{l.lut&&!oe&&(l.lut.texture||(l.lut.texture=new o.d_(d.context,l.lut.image,[l.lut.image.height,l.lut.image.height,l.lut.image.height],ve.gl.RGBA8)),ve.activeTexture.set(ve.gl.TEXTURE0+_s.LUT),l.lut.texture&&l.lut.texture.bind(ve.gl.LINEAR,ve.gl.CLAMP_TO_EDGE),gi.push("APPLY_LUT_ON_GPU"))},Si=()=>{const gi=xe&&l.layout.get("symbol-placement")!=="point",xr=[];Kr(xr),kr(xr);const ri=gi||Ur,on=vt.elevationType==="road",En=d.shadowRenderer,un=on&&Ce&&!!En&&En.enabled,_n=yr(un),mo=on&&Ce&&!d.terrain?Fe:_t,no=l.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&Ce&&xr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(xr.push("PROJECTION_GLOBE_VIEW"),ri&&xr.push("PROJECTED_POS_ON_VIEWPORT")),no>0&&vt.hasAnySecondaryIcon&&xr.push("ICON_TRANSITION"),!vt.icon.zOffsetVertexBuffer||on&&d.terrain||xr.push("Z_OFFSET"),q===0&&K===0&&ne===0&&ee===1||xr.push("COLOR_ADJUSTMENT"),vt.sdfIcons&&xr.push("RENDER_SDF"),un&&xr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),on&&Ce&&!d.terrain&&vt.icon.orientationVertexBuffer&&xr.push("ELEVATED_ROADS");const Es=vt.icon.programConfigurations.get(l.id),Os=d.getOrCreateProgram("symbol",{config:Es,defines:xr}),Uo=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Is=vt.iconSizeData,$o=o.bJ(Is,ce.zoom),va=Ce||!ce.isOrthographic,ls=xu(Rt,pt.tileID.canonical,Ce,xe,ce,vt.getProjection(),Dt),dn=pl(Rt,pt.tileID.canonical,Ce,xe,ce,vt.getProjection(),Dt),In=d.translatePosMatrix(dn,pt,S,R,!0),Li=d.translatePosMatrix(Rt,pt,S,R),Rn=ri?ic:ls,cs=xe&&!Ce&&!gi;let fn=wt;!je&&!ce.mercatorFromTransition||xe||(fn=qg(ce));const Go=$t?fn:wt,Qu=l.getColorAdjustmentMatrix(q,K,ne,ee),El=Gg(Is.kind,$o,cs,Ce,d,Li,Rn,In,ge,!1,Uo,[0,0],0,jt,Ot,Ie,Jr,Go,vt.getProjection(),_n,Ci,Qu,no,null),eh=pt.imageAtlasTexture?pt.imageAtlasTexture:null,th=l.layout.get("icon-size").constantOr(0)!==1||vt.iconsNeedLinear,Ho=vt.sdfIcons||d.options.rotating||d.options.zooming||th||va?pe.LINEAR:pe.NEAREST,il=vt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,rs=d.terrain&&Ce&&gi?o.bk(o.bB(),ls):ic;if(gi&&vt.icon){const qo=o.bU.getAtTileOffsetFunc(jt,ce.center.lat,ce.worldSize,vt.getProjection()),Xc=cd(Rt,pt.tileID.canonical,Ce,xe,ce,vt.getProjection(),Dt),Ev=l.layout.get("icon-size-scale-range"),Rp=o.aA(d.scaleFactor,Ev[0],Ev[1]);gg(vt,Rt,d,!1,Xc,dn,Ce,U,qo,jt,Rp)}return{program:Os,buffers:vt.icon,uniformValues:El,atlasTexture:eh,atlasTextureIcon:null,atlasInterpolation:Ho,atlasInterpolationIcon:null,isSDF:vt.sdfIcons,hasHalo:il,depthMode:mo,tile:pt,renderWithShadows:un,labelPlaneMatrixInv:rs}},Qr=()=>{const gi=Me&&l.layout.get("symbol-placement")!=="point",xr=[],ri=gi||et||Ur,on=vt.elevationType==="road",En=d.shadowRenderer,un=on&&We&&!!En&&En.enabled,_n=yr(un),mo=on&&We&&!d.terrain?Fe:_t;d.terrainRenderModeElevated()&&We&&xr.push("PITCH_WITH_MAP_TERRAIN"),$t&&(xr.push("PROJECTION_GLOBE_VIEW"),ri&&xr.push("PROJECTED_POS_ON_VIEWPORT")),!vt.text.zOffsetVertexBuffer||on&&d.terrain||xr.push("Z_OFFSET"),vt.iconsInText&&xr.push("RENDER_TEXT_AND_SYMBOL"),xr.push("RENDER_SDF"),un&&xr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),on&&We&&!d.terrain&&vt.text.orientationVertexBuffer&&xr.push("ELEVATED_ROADS"),Kr(xr);const no=vt.text.programConfigurations.get(l.id),Es=d.getOrCreateProgram("symbol",{config:no,defines:xr});let Os,Uo=[0,0],Is=null;const $o=vt.textSizeData;vt.iconsInText&&(Uo=pt.imageAtlasTexture?pt.imageAtlasTexture.size:[0,0],Is=pt.imageAtlasTexture?pt.imageAtlasTexture:null,Os=We||!ce.isOrthographic||d.options.rotating||d.options.zooming||$o.kind==="composite"||$o.kind==="camera"?pe.LINEAR:pe.NEAREST);const va=pt.glyphAtlasTexture?pt.glyphAtlasTexture.size:[0,0],ls=l.layout.get("text-size-scale-range"),dn=o.aA(d.scaleFactor,ls[0],ls[1]),In=o.bJ($o,ce.zoom,dn),Li=xu(Rt,pt.tileID.canonical,We,Me,ce,vt.getProjection(),Dt),Rn=pl(Rt,pt.tileID.canonical,We,Me,ce,vt.getProjection(),Dt),cs=d.translatePosMatrix(Rn,pt,I,k,!0),fn=d.translatePosMatrix(Rt,pt,I,k),Go=ri?ic:Li,Qu=Me&&!We&&!gi;let El=wt;!je&&!ce.mercatorFromTransition||Me||(El=qg(ce));const eh=Gg($o.kind,In,Qu,We,d,fn,Go,cs,ge,!0,va,Uo,0,jt,Ot,Ie,Jr,$t?El:wt,vt.getProjection(),_n,Ci,null,null,dn),th=pt.glyphAtlasTexture?pt.glyphAtlasTexture:null,Ho=pe.LINEAR,il=l.paint.get("text-halo-width").constantOr(1)!==0,rs=d.terrain&&We&&gi?o.bk(o.bB(),Li):ic;if(gi&&vt.text){const qo=o.bU.getAtTileOffsetFunc(jt,ce.center.lat,ce.worldSize,vt.getProjection()),Xc=cd(Rt,pt.tileID.canonical,We,Me,ce,vt.getProjection(),Dt);gg(vt,Rt,d,!0,Xc,Rn,We,Z,qo,jt,dn)}return{program:Es,buffers:vt.text,uniformValues:eh,atlasTexture:th,atlasTextureIcon:Is,atlasInterpolation:Ho,atlasInterpolationIcon:Os,isSDF:!0,hasHalo:il,depthMode:mo,tile:pt,renderWithShadows:un,labelPlaneMatrixInv:rs}},Fi=vt.icon.segments.get().length,oi=vt.text.segments.get().length,Mr=Fi&&!w.onlyText?Si():null,pi=oi&&!w.onlyIcons?Qr():null,Lr=l.paint.get("icon-opacity").constantOr(1),$i=l.paint.get("text-opacity").constantOr(1);if(Ne&&vt.canOverlap){Qe=!0;const gi=Lr&&!w.onlyText?vt.icon.segments.get():[],xr=$i&&!w.onlyIcons?vt.text.segments.get():[];for(const ri of gi)ot.push({segments:new o.bf([ri]),sortKey:ri.sortKey,state:Mr});for(const ri of xr)ot.push({segments:new o.bf([ri]),sortKey:ri.sortKey,state:pi})}else w.onlyText||ot.push({segments:Lr?vt.icon.segments:new o.bf([]),sortKey:0,state:Mr}),w.onlyIcons||ot.push({segments:$i?vt.text.segments:new o.bf([]),sortKey:0,state:pi})}Qe&&ot.sort((jt,pt)=>jt.sortKey-pt.sortKey);for(const jt of ot){const pt=jt.state;if(pt)if(d.terrain?d.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:ce.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(ce.depthOcclusionForSymbolsAndCircles,pt.program),ve.activeTexture.set(pe.TEXTURE0),pt.atlasTexture&&pt.atlasTexture.bind(pt.atlasInterpolation,pe.CLAMP_TO_EDGE,!0),pt.atlasTextureIcon&&(ve.activeTexture.set(pe.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,pe.CLAMP_TO_EDGE,!0)),pt.renderWithShadows&&d.shadowRenderer.setupShadows(pt.tile.tileID.toUnwrapped(),pt.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,pt.program),pt.hasHalo){const vt=pt.uniformValues;vt.u_is_halo=1,up(pt.buffers,jt.segments,l,d,pt.program,pt.depthMode,_,x,vt,2),vt.u_is_halo=0}else{if(pt.isSDF){const vt=pt.uniformValues;pt.hasHalo&&(vt.u_is_halo=1,up(pt.buffers,jt.segments,l,d,pt.program,pt.depthMode,_,x,vt,1)),vt.u_is_halo=0}up(pt.buffers,jt.segments,l,d,pt.program,pt.depthMode,_,x,pt.uniformValues,1)}}}function up(d,r,l,f,_,x,w,S,I,R){const k=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];_.draw(f,f.context.gl.TRIANGLES,x,w,S,_r.disabled,I,l.id,d.layoutVertexBuffer,d.indexBuffer,r,l.paint,f.transform.zoom,d.programConfigurations.get(l.id),k,R)}function rv(d,r){const l=1<<d.canonical.z,f=(r.x*l-d.canonical.x-d.wrap*l)*o.al,_=(r.y*l-d.canonical.y)*o.al,x=o.e7(r.z,r.y);return o.d4(f,_,x)}function $c(d,r,l,f,_){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const x=d.context.gl,w=new qt(d.context.gl.LEQUAL,qt.ReadWrite,d.depthRangeFor3D),S=new qt(d.context.gl.GREATER,qt.ReadWrite,d.depthRangeFor3D),I=function(B){let j=.01;return B.isOrthographic&&(j=o.ak(1e-4,j,o.c$(B.pitch>=Fc?1:B.pitch/Fc))),2*j}(d.transform),R=d.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",z=d.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),M=d.getOrCreateProgram(k);for(const B of f){const j=r.getTile(B),U=j.getBucket(l);if(!U)continue;const Z=U.elevatedStructures;if(!Z)continue;const q=U.elevationBufferData.heightRange,K=rv(B.toUnwrapped(),R),ne=d.translatePosMatrix(B.projMatrix,j,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ee,ge,oe,ve;if(_==="initialize"){if(!q||q.min>=1||Z.depthSegments.segments[0].primitiveLength===0)continue;ee=Qf(ne,K,I,1,0),ge=w,oe=Z.depthSegments,ve=z}else if(_==="reset"){if(!q||q.min>=0||Z.maskSegments.segments[0].primitiveLength===0)continue;ee=Qf(ne,K,0,0,1),ge=S,oe=Z.maskSegments,ve=z}else if(_==="geometry"){if(Z.depthSegments.segments[0].primitiveLength===0)continue;ee=Qf(ne,K,I,1,0),ge=w,oe=Z.depthSegments,ve=M}ve.draw(d,x.TRIANGLES,ge,Tr.disabled,Dr.disabled,_r.disabled,ee,l.id,Z.vertexBuffer,Z.indexBuffer,oe,l.paint,d.transform.zoom)}}function Nu(d,r,l){const{painter:f,sourceCache:_,layer:x,coords:w,colorMode:S,elevationType:I,terrainEnabled:R,pass:k}=d,z=f.context.gl,M=x.paint.get("fill-pattern"),B=x.paint.get("fill-pattern-cross-fade"),j=M.constantOr(null);let U=I;I!=="road"||r&&!R||(U="none");const Z=U==="road",q=d.painter.shadowRenderer,K=Z&&!!q&&q.enabled,ne=new qt(f.context.gl.LEQUAL,qt.ReadOnly,f.depthRangeFor3D);let ee=[0,0,0];if(K){const ve=f.style.directionalLight,pe=f.style.ambientLight;ve&&pe&&(ee=fa(f.style,ve,pe))}const ge=M&&M.constantOr(1),oe=(ve,pe)=>{let ce,xe,Me,Ce,We;pe?(ce=ge&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Me=z.LINES):(ce=ge?"fillPattern":"fill",Me=z.TRIANGLES);for(const Ne of w){const Qe=_.getTile(Ne);if(ge&&!Qe.patternsLoaded())continue;const _t=Qe.getBucket(x);if(!_t)continue;const Fe=r?_t.elevationBufferData:_t.bufferData;if(Fe.isEmpty())continue;f.prepareDrawTile();const Ie=Fe.programConfigurations.get(x.id),et=f.isTileAffectedByFog(Ne),je=[],ot=[];Z&&(je.push("ELEVATED_ROADS"),ot.push(Fe.elevatedLayoutVertexBuffer)),K&&je.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ge&&(f.context.activeTexture.set(z.TEXTURE0),Qe.imageAtlasTexture&&Qe.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ie.updatePaintBuffers());let wt=!1;if(j&&Qe.imageAtlas){const Ot=Qe.imageAtlas,Rt=o.e2.from(j),Dt=Rt.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),lr=Rt.getSecondary(),Ur=Ot.patternPositions.get(Dt),Jr=lr?Ot.patternPositions.get(lr.scaleSelf(o.o.devicePixelRatio).toString()):null;wt=!!Ur&&!!Jr,Ur&&Ie.setConstantPatternPositions(Ur,Jr)}B>0&&(wt||Ie.getPatternTransitionVertexBuffer("fill-pattern"))&&je.push("FILL_PATTERN_TRANSITION");const jt=f.getOrCreateProgram(ce,{config:Ie,overrideFog:et,defines:je}),pt=f.translatePosMatrix(Ne.projMatrix,Qe,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));K&&q.setupShadows(Qe.tileID.toUnwrapped(),jt,"vector-tile");const vt=x.paint.get("fill-emissive-strength");if(pe){Ce=Fe.lineIndexBuffer,We=Fe.lineSegments;const Ot=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];xe=ce==="fillOutlinePattern"&&ge?mb(pt,vt,f,Qe,Ot,ee,B):pb(pt,vt,Ot,ee)}else Ce=Fe.indexBuffer,We=Fe.triangleSegments,xe=ge?Y0(pt,vt,f,Qe,ee,B):K0(pt,vt,ee);f.uploadCommonUniforms(f.context,jt,Ne.toUnwrapped());let $t=ve;(I==="road"&&!R||I==="offset")&&($t=ne),jt.draw(f,Me,$t,l||f.stencilModeForClipping(Ne),S,_r.disabled,xe,x.id,Fe.layoutVertexBuffer,Ce,We,x.paint,f.transform.zoom,Ie,ot)}};f.renderPass===k&&oe(f.depthModeForSublayer(1,f.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly),!1),U==="none"&&f.renderPass==="translucent"&&x.paint.get("fill-antialias")&&oe(f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly),!0)}function zt(d,r,l,f,_,x,w,S){l.resetLayerRenderingStats(d);const I=d.context,R=I.gl,k=d.transform,z=l.paint.get("fill-extrusion-pattern"),M=l.paint.get("fill-extrusion-pattern-cross-fade"),B=z.constantOr(null),j=z.constantOr(1),U=l.paint.get("fill-extrusion-opacity"),Z=d.style.enable3dLights(),q=l.paint.get(Z&&!j?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),K=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],ne=l.layout.get("fill-extrusion-edge-radius"),ee=ne>0&&!l.paint.get("fill-extrusion-rounded-roof"),ge=ee?0:ne,oe=k.projection.name==="globe"?o.ea():0,ve=k.projection.name==="globe",pe=ve?o.aj(k.zoom):0,ce=[o.aF(k.center.lng),o.aJ(k.center.lat)],xe=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(xe?null:l.lut).toArray01().slice(0,3),Ce=l.paint.get("fill-extrusion-flood-light-intensity"),We=l.paint.get("fill-extrusion-vertical-scale"),Ne=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Qe=l.paint.get("fill-extrusion-height-alignment"),_t=l.paint.get("fill-extrusion-base-alignment"),Fe=yl(d,l.paint.get("fill-extrusion-cutoff-fade-range")),Ie=[];let et;ve&&Ie.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&Ie.push("FAUX_AO"),ee&&Ie.push("ZERO_ROOF_RADIUS"),S&&Ie.push("HAS_CENTROID"),Ce>0&&Ie.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),Ne&&Ie.push("RENDER_WALL_MODE");const je=d.renderPass==="shadow",ot=d.shadowRenderer,wt=je&&!!ot,jt=je?_r.disabled:_r.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let pt=[0,0,0];if(ot){const Ot=d.style.directionalLight,Rt=d.style.ambientLight;Ot&&Rt&&(pt=fa(d.style,Ot,Rt)),je||(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ot.useNormalOffset&&Ie.push("NORMAL_OFFSET")),et=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}const vt=wt?"fillExtrusionDepth":j?"fillExtrusionPattern":"fillExtrusion",$t=l.getLayerRenderingStats();for(const Ot of f){const Rt=r.getTile(Ot),Dt=Rt.getBucket(l);if(!Dt||Dt.projection.name!==k.projection.name)continue;let lr=!1;ot&&(lr=ot.getMaxCascadeForTile(Ot.toUnwrapped())===0);const Ur=d.isTileAffectedByFog(Ot),Jr=Dt.programConfigurations.get(l.id);let Ci=!1;if(B&&Rt.imageAtlas){const oi=Rt.imageAtlas,Mr=o.e2.from(B),pi=Mr.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Lr=Mr.getSecondary(),$i=oi.patternPositions.get(pi),gi=Lr?oi.patternPositions.get(Lr.scaleSelf(o.o.devicePixelRatio).toString()):null;Ci=!!$i&&!!gi,$i&&Jr.setConstantPatternPositions($i,gi)}M>0&&(Ci||Jr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ie.push("FILL_EXTRUSION_PATTERN_TRANSITION");const yr=d.getOrCreateProgram(vt,{config:Jr,defines:lr?et:Ie,overrideFog:Ur});if(d.terrain&&d.terrain.setupElevationDraw(Rt,yr,{useMeterToDem:!0}),!Dt.centroidVertexBuffer){const oi=yr.getAttributeLocation(R,"a_centroid_pos");oi!==-1&&R.vertexAttrib2f(oi,0,0)}!je&&ot&&ot.setupShadows(Rt.tileID.toUnwrapped(),yr,"vector-tile"),j&&(d.context.activeTexture.set(R.TEXTURE0),Rt.imageAtlasTexture&&Rt.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Jr.updatePaintBuffers());const Kr=l.paint.get("fill-extrusion-vertical-gradient"),kr=1/Dt.tileToMeter;let Si;if(je&&ot){if(iv(Rt.tileID,Dt.maxHeight,d))continue;const oi=ot.calculateShadowPassMatrixFromTile(Rt.tileID.toUnwrapped());Si=Z0(oi,ge,kr,We,Qe,_t)}else{const oi=d.translatePosMatrix(Ot.expandedProjMatrix,Rt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Mr=k.projection.createInversionMatrix(k,Ot.canonical);Si=j?X0(oi,d,Kr,U,K,ge,kr,Ot,Rt,oe,Qe,_t,pe,ce,Mr,Me,We,M):Jf(oi,d,Kr,U,K,ge,kr,Ot,oe,Qe,_t,pe,ce,Mr,Me,We,Ce,pt)}d.uploadCommonUniforms(I,yr,Ot.toUnwrapped(),null,Fe);let Qr=Dt.segments;if(k.projection.name==="mercator"&&!je&&(Qr=Dt.getVisibleSegments(Rt.tileID,d.terrain,d.transform.getFrustum(0)),!Qr.get().length))continue;if($t)if(je)for(const oi of Qr.get())$t.numRenderedVerticesInShadowPass+=oi.primitiveLength;else for(const oi of Qr.get())$t.numRenderedVerticesInTransparentPass+=oi.primitiveLength;const Fi=[];(d.terrain||S)&&Fi.push(Dt.centroidVertexBuffer),ve&&Fi.push(Dt.layoutVertexExtBuffer),Ne&&Fi.push(Dt.wallVertexBuffer),yr.draw(d,I.gl.TRIANGLES,_,x,w,jt,Si,l.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Qr,l.paint,d.transform.zoom,Jr,Fi)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class Wg{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function xl(d,r,l,f,_,x,w,S,I,R,k,z,M,B,j,U,Z,q,K,ne){const ee=r.context,ge=ee.gl,oe=r.transform,ve=r.transform.zoom,pe=[],ce=d.translate,xe=d.translateAnchor,Me=d.edgeRadius,Ce=yl(r,d.cutoffFadeRange);k==="clear"?(pe.push("CLEAR_SUBPASS"),ne&&(pe.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(ge.TEXTURE0),ne.bind(ge.LINEAR,ge.CLAMP_TO_EDGE))):k==="sdf"&&pe.push("SDF_SUBPASS"),q&&pe.push("HAS_CENTROID"),Ce.shouldRenderCutoff&&pe.push("RENDER_CUTOFF");const We=(Ne,Qe,_t,Fe,Ie)=>{let et=pe;Qe.groundRadiusBuffer!=null&&(et=pe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const je=Qe.programConfigurations.get(f.id),ot=r.isTileAffectedByFog(Ne),wt=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:je,defines:et,overrideFog:ot}),jt=zu(r,Fe,z,R,Ie,[M,B*Ie],j,U,Z,ve>=17?0:Me*Ie,ne?ne.size[0]:0),pt=[];q&&pt.push(Qe.hiddenByLandmarkVertexBuffer),Qe.groundRadiusBuffer!=null&&pt.push(Qe.groundRadiusBuffer),r.uploadCommonUniforms(ee,wt,Ne.toUnwrapped(),null,Ce),wt.draw(r,ee.gl.TRIANGLES,x,w,S,I,jt,f.id,Qe.vertexBuffer,Qe.indexBuffer,_t,f.paint,ve,je,pt)};for(const Ne of _){const Qe=l.getTile(Ne),_t=Qe.getBucket(f);if(!_t||_t.projection.name!==oe.projection.name||!_t.groundEffect||_t.groundEffect&&!_t.groundEffect.hasData())continue;const Fe=_t.groundEffect,Ie=1/_t.tileToMeter;{const et=r.translatePosMatrix(Ne.projMatrix,Qe,ce,xe),je=Fe.getDefaultSegment();We(Ne,Fe,je,et,Ie)}if(K)for(let et=0;et<4;et++){const je=o.e8[et](Ne),ot=l.getTile(je);if(!ot)continue;const wt=ot.getBucket(f);if(!wt||wt.projection.name!==oe.projection.name||!wt.groundEffect||wt.groundEffect&&!wt.groundEffect.hasData())continue;const jt=wt.groundEffect;let pt,vt;et===0?(pt=[-o.al,0,0],vt=1):et===1?(pt=[o.al,0,0],vt=0):et===2?(pt=[0,-o.al,0],vt=3):(pt=[0,o.al,0],vt=2);const $t=jt.regionSegments[vt];if(!$t)continue;const Ot=new Float32Array(16);o.bq(Ot,Ne.projMatrix,pt),We(Ne,jt,$t,r.translatePosMatrix(Ot,Qe,ce,xe),Ie)}}}function nc(d,r,l,f,_,x,w){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const S=x?x.findDEMTileFor(l):null;if(!(S&&S.dem||w))return;x&&S&&S.dem&&f.selfDEMTileTimestamp!==S.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=S.dem._timestamp);const I=q=>new o.P(Math.ceil((q+o.ec)*o.ed),0),R=q=>{const K=r.getSource().minzoom,ne=ge=>{const oe=r.getTileByID(ge);if(oe&&oe.hasData())return oe.getBucket(_)},ee=[0,-1,1];for(const ge of ee){if(q.overscaledZ+ge<K)continue;const oe=ne(q.calculateScaledKey(q.overscaledZ+ge));if(oe)return oe}},k=[0,0,0],z=(q,K)=>(k[0]=Math.min(q.min.y,K.min.y),k[1]=Math.max(q.max.y,K.max.y),k[2]=o.al-K.min.x>q.max.x?K.min.x-o.al:q.max.x,k),M=(q,K)=>(k[0]=Math.min(q.min.x,K.min.x),k[1]=Math.max(q.max.x,K.max.x),k[2]=o.al-K.min.y>q.max.y?K.min.y-o.al:q.max.y,k),B=[(q,K)=>z(q,K),(q,K)=>z(K,q),(q,K)=>M(q,K),(q,K)=>M(K,q)],j=(q,K,ne,ee,ge,oe,ve)=>{if(!x)return 0;const pe=[[oe?ne:q,oe?q:ne,0],[oe?ne:K,oe?K:ne,0]],ce=ve<0?o.al+ve:ve,xe=[oe?ce:(q+K)/2,oe?(q+K)/2:ce,0];return ne===0&&ve<0||ne!==0&&ve>0?x.getForTilePoints(ge,[xe],!0,ee):pe.push(xe),x.getForTilePoints(l,pe,!0,S),Math.max(pe[0][2],pe[1][2],xe[2])/x.exaggeration()};for(let q=0;q<4;q++){const K=f.borderFeatureIndices[q];if(K.length===0)continue;const ne=o.e8[q](l),ee=R(ne);if(!(ee&&ee instanceof o.e9))continue;const ge=x?x.findDEMTileFor(ne):null;if(!(ge&&ge.dem||w)||(x&&ge&&ge.dem&&f.borderDEMTileTimestamp[q]!==ge.dem._timestamp&&(f.borderDoneWithNeighborZ[q]=-1,f.borderDEMTileTimestamp[q]=ge.dem._timestamp),f.borderDoneWithNeighborZ[q]===ee.canonical.z))continue;ee.centroidVertexArray.length===0&&ee.createCentroidsBuffer();const oe=(q<2?1:5)-q,ve=ee.borderDoneWithNeighborZ[oe]!==f.canonical.z,pe=ee.borderFeatureIndices[oe];let ce=0;if(f.canonical.z!==ee.canonical.z){for(const xe of K)f.showCentroid(f.featuresOnBorder[xe]);if(ve)for(const xe of pe)ee.showCentroid(ee.featuresOnBorder[xe]);f.borderDoneWithNeighborZ[q]=ee.canonical.z,ee.borderDoneWithNeighborZ[oe]=f.canonical.z}for(const xe of K){const Me=f.featuresOnBorder[xe],Ce=f.centroidData[Me.centroidDataIndex],We=Me.borders[q];let Ne;for(;ce<pe.length;){Ne=ee.featuresOnBorder[pe[ce]];const Qe=Ne.borders[oe];if(Qe[1]>We[0]+3||Qe[0]>We[0]-3)break;ee.showCentroid(Ne),ce++}if(Ne&&ce<pe.length){const Qe=ce;let _t=0;for(;!(Ne.borders[oe][0]>We[1]-3)&&(_t++,++ce!==pe.length);)Ne=ee.featuresOnBorder[pe[ce]];Ne=ee.featuresOnBorder[pe[Qe]];let Fe=!1;if(_t>=1){const je=Ne.borders[oe];Math.abs(We[0]-je[0])<3&&Math.abs(We[1]-je[1])<3&&(_t=1,Fe=!0,ce=Qe+1)}else if(_t===0){f.showCentroid(Me);continue}const Ie=ee.centroidData[Ne.centroidDataIndex];w&&Fe&&(((U=Ce).flags|(Z=Ie).flags)&o.eb?(U.flags|=o.eb,Z.flags|=o.eb):(U.flags&=~o.eb,Z.flags&=~o.eb));const et=Me.intersectsCount()>1||Ne.intersectsCount()>1;if(_t>1)ce=Qe,Ce.centroidXY=Ie.centroidXY=new o.P(0,0);else if(ge&&ge.dem&&!et){const je=B[q](Ce,Ie),ot=q%2?o.al-1:0,wt=j(je[0],Math.min(o.al-1,je[1]),ot,ge,ne,q<2,je[2]);Ce.centroidXY=Ie.centroidXY=I(wt)}else et?Ce.centroidXY=Ie.centroidXY=new o.P(0,0):(Ce.centroidXY=f.encodeBorderCentroid(Me),Ie.centroidXY=ee.encodeBorderCentroid(Ne));f.writeCentroidToBuffer(Ce),ee.writeCentroidToBuffer(Ie)}else f.showCentroid(Me)}f.borderDoneWithNeighborZ[q]=ee.canonical.z,ee.borderDoneWithNeighborZ[oe]=f.canonical.z}var U,Z;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const sc=[1,0,0],ar=[0,1,0],Zg=[0,0,1];function iv(d,r,l){const f=l.transform,_=l.shadowRenderer;if(!_)return!0;const x=d.toUnwrapped(),w=f.tileSize*_._cascades[l.currentShadowCascade].scale;let S=r;if(f.elevation){const U=f.elevation.getMinMaxForTile(d);U&&(S+=U.max)}const I=[..._.shadowDirection];I[2]=-I[2];const R=_.computeSimplifiedTileShadowVolume(x,S,w,I);if(!R)return!1;const k=[sc,ar,Zg,I,[I[0],0,I[2]],[0,I[1],I[2]]],z=f.projection.name==="globe",M=f.scaleZoom(w),B=o.cA.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,M,!z),j=_.getCurrentCascadeFrustum();return B.intersectsPrecise(R.vertices,R.planes,k)===0||j.intersectsPrecise(R.vertices,R.planes,k)===0}function hp(d){const{painter:r,source:l,layer:f,coords:_}=d;let x=d.defines;const w=r.context,S=r.renderPass==="shadow",I=r.renderPass==="light-beam",R=r.shadowRenderer,k=o.ee(r.transform.center.lat,r.transform.zoom),z=yl(r,f.paint.get("building-cutoff-fade-range"));z.shouldRenderCutoff&&(x=x.concat("RENDER_CUTOFF")),d.floodLightIntensity>0&&(x=x.concat("FLOOD_LIGHT"));for(const M of _){const B=l.getTile(M),j=B.getBucket(f);if(!j)continue;R&&R.getMaxCascadeForTile(M.toUnwrapped())===0&&(x=x.concat("SHADOWS_SINGLE_CASCADE"));const U=j.programConfigurations.get(f.id);let Z,q,K,ne=r.translatePosMatrix(M.expandedProjMatrix,B,[0,0],"map");if(ne=o.cR(o.bB(),ne,[1,1,d.verticalScale]),S&&R){if(iv(B.tileID,j.maxHeight*k,r))continue;let ge=R.calculateShadowPassMatrixFromTile(B.tileID.toUnwrapped());ge=o.cR(o.bB(),ge,[1,1,d.verticalScale]),K=J0(ge),Z=q=r.getOrCreateProgram("buildingDepth",{config:U,defines:x,overrideFog:!1})}else if(I)Z=q=r.getOrCreateProgram("buildingBloom",{config:U,defines:x,overrideFog:!1}),K=jg(ne);else{const ge=r.transform.calculatePosMatrix(M.toUnwrapped(),r.transform.worldSize);o.cR(ge,ge,[1,1,d.verticalScale]);const oe=o.bB();o.cR(oe,ge,[1,-1,1/k]),o.bk(oe,oe),o.ef(oe,oe);const ve=r.transform.getFreeCameraOptions().position,pe=1<<M.canonical.z;if(K=Ng(ne,oe,d.opacity,d.facadeAOIntensity,[((ve.x-M.wrap)*pe-M.canonical.x)*o.al,(ve.y*pe-M.canonical.y)*o.al,ve.z*pe*o.al],j.tileToMeter,d.facadeEmissiveChance,d.floodLightColor,d.floodLightIntensity),q=r.getOrCreateProgram("building",{config:U,defines:x,overrideFog:!1}),d.depthOnly===!0)Z=q;else{const ce=x.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);Z=r.getOrCreateProgram("building",{config:U,defines:ce,overrideFog:!1})}R&&(R.setupShadowsFromMatrix(ge,q,!0),Z!==q&&R.setupShadowsFromMatrix(ge,Z,!0))}const ee=(ge,oe)=>{if(I){const ve=ge.entranceBloom;oe.draw(r,w.gl.TRIANGLES,d.depthMode,Tr.disabled,d.blendMode,_r.disabled,K,f.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segmentsBucket,f.paint,r.transform.zoom,U,[ve.layoutAttenuationBuffer,ve.layoutColorBuffer])}else{const ve=ge.segmentsBucket;let pe=[ge.layoutNormalBuffer,ge.layoutCentroidBuffer,ge.layoutColorBuffer,ge.layoutFloodLightDataBuffer];ge.layoutFacadePaintBuffer&&(pe=pe.concat([ge.layoutFacadeDataBuffer,ge.layoutFacadeVerticalRangeBuffer,ge.layoutFacadePaintBuffer])),oe.draw(r,w.gl.TRIANGLES,d.depthMode,Tr.disabled,d.blendMode,S?_r.disabled:_r.backCW,K,f.id,ge.layoutVertexBuffer,ge.indexBuffer,ve,f.paint,r.transform.zoom,U,pe)}};r.uploadCommonUniforms(w,q,M.toUnwrapped(),null,z),j.buildingWithoutFacade&&ee(j.buildingWithoutFacade,q),j.buildingWithFacade&&(Z!==q&&r.uploadCommonUniforms(w,Z,M.toUnwrapped(),null,z),ee(j.buildingWithFacade,Z))}}function dp(d,r,l,f,_,x,w,S,I,R,k,z,M){const B=d.context.gl,j=d.depthModeForSublayer(1,qt.ReadOnly,B.LEQUAL,!0),U=.1*(1-(Z=k))+3*Z;var Z;const q=d._showOverdrawInspector,K=z,ne=new Wg;q||xl(ne,d,r,l,f,j,new Tr({func:B.ALWAYS,mask:255},255,255,B.KEEP,B.KEEP,B.REPLACE),new Dr([B.ONE,B.ONE,B.ONE,B.ONE],o.ao.transparent,[!1,!1,!1,!0],B.MIN),_r.disabled,_,"sdf",x,w,S,I,R,U,K,!1);{const ee=q?Tr.disabled:new Tr({func:B.EQUAL,mask:255},255,255,B.KEEP,B.DECR,B.DECR),ge=q?d.colorModeForRenderPass():new Dr([B.ONE_MINUS_DST_ALPHA,B.DST_ALPHA,B.ONE,B.ONE],o.ao.transparent,[!0,!0,!0,!0]);xl(ne,d,r,l,f,j,ee,ge,_r.disabled,_,"color",x,w,S,I,R,U,K,!1)}}function Xg(d){return[d[0]*o.eg,d[1]*o.eg,d[2]*o.eg,0]}function Kg(d,r,l,f,_,x,w,S,I){const R=f.getSource(),k=l.globeSharedBuffers;if(!k)return;let z,M,B;if(r&&(z=f.getTile(r)),R instanceof o.aT?(M=R.texture,B=o.dJ(0,0,l.transform)):z&&r&&(M=z.texture,B=o.dJ(r.canonical.z,r.canonical.x,l.transform)),!M||!B)return;d||(B=o.cR(o.bB(),B,[1,-1,1]));const j=l.context,U=j.gl,Z=_.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,q=l.colorModeForDrapableLayerRenderPass(x),K=w.defines;K.push("GLOBE_POLES");const ne=new qt(U.LEQUAL,qt.ReadWrite,l.depthRangeFor3D),ee=Float32Array.from(l.transform.expandedFarZProjMatrix),ge=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),M.bind(Z,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),M.bind(Z,U.CLAMP_TO_EDGE),"useMipmap"in M&&j.extTextureFilterAnisotropic&&l.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const[oe,ve,pe,ce]=r?k.getPoleBuffers(r.canonical.z,!1):k.getPoleBuffers(0,!0),xe=_.paint.get("raster-elevation");let Me;d?(Me=oe,l.renderDefaultNorthPole=xe!==0):(Me=ve,l.renderDefaultSouthPole=xe!==0);const Ce=Xg(w.mix),We=((Qe,_t,Fe,Ie,et,je,ot,wt,jt,pt,vt,$t,Ot)=>Cd(Qe,_t,Fe,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],wt,2,pt,vt,$t,1,0,Ot))(ee,ge,B,o.aj(l.transform.zoom),0,_,0,xe,0,Ce,w.offset,w.range,x),Ne=l.getOrCreateProgram("raster",{defines:K});l.uploadCommonUniforms(j,Ne,null),Ne.draw(l,U.TRIANGLES,ne,I,q,S,We,_.id,Me,pe,ce)}function nv(d){const r=d._nearZ,l=d.projection.farthestPixelDistance(d),f=l-r,_=.2*d.height,x=r+_;return[r,l,(x-_-r)/f,(x-r)/f]}function vb(d,r,l,f){if(d)return r instanceof es&&d instanceof Yl?r.getTextureDescriptor(d,l,!0):{texture:d.texture,mix:Xg(f.mix),offset:f.offset,buffer:0,tileSize:1}}var xb=o.eh([{name:"a_index",type:"Int16",components:1}]);class To{constructor(r,l,f,_){const x={width:f[0],height:f[1],data:null},w=r.gl;this.targetColorTexture=new o.T(r,x,w.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,x,w.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(l,_),this.lastInvalidatedAt=0}updateParticleTexture(r,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,_=l.width*l.height;this.particleTexture0=new o.T(this.context,l,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,f.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.ei;x.reserve(_);for(let w=0;w<_;w++)x.emplaceBack(w);this.particleIndexBuffer=this.context.createVertexBuffer(x,xb.members,!0),this.particleSegment=o.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Yg(d,r,l){if(!d)return null;const f=r.getTextureDescriptor(d,l,!0);if(!f)return null;let{texture:_,mix:x,offset:w,tileSize:S,buffer:I,format:R}=f;if(!_||!R)return null;let k=!1;return R==="uint32"&&(k=!0,x[3]=0,x=ep(o.ej,x,[0,l.paint.get("raster-particle-max-speed")]),w=vl(o.ej,w,[0,l.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[I/(S+2*I),S/(S+2*I)],tileSize:S,scalarData:k,scale:x,offset:w,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[R]]}}function io(d){const r=d._nearZ,l=d.projection.farthestPixelDistance(d),f=l-r,_=.2*d.height,x=r+_;return[r,l,(x-_-r)/f,(x-r)/f]}const oc=new o.ao(1,0,0,1),sv=new o.ao(0,1,0,1),Jg=new o.ao(0,0,1,1),Qg=new o.ao(1,0,1,1),e_=new o.ao(0,1,1,1);function t_(d,r,l,f,_,x){for(let w=0;w<l.length;w++)if(_){const R=new o.ao(f.r*.8,f.g*.8,f.b*.8,1);So(d,r,l[w],f,-1,-1,x),So(d,r,l[w],f,-1,1,x),So(d,r,l[w],f,1,1,x),So(d,r,l[w],f,1,-1,x),So(d,r,l[w],R,0,0,x)}else So(d,r,l[w],f,0,0,x)}function So(d,r,l,f,_,x,w){const S=d.context,I=d.transform,R=S.gl,k=I.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:[];let M=o.by(l.projMatrix);if(k&&o.aj(I.zoom)>0){const Ce=o.bi(l.canonical,I),We=o.ek(Ce);M=o.aB(new Float32Array(16),I.globeMatrix,We),o.aB(M,I.projMatrix,M)}const B=o.bB();B[12]+=2*_/(o.o.devicePixelRatio*I.width),B[13]+=2*x/(o.o.devicePixelRatio*I.height),o.aB(M,B,M);const j=d.getOrCreateProgram("debug",{defines:z}),U=r.getTileByID(l.key);d.terrain&&d.terrain.setupElevationDraw(U,j);const Z=qt.disabled,q=Tr.disabled,K=d.colorModeForRenderPass(),ne="$debug";S.activeTexture.set(R.TEXTURE0),d.emptyTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),k?U._makeGlobeTileDebugBuffers(d.context,I):U._makeDebugTileBoundsBuffers(d.context,I.projection);const ee=U._tileDebugBuffer||d.debugBuffer,ge=U._tileDebugIndexBuffer||d.debugIndexBuffer,oe=U._tileDebugSegments||d.debugSegments;if(j.draw(d,R.LINE_STRIP,Z,q,K,_r.disabled,Vg(M,f.toPremultipliedRenderColor(null)),ne,ee,ge,oe,null,null,null,[U._globeTileDebugBorderBuffer]),w){const Ce=U.latestRawTileData,We=Math.floor((Ce&&Ce.byteLength||0)/1024);let Ne=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ne+=` => ${l.overscaledZ}`),Ne+=` ${U.state}`,Ne+=` ${We}kb`,function(Qe,_t){Qe.initDebugOverlayCanvas();const Fe=Qe.debugOverlayCanvas,Ie=Qe.context.gl,et=Qe.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,Fe.width,Fe.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(_t,5,5),et.strokeText(_t,5,5),Qe.debugOverlayTexture.update(Fe),Qe.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(d,Ne)}const ve=r.getTile(l).tileSize,pe=512/Math.min(ve,512)*(l.overscaledZ/I.zoom)*.5,ce=U._tileDebugTextBuffer||d.debugBuffer,xe=U._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Me=U._tileDebugTextSegments||d.debugSegments;j.draw(d,R.TRIANGLES,Z,q,Dr.alphaBlended,_r.disabled,Vg(M,o.ao.transparent.toPremultipliedRenderColor(null),pe),ne,ce,xe,Me,null,null,null,[U._globeTileDebugTextBuffer])}function Ui(d,r,l,f){ju(d,0,r+l/2,d.transform.width,l,f)}function kd(d,r,l,f){ju(d,r-l/2,0,l,d.transform.height,f)}function ju(d,r,l,f,_,x){const w=d.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(r*o.o.devicePixelRatio,l*o.o.devicePixelRatio,f*o.o.devicePixelRatio,_*o.o.devicePixelRatio),w.clear({color:x}),S.disable(S.SCISSOR_TEST)}const ov=o.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:av}=ov;function wl(d,r,l,f){d.emplaceBack(r,l,f)}class r_{constructor(r){this.vertexArray=new o.el,this.indices=new o.b0,wl(this.vertexArray,-1,-1,1),wl(this.vertexArray,1,-1,1),wl(this.vertexArray,-1,1,1),wl(this.vertexArray,1,1,1),wl(this.vertexArray,-1,-1,-1),wl(this.vertexArray,1,-1,-1),wl(this.vertexArray,-1,1,-1),wl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,av),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bf.simpleSegment(0,0,36,12)}}function ga(d,r,l,f,_,x){const w=d.context.gl,S=r.paint.get("sky-atmosphere-color"),I=r.paint.get("sky-atmosphere-halo-color"),R=r.paint.get("sky-atmosphere-sun-intensity"),k=((z,M,B,j,U)=>({u_matrix_3f:z,u_sun_direction:M,u_sun_intensity:B,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.en(o.dN(),f),_,R,S.toPremultipliedRenderColor(null),I.toPremultipliedRenderColor(null));w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,r.skyboxTexture,0),l.draw(d,w.TRIANGLES,qt.disabled,Tr.disabled,Dr.unblended,_r.frontCW,k,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Gc=o.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class ft{constructor(r){const l=new o.eo;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const f=new o.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,Gc.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=o.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Pt=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Vu{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class gn{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Dr([1,Pn,1,Pn],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dr([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new Vu,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const l=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new ft(l);const f=this.params.sizeRange,_=this.params.intensityRange,x=function(k){const z=o.eq(30),M=[];for(let B=0;B<k;++B){const j=2*Math.PI*z(),U=Math.acos(1-2*z())-.5*Math.PI;M.push(o.d4(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return M}(this.params.starsCount),w=o.eq(300),S=new o.ep,I=new o.b0;let R=0;for(let k=0;k<x.length;++k){const z=o.c4([],x[k],200),M=Math.max(0,1+.01*f*(1*w()-.5)),B=Math.max(0,1+.01*_*(1*w()-.5));S.emplaceBack(z[0],z[1],z[2],-1,-1,M,B),S.emplaceBack(z[0],z[1],z[2],1,-1,M,B),S.emplaceBack(z[0],z[1],z[2],1,1,M,B),S.emplaceBack(z[0],z[1],z[2],-1,1,M,B),I.emplaceBack(R+0,R+1,R+2),I.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=l.createVertexBuffer(S,Pt.members),this.starsIdx=l.createIndexBuffer(I),this.starsSegments=o.bf.simpleSegment(0,0,S.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,l){const f=r.context,_=f.gl,x=r.transform,w=new qt(_.LEQUAL,qt.ReadOnly,[0,1]),S=o.aj(x.zoom),I=r.style.getLut(l.scope),R=l.properties.get("color-use-theme")==="none",k=l.properties.get("color").toNonPremultipliedRenderColor(R?null:I),z=l.properties.get("high-color-use-theme")==="none",M=l.properties.get("high-color").toNonPremultipliedRenderColor(z?null:I),B=l.properties.get("space-color-use-theme")==="none",j=l.properties.get("space-color").toNonPremultipliedRenderColor(B?null:I),U=5e-4,Z=o.er(l.properties.get("horizon-blend"),0,1,U,.25),q=o.dD(r,f,x)&&Z===U?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,K=r.frameCounter/1e3%1,ne=o.ag(x.globeCenterInViewSpace),ee=Math.sqrt(Math.pow(ne,2)-Math.pow(q,2)),ge=Math.acos(ee/ne),oe=ve=>{const pe=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ve&&pe.push("ALPHA_PASS");const ce=r.getOrCreateProgram("globeAtmosphere",{defines:pe}),xe=((Ce,We,Ne,Qe,_t,Fe,Ie,et,je,ot,wt,jt)=>({u_frustum_tl:Ce,u_frustum_tr:We,u_frustum_br:Ne,u_frustum_bl:Qe,u_horizon:_t,u_transition:Fe,u_fadeout_range:Ie,u_atmosphere_fog_color:et.toArray01(),u_high_color:je.toArray01(),u_space_color:ot.toArray01(),u_temporal_offset:wt,u_horizon_angle:jt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,S,Z,k,M,j,K,ge);r.uploadCommonUniforms(f,ce);const Me=this.atmosphereBuffer;Me&&ce.draw(r,_.TRIANGLES,w,Tr.disabled,ve?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,_r.backCW,xe,ve?"atmosphere_glow_alpha":"atmosphere_glow",Me.vertexBuffer,Me.indexBuffer,Me.segments)};oe(!1),oe(!0)}drawStars(r,l){const f=o.aA(l.properties.get("star-intensity"),0,1);if(f===0)return;const _=r.context,x=_.gl,w=r.transform,S=r.getOrCreateProgram("stars"),I=o.c6([]);o.c8(I,I,-w._pitch),o.c7(I,I,-w.angle),o.c8(I,I,o.an(w._center.lat)),o.es(I,I,-o.an(w._center.lng));const R=o.cb(new Float32Array(16),I),k=o.aB([],w.starsProjMatrix,R),z=o.en([],R),M=o.et([],z),B=[0,1,0];o.dP(B,B,M),o.c4(B,B,this.params.sizeMultiplier);const j=[1,0,0];o.dP(j,j,M),o.c4(j,j,this.params.sizeMultiplier);const U=(Z=B,q=j,K=f,{u_matrix:Float32Array.from(k),u_up:Z,u_right:q,u_intensity_multiplier:K});var Z,q,K;r.uploadCommonUniforms(_,S),this.starsVx&&this.starsIdx&&S.draw(r,x.TRIANGLES,qt.disabled,Tr.disabled,this.colorModeAlphaBlendedWriteRGB,_r.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Le{constructor(){this.visibleTiles=[]}updateBorders(r,l){const f=[],_=[],x=r._getRenderableCoordinates(!1,!0);for(const I of x){const R=r.getTile(I);if(!R.hasData())continue;const k=R.getBucket(l);k&&(k.isEmpty()||(f.push(I.key),_.push({bucket:k,tileID:I.canonical})))}let w=f.length!==this.visibleTiles.length;if(!w){f.sort();for(let I=0;I<f.length;I++)if(f[I]!==this.visibleTiles[I]){w=!0;break}}if(!w)return;const S=new Set;this.visibleTiles=f,_.sort((I,R)=>I.tileID.z-R.tileID.z||I.tileID.x-R.tileID.x||I.tileID.y-R.tileID.y);for(const I of _){const R=new Array,k=new Array,z=I.bucket;for(const M of z.featuresOnBorder)S.has(M.featureId)?k.push(M.footprintIndex):(S.add(M.featureId),R.push(M.footprintIndex));z.updateFootprintHiddenFlags(R,o.eu,!1),z.updateFootprintHiddenFlags(k,o.eu,!0)}}}function i_(d,r){const l=[...d],f=r.cameraWorldSizeForFog/r.worldSize,_=o.bz([]);return o.cR(_,_,[f,f,1]),o.aB(l,_,l),o.aB(l,r.worldToFogMatrix,l),l}function Uu(d,r,l,f,_){const x=l.material,w=f.context,{baseColorTexture:S,metallicRoughnessTexture:I}=x.pbrMetallicRoughness,{normalTexture:R,occlusionTexture:k,emissionTexture:z}=x;function M(j,U,Z){if(j&&(d.push(U),w.activeTexture.set(w.gl.TEXTURE0+Z),j.gfxTexture)){const{minFilter:q,magFilter:K,wrapS:ne,wrapT:ee}=j.sampler;j.gfxTexture.bindExtraParam(q,K,ne,ee)}}M(S,"HAS_TEXTURE_u_baseColorTexture",_s.BaseColor),M(I,"HAS_TEXTURE_u_metallicRoughnessTexture",_s.MetallicRoughness),M(R,"HAS_TEXTURE_u_normalTexture",_s.Normal),M(k,"HAS_TEXTURE_u_occlusionTexture",_s.Occlusion),M(z,"HAS_TEXTURE_u_emissionTexture",_s.Emission),_&&(_.texture||(_.texture=new o.d_(f.context,_.image,[_.image.height,_.image.height,_.image.height],w.gl.RGBA8)),w.activeTexture.set(w.gl.TEXTURE0+_s.LUT),_.texture&&_.texture.bind(w.gl.LINEAR,w.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(l.texcoordBuffer)),l.colorBuffer&&(d.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(l.colorBuffer)),l.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(l.normalBuffer)),l.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(l.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED");const B=f.shadowRenderer;B&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&d.push("NORMAL_OFFSET"))}function $u(d,r,l,f,_,x){const w=l.paint.get("model-opacity").constantOr(1),S=r.context,I=new qt(r.context.gl.LEQUAL,d.isLightMesh?qt.ReadOnly:qt.ReadWrite,r.depthRangeFor3D),R=r.transform,k=d.mesh,z=k.material,M=z.pbrMetallicRoughness,B=r.style.fog;let j;j=r.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:o.aB([],f.zScaleMatrix,d.nodeModelMatrix),o.aB(j,f.negCameraPosMatrix,j);const U=o.bk([],j);o.ef(U,U);const Z=l.paint.get("model-color-use-theme").constantOr("default")==="none",q=l.paint.get("model-emissive-strength").constantOr(0),K=sp(new Float32Array(d.worldViewProjection),new Float32Array(j),new Float32Array(U),null,r,w,M.baseColorFactor,z.emissiveFactor,M.metallicFactor,M.roughnessFactor,z,q,l,void 0,void 0,d.materialOverride,d.modelColor),ne={defines:[]},ee=[],ge=r.shadowRenderer;ge&&(ge.useNormalOffset=!1),Uu(ne.defines,ee,k,r,Z?null:l.lut);let oe=null;if(B){const ce=i_(d.nodeModelMatrix,r.transform);if(oe=new Float32Array(ce),R.projection.name!=="globe"){const xe=k.aabb.min,Me=k.aabb.max,[Ce,We]=B.getOpacityForBounds(ce,xe[0],xe[1],Me[0],Me[1]);ne.overrideFog=Ce>=Ue||We>=Ue}}const ve=yl(r,l.paint.get("model-cutoff-fade-range"));ve.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");const pe=r.getOrCreateProgram("model",ne);r.uploadCommonUniforms(S,pe,null,oe,ve),r.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(d.nodeModelMatrix,pe),pe.draw(r,S.gl.TRIANGLES,I,_,x,k.material.doubleSided?_r.disabled:_r.backCCW,K,l.id,k.vertexBuffer,k.indexBuffer,k.segments,l.paint,r.transform.zoom,void 0,ee)}function fp(d,r,l){return d.type==="vector"?r.scope:l?"basemap":""}function pp(d,r,l,f,_,x,w,S,I){const R=d.transform,k=!!r.isGeometryBloom&&r.isGeometryBloom;if(k&&d.renderPass==="shadow")return;const z=R.projection.name==="globe"?o.eC(l,R):[...l];o.aB(z,z,r.globalMatrix);const M=o.aB([],f,z);if(r.meshes)for(const B of r.meshes){const j=S.get(B.material.name);if(j&&j.opacity<=0)continue;if(B.material.alphaMode!=="BLEND"){w.push({mesh:B,depth:0,modelIndex:_,worldViewProjection:M,nodeModelMatrix:z,isLightMesh:k,materialOverride:j,modelColor:I});continue}const U=o.af([],B.centroid,M);!R.isOrthographic&&U[2]<=0||x.push({mesh:B,depth:U[2],modelIndex:_,worldViewProjection:M,nodeModelMatrix:z,isLightMesh:k,materialOverride:j,modelColor:I})}if(r.children)for(const B of r.children)pp(d,B,l,f,_,x,w,S,I)}function Gu(d,r,l,f){const _=l.shadowRenderer;if(!_)return;const x=_.getShadowPassDepthMode(),w=_.getShadowPassColorMode(),S=_.calculateShadowPassMatrixFromMatrix(r),I=Bu(S);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,x,Tr.disabled,w,_r.disabled,I,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,l.transform.zoom,void 0,void 0)}function Hu(d,r,l,f,_,x){for(const w of _){const S=Object.assign({},f);S.part=w;const I={type:"Unknown",id:r,properties:S},R={orientation:d.paint.get("model-rotation").evaluate(I,l)};x.set(w,R)}}function wb(d,r,l,f,_,x){for(const w of _){const S=Object.assign({},f);S.part=w;const I={type:"Unknown",id:r,properties:S},R={color:d.paint.get("model-color").evaluate(I,l),colorMix:d.paint.get("model-color-mix-intensity").evaluate(I,l),opacity:d.paint.get("model-opacity").evaluate(I,l),emissionStrength:d.paint.get("model-emissive-strength").evaluate(I,l)};x.set(w,R)}}function lv(d,r,l,f,_,x){if(l===1)for(const S of _)$u(S,d,r,x[S.modelIndex],Tr.disabled,d.colorModeForRenderPass());else{for(const S of _)$u(S,d,r,x[S.modelIndex],Tr.disabled,Dr.disabled);for(const S of _)$u(S,d,r,x[S.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}const w=Dr.additive;for(const S of f)$u(S,d,r,x[S.modelIndex],Tr.disabled,S.isLightMesh?w:d.colorModeForRenderPass())}function cv(d,r,l){const f=r.updateZoomBasedPaintProperties(),_=function(x,w,S){let I,R,k,z=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&z>0){const M=x.terrain,B=M.findDEMTileFor(S);B&&B.dem?I=o.eE.create(M,S,B):z=0}if(z===0&&(w.terrainElevationMin=0,w.terrainElevationMax=0),z===w.validForExaggeration&&(z===0||I&&I._demTile&&I._demTile.tileID===w.validForDEMTile.id&&I._dem._timestamp===w.validForDEMTile.timestamp))return!1;for(const M in w.instancesPerModel){const B=w.instancesPerModel[M];for(let j=0;j<B.instancedDataArray.length;++j){const U=(I?z*I.getElevationAt(0|B.instancedDataArray.float32[16*j],0|B.instancedDataArray.float32[16*j+1],!0,!0):0)+B.instancesEvaluatedElevation[j];B.instancedDataArray.float32[16*j+6]=U,R=R?Math.min(w.terrainElevationMin,U):U,k=k?Math.max(w.terrainElevationMax,U):U}}return w.terrainElevationMin=R||0,w.terrainElevationMax=k||0,w.validForExaggeration=z,w.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,r,l);(f||_)&&(r.uploaded=!1,r.upload(d.context))}const jo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d8([0,0,0],[o.al,o.al,0])};function n_(d,r){const l=1<<d.canonical.z,f=r.getFreeCameraOptions().position,_=r.elevation,x=d.canonical.x/l,w=(d.canonical.x+1)/l,S=d.canonical.y/l,I=(d.canonical.y+1)/l;let R=r._centerAltitude;if(_){const B=_.getMinMaxForTile(d);B&&B.max>R&&(R=B.max)}const k=o.aA(f.x,x,w)-f.x,z=o.aA(f.y,S,I)-f.y,M=o.ce(R,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(k*k+z*z+M*M))}function s_(d,r,l,f,_,x,w){const S=d.context,I=d.renderPass==="shadow",R=d.shadowRenderer,k=I&&R?R.getShadowPassDepthMode():new qt(S.gl.LEQUAL,qt.ReadWrite,d.depthRangeFor3D),z=d.isTileAffectedByFog(x),M=d.transform.projection.name==="globe";if(l.meshes)for(const B of l.meshes){const j=M?[]:["MODEL_POSITION_ON_GPU"],U=[];let Z,q,K;const ne=!M&&f.instancedDataArray.length>20;ne&&j.push("INSTANCED_ARRAYS");const ee=yl(d,r.paint.get("model-cutoff-fade-range"));if(ee.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),I&&R)Z=d.getOrCreateProgram("modelDepth",{defines:j}),q=Bu(w.shadowTileMatrix,w.shadowTileMatrix,Float32Array.from(l.globalMatrix)),K=R.getShadowPassColorMode();else{Uu(j,U,B,d,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),Z=d.getOrCreateProgram("model",{defines:j,overrideFog:z});const oe=B.material,ve=oe.pbrMetallicRoughness,pe=r.paint.get("model-opacity").constantOr(1),ce=r.paint.get("model-emissive-strength").constantOr(0);q=sp(x.expandedProjMatrix,Float32Array.from(l.globalMatrix),new Float32Array(16),null,d,pe,ve.baseColorFactor,oe.emissiveFactor,ve.metallicFactor,ve.roughnessFactor,oe,ce,r,_),R&&(w.shadowUniformsInitialized?Z.setShadowUniformValues(S,R.getShadowUniformValues()):(R.setupShadows(x.toUnwrapped(),Z,"model-tile"),w.shadowUniformsInitialized=!0)),K=ee.shouldRenderCutoff||pe<1||oe.alphaMode!=="OPAQUE"?Dr.alphaBlended:Dr.unblended}d.uploadCommonUniforms(S,Z,x.toUnwrapped(),null,ee);const ge=B.material.doubleSided?_r.disabled:_r.backCCW;if(ne)U.push(f.instancedDataBuffer),Z.draw(d,S.gl.TRIANGLES,k,Tr.disabled,K,ge,q,r.id,B.vertexBuffer,B.indexBuffer,B.segments,r.paint,d.transform.zoom,void 0,U,f.instancedDataArray.length);else{const oe=I?"u_instance":"u_normal_matrix";for(let ve=0;ve<f.instancedDataArray.length;++ve)q[oe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*ve,16),Z.draw(d,S.gl.TRIANGLES,k,Tr.disabled,K,ge,q,r.id,B.vertexBuffer,B.indexBuffer,B.segments,r.paint,d.transform.zoom,void 0,U)}}if(l.children)for(const B of l.children)s_(d,r,B,f,_,x,w)}const uv=[1,-1,1];function mp(d,r,l,f){if(!l.modelManager)return!0;const _=l.modelManager;if(!l.shadowRenderer)return!0;const x=l.shadowRenderer,w=r.aabb;let S=!0,I=d.maxHeight;if(I===0){let k=0;for(const z in d.instancesPerModel){const M=_.getModel(z,f);M?k=Math.max(k,Math.max(Math.max(M.aabb.max[0],M.aabb.max[1]),M.aabb.max[2])):S=!1}I=d.maxScale*k*1.41+d.maxVerticalOffset,S&&(d.maxHeight=I)}w.max[2]=I,w.min[2]+=d.terrainElevationMin,w.max[2]+=d.terrainElevationMax,o.af(w.min,w.min,r.tileMatrix),o.af(w.max,w.max,r.tileMatrix);const R=w.intersects(x.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=R===2),R===0}function Md(d,r){const l=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],_=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return f===l||x===_?1:o.aA(((r-l)/(f-l)-_)/(x-_),0,1)}function Hc(d,r,l,f){if(r.pitch<20)return 1;const _=r.getWorldToCameraMatrix();o.aB(_,_,d);const x=o.bT(l.min[0],l.min[1],l.min[2],1);let w=o.aC(o.eF(),x,_),S=w,I=w;x[1]=l.max[1],w=o.aC(o.eF(),x,_),S=w[1]<S[1]?w:S,I=w[1]>I[1]?w:I,x[0]=l.max[0],w=o.aC(o.eF(),x,_),S=w[1]<S[1]?w:S,I=w[1]>I[1]?w:I,x[1]=l.min[1],w=o.aC(o.eF(),x,_),S=w[1]<S[1]?w:S,I=w[1]>I[1]?w:I;const R=o.aA(f[0],0,1),k=100*r.pixelsPerMeter*o.aA(f[1],0,1),z=o.aA(f[2],0,1),M=o.eG(o.eF(),S,I,R),B=Math.tan(.5*r.fovX),j=-M[2]*B;if(k===0)return M[1]<-Math.abs(j)?z:1;const U=(-Math.abs(j)-M[1])/k,Z=(K,ne,ee)=>(1-ee)*K+ee*ne,q=o.aA(Z(1,z,U),z,1);return Z(1,q,o.aA((r.pitch-20)/20,0,1))}class hv{}class dv{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,l,f){{const z=this._storage.get(l.id);if(z)return z.lastUsedFrameIdx=r,z.buf}const _=f.gl,x=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),w=new ArrayBuffer(x),S=new Int16Array(w);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(w));const I=new o.eI;for(let z=0;z<x/2;z+=3){const M=S[z],B=S[z+1],j=S[z+2];I.emplaceBack(M,B),I.emplaceBack(B,j),I.emplaceBack(j,M)}const R=f.bindVertexArrayOES.current,k=new hv;return k.buf=new rc(f,I),k.lastUsedFrameIdx=r,this._storage.set(l.id,k),f.bindVertexArrayOES.set(R),k.buf}update(r){for(const[l,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(l))}destroy(){for(const[r,l]of this._storage)l.buf.destroy(),this._storage.delete(r)}}class bb{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const fv=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Tb{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class qs{constructor(r,l){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Sb=o.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Od{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,l){const f=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const w=new o.eJ,S=new o.b0;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(1,1),w.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(w,Sb.members),this.vignetteIdx=r.context.createIndexBuffer(S)}const _=o.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,f);const w={u_vignetteShape:(x={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};f.draw(r,r.context.gl.TRIANGLES,qt.disabled,Tr.disabled,Dr.alphaBlended,_r.disabled,w,"vignette",this.vignetteVx,this.vignetteIdx,_)}var x}}class Zi{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,l){const f=r.getFreeCameraOptions().position,_=f.toAltitude(),x=f.toLngLat(),w=o.an(x.lng),S=o.an(x.lat),I=r.pixelsPerMeter/l,R=w*o.eL,k=o.eL*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+k,M=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+R)*I,this._accumulatedOffsetY+=z*I,this._accumulatedElevation+=M*I,this._offsetXPrev=R,this._offsetYPrev=k,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Vr(d,r){return[-(d[0]-Math.floor(d[0]/r)*r),-(d[1]-Math.floor(d[1]/r)*r),-(d[2]-Math.floor(d[2]/r)*r)]}function o_(d){const r=o.eq(1323123451230),l=[];for(let f=0;f<d;++f){const _=2*r()-1,x=2*r()-1,w=2*r()-1;l.push(o.d4(_,x,w))}return l}function fo(d,r,l,f,_){const x=o.aA((_-l)/(f-l),0,1);return(1-x)*d+x*r}class qc{constructor(r){this._movement=new Zi,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Od,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,l){const f=r.transform;this._movement.update(f,this._ppmScaleFactor);const _=f.starsProjMatrix,x=o.c6([]);o.c8(x,x,o.an(90)-f._pitch),o.c7(x,x,-f.angle);const w=o.cb(new Float32Array(16),x),S=o.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),I=o.ef([],S),R=o.aB([],I,w),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*l,this._prevTime=k,{projectionMatrix:_,modelviewMatrix:R}}}class qu extends qc{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qs(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const f=o_(this.particlesCount),_=new o.eM,x=new o.b0;let w=0;const S=o.eq(1323123451230);for(let I=0;I<f.length;++I){const R=f[I],k=[2*S()-1,S(),S(),S()];_.emplaceBack(R[0],R[1],R[2],-1,-1,...k),_.emplaceBack(R[0],R[1],R[2],1,-1,...k),_.emplaceBack(R[0],R[1],R[2],1,1,...k),_.emplaceBack(R[0],R[1],R[2],-1,1,...k),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=l.createVertexBuffer(_,fv.members),this.particlesIdx=l.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=r.transform.zoom;if(l.revealStart>f)return;const _=fo(0,1,l.revealStart,l.revealStart+l.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let w=[-x.direction.x,x.direction.y,-100];o.aw(w,w);const S=structuredClone(this._vignetteParams);S.strength*=_,x.overrideStyleParameters||(x.intensity=r.style.rain.state.density,x.timeFactor=r.style.rain.state.intensity,x.color=structuredClone(r.style.rain.state.color),w=structuredClone(r.style.rain.state.direction),x.screenThinning.intensity=r.style.rain.state.centerThinning,x.dropletSizeX=r.style.rain.state.dropletSize[0],x.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],x.distortionStrength=100*r.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(r.style.rain.state.vignetteColor));const I=this.updateOnRender(r,x.timeFactor),R=r.context,k=R.gl,z=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(R,{width:r.width,height:r.height,data:null},k.RGBA8)),x.distortionStrength>0&&(R.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const M=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(R,M),R.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const B=[x.color.r,x.color.g,x.color.b,x.color.a],j=(U,Z)=>{const q=Vr(this._movement.getPosition(),U),K=x.dropletSizeX,ne=x.dropletSizeX*x.dropletSizeYScale,ee=r.width/2,ge=r.height/2,oe=fo(0,x.screenThinning.start,0,1,x.screenThinning.intensity),ve=fo(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),pe=fo(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),ce=(xe={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:q,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:U,rainDropletSize:[K,ne],distortionStrength:x.distortionStrength,rainDirection:w,color:B,screenSize:[z.width,z.height],thinningCenterPos:[ee,ge],thinningShape:[oe,ve,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:Z?0:1},{u_modelview:Float32Array.from(xe.modelview),u_projection:Float32Array.from(xe.projection),u_time:xe.time,u_cam_pos:xe.camPos,u_texScreen:0,u_velocityConeAperture:xe.velocityConeAperture,u_velocity:xe.velocity,u_boxSize:xe.boxSize,u_rainDropletSize:xe.rainDropletSize,u_distortionStrength:xe.distortionStrength,u_rainDirection:xe.rainDirection,u_color:xe.color,u_screenSize:xe.screenSize,u_thinningCenterPos:xe.thinningCenterPos,u_thinningShape:xe.thinningShape,u_thinningAffectedRatio:xe.thinningAffectedRatio,u_thinningParticleOffset:xe.thinningParticleOffset,u_shapeDirectionalPower:xe.shapeDirectionalPower,u_shapeNormalPower:xe.shapeNormalPower,u_mode:xe.mode});var xe;const Me=Math.round(x.intensity*this.particlesCount),Ce=o.bf.simpleSegment(0,0,4*Me,2*Me);M.draw(r,k.TRIANGLES,qt.disabled,Tr.disabled,Dr.alphaBlended,_r.disabled,ce,"rain_particles",this.particlesVx,this.particlesIdx,Ce)};x.distortionStrength>0&&j(x.boxSize,!0),j(x.boxSize,!1),this._vignette.draw(r,S)}}const bl=o.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class a_ extends qc{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qs(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const l=r.context;if(!this.particlesVx){const f=o_(this.particlesCount),_=new o.eN,x=new o.b0;let w=0;const S=o.eq(1323123451230);for(let I=0;I<f.length;++I){const R=f[I],k=S(),z=S(),M=S(),B=[I/f.length,k,z,M],j=[S(),S()];_.emplaceBack(R[0],R[1],R[2],-1,-1,...B,...j),_.emplaceBack(R[0],R[1],R[2],1,-1,...B,...j),_.emplaceBack(R[0],R[1],R[2],1,1,...B,...j),_.emplaceBack(R[0],R[1],R[2],-1,1,...B,...j),x.emplaceBack(w+0,w+1,w+2),x.emplaceBack(w+0,w+2,w+3),w+=4}this.particlesVx=l.createVertexBuffer(_,bl.members),this.particlesIdx=l.createIndexBuffer(x)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const l=structuredClone(this._params);let f=[-l.direction.x,l.direction.y,-100];o.aw(f,f);const _=structuredClone(this._vignetteParams),x=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},w=r.transform.zoom;if(x.revealStart>w)return;const S=fo(0,1,x.revealStart,x.revealStart+x.revealRange,w);_.strength*=S,l.overrideStyleParameters||(l.intensity=r.style.snow.state.density,l.timeFactor=r.style.snow.state.intensity,l.color=structuredClone(r.style.snow.state.color),f=structuredClone(r.style.snow.state.direction),l.screenThinning.intensity=r.style.snow.state.centerThinning,l.billboardSize=2.79*r.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(r.style.snow.state.vignetteColor));const I=this.updateOnRender(r,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const R=r.context,k=R.gl,z=r.transform,M=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(R,M),((B,j,U)=>{const Z=Vr(this._movement.getPosition(),B),q=z.width/2,K=z.height/2,ne=fo(0,U.screenThinning.start,0,1,U.screenThinning.intensity),ee=fo(.001,U.screenThinning.range,0,1,U.screenThinning.intensity),ge=fo(0,U.screenThinning.particleOffset,0,1,U.screenThinning.intensity),oe=(ve={modelview:I.modelviewMatrix,projection:I.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:U.velocityConeAperture,velocity:U.velocity,horizontalOscillationRadius:U.horizontalOscillationRadius,horizontalOscillationRate:U.horizontalOscillationRate,boxSize:B,billboardSize:1*U.billboardSize,simpleShapeParameters:[U.shapeFadeStart,U.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[q,K],thinningShape:[ne,ee,Math.pow(10,U.screenThinning.fadePower)],thinningAffectedRatio:U.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[U.color.r,U.color.g,U.color.b,U.color.a],direction:f},{u_modelview:Float32Array.from(ve.modelview),u_projection:Float32Array.from(ve.projection),u_time:ve.time,u_cam_pos:ve.camPos,u_velocityConeAperture:ve.velocityConeAperture,u_velocity:ve.velocity,u_horizontalOscillationRadius:ve.horizontalOscillationRadius,u_horizontalOscillationRate:ve.horizontalOscillationRate,u_boxSize:ve.boxSize,u_billboardSize:ve.billboardSize,u_simpleShapeParameters:ve.simpleShapeParameters,u_screenSize:ve.screenSize,u_thinningCenterPos:ve.thinningCenterPos,u_thinningShape:ve.thinningShape,u_thinningAffectedRatio:ve.thinningAffectedRatio,u_thinningParticleOffset:ve.thinningParticleOffset,u_particleColor:ve.color,u_direction:ve.direction});var ve;const pe=Math.round(U.intensity*this.particlesCount),ce=o.bf.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&M.draw(r,k.TRIANGLES,qt.disabled,Tr.disabled,Dr.alphaBlended,_r.disabled,oe,"snow_particles",this.particlesVx,this.particlesIdx,ce)})(l.boxSize,0,l),this._vignette.draw(r,_)}}const l_={symbol:function(d,r,l,f,_){if(d.renderPass!=="translucent")return;const x=Tr.disabled,w=d.colorModeForRenderPass(),S=l.layout.get("text-variable-anchor"),I=l.layout.get("text-size-scale-range"),R=o.aA(d.scaleFactor,I[0],I[1]);S&&function(M,B,j,U,Z,q,K,ne){const ee=B.transform,ge=Z==="map",oe=q==="map";for(const ve of M){const pe=U.getTile(ve),ce=pe.getBucket(j);if(!ce||!ce.text||!ce.text.segments.get().length)continue;const xe=o.bJ(ce.textSizeData,ee.zoom,ne),Me=Pf(ve,ce.getProjection(),ee),Ce=ee.calculatePixelsToTileUnitsMatrix(pe),We=xu(Me,pe.tileID.canonical,oe,ge,ee,ce.getProjection(),Ce),Ne=ce.hasIconTextFit()&&ce.hasIconData();xe&&cp(ce,ge,oe,K,ee,We,ve,Math.pow(2,ee.zoom-pe.tileID.overscaledZ),xe,Ne)}}(f,d,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_,R);const k=l.paint.get("icon-opacity").constantOr(1)!==0,z=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||z)?Rd(d,r,l,f,x,w):(k&&Rd(d,r,l,f,x,w,{onlyIcons:!0}),z&&Rd(d,r,l,f,x,w,{onlyText:!0})),r.map.showCollisionBoxes&&(Pd(d,r,l,f,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Pd(d,r,l,f,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(d,r,l,f){if(d.renderPass!=="translucent")return;const _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),S=l.layout.get("circle-sort-key").constantOr(1)!==void 0,I=l.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(x.constantOr(1)===0||w.constantOr(1)===0))return;const R=d.context,k=R.gl,z=d.transform,M=!(!d.terrain||!d.terrain.enabled),B=l.layout.get("circle-elevation-reference"),j=d.depthModeForSublayer(0,qt.ReadOnly),U=new qt(d.context.gl.LEQUAL,qt.ReadOnly,d.depthRangeFor3D),Z=B==="none"||M?j:U,q=Tr.disabled,K=d.colorModeForDrapableLayerRenderPass(I),ne=z.projection.name==="globe",ee=[o.aF(z.center.lng),o.aJ(z.center.lat)],ge=[];for(let ve=0;ve<f.length;ve++){const pe=f[ve],ce=r.getTile(pe),xe=ce.getBucket(l);if(!xe||xe.projection.name!==z.projection.name)continue;const Me=xe.programConfigurations.get(l.id),Ce=xe.layoutVertexBuffer,We=xe.globeExtVertexBuffer,Ne=xe.indexBuffer,Qe=o.d$(l),_t=[We],Fe=d.isTileAffectedByFog(pe);ne&&Qe.push("PROJECTION_GLOBE_VIEW"),Qe.push("DEPTH_D24"),d.terrain&&z.depthOcclusionForSymbolsAndCircles&&Qe.push("DEPTH_OCCLUSION"),xe.hasElevation&&!d.terrain&&(Qe.push("ELEVATED_ROADS"),_t.push(xe.elevatedLayoutVertexBuffer));const Ie=d.getOrCreateProgram("circle",{config:Me,defines:Qe,overrideFog:Fe}),et=z.projection.createInversionMatrix(z,pe.canonical),je={programConfiguration:Me,program:Ie,layoutVertexBuffer:Ce,dynamicBuffers:_t,indexBuffer:Ne,uniformValues:o.e0(d,pe,ce,et,ee,l),tile:ce};if(S){const ot=xe.segments.get();for(const wt of ot)ge.push({segments:new o.bf([wt]),sortKey:wt.sortKey,state:je})}else ge.push({segments:xe.segments,sortKey:0,state:je})}S&&ge.sort((ve,pe)=>ve.sortKey-pe.sortKey);const oe={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const ve of ge){const{programConfiguration:pe,program:ce,layoutVertexBuffer:xe,dynamicBuffers:Me,indexBuffer:Ce,uniformValues:We,tile:Ne}=ve.state,Qe=ve.segments;d.terrain&&d.terrain.setupElevationDraw(Ne,ce,oe),d.uploadCommonUniforms(R,ce,Ne.tileID.toUnwrapped()),ce.draw(d,k.TRIANGLES,Z,q,K,_r.disabled,We,l.id,xe,Ce,Qe,l.paint,z.zoom,pe,Me)}},heatmap:function(d,r,l,f){if(l.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const _=d.context,x=_.gl,w=Tr.disabled,S=new Dr([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(B,j,U,Z){const q=B.gl,K=j.width*Z,ne=j.height*Z;B.activeTexture.set(q.TEXTURE1),B.viewport.set([0,0,K,ne]);let ee=U.heatmapFbo;if(!ee||ee&&(ee.width!==K||ee.height!==ne)){ee&&ee.destroy();const ge=q.createTexture();q.bindTexture(q.TEXTURE_2D,ge),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR),ee=U.heatmapFbo=B.createFramebuffer(K,ne,!0,null),function(oe,ve,pe,ce,xe,Me){const Ce=oe.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,oe.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,xe,Me,0,Ce.RGBA,oe.extRenderToTextureHalfFloat?Ce.HALF_FLOAT:Ce.UNSIGNED_BYTE,null),ce.colorAttachment.set(pe)}(B,0,ge,ee,K,ne)}else q.bindTexture(q.TEXTURE_2D,ee.colorAttachment.get()),B.bindFramebuffer.set(ee.framebuffer)})(_,d,l,d.transform.projection.name==="globe"?.5:.25),_.clear({color:o.ao.transparent});const I=d.transform,R=I.projection.name==="globe",k=R?["PROJECTION_GLOBE_VIEW"]:[],z=R?_r.frontCCW:_r.disabled,M=[o.aF(I.center.lng),o.aJ(I.center.lat)];for(let B=0;B<f.length;B++){const j=f[B];if(r.hasRenderableParent(j))continue;const U=r.getTile(j),Z=U.getBucket(l);if(!Z||Z.projection.name!==I.projection.name)continue;const q=d.isTileAffectedByFog(j),K=Z.programConfigurations.get(l.id),ne=d.getOrCreateProgram("heatmap",{config:K,defines:k,overrideFog:q}),{zoom:ee}=d.transform;d.terrain&&d.terrain.setupElevationDraw(U,ne),d.uploadCommonUniforms(_,ne,j.toUnwrapped());const ge=I.projection.createInversionMatrix(I,j.canonical);ne.draw(d,x.TRIANGLES,qt.disabled,w,S,z,ev(d,j,U,ge,M,ee,l.paint.get("heatmap-intensity")),l.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,l.paint,d.transform.zoom,K,R?[Z.globeExtVertexBuffer]:null)}_.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(_,x){const w=_.context,S=w.gl,I=x.heatmapFbo;if(!I)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let R=x.colorRampTexture;R||(R=x.colorRampTexture=new o.T(w,x.colorRamp,S.RGBA8)),R.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,S.TRIANGLES,qt.disabled,Tr.disabled,_.colorModeForRenderPass(),_r.disabled,((k,z,M,B)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,x),x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(d,l))},line:function(d,r,l,f){if(d.renderPass!=="translucent")return;const _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(_.constantOr(1)===0||x.constantOr(1)===0)return;const w=l.paint.get("line-emissive-strength"),S=l.paint.get("line-occlusion-opacity"),I=l.layout.get("line-elevation-reference"),R=l.layout.get("line-width-unit")==="meters",k=I==="sea",z=!(!d.terrain||!d.terrain.enabled),M=d.context,B=M.gl;if(l.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const j=l.layout.get("line-cross-slope"),U=j!==void 0,Z=j<1,q=d.colorModeForDrapableLayerRenderPass(w),K=d.terrain&&d.terrain.renderingToTexture,ne=K?1:o.o.devicePixelRatio,ee=l.paint.get("line-dasharray"),ge=ee.constantOr(1),oe=l.layout.get("line-cap"),ve=ee.constantOr(null),pe=oe.constantOr(null),ce=l.paint.get("line-pattern"),xe=ce.constantOr(1),Me=l.paint.get("line-pattern-cross-fade"),Ce=ce.constantOr(null),We=l.paint.get("line-opacity").constantOr(1);let Ne=!xe&&We!==1||d.depthOcclusion&&S>0&&S<1;const Qe=l.paint.get("line-gradient"),_t=xe?"linePattern":"line",Fe=o.e1(l);let Ie;if(K&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Ne=!1),S!==0&&d.depthOcclusion){const wt=l.paint._values["line-opacity"];wt&&wt.value&&wt.value.kind==="constant"?Ie=wt.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&Fe.push("VARIABLE_LINE_WIDTH");const et=(wt,jt,pt,vt,$t,Ot)=>{for(const Rt of wt){const Dt=r.getTile(Rt);if(xe&&!Dt.patternsLoaded())continue;const lr=Dt.getBucket(l);if(!lr||lr.elevationType!=="none"&&!$t||lr.elevationType==="none"&&$t)continue;d.prepareDrawTile();const Ur=[...jt],Jr=d.shadowRenderer,Ci=lr.elevationType==="road"&&!!Jr&&Jr.enabled;let yr=[0,0,0];if(Ci){const xr=d.style.directionalLight,ri=d.style.ambientLight;xr&&ri&&(yr=fa(d.style,xr,ri)),Ur.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Kr=lr.programConfigurations.get(l.id);let kr=!1;if(Ce&&Dt.imageAtlas){const xr=o.e2.from(Ce),ri=xr.getPrimary().scaleSelf(ne).toString(),on=Dt.imageAtlas.patternPositions.get(ri),En=xr.getSecondary(),un=En?Dt.imageAtlas.patternPositions.get(En.scaleSelf(ne).toString()):null;kr=!!on&&!!un,on&&Kr.setConstantPatternPositions(on,un)}Me>0&&(kr||Kr.getPatternTransitionVertexBuffer("line-pattern"))&&Ur.push("LINE_PATTERN_TRANSITION");const Si=d.isTileAffectedByFog(Rt),Qr=d.getOrCreateProgram(_t,{config:Kr,defines:Ur,overrideFog:Si});if(!xe&&ve&&pe&&Dt.lineAtlas){const xr=Dt.lineAtlas.getDash(ve,pe);xr&&Kr.setConstantPatternPositions(xr)}Ci&&Jr.setupShadows(Dt.tileID.toUnwrapped(),Qr,"vector-tile");let[Fi,oi]=l.paint.get("line-trim-offset");(pe==="round"||pe==="square")&&Fi!==oi&&(Fi===0&&(Fi-=1),oi===1&&(oi+=1));const Mr=K?Rt.projMatrix:null,pi=R?1/lr.tileToMeter/o.ay(Dt,1,d.transform.zoom):1,Lr=R?1/lr.tileToMeter/o.ay(Dt,1,Math.floor(d.transform.zoom)):1,$i=xe?o.e3(d,Dt,l,Mr,ne,pi,Lr,[Fi,oi],yr,Me):o.e4(d,Dt,l,Mr,lr.lineClipsArray.length,ne,pi,Lr,[Fi,oi],yr);if(Qe){const xr=lr.gradients[l.id];let ri=xr.texture;if(l.gradientVersion!==xr.version){let on=256;if(l.stepInterpolant){const En=r.getSource().maxzoom,un=Rt.canonical.z===En?Math.ceil(1<<d.transform.maxZoom-Rt.canonical.z):1;on=o.aA(o.e5(lr.maxLineLength/o.al*1024*un),256,M.maxTextureSize)}xr.gradient=o.e6({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:on,image:xr.gradient||void 0,clips:lr.lineClipsArray}),xr.texture?xr.texture.update(xr.gradient):xr.texture=new o.T(M,xr.gradient,B.RGBA8),xr.version=l.gradientVersion,ri=xr.texture}M.activeTexture.set(B.TEXTURE1),ri.bind(l.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ge&&(M.activeTexture.set(B.TEXTURE0),Dt.lineAtlasTexture&&Dt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Kr.updatePaintBuffers()),xe&&(M.activeTexture.set(B.TEXTURE0),Dt.imageAtlasTexture&&Dt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Kr.updatePaintBuffers()),$t&&!k&&d.terrain.setupElevationDraw(Dt,Qr),d.uploadCommonUniforms(M,Qr,Rt.toUnwrapped());const gi=xr=>{Ie!=null&&(Ie.value=We*S),Qr.draw(d,B.TRIANGLES,pt,xr,q,_r.disabled,$i,l.id,lr.layoutVertexBuffer,lr.indexBuffer,lr.segments,l.paint,d.transform.zoom,Kr,[lr.layoutVertexBuffer2,lr.patternVertexBuffer,lr.zOffsetVertexBuffer]),Ie!=null&&(Ie.value=We)};if(Ne&&!$t){const xr=d.stencilModeForClipping(Rt).ref;xr===0&&K&&M.clear({stencil:0});const ri={func:B.EQUAL,mask:255};$i.u_alpha_discard_threshold=.8,gi(new Tr(ri,xr,255,B.KEEP,B.KEEP,B.INVERT)),$i.u_alpha_discard_threshold=0,gi(new Tr(ri,xr,255,B.KEEP,B.KEEP,B.KEEP))}else $i.u_alpha_discard_threshold=Ne&&$t&&Ot?.8:0,gi($t?vt:d.stencilModeForClipping(Rt))}};let je=d.depthModeForSublayer(0,qt.ReadOnly);const ot=new qt(d.depthOcclusion?B.GREATER:B.LEQUAL,qt.ReadOnly,d.depthRangeFor3D);if(l.hasNonElevatedBuckets){const wt=!K&&d.terrain;S!==0&&wt?o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):wt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):et(f,Fe,je,Tr.disabled,!1,!0)}if(l.hasElevatedBuckets){I==="hd-road-markup"?z||(je=ot,Fe.push("ELEVATED_ROADS")):(Fe.push("ELEVATED"),je=ot,U&&Fe.push(Z?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&Fe.push("ELEVATION_REFERENCE_SEA"));const wt=Ne?d.stencilModeFor3D():Tr.disabled;d.forceTerrainMode=!0,et(f,Fe,je,wt,!0,!0),Ne&&et(f,Fe,je,wt,!0,!1),d.forceTerrainMode=!1}Ne&&(d.resetStencilClippingMasks(),K&&M.clear({stencil:0})),S===0||d.depthOcclusion||K||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,r,l,f){const _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const w=l.paint.get("fill-emissive-strength"),S=d.colorModeForDrapableLayerRenderPass(w),I=l.paint.get("fill-pattern"),R=d.opaquePassEnabledForLayer()&&!I.constantOr(1)&&_.constantOr(o.ao.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let k="none";l.layout.get("fill-elevation-reference")!=="none"?k="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const z=!(!d.terrain||!d.terrain.enabled),M={painter:d,sourceCache:r,layer:l,coords:f,colorMode:S,elevationType:k,terrainEnabled:z,pass:R};if(d.renderPass!=="shadow")if(k!=="offset"){if(Nu(M,!1),k==="road"){const B=!z&&d.renderPass==="translucent";B&&$c(d,r,l,f,"geometry"),Nu(M,!0,Tr.disabled),B&&function(j){const{painter:U,sourceCache:Z,layer:q,coords:K,colorMode:ne}=j,ee=U.context.gl,ge=j.painter.shadowRenderer,oe=!!ge&&ge.enabled,ve=new qt(U.context.gl.LEQUAL,qt.ReadOnly,U.depthRangeFor3D);let pe=[0,0,0];if(oe){const xe=U.style.directionalLight,Me=U.style.ambientLight;xe&&Me&&(pe=fa(U.style,xe,Me))}const ce=xe=>{for(const Me of K){const Ce=Z.getTile(Me),We=Ce.getBucket(q);if(!We)continue;const Ne=We.elevatedStructures;if(!Ne)continue;let Qe,_t;if(xe?(Qe=Ne.renderableBridgeSegments,_t=Ne.bridgeProgramConfigurations.get(q.id)):(Qe=Ne.renderableTunnelSegments,_t=Ne.tunnelProgramConfigurations.get(q.id)),!Qe||Qe.segments[0].primitiveLength===0)continue;_t.updatePaintBuffers(),U.prepareDrawTile();const Fe=U.isTileAffectedByFog(Me),Ie=[];oe&&Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const et=U.getOrCreateProgram("elevatedStructures",{config:_t,overrideFog:Fe,defines:Ie}),je=U.translatePosMatrix(Me.projMatrix,Ce,q.paint.get("fill-translate"),q.paint.get("fill-translate-anchor"));oe&&ge.setupShadows(Ce.tileID.toUnwrapped(),et,"vector-tile");const ot=gb(je,pe);U.uploadCommonUniforms(U.context,et,Me.toUnwrapped()),et.draw(U,ee.TRIANGLES,ve,Tr.disabled,ne,_r.backCCW,ot,q.id,Ne.vertexBuffer,Ne.indexBuffer,Qe,q.paint,U.transform.zoom,_t,[Ne.vertexBufferNormal])}};ce(!0),ce(!1)}(M)}}else Nu(M,!1,d.stencilModeFor3D());else d.shadowRenderer&&k==="road"&&!z&&function(B){const{painter:j,sourceCache:U,layer:Z,coords:q}=B,K=j.context.gl,ne=B.painter.shadowRenderer;for(const ee of q){const ge=U.getTile(ee),oe=ge.getBucket(Z);if(!oe)continue;const ve=oe.elevatedStructures;if(!ve||!ve.shadowCasterSegments||ve.shadowCasterSegments.segments[0].primitiveLength===0)continue;j.prepareDrawTile();const pe=oe.bufferData.programConfigurations.get(Z.id),ce=j.isTileAffectedByFog(ee),xe=j.getOrCreateProgram("elevatedStructuresDepth",{config:pe,overrideFog:ce}),Me=ne.calculateShadowPassMatrixFromTile(ge.tileID.toUnwrapped());j.uploadCommonUniforms(j.context,xe,ee.toUnwrapped());const Ce={u_matrix:Me,u_depth_bias:0};xe.draw(j,K.TRIANGLES,ne.getShadowPassDepthMode(),Tr.disabled,ne.getShadowPassColorMode(),_r.disabled,Ce,Z.id,ve.vertexBuffer,ve.indexBuffer,ve.shadowCasterSegments,Z.paint,j.transform.zoom,pe)}}(M)},"fill-extrusion":function(d,r,l,f){const _=l.paint.get("fill-extrusion-opacity"),x=d.context,w=x.gl,S=d.terrain,I=S&&S.renderingToTexture;if(_===0)return;const R=d.conflationActive&&d.style.isLayerClipped(l,r.getSource()),k=d.style.order.indexOf(l.fqid);if(R&&function(z,M,B,j,U){for(const Z of j){const q=M.getTile(Z).getBucket(B);q&&(q.updateReplacement(Z,z.replacementSource,U),q.uploadCentroid(z.context))}}(d,r,l,f,k),S||R)for(const z of f){const M=r.getTile(z).getBucket(l);M&&nc(d.context,r,z,M,l,S,R)}if(d.renderPass==="shadow"&&d.shadowRenderer){const z=d.shadowRenderer;if(S&&_<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const M=z.getShadowPassDepthMode(),B=z.getShadowPassColorMode();zt(d,r,l,f,M,Tr.disabled,B,R)}else if(d.renderPass==="translucent"){const z=!l.paint.get("fill-extrusion-pattern").constantOr(1),M=l.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!I&&M.a!==0){const B=new qt(d.context.gl.LEQUAL,qt.ReadWrite,d.depthRangeFor3D);_===1&&z?zt(d,r,l,f,B,Tr.disabled,Dr.unblended,R):(zt(d,r,l,f,B,Tr.disabled,Dr.disabled,R),zt(d,r,l,f,B,d.stencilModeFor3D(),d.colorModeForRenderPass(),R),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&z&&(!S&&d.transform.projection.name!=="globe"||I)){const B=l.paint.get("fill-extrusion-opacity"),j=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Z=l.paint.get("fill-extrusion-flood-light-intensity"),q=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",K=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(q?null:l.lut).toArray01().slice(0,3),ne=j>0&&U>0,ee=Z>0,ge=(pe,ce,xe)=>(1-xe)*pe+xe*ce,oe=new Wg;oe.translate=l.paint.get("fill-extrusion-translate"),oe.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),oe.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),oe.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const ve=pe=>{const ce=d.depthModeForSublayer(1,qt.ReadOnly,w.LEQUAL,!0),xe=l.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ge(.1,3,xe),Ce=d._showOverdrawInspector;if(!Ce){const We=new Tr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),Ne=new Dr([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0],w.MIN);xl(oe,d,r,l,f,ce,We,Ne,_r.disabled,pe,"sdf",B,j,U,Z,K,Me,R,!1)}{const We=Ce?Tr.disabled:new Tr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Ne=Ce?d.colorModeForRenderPass():new Dr([w.ONE_MINUS_DST_ALPHA,w.DST_ALPHA,w.ONE,w.ONE],o.ao.transparent,[!0,!0,!0,!0]);xl(oe,d,r,l,f,ce,We,Ne,_r.disabled,pe,"color",B,j,U,Z,K,Me,R,!1)}};if(I){const pe=(ce,xe,Me)=>{const Ce=d.depthModeForSublayer(1,qt.ReadOnly,w.LEQUAL,!1),We=l.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ne=ge(.1,3,We);{const Qe=new Dr([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0]);xl(oe,d,r,l,f,Ce,Tr.disabled,Qe,_r.disabled,ce,"clear",B,j,U,Z,K,Ne,R,xe)}{const Qe=new Tr({func:w.ALWAYS,mask:255},255,255,w.KEEP,w.KEEP,w.REPLACE),_t=new Dr([w.ONE,w.ONE,w.ONE,w.ONE],o.ao.transparent,[!1,!1,!1,!0],w.MIN);xl(oe,d,r,l,f,Ce,Qe,_t,_r.disabled,ce,"sdf",B,j,U,Z,K,Ne,R,xe)}{const Qe=ce?w.ZERO:w.ONE_MINUS_DST_ALPHA,_t=new Tr({func:w.EQUAL,mask:255},255,255,w.KEEP,w.DECR,w.DECR),Fe=new Dr([Qe,w.DST_ALPHA,w.ONE_MINUS_DST_ALPHA,w.ZERO],o.ao.transparent,[!0,!0,!0,!0]);xl(oe,d,r,l,f,Ce,_t,Fe,_r.disabled,ce,"color",B,j,U,Z,K,Ne,R,xe)}{const Qe=new Dr([w.ONE,w.ONE,w.ONE,ce?w.ZERO:w.ONE],o.ao.transparent,[!1,!1,!1,!0],ce?w.FUNC_ADD:w.MAX);xl(oe,d,r,l,f,Ce,Tr.disabled,Qe,_r.disabled,ce,"clear",B,j,U,Z,K,Ne,R,xe,Me)}};if(ne||ee){let ce;if(d.prepareDrawTile(),S){const xe=S.drapeBufferSize[0],Me=S.drapeBufferSize[1];ce=S.framebufferCopyTexture,ce&&(!ce||ce.size[0]===xe&&ce.size[1]===Me)||(ce&&ce.destroy(),ce=S.framebufferCopyTexture=new o.T(x,new o.q({width:xe,height:Me}),w.RGBA8)),ce.bind(w.LINEAR,w.CLAMP_TO_EDGE),w.copyTexSubImage2D(w.TEXTURE_2D,0,0,0,0,0,xe,Me)}ne&&pe(!0,!1,ce),ee&&pe(!1,!0,ce)}}else ne&&ve(!0),ee&&ve(!1),(ne||ee)&&d.resetStencilClippingMasks()}}},building:function(d,r,l,f){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const _=l.paint.get("building-ambient-occlusion-ground-intensity"),x=l.paint.get("building-ambient-occlusion-ground-radius"),w=l.paint.get("building-ambient-occlusion-ground-attenuation"),S=l.paint.get("building-opacity");if(S<=0)return;let I=_>0&&x>0,R=!0;const k=l.paint.get("building-vertical-scale");if(k<=0)return;(!d.shadowRenderer||k<1)&&(R=!1);const z=d.conflationActive&&d.style.isLayerClipped(l,r.getSource()),M=d.style.order.indexOf(l.fqid);if(function(B,j,U,Z,q,K){for(const ne of K){const ee=j.getTile(ne).getBucket(U);ee&&(q&&ee.updateReplacement(ne,B.replacementSource,Z),ee.uploadUpdatedIndexBuffer(B.context))}}(d,r,l,M,z,f),function(B,j,U,Z){for(const q of Z){const K=j.getTile(q).getBucket(U);K&&K.needsEvaluation()&&K.uploadUpdatedColorBuffer(B.context)}}(d,r,l,f),l.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const B=d.shadowRenderer,j=[],U=B.getShadowPassDepthMode();hp({painter:d,source:r,layer:l,coords:f,defines:j,blendMode:B.getShadowPassColorMode(),depthMode:U,opacity:S,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(d.renderPass==="translucent"){let B=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];R&&(B=B.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer&&d.shadowRenderer.useNormalOffset&&(B=B.concat("NORMAL_OFFSET"));const j=l.paint.get("building-facade-emissive-chance"),U=l.paint.get("building-ambient-occlusion-intensity"),Z=l.paint.get("building-flood-light-intensity"),q=l.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",K=l.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(q?null:l.lut).toArray01().slice(0,3),ne=l.paint.get("building-flood-light-ground-attenuation"),ee=Z>0,ge=new qt(d.context.gl.LEQUAL,qt.ReadWrite,d.depthRangeFor3D);S<1&&hp({painter:d,source:r,layer:l,coords:f,defines:B,blendMode:Dr.disabled,depthMode:ge,opacity:S,verticalScale:k,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:Z,floodLightColor:K,depthOnly:!0});const oe=d.colorModeForRenderPass();hp({painter:d,source:r,layer:l,coords:f,defines:B,blendMode:oe,depthMode:ge,opacity:S,verticalScale:k,facadeEmissiveChance:j,facadeAOIntensity:U,floodLightIntensity:Z,floodLightColor:K}),I&&dp(d,r,l,f,!0,S,_,x,Z,K,w,z),ee&&dp(d,r,l,f,!1,S,_,x,Z,K,ne,z)}else if(d.renderPass==="light-beam"){const B=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],j=new qt(d.context.gl.LEQUAL,qt.ReadOnly,d.depthRangeFor3D);hp({painter:d,source:r,layer:l,coords:f,defines:B,blendMode:Dr.alphaBlended,depthMode:j,opacity:S,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,r,l,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const _=d.context,x=d.terrain&&d.terrain.renderingToTexture,[w,S]=d.renderPass!=="translucent"||x?[{},f]:d.stencilConfigForOverlap(f);for(const I of S){const R=r.getTile(I);if(R.needsHillshadePrepare&&d.renderPass==="offscreen")sb(d,R,l);else if(d.renderPass==="translucent"){const k=d.depthModeForSublayer(0,qt.ReadOnly),z=l.paint.get("hillshade-emissive-strength"),M=d.colorModeForDrapableLayerRenderPass(z),B=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(I):w[I.overscaledZ];nb(d,I,R,l,k,B,M)}}_.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,r,l,f,_,x){if(d.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const w=d.transform.projection.name==="globe",S=l.paint.get("raster-elevation")!==0,I=S&&w;if(d.renderElevatedRasterBackface&&!I)return;const R=d.context,k=R.gl,z=r.getSource(),M=function(oe,ve,pe,ce){const xe=ve.paint.get("raster-color"),Me=oe.type==="raster-array",Ce=[],We=ve.paint.get("raster-resampling"),Ne=ve.paint.get("raster-color-mix");let Qe=ve.paint.get("raster-color-range");const _t=[Ne[0],Ne[1],Ne[2],0],Fe=Ne[3];let Ie=We==="nearest"?ce.NEAREST:ce.LINEAR;if(Me&&(Ce.push("RASTER_ARRAY"),xe||Ce.push("RASTER_COLOR"),We==="linear"&&Ce.push("RASTER_ARRAY_LINEAR"),Ie=ce.NEAREST,!Qe&&oe.rasterLayers)){const et=oe.rasterLayers.find(({id:je})=>je===ve.sourceLayer);et&&et.fields&&et.fields.range&&(Qe=et.fields.range)}if(Qe=Qe||[0,1],xe){Ce.push("RASTER_COLOR"),pe.activeTexture.set(ce.TEXTURE2),ve.updateColorRamp(Qe);let et=ve.colorRampTexture;et||(et=ve.colorRampTexture=new o.T(pe,ve.colorRamp,ce.RGBA8)),et.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:_t,range:Qe,offset:Fe,defines:Ce,resampling:Ie}}(z,l,R,k);if(z instanceof o.aT&&!f.length&&!w)return;const B=l.paint.get("raster-emissive-strength"),j=d.colorModeForDrapableLayerRenderPass(B),U=d.terrain&&d.terrain.renderingToTexture,Z=!d.options.moving,q=l.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(z instanceof o.aT&&!f.length&&(z.onNorthPole||z.onSouthPole)){const oe=S?d.stencilModeFor3D():Tr.disabled;return void Kg(!!z.onNorthPole,null,d,r,l,B,M,_r.disabled,oe)}if(!f.length)return;const[K,ne]=z instanceof o.aT||U?[{},f]:d.stencilConfigForOverlap(f),ee=ne[ne.length-1].overscaledZ;I&&M.defines.push("PROJECTION_GLOBE_VIEW"),S&&M.defines.push("RENDER_CUTOFF");const ge=(oe,ve,pe)=>{for(const ce of oe){const xe=ce.toUnwrapped(),Me=r.getTile(ce);if(U&&(!Me||!Me.hasData()))continue;R.activeTexture.set(k.TEXTURE0);const Ce=vb(Me,z,l,M);if(!Ce||!Ce.texture)continue;const{texture:We,mix:Ne,offset:Qe,tileSize:_t,buffer:Fe}=Ce;let Ie,et;U?(Ie=qt.disabled,et=ce.projMatrix):S?(Ie=new qt(k.LEQUAL,qt.ReadWrite,d.depthRangeFor3D),et=w?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(xe,Z)):(Ie=d.depthModeForSublayer(ce.overscaledZ-ee,l.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,k.LESS),et=d.transform.calculateProjMatrix(xe,Z));const je=d.terrain&&U?d.terrain.stencilModeForRTTOverlap(ce):K[ce.overscaledZ],ot=x?0:l.paint.get("raster-fade-duration");Me.registerFadeDuration(ot);const wt=r.findLoadedParent(ce,0),jt=Xf(Me,wt,r,d.transform,ot);let pt,vt;!jt.isFading&&Me.refreshedUponExpiration&&(Me.refreshedUponExpiration=!1),d.terrain&&d.terrain.prepareDrawTile(),R.activeTexture.set(k.TEXTURE0),We.bind(q,k.CLAMP_TO_EDGE),R.activeTexture.set(k.TEXTURE1),wt?(wt.texture&&wt.texture.bind(q,k.CLAMP_TO_EDGE),pt=Math.pow(2,wt.tileID.overscaledZ-Me.tileID.overscaledZ),vt=[Me.tileID.canonical.x*pt%1,Me.tileID.canonical.y*pt%1]):We.bind(q,k.CLAMP_TO_EDGE),"useMipmap"in We&&R.extTextureFilterAnisotropic&&d.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);const $t=d.transform;let Ot;const Rt=S?nv($t):[0,0,0,0];let Dt,lr,Ur,Jr,Ci,yr=0;if(I&&z instanceof o.aT&&z.coordinates.length>3)Dt=Float32Array.from(o.bj(o.dI(new o.cC(0,0,0)))),lr=Float32Array.from($t.globeMatrix),Ur=Float32Array.from(o.dE($t)),Jr=[o.aF($t.center.lng),o.aJ($t.center.lat)],Ot=z.elevatedGlobePerspectiveTransform,Ci=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){const Qr=o.dF(ce.canonical);yr=o.dG(Qr.getCenter().lat),Dt=Float32Array.from(o.bj(o.dI(ce.canonical))),lr=Float32Array.from($t.globeMatrix),Ur=Float32Array.from(o.dE($t)),Jr=[o.aF($t.center.lng),o.aJ($t.center.lat)],Ot=[0,0],Ci=Float32Array.from(o.dH(ce.canonical,Qr,yr,$t.worldSize/$t._pixelsPerMercatorPixel))}else Ot=z instanceof o.aT?z.perspectiveTransform:[0,0],Dt=new Float32Array(16),lr=new Float32Array(9),Ur=new Float32Array(16),Jr=[0,0],Ci=new Float32Array(9);const Kr=Cd(et,Dt,lr,Ur,Ci,vt||[0,0],o.aj(d.transform.zoom),Jr,Rt,pt||1,jt,l,Ot,S?l.paint.get("raster-elevation"):0,2,Ne,Qe,M.range,_t,Fe,B),kr=d.isTileAffectedByFog(ce),Si=d.getOrCreateProgram("raster",{defines:M.defines,overrideFog:kr});if(d.uploadCommonUniforms(R,Si,xe),z instanceof o.aT){const Qr=z.elevatedGlobeVertexBuffer,Fi=z.elevatedGlobeIndexBuffer;if(U||!w)z.boundsBuffer&&z.boundsSegments&&Si.draw(d,k.TRIANGLES,Ie,Tr.disabled,j,_r.disabled,Kr,l.id,z.boundsBuffer,d.quadTriangleIndexBuffer,z.boundsSegments);else if(Qr&&Fi){const oi=$t.zoom<=o.cZ?z.elevatedGlobeSegments:z.getSegmentsForLongitude($t.center.lng);oi&&Si.draw(d,k.TRIANGLES,Ie,Tr.disabled,j,ve,Kr,l.id,Qr,Fi,oi)}}else if(I){Ie=new qt(k.LEQUAL,qt.ReadOnly,d.depthRangeFor3D);const Qr=d.globeSharedBuffers;if(Qr){const[Fi,oi,Mr]=Qr.getGridBuffers(yr,!1);Si.draw(d,k.TRIANGLES,Ie,pe||je,d.colorModeForRenderPass(),ve,Kr,l.id,Fi,oi,Mr)}}else{const{tileBoundsBuffer:Qr,tileBoundsIndexBuffer:Fi,tileBoundsSegments:oi}=d.getTileBoundsBuffers(Me);Si.draw(d,k.TRIANGLES,Ie,je,j,_r.disabled,Kr,l.id,Qr,Fi,oi)}}if(!(z instanceof o.aT)&&I)for(const ce of oe){const xe=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&Kg(!0,ce,d,r,l,B,M,ve,pe||Tr.disabled),xe&&Kg(!1,ce,d,r,l,B,M,ve===_r.frontCW?_r.backCW:_r.frontCW,pe||Tr.disabled)}};I?ge(ne,d.renderElevatedRasterBackface?_r.backCW:_r.frontCW,d.stencilModeFor3D()):ge(ne,_r.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,r,l,f,_,x){d.renderPass==="offscreen"&&function(w,S,I,R){if(!R.length)return;const k=w.context,z=k.gl,M=S.getSource();if(!(M instanceof es))return;const B=Math.ceil(Math.sqrt(I.paint.get("raster-particle-count")));let j=I.particlePositionRGBAImage;if(!j||j.width!==B){const ne=function(ee){const ge=ee*ee,oe=new Uint8Array(4*ge),ve=function(ce){return ce|=0,ce=Math.imul(2747636419^ce,2654435769),ce=Math.imul(ce^ce>>>16,2654435769),((ce=Math.imul(ce^ce>>>16,2654435769))>>>0)/4294967296},pe=1/1.1;for(let ce=0;ce<ge;ce++){const xe=pe*(ve(2*ce+0)+Uc),Me=pe*(ve(2*ce+1)+Uc),Ce=255*xe%1,We=255*Me%1,Ne=Ce,Qe=Me-We/255,_t=We;oe[4*ce+0]=255*(xe-Ce/255),oe[4*ce+1]=255*Ne,oe[4*ce+2]=255*Qe,oe[4*ce+3]=255*_t}return oe}(B);j=I.particlePositionRGBAImage=new o.q({width:B,height:B},ne)}let U=I.particleFramebuffer;U?U.width!==B&&(U.destroy(),U=I.particleFramebuffer=k.createFramebuffer(B,B,!0,null)):U=I.particleFramebuffer=k.createFramebuffer(B,B,!0,null);const Z=[];for(const ne of R){const ee=S.getTile(ne);if(!(ee instanceof Yl))continue;const ge=Yg(ee,M,I);if(!ge)continue;const oe=[ee.tileSize,ee.tileSize];let ve=I.tileFramebuffer;ve||(ve=I.tileFramebuffer=k.createFramebuffer(oe[0],oe[1],!0,null));let pe=ee.rasterParticleState;pe||(pe=ee.rasterParticleState=new To(k,ne,oe,j));const ce=pe.update(I.lastInvalidatedAt);pe.particleTextureDimension!==B&&pe.updateParticleTexture(ne,j);const xe=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=xe;const Me=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=Me,Z.push([ne,ge,pe,ce])}if(Z.length===0)return;const q=o.o.now(),K=I.previousDrawTimestamp?.001*(q-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=q,I.hasColorMap()){k.activeTexture.set(z.TEXTURE0+2);let ne=I.colorRampTexture;ne||(ne=I.colorRampTexture=new o.T(k,I.colorRamp,z.RGBA8)),ne.bind(z.LINEAR,z.CLAMP_TO_EDGE)}k.bindFramebuffer.set(I.tileFramebuffer.framebuffer),function(ne,ee,ge){const oe=ne.context,ve=oe.gl,pe=ee.tileFramebuffer;oe.activeTexture.set(ve.TEXTURE0);const ce={u_texture:0,u_opacity:1.05*(Me=ee.paint.get("raster-particle-fade-opacity-factor"))/(Me+.05)},xe=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Me;for(const Ce of ge){const[,,We,Ne]=Ce;pe.colorAttachment.set(We.targetColorTexture.texture),oe.viewport.set([0,0,pe.width,pe.height]),oe.clear({color:o.ao.transparent}),Ne&&(We.backgroundColorTexture.bind(ve.NEAREST,ve.CLAMP_TO_EDGE),xe.draw(ne,ve.TRIANGLES,qt.disabled,Tr.disabled,Dr.alphaBlended,_r.disabled,ce,ee.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(w,I,Z),function(ne,ee,ge,oe){const ve=ne.context,pe=ve.gl,ce=ge.tileFramebuffer,xe=ne.transform.projection.name==="globe",Me=ge.paint.get("raster-particle-max-speed");for(const Ce of oe){const[We,Ne,Qe]=Ce;ve.activeTexture.set(pe.TEXTURE0+0),Ne.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ce.colorAttachment.set(Qe.targetColorTexture.texture);const _t=ne.getOrCreateProgram("rasterParticleDraw",{defines:Ne.defines,overrideFog:!1});ve.activeTexture.set(pe.TEXTURE0+1);const Fe=Ne.scalarData?[]:[0,1,2,3].map(je=>o.e8[je](We));Fe.push(We);const Ie=We.canonical.x,et=We.canonical.y;for(const je of Fe){const ot=ee.getTile(xe?je.wrapped():je);if(!ot)continue;const wt=ot.rasterParticleState;if(!wt)continue;const jt=je.canonical.x+(1<<je.canonical.z)*(je.wrap-We.wrap),pt=je.canonical.y;wt.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const vt=Ug(1,wt.particleTexture0.size[0],[jt-Ie,pt-et],0,Ne.texture.size,2,Me,Ne.textureOffset,Ne.scale,Ne.offset);_t.draw(ne,pe.POINTS,qt.disabled,Tr.disabled,Dr.alphaBlended,_r.disabled,vt,ge.id,wt.particleIndexBuffer,void 0,wt.particleSegment)}}}(w,S,I,Z),k.bindFramebuffer.set(I.particleFramebuffer.framebuffer),function(ne,ee,ge,oe){const ve=ne.context,pe=ve.gl,ce=ee.paint.get("raster-particle-max-speed"),xe=oe*ee.paint.get("raster-particle-speed-factor")*.15,Me=function(We){return Math.pow(We,6)}(.01+1*ee.paint.get("raster-particle-reset-rate-factor")),Ce=ee.particleFramebuffer;ve.viewport.set([0,0,Ce.width,Ce.height]);for(const We of ge){const[,Ne,Qe]=We;ve.activeTexture.set(pe.TEXTURE0+0),Ne.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),ve.activeTexture.set(pe.TEXTURE0+1);const _t=Qe.particleTexture0;_t.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Fe=rp(1,_t.size[0],0,Ne.texture.size,ce,xe,Me,Ne.textureOffset,Ne.scale,Ne.offset);Ce.colorAttachment.set(Qe.particleTexture1.texture),ve.clear({color:o.ao.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:Ne.defines}).draw(ne,pe.TRIANGLES,qt.disabled,Tr.disabled,Dr.unblended,_r.disabled,Fe,ee.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(w,I,Z,K)}(d,r,l,f),d.renderPass==="translucent"&&(function(w,S,I,R,k){const z=w.context,M=z.gl,B=S.getSource().tileSize,j=5*(1-o.ah(o.cK,o.cK+1,w.transform.zoom))*B+I.paint.get("raster-particle-elevation"),U=!w.options.moving,Z=w.transform.projection.name==="globe";if(!R.length)return;const[q,K]=w.stencilConfigForOverlap(R),ne=[];Z&&ne.push("PROJECTION_GLOBE_VIEW");const ee=w.stencilModeFor3D();for(const ge of K){const oe=ge.toUnwrapped(),ve=S.getTile(ge);if(!ve.rasterParticleState)continue;const pe=ve.rasterParticleState,ce=100;ve.registerFadeDuration(ce);const xe=S.findLoadedParent(ge,0),Me=Xf(ve,xe,S,w.transform,ce);let Ce,We;w.terrain&&w.terrain.prepareDrawTile(),z.activeTexture.set(M.TEXTURE0),pe.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),z.activeTexture.set(M.TEXTURE1),xe&&xe.rasterParticleState?(xe.rasterParticleState.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ce=Math.pow(2,xe.tileID.overscaledZ-ve.tileID.overscaledZ),We=[ve.tileID.canonical.x*Ce%1,ve.tileID.canonical.y*Ce%1]):pe.targetColorTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE);const Ne=Z?Float32Array.from(w.transform.expandedFarZProjMatrix):w.transform.calculateProjMatrix(oe,U),Qe=w.transform,_t=io(Qe),Fe=o.dF(ge.canonical),Ie=o.dG(Fe.getCenter().lat);let et,je,ot,wt,jt;Z?(et=Float32Array.from(o.bj(o.dI(ge.canonical))),je=Float32Array.from(Qe.globeMatrix),ot=Float32Array.from(o.dE(Qe)),wt=[o.aF(Qe.center.lng),o.aJ(Qe.center.lat)],jt=Float32Array.from(o.dH(ge.canonical,Fe,Ie,Qe.worldSize/Qe._pixelsPerMercatorPixel))):(et=new Float32Array(16),je=new Float32Array(9),ot=new Float32Array(16),wt=[0,0],jt=new Float32Array(9));const pt=tc(Ne,et,je,ot,jt,We||[0,0],o.aj(w.transform.zoom),wt,_t,Ce||1,Me,j),vt=w.isTileAffectedByFog(ge),$t=w.getOrCreateProgram("rasterParticle",{defines:ne,overrideFog:vt});if(w.uploadCommonUniforms(z,$t,oe),Z){const Ot=new qt(M.LEQUAL,qt.ReadOnly,w.depthRangeFor3D),Rt=0,Dt=w.globeSharedBuffers;if(Dt){const[lr,Ur,Jr]=Dt.getGridBuffers(Ie,Rt!==0);$t.draw(w,M.TRIANGLES,Ot,ee,Dr.alphaBlended,w.renderElevatedRasterBackface?_r.frontCCW:_r.backCCW,pt,I.id,lr,Ur,Jr)}}else{const Ot=w.depthModeForSublayer(0,qt.ReadOnly),Rt=q[ge.overscaledZ],{tileBoundsBuffer:Dt,tileBoundsIndexBuffer:lr,tileBoundsSegments:Ur}=w.getTileBoundsBuffers(ve);$t.draw(w,M.TRIANGLES,Ot,Rt,Dr.alphaBlended,_r.disabled,pt,I.id,Dt,lr,Ur)}}w.resetStencilClippingMasks()}(d,r,l,f),d.style.map.triggerRepaint())},background:function(d,r,l,f){const _=l.paint.get("background-color"),x=l.paint.get("background-color-use-theme").constantOr("default")==="none",w=l.paint.get("background-opacity"),S=l.paint.get("background-emissive-strength"),I=l.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const R=d.context,k=R.gl,z=d.transform,M=z.tileSize,B=l.paint.get("background-pattern");let j;if(B!==void 0&&(B===null||(j=d.imageManager.getPattern(o.I.from(B.toString()),l.scope,d.style.getLut(l.scope)),!j)))return;const U=!B&&_.a===1&&w===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==U)return;const Z=Tr.disabled,q=d.depthModeForSublayer(0,U==="opaque"?qt.ReadWrite:qt.ReadOnly),K=d.colorModeForDrapableLayerRenderPass(S),ne=B?"backgroundPattern":"background";let ee,ge=f;if(ge||(ee=d.getBackgroundTiles(),ge=Object.values(ee).map(oe=>oe.tileID)),B&&(R.activeTexture.set(k.TEXTURE0),d.imageManager.bind(d.context,l.scope)),I){const oe=d.getOrCreateProgram(ne,{overrideFog:!1,overrideRtt:!0}),ve=new Float32Array(o.bz([])),pe=new o.aP(0,0,0,0,0),ce=B?np(ve,S,w,d,0,l.scope,j,I,{tileID:pe,tileSize:M}):ip(ve,S,w,_.toPremultipliedRenderColor(x?null:l.lut));oe.draw(d,k.TRIANGLES,q,Z,K,_r.disabled,ce,l.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const oe of ge){const ve=d.isTileAffectedByFog(oe),pe=d.getOrCreateProgram(ne,{overrideFog:ve}),ce=oe.toUnwrapped(),xe=f?oe.projMatrix:d.transform.calculateProjMatrix(ce);d.prepareDrawTile();const Me=r?r.getTile(oe):ee?ee[oe.key]:new Ya(oe,M,z.zoom,d),Ce=B?np(xe,S,w,d,0,l.scope,j,I,{tileID:oe,tileSize:M}):ip(xe,S,w,_.toPremultipliedRenderColor(x?null:l.lut));d.uploadCommonUniforms(R,pe,ce);const{tileBoundsBuffer:We,tileBoundsIndexBuffer:Ne,tileBoundsSegments:Qe}=d.getTileBoundsBuffers(Me);pe.draw(d,k.TRIANGLES,q,Z,K,_r.disabled,Ce,l.id,We,Ne,Qe)}},sky:function(d,r,l){const f=d._atmosphere?o.aj(d.transform.zoom):1,_=l.paint.get("sky-opacity")*f;if(_===0)return;const x=d.context,w=l.paint.get("sky-type"),S=new qt(x.gl.LEQUAL,qt.ReadOnly,[0,1]),I=d.frameCounter/1e3%1;w==="atmosphere"?d.renderPass==="offscreen"?l.needsSkyboxCapture(d)&&(function(R,k,z,M){const B=R.context,j=B.gl;let U=k.skyboxFbo;if(!U){U=k.skyboxFbo=B.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new r_(B),k.skyboxTexture=B.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,k.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ne=0;ne<6;++ne)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(U.framebuffer),B.viewport.set([0,0,32,32]);const Z=k.getCenter(R,!0),q=R.getOrCreateProgram("skyboxCapture"),K=new Float64Array(16);o.bz(K),o.em(K,K,.5*-Math.PI),ga(R,k,q,K,Z,0),o.bz(K),o.em(K,K,.5*Math.PI),ga(R,k,q,K,Z,1),o.bz(K),o.cT(K,K,.5*-Math.PI),ga(R,k,q,K,Z,2),o.bz(K),o.cT(K,K,.5*Math.PI),ga(R,k,q,K,Z,3),o.bz(K),ga(R,k,q,K,Z,4),o.bz(K),o.em(K,K,Math.PI),ga(R,k,q,K,Z,5),B.viewport.set([0,0,R.width,R.height])}(d,l),l.markSkyboxValid(d)):d.renderPass==="sky"&&function(R,k,z,M,B){const j=R.context,U=j.gl,Z=R.transform,q=R.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,k.skyboxTexture);const K=((ne,ee,ge,oe,ve)=>({u_matrix:ne,u_sun_direction:ee,u_cubemap:0,u_opacity:oe,u_temporal_offset:ve}))(Z.skyboxMatrix,k.getCenter(R,!1),0,M,B);R.uploadCommonUniforms(j,q),q.draw(R,U.TRIANGLES,z,Tr.disabled,R.colorModeForRenderPass(),_r.backCW,K,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(d,l,S,_,I):w==="gradient"&&d.renderPass==="sky"&&function(R,k,z,M,B){const j=R.context,U=j.gl,Z=R.transform,q=R.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new r_(j)),j.activeTexture.set(U.TEXTURE0);let K=k.colorRampTexture;K||(K=k.colorRampTexture=new o.T(j,k.colorRamp,U.RGBA8)),K.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ne=((ee,ge,oe,ve,pe)=>({u_matrix:ee,u_color_ramp:0,u_center_direction:ge,u_radius:o.an(oe),u_opacity:ve,u_temporal_offset:pe}))(Z.skyboxMatrix,k.getCenter(R,!1),k.paint.get("sky-gradient-radius"),M,B);R.uploadCommonUniforms(j,q),q.draw(R,U.TRIANGLES,z,Tr.disabled,R.colorModeForRenderPass(),_r.backCW,ne,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(d,l,S,_,I)},custom:function(d,r,l,f){const _=d.context,x=l.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&l.isDraped(r)){if(d.renderPass==="offscreen"){const w=x.prerender;if(w){if(d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;w.call(x,_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.aj(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else w.call(x,_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const S=x.renderToTile;if(S){const I=f[0].canonical,R={x:I.x+f[0].wrap*(x.wrapTileId?0:1<<I.z),y:I.y,z:I.z};_.setDepthMode(qt.disabled),_.setStencilMode(Tr.disabled),_.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),S.call(x,_.gl,R),_.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),_.setColorMode(d.colorModeForRenderPass()),_.setStencilMode(Tr.disabled);const w=x.renderingMode==="3d"?new qt(d.context.gl.LEQUAL,qt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,qt.ReadOnly);if(_.setDepthMode(w),d.transform.projection.name==="globe"){const S=d.transform.pointMerc;x.render(_.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),o.aj(d.transform.zoom),[S.x,S.y],d.transform.pixelsPerMeterRatio)}else x.render(_.gl,d.transform.customLayerMatrix());_.setDirty(),d.setBaseState(),_.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,r,l,f){if(d.renderPass==="opaque")return;const _=l.paint.get("model-opacity").constantOr(1),x=l.paint.get("model-elevation-reference"),w=x==="ground",S=x==="ground";if(_===0)return;const I=l.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!I||d.terrain&&_<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const R=d.shadowRenderer,k=l.paint.get("model-receive-shadows");R&&(R.useNormalOffset=!0,k||(R.enabled=!1));const z=()=>{R&&(R.useNormalOffset=!0,k||(R.enabled=!0))},M=r.getSource();if(d.renderPass==="light-beam"&&M.type!=="batched-model")return;if(M.type==="vector"||M.type==="geojson")return function(ee,ge,oe,ve,pe){const ce=ee.transform,xe=ce.projection.name==="globe",Me=ce.getFreeCameraOptions().position;if(!ee.modelManager)return;const Ce=ee.modelManager;oe.modelManager=Ce;const We=ee.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ne=oe._unevaluatedLayout._values["model-id"],Qe=Object.assign({},oe.layout.get("model-id").parameters),_t=ee.style.order.indexOf(oe.fqid);for(const Fe of ve){const Ie=ge.getTile(Fe).getBucket(oe);if(!Ie||Ie.projection.name!==ce.projection.name)continue;const et=Ie.getModelUris();if(et&&!Ie.modelsRequested&&(Ce.addModelsFromBucket(et,pe),Ie.modelsRequested=!0),xe)Qe.zoom=Fe.overscaledZ;else{const Ot=n_(Fe,ce);Qe.zoom=Ot}const je=Ne.possiblyEvaluate(Qe);if(cv(ee,Ie,Fe),jo.shadowUniformsInitialized=!1,jo.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(Fe.toUnwrapped())===0,ee.renderPass==="shadow"&&We){if(ee.currentShadowCascade===1&&Ie.isInsideFirstShadowMapFrustum)continue;const Ot=ce.calculatePosMatrix(Fe.toUnwrapped(),ce.worldSize);if(jo.tileMatrix.set(Ot),jo.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix(Ot)),jo.aabb.min=[0,0,0],jo.aabb.max[0]=jo.aabb.max[1]=o.al,jo.aabb.max[2]=0,mp(Ie,jo,ee,oe.scope))continue}const ot=1<<Fe.canonical.z,wt=[((Me.x-Fe.wrap)*ot-Fe.canonical.x)*o.al,(Me.y*ot-Fe.canonical.y)*o.al,Me.z*ot*o.al];ee.conflationActive&&Object.keys(Ie.instancesPerModel).length>0&&ee.style.isLayerClipped(oe,ge.getSource())&&Ie.updateReplacement(Fe,ee.replacementSource,_t,pe)&&(Ie.uploaded=!1,Ie.upload(ee.context));let jt=0;const pt=new Array,vt=new Array,$t=new Array;for(let Ot in Ie.instancesPerModel){const Rt=Ie.instancesPerModel[Ot];Rt.features.length>0&&!xe&&(Ot=je.evaluate(Rt.features[0].feature,{}));const Dt=Ce.getModel(Ot,pe);if(Dt||Ce.hasURLBeenRequested(Ot)||Ie.modelUris.includes(Ot)||(Ie.modelUris.push(Ot),Ie.modelsRequested=!1),Dt&&Dt.uploaded)if(xe){const lr=o.c4([],[Me.x,Me.y,Me.z],ee.transform.worldSize);o.ev(lr,lr);for(let Ur=0;Ur<Rt.instancedDataArray.length;++Ur){const Jr=[0,0,0],Ci=[1,1,1],yr=o.ew(),Kr=Rt.tileCoordinatesForInstance(Ur),kr=Rt.transformForInstance(Ur);o.ex(Ci,kr),o.ey(yr,kr),o.ez(Jr,yr);const Si=Rt.translationForInstance(Ur),Qr=new o.aS(0,0);o.eA(Ie.canonical,Qr,Kr.x,Kr.y);const Fi=o.bB();o.eB(Fi,Dt,ee.transform,Qr,Jr,Ci,Si,!0,!1,!1);const oi=Rt.colorForInstance(Ur),Mr=o.bz([]),pi=o.ee(Qr.lat,ee.transform.zoom),Lr=o.bp([],[1,1,1/pi]);o.bq(Mr,Mr,lr),$t.push({zScaleMatrix:Lr,negCameraPosMatrix:Mr});for(const $i of Dt.nodes)pp(ee,$i,Fi,ee.transform.expandedFarZProjMatrix,jt,pt,vt,Dt.materialOverrides,oi);++jt}}else for(const lr of Dt.nodes)s_(ee,oe,lr,Rt,wt,Fe,jo)}if(xe)if(ee.renderPass==="shadow"){for(const Ot of vt)Gu(Ot.mesh,Ot.nodeModelMatrix,ee,oe);for(const Ot of pt)Gu(Ot.mesh,Ot.nodeModelMatrix,ee,oe)}else lv(ee,oe,1,pt,vt,$t)}}(d,r,l,f,fp(M,l,d.style._importedAsBasemap)),void z();if(!M.loaded())return;if(M.type==="batched-model")return function(ee,ge,oe,ve){oe.resetLayerRenderingStats(ee);const pe=ee.context,ce=ee.transform,xe=ee.style.fog,Me=ee.shadowRenderer;if(ce.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ce.projection.name} projection is not yet implemented`);const Ce=ee.transform.getFreeCameraOptions().position,We=o.c4([],[Ce.x,Ce.y,Ce.z],ee.transform.worldSize),Ne=o.ev([],We),Qe=o.bz([]),_t=o.ee(ce.center.lat,ce.zoom),Fe=o.bp([],[1,1,1/_t]);o.bq(Qe,Qe,Ne);const Ie=oe.paint.get("model-opacity").constantOr(1),et=new qt(pe.gl.LEQUAL,qt.ReadWrite,ee.depthRangeFor3D),je=new qt(pe.gl.LEQUAL,qt.ReadOnly,ee.depthRangeFor3D),ot=new o.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),wt=ee.renderPass==="shadow",jt=wt&&Me?Me.getCurrentCascadeFrustum():ce.getFrustum(ce.scaleZoom(ce.worldSize)),pt=oe.paint.get("model-front-cutoff"),vt=pt[2]<1,$t=yl(ee,oe.paint.get("model-cutoff-fade-range")),Ot=oe.getLayerRenderingStats();(function(Rt,Dt,lr,Ur){const Jr=Rt.terrain?Rt.terrain.exaggeration():0,Ci=Rt.transform.zoom;for(const yr of Ur){const Kr=Dt.getTile(yr).getBucket(lr);Kr&&(Kr.setFilter(lr.filter),Rt.conflationActive&&Kr.updateReplacement(yr,Rt.replacementSource),Kr.evaluateTransform(Rt,lr),Rt.terrain&&Jr>0&&Kr.elevationUpdate(Rt.terrain,Jr,yr,lr.source),Kr.needsReEvaluation(Rt,Ci,lr)&&Kr.evaluate(lr))}})(ee,ge,oe,ve),function(){let Rt,Dt,lr;vt?(Rt=ve.length-1,Dt=-1,lr=-1):(Rt=0,Dt=ve.length,lr=1);const Ur=new Float64Array(16),Jr=o.cz(),Ci=new o.P(0,0);for(let yr=Rt;yr!==Dt;yr+=lr){const Kr=ve[yr],kr=ge.getTile(Kr).getBucket(oe);if(!kr||!kr.uploaded)continue;let Si=!1;Me&&(Si=Me.getMaxCascadeForTile(Kr.toUnwrapped())===0);const Qr=ce.calculatePosMatrix(Kr.toUnwrapped(),ce.worldSize),Fi=kr.modelTraits;!wt&&vt&&(o.bk(Ur,Qr),o.af(Jr,We,Ur),Ci.x=Jr[0],Ci.y=Jr[1]);const oi=[];kr.setFilter(oe.filter);for(const Mr of kr.getNodesInfo()){if(Mr.hiddenByReplacement||!Mr.node.meshes)continue;const pi=Mr.node;let Lr=0;ee.terrain&&pi.elevation&&(Lr=pi.elevation*ee.terrain.exaggeration());const $i=(()=>{const Os=Mr.aabb;return ot.min=[...Os.min],ot.max=[...Os.max],ot.min[2]+=Lr,ot.max[2]+=Lr,o.af(ot.min,ot.min,Qr),o.af(ot.max,ot.max,Qr),ot})(),gi=Mr.evaluatedScale;if(gi[0]<=1&&gi[1]<=1&&gi[2]<=1&&$i.intersects(jt)===0)continue;if(!wt&&vt){const Os=.16666666666666666;Mr.cameraCollisionOpacity=We[0]>$i.min[0]&&We[0]<$i.max[0]&&We[1]>$i.min[1]&&We[1]<$i.max[1]&&We[2]*_t<$i.max[2]&&pi.footprint&&o.b$(Ci,pi.footprint)?Math.max(Mr.cameraCollisionOpacity-Os,0):Math.min(1,Mr.cameraCollisionOpacity+Os)}const xr=[...Qr],ri=1/o.d6(Kr.canonical),on=pi.anchor?pi.anchor[0]:0,En=pi.anchor?pi.anchor[1]:0;o.bq(xr,xr,[on*(gi[0]-1)+Mr.evaluatedTranslation[0]*ri,En*(gi[1]-1)+Mr.evaluatedTranslation[1]*ri,Lr+Mr.evaluatedTranslation[2]]),o.cp(gi,o.eD)||o.cR(xr,xr,gi);const un=o.aB([],xr,pi.globalMatrix),_n=o.aB([],ce.expandedFarZProjMatrix,un),mo=o.aB([],ce.expandedFarZProjMatrix,xr),no=o.aC([],[on,En,Lr,1],_n)[2];pi.hidden=!1;let Es=Ie;wt||(vt&&(Es*=Mr.cameraCollisionOpacity,Es*=Hc(xr,ce,Mr.aabb,pt)),Es*=Md($t,no)),Es!==0?oi.push({nodeInfo:Mr,depth:no,opacity:Es,wvpForNode:_n,wvpForTile:mo,nodeModelMatrix:un,tileModelMatrix:xr}):pi.hidden=!0}wt||oi.sort((Mr,pi)=>!vt||Mr.opacity===1&&pi.opacity===1?Mr.depth<pi.depth?-1:1:Mr.opacity===1?-1:pi.opacity===1?1:Mr.depth>pi.depth?-1:1);for(const Mr of oi){const pi=Mr.nodeInfo,Lr=pi.node;let $i=o.aB([],Fe,Mr.tileModelMatrix);o.aB($i,Qe,$i);const gi=o.bk([],$i);o.ef(gi,gi),o.cR(gi,gi,uv),$i=o.aB($i,$i,Lr.globalMatrix);const xr=ee.renderPass==="light-beam",ri=oe.paint.get("model-color-use-theme").constantOr("default")==="none",on=Fi&o.eH.HasMapboxMeshFeatures,En=on?0:pi.evaluatedRMEA[0][2];for(let un=0;un<Lr.meshes.length;++un){const _n=Lr.meshes[un],mo=un===Lr.lightMeshIndex;let no=Mr.wvpForNode;if(mo){if(!xr&&!ee.terrain&&ee.shadowRenderer){ee.currentLayer<ee.firstLightBeamLayer&&(ee.firstLightBeamLayer=ee.currentLayer);continue}no=Mr.wvpForTile}else if(xr)continue;const Es={defines:[]},Os=[];if(!wt&&Me&&(Me.useNormalOffset=!!_n.normalBuffer),Uu(Es.defines,Os,_n,ee,ri?null:oe.lut),on||Es.defines.push("DIFFUSE_SHADED"),Si&&Es.defines.push("SHADOWS_SINGLE_CASCADE"),Ot&&(wt?Ot.numRenderedVerticesInShadowPass+=_n.vertexArray.length:Ot.numRenderedVerticesInTransparentPass+=_n.vertexArray.length),wt){Gu(_n,Mr.nodeModelMatrix,ee,oe);continue}let Uo=null;if(xe){const In=i_(Mr.nodeModelMatrix,ee.transform);if(Uo=new Float32Array(In),ce.projection.name!=="globe"){const Li=_n.aabb.min,Rn=_n.aabb.max,[cs,fn]=xe.getOpacityForBounds(In,Li[0],Li[1],Rn[0],Rn[1]);Es.overrideFog=cs>=Ue||fn>=Ue}}const Is=_n.material;let $o;Is.occlusionTexture&&Is.occlusionTexture.offsetScale&&($o=Is.occlusionTexture.offsetScale,Es.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const va=ee.getOrCreateProgram("model",Es);!wt&&Me&&Me.setupShadowsFromMatrix(Mr.tileModelMatrix,va,Me.useNormalOffset),ee.uploadCommonUniforms(pe,va,null,Uo);const ls=Is.pbrMetallicRoughness;ls.metallicFactor=.9,ls.roughnessFactor=.5;const dn=sp(new Float32Array(no),new Float32Array($i),new Float32Array(gi),new Float32Array(Lr.globalMatrix),ee,Mr.opacity,ls.baseColorFactor,Is.emissiveFactor,ls.metallicFactor,ls.roughnessFactor,Is,En,oe,[0,0,0],$o);!mo&&(pi.hasTranslucentParts||Mr.opacity<1)&&va.draw(ee,pe.gl.TRIANGLES,et,Tr.disabled,Dr.disabled,_r.backCCW,dn,oe.id,_n.vertexBuffer,_n.indexBuffer,_n.segments,oe.paint,ee.transform.zoom,void 0,Os),va.draw(ee,pe.gl.TRIANGLES,mo?je:et,Tr.disabled,mo||Mr.opacity<1||pi.hasTranslucentParts?Dr.alphaBlended:Dr.unblended,_r.backCCW,dn,oe.id,_n.vertexBuffer,_n.indexBuffer,_n.segments,oe.paint,ee.transform.zoom,void 0,Os)}}}}()}(d,r,l,f),void z();if(M.type!=="model")return;const B=M.getModels(),j=[],U=d.transform.getFreeCameraOptions().position,Z=o.c4([],[U.x,U.y,U.z],d.transform.worldSize);o.ev(Z,Z);const q=[],K=[];let ne=0;for(const ee of B){const ge=r.getFeatureState("",ee.id),oe={type:"Unknown",id:ee.id,properties:ee.featureProperties},ve=l.paint.get("model-rotation").evaluate(oe,ge),pe=l.paint.get("model-scale").evaluate(oe,ge),ce=l.paint.get("model-translation").evaluate(oe,ge);Hu(l,ee.id,ge,ee.featureProperties,ee.nodeOverrideNames,ee.nodeOverrides),wb(l,ee.id,ge,ee.featureProperties,ee.materialOverrideNames,ee.materialOverrides),ee.nodeOverrides.size>0&&ee.computeBoundsAndApplyParent(),ee.computeModelMatrix(d,ve,pe,ce,S,w,!1);const xe=o.bz([]),Me=o.ee(ee.position.lat,d.transform.zoom),Ce=o.bp([],[1,1,1/Me]);o.bq(xe,xe,Z),j.push({zScaleMatrix:Ce,negCameraPosMatrix:xe});for(const We of ee.nodes)pp(d,We,ee.matrix,d.transform.expandedFarZProjMatrix,ne,q,K,ee.materialOverrides);ne++}if(q.sort((ee,ge)=>ge.depth-ee.depth),d.renderPass!=="shadow")lv(d,l,_,q,K,j),z();else{for(const ee of K)Gu(ee.mesh,ee.nodeModelMatrix,d,l);for(const ee of q)Gu(ee.mesh,ee.nodeModelMatrix,d,l);z()}}},gp={line:function(d,r,l){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const f=r.getVisibleCoordinates();for(const _ of f){const x=r.getTile(_).getBucket(d);if(x&&(x.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,r,l){const f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson"){const x=fp(f,d,l.style._importedAsBasemap);return void(l.modelManager&&l.modelManager.upload(l,x))}if(f.type==="batched-model"||f.type!=="model")return;const _=f.getModels();for(const x of _)x.upload(l.context)},raster:function(d,r,l){const f=r.getSource();if(!(f instanceof es&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-array-band")||f.getInitialBand(_);if(x==null)return;const w=r.getIds().map(S=>r.getTileByID(S));for(const S of w)S.updateNeeded(d.id,x)&&f.prepareTile(S,_,d.id,x)},"raster-particle":function(d,r,l){const f=r.getSource();if(!(f instanceof es&&f.loaded()))return;const _=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!_)return;const x=d.paint.get("raster-particle-array-band")||f.getInitialBand(_);if(x==null)return;const w=r.getIds().map(S=>r.getTileByID(S));for(const S of w)S.updateNeeded(d.id,x)&&f.prepareTile(S,_,d.id,x)}},_p={fill:$c},Vo={fill:function(d,r,l,f){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const _=d.context.gl,x=new qt(_.LEQUAL,qt.ReadOnly,d.depthRangeFor3D),w=new Tr({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),S=d.transform.getFreeCameraOptions().position,I=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const R of f){const k=r.getTile(R),z=k.getBucket(l);if(!z)continue;const M=z.elevatedStructures;if(!M||M.depthSegments.segments[0].primitiveLength===0)continue;const B=rv(R.toUnwrapped(),S),j=d.translatePosMatrix(R.projMatrix,k,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),U=Qf(j,B,0,1,0);I.draw(d,_.TRIANGLES,x,w,Dr.disabled,_r.disabled,U,l.id,M.vertexBuffer,M.indexBuffer,M.depthSegments,l.paint,d.transform.zoom)}}};class ac{constructor(r,l,f,_,x,w){this.context=new ap(r,l),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of S)this._debugParams.enabledLayers[R]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of S)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new bb(x),this.setup(),this.numSublayers=ua.maxUnderzooming+ua.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _d(this),this._wireframeDebugCache=new dv,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,I,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=w}updateTerrain(r,l){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Id(this,r));const _=this._terrain;this.transform.elevation=f?_:null,_.update(r,this.transform,l),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(r){const l=r.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,_]=l.getFovAdjustedRange(this.transform._fov);if(f>_)return void(this.transform.fogCullDistSq=null);const x=f+.78*(_-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new Id(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,l){if(this.width=r*o.o.devicePixelRatio,this.height=l*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const r=this.context,l=new o.bc;l.emplaceBack(0,0),l.emplaceBack(o.al,0),l.emplaceBack(0,o.al),l.emplaceBack(o.al,o.al),this.tileExtentBuffer=r.createVertexBuffer(l,o.be.members),this.tileExtentSegments=o.bf.simpleSegment(0,0,4,2);const f=new o.bc;f.emplaceBack(0,0),f.emplaceBack(o.al,0),f.emplaceBack(0,o.al),f.emplaceBack(o.al,o.al),this.debugBuffer=r.createVertexBuffer(f,o.be.members),this.debugSegments=o.bf.simpleSegment(0,0,4,5);const _=new o.bc;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(_,o.be.members),this.viewportSegments=o.bf.simpleSegment(0,0,4,2);const x=new o.a$;x.emplaceBack(0,0,0,0),x.emplaceBack(o.al,0,o.al,0),x.emplaceBack(0,o.al,0,o.al),x.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=r.createVertexBuffer(x,o.bh.members),this.mercatorBoundsSegments=o.bf.simpleSegment(0,0,4,2);const w=new o.b0;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(w);const S=new o.bd;for(const R of[0,1,3,2,0])S.emplaceBack(R);this.debugIndexBuffer=r.createIndexBuffer(S),this.emptyTexture=new o.T(r,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bB();const I=this.context.gl;this.stencilClearMode=new Tr({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,qt.disabled,this.stencilClearMode,Dr.disabled,_r.disabled,Vc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,f){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const I of f)if(this._tileClippingMaskIDs[I.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const _=this.context,x=_.gl;this.nextStencilID+f.length>256&&this.clearStencil(),_.setColorMode(Dr.disabled),_.setDepthMode(qt.disabled);const w=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of f){const I=l.getTile(S),R=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:z,tileBoundsSegments:M}=this.getTileBoundsBuffers(I);w.draw(this,x.TRIANGLES,qt.disabled,new Tr({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),Dr.disabled,_r.disabled,Vc(S.projMatrix),"$clipping",k,z,M)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new Tr({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new Tr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,f=r.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=f[f.length-1].overscaledZ,x=f[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let S=0;S<x;S++)w[S+_]=new Tr({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[w,f]}return[{[_]:Tr.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Dr([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Dr.unblended:Dr.alphaBlended}colorModeForDrapableLayerRenderPass(r){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Dr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,l,f,_=!1){if(this.depthOcclusion)return new qt(this.context.gl.GREATER,qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return qt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new qt(f||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,l=Math.ceil(this.width),f=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),x=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&f!==0&&(this.depthFBO=new op(this.context,l,f,!1,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:f,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),r.bindTexture(r.TEXTURE_2D,x),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,l,f,0,0,l,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,l)=>r+l/this._fpsHistory.length,0))}render(r,l){const f=o.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=l;const _=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),w=()=>this.style._getOrder(x).filter(Fe=>{const Ie=_[Fe];return!(Ie.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ie.type]});let S=w(),I=!1,R=!1,k=null;for(const Fe of S){const Ie=_[Fe];Ie.type==="circle"?I=!0:Ie.type==="building"?k=Ie:Ie.type==="symbol"&&(Ie.hasOcclusionOpacityProperties?R=!0:I=!0)}let z=S.map(Fe=>_[Fe]);const M=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();let B=0,j=!1;for(const Fe in M){const Ie=M[Fe];Ie.used&&(Ie.prepare(this.context),Ie.getSource().usedInConflation&&++B)}let U=!1;for(const Fe of z)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(U=!0),this.prepareLayer(Fe));const Z={},q={},K={},ne={},ee={};for(const Fe in M){const Ie=M[Fe];Z[Fe]=Ie.getVisibleCoordinates(),q[Fe]=Z[Fe].slice().reverse(),K[Fe]=Ie.getVisibleCoordinates(!0).reverse(),ne[Fe]=Ie.getShadowCasterCoordinates(),ee[Fe]=Ie.sortCoordinatesByDistance(Z[Fe])}const ge=Fe=>{const Ie=this.style.getLayerSourceCache(Fe);return Ie&&Ie.used?Ie.getSource():null};if(B||U||this._clippingActiveLastFrame){const Fe=[],Ie=[];let et=0;for(const je of z)this.isSourceForClippingOrConflation(je,ge(je))&&(Fe.push(je),Ie.push(et)),et++;if(Fe&&(U||Fe.length>1)||this._clippingActiveLastFrame){U=!1;const je=[];for(let ot=0;ot<Fe.length;ot++){const wt=Fe[ot],jt=Ie[ot],pt=this.style.getLayerSourceCache(wt);if(!pt||!pt.used||!pt.getSource().usedInConflation&&wt.type!=="clip"&&wt.type!=="building")continue;let vt=o.eP,$t=o.bZ.None;const Ot=[];let Rt=!0;if(wt.type==="building")vt=o.eR;else if(wt.type==="clip"){vt=jt;for(const Dt of wt.layout.get("clip-layer-types"))$t|=Dt==="model"?o.bZ.Model:Dt==="symbol"?o.bZ.Symbol:o.bZ.FillExtrusion;for(const Dt of wt.layout.get("clip-layer-scope"))Ot.push(Dt);wt.isHidden(this.transform.zoom)?Rt=!1:U=!0}Rt&&je.push({layer:wt.fqid,cache:pt,order:vt,clipMask:$t,clipScope:Ot})}this.replacementSource.setSources(je),j=!0}}this._clippingActiveLastFrame=U,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<z.length;Fe++){const Ie=z[Fe],et=Ie.cutoffRange();if(this.longestCutoffRange=Math.max(et,this.longestCutoffRange),et>0){const je=ge(Ie);je&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom)),Ie.minzoom&&(this.minCutoffZoom=Math.max(Ie.minzoom,this.minCutoffZoom))}Ie.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const oe=this.style&&this.style.fog;oe?(this._fogVisible=oe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=oe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(K),this.opaquePassCutoff=0,S=w(),z=S.map(Fe=>_[Fe]));const ve=this._shadowRenderer;if(ve){ve.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in M)for(const Ie of Z[Fe]){let et={min:0,max:0};this.terrain&&(et=this.terrain.getMinMaxForTile(Ie)||et),ve.addShadowReceiver(Ie.toUnwrapped(),et.min,et.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new gn(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(pe&&!this._snow&&(this._snow=new a_(this)),!pe&&this._snow&&(this._snow.destroy(),delete this._snow),ce&&!this._rain&&(this._rain=new qu(this)),!ce&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),k){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Le);const Fe=this.style.getLayerSourceCache(k);this.buildingTileBorderManager.updateBorders(Fe,k)}if(!bi.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of z){const Ie=r.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const et=Ie?q[Ie.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||et&&et.length)&&this.renderLayer(this,Ie,Fe,et)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const xe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Me=(()=>{if(l.showOverdrawInspector)return o.ao.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Ie=this.style.getLut(Fe.scope);if(!xe){const et=Fe.properties.get("color-use-theme")==="none",je=Fe.properties.get("color").toNonPremultipliedRenderColor(et?null:Ie).toArray01();return new o.ao(...je)}if(xe){const et=Fe.properties.get("space-color-use-theme")==="none",je=Fe.properties.get("space-color").toNonPremultipliedRenderColor(et?null:Ie).toArray01();return new o.ao(...je)}}return o.ao.transparent})();if(this.context.clear({color:Me,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=z[this.currentLayer],Ie=r.getLayerSourceCache(Fe);if(Fe.isSky())continue;const et=Ie?(Fe.is3D(x)?ee:q)[Ie.id]:void 0;this._renderTileClippingMasks(Fe,Ie,et),this.renderLayer(this,Ie,Fe,et)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&xe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const Fe=z[this.currentLayer],Ie=r.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Ie,Fe,Ie?q[Ie.id]:void 0)}function Ce(Fe,Ie){let et;return Ie&&(et=(Fe.type==="symbol"?K:Fe.is3D(x)?ee:q)[Ie.id]),et}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const Fe=z[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Ie=r.getLayerSourceCache(Fe);this.renderLayer(this,Ie,Fe,Ce(Fe,Ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let We=0;ve&&(We=ve.getShadowCastingLayerCount());let Ne=!1,Qe=-1;for(let Fe=0;Fe<S.length;++Fe){const Ie=z[Fe];Ie.isHidden(this.transform.zoom)||Ie.is3D(x)&&(Qe=Fe)}R&&Qe===-1&&(I=!0);let _t=!1;for(;this.currentLayer<S.length;){const Fe=z[this.currentLayer],Ie=r.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Fe.is3D(x)&&!x){const et=this.currentLayer,je=ot=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const wt=z[this.currentLayer];if(_p[wt.type]){const jt=this.style.getLayerSourceCache(wt);_p[wt.type](this,jt,wt,Ce(wt,jt),ot)}}};je("initialize"),je("reset"),this.currentLayer=et,_t=!0}if(I&&!Ne&&this.terrain&&!this.transform.isOrthographic&&(Ne=!0,this.blitDepth()),R&&Qe!==-1&&this.currentLayer===Qe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Ie,Ie?Z[Ie.id]:void 0),this.renderLayer(this,Ie,Fe,Ce(Fe,Ie)),!this.terrain&&ve&&We>0&&Fe.hasShadowPass()&&--We==0){{this.clearStencil(),this.resetStencilClippingMasks();const et=this.currentLayer;for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const je=z[this.currentLayer];if(Vo[je.type]){const ot=this.style.getLayerSourceCache(je);Vo[je.type](this,ot,je,Ce(je,ot))}}this.currentLayer=et}if(ve.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const et=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=et;this.currentLayer++){const je=z[this.currentLayer];if(!je.hasLightBeamPass())continue;const ot=r.getLayerSourceCache(je);this.renderLayer(this,ot,je,ot?q[ot.id]:void 0)}this.currentLayer=et,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const et=this.currentLayer;this.depthOcclusion=!0;for(const je of this.layersWithOcclusionOpacity){this.currentLayer=je;const ot=z[this.currentLayer],wt=r.getLayerSourceCache(ot),jt=wt?q[wt.id]:void 0;this.terrain||this._renderTileClippingMasks(ot,wt,wt?Z[wt.id]:void 0),this.renderLayer(this,wt,ot,jt)}this.depthOcclusion=!1,this.currentLayer=et,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;z.forEach(Ie=>{const et=r.getLayerSourceCache(Ie);et&&!Ie.isHidden(this.transform.zoom)&&et.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<et.getSource().maxzoom)&&(Fe=et)}),Fe&&this.options.showTileBoundaries&&t_(this,Fe,Fe.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&t_(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Ie=Fe.transform.padding;Ui(Fe,Fe.transform.height-(Ie.top||0),3,oc),Ui(Fe,Ie.bottom||0,3,sv),kd(Fe,Ie.left||0,3,Jg),kd(Fe,Fe.transform.width-(Ie.right||0),3,Qg);const et=Fe.transform.centerPoint;(function(je,ot,wt,jt){ju(je,ot-1,wt-10,2,20,jt),ju(je,ot-10,wt-1,20,2,jt)})(Fe,et.x,Fe.transform.height-et.y,e_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:l}=this.transform.projection,f=!l||!l.includes(r.type);if(gp[r.type]&&(f||this.terrain&&r.type==="custom")){const _=this.style.getLayerSourceCache(r);gp[r.type](r,_,this)}this.gpuTimingEnd()}renderLayer(r,l,f,_){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||_&&_.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||l_[f.type](r,l,f,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,f=this.context.gl;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),_.calls++,f.beginQuery(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=this.context.gl,f=l.createQuery();this.deferredRenderGpuTimeQueries.push(f),l.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const f in r){const _=r[f],x=this.context.extTimerQuery,w=x.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(_.query),l[f]=w}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let f=0;for(const _ of r)f+=l.getQueryParameter(_,l.QUERY_RESULT)/1e6,l.deleteQuery(_);return f}translatePosMatrix(r,l,f,_,x){if(!f[0]&&!f[1])return r;const w=x?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(w){const R=Math.sin(w),k=Math.cos(w);f=[f[0]*k-f[1]*R,f[0]*R+f[1]*k]}const S=[x?f[0]:o.ay(l,f[0],this.transform.zoom),x?f[1]:o.ay(l,f[1],this.transform.zoom),0],I=new Float32Array(16);return o.bq(I,r,S),I}saveTileTexture(r){if(r.context!==this.context)return;const l=r.size[0],f=this._tileTextures[l];f?f.push(r):this._tileTextures[l]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,l,f){const _=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||l!==void 0&&!l||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,l){this.cache=this.cache||{};const f=l&&l.defines||[],_=l&&l.config,x=this.currentGlobalDefines(r,l&&l.overrideFog,l&&l.overrideRtt).concat(f),w=Ad.cacheKey(Nf[r],r,x,_);return this.cache[w]||(this.cache[w]=new Ad(this.context,r,Nf[r],_,_b[r],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,l){if(this.style.enable3dLights()){const f=this.style.directionalLight,_=this.style.ambientLight;if(f&&_){const x=((w,S,I)=>{const R=w.properties.get("direction"),k=w.properties.get("color-use-theme")==="none",z=w.properties.get("color").toNonPremultipliedRenderColor(k?null:I.getLut(w.scope)).toArray01(),M=w.properties.get("intensity"),B=S.properties.get("color-use-theme")==="none",j=S.properties.get("color").toNonPremultipliedRenderColor(B?null:I.getLut(S.scope)).toArray01(),U=S.properties.get("intensity"),Z=[R.x,R.y,R.z],q=o.dM(j,U),K=o.dM(z,M);return{u_lighting_ambient_color:q,u_lighting_directional_dir:Z,u_lighting_directional_color:K,u_ground_radiance:zg(Z,K,q)}})(f,_,this.style);l.setLightsUniformValues(r,x)}}}uploadCommonUniforms(r,l,f,_,x){if(this.uploadCommonLightUniforms(r,l),this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const S=w.getOpacity(this.transform.pitch),I=((R,k,z,M,B,j,U,Z,q,K,ne,ee)=>{const ge=R.transform,oe=k.properties.get("color-use-theme")==="none",ve=k.properties.get("color").toNonPremultipliedRenderColor(oe?null:R.style.getLut(k.scope)).toArray01();ve[3]=M;const pe=R.frameCounter/1e3%1,[ce,xe]=k.properties.get("vertical-range");return{u_fog_matrix:z?ge.calculateFogTileMatrix(z):ee||R.identityMat,u_fog_range:k.getFovAdjustedRange(ge._fov),u_fog_color:ve,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,xe),xe],u_fog_temporal_offset:pe,u_frustum_tl:B,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:Z,u_globe_pos:q,u_globe_radius:K,u_viewport:ne,u_globe_transition:o.aj(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,w,f,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],_);l.setFogUniformValues(r,I)}x&&l.setCutoffUniformValues(r,x.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const _ of f)l[_.key]=r[_.key]||new Ya(_,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,l){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[r.key];return l||(this._cachedTileFogOpacities[r.key]=l=this.style.fog.getOpacityForTile(r)),l[0]>=Ue||l[1]>=Ue}setupDepthForOcclusion(r,l,f){const _=this.context,x=_.gl,w=!!f;var S;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(x.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),_.activeTexture.set(x.TEXTURE0),w||l.setTerrainUniformValues(_,f)}}function Wc(d,r){let l=!1,f=null;const _=()=>{f=null,l&&(d(),f=setTimeout(_,r),l=!1)};return()=>(l=!0,f||_(),f)}class yp{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Wc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=vp(r);if(this._hashName){const f=this._hashName;let _=!1;const x=location.hash.slice(1).split("&").map(w=>{const S=w.split("=")[0];return S===f?(_=!0,`${S}=${l}`):w}).filter(w=>w);return _||x.push(`${f}=${l}`),`#${x.join("&")}`}return`#${l}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(l=f)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(f=>isNaN(Number(f)))){const f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function vp(d,r){const l=d.getCenter(),f=Math.round(100*d.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),w=Math.round(l.lng*x)/x,S=Math.round(l.lat*x)/x,I=d.getBearing(),R=d.getPitch();let k=r?`/${w}/${S}/${f}`:`${f}/${S}/${w}`;return(I||R)&&(k+="/"+Math.round(10*I)/10),R&&(k+=`/${Math.round(R)}`),k}const Wu={linearity:.3,easing:o.eS(0,0,.3,1)},lc=Object.assign({deceleration:2500,maxSpeed:1400},Wu),c_=Object.assign({deceleration:20,maxSpeed:1400},Wu),_a=Object.assign({deceleration:1e3,maxSpeed:360},Wu),u_=Object.assign({deceleration:1e3,maxSpeed:90},Wu);class xp{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=o.o.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const x=Xu(l.pan.mag(),f,Object.assign({},lc,r||{}));_.offset=l.pan.mult(x.amount/l.pan.mag()),_.center=this._map.transform.center,Zu(_,x)}if(l.zoom){const x=Xu(l.zoom,f,c_);_.zoom=this._map.transform.zoom+x.amount,Zu(_,x)}if(l.bearing){const x=Xu(l.bearing,f,_a);_.bearing=this._map.transform.bearing+o.aA(x.amount,-179,179),Zu(_,x)}if(l.pitch){const x=Xu(l.pitch,f,u_);_.pitch=this._map.transform.pitch+x.amount,Zu(_,x)}if(_.zoom||_.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function Zu(d,r){(!d.duration||d.duration<r.duration)&&(d.duration=r.duration,d.easing=r.easing)}function Xu(d,r,l){const{maxSpeed:f,linearity:_,deceleration:x}=l,w=o.aA(d*_/(r/1e3),-f,f),S=Math.abs(w)/(x*_);return{easing:l.easing,duration:1e3*S,amount:w*(S/2)}}class rn extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f,_={}){const x=bt(l.getCanvasContainer(),f),w=l.unproject(x);super(r,Object.assign({point:x,lngLat:w,originalEvent:f},_)),this._defaultPrevented=!1,this.target=l}}class Ku extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,f){const _=r==="touchend"?f.changedTouches:f.touches,x=Bt(l.getCanvasContainer(),_),w=x.map(I=>l.unproject(I)),S=x.reduce((I,R,k,z)=>I.add(R.div(z.length)),new o.P(0,0));super(r,{points:x,point:S,lngLats:w,lngLat:l.unproject(S),originalEvent:f}),this._defaultPrevented=!1}}class h_ extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class d_{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new h_(this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new rn(r.type,this._map,r))}mouseup(r){this._map.fire(new rn(r.type,this._map,r))}preclick(r){const l=new MouseEvent("preclick",r);this._map.fire(new rn(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new rn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new rn(r.type,this._map,r))}mouseover(r){this._map.fire(new rn(r.type,this._map,r))}mouseout(r){this._map.fire(new rn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ku(r.type,this._map,r))}touchmove(r){this._map.fire(new Ku(r.type,this._map,r))}touchend(r){this._map.fire(new Ku(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ku(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zc{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new rn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new rn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new rn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class f_{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&r.button===0&&(Oe(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const f=l,_=this._startPos,x=this._lastPos;if(!_||!x||x.equals(f)||!this._box&&f.dist(_)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const w=Math.min(_.x,f.x),S=Math.max(_.x,f.x),I=Math.min(_.y,f.y),R=Math.max(_.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${w}px,${I}px)`,this._box.style.width=S-w+"px",this._box.style.height=R-I+"px")})}mouseupWindow(r,l){if(!this._active)return;const f=this._startPos,_=l;if(f&&r.button===0){if(this.reset(),Be(),f.x!==_.x||f.y!==_.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:r})),{cameraAnimation:x=>x.fitScreenCoordinates(f,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xe(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new o.z(r,{originalEvent:l}))}}function Dd(d,r){const l={};for(let f=0;f<d.length;f++)l[d[f].identifier]=r[f];return l}class p_{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(_){const x=new o.P(0,0);for(const w of _)x._add(w);return x.div(_.length)}(l),this.touches=Dd(f,l)))}touchmove(r,l,f){if(this.aborted||!this.centroid)return;const _=Dd(f,l);for(const x in this.touches){const w=_[x];(!w||w.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(r,l,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class cc{constructor(r){this.singleTap=new p_(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,f){this.singleTap.touchstart(r,l,f)}touchmove(r,l,f){this.singleTap.touchmove(r,l,f)}touchend(r,l,f){const _=this.singleTap.touchend(r,l,f);if(_){const x=r.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(x&&w||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class m_{constructor(){this._zoomIn=new cc({numTouches:1,numTaps:2}),this._zoomOut=new cc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,f){this._zoomIn.touchstart(r,l,f),this._zoomOut.touchstart(r,l,f)}touchmove(r,l,f){this._zoomIn.touchmove(r,l,f),this._zoomOut.touchmove(r,l,f)}touchend(r,l,f){const _=this._zoomIn.touchend(r,l,f),x=this._zoomOut.touchend(r,l,f);return _?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:r})}):x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const wp={0:1,2:2},bp={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Yu{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const f=Jt(r);this._correctButton(r,f)&&(this._lastPoint=l,this._eventButton=f)}mousemoveWindow(r,l){const f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(_,x){const w=wp[x];return _.buttons===void 0||(_.buttons&w)!==w}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(f,l)}}mouseupWindow(r){this._lastPoint&&Jt(r)===this._eventButton&&(this._moved&&Be(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class g_ extends Yu{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return l===0&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class Tp extends Yu{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?bp[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?l===0&&r[this._pitchRotateKey]:l===0&&r.ctrlKey||l===2}_move(r,l){const f=.8*(l.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class __ extends Yu{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?bp[r.pitchRotateKey]:void 0}_correctButton(r,l){return this._pitchRotateKey?l===0&&r[this._pitchRotateKey]:l===0&&r.ctrlKey||l===2}_move(r,l){const f=-.5*(l.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class pv{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,l,f){return this._calculateTransform(r,l,f)}touchmove(r,l,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!o.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,f)}}touchend(r,l,f){this._calculateTransform(r,l,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,f){f.length>0&&(this._active=!0);const _=Dd(f,l),x=new o.P(0,0),w=new o.P(0,0);let S=0;for(const R in _){const k=_[R],z=this._touches[R];z&&(x._add(k),w._add(k.sub(z)),S++,_[R]=k)}if(this._touches=_,S<this._minTouches||!w.mag())return;const I=w.div(S);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Sp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,f){return{}}touchstart(r,l,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,f){const _=this._firstTwoTouches;if(!_)return;r.preventDefault();const[x,w]=_,S=Ld(f,l,x),I=Ld(f,l,w);if(!S||!I)return;const R=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],R,r)}touchend(r,l,f){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,w=Ld(f,l,_),S=Ld(f,l,x);w&&S||(this._active&&Be(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ld(d,r,l){for(let f=0;f<d.length;f++)if(d[f].identifier===l)return r[f]}function y_(d,r){return Math.log2(d/r)}class mv extends Sp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(y_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:y_(this._distance,f),pinchAround:l}}}function v_(d,r){return 180*d.angleWith(r)/Math.PI}class gv extends Sp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:v_(this._vector,f),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const _=v_(r,f);return Math.abs(_)<l}}function Ep(d){return Math.abs(d.y)>Math.abs(d.x)}class _v extends Sp{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Ep(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,f){const _=this._lastPoints;if(!_)return;const x=r[0].sub(_[0]),w=r[1].sub(_[1]);return this._map._cooperativeGestures&&!o.eT()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,w,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+w.y)/2*-.5})}gestureBeginsVertically(r,l,f){if(this._valid!==void 0)return this._valid;const _=r.mag()>=2,x=l.mag()>=2;if(!_&&!x)return;if(!_||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const w=r.y>0==l.y>0;return Ep(r)&&Ep(l)&&w}}const yv={panStep:100,bearingStep:15,pitchStep:10};class vv{constructor(){const r=yv;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,f=0,_=0,x=0,w=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),x=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),x=1);break;case 38:r.shiftKey?_=1:(r.preventDefault(),w=-1);break;case 40:r.shiftKey?_=-1:(r.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(f=0,_=0),{cameraAnimation:S=>{const I=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:xv,zoom:l?Math.round(I)+l*(r.shiftKey?2:1):I,bearing:S.getBearing()+f*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xv(d){return d*(2-d)}const wv=4.000244140625,Eb=1/450;class Ib{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Eb,o.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.o.now(),_=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,l!==0&&l%wv==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=bt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>wv?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&k!==0&&(k=1/k);const z=l(),M=Math.pow(2,z),B=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):M;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(B*k))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,x=this._easing;let w,S=!1;if(this._type==="wheel"&&_&&x){const R=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),k=x(R);w=o.ak(_,f,k),R<1?this._frameId||(this._frameId=!0):S=!0}else w=f,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=w-l();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=o.eU;if(this._prevEase){const f=this._prevEase,_=(o.o.now()-f.start)/f.duration,x=f.easing(_+.01)-f.easing(_),w=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-w*w);l=o.eS(w,S,.25,1)}return this._prevEase={start:o.o.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class cn{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bv{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ab{constructor(){this._tap=new cc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=l[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,l,f))}touchmove(r,l,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const _=l[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,r.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(r,l,f)}touchend(r,l,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,l,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cb{constructor(r,l,f){this._el=r,this._mousePan=l,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pb{constructor(r,l,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class zd{constructor(r,l,f,_){this._el=r,this._touchZoom=l,this._touchRotate=f,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fd=d=>d.zoom||d.drag||d.pitch||d.rotate;class x_ extends o.z{}class Ip{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const f=o.av([],l,r);this.radius=o.ag(f[2]<0?o.eW([],f,this.constants):[f[0],f[1],0])}projectRay(r){o.eW(r,r,this.constants),o.aw(r,r),o.eX(r,r,this.constants);const l=o.c4([],r,this.radius);if(l[2]>0){const f=o.c4([],[0,0,1],o.bI(l,[0,0,1])),_=o.c4([],o.aw([],[l[0],l[1],0]),this.radius),x=o.d7([],l,o.c4([],o.av([],o.d7([],_,f),l),2));l[0]=x[0],l[1]=x[1]}return l}}function ya(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Ap{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xp(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ip,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aX(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,x,w]of this._listeners){const S=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(x,S,w)}}destroy(){for(const[r,l,f]of this._listeners){const _=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(l,_,f)}}_addDefaultHandlers(r){const l=this._map,f=l.getCanvasContainer();this._add("mapEvent",new d_(l,r));const _=l.boxZoom=new f_(l,r);this._add("boxZoom",_);const x=new m_,w=new bv;l.doubleClickZoom=new cn(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const S=new Ab;this._add("tapDragZoom",S);const I=l.touchPitch=new _v(l);this._add("touchPitch",I);const R=new Tp(r),k=new __(r);l.dragRotate=new Pb(r,R,k),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const z=new g_(r),M=new pv(l,r);l.dragPan=new Cb(f,z,M),this._add("mousePan",z),this._add("touchPan",M,["touchZoom","touchRotate"]);const B=new gv,j=new mv;l.touchZoomRotate=new zd(f,j,B,S),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Zc(l));const U=l.scrollZoom=new Ib(l,this);this._add("scrollZoom",U,["mousePan"]);const Z=l.keyboard=new vv;this._add("keyboard",Z);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[q]&&l[q].enable(r[q])}_add(r,l,f){this._handlers.push({handlerName:r,handler:l,allowed:f}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fd(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,f){for(const _ in r)if(_!==f&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const f of r)this._el.contains(f.target)&&l.push(f);return l}handleEvent(r,l){this._updatingCamera=!0;const f=r.type==="renderFrame",_=f?void 0:r,x={needsRenderFrame:!1},w={},S={},I=r.touches?this._getMapTouches(r.touches):void 0,R=I?Bt(this._el,I):f?void 0:bt(this._el,r);for(const{handlerName:M,handler:B,allowed:j}of this._handlers){if(!B.isEnabled())continue;let U;this._blockedByActive(S,j,M)?B.reset():B[l||r.type]&&(U=B[l||r.type](r,R,I),this.mergeHandlerResult(x,w,U,M,_),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||B.isActive())&&(S[M]=B)}const k={};for(const M in this._previousActiveHandlers)S[M]||(k[M]=_);this._previousActiveHandlers=S,(Object.keys(k).length||ya(x))&&(this._changes.push([x,w,k]),this._triggerRenderFrame()),(Object.keys(S).length||ya(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=x;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(r,l,f,_,x){if(!f)return;Object.assign(r,f);const w={handlerName:_,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(l.zoom=w),f.panDelta!==void 0&&(l.drag=w),f.pitchDelta!==void 0&&(l.pitch=w),f.bearingDelta!==void 0&&(l.rotate=w)}_applyChanges(){const r={},l={},f={};for(const[_,x,w]of this._changes)_.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(_.panDelta)),_.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(r.around=_.around),_.aroundCoord!==void 0&&(r.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(r.pinchAround=_.pinchAround),_.noInertia&&(r.noInertia=_.noInertia),Object.assign(l,x),Object.assign(f,w);this._updateMapTransform(r,l,f),this._changes=[]}_updateMapTransform(r,l,f){const _=this._map,x=_.transform,w=K=>[K.x,K.y,K.z];if((K=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!ya(r)){const K=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),K!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&_._stop(!0),!ya(r))return void this._fireEvents(l,f,!0);let{panDelta:S,zoomDelta:I,bearingDelta:R,pitchDelta:k,around:z,aroundCoord:M,pinchAround:B}=r;x._isCameraConstrained&&(I>0&&(I=0),x._isCameraConstrained=!1),B!==void 0&&(z=B),(I||(K=>l[K]&&!this._eventsInProgress[K])("drag"))&&z&&(this._dragOrigin=w(x.pointCoordinate3D(z)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),z=z||_.transform.centerPoint,R&&(x.bearing+=R),k&&(x.pitch+=k),x._updateCameraState();const j=[0,0,0];if(S)if(x.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z).dir),ne=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(z.sub(S)).dir);j[0]=ne[0]-K[0],j[1]=ne[1]-K[1]}else{const K=x.pointCoordinate(z);if(x.projection.name==="globe"){S=S.rotate(-x.angle);const ne=x._pixelsPerMercatorPixel/x.worldSize;j[0]=-S.x*o.eV(o.a_(K.y))*ne,j[1]=-S.y*o.eV(x.center.lat)*ne}else{const ne=x.pointCoordinate(z.sub(S));K&&ne&&(j[0]=ne.x-K.x,j[1]=ne.y-K.y)}}const U=x.zoom,Z=[0,0,0];if(I){const K=w(M||x.pointCoordinate3D(z)),ne={dir:o.aw([],o.av([],K,x._camera.position))};if(ne.dir[2]<0){const ee=x.zoomDeltaToMovement(K,I);o.c4(Z,ne.dir,ee)}}const q=o.d7(j,j,Z);x._translateCameraConstrained(q),I&&Math.abs(x.zoom-U)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,f,!0)}_fireEvents(r,l,f){const _=Fd(this._eventsInProgress),x=Fd(r),w={};for(const k in r){const{originalEvent:z}=r[k];this._eventsInProgress[k]||(w[`${k}start`]=z),this._eventsInProgress[k]=r[k]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const k in w)this._fireEvent(k,w[k]);x&&this._fireEvent("move",x.originalEvent);for(const k in r){const{originalEvent:z}=r[k];this._fireEvent(k,z)}const S={};let I;for(const k in this._eventsInProgress){const{handlerName:z,originalEvent:M}=this._eventsInProgress[k];this._handlersById[z].isActive()||(delete this._eventsInProgress[k],I=l[z]||M,S[`${k}end`]=I)}for(const k in S)this._fireEvent(k,S[k]);const R=Fd(this._eventsInProgress);if(f&&(_||x)&&!R){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=M=>M!==0&&-this._bearingSnap<M&&M<this._bearingSnap;k?(z(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:I})):(this._map.fire(new o.z("moveend",{originalEvent:I})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new o.z(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new x_("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Dn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rl extends o.E{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aX(["_renderFrameCallback"],this)}getCenter(){return new o.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,Object.assign({offset:r},l),f)}panTo(r,l,f){return this.easeTo(Object.assign({center:r},l),f)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,f){return this.easeTo(Object.assign({zoom:r},l),f)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,f){return this.easeTo(Object.assign({bearing:r},l),f)}resetNorth(r,l){return this.rotateTo(0,Object.assign({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=o.aI.convert(r);const f=l&&l.bearing||0,_=l&&l.pitch||0,x=r.getNorthWest(),w=r.getSouthEast();return this._cameraForBounds(this.transform,x,w,f,_,l)}_extendPadding(r){const l={top:0,right:0,bottom:0,left:0};return r==null?Object.assign({},l,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:Object.assign({},l,r)}_extendCameraOptions(r){return(r=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,l){const f=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return f/_>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):_/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,f,_,x,w){const S=r.clone(),I=this._extendCameraOptions(w);S.bearing=_,S.pitch=x;const R=o.aS.convert(l),k=o.aS.convert(f),z=.5*(R.lat+k.lat),M=.5*(R.lng+k.lng),B=o.eY(z,M),j=o.aw([],B),U=o.aw([],o.bH([],j,[0,1,0])),Z=o.bH([],U,j),q=[U[0],U[1],U[2],0,Z[0],Z[1],Z[2],0,j[0],j[1],j[2],0,0,0,0,1],K=[B,o.eY(R.lat,R.lng),o.eY(k.lat,R.lng),o.eY(k.lat,k.lng),o.eY(R.lat,k.lng),o.eY(z,R.lng),o.eY(z,k.lng),o.eY(R.lat,M),o.eY(k.lat,M)];let ne=o.d8.fromPoints(K.map(je=>[o.bI(U,je),o.bI(Z,je),o.bI(j,je)]));const ee=o.af([],ne.center,q);o.eZ(ee)===0&&o.e_(ee,0,0,1),o.aw(ee,ee),o.c4(ee,ee,o.aD),S.center=o.e$(ee);const ge=S.getWorldToCameraMatrix(),oe=o.bk(new Float64Array(16),ge);ne=o.d8.applyTransform(ne,o.aB([],ge,q));const ve=this._extendAABB(ne,S,I,_);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=ve,o.af(ee,ee,ge);const pe=.5*(ne.max[2]-ne.min[2]),ce=this._minimumAABBFrustumDistance(S,ne),xe=o.c4([],[0,0,1],pe),Me=o.d7(xe,ee,xe),Ce=ce+(S.pitch===0?0:o.bF(ee,Me)),We=S.globeCenterInViewSpace,Ne=o.av([],ee,[We[0],We[1],We[2]]);o.aw(Ne,Ne),o.c4(Ne,Ne,Ce);const Qe=o.d7([],ee,Ne);o.af(Qe,Qe,oe);const _t=o.eL/o.aD,Fe=o.ag(Qe),Ie=o.ce(Math.max(Fe*_t-o.eL,Number.EPSILON),0),et=Math.min(S.zoomFromMercatorZAdjusted(Ie),I.maxZoom);return et>.5*(o.cZ+o.cK)?(S.setProjection({name:"mercator"}),S.zoom=et,this._cameraForBounds(S,l,f,_,x,w)):{center:S.center,zoom:et,bearing:_,pitch:x}}_extendAABB(r,l,f,_){const x=.5*((f.padding.left||0)+(f.padding.right||0)),w=.5*((f.padding.top||0)+(f.padding.bottom||0)),S=w,I=x,R=x,k=w,z=l.width-(I+R),M=l.height-(S+k),B=o.av([],r.max,r.min),j=Math.min(z/B[0],M/B[1]),U=Math.min(l.scaleZoom(l.scale*j),f.maxZoom);if(isNaN(U))return null;const Z=l.scale/l.zoomScale(U),q=new o.d8([r.min[0]-I*Z,r.min[1]-k*Z,r.min[2]],[r.max[0]+R*Z,r.max[1]+S*Z,r.max[2]]),K=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new o.P(f.offset.x,f.offset.y):o.P.convert(f.offset)).rotate(-o.an(_));return q.center[0]-=K.x*Z,q.center[1]+=K.y*Z,q}queryTerrainElevation(r,l){const f=this.transform.elevation;return f?(l=Object.assign({},{exaggerated:!0},l),f.getAtPoint(o.ae.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,f,_,x,w){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,l,f,_,x,w);const S=r.clone(),I=this._extendCameraOptions(w);S.bearing=_,S.pitch=x;const R=o.aS.convert(l),k=o.aS.convert(f),z=new o.aS(R.lng,k.lat),M=new o.aS(k.lng,R.lat),B=S.project(R),j=S.project(k),U=this.queryTerrainElevation(R),Z=this.queryTerrainElevation(k),q=this.queryTerrainElevation(z),K=this.queryTerrainElevation(M),ne=[[B.x,B.y,Math.min(U||0,Z||0,q||0,K||0)],[j.x,j.y,Math.max(U||0,Z||0,q||0,K||0)]];let ee=o.d8.fromPoints(ne);const ge=S.getWorldToCameraMatrix(),oe=o.bk(new Float64Array(16),ge);ee=o.d8.applyTransform(ee,ge);const ve=this._extendAABB(ee,S,I,_);if(!ve)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ee=ve;const pe=.5*o.av([],ee.max,ee.min)[2],ce=this._minimumAABBFrustumDistance(S,ee),xe=[0,0,1,0];o.aC(xe,xe,ge),o.f0(xe,xe);const Me=o.c4([],xe,ce+pe),Ce=o.d7([],ee.center,Me);o.af(ee.center,ee.center,oe),o.af(Ce,Ce,oe);const We=S.unproject(new o.P(ee.center[0],ee.center[1])),Ne=o.f1(S.projection,We),Qe=Math.pow(2,Ne),_t=Math.min(S._zoomFromMercatorZ(Ce[2]*S.pixelsPerMeter*Qe/S.worldSize),I.maxZoom);return S.mercatorFromTransition&&_t<.5*(o.cZ+o.cK)?(S.setProjection({name:"globe"}),S.zoom=_t,this._cameraForBounds(S,l,f,_,x,w)):{center:We,zoom:_t,bearing:_,pitch:x}}fitBounds(r,l,f){const _=this.cameraForBounds(r,l);return this._fitInternal(_,l,f)}fitScreenCoordinates(r,l,f,_,x){const w=o.P.convert(r),S=o.P.convert(l),I=new o.P(Math.min(w.x,S.x),Math.min(w.y,S.y)),R=new o.P(Math.max(w.x,S.x),Math.max(w.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(w,S))return this;const k=this.transform.pointLocation3D(I),z=this.transform.pointLocation3D(R),M=this.transform.pointLocation3D(new o.P(I.x,R.y)),B=this.transform.pointLocation3D(new o.P(R.x,I.y)),j=[Math.min(k.lng,z.lng,M.lng,B.lng),Math.min(k.lat,z.lat,M.lat,B.lat)],U=[Math.max(k.lng,z.lng,M.lng,B.lng),Math.max(k.lat,z.lat,M.lat,B.lat)],Z=_&&_.pitch?_.pitch:this.getPitch(),q=this._cameraForBounds(this.transform,j,U,f,Z,_);return this._fitInternal(q,_,x)}_fitInternal(r,l,f){return r?(l=Object.assign(r,l)).linear?this.easeTo(l,f):this.flyTo(l,f):this}jumpTo(r,l){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,w=!1;"zoom"in r&&f.zoom!==+r.zoom&&(_=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.aS.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(x=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(w=!0,f.pitch=+r.pitch);const S=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!f.isPaddingEqual(S))if(r.retainPadding===!1){const I=f.clone();I.padding=S,f.setLocationAtPoint(f.center,I.centerPoint)}else f.padding=S;return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),_&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),x&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),w&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Dn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const f=this.transform;if(!f.projection.supportsFreeCamera)return o.w(Dn),this;this.stop();const _=f.zoom,x=f.pitch,w=f.bearing;f.setFreeCameraOptions(r);const S=_!==f.zoom,I=x!==f.pitch,R=w!==f.bearing;return this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),S&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),R&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),I&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),((r=Object.assign({offset:[0,0],duration:500,easing:o.eU},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const f=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),S=this.getPadding(),I="zoom"in r?+r.zoom:_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,k="pitch"in r?+r.pitch:w,z=this._extendPadding(r.padding),M=o.P.convert(r.offset);let B,j,U;if(f.projection.name==="globe"){const xe=o.ae.fromLngLat(f.center),Me=M.rotate(-f.angle);xe.x+=Me.x/f.worldSize,xe.y+=Me.y/f.worldSize;const Ce=xe.toLngLat(),We=o.aS.convert(r.center||Ce);this._normalizeCenter(We),B=f.centerPoint.add(Me),j=new o.P(xe.x,xe.y).mult(f.worldSize),U=new o.P(o.aF(We.lng),o.aJ(We.lat)).mult(f.worldSize).sub(j)}else{B=f.centerPoint.add(M);const xe=f.pointLocation(B),Me=o.aS.convert(r.center||xe);this._normalizeCenter(Me),j=f.project(xe),U=f.project(Me).sub(j)}const Z=f.zoomScale(I-_);let q,K;r.around&&(q=o.aS.convert(r.around),K=f.locationPoint(q));const ne=this._zooming||I!==_,ee=this._rotating||x!==R,ge=this._pitching||k!==w,oe=!f.isPaddingEqual(z),ve=r.retainPadding===!1?f.clone():f,pe=xe=>Me=>{if(ne&&(xe.zoom=o.ak(_,I,Me)),ee&&(xe.bearing=o.ak(x,R,Me)),ge&&(xe.pitch=o.ak(w,k,Me)),oe&&(ve.interpolatePadding(S,z,Me),B=ve.centerPoint.add(M)),q)xe.setLocationAtPoint(q,K);else{const Ce=xe.zoomScale(xe.zoom-_),We=I>_?Math.min(2,Z):Math.max(.5,Z),Ne=Math.pow(We,1-Me),Qe=xe.unproject(j.add(U.mult(Me*Ne)).mult(Ce));xe.setLocationAtPoint(xe.renderWorldCopies?Qe.wrap():Qe,B)}return r.preloadOnly||this._fireMoveEvents(l),xe};if(r.preloadOnly){const xe=this._emulate(pe,r.duration,f);return this._preloadTiles(xe),this}const ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=ee,this._pitching=ge,this._padding=oe,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,ce),this._ease(pe(f),xe=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(l,xe)},r),this}_prepareEase(r,l,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||f.moving||this.fire(new o.z("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.z("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.z("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.z("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.z("move",r)),this._zooming&&this.fire(new o.z("zoom",r)),this._rotating&&this.fire(new o.z("rotate",r)),this._pitching&&this.fire(new o.z("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.z("zoomend",r)),_&&this.fire(new o.z("rotateend",r)),x&&this.fire(new o.z("pitchend",r)),this.fire(new o.z("moveend",r))}flyTo(r,l){if(this._prefersReducedMotion(r)){const je=o.aH(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(je,l)}this.stop(),r=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eU},r);const f=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),S=this.getPadding(),I="zoom"in r?o.aA(+r.zoom,f.minZoom,f.maxZoom):_,R="bearing"in r?this._normalizeBearing(r.bearing,x):x,k="pitch"in r?+r.pitch:w,z=this._extendPadding(r.padding),M=f.zoomScale(I-_),B=o.P.convert(r.offset);let j=f.centerPoint.add(B);const U=f.pointLocation(j),Z=o.aS.convert(r.center||U);this._normalizeCenter(Z);const q=f.project(U),K=f.project(Z).sub(q);let ne=r.curve;const ee=Math.max(f.width,f.height),ge=ee/M,oe=K.mag();if("minZoom"in r){const je=o.aA(Math.min(r.minZoom,_,I),f.minZoom,f.maxZoom),ot=ee/f.zoomScale(je-_);ne=Math.sqrt(ot/oe*2)}const ve=ne*ne;function pe(je){const ot=(ge*ge-ee*ee+(je?-1:1)*ve*ve*oe*oe)/(2*(je?ge:ee)*ve*oe);return Math.log(Math.sqrt(ot*ot+1)-ot)}function ce(je){return(Math.exp(je)-Math.exp(-je))/2}function xe(je){return(Math.exp(je)+Math.exp(-je))/2}const Me=pe(0);let Ce=function(je){return xe(Me)/xe(Me+ne*je)},We=function(je){return ee*((xe(Me)*(ce(ot=Me+ne*je)/xe(ot))-ce(Me))/ve)/oe;var ot},Ne=(pe(1)-Me)/ne;if(Math.abs(oe)<1e-6||!isFinite(Ne)){if(Math.abs(ee-ge)<1e-6)return this.easeTo(r,l);const je=ge<ee?-1:1;Ne=Math.abs(Math.log(ge/ee))/ne,We=function(){return 0},Ce=function(ot){return Math.exp(je*ne*ot)}}r.duration="duration"in r?+r.duration:1e3*Ne/("screenSpeed"in r?+r.screenSpeed/ne:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Qe=x!==R,_t=k!==w,Fe=!f.isPaddingEqual(z),Ie=r.retainPadding===!1?f.clone():f,et=je=>ot=>{const wt=ot*Ne,jt=1/Ce(wt);je.zoom=ot===1?I:_+je.scaleZoom(jt),Qe&&(je.bearing=o.ak(x,R,ot)),_t&&(je.pitch=o.ak(w,k,ot)),Fe&&(Ie.interpolatePadding(S,z,ot),j=Ie.centerPoint.add(B));const pt=ot===1?Z:je.unproject(q.add(K.mult(We(wt))).mult(jt));return je.setLocationAtPoint(je.renderWorldCopies?pt.wrap():pt,j),je._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),je};if(r.preloadOnly){const je=this._emulate(et,r.duration,f);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Qe,this._pitching=_t,this._padding=Fe,this._prepareEase(l,!1),this._ease(et(f),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,l)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,l,f){f.animate===!1||f.duration===0?(r(1),l()):(this._easeStart=o.o.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=o.bS(r,-180,180);const f=Math.abs(r-l);return Math.abs(r-360-l)<f&&(r-=360),Math.abs(r+360-l)<f&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const f=r.lng-l.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,l,f){const _=Math.ceil(15*l/1e3),x=[],w=r(f.clone());for(let S=0;S<=_;S++){const I=w(S/_);x.push(I.clone())}return x}_preloadTiles(r,l){}}class Ju{constructor(r={}){this.options=r,o.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact,f=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const _=se("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",f),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){const f=l.reduce((_,x,w)=>(x.value&&(_+=`${x.key}=${x.value}${w<l.length-1?"&":""}`),_),"?");r.href=`${o.e.FEEDBACK_URL}/${f}#${vp(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||(r.dataType!=="source"||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility")&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._mergedSourceCaches;for(const _ in l){const x=l[_];if(x.used){const w=x.getSource();w.attribution&&r.indexOf(w.attribution)<0&&r.push(w.attribution)}}r.sort((_,x)=>_.length-x.length),r=r.filter((_,x)=>{for(let w=x+1;w<r.length;w++)if(r[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bd{constructor(){o.aX(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=se("div","mapboxgl-ctrl");const l=se("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const l in r){const f=r[l].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class w_{constructor(){o.aX(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",l=>this._onIndoorUpdate(l)),this._container}_createButton(r,l){const f=se("button",r,this._container);return f.type="button",f.addEventListener("click",l),f}_createSeparator(){return se("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(r,l){this._map&&(r.setAttribute("aria-label",l),r.textContent=l)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return this._model=r,void(this._container.style.display="none");const l=this._model;this._model=r,this._container.style.display="inline-block",this._container.style.borderRadius="8px",l&&Array.from(this._container.children).forEach(f=>f.remove()),r.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(r.floors,r.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const r=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const l=this._map;this._model&&l&&l._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});se("span","mapboxgl-ctrl-icon",r).setAttribute("aria-hidden","true"),r.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&r.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(r),this._createSeparator()}_updateBuildingsButtonState(){const r=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");r&&this._model&&(this._model.activeFloorsVisible?r.classList.remove("mapboxgl-ctrl-level-button-selected"):r.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(r,l){for(let f=0;f<r.length;f++){const _=r[f],x=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(_.id)});this._setButtonTitle(x,_.zIndex.toString()),this._model&&_.id===this._model.selectedFloorId&&l&&x.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(x),f<r.length-1&&this._createSeparator()}}}class Tv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,f=l?this._queue.concat(l):this._queue;for(const _ of f)if(_.id===r)return void(_.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const f of l)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Nd{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=o.dC((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,f){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+f}}const Rb={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Sv extends o.z{constructor(r,l,f,_){const{point:x,lngLat:w,originalEvent:S,target:I}=r;super(r.type,{point:x,lngLat:w,originalEvent:S,target:I}),this.preventDefault=()=>{r.preventDefault()},this.id=l,this.interaction=f,this.feature=_}}class b_{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,l){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const f=l.filter;let _=l.type;f&&this.filters.set(r,o.b5(f)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const x=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,l)):x.size===0&&this.map.on(_,this.handleType),x.size===0&&this.interactionsByType.set(_,x),x.set(r,l),this.typeById.set(r,_)}get(r){const l=this.typeById.get(r);if(!l)return;const f=this.interactionsByType.get(l);return f?f.get(r):void 0}remove(r){const l=this.typeById.get(r);if(!l)return;this.typeById.delete(r),this.filters.delete(r);const f=this.interactionsByType.get(l);f&&(f.delete(r),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(l,this.handleType))}queryTargets(r,l){const f=[];for(const[_,x]of l)x.target&&f.push({targetId:_,target:x.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(r,f,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());l.length&&(r.type="mouseenter",this.handleType(r,l));const f=new Map;for(const[_,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||f.set(x.id,x);f.size&&(r.type="mouseleave",this.handleType(r,Array.from(f.values())))}handleOut(r){const l=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);l.length&&(r.type="mouseleave",this.handleType(r,l)),this.hoveredFeatures.clear()}handleType(r,l){const f=r.type==="mouseenter";if(f&&!this.interactionsByType.has(r.type))return void o.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(r.type)).reverse(),x=!!l;l=l||this.queryTargets(r.point,_);let w=!1;const S=new Set;for(const I of l){for(const[R,k]of _){if(!k.target)continue;const z=I.variants?I.variants[R]:null;if(z){for(const M of z){if(xo(M,I,S,R))continue;const B=new o.dw(I,M),j=ka(M,I,R);x&&B.id!==void 0&&(B.state=this.map.getFeatureState(B));const U=f?this.prevHoveredFeatures.get(j):null,Z=new Sv(r,R,k,B),q=U?U.stop:k.handler(Z);if(f&&this.hoveredFeatures.set(j,{feature:I,stop:q}),q!==!1){w=!0;break}}if(w)break}}if(w)break}if(!w)for(const[I,R]of _){const{handler:k,target:z}=R;if(!z&&k(new Sv(r,I,R,null))!==!1)break}}}function T_(d,r){if(Array.isArray(d)&&Array.isArray(r)){const l=new Set(d),f=new Set(r);return l.size===f.size&&d.every(_=>f.has(_))}return o.bx(d,r)}const Cp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Pp={showCompass:!0,showZoom:!0,visualizePitch:!1};class jd{constructor(r,l,f=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Tp({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new __({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Oe()}move(r,l){const f=this.map,_=this.mouseRotate.mousemoveWindow(r,l),x=_&&_.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const w=this.mousePitch.mousemoveWindow(r,l),S=w&&w.pitchDelta;S&&f.setPitch(f.getPitch()+S)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(Object.assign({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),bt(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,bt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Bt(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=Bt(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Tl(d,r,l){if(d=new o.aS(d.lng,d.lat),r){const f=new o.aS(d.lng-360,d.lat),_=new o.aS(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-l.center.lng)/360),w=l.locationPoint3D(d).distSqr(r),S=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint3D(f).distSqr(r)<w&&(S||Math.abs(f.lng-l.center.lng)<x)?d=f:l.locationPoint3D(_).distSqr(r)<w&&(S||Math.abs(_.lng-l.center.lng)<x)&&(d=_)}for(;Math.abs(d.lng-l.center.lng)>180;){const f=l.locationPoint3D(d);if(f.x>=0&&f.y>=0&&f.x<=l.width&&f.y<=l.height)break;d.lng>l.center.lng?d.lng-=360:d.lng+=360}return d}const Oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ms={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Sl extends o.E{constructor(r,l){super(),(r instanceof HTMLElement||l)&&(r=Object.assign({element:r},l)),o.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:_="#3FB1CE",scale:x=1,draggable:w=!1,clickTolerance:S=0,rotation:I=Ms.rotation,rotationAlignment:R=Ms.rotationAlignment,pitchAlignment:k=Ms.pitchAlignment,occludedOpacity:z=Ms.occludedOpacity,altitude:M=Ms.altitude}=r||{};this._anchor=f,this._color=_,this._scale=x,this._draggable=w,this._clickTolerance=S,this._rotation=I,this._rotationAlignment=R,this._pitchAlignment=k,this._occludedOpacity=z,this._altitude=M,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",U=>{U.preventDefault()}),this._element.addEventListener("mousedown",U=>{U.preventDefault()});const B=this._element.classList;for(const U in Oa)B.remove(`mapboxgl-marker-anchor-${U}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`);const j=r&&r.className?r.className.trim().split(/\s+/):[];B.add(...j),this._popup=null}_createDefaultMarker(){const r=se("div"),l=me("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const f=me("radialGradient",{id:"shadowGradient"},me("defs",{},l));me("stop",{offset:"10%","stop-opacity":.4},f),me("stop",{offset:"100%","stop-opacity":.05},f),me("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return me("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),me("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),me("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.aS.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||Ms.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,f=r.charCode||r.keyCode;l!=="Space"&&l!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,f=this._element;this._popup&&(l===f||f.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const f=r.unproject(l,this._altitude),_=r.getFreeCameraOptions();if(!_.position)return!1;const x=_.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const f=r.unproject(l,this._altitude);let _;r._showingGlobe()&&o.f4(r.transform,this._lngLat)?_=0:(_=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${Oa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const r=this._pos,l=this._map,f=this.getPitchAlignment();if(!l||!r||f!=="map")return"";if(!l._showingGlobe()){const I=l.getPitch();return I?`rotateX(${I}deg)`:""}const _=o.cW(o.f5(l.transform,this._lngLat)),x=r.sub(o.f6(l.transform)),w=Math.abs(x.x)+Math.abs(x.y);if(w===0)return"";const S=_/w;return`rotateX(${-x.y*S}deg) rotateY(${x.x*S}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let f=0;const _=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){const x=l.project(new o.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),w=l.project(new o.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);f=o.cW(Math.atan2(w.y,w.x))-90}else f=-l.getBearing();else if(_==="horizon"){const x=o.ah(4,6,l.getZoom()),w=o.f6(l.transform);w.y+=x*l.transform.height;const S=r.sub(w),I=o.cW(Math.atan2(S.y,S.x));f=(I>90?I-270:I+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Tl(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const l=this._map;if(!l)return;const f=this._pointerdownPos,_=this._positionDelta;if(f&&_){if(!this._isDragging){const x=this._clickTolerance||l._clickTolerance;if(r.point.dist(f)<x)return;this._isDragging=!0}this._pos=r.point.sub(_),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,f=this._pos;l&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||Ms.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||Ms.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||Ms.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||Ms.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Da={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},kb={maxWidth:100,unit:"metric"},Mb={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ob={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Db=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function S_(d=new o.P(0,0),r="bottom"){if(typeof d=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(r){case"top":return new o.P(0,d);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-d);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(d,0);case"right":return new o.P(-d,0)}return new o.P(0,0)}return d instanceof o.P||Array.isArray(d)?o.P.convert(d):o.P.convert(d[r]||[0,0])}return{version:O,supported:we.supported,setRTLTextPlugin:o.fa,getRTLTextPluginStatus:o.f9,Map:class extends rl{constructor(d){$.mark(F.create);const r=d;if((d=Object.assign({},Cp,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&o.f2(window)&&(d.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Eu(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Tv,this._domRenderTaskQueue=new Tv,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b1(),this._locale=Object.assign({},Rb,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Zt(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const l=document.getElementById(d.container);if(!l)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=l}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,o.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Tb),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ap(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||o.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new yp(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const l=d.bounds;l&&(this.resize(),this.fitBounds(l,Object.assign({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Ju({customAttribution:d.customAttribution})),this._logoControl=new Bd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.z(`${l.dataType}dataloading`,l))}),this._interactions=new b_(this)}_getMapId(){return this._mapId}addControl(d,r){if(r===void 0&&(r=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(l,f.firstChild):f.appendChild(l),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(d);return r>-1&&this._controls.splice(r,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.z("movestart",d)).fire(new o.z("move",d)),this.fire(new o.z("resize",d)),r&&this.fire(new o.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(o.aI.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(r=>r==="auto"?navigator.language:r):d}setLanguage(d){const r=this._parseLanguage(d);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,r=d.projection.name;let l;r==="globe"&&d.zoom>=o.cK?(d.setMercatorFromTransition(),l=!0):r==="mercator"&&d.zoom<o.cK&&(d.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,r){return this._updateProjection(d||r||{name:"mercator"})}_updateProjection(d){let r;const l=this.transform.mercatorFromTransition;r=d.name==="globe"&&this.transform.zoom>=o.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate();const f=this.transform.getProjection().name==="mercator"&&l!==this.transform.mercatorFromTransition;return(r||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,r){return this.transform.locationPoint3D(o.aS.convert(d),r)}unproject(d,r){return this.transform.pointLocation3D(o.P.convert(d),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,r,l){const f=_=>{let x=[];if(Array.isArray(r)){const w=r.filter(S=>this.getLayer(S));x=w.length?this.queryRenderedFeatures(_,{layers:w}):[]}else x=this.queryRenderedFeatures(_,{target:r});return x};if(d==="mouseenter"||d==="mouseover"){let _=!1;return{listener:l,targets:r,delegates:{mousemove:w=>{const S=f(w.point);S.length?_||(_=!0,l.call(this,new rn(d,this,w.originalEvent,{features:S}))):_=!1},mouseout:()=>{_=!1}}}}if(d==="mouseleave"||d==="mouseout"){let _=!1;return{listener:l,targets:r,delegates:{mousemove:S=>{f(S.point).length?_=!0:_&&(_=!1,l.call(this,new rn(d,this,S.originalEvent)))},mouseout:S=>{_&&(_=!1,l.call(this,new rn(d,this,S.originalEvent)))}}}}{const _=x=>{const w=f(x.point);w.length&&(x.features=w,l.call(this,x),delete x.features)};return{listener:l,targets:r,delegates:{[d]:_}}}}on(d,r,l){if(typeof r=="function"||l===void 0)return super.on(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(d,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const _ in f.delegates)this.on(_,f.delegates[_]);return this}once(d,r,l){if(typeof r=="function"||l===void 0)return super.once(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(d,r,l);for(const _ in f.delegates)this.once(_,f.delegates[_]);return this}off(d,r,l){if(typeof r=="function"||l===void 0)return super.off(d,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._delegatedListeners?this._delegatedListeners[d]:void 0;return f&&(_=>{for(let x=0;x<_.length;x++){const w=_[x];if(w.listener===l&&T_(w.targets,r)){for(const S in w.delegates)this.off(S,w.delegates[S]);return _.splice(x,1),this}}})(f),this}queryRenderedFeatures(d,r){if(!this.style)return[];if(d===void 0||d instanceof o.P||Array.isArray(d)||r!==void 0||(r=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!r){const x=this.style.queryRenderedFeatures(d,void 0,this.transform),w=this.style.queryRenderedFeatureset(d,void 0,this.transform);return x.concat(w)}let l=!0;if(r.target&&(l=this._isTargetValid(r.target),l&&!r.layers))return this.style.queryRenderedFeatureset(d,r,this.transform);let f=!0;if(r.layers&&Array.isArray(r.layers)){for(const x of r.layers)if(!this._isValidId(x)){f=!1;break}if(f&&!r.target)return this.style.queryRenderedFeatures(d,r,this.transform)}let _=[];return f&&(_=_.concat(this.style.queryRenderedFeatures(d,r,this.transform))),l&&(_=_.concat(this.style.queryRenderedFeatureset(d,r,this.transform))),_}querySourceFeatures(d,r){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,r)}queryRasterValue(d,r,l){return this._isValidId(d)?this.style.queryRasterValue(d,r,l):Promise.resolve(null)}isPointOnSurface(d){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(d))}addInteraction(d,r){return this._interactions.add(d,r),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&d&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(d,(l,f)=>{if(l){const _=typeof l=="string"?l:l instanceof Error?l.message:l.error;o.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(d,r)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(d,r))}_getUIString(d){const r=this._locale[d];if(r==null)throw new Error(`Missing UI string '${d}'`);return r}_updateStyle(d,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const l=Object.assign({},r);r&&r.config&&(l.initialConfig=r.config,delete l.config),this.style=new pa(this,l).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pa(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dq(d)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const r of d)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(d)}addSource(d,r){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,r),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(d,r,l)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,r,{pixelRatio:l=1,sdf:f=!1,stretchX:_,stretchY:x,content:w}={}){this._lazyInitEmptyStyle();const S=o.I.from(d);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:I,height:R,data:k}=o.o.getImageData(r);this.style.addImage(S,{data:new o.q({width:I,height:R},k),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:f,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:R}=r,k=r;this.style.addImage(S,{data:new o.q({width:I,height:R},new Uint8Array(k.data)),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:f,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,d)}}updateImage(d,r){this._lazyInitEmptyStyle();const l=o.I.from(d),f=this.style.getImage(l);if(!f)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.o.getImageData(r):r,{width:x,height:w,data:S}=_;if(x===void 0||w===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||w!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const I=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let R=!1;f.usvg?(f.data=new o.q({width:x,height:w},new Uint8Array(S)),f.usvg=!1,f.icon=void 0,R=!0):f.data.replace(S,I),this.style.updateImage(l,f,R)}hasImage(d){return d?!!this.style&&!!this.style.getImage(o.I.from(d)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(o.I.from(d))}loadImage(d,r){o.n(this._requestManager.transformRequest(d,o.R.Image),(l,f)=>{r(l,f instanceof HTMLImageElement?o.o.getImageData(f):f)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,r){this._lazyInitEmptyStyle(),this.style.addModel(d,r)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,r){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,r),this._update(!0)):this}getSlot(d){const r=this.getLayer(d);return r&&r.slot||null}setSlot(d,r){return this.style.setSlot(d,r),this.style.mergeLayers(),this._update(!0)}addImport(d,r){return this.style.addImport(d,r).catch(l=>this.fire(new o.y(new Error("Failed to add import",l)))),this}updateImport(d,r){return typeof r!="string"&&r.id!==d?(this.removeImport(d),this.addImport(r)):(this.style.updateImport(d,r),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,r){return this.style.moveImport(d,r),this._update(!0)}moveLayer(d,r){return this._isValidId(d)?(this.style.moveLayer(d,r),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const r=this.style.getOwnLayer(d);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,r,l){return this._isValidId(d)?(this.style.setLayerZoomRange(d,r,l),this._update(!0)):this}setFilter(d,r,l={}){return this._isValidId(d)?(this.style.setFilter(d,r,l),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,r,l,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,r,l,f),this._update(!0)):this}getPaintProperty(d,r){return this._isValidId(d)?this.style.getPaintProperty(d,r):null}setLayoutProperty(d,r,l,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,r,l,f),this._update(!0)):this}getLayoutProperty(d,r){return this._isValidId(d)?this.style.getLayoutProperty(d,r):null}setLayerProperty(d,r,l,f={}){return this._isValidId(d)?(this.style.setLayerProperty(d,r,l,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,r){return this.style.setSchema(d,r),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,r){return this.style.setConfig(d,r),this._update(!0)}getConfigProperty(d,r){return this.style.getConfigProperty(d,r)}setConfigProperty(d,r,l){return this.style.setConfigProperty(d,r,l),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const r=d[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,r),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aS.convert(d),this.transform):0}setFeatureState(d,r){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,r),this._update())}removeFeatureState(d,r){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,r),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_setIndoorActiveFloorsVisibility(d){this.indoor.setActiveFloorsVisibility(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new w_),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,f,_,x=this._container;for(;x&&(!f||!_);){const w=window.getComputedStyle(x).transform;w&&w!=="none"&&(l=w.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(f=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=_?Math.abs(r/_):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Bc(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=se("div","mapboxgl-canvas-container",d);this._canvas=se("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=se("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{f[_]=se("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,r){const l=o.o.devicePixelRatio||1;this._canvas.width=l*Math.ceil(d),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${r}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const r=this._markers.indexOf(d);r!==-1&&this._markers.splice(r,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const r=this._popups.indexOf(d);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const d=Object.assign({},we.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",d);r?(ns(r,!0),this.painter=new ac(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(r)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let r;this.fire(new o.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,f=o.o.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=_.createQuery(),_.beginQuery(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,k=this.transform.pitch,z=o.o.now(),M=new o.ac(R,{now:z,fadeDuration:x,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(M)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(f);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(F.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const R=o.o.now()-f;_.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const k=_.getQueryParameter(r,_.QUERY_RESULT)/1e6;_.deleteQuery(r),this.fire(new o.z("gpu-timing-frame",{cpuTime:R,gpuTime:k}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(R);this.fire(new o.z("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const R=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(R);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:k}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(I||this._repaint)this.triggerRepaint();else{const R=this.idle();if(R&&(w=this._updateAverageElevation(f,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),R&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,$.mark(F.fullLoad),this._performanceMetricsCollection&&Pi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const r of this._markers)d&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!d||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(d,r=!1){const l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const w=Math.abs(_-x);if(w>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,d,300)}else if(w>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(d)&&l(this._averageElevation.getValue(d))}_authenticate(){Fn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===Mt||d.status===401)){const r=this.painter.context.gl;ns(r,!1),this._logoControl instanceof Bd&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ti(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&On(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Vn(this._requestManager._customAccessToken)}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,f=l.createFramebuffer();function _(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,f),this._canvasPixelComparison(_(d),r.canvasCopies.map(_),r.timeStamps)}_canvasPixelComparison(d,r,l){let f=l[1]-l[0];const _=d.length/4;for(let x=0;x<r.length;x++){const w=r[x];let S=0;for(let I=0;I<w.length;I+=4)w[I]===d[I]&&w[I+1]===d[I+1]&&w[I+2]===d[I+2]&&w[I+3]===d[I+3]&&(S+=1);f+=(l[x+2]-l[x+1])*(1-S/_)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),bi.delete(this.painter.context.gl),Qi.remove(),Sr.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=o.o.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(d){const r=this.style?this.style.getSourceCaches():[];return o.bv(r,(l,f)=>l._preloadTiles(d,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,r){o.f3(d,r)}get version(){return O}},NavigationControl:class{constructor(d={}){this.options=Object.assign({},Pp,d),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const r=d.getZoom(),l=r===d.getMaxZoom(),f=r===d.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jd(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,r){const l=se("button",d,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(d,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);d.setAttribute("aria-label",l),d.firstElementChild&&d.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(d={}){super();const r=navigator.geolocation;this.options=Object.assign({geolocation:r},Da,d),o.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Wc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,d(l)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>r(l.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(d){const r=this._map.getMaxBounds(),l=d.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:d.coords,timestamp:d.timestamp},d.toJSON?{toJSON:d.toJSON.bind(d)}:{}))),this._finish()}}_updateCamera(d){const r=new o.aS(d.coords.longitude,d.coords.latitude),l=d.coords.accuracy,f=this._map.getBearing(),_=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),_,{geolocateSource:!0})}_updateMarker(d){if(d){const r=new o.aS(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,r=o.ce(1,d._center.lat)*d.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Sl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Sl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ju,ScaleControl:class{constructor(d={}){this.options=Object.assign({},kb,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,f=r._containerWidth/2-d/2,_=r.unproject([f,l]),x=r.unproject([f+d,l]),w=_.distanceTo(x);if(this.options.unit==="imperial"){const S=3.2808*w;S>5280?this._setScale(d,S/5280,"mile"):this._setScale(d,S,"foot")}else this.options.unit==="nautical"?this._setScale(d,w/1852,"nautical-mile"):w>=1e3?this._setScale(d,w/1e3,"kilometer"):this._setScale(d,w,"meter")}_setScale(d,r,l){this._map._requestDomTask(()=>{const f=function(x){const w=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/w;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(I){const R=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*R)/R}(S),w*S}(r),_=f/r;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(f):`${f}&nbsp;${Mb[l]}`,this._container.style.width=d*_+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:o.w("Full screen control 'container' must be a DOM element.")),o.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:w_,Popup:class extends o.E{constructor(d){super(),this.options=Object.assign(Object.create(Ob),d),this._altitude=this.options.altitude,o.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=o.aS.convert(d),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const r=document.createDocumentFragment(),l=document.createElement("body");let f;for(l.innerHTML=d;f=l.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(d),this.options.closeButton){const l=this._closeButton=se("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let r;return this._classList.delete(d)?r=!1:(this._classList.add(d),r=!0),this._updateClassList(),r}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,f=this._pos;if(!r||!l||!f)return"bottom";const _=l.offsetWidth,x=l.offsetHeight,w=f.x<_/2,S=f.x>r.transform.width-_/2;if(f.y+d<x)return w?"top-left":S?"top-right":"top";if(f.y>r.transform.height-x){if(w)return"bottom-left";if(S)return"bottom-right"}return w?"left":S?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),d.className=r.join(" ")}_update(d){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let f=this._container;if(f||(f=this._container=se("div","mapboxgl-popup",r.getContainer()),this._tip=se("div","mapboxgl-popup-tip",f),f.appendChild(l)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tl(this._lngLat,this._pos,r.transform)),!this._trackPointer||d){const _=this._pos=this._trackPointer&&d instanceof o.P?d:r.project(this._lngLat,this._altitude),x=S_(this.options.offset),w=this._anchor=this._getAnchor(x.y),S=S_(this.options.offset,w),I=_.add(S).round();r._requestDomTask(()=>{this._container&&w&&(this._container.style.transform=`${Oa[w]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&r._showingGlobe()){const _=o.f4(r.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Db);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Sl,Style:pa,LngLat:o.aS,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:Qa,Evented:o.E,config:o.e,prewarm:o.f8,clearPrewarmedResources:o.f7,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(d){o.e.ACCESS_TOKEN=d},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(d){o.e.API_URL=d},get workerCount(){return o.fh.workerCount},set workerCount(d){o.fh.workerCount=d},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){o.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){o.fg(d)},get workerUrl(){return o.ff.workerUrl},set workerUrl(d){o.ff.workerUrl=d},get workerClass(){return o.ff.workerClass},set workerClass(d){o.ff.workerClass=d},get workerParams(){return o.ff.workerParams},set workerParams(d){o.ff.workerParams=d},get dracoUrl(){return o.fe()},set dracoUrl(d){o.fd(d)},get meshoptUrl(){return o.fc()},set meshoptUrl(d){o.fb(d)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var E=g;return E})})(K3);var Iq=K3.exports;const Gx=v2(Iq),ew=ke.forwardRef(({className:i,type:t,...a},h)=>ye.jsx("input",{type:t,className:Jn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",i),ref:h,...a}));ew.displayName="Input";const Aq=I0("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),J3=ke.forwardRef(({className:i,variant:t,...a},h)=>ye.jsx("div",{ref:h,role:"alert",className:Jn(Aq({variant:t}),i),...a}));J3.displayName="Alert";const Cq=ke.forwardRef(({className:i,...t},a)=>ye.jsx("h5",{ref:a,className:Jn("mb-1 font-medium leading-none tracking-tight",i),...t}));Cq.displayName="AlertTitle";const Q3=ke.forwardRef(({className:i,...t},a)=>ye.jsx("div",{ref:a,className:Jn("text-sm [&_p]:leading-relaxed",i),...t}));Q3.displayName="AlertDescription";var e2=function(i,t){return e2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,h){a.__proto__=h}||function(a,h){for(var g in h)Object.prototype.hasOwnProperty.call(h,g)&&(a[g]=h[g])},e2(i,t)};function eF(i,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");e2(i,t);function a(){this.constructor=i}i.prototype=t===null?Object.create(t):(a.prototype=t.prototype,new a)}var tw=function(){return tw=Object.assign||function(t){for(var a,h=1,g=arguments.length;h<g;h++){a=arguments[h];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(t[v]=a[v])}return t},tw.apply(this,arguments)};function sg(i,t){var a={};for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&t.indexOf(h)<0&&(a[h]=i[h]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,h=Object.getOwnPropertySymbols(i);g<h.length;g++)t.indexOf(h[g])<0&&Object.prototype.propertyIsEnumerable.call(i,h[g])&&(a[h[g]]=i[h[g]]);return a}function tF(i,t,a,h){var g=arguments.length,v=g<3?t:h===null?h=Object.getOwnPropertyDescriptor(t,a):h,E;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(i,t,a,h);else for(var o=i.length-1;o>=0;o--)(E=i[o])&&(v=(g<3?E(v):g>3?E(t,a,v):E(t,a))||v);return g>3&&v&&Object.defineProperty(t,a,v),v}function rF(i,t){return function(a,h){t(a,h,i)}}function iF(i,t,a,h,g,v){function E(fe){if(fe!==void 0&&typeof fe!="function")throw new TypeError("Function expected");return fe}for(var o=h.kind,O=o==="getter"?"get":o==="setter"?"set":"value",F=!t&&i?h.static?i:i.prototype:null,$=t||(F?Object.getOwnPropertyDescriptor(F,h.name):{}),Q,te=!1,J=a.length-1;J>=0;J--){var we={};for(var se in h)we[se]=se==="access"?{}:h[se];for(var se in h.access)we.access[se]=h.access[se];we.addInitializer=function(fe){if(te)throw new TypeError("Cannot add initializers after decoration has completed");v.push(E(fe||null))};var me=(0,a[J])(o==="accessor"?{get:$.get,set:$.set}:$[O],we);if(o==="accessor"){if(me===void 0)continue;if(me===null||typeof me!="object")throw new TypeError("Object expected");(Q=E(me.get))&&($.get=Q),(Q=E(me.set))&&($.set=Q),(Q=E(me.init))&&g.unshift(Q)}else(Q=E(me))&&(o==="field"?g.unshift(Q):$[O]=Q)}F&&Object.defineProperty(F,h.name,$),te=!0}function nF(i,t,a){for(var h=arguments.length>2,g=0;g<t.length;g++)a=h?t[g].call(i,a):t[g].call(i);return h?a:void 0}function sF(i){return typeof i=="symbol"?i:"".concat(i)}function oF(i,t,a){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(i,"name",{configurable:!0,value:a?"".concat(a," ",t):t})}function aF(i,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(i,t)}function Wr(i,t,a,h){function g(v){return v instanceof a?v:new a(function(E){E(v)})}return new(a||(a=Promise))(function(v,E){function o($){try{F(h.next($))}catch(Q){E(Q)}}function O($){try{F(h.throw($))}catch(Q){E(Q)}}function F($){$.done?v($.value):g($.value).then(o,O)}F((h=h.apply(i,t||[])).next())})}function lF(i,t){var a={label:0,sent:function(){if(v[0]&1)throw v[1];return v[1]},trys:[],ops:[]},h,g,v,E=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return E.next=o(0),E.throw=o(1),E.return=o(2),typeof Symbol=="function"&&(E[Symbol.iterator]=function(){return this}),E;function o(F){return function($){return O([F,$])}}function O(F){if(h)throw new TypeError("Generator is already executing.");for(;E&&(E=0,F[0]&&(a=0)),a;)try{if(h=1,g&&(v=F[0]&2?g.return:F[0]?g.throw||((v=g.return)&&v.call(g),0):g.next)&&!(v=v.call(g,F[1])).done)return v;switch(g=0,v&&(F=[F[0]&2,v.value]),F[0]){case 0:case 1:v=F;break;case 4:return a.label++,{value:F[1],done:!1};case 5:a.label++,g=F[1],F=[0];continue;case 7:F=a.ops.pop(),a.trys.pop();continue;default:if(v=a.trys,!(v=v.length>0&&v[v.length-1])&&(F[0]===6||F[0]===2)){a=0;continue}if(F[0]===3&&(!v||F[1]>v[0]&&F[1]<v[3])){a.label=F[1];break}if(F[0]===6&&a.label<v[1]){a.label=v[1],v=F;break}if(v&&a.label<v[2]){a.label=v[2],a.ops.push(F);break}v[2]&&a.ops.pop(),a.trys.pop();continue}F=t.call(i,a)}catch($){F=[6,$],g=0}finally{h=v=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}}var Hw=Object.create?function(i,t,a,h){h===void 0&&(h=a);var g=Object.getOwnPropertyDescriptor(t,a);(!g||("get"in g?!t.__esModule:g.writable||g.configurable))&&(g={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(i,h,g)}:function(i,t,a,h){h===void 0&&(h=a),i[h]=t[a]};function cF(i,t){for(var a in i)a!=="default"&&!Object.prototype.hasOwnProperty.call(t,a)&&Hw(t,i,a)}function rw(i){var t=typeof Symbol=="function"&&Symbol.iterator,a=t&&i[t],h=0;if(a)return a.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&h>=i.length&&(i=void 0),{value:i&&i[h++],done:!i}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function MI(i,t){var a=typeof Symbol=="function"&&i[Symbol.iterator];if(!a)return i;var h=a.call(i),g,v=[],E;try{for(;(t===void 0||t-- >0)&&!(g=h.next()).done;)v.push(g.value)}catch(o){E={error:o}}finally{try{g&&!g.done&&(a=h.return)&&a.call(h)}finally{if(E)throw E.error}}return v}function uF(){for(var i=[],t=0;t<arguments.length;t++)i=i.concat(MI(arguments[t]));return i}function hF(){for(var i=0,t=0,a=arguments.length;t<a;t++)i+=arguments[t].length;for(var h=Array(i),g=0,t=0;t<a;t++)for(var v=arguments[t],E=0,o=v.length;E<o;E++,g++)h[g]=v[E];return h}function dF(i,t,a){if(a||arguments.length===2)for(var h=0,g=t.length,v;h<g;h++)(v||!(h in t))&&(v||(v=Array.prototype.slice.call(t,0,h)),v[h]=t[h]);return i.concat(v||Array.prototype.slice.call(t))}function Zm(i){return this instanceof Zm?(this.v=i,this):new Zm(i)}function fF(i,t,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h=a.apply(i,t||[]),g,v=[];return g=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",E),g[Symbol.asyncIterator]=function(){return this},g;function E(J){return function(we){return Promise.resolve(we).then(J,Q)}}function o(J,we){h[J]&&(g[J]=function(se){return new Promise(function(me,fe){v.push([J,se,me,fe])>1||O(J,se)})},we&&(g[J]=we(g[J])))}function O(J,we){try{F(h[J](we))}catch(se){te(v[0][3],se)}}function F(J){J.value instanceof Zm?Promise.resolve(J.value.v).then($,Q):te(v[0][2],J)}function $(J){O("next",J)}function Q(J){O("throw",J)}function te(J,we){J(we),v.shift(),v.length&&O(v[0][0],v[0][1])}}function pF(i){var t,a;return t={},h("next"),h("throw",function(g){throw g}),h("return"),t[Symbol.iterator]=function(){return this},t;function h(g,v){t[g]=i[g]?function(E){return(a=!a)?{value:Zm(i[g](E)),done:!1}:v?v(E):E}:v}}function mF(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=i[Symbol.asyncIterator],a;return t?t.call(i):(i=typeof rw=="function"?rw(i):i[Symbol.iterator](),a={},h("next"),h("throw"),h("return"),a[Symbol.asyncIterator]=function(){return this},a);function h(v){a[v]=i[v]&&function(E){return new Promise(function(o,O){E=i[v](E),g(o,O,E.done,E.value)})}}function g(v,E,o,O){Promise.resolve(O).then(function(F){v({value:F,done:o})},E)}}function gF(i,t){return Object.defineProperty?Object.defineProperty(i,"raw",{value:t}):i.raw=t,i}var Pq=Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t},t2=function(i){return t2=Object.getOwnPropertyNames||function(t){var a=[];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(a[a.length]=h);return a},t2(i)};function _F(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var a=t2(i),h=0;h<a.length;h++)a[h]!=="default"&&Hw(t,i,a[h]);return Pq(t,i),t}function yF(i){return i&&i.__esModule?i:{default:i}}function vF(i,t,a,h){if(a==="a"&&!h)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!h:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return a==="m"?h:a==="a"?h.call(i):h?h.value:t.get(i)}function xF(i,t,a,h,g){if(h==="m")throw new TypeError("Private method is not writable");if(h==="a"&&!g)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!g:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return h==="a"?g.call(i,a):g?g.value=a:t.set(i,a),a}function wF(i,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof i=="function"?t===i:i.has(t)}function bF(i,t,a){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var h,g;if(a){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");h=t[Symbol.asyncDispose]}if(h===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");h=t[Symbol.dispose],a&&(g=h)}if(typeof h!="function")throw new TypeError("Object not disposable.");g&&(h=function(){try{g.call(this)}catch(v){return Promise.reject(v)}}),i.stack.push({value:t,dispose:h,async:a})}else a&&i.stack.push({async:!0});return t}var Rq=typeof SuppressedError=="function"?SuppressedError:function(i,t,a){var h=new Error(a);return h.name="SuppressedError",h.error=i,h.suppressed=t,h};function TF(i){function t(v){i.error=i.hasError?new Rq(v,i.error,"An error was suppressed during disposal."):v,i.hasError=!0}var a,h=0;function g(){for(;a=i.stack.pop();)try{if(!a.async&&h===1)return h=0,i.stack.push(a),Promise.resolve().then(g);if(a.dispose){var v=a.dispose.call(a.value);if(a.async)return h|=2,Promise.resolve(v).then(g,function(E){return t(E),g()})}else h|=1}catch(E){t(E)}if(h===1)return i.hasError?Promise.reject(i.error):Promise.resolve();if(i.hasError)throw i.error}return g()}function SF(i,t){return typeof i=="string"&&/^\.\.?\//.test(i)?i.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,h,g,v,E){return h?t?".jsx":".js":g&&(!v||!E)?a:g+v+"."+E.toLowerCase()+"js"}):i}const kq={__extends:eF,__assign:tw,__rest:sg,__decorate:tF,__param:rF,__esDecorate:iF,__runInitializers:nF,__propKey:sF,__setFunctionName:oF,__metadata:aF,__awaiter:Wr,__generator:lF,__createBinding:Hw,__exportStar:cF,__values:rw,__read:MI,__spread:uF,__spreadArrays:hF,__spreadArray:dF,__await:Zm,__asyncGenerator:fF,__asyncDelegator:pF,__asyncValues:mF,__makeTemplateObject:gF,__importStar:_F,__importDefault:yF,__classPrivateFieldGet:vF,__classPrivateFieldSet:xF,__classPrivateFieldIn:wF,__addDisposableResource:bF,__disposeResources:TF,__rewriteRelativeImportExtension:SF},Mq=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:bF,get __assign(){return tw},__asyncDelegator:pF,__asyncGenerator:fF,__asyncValues:mF,__await:Zm,__awaiter:Wr,__classPrivateFieldGet:vF,__classPrivateFieldIn:wF,__classPrivateFieldSet:xF,__createBinding:Hw,__decorate:tF,__disposeResources:TF,__esDecorate:iF,__exportStar:cF,__extends:eF,__generator:lF,__importDefault:yF,__importStar:_F,__makeTemplateObject:gF,__metadata:aF,__param:rF,__propKey:sF,__read:MI,__rest:sg,__rewriteRelativeImportExtension:SF,__runInitializers:nF,__setFunctionName:oF,__spread:uF,__spreadArray:dF,__spreadArrays:hF,__values:rw,default:kq},Symbol.toStringTag,{value:"Module"})),Oq=i=>i?(...t)=>i(...t):(...t)=>fetch(...t);class OI extends Error{constructor(t,a="FunctionsError",h){super(t),this.name=a,this.context=h}}class $M extends OI{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class GM extends OI{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class HM extends OI{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var r2;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(r2||(r2={}));class Dq{constructor(t,{headers:a={},customFetch:h,region:g=r2.Any}={}){this.url=t,this.headers=a,this.region=g,this.fetch=Oq(h)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return Wr(this,arguments,void 0,function*(a,h={}){var g;try{const{headers:v,method:E,body:o,signal:O}=h;let F={},{region:$}=h;$||($=this.region);const Q=new URL(`${this.url}/${a}`);$&&$!=="any"&&(F["x-region"]=$,Q.searchParams.set("forceFunctionRegion",$));let te;o&&(v&&!Object.prototype.hasOwnProperty.call(v,"Content-Type")||!v)?typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(F["Content-Type"]="application/octet-stream",te=o):typeof o=="string"?(F["Content-Type"]="text/plain",te=o):typeof FormData<"u"&&o instanceof FormData?te=o:(F["Content-Type"]="application/json",te=JSON.stringify(o)):te=o;const J=yield this.fetch(Q.toString(),{method:E||"POST",headers:Object.assign(Object.assign(Object.assign({},F),this.headers),v),body:te,signal:O}).catch(fe=>{throw fe.name==="AbortError"?fe:new $M(fe)}),we=J.headers.get("x-relay-error");if(we&&we==="true")throw new GM(J);if(!J.ok)throw new HM(J);let se=((g=J.headers.get("Content-Type"))!==null&&g!==void 0?g:"text/plain").split(";")[0].trim(),me;return se==="application/json"?me=yield J.json():se==="application/octet-stream"||se==="application/pdf"?me=yield J.blob():se==="text/event-stream"?me=J:se==="multipart/form-data"?me=yield J.formData():me=yield J.text(),{data:me,error:null,response:J}}catch(v){return v instanceof Error&&v.name==="AbortError"?{data:null,error:new $M(v)}:{data:null,error:v,response:v instanceof HM||v instanceof GM?v.context:void 0}}})}}var ra={};const og=uj(Mq);var Hx={},qx={},Wx={},Zx={},Xx={},Kx={},qM;function EF(){if(qM)return Kx;qM=1,Object.defineProperty(Kx,"__esModule",{value:!0});class i extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}return Kx.default=i,Kx}var WM;function IF(){if(WM)return Xx;WM=1,Object.defineProperty(Xx,"__esModule",{value:!0});const t=og.__importDefault(EF());class a{constructor(g){var v,E;this.shouldThrowOnError=!1,this.method=g.method,this.url=g.url,this.headers=new Headers(g.headers),this.schema=g.schema,this.body=g.body,this.shouldThrowOnError=(v=g.shouldThrowOnError)!==null&&v!==void 0?v:!1,this.signal=g.signal,this.isMaybeSingle=(E=g.isMaybeSingle)!==null&&E!==void 0?E:!1,g.fetch?this.fetch=g.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(g,v){return this.headers=new Headers(this.headers),this.headers.set(g,v),this}then(g,v){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const E=this.fetch;let o=E(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async O=>{var F,$,Q,te;let J=null,we=null,se=null,me=O.status,fe=O.statusText;if(O.ok){if(this.method!=="HEAD"){const Xe=await O.text();Xe===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((F=this.headers.get("Accept"))===null||F===void 0)&&F.includes("application/vnd.pgrst.plan+text"))?we=Xe:we=JSON.parse(Xe))}const de=($=this.headers.get("Prefer"))===null||$===void 0?void 0:$.match(/count=(exact|planned|estimated)/),Oe=(Q=O.headers.get("content-range"))===null||Q===void 0?void 0:Q.split("/");de&&Oe&&Oe.length>1&&(se=parseInt(Oe[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(we)&&(we.length>1?(J={code:"PGRST116",details:`Results contain ${we.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},we=null,se=null,me=406,fe="Not Acceptable"):we.length===1?we=we[0]:we=null)}else{const de=await O.text();try{J=JSON.parse(de),Array.isArray(J)&&O.status===404&&(we=[],J=null,me=200,fe="OK")}catch{O.status===404&&de===""?(me=204,fe="No Content"):J={message:de}}if(J&&this.isMaybeSingle&&(!((te=J==null?void 0:J.details)===null||te===void 0)&&te.includes("0 rows"))&&(J=null,me=200,fe="OK"),J&&this.shouldThrowOnError)throw new t.default(J)}return{error:J,data:we,count:se,status:me,statusText:fe}});return this.shouldThrowOnError||(o=o.catch(O=>{var F,$,Q;return{error:{message:`${(F=O==null?void 0:O.name)!==null&&F!==void 0?F:"FetchError"}: ${O==null?void 0:O.message}`,details:`${($=O==null?void 0:O.stack)!==null&&$!==void 0?$:""}`,hint:"",code:`${(Q=O==null?void 0:O.code)!==null&&Q!==void 0?Q:""}`},data:null,count:null,status:0,statusText:""}})),o.then(g,v)}returns(){return this}overrideTypes(){return this}}return Xx.default=a,Xx}var ZM;function AF(){if(ZM)return Zx;ZM=1,Object.defineProperty(Zx,"__esModule",{value:!0});const t=og.__importDefault(IF());class a extends t.default{select(g){let v=!1;const E=(g??"*").split("").map(o=>/\s/.test(o)&&!v?"":(o==='"'&&(v=!v),o)).join("");return this.url.searchParams.set("select",E),this.headers.append("Prefer","return=representation"),this}order(g,{ascending:v=!0,nullsFirst:E,foreignTable:o,referencedTable:O=o}={}){const F=O?`${O}.order`:"order",$=this.url.searchParams.get(F);return this.url.searchParams.set(F,`${$?`${$},`:""}${g}.${v?"asc":"desc"}${E===void 0?"":E?".nullsfirst":".nullslast"}`),this}limit(g,{foreignTable:v,referencedTable:E=v}={}){const o=typeof E>"u"?"limit":`${E}.limit`;return this.url.searchParams.set(o,`${g}`),this}range(g,v,{foreignTable:E,referencedTable:o=E}={}){const O=typeof o>"u"?"offset":`${o}.offset`,F=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(O,`${g}`),this.url.searchParams.set(F,`${v-g+1}`),this}abortSignal(g){return this.signal=g,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:g=!1,verbose:v=!1,settings:E=!1,buffers:o=!1,wal:O=!1,format:F="text"}={}){var $;const Q=[g?"analyze":null,v?"verbose":null,E?"settings":null,o?"buffers":null,O?"wal":null].filter(Boolean).join("|"),te=($=this.headers.get("Accept"))!==null&&$!==void 0?$:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${F}; for="${te}"; options=${Q};`),F==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(g){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${g}`),this}}return Zx.default=a,Zx}var XM;function DI(){if(XM)return Wx;XM=1,Object.defineProperty(Wx,"__esModule",{value:!0});const t=og.__importDefault(AF()),a=new RegExp("[,()]");class h extends t.default{eq(v,E){return this.url.searchParams.append(v,`eq.${E}`),this}neq(v,E){return this.url.searchParams.append(v,`neq.${E}`),this}gt(v,E){return this.url.searchParams.append(v,`gt.${E}`),this}gte(v,E){return this.url.searchParams.append(v,`gte.${E}`),this}lt(v,E){return this.url.searchParams.append(v,`lt.${E}`),this}lte(v,E){return this.url.searchParams.append(v,`lte.${E}`),this}like(v,E){return this.url.searchParams.append(v,`like.${E}`),this}likeAllOf(v,E){return this.url.searchParams.append(v,`like(all).{${E.join(",")}}`),this}likeAnyOf(v,E){return this.url.searchParams.append(v,`like(any).{${E.join(",")}}`),this}ilike(v,E){return this.url.searchParams.append(v,`ilike.${E}`),this}ilikeAllOf(v,E){return this.url.searchParams.append(v,`ilike(all).{${E.join(",")}}`),this}ilikeAnyOf(v,E){return this.url.searchParams.append(v,`ilike(any).{${E.join(",")}}`),this}is(v,E){return this.url.searchParams.append(v,`is.${E}`),this}in(v,E){const o=Array.from(new Set(E)).map(O=>typeof O=="string"&&a.test(O)?`"${O}"`:`${O}`).join(",");return this.url.searchParams.append(v,`in.(${o})`),this}contains(v,E){return typeof E=="string"?this.url.searchParams.append(v,`cs.${E}`):Array.isArray(E)?this.url.searchParams.append(v,`cs.{${E.join(",")}}`):this.url.searchParams.append(v,`cs.${JSON.stringify(E)}`),this}containedBy(v,E){return typeof E=="string"?this.url.searchParams.append(v,`cd.${E}`):Array.isArray(E)?this.url.searchParams.append(v,`cd.{${E.join(",")}}`):this.url.searchParams.append(v,`cd.${JSON.stringify(E)}`),this}rangeGt(v,E){return this.url.searchParams.append(v,`sr.${E}`),this}rangeGte(v,E){return this.url.searchParams.append(v,`nxl.${E}`),this}rangeLt(v,E){return this.url.searchParams.append(v,`sl.${E}`),this}rangeLte(v,E){return this.url.searchParams.append(v,`nxr.${E}`),this}rangeAdjacent(v,E){return this.url.searchParams.append(v,`adj.${E}`),this}overlaps(v,E){return typeof E=="string"?this.url.searchParams.append(v,`ov.${E}`):this.url.searchParams.append(v,`ov.{${E.join(",")}}`),this}textSearch(v,E,{config:o,type:O}={}){let F="";O==="plain"?F="pl":O==="phrase"?F="ph":O==="websearch"&&(F="w");const $=o===void 0?"":`(${o})`;return this.url.searchParams.append(v,`${F}fts${$}.${E}`),this}match(v){return Object.entries(v).forEach(([E,o])=>{this.url.searchParams.append(E,`eq.${o}`)}),this}not(v,E,o){return this.url.searchParams.append(v,`not.${E}.${o}`),this}or(v,{foreignTable:E,referencedTable:o=E}={}){const O=o?`${o}.or`:"or";return this.url.searchParams.append(O,`(${v})`),this}filter(v,E,o){return this.url.searchParams.append(v,`${E}.${o}`),this}}return Wx.default=h,Wx}var KM;function CF(){if(KM)return qx;KM=1,Object.defineProperty(qx,"__esModule",{value:!0});const t=og.__importDefault(DI());class a{constructor(g,{headers:v={},schema:E,fetch:o}){this.url=g,this.headers=new Headers(v),this.schema=E,this.fetch=o}select(g,v){const{head:E=!1,count:o}=v??{},O=E?"HEAD":"GET";let F=!1;const $=(g??"*").split("").map(Q=>/\s/.test(Q)&&!F?"":(Q==='"'&&(F=!F),Q)).join("");return this.url.searchParams.set("select",$),o&&this.headers.append("Prefer",`count=${o}`),new t.default({method:O,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(g,{count:v,defaultToNull:E=!0}={}){var o;const O="POST";if(v&&this.headers.append("Prefer",`count=${v}`),E||this.headers.append("Prefer","missing=default"),Array.isArray(g)){const F=g.reduce(($,Q)=>$.concat(Object.keys(Q)),[]);if(F.length>0){const $=[...new Set(F)].map(Q=>`"${Q}"`);this.url.searchParams.set("columns",$.join(","))}}return new t.default({method:O,url:this.url,headers:this.headers,schema:this.schema,body:g,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(g,{onConflict:v,ignoreDuplicates:E=!1,count:o,defaultToNull:O=!0}={}){var F;const $="POST";if(this.headers.append("Prefer",`resolution=${E?"ignore":"merge"}-duplicates`),v!==void 0&&this.url.searchParams.set("on_conflict",v),o&&this.headers.append("Prefer",`count=${o}`),O||this.headers.append("Prefer","missing=default"),Array.isArray(g)){const Q=g.reduce((te,J)=>te.concat(Object.keys(J)),[]);if(Q.length>0){const te=[...new Set(Q)].map(J=>`"${J}"`);this.url.searchParams.set("columns",te.join(","))}}return new t.default({method:$,url:this.url,headers:this.headers,schema:this.schema,body:g,fetch:(F=this.fetch)!==null&&F!==void 0?F:fetch})}update(g,{count:v}={}){var E;const o="PATCH";return v&&this.headers.append("Prefer",`count=${v}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:g,fetch:(E=this.fetch)!==null&&E!==void 0?E:fetch})}delete({count:g}={}){var v;const E="DELETE";return g&&this.headers.append("Prefer",`count=${g}`),new t.default({method:E,url:this.url,headers:this.headers,schema:this.schema,fetch:(v=this.fetch)!==null&&v!==void 0?v:fetch})}}return qx.default=a,qx}var YM;function Lq(){if(YM)return Hx;YM=1,Object.defineProperty(Hx,"__esModule",{value:!0});const i=og,t=i.__importDefault(CF()),a=i.__importDefault(DI());class h{constructor(v,{headers:E={},schema:o,fetch:O}={}){this.url=v,this.headers=new Headers(E),this.schemaName=o,this.fetch=O}from(v){const E=new URL(`${this.url}/${v}`);return new t.default(E,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(v){return new h(this.url,{headers:this.headers,schema:v,fetch:this.fetch})}rpc(v,E={},{head:o=!1,get:O=!1,count:F}={}){var $;let Q;const te=new URL(`${this.url}/rpc/${v}`);let J;o||O?(Q=o?"HEAD":"GET",Object.entries(E).filter(([se,me])=>me!==void 0).map(([se,me])=>[se,Array.isArray(me)?`{${me.join(",")}}`:`${me}`]).forEach(([se,me])=>{te.searchParams.append(se,me)})):(Q="POST",J=E);const we=new Headers(this.headers);return F&&we.set("Prefer",`count=${F}`),new a.default({method:Q,url:te,headers:we,schema:this.schemaName,body:J,fetch:($=this.fetch)!==null&&$!==void 0?$:fetch})}}return Hx.default=h,Hx}Object.defineProperty(ra,"__esModule",{value:!0});var PF=ra.PostgrestError=NF=ra.PostgrestBuilder=FF=ra.PostgrestTransformBuilder=LF=ra.PostgrestFilterBuilder=OF=ra.PostgrestQueryBuilder=kF=ra.PostgrestClient=void 0;const ag=og,RF=ag.__importDefault(Lq());var kF=ra.PostgrestClient=RF.default;const MF=ag.__importDefault(CF());var OF=ra.PostgrestQueryBuilder=MF.default;const DF=ag.__importDefault(DI());var LF=ra.PostgrestFilterBuilder=DF.default;const zF=ag.__importDefault(AF());var FF=ra.PostgrestTransformBuilder=zF.default;const BF=ag.__importDefault(IF());var NF=ra.PostgrestBuilder=BF.default;const jF=ag.__importDefault(EF());PF=ra.PostgrestError=jF.default;var VF=ra.default={PostgrestClient:RF.default,PostgrestQueryBuilder:MF.default,PostgrestFilterBuilder:DF.default,PostgrestTransformBuilder:zF.default,PostgrestBuilder:BF.default,PostgrestError:jF.default};const zq=JO({__proto__:null,get PostgrestBuilder(){return NF},get PostgrestClient(){return kF},get PostgrestError(){return PF},get PostgrestFilterBuilder(){return LF},get PostgrestQueryBuilder(){return OF},get PostgrestTransformBuilder(){return FF},default:VF},[ra]),{PostgrestClient:Fq,PostgrestQueryBuilder:wZ,PostgrestFilterBuilder:bZ,PostgrestTransformBuilder:TZ,PostgrestBuilder:SZ,PostgrestError:EZ}=VF||zq;class Bq{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const a=process.versions;if(a&&a.node){const h=a.node,g=parseInt(h.replace(/^v/,"").split(".")[0]);return g>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${g} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${g} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let a=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(a+=`

Suggested solution: ${t.workaround}`),new Error(a)}static createWebSocket(t,a){const h=this.getWebSocketConstructor();return new h(t,a)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const Nq="2.80.0",jq=`realtime-js/${Nq}`,Vq="1.0.0",i2=1e4,Uq=1e3,$q=100;var Ny;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Ny||(Ny={}));var Ws;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(Ws||(Ws={}));var Vl;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Vl||(Vl={}));var n2;(function(i){i.websocket="websocket"})(n2||(n2={}));var tf;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(tf||(tf={}));class Gq{constructor(){this.HEADER_LENGTH=1}decode(t,a){return t.constructor===ArrayBuffer?a(this._binaryDecode(t)):a(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const a=new DataView(t),h=new TextDecoder;return this._decodeBroadcast(t,a,h)}_decodeBroadcast(t,a,h){const g=a.getUint8(1),v=a.getUint8(2);let E=this.HEADER_LENGTH+2;const o=h.decode(t.slice(E,E+g));E=E+g;const O=h.decode(t.slice(E,E+v));E=E+v;const F=JSON.parse(h.decode(t.slice(E,t.byteLength)));return{ref:null,topic:o,event:O,payload:F}}}class UF{constructor(t,a){this.callback=t,this.timerCalc=a,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=a}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Gn;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(Gn||(Gn={}));const JM=(i,t,a={})=>{var h;const g=(h=a.skipTypes)!==null&&h!==void 0?h:[];return t?Object.keys(t).reduce((v,E)=>(v[E]=Hq(E,i,t,g),v),{}):{}},Hq=(i,t,a,h)=>{const g=t.find(o=>o.name===i),v=g==null?void 0:g.type,E=a[i];return v&&!h.includes(v)?$F(v,E):s2(E)},$F=(i,t)=>{if(i.charAt(0)==="_"){const a=i.slice(1,i.length);return Xq(t,a)}switch(i){case Gn.bool:return qq(t);case Gn.float4:case Gn.float8:case Gn.int2:case Gn.int4:case Gn.int8:case Gn.numeric:case Gn.oid:return Wq(t);case Gn.json:case Gn.jsonb:return Zq(t);case Gn.timestamp:return Kq(t);case Gn.abstime:case Gn.date:case Gn.daterange:case Gn.int4range:case Gn.int8range:case Gn.money:case Gn.reltime:case Gn.text:case Gn.time:case Gn.timestamptz:case Gn.timetz:case Gn.tsrange:case Gn.tstzrange:return s2(t);default:return s2(t)}},s2=i=>i,qq=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},Wq=i=>{if(typeof i=="string"){const t=parseFloat(i);if(!Number.isNaN(t))return t}return i},Zq=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(t){return console.log(`JSON parse error: ${t}`),i}return i},Xq=(i,t)=>{if(typeof i!="string")return i;const a=i.length-1,h=i[a];if(i[0]==="{"&&h==="}"){let v;const E=i.slice(1,a);try{v=JSON.parse("["+E+"]")}catch{v=E?E.split(","):[]}return v.map(o=>$F(t,o))}return i},Kq=i=>typeof i=="string"?i.replace(" ","T"):i,GF=i=>{const t=new URL(i);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class OS{constructor(t,a,h={},g=i2){this.channel=t,this.event=a,this.payload=h,this.timeout=g,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,a){var h;return this._hasReceived(t)&&a((h=this.receivedResp)===null||h===void 0?void 0:h.response),this.recHooks.push({status:t,callback:a}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,a){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:a})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:a}){this.recHooks.filter(h=>h.status===t).forEach(h=>h.callback(a))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var QM;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(QM||(QM={}));class jy{constructor(t,a){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const h=(a==null?void 0:a.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(h.state,{},g=>{const{onJoin:v,onLeave:E,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=jy.syncState(this.state,g,v,E),this.pendingDiffs.forEach(O=>{this.state=jy.syncDiff(this.state,O,v,E)}),this.pendingDiffs=[],o()}),this.channel._on(h.diff,{},g=>{const{onJoin:v,onLeave:E,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(g):(this.state=jy.syncDiff(this.state,g,v,E),o())}),this.onJoin((g,v,E)=>{this.channel._trigger("presence",{event:"join",key:g,currentPresences:v,newPresences:E})}),this.onLeave((g,v,E)=>{this.channel._trigger("presence",{event:"leave",key:g,currentPresences:v,leftPresences:E})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,a,h,g){const v=this.cloneDeep(t),E=this.transformState(a),o={},O={};return this.map(v,(F,$)=>{E[F]||(O[F]=$)}),this.map(E,(F,$)=>{const Q=v[F];if(Q){const te=$.map(me=>me.presence_ref),J=Q.map(me=>me.presence_ref),we=$.filter(me=>J.indexOf(me.presence_ref)<0),se=Q.filter(me=>te.indexOf(me.presence_ref)<0);we.length>0&&(o[F]=we),se.length>0&&(O[F]=se)}else o[F]=$}),this.syncDiff(v,{joins:o,leaves:O},h,g)}static syncDiff(t,a,h,g){const{joins:v,leaves:E}={joins:this.transformState(a.joins),leaves:this.transformState(a.leaves)};return h||(h=()=>{}),g||(g=()=>{}),this.map(v,(o,O)=>{var F;const $=(F=t[o])!==null&&F!==void 0?F:[];if(t[o]=this.cloneDeep(O),$.length>0){const Q=t[o].map(J=>J.presence_ref),te=$.filter(J=>Q.indexOf(J.presence_ref)<0);t[o].unshift(...te)}h(o,$,O)}),this.map(E,(o,O)=>{let F=t[o];if(!F)return;const $=O.map(Q=>Q.presence_ref);F=F.filter(Q=>$.indexOf(Q.presence_ref)<0),t[o]=F,g(o,F,O),F.length===0&&delete t[o]}),t}static map(t,a){return Object.getOwnPropertyNames(t).map(h=>a(h,t[h]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((a,h)=>{const g=t[h];return"metas"in g?a[h]=g.metas.map(v=>(v.presence_ref=v.phx_ref,delete v.phx_ref,delete v.phx_ref_prev,v)):a[h]=g,a},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var eO;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(eO||(eO={}));var Vy;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Vy||(Vy={}));var nu;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(nu||(nu={}));class LI{constructor(t,a={config:{}},h){var g,v;if(this.topic=t,this.params=a,this.socket=h,this.bindings={},this.state=Ws.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},a.config),this.timeout=this.socket.timeout,this.joinPush=new OS(this,Vl.join,this.params,this.timeout),this.rejoinTimer=new UF(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ws.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(E=>E.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ws.closed,this.socket._remove(this)}),this._onError(E=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,E),this.state=Ws.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ws.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",E=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,E),this.state=Ws.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Vl.reply,{},(E,o)=>{this._trigger(this._replyEventName(o),E)}),this.presence=new jy(this),this.broadcastEndpointURL=GF(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((v=(g=this.params.config)===null||g===void 0?void 0:g.broadcast)===null||v===void 0)&&v.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,a=this.timeout){var h,g,v;if(this.socket.isConnected()||this.socket.connect(),this.state==Ws.closed){const{config:{broadcast:E,presence:o,private:O}}=this.params,F=(g=(h=this.bindings.postgres_changes)===null||h===void 0?void 0:h.map(J=>J.filter))!==null&&g!==void 0?g:[],$=!!this.bindings[Vy.PRESENCE]&&this.bindings[Vy.PRESENCE].length>0||((v=this.params.config.presence)===null||v===void 0?void 0:v.enabled)===!0,Q={},te={broadcast:E,presence:Object.assign(Object.assign({},o),{enabled:$}),postgres_changes:F,private:O};this.socket.accessTokenValue&&(Q.access_token=this.socket.accessTokenValue),this._onError(J=>t==null?void 0:t(nu.CHANNEL_ERROR,J)),this._onClose(()=>t==null?void 0:t(nu.CLOSED)),this.updateJoinPayload(Object.assign({config:te},Q)),this.joinedOnce=!0,this._rejoin(a),this.joinPush.receive("ok",async({postgres_changes:J})=>{var we;if(this.socket.setAuth(),J===void 0){t==null||t(nu.SUBSCRIBED);return}else{const se=this.bindings.postgres_changes,me=(we=se==null?void 0:se.length)!==null&&we!==void 0?we:0,fe=[];for(let re=0;re<me;re++){const de=se[re],{filter:{event:Oe,schema:Xe,table:qe,filter:Be}}=de,bt=J&&J[re];if(bt&&bt.event===Oe&&bt.schema===Xe&&bt.table===qe&&bt.filter===Be)fe.push(Object.assign(Object.assign({},de),{id:bt.id}));else{this.unsubscribe(),this.state=Ws.errored,t==null||t(nu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=fe,t&&t(nu.SUBSCRIBED);return}}).receive("error",J=>{this.state=Ws.errored,t==null||t(nu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(J).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(nu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,a={}){return await this.send({type:"presence",event:"track",payload:t},a.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,a,h){return this.state===Ws.joined&&t===Vy.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,a,h)}async httpSend(t,a,h={}){var g;const v=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(a==null)return Promise.reject("Payload is required for httpSend()");const E={method:"POST",headers:{Authorization:v,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:a,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,E,(g=h.timeout)!==null&&g!==void 0?g:this.timeout);if(o.status===202)return{success:!0};let O=o.statusText;try{const F=await o.json();O=F.error||F.message||O}catch{}return Promise.reject(new Error(O))}async send(t,a={}){var h,g;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:v,payload:E}=t,O={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:v,payload:E,private:this.private}]})};try{const F=await this._fetchWithTimeout(this.broadcastEndpointURL,O,(h=a.timeout)!==null&&h!==void 0?h:this.timeout);return await((g=F.body)===null||g===void 0?void 0:g.cancel()),F.ok?"ok":"error"}catch(F){return F.name==="AbortError"?"timed out":"error"}}else return new Promise(v=>{var E,o,O;const F=this._push(t.type,t,a.timeout||this.timeout);t.type==="broadcast"&&!(!((O=(o=(E=this.params)===null||E===void 0?void 0:E.config)===null||o===void 0?void 0:o.broadcast)===null||O===void 0)&&O.ack)&&v("ok"),F.receive("ok",()=>v("ok")),F.receive("error",()=>v("error")),F.receive("timeout",()=>v("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Ws.leaving;const a=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Vl.close,"leave",this._joinRef())};this.joinPush.destroy();let h=null;return new Promise(g=>{h=new OS(this,Vl.leave,{},t),h.receive("ok",()=>{a(),g("ok")}).receive("timeout",()=>{a(),g("timed out")}).receive("error",()=>{g("error")}),h.send(),this._canPush()||h.trigger("ok",{})}).finally(()=>{h==null||h.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ws.closed,this.bindings={}}async _fetchWithTimeout(t,a,h){const g=new AbortController,v=setTimeout(()=>g.abort(),h),E=await this.socket.fetch(t,Object.assign(Object.assign({},a),{signal:g.signal}));return clearTimeout(v),E}_push(t,a,h=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let g=new OS(this,t,a,h);return this._canPush()?g.send():this._addToPushBuffer(g),g}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>$q){const a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(t,a,h){return a}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,a,h){var g,v;const E=t.toLocaleLowerCase(),{close:o,error:O,leave:F,join:$}=Vl;if(h&&[o,O,F,$].indexOf(E)>=0&&h!==this._joinRef())return;let te=this._onMessage(E,a,h);if(a&&!te)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(E)?(g=this.bindings.postgres_changes)===null||g===void 0||g.filter(J=>{var we,se,me;return((we=J.filter)===null||we===void 0?void 0:we.event)==="*"||((me=(se=J.filter)===null||se===void 0?void 0:se.event)===null||me===void 0?void 0:me.toLocaleLowerCase())===E}).map(J=>J.callback(te,h)):(v=this.bindings[E])===null||v===void 0||v.filter(J=>{var we,se,me,fe,re,de;if(["broadcast","presence","postgres_changes"].includes(E))if("id"in J){const Oe=J.id,Xe=(we=J.filter)===null||we===void 0?void 0:we.event;return Oe&&((se=a.ids)===null||se===void 0?void 0:se.includes(Oe))&&(Xe==="*"||(Xe==null?void 0:Xe.toLocaleLowerCase())===((me=a.data)===null||me===void 0?void 0:me.type.toLocaleLowerCase()))}else{const Oe=(re=(fe=J==null?void 0:J.filter)===null||fe===void 0?void 0:fe.event)===null||re===void 0?void 0:re.toLocaleLowerCase();return Oe==="*"||Oe===((de=a==null?void 0:a.event)===null||de===void 0?void 0:de.toLocaleLowerCase())}else return J.type.toLocaleLowerCase()===E}).map(J=>{if(typeof te=="object"&&"ids"in te){const we=te.data,{schema:se,table:me,commit_timestamp:fe,type:re,errors:de}=we;te=Object.assign(Object.assign({},{schema:se,table:me,commit_timestamp:fe,eventType:re,new:{},old:{},errors:de}),this._getPayloadRecords(we))}J.callback(te,h)})}_isClosed(){return this.state===Ws.closed}_isJoined(){return this.state===Ws.joined}_isJoining(){return this.state===Ws.joining}_isLeaving(){return this.state===Ws.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,a,h){const g=t.toLocaleLowerCase(),v={type:g,filter:a,callback:h};return this.bindings[g]?this.bindings[g].push(v):this.bindings[g]=[v],this}_off(t,a){const h=t.toLocaleLowerCase();return this.bindings[h]&&(this.bindings[h]=this.bindings[h].filter(g=>{var v;return!(((v=g.type)===null||v===void 0?void 0:v.toLocaleLowerCase())===h&&LI.isEqual(g.filter,a))})),this}static isEqual(t,a){if(Object.keys(t).length!==Object.keys(a).length)return!1;for(const h in t)if(t[h]!==a[h])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Vl.close,{},t)}_onError(t){this._on(Vl.error,{},a=>t(a))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ws.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const a={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(a.new=JM(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(a.old=JM(t.columns,t.old_record)),a}}const DS=()=>{},Yx={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Yq=[1e3,2e3,5e3,1e4],Jq=1e4,Qq=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eW{constructor(t,a){var h;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=i2,this.transport=null,this.heartbeatIntervalMs=Yx.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=DS,this.ref=0,this.reconnectTimer=null,this.logger=DS,this.conn=null,this.sendBuffer=[],this.serializer=new Gq,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=g=>g?(...v)=>g(...v):(...v)=>fetch(...v),!(!((h=a==null?void 0:a.params)===null||h===void 0)&&h.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=a.params.apikey,this.endPoint=`${t}/${n2.websocket}`,this.httpEndpoint=GF(t),this._initializeOptions(a),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(a==null?void 0:a.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Bq.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const a=t.message;throw a.includes("Node.js")?new Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Vq}))}disconnect(t,a){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const h=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(h),this._setConnectionState("disconnected")},t?this.conn.close(t,a??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const a=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),a}async removeAllChannels(){const t=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,a,h){this.logger(t,a,h)}connectionState(){switch(this.conn&&this.conn.readyState){case Ny.connecting:return tf.Connecting;case Ny.open:return tf.Open;case Ny.closing:return tf.Closing;default:return tf.Closed}}isConnected(){return this.connectionState()===tf.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,a={config:{}}){const h=`realtime:${t}`,g=this.getChannels().find(v=>v.topic===h);if(g)return g;{const v=new LI(`realtime:${t}`,a,this);return this.channels.push(v),v}}push(t){const{topic:a,event:h,payload:g,ref:v}=t,E=()=>{this.encode(t,o=>{var O;(O=this.conn)===null||O===void 0||O.send(o)})};this.log("push",`${a} ${h} (${v})`,g),this.isConnected()?E():this.sendBuffer.push(E)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(Uq,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout()},Yx.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let a=this.channels.find(h=>h.topic===t&&(h._isJoined()||h._isJoining()));a&&(this.log("transport",`leaving duplicate topic "${t}"`),a.unsubscribe())}_remove(t){this.channels=this.channels.filter(a=>a.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,a=>{if(a.topic==="phoenix"&&a.event==="phx_reply")try{this.heartbeatCallback(a.payload.status==="ok"?"ok":"error")}catch(F){this.log("error","error in heartbeat callback",F)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:h,event:g,payload:v,ref:E}=a,o=E?`(${E})`:"",O=v.status||"";this.log("receive",`${O} ${h} ${g} ${o}`.trim(),v),this.channels.filter(F=>F._isMember(h)).forEach(F=>F._trigger(g,v,E)),this._triggerStateCallbacks("message",a)})}_clearTimer(t){var a;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((a=this.reconnectTimer)===null||a===void 0||a.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{a.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var a;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(a=this.reconnectTimer)===null||a===void 0||a.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Vl.error))}_appendParams(t,a){if(Object.keys(a).length===0)return t;const h=t.match(/\?/)?"&":"?",g=new URLSearchParams(a);return`${t}${h}${g}`}_workerObjectUrl(t){let a;if(t)a=t;else{const h=new Blob([Qq],{type:"application/javascript"});a=URL.createObjectURL(h)}return a}_setConnectionState(t,a=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=a)}async _performAuth(t=null){let a;t?a=t:this.accessToken?a=await this.accessToken():a=this.accessTokenValue,this.accessTokenValue!=a&&(this.accessTokenValue=a,this.channels.forEach(h=>{const g={access_token:a,version:jq};a&&h.updateJoinPayload(g),h.joinedOnce&&h._isJoined()&&h._push(Vl.access_token,{access_token:a})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(a=>{this.log("error",`error setting auth in ${t}`,a)})}_triggerStateCallbacks(t,a){try{this.stateChangeCallbacks[t].forEach(h=>{try{h(a)}catch(g){this.log("error",`error in ${t} callback`,g)}})}catch(h){this.log("error",`error triggering ${t} callbacks`,h)}}_setupReconnectionTimer(){this.reconnectTimer=new UF(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Yx.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var a,h,g,v,E,o,O,F,$;if(this.transport=(a=t==null?void 0:t.transport)!==null&&a!==void 0?a:null,this.timeout=(h=t==null?void 0:t.timeout)!==null&&h!==void 0?h:i2,this.heartbeatIntervalMs=(g=t==null?void 0:t.heartbeatIntervalMs)!==null&&g!==void 0?g:Yx.HEARTBEAT_INTERVAL,this.worker=(v=t==null?void 0:t.worker)!==null&&v!==void 0?v:!1,this.accessToken=(E=t==null?void 0:t.accessToken)!==null&&E!==void 0?E:null,this.heartbeatCallback=(o=t==null?void 0:t.heartbeatCallback)!==null&&o!==void 0?o:DS,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(O=t==null?void 0:t.reconnectAfterMs)!==null&&O!==void 0?O:Q=>Yq[Q-1]||Jq,this.encode=(F=t==null?void 0:t.encode)!==null&&F!==void 0?F:(Q,te)=>te(JSON.stringify(Q)),this.decode=($=t==null?void 0:t.decode)!==null&&$!==void 0?$:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class zI extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function hs(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class tW extends zI{constructor(t,a,h){super(t),this.name="StorageApiError",this.status=a,this.statusCode=h}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class o2 extends zI{constructor(t,a){super(t),this.name="StorageUnknownError",this.originalError=a}}const FI=i=>i?(...t)=>i(...t):(...t)=>fetch(...t),rW=()=>Response,a2=i=>{if(Array.isArray(i))return i.map(a=>a2(a));if(typeof i=="function"||i!==Object(i))return i;const t={};return Object.entries(i).forEach(([a,h])=>{const g=a.replace(/([-_][a-z])/gi,v=>v.toUpperCase().replace(/[-_]/g,""));t[g]=a2(h)}),t},iW=i=>{if(typeof i!="object"||i===null)return!1;const t=Object.getPrototypeOf(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},LS=i=>{var t;return i.msg||i.message||i.error_description||(typeof i.error=="string"?i.error:(t=i.error)===null||t===void 0?void 0:t.message)||JSON.stringify(i)},nW=(i,t,a)=>Wr(void 0,void 0,void 0,function*(){const h=yield rW();i instanceof h&&!(a!=null&&a.noResolveJson)?i.json().then(g=>{const v=i.status||500,E=(g==null?void 0:g.statusCode)||v+"";t(new tW(LS(g),v,E))}).catch(g=>{t(new o2(LS(g),g))}):t(new o2(LS(i),i))}),sW=(i,t,a,h)=>{const g={method:i,headers:(t==null?void 0:t.headers)||{}};return i==="GET"||!h?g:(iW(h)?(g.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),g.body=JSON.stringify(h)):g.body=h,t!=null&&t.duplex&&(g.duplex=t.duplex),Object.assign(Object.assign({},g),a))};function C0(i,t,a,h,g,v){return Wr(this,void 0,void 0,function*(){return new Promise((E,o)=>{i(a,sW(t,h,g,v)).then(O=>{if(!O.ok)throw O;return h!=null&&h.noResolveJson?O:O.json()}).then(O=>E(O)).catch(O=>nW(O,o,h))})})}function h0(i,t,a,h){return Wr(this,void 0,void 0,function*(){return C0(i,"GET",t,a,h)})}function Fl(i,t,a,h,g){return Wr(this,void 0,void 0,function*(){return C0(i,"POST",t,h,g,a)})}function l2(i,t,a,h,g){return Wr(this,void 0,void 0,function*(){return C0(i,"PUT",t,h,g,a)})}function oW(i,t,a,h){return Wr(this,void 0,void 0,function*(){return C0(i,"HEAD",t,Object.assign(Object.assign({},a),{noResolveJson:!0}),h)})}function BI(i,t,a,h,g){return Wr(this,void 0,void 0,function*(){return C0(i,"DELETE",t,h,g,a)})}class aW{constructor(t,a){this.downloadFn=t,this.shouldThrowOnError=a}then(t,a){return this.execute().then(t,a)}execute(){return Wr(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hs(t))return{data:null,error:t};throw t}})}}var HF;class lW{constructor(t,a){this.downloadFn=t,this.shouldThrowOnError=a,this[HF]="BlobDownloadBuilder",this.promise=null}asStream(){return new aW(this.downloadFn,this.shouldThrowOnError)}then(t,a){return this.getPromise().then(t,a)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Wr(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(hs(t))return{data:null,error:t};throw t}})}}HF=Symbol.toStringTag;const cW={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},tO={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class uW{constructor(t,a={},h,g){this.shouldThrowOnError=!1,this.url=t,this.headers=a,this.bucketId=h,this.fetch=FI(g)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,a,h,g){return Wr(this,void 0,void 0,function*(){try{let v;const E=Object.assign(Object.assign({},tO),g);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(E.upsert)});const O=E.metadata;typeof Blob<"u"&&h instanceof Blob?(v=new FormData,v.append("cacheControl",E.cacheControl),O&&v.append("metadata",this.encodeMetadata(O)),v.append("",h)):typeof FormData<"u"&&h instanceof FormData?(v=h,v.has("cacheControl")||v.append("cacheControl",E.cacheControl),O&&!v.has("metadata")&&v.append("metadata",this.encodeMetadata(O))):(v=h,o["cache-control"]=`max-age=${E.cacheControl}`,o["content-type"]=E.contentType,O&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(O))),(typeof ReadableStream<"u"&&v instanceof ReadableStream||v&&typeof v=="object"&&"pipe"in v&&typeof v.pipe=="function")&&!E.duplex&&(E.duplex="half")),g!=null&&g.headers&&(o=Object.assign(Object.assign({},o),g.headers));const F=this._removeEmptyFolders(a),$=this._getFinalPath(F),Q=yield(t=="PUT"?l2:Fl)(this.fetch,`${this.url}/object/${$}`,v,Object.assign({headers:o},E!=null&&E.duplex?{duplex:E.duplex}:{}));return{data:{path:F,id:Q.Id,fullPath:Q.Key},error:null}}catch(v){if(this.shouldThrowOnError)throw v;if(hs(v))return{data:null,error:v};throw v}})}upload(t,a,h){return Wr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,a,h)})}uploadToSignedUrl(t,a,h,g){return Wr(this,void 0,void 0,function*(){const v=this._removeEmptyFolders(t),E=this._getFinalPath(v),o=new URL(this.url+`/object/upload/sign/${E}`);o.searchParams.set("token",a);try{let O;const F=Object.assign({upsert:tO.upsert},g),$=Object.assign(Object.assign({},this.headers),{"x-upsert":String(F.upsert)});typeof Blob<"u"&&h instanceof Blob?(O=new FormData,O.append("cacheControl",F.cacheControl),O.append("",h)):typeof FormData<"u"&&h instanceof FormData?(O=h,O.append("cacheControl",F.cacheControl)):(O=h,$["cache-control"]=`max-age=${F.cacheControl}`,$["content-type"]=F.contentType);const Q=yield l2(this.fetch,o.toString(),O,{headers:$});return{data:{path:v,fullPath:Q.Key},error:null}}catch(O){if(this.shouldThrowOnError)throw O;if(hs(O))return{data:null,error:O};throw O}})}createSignedUploadUrl(t,a){return Wr(this,void 0,void 0,function*(){try{let h=this._getFinalPath(t);const g=Object.assign({},this.headers);a!=null&&a.upsert&&(g["x-upsert"]="true");const v=yield Fl(this.fetch,`${this.url}/object/upload/sign/${h}`,{},{headers:g}),E=new URL(this.url+v.url),o=E.searchParams.get("token");if(!o)throw new zI("No token returned by API");return{data:{signedUrl:E.toString(),path:t,token:o},error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(hs(h))return{data:null,error:h};throw h}})}update(t,a,h){return Wr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,a,h)})}move(t,a,h){return Wr(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:a,destinationBucket:h==null?void 0:h.destinationBucket},{headers:this.headers}),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}copy(t,a,h){return Wr(this,void 0,void 0,function*(){try{return{data:{path:(yield Fl(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:a,destinationBucket:h==null?void 0:h.destinationBucket},{headers:this.headers})).Key},error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}createSignedUrl(t,a,h){return Wr(this,void 0,void 0,function*(){try{let g=this._getFinalPath(t),v=yield Fl(this.fetch,`${this.url}/object/sign/${g}`,Object.assign({expiresIn:a},h!=null&&h.transform?{transform:h.transform}:{}),{headers:this.headers});const E=h!=null&&h.download?`&download=${h.download===!0?"":h.download}`:"";return v={signedUrl:encodeURI(`${this.url}${v.signedURL}${E}`)},{data:v,error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}createSignedUrls(t,a,h){return Wr(this,void 0,void 0,function*(){try{const g=yield Fl(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:a,paths:t},{headers:this.headers}),v=h!=null&&h.download?`&download=${h.download===!0?"":h.download}`:"";return{data:g.map(E=>Object.assign(Object.assign({},E),{signedUrl:E.signedURL?encodeURI(`${this.url}${E.signedURL}${v}`):null})),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}download(t,a){const g=typeof(a==null?void 0:a.transform)<"u"?"render/image/authenticated":"object",v=this.transformOptsToQueryString((a==null?void 0:a.transform)||{}),E=v?`?${v}`:"",o=this._getFinalPath(t),O=()=>h0(this.fetch,`${this.url}/${g}/${o}${E}`,{headers:this.headers,noResolveJson:!0});return new lW(O,this.shouldThrowOnError)}info(t){return Wr(this,void 0,void 0,function*(){const a=this._getFinalPath(t);try{const h=yield h0(this.fetch,`${this.url}/object/info/${a}`,{headers:this.headers});return{data:a2(h),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(hs(h))return{data:null,error:h};throw h}})}exists(t){return Wr(this,void 0,void 0,function*(){const a=this._getFinalPath(t);try{return yield oW(this.fetch,`${this.url}/object/${a}`,{headers:this.headers}),{data:!0,error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(hs(h)&&h instanceof o2){const g=h.originalError;if([400,404].includes(g==null?void 0:g.status))return{data:!1,error:h}}throw h}})}getPublicUrl(t,a){const h=this._getFinalPath(t),g=[],v=a!=null&&a.download?`download=${a.download===!0?"":a.download}`:"";v!==""&&g.push(v);const o=typeof(a==null?void 0:a.transform)<"u"?"render/image":"object",O=this.transformOptsToQueryString((a==null?void 0:a.transform)||{});O!==""&&g.push(O);let F=g.join("&");return F!==""&&(F=`?${F}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${h}${F}`)}}}remove(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield BI(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}list(t,a,h){return Wr(this,void 0,void 0,function*(){try{const g=Object.assign(Object.assign(Object.assign({},cW),a),{prefix:t||""});return{data:yield Fl(this.fetch,`${this.url}/object/list/${this.bucketId}`,g,{headers:this.headers},h),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}listV2(t,a){return Wr(this,void 0,void 0,function*(){try{const h=Object.assign({},t);return{data:yield Fl(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,h,{headers:this.headers},a),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(hs(h))return{data:null,error:h};throw h}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const a=[];return t.width&&a.push(`width=${t.width}`),t.height&&a.push(`height=${t.height}`),t.resize&&a.push(`resize=${t.resize}`),t.format&&a.push(`format=${t.format}`),t.quality&&a.push(`quality=${t.quality}`),a.join("&")}}const qF="2.80.0",WF={"X-Client-Info":`storage-js/${qF}`};class hW{constructor(t,a={},h,g){this.shouldThrowOnError=!1;const v=new URL(t);g!=null&&g.useNewHostname&&/supabase\.(co|in|red)$/.test(v.hostname)&&!v.hostname.includes("storage.supabase.")&&(v.hostname=v.hostname.replace("supabase.","storage.supabase.")),this.url=v.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},WF),a),this.fetch=FI(h)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return Wr(this,void 0,void 0,function*(){try{const a=this.listBucketOptionsToQueryString(t);return{data:yield h0(this.fetch,`${this.url}/bucket${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}getBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield h0(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}createBucket(t){return Wr(this,arguments,void 0,function*(a,h={public:!1}){try{return{data:yield Fl(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:h.type,public:h.public,file_size_limit:h.fileSizeLimit,allowed_mime_types:h.allowedMimeTypes},{headers:this.headers}),error:null}}catch(g){if(this.shouldThrowOnError)throw g;if(hs(g))return{data:null,error:g};throw g}})}updateBucket(t,a){return Wr(this,void 0,void 0,function*(){try{return{data:yield l2(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:a.public,file_size_limit:a.fileSizeLimit,allowed_mime_types:a.allowedMimeTypes},{headers:this.headers}),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(hs(h))return{data:null,error:h};throw h}})}emptyBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}deleteBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield BI(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(t){const a={};return t&&("limit"in t&&(a.limit=String(t.limit)),"offset"in t&&(a.offset=String(t.offset)),t.search&&(a.search=t.search),t.sortColumn&&(a.sortColumn=t.sortColumn),t.sortOrder&&(a.sortOrder=t.sortOrder)),Object.keys(a).length>0?"?"+new URLSearchParams(a).toString():""}}class dW{constructor(t,a={},h){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},WF),a),this.fetch=FI(h)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Fl(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}listBuckets(t){return Wr(this,void 0,void 0,function*(){try{const a=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&a.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&a.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&a.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&a.set("sortOrder",t.sortOrder),t!=null&&t.search&&a.set("search",t.search);const h=a.toString(),g=h?`${this.url}/bucket?${h}`:`${this.url}/bucket`;return{data:yield h0(this.fetch,g,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}deleteBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield BI(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(hs(a))return{data:null,error:a};throw a}})}}const NI={"X-Client-Info":`storage-js/${qF}`,"Content-Type":"application/json"};class ZF extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function Va(i){return typeof i=="object"&&i!==null&&"__isStorageVectorsError"in i}class zS extends ZF{constructor(t,a,h){super(t),this.name="StorageVectorsApiError",this.status=a,this.statusCode=h}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class fW extends ZF{constructor(t,a){super(t),this.name="StorageVectorsUnknownError",this.originalError=a}}var rO;(function(i){i.InternalError="InternalError",i.S3VectorConflictException="S3VectorConflictException",i.S3VectorNotFoundException="S3VectorNotFoundException",i.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",i.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",i.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(rO||(rO={}));const jI=i=>i?(...t)=>i(...t):(...t)=>fetch(...t),pW=i=>{if(typeof i!="object"||i===null)return!1;const t=Object.getPrototypeOf(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},iO=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),mW=(i,t,a)=>Wr(void 0,void 0,void 0,function*(){if(i&&typeof i=="object"&&"status"in i&&"ok"in i&&typeof i.status=="number"&&!(a!=null&&a.noResolveJson)){const g=i.status||500,v=i;if(typeof v.json=="function")v.json().then(E=>{const o=(E==null?void 0:E.statusCode)||(E==null?void 0:E.code)||g+"";t(new zS(iO(E),g,o))}).catch(()=>{const E=g+"",o=v.statusText||`HTTP ${g} error`;t(new zS(o,g,E))});else{const E=g+"",o=v.statusText||`HTTP ${g} error`;t(new zS(o,g,E))}}else t(new fW(iO(i),i))}),gW=(i,t,a,h)=>{const g={method:i,headers:(t==null?void 0:t.headers)||{}};return h?(pW(h)?(g.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),g.body=JSON.stringify(h)):g.body=h,Object.assign(Object.assign({},g),a)):g};function _W(i,t,a,h,g,v){return Wr(this,void 0,void 0,function*(){return new Promise((E,o)=>{i(a,gW(t,h,g,v)).then(O=>{if(!O.ok)throw O;if(h!=null&&h.noResolveJson)return O;const F=O.headers.get("content-type");return!F||!F.includes("application/json")?{}:O.json()}).then(O=>E(O)).catch(O=>mW(O,o,h))})})}function Ua(i,t,a,h,g){return Wr(this,void 0,void 0,function*(){return _W(i,"POST",t,h,g,a)})}class yW{constructor(t,a={},h){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NI),a),this.fetch=jI(h)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return Wr(this,void 0,void 0,function*(){try{return{data:(yield Ua(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}getIndex(t,a){return Wr(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:a},{headers:this.headers}),error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Va(h))return{data:null,error:h};throw h}})}listIndexes(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}deleteIndex(t,a){return Wr(this,void 0,void 0,function*(){try{return{data:(yield Ua(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:a},{headers:this.headers}))||{},error:null}}catch(h){if(this.shouldThrowOnError)throw h;if(Va(h))return{data:null,error:h};throw h}})}}class vW{constructor(t,a={},h){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NI),a),this.fetch=jI(h)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return Wr(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield Ua(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}getVectors(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}listVectors(t){return Wr(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield Ua(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}queryVectors(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}deleteVectors(t){return Wr(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield Ua(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}}class xW{constructor(t,a={},h){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},NI),a),this.fetch=jI(h)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:(yield Ua(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}getBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:yield Ua(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}listBuckets(){return Wr(this,arguments,void 0,function*(t={}){try{return{data:yield Ua(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}deleteBucket(t){return Wr(this,void 0,void 0,function*(){try{return{data:(yield Ua(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Va(a))return{data:null,error:a};throw a}})}}class wW extends xW{constructor(t,a={}){super(t,a.headers||{},a.fetch)}from(t){return new bW(this.url,this.headers,t,this.fetch)}}class bW extends yW{constructor(t,a,h,g){super(t,a,g),this.vectorBucketName=h}createIndex(t){const a=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Wr(this,void 0,void 0,function*(){return a.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Wr(this,arguments,void 0,function*(a={}){return t.listIndexes.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const a=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Wr(this,void 0,void 0,function*(){return a.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const a=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Wr(this,void 0,void 0,function*(){return a.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new TW(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class TW extends vW{constructor(t,a,h,g,v){super(t,a,v),this.vectorBucketName=h,this.indexName=g}putVectors(t){const a=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Wr(this,void 0,void 0,function*(){return a.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const a=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Wr(this,void 0,void 0,function*(){return a.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Wr(this,arguments,void 0,function*(a={}){return t.listVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const a=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Wr(this,void 0,void 0,function*(){return a.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const a=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Wr(this,void 0,void 0,function*(){return a.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class SW extends hW{constructor(t,a={},h,g){super(t,a,h,g)}from(t){return new uW(this.url,this.headers,t,this.fetch)}get vectors(){return new wW(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new dW(this.url+"/iceberg",this.headers,this.fetch)}}const EW="2.80.0";let Ay="";typeof Deno<"u"?Ay="deno":typeof document<"u"?Ay="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ay="react-native":Ay="node";const IW={"X-Client-Info":`supabase-js-${Ay}/${EW}`},AW={headers:IW},CW={schema:"public"},PW={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},RW={},kW=i=>i?(...t)=>i(...t):(...t)=>fetch(...t),MW=()=>Headers,OW=(i,t,a)=>{const h=kW(a),g=MW();return async(v,E)=>{var o;const O=(o=await t())!==null&&o!==void 0?o:i;let F=new g(E==null?void 0:E.headers);return F.has("apikey")||F.set("apikey",i),F.has("Authorization")||F.set("Authorization",`Bearer ${O}`),h(v,Object.assign(Object.assign({},E),{headers:F}))}};function DW(i){return i.endsWith("/")?i:i+"/"}function LW(i,t){var a,h;const{db:g,auth:v,realtime:E,global:o}=i,{db:O,auth:F,realtime:$,global:Q}=t,te={db:Object.assign(Object.assign({},O),g),auth:Object.assign(Object.assign({},F),v),realtime:Object.assign(Object.assign({},$),E),storage:{},global:Object.assign(Object.assign(Object.assign({},Q),o),{headers:Object.assign(Object.assign({},(a=Q==null?void 0:Q.headers)!==null&&a!==void 0?a:{}),(h=o==null?void 0:o.headers)!==null&&h!==void 0?h:{})}),accessToken:async()=>""};return i.accessToken?te.accessToken=i.accessToken:delete te.accessToken,te}function zW(i){const t=i==null?void 0:i.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(DW(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const XF="2.80.0",om=30*1e3,c2=3,FS=c2*om,FW="http://localhost:9999",BW="supabase.auth.token",NW={"X-Client-Info":`gotrue-js/${XF}`},u2="X-Supabase-Api-Version",KF={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jW=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,VW=10*60*1e3;class d0 extends Error{constructor(t,a,h){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=a,this.code=h}}function Yr(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class UW extends d0{constructor(t,a,h){super(t,a,h),this.name="AuthApiError",this.status=a,this.code=h}}function $W(i){return Yr(i)&&i.name==="AuthApiError"}class rf extends d0{constructor(t,a){super(t),this.name="AuthUnknownError",this.originalError=a}}class Kh extends d0{constructor(t,a,h,g){super(t,h,g),this.name=a,this.status=h}}class Ol extends Kh{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function GW(i){return Yr(i)&&i.name==="AuthSessionMissingError"}class em extends Kh{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Jx extends Kh{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Qx extends Kh{constructor(t,a=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function HW(i){return Yr(i)&&i.name==="AuthImplicitGrantRedirectError"}class nO extends Kh{constructor(t,a=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=a}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class h2 extends Kh{constructor(t,a){super(t,"AuthRetryableFetchError",a,void 0)}}function BS(i){return Yr(i)&&i.name==="AuthRetryableFetchError"}class sO extends Kh{constructor(t,a,h){super(t,"AuthWeakPasswordError",a,"weak_password"),this.reasons=h}}class d2 extends Kh{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const iw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),oO=` 	
\r=`.split(""),qW=(()=>{const i=new Array(128);for(let t=0;t<i.length;t+=1)i[t]=-1;for(let t=0;t<oO.length;t+=1)i[oO[t].charCodeAt(0)]=-2;for(let t=0;t<iw.length;t+=1)i[iw[t].charCodeAt(0)]=t;return i})();function aO(i,t,a){if(i!==null)for(t.queue=t.queue<<8|i,t.queuedBits+=8;t.queuedBits>=6;){const h=t.queue>>t.queuedBits-6&63;a(iw[h]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const h=t.queue>>t.queuedBits-6&63;a(iw[h]),t.queuedBits-=6}}function YF(i,t,a){const h=qW[i];if(h>-1)for(t.queue=t.queue<<6|h,t.queuedBits+=6;t.queuedBits>=8;)a(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(h===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function lO(i){const t=[],a=E=>{t.push(String.fromCodePoint(E))},h={utf8seq:0,codepoint:0},g={queue:0,queuedBits:0},v=E=>{XW(E,h,a)};for(let E=0;E<i.length;E+=1)YF(i.charCodeAt(E),g,v);return t.join("")}function WW(i,t){if(i<=127){t(i);return}else if(i<=2047){t(192|i>>6),t(128|i&63);return}else if(i<=65535){t(224|i>>12),t(128|i>>6&63),t(128|i&63);return}else if(i<=1114111){t(240|i>>18),t(128|i>>12&63),t(128|i>>6&63),t(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function ZW(i,t){for(let a=0;a<i.length;a+=1){let h=i.charCodeAt(a);if(h>55295&&h<=56319){const g=(h-55296)*1024&65535;h=(i.charCodeAt(a+1)-56320&65535|g)+65536,a+=1}WW(h,t)}}function XW(i,t,a){if(t.utf8seq===0){if(i<=127){a(i);return}for(let h=1;h<6;h+=1)if(!(i>>7-h&1)){t.utf8seq=h;break}if(t.utf8seq===2)t.codepoint=i&31;else if(t.utf8seq===3)t.codepoint=i&15;else if(t.utf8seq===4)t.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|i&63,t.utf8seq-=1,t.utf8seq===0&&a(t.codepoint)}}function Rm(i){const t=[],a={queue:0,queuedBits:0},h=g=>{t.push(g)};for(let g=0;g<i.length;g+=1)YF(i.charCodeAt(g),a,h);return new Uint8Array(t)}function KW(i){const t=[];return ZW(i,a=>t.push(a)),new Uint8Array(t)}function af(i){const t=[],a={queue:0,queuedBits:0},h=g=>{t.push(g)};return i.forEach(g=>aO(g,a,h)),aO(null,a,h),t.join("")}function YW(i){return Math.round(Date.now()/1e3)+i}function JW(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const t=Math.random()*16|0;return(i=="x"?t:t&3|8).toString(16)})}const Ro=()=>typeof window<"u"&&typeof document<"u",Kd={tested:!1,writable:!1},JF=()=>{if(!Ro())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Kd.tested)return Kd.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Kd.tested=!0,Kd.writable=!0}catch{Kd.tested=!0,Kd.writable=!1}return Kd.writable};function QW(i){const t={},a=new URL(i);if(a.hash&&a.hash[0]==="#")try{new URLSearchParams(a.hash.substring(1)).forEach((g,v)=>{t[v]=g})}catch{}return a.searchParams.forEach((h,g)=>{t[g]=h}),t}const QF=i=>i?(...t)=>i(...t):(...t)=>fetch(...t),e9=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",am=async(i,t,a)=>{await i.setItem(t,JSON.stringify(a))},Yd=async(i,t)=>{const a=await i.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch{return a}},fh=async(i,t)=>{await i.removeItem(t)};class qw{constructor(){this.promise=new qw.promiseConstructor((t,a)=>{this.resolve=t,this.reject=a})}}qw.promiseConstructor=Promise;function NS(i){const t=i.split(".");if(t.length!==3)throw new d2("Invalid JWT structure");for(let h=0;h<t.length;h++)if(!jW.test(t[h]))throw new d2("JWT not in base64url format");return{header:JSON.parse(lO(t[0])),payload:JSON.parse(lO(t[1])),signature:Rm(t[2]),raw:{header:t[0],payload:t[1]}}}async function t9(i){return await new Promise(t=>{setTimeout(()=>t(null),i)})}function r9(i,t){return new Promise((h,g)=>{(async()=>{for(let v=0;v<1/0;v++)try{const E=await i(v);if(!t(v,null,E)){h(E);return}}catch(E){if(!t(v,E)){g(E);return}}})()})}function i9(i){return("0"+i.toString(16)).substr(-2)}function n9(){const t=new Uint32Array(56);if(typeof crypto>"u"){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",h=a.length;let g="";for(let v=0;v<56;v++)g+=a.charAt(Math.floor(Math.random()*h));return g}return crypto.getRandomValues(t),Array.from(t,i9).join("")}async function s9(i){const a=new TextEncoder().encode(i),h=await crypto.subtle.digest("SHA-256",a),g=new Uint8Array(h);return Array.from(g).map(v=>String.fromCharCode(v)).join("")}async function o9(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const a=await s9(i);return btoa(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tm(i,t,a=!1){const h=n9();let g=h;a&&(g+="/PASSWORD_RECOVERY"),await am(i,`${t}-code-verifier`,g);const v=await o9(h);return[v,h===v?"plain":"s256"]}const a9=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function l9(i){const t=i.headers.get(u2);if(!t||!t.match(a9))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function c9(i){if(!i)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(i<=t)throw new Error("JWT has expired")}function u9(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const h9=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function rm(i){if(!h9.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function jS(){const i={};return new Proxy(i,{get:(t,a)=>{if(a==="__isUserNotAvailableProxy")return!0;if(typeof a=="symbol"){const h=a.toString();if(h==="Symbol(Symbol.toPrimitive)"||h==="Symbol(Symbol.toStringTag)"||h==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${a}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,a)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${a}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function d9(i,t){return new Proxy(i,{get:(a,h,g)=>{if(h==="__isInsecureUserWarningProxy")return!0;if(typeof h=="symbol"){const v=h.toString();if(v==="Symbol(Symbol.toPrimitive)"||v==="Symbol(Symbol.toStringTag)"||v==="Symbol(util.inspect.custom)"||v==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(a,h,g)}return!t.value&&typeof h=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(a,h,g)}})}function cO(i){return JSON.parse(JSON.stringify(i))}const ef=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),f9=[502,503,504];async function uO(i){var t;if(!e9(i))throw new h2(ef(i),0);if(f9.includes(i.status))throw new h2(ef(i),i.status);let a;try{a=await i.json()}catch(v){throw new rf(ef(v),v)}let h;const g=l9(i);if(g&&g.getTime()>=KF["2024-01-01"].timestamp&&typeof a=="object"&&a&&typeof a.code=="string"?h=a.code:typeof a=="object"&&a&&typeof a.error_code=="string"&&(h=a.error_code),h){if(h==="weak_password")throw new sO(ef(a),i.status,((t=a.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(h==="session_not_found")throw new Ol}else if(typeof a=="object"&&a&&typeof a.weak_password=="object"&&a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.reasons.reduce((v,E)=>v&&typeof E=="string",!0))throw new sO(ef(a),i.status,a.weak_password.reasons);throw new UW(ef(a),i.status||500,h)}const p9=(i,t,a,h)=>{const g={method:i,headers:(t==null?void 0:t.headers)||{}};return i==="GET"?g:(g.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),g.body=JSON.stringify(h),Object.assign(Object.assign({},g),a))};async function xi(i,t,a,h){var g;const v=Object.assign({},h==null?void 0:h.headers);v[u2]||(v[u2]=KF["2024-01-01"].name),h!=null&&h.jwt&&(v.Authorization=`Bearer ${h.jwt}`);const E=(g=h==null?void 0:h.query)!==null&&g!==void 0?g:{};h!=null&&h.redirectTo&&(E.redirect_to=h.redirectTo);const o=Object.keys(E).length?"?"+new URLSearchParams(E).toString():"",O=await m9(i,t,a+o,{headers:v,noResolveJson:h==null?void 0:h.noResolveJson},{},h==null?void 0:h.body);return h!=null&&h.xform?h==null?void 0:h.xform(O):{data:Object.assign({},O),error:null}}async function m9(i,t,a,h,g,v){const E=p9(t,h,g,v);let o;try{o=await i(a,Object.assign({},E))}catch(O){throw console.error(O),new h2(ef(O),0)}if(o.ok||await uO(o),h!=null&&h.noResolveJson)return o;try{return await o.json()}catch(O){await uO(O)}}function Dl(i){var t;let a=null;y9(i)&&(a=Object.assign({},i),i.expires_at||(a.expires_at=YW(i.expires_in)));const h=(t=i.user)!==null&&t!==void 0?t:i;return{data:{session:a,user:h},error:null}}function hO(i){const t=Dl(i);return!t.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((a,h)=>a&&typeof h=="string",!0)&&(t.data.weak_password=i.weak_password),t}function xh(i){var t;return{data:{user:(t=i.user)!==null&&t!==void 0?t:i},error:null}}function g9(i){return{data:i,error:null}}function _9(i){const{action_link:t,email_otp:a,hashed_token:h,redirect_to:g,verification_type:v}=i,E=sg(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:a,hashed_token:h,redirect_to:g,verification_type:v},O=Object.assign({},E);return{data:{properties:o,user:O},error:null}}function dO(i){return i}function y9(i){return i.access_token&&i.refresh_token&&i.expires_in}const VS=["global","local","others"];class v9{constructor({url:t="",headers:a={},fetch:h}){this.url=t,this.headers=a,this.fetch=QF(h),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,a=VS[0]){if(VS.indexOf(a)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${VS.join(", ")}`);try{return await xi(this.fetch,"POST",`${this.url}/logout?scope=${a}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(h){if(Yr(h))return{data:null,error:h};throw h}}async inviteUserByEmail(t,a={}){try{return await xi(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:a.data},headers:this.headers,redirectTo:a.redirectTo,xform:xh})}catch(h){if(Yr(h))return{data:{user:null},error:h};throw h}}async generateLink(t){try{const{options:a}=t,h=sg(t,["options"]),g=Object.assign(Object.assign({},h),a);return"newEmail"in h&&(g.new_email=h==null?void 0:h.newEmail,delete g.newEmail),await xi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:g,headers:this.headers,xform:_9,redirectTo:a==null?void 0:a.redirectTo})}catch(a){if(Yr(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(t){try{return await xi(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:xh})}catch(a){if(Yr(a))return{data:{user:null},error:a};throw a}}async listUsers(t){var a,h,g,v,E,o,O;try{const F={nextPage:null,lastPage:0,total:0},$=await xi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(h=(a=t==null?void 0:t.page)===null||a===void 0?void 0:a.toString())!==null&&h!==void 0?h:"",per_page:(v=(g=t==null?void 0:t.perPage)===null||g===void 0?void 0:g.toString())!==null&&v!==void 0?v:""},xform:dO});if($.error)throw $.error;const Q=await $.json(),te=(E=$.headers.get("x-total-count"))!==null&&E!==void 0?E:0,J=(O=(o=$.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&O!==void 0?O:[];return J.length>0&&(J.forEach(we=>{const se=parseInt(we.split(";")[0].split("=")[1].substring(0,1)),me=JSON.parse(we.split(";")[1].split("=")[1]);F[`${me}Page`]=se}),F.total=parseInt(te)),{data:Object.assign(Object.assign({},Q),F),error:null}}catch(F){if(Yr(F))return{data:{users:[]},error:F};throw F}}async getUserById(t){rm(t);try{return await xi(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:xh})}catch(a){if(Yr(a))return{data:{user:null},error:a};throw a}}async updateUserById(t,a){rm(t);try{return await xi(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:a,headers:this.headers,xform:xh})}catch(h){if(Yr(h))return{data:{user:null},error:h};throw h}}async deleteUser(t,a=!1){rm(t);try{return await xi(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:a},xform:xh})}catch(h){if(Yr(h))return{data:{user:null},error:h};throw h}}async _listFactors(t){rm(t.userId);try{const{data:a,error:h}=await xi(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:g=>({data:{factors:g},error:null})});return{data:a,error:h}}catch(a){if(Yr(a))return{data:null,error:a};throw a}}async _deleteFactor(t){rm(t.userId),rm(t.id);try{return{data:await xi(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(a){if(Yr(a))return{data:null,error:a};throw a}}async _listOAuthClients(t){var a,h,g,v,E,o,O;try{const F={nextPage:null,lastPage:0,total:0},$=await xi(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(h=(a=t==null?void 0:t.page)===null||a===void 0?void 0:a.toString())!==null&&h!==void 0?h:"",per_page:(v=(g=t==null?void 0:t.perPage)===null||g===void 0?void 0:g.toString())!==null&&v!==void 0?v:""},xform:dO});if($.error)throw $.error;const Q=await $.json(),te=(E=$.headers.get("x-total-count"))!==null&&E!==void 0?E:0,J=(O=(o=$.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&O!==void 0?O:[];return J.length>0&&(J.forEach(we=>{const se=parseInt(we.split(";")[0].split("=")[1].substring(0,1)),me=JSON.parse(we.split(";")[1].split("=")[1]);F[`${me}Page`]=se}),F.total=parseInt(te)),{data:Object.assign(Object.assign({},Q),F),error:null}}catch(F){if(Yr(F))return{data:{clients:[]},error:F};throw F}}async _createOAuthClient(t){try{return await xi(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Yr(a))return{data:null,error:a};throw a}}async _getOAuthClient(t){try{return await xi(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Yr(a))return{data:null,error:a};throw a}}async _updateOAuthClient(t,a){try{return await xi(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:a,headers:this.headers,xform:h=>({data:h,error:null})})}catch(h){if(Yr(h))return{data:null,error:h};throw h}}async _deleteOAuthClient(t){try{return await xi(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(Yr(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(t){try{return await xi(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(Yr(a))return{data:null,error:a};throw a}}}function fO(i={}){return{getItem:t=>i[t]||null,setItem:(t,a)=>{i[t]=a},removeItem:t=>{delete i[t]}}}const im={debug:!!(globalThis&&JF()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class eB extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class x9 extends eB{}async function w9(i,t,a){im.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,t);const h=new globalThis.AbortController;return t>0&&setTimeout(()=>{h.abort(),im.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:h.signal},async g=>{if(g){im.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,g.name);try{return await a()}finally{im.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,g.name)}}else{if(t===0)throw im.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new x9(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(im.debug)try{const v=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(v,null,"  "))}catch(v){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",v)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await a()}}))}function b9(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function tB(i){if(!/^0x[a-fA-F0-9]{40}$/.test(i))throw new Error(`@supabase/auth-js: Address "${i}" is invalid.`);return i.toLowerCase()}function T9(i){return parseInt(i,16)}function S9(i){const t=new TextEncoder().encode(i);return"0x"+Array.from(t,h=>h.toString(16).padStart(2,"0")).join("")}function E9(i){var t;const{chainId:a,domain:h,expirationTime:g,issuedAt:v=new Date,nonce:E,notBefore:o,requestId:O,resources:F,scheme:$,uri:Q,version:te}=i;{if(!Number.isInteger(a))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${a}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(E&&E.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${E}`);if(!Q)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(te!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${te}`);if(!((t=i.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${i.statement}`)}const J=tB(i.address),we=$?`${$}://${h}`:h,se=i.statement?`${i.statement}
`:"",me=`${we} wants you to sign in with your Ethereum account:
${J}

${se}`;let fe=`URI: ${Q}
Version: ${te}
Chain ID: ${a}${E?`
Nonce: ${E}`:""}
Issued At: ${v.toISOString()}`;if(g&&(fe+=`
Expiration Time: ${g.toISOString()}`),o&&(fe+=`
Not Before: ${o.toISOString()}`),O&&(fe+=`
Request ID: ${O}`),F){let re=`
Resources:`;for(const de of F){if(!de||typeof de!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${de}`);re+=`
- ${de}`}fe+=re}return`${me}
${fe}`}class Bs extends Error{constructor({message:t,code:a,cause:h,name:g}){var v;super(t,{cause:h}),this.__isWebAuthnError=!0,this.name=(v=g??(h instanceof Error?h.name:void 0))!==null&&v!==void 0?v:"Unknown Error",this.code=a}}class nw extends Bs{constructor(t,a){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a,message:t}),this.name="WebAuthnUnknownError",this.originalError=a}}function I9({error:i,options:t}){var a,h,g;const{publicKey:v}=t;if(!v)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Bs({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if(i.name==="ConstraintError"){if(((a=v.authenticatorSelection)===null||a===void 0?void 0:a.requireResidentKey)===!0)return new Bs({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});if(t.mediation==="conditional"&&((h=v.authenticatorSelection)===null||h===void 0?void 0:h.userVerification)==="required")return new Bs({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});if(((g=v.authenticatorSelection)===null||g===void 0?void 0:g.userVerification)==="required")return new Bs({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else{if(i.name==="InvalidStateError")return new Bs({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});if(i.name==="NotAllowedError")return new Bs({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="NotSupportedError")return v.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Bs({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}):new Bs({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});if(i.name==="SecurityError"){const E=window.location.hostname;if(rB(E)){if(v.rp.id!==E)return new Bs({message:`The RP ID "${v.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new Bs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="TypeError"){if(v.user.id.byteLength<1||v.user.id.byteLength>64)return new Bs({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if(i.name==="UnknownError")return new Bs({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new Bs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}function A9({error:i,options:t}){const{publicKey:a}=t;if(!a)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(t.signal instanceof AbortSignal)return new Bs({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else{if(i.name==="NotAllowedError")return new Bs({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="SecurityError"){const h=window.location.hostname;if(rB(h)){if(a.rpId!==h)return new Bs({message:`The RP ID "${a.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new Bs({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="UnknownError")return new Bs({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new Bs({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}class C9{createNewAbortSignal(){if(this.controller){const a=new Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const P9=new C9;function R9(i){if(!i)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(i);const{challenge:t,user:a,excludeCredentials:h}=i,g=sg(i,["challenge","user","excludeCredentials"]),v=Rm(t).buffer,E=Object.assign(Object.assign({},a),{id:Rm(a.id).buffer}),o=Object.assign(Object.assign({},g),{challenge:v,user:E});if(h&&h.length>0){o.excludeCredentials=new Array(h.length);for(let O=0;O<h.length;O++){const F=h[O];o.excludeCredentials[O]=Object.assign(Object.assign({},F),{id:Rm(F.id).buffer,type:F.type||"public-key",transports:F.transports})}}return o}function k9(i){if(!i)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(i);const{challenge:t,allowCredentials:a}=i,h=sg(i,["challenge","allowCredentials"]),g=Rm(t).buffer,v=Object.assign(Object.assign({},h),{challenge:g});if(a&&a.length>0){v.allowCredentials=new Array(a.length);for(let E=0;E<a.length;E++){const o=a[E];v.allowCredentials[E]=Object.assign(Object.assign({},o),{id:Rm(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return v}function M9(i){var t;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i;return{id:i.id,rawId:i.id,response:{attestationObject:af(new Uint8Array(i.response.attestationObject)),clientDataJSON:af(new Uint8Array(i.response.clientDataJSON))},type:"public-key",clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:(t=a.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function O9(i){var t;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const a=i,h=i.getClientExtensionResults(),g=i.response;return{id:i.id,rawId:i.id,response:{authenticatorData:af(new Uint8Array(g.authenticatorData)),clientDataJSON:af(new Uint8Array(g.clientDataJSON)),signature:af(new Uint8Array(g.signature)),userHandle:g.userHandle?af(new Uint8Array(g.userHandle)):void 0},type:"public-key",clientExtensionResults:h,authenticatorAttachment:(t=a.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function rB(i){return i==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(i)}function pO(){var i,t;return!!(Ro()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function D9(i){try{const t=await navigator.credentials.create(i);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new nw("Browser returned unexpected credential type",t)}:{data:null,error:new nw("Empty credential response",t)}}catch(t){return{data:null,error:I9({error:t,options:i})}}}async function L9(i){try{const t=await navigator.credentials.get(i);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new nw("Browser returned unexpected credential type",t)}:{data:null,error:new nw("Empty credential response",t)}}catch(t){return{data:null,error:A9({error:t,options:i})}}}const z9={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},F9={userVerification:"preferred",hints:["security-key"]};function sw(...i){const t=g=>g!==null&&typeof g=="object"&&!Array.isArray(g),a=g=>g instanceof ArrayBuffer||ArrayBuffer.isView(g),h={};for(const g of i)if(g)for(const v in g){const E=g[v];if(E!==void 0)if(Array.isArray(E))h[v]=E;else if(a(E))h[v]=E;else if(t(E)){const o=h[v];t(o)?h[v]=sw(o,E):h[v]=sw(E)}else h[v]=E}return h}function B9(i,t){return sw(z9,i,t||{})}function N9(i,t){return sw(F9,i,t||{})}class j9{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:a,friendlyName:h,signal:g},v){try{const{data:E,error:o}=await this.client.mfa.challenge({factorId:t,webauthn:a});if(!E)return{data:null,error:o};const O=g??P9.createNewAbortSignal();if(E.webauthn.type==="create"){const{user:F}=E.webauthn.credential_options.publicKey;F.name||(F.name=`${F.id}:${h}`),F.displayName||(F.displayName=F.name)}switch(E.webauthn.type){case"create":{const F=B9(E.webauthn.credential_options.publicKey,v==null?void 0:v.create),{data:$,error:Q}=await D9({publicKey:F,signal:O});return $?{data:{factorId:t,challengeId:E.id,webauthn:{type:E.webauthn.type,credential_response:$}},error:null}:{data:null,error:Q}}case"request":{const F=N9(E.webauthn.credential_options.publicKey,v==null?void 0:v.request),{data:$,error:Q}=await L9(Object.assign(Object.assign({},E.webauthn.credential_options),{publicKey:F,signal:O}));return $?{data:{factorId:t,challengeId:E.id,webauthn:{type:E.webauthn.type,credential_response:$}},error:null}:{data:null,error:Q}}}}catch(E){return Yr(E)?{data:null,error:E}:{data:null,error:new rf("Unexpected error in challenge",E)}}}async _verify({challengeId:t,factorId:a,webauthn:h}){return this.client.mfa.verify({factorId:a,challengeId:t,webauthn:h})}async _authenticate({factorId:t,webauthn:{rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:h=typeof window<"u"?[window.location.origin]:void 0,signal:g}},v){if(!a)return{data:null,error:new d0("rpId is required for WebAuthn authentication")};try{if(!pO())return{data:null,error:new rf("Browser does not support WebAuthn",null)};const{data:E,error:o}=await this.challenge({factorId:t,webauthn:{rpId:a,rpOrigins:h},signal:g},{request:v});if(!E)return{data:null,error:o};const{webauthn:O}=E;return this._verify({factorId:t,challengeId:E.challengeId,webauthn:{type:O.type,rpId:a,rpOrigins:h,credential_response:O.credential_response}})}catch(E){return Yr(E)?{data:null,error:E}:{data:null,error:new rf("Unexpected error in authenticate",E)}}}async _register({friendlyName:t,rpId:a=typeof window<"u"?window.location.hostname:void 0,rpOrigins:h=typeof window<"u"?[window.location.origin]:void 0,signal:g},v){if(!a)return{data:null,error:new d0("rpId is required for WebAuthn registration")};try{if(!pO())return{data:null,error:new rf("Browser does not support WebAuthn",null)};const{data:E,error:o}=await this._enroll({friendlyName:t});if(!E)return await this.client.mfa.listFactors().then($=>{var Q;return(Q=$.data)===null||Q===void 0?void 0:Q.all.find(te=>te.factor_type==="webauthn"&&te.friendly_name===t&&te.status!=="unverified")}).then($=>$?this.client.mfa.unenroll({factorId:$==null?void 0:$.id}):void 0),{data:null,error:o};const{data:O,error:F}=await this._challenge({factorId:E.id,friendlyName:E.friendly_name,webauthn:{rpId:a,rpOrigins:h},signal:g},{create:v});return O?this._verify({factorId:E.id,challengeId:O.challengeId,webauthn:{rpId:a,rpOrigins:h,type:O.webauthn.type,credential_response:O.webauthn.credential_response}}):{data:null,error:F}}catch(E){return Yr(E)?{data:null,error:E}:{data:null,error:new rf("Unexpected error in register",E)}}}}b9();const V9={url:FW,storageKey:BW,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:NW,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function mO(i,t,a){return await a()}const nm={};class f0{get jwks(){var t,a;return(a=(t=nm[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&a!==void 0?a:{keys:[]}}set jwks(t){nm[this.storageKey]=Object.assign(Object.assign({},nm[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,a;return(a=(t=nm[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&a!==void 0?a:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){nm[this.storageKey]=Object.assign(Object.assign({},nm[this.storageKey]),{cachedAt:t})}constructor(t){var a,h,g;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const v=Object.assign(Object.assign({},V9),t);if(this.storageKey=v.storageKey,this.instanceID=(a=f0.nextInstanceID[this.storageKey])!==null&&a!==void 0?a:0,f0.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!v.debug,typeof v.debug=="function"&&(this.logger=v.debug),this.instanceID>0&&Ro()){const E=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(E),this.logDebugMessages&&console.trace(E)}if(this.persistSession=v.persistSession,this.autoRefreshToken=v.autoRefreshToken,this.admin=new v9({url:v.url,headers:v.headers,fetch:v.fetch}),this.url=v.url,this.headers=v.headers,this.fetch=QF(v.fetch),this.lock=v.lock||mO,this.detectSessionInUrl=v.detectSessionInUrl,this.flowType=v.flowType,this.hasCustomAuthorizationHeader=v.hasCustomAuthorizationHeader,this.throwOnError=v.throwOnError,v.lock?this.lock=v.lock:Ro()&&(!((h=globalThis==null?void 0:globalThis.navigator)===null||h===void 0)&&h.locks)?this.lock=w9:this.lock=mO,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new j9(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(v.storage?this.storage=v.storage:JF()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=fO(this.memoryStorage)),v.userStorage&&(this.userStorage=v.userStorage)):(this.memoryStorage={},this.storage=fO(this.memoryStorage)),Ro()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(E){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",E)}(g=this.broadcastChannel)===null||g===void 0||g.addEventListener("message",async E=>{this._debug("received broadcast notification from other tab or client",E),await this._notifyAllSubscribers(E.data.event,E.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(t){if(this.throwOnError&&t&&t.error)throw t.error;return t}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${XF}) ${new Date().toISOString()}`}_debug(...t){return this.logDebugMessages&&this.logger(this._logPrefix(),...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{let a={},h="none";if(Ro()&&(a=QW(window.location.href),this._isImplicitGrantCallback(a)?h="implicit":await this._isPKCECallback(a)&&(h="pkce")),Ro()&&this.detectSessionInUrl&&h!=="none"){const{data:g,error:v}=await this._getSessionFromURL(a,h);if(v){if(this._debug("#_initialize()","error detecting session from URL",v),HW(v)){const O=(t=v.details)===null||t===void 0?void 0:t.code;if(O==="identity_already_exists"||O==="identity_not_found"||O==="single_identity_not_deletable")return{error:v}}return await this._removeSession(),{error:v}}const{session:E,redirectType:o}=g;return this._debug("#_initialize()","detected session in URL",E,"redirect type",o),await this._saveSession(E),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",E):await this._notifyAllSubscribers("SIGNED_IN",E)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(a){return Yr(a)?this._returnResult({error:a}):this._returnResult({error:new rf("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var a,h,g;try{const v=await xi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(h=(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.data)!==null&&h!==void 0?h:{},gotrue_meta_security:{captcha_token:(g=t==null?void 0:t.options)===null||g===void 0?void 0:g.captchaToken}},xform:Dl}),{data:E,error:o}=v;if(o||!E)return this._returnResult({data:{user:null,session:null},error:o});const O=E.session,F=E.user;return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(v){if(Yr(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signUp(t){var a,h,g;try{let v;if("email"in t){const{email:$,password:Q,options:te}=t;let J=null,we=null;this.flowType==="pkce"&&([J,we]=await tm(this.storage,this.storageKey)),v=await xi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:te==null?void 0:te.emailRedirectTo,body:{email:$,password:Q,data:(a=te==null?void 0:te.data)!==null&&a!==void 0?a:{},gotrue_meta_security:{captcha_token:te==null?void 0:te.captchaToken},code_challenge:J,code_challenge_method:we},xform:Dl})}else if("phone"in t){const{phone:$,password:Q,options:te}=t;v=await xi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:$,password:Q,data:(h=te==null?void 0:te.data)!==null&&h!==void 0?h:{},channel:(g=te==null?void 0:te.channel)!==null&&g!==void 0?g:"sms",gotrue_meta_security:{captcha_token:te==null?void 0:te.captchaToken}},xform:Dl})}else throw new Jx("You must provide either an email or phone number and a password");const{data:E,error:o}=v;if(o||!E)return this._returnResult({data:{user:null,session:null},error:o});const O=E.session,F=E.user;return E.session&&(await this._saveSession(E.session),await this._notifyAllSubscribers("SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(v){if(Yr(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signInWithPassword(t){try{let a;if("email"in t){const{email:v,password:E,options:o}=t;a=await xi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:v,password:E,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hO})}else if("phone"in t){const{phone:v,password:E,options:o}=t;a=await xi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:v,password:E,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:hO})}else throw new Jx("You must provide either an email or phone number and a password");const{data:h,error:g}=a;if(g)return this._returnResult({data:{user:null,session:null},error:g});if(!h||!h.session||!h.user){const v=new em;return this._returnResult({data:{user:null,session:null},error:v})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:Object.assign({user:h.user,session:h.session},h.weak_password?{weakPassword:h.weak_password}:null),error:g})}catch(a){if(Yr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(t){var a,h,g,v;return await this._handleProviderSignIn(t.provider,{redirectTo:(a=t.options)===null||a===void 0?void 0:a.redirectTo,scopes:(h=t.options)===null||h===void 0?void 0:h.scopes,queryParams:(g=t.options)===null||g===void 0?void 0:g.queryParams,skipBrowserRedirect:(v=t.options)===null||v===void 0?void 0:v.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:a}=t;switch(a){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${a}"`)}}async signInWithEthereum(t){var a,h,g,v,E,o,O,F,$,Q,te;let J,we;if("message"in t)J=t.message,we=t.signature;else{const{chain:se,wallet:me,statement:fe,options:re}=t;let de;if(Ro())if(typeof me=="object")de=me;else{const Bt=window;if("ethereum"in Bt&&typeof Bt.ethereum=="object"&&"request"in Bt.ethereum&&typeof Bt.ethereum.request=="function")de=Bt.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof me!="object"||!(re!=null&&re.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");de=me}const Oe=new URL((a=re==null?void 0:re.url)!==null&&a!==void 0?a:window.location.href),Xe=await de.request({method:"eth_requestAccounts"}).then(Bt=>Bt).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Xe||Xe.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const qe=tB(Xe[0]);let Be=(h=re==null?void 0:re.signInWithEthereum)===null||h===void 0?void 0:h.chainId;if(!Be){const Bt=await de.request({method:"eth_chainId"});Be=T9(Bt)}const bt={domain:Oe.host,address:qe,statement:fe,uri:Oe.href,version:"1",chainId:Be,nonce:(g=re==null?void 0:re.signInWithEthereum)===null||g===void 0?void 0:g.nonce,issuedAt:(E=(v=re==null?void 0:re.signInWithEthereum)===null||v===void 0?void 0:v.issuedAt)!==null&&E!==void 0?E:new Date,expirationTime:(o=re==null?void 0:re.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(O=re==null?void 0:re.signInWithEthereum)===null||O===void 0?void 0:O.notBefore,requestId:(F=re==null?void 0:re.signInWithEthereum)===null||F===void 0?void 0:F.requestId,resources:($=re==null?void 0:re.signInWithEthereum)===null||$===void 0?void 0:$.resources};J=E9(bt),we=await de.request({method:"personal_sign",params:[S9(J),qe]})}try{const{data:se,error:me}=await xi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:J,signature:we},!((Q=t.options)===null||Q===void 0)&&Q.captchaToken?{gotrue_meta_security:{captcha_token:(te=t.options)===null||te===void 0?void 0:te.captchaToken}}:null),xform:Dl});if(me)throw me;if(!se||!se.session||!se.user){const fe=new em;return this._returnResult({data:{user:null,session:null},error:fe})}return se.session&&(await this._saveSession(se.session),await this._notifyAllSubscribers("SIGNED_IN",se.session)),this._returnResult({data:Object.assign({},se),error:me})}catch(se){if(Yr(se))return this._returnResult({data:{user:null,session:null},error:se});throw se}}async signInWithSolana(t){var a,h,g,v,E,o,O,F,$,Q,te,J;let we,se;if("message"in t)we=t.message,se=t.signature;else{const{chain:me,wallet:fe,statement:re,options:de}=t;let Oe;if(Ro())if(typeof fe=="object")Oe=fe;else{const qe=window;if("solana"in qe&&typeof qe.solana=="object"&&("signIn"in qe.solana&&typeof qe.solana.signIn=="function"||"signMessage"in qe.solana&&typeof qe.solana.signMessage=="function"))Oe=qe.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof fe!="object"||!(de!=null&&de.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");Oe=fe}const Xe=new URL((a=de==null?void 0:de.url)!==null&&a!==void 0?a:window.location.href);if("signIn"in Oe&&Oe.signIn){const qe=await Oe.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},de==null?void 0:de.signInWithSolana),{version:"1",domain:Xe.host,uri:Xe.href}),re?{statement:re}:null));let Be;if(Array.isArray(qe)&&qe[0]&&typeof qe[0]=="object")Be=qe[0];else if(qe&&typeof qe=="object"&&"signedMessage"in qe&&"signature"in qe)Be=qe;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in Be&&"signature"in Be&&(typeof Be.signedMessage=="string"||Be.signedMessage instanceof Uint8Array)&&Be.signature instanceof Uint8Array)we=typeof Be.signedMessage=="string"?Be.signedMessage:new TextDecoder().decode(Be.signedMessage),se=Be.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in Oe)||typeof Oe.signMessage!="function"||!("publicKey"in Oe)||typeof Oe!="object"||!Oe.publicKey||!("toBase58"in Oe.publicKey)||typeof Oe.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");we=[`${Xe.host} wants you to sign in with your Solana account:`,Oe.publicKey.toBase58(),...re?["",re,""]:[""],"Version: 1",`URI: ${Xe.href}`,`Issued At: ${(g=(h=de==null?void 0:de.signInWithSolana)===null||h===void 0?void 0:h.issuedAt)!==null&&g!==void 0?g:new Date().toISOString()}`,...!((v=de==null?void 0:de.signInWithSolana)===null||v===void 0)&&v.notBefore?[`Not Before: ${de.signInWithSolana.notBefore}`]:[],...!((E=de==null?void 0:de.signInWithSolana)===null||E===void 0)&&E.expirationTime?[`Expiration Time: ${de.signInWithSolana.expirationTime}`]:[],...!((o=de==null?void 0:de.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${de.signInWithSolana.chainId}`]:[],...!((O=de==null?void 0:de.signInWithSolana)===null||O===void 0)&&O.nonce?[`Nonce: ${de.signInWithSolana.nonce}`]:[],...!((F=de==null?void 0:de.signInWithSolana)===null||F===void 0)&&F.requestId?[`Request ID: ${de.signInWithSolana.requestId}`]:[],...!((Q=($=de==null?void 0:de.signInWithSolana)===null||$===void 0?void 0:$.resources)===null||Q===void 0)&&Q.length?["Resources",...de.signInWithSolana.resources.map(Be=>`- ${Be}`)]:[]].join(`
`);const qe=await Oe.signMessage(new TextEncoder().encode(we),"utf8");if(!qe||!(qe instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");se=qe}}try{const{data:me,error:fe}=await xi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:we,signature:af(se)},!((te=t.options)===null||te===void 0)&&te.captchaToken?{gotrue_meta_security:{captcha_token:(J=t.options)===null||J===void 0?void 0:J.captchaToken}}:null),xform:Dl});if(fe)throw fe;if(!me||!me.session||!me.user){const re=new em;return this._returnResult({data:{user:null,session:null},error:re})}return me.session&&(await this._saveSession(me.session),await this._notifyAllSubscribers("SIGNED_IN",me.session)),this._returnResult({data:Object.assign({},me),error:fe})}catch(me){if(Yr(me))return this._returnResult({data:{user:null,session:null},error:me});throw me}}async _exchangeCodeForSession(t){const a=await Yd(this.storage,`${this.storageKey}-code-verifier`),[h,g]=(a??"").split("/");try{const{data:v,error:E}=await xi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:h},xform:Dl});if(await fh(this.storage,`${this.storageKey}-code-verifier`),E)throw E;if(!v||!v.session||!v.user){const o=new em;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign(Object.assign({},v),{redirectType:g??null}),error:E})}catch(v){if(Yr(v))return this._returnResult({data:{user:null,session:null,redirectType:null},error:v});throw v}}async signInWithIdToken(t){try{const{options:a,provider:h,token:g,access_token:v,nonce:E}=t,o=await xi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:h,id_token:g,access_token:v,nonce:E,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Dl}),{data:O,error:F}=o;if(F)return this._returnResult({data:{user:null,session:null},error:F});if(!O||!O.session||!O.user){const $=new em;return this._returnResult({data:{user:null,session:null},error:$})}return O.session&&(await this._saveSession(O.session),await this._notifyAllSubscribers("SIGNED_IN",O.session)),this._returnResult({data:O,error:F})}catch(a){if(Yr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(t){var a,h,g,v,E;try{if("email"in t){const{email:o,options:O}=t;let F=null,$=null;this.flowType==="pkce"&&([F,$]=await tm(this.storage,this.storageKey));const{error:Q}=await xi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(a=O==null?void 0:O.data)!==null&&a!==void 0?a:{},create_user:(h=O==null?void 0:O.shouldCreateUser)!==null&&h!==void 0?h:!0,gotrue_meta_security:{captcha_token:O==null?void 0:O.captchaToken},code_challenge:F,code_challenge_method:$},redirectTo:O==null?void 0:O.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:Q})}if("phone"in t){const{phone:o,options:O}=t,{data:F,error:$}=await xi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(g=O==null?void 0:O.data)!==null&&g!==void 0?g:{},create_user:(v=O==null?void 0:O.shouldCreateUser)!==null&&v!==void 0?v:!0,gotrue_meta_security:{captcha_token:O==null?void 0:O.captchaToken},channel:(E=O==null?void 0:O.channel)!==null&&E!==void 0?E:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:F==null?void 0:F.message_id},error:$})}throw new Jx("You must provide either an email or phone number.")}catch(o){if(Yr(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(t){var a,h;try{let g,v;"options"in t&&(g=(a=t.options)===null||a===void 0?void 0:a.redirectTo,v=(h=t.options)===null||h===void 0?void 0:h.captchaToken);const{data:E,error:o}=await xi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:v}}),redirectTo:g,xform:Dl});if(o)throw o;if(!E)throw new Error("An error occurred on token verification.");const O=E.session,F=E.user;return O!=null&&O.access_token&&(await this._saveSession(O),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",O)),this._returnResult({data:{user:F,session:O},error:null})}catch(g){if(Yr(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSSO(t){var a,h,g;try{let v=null,E=null;this.flowType==="pkce"&&([v,E]=await tm(this.storage,this.storageKey));const o=await xi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(h=(a=t.options)===null||a===void 0?void 0:a.redirectTo)!==null&&h!==void 0?h:void 0}),!((g=t==null?void 0:t.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:v,code_challenge_method:E}),headers:this.headers,xform:g9});return this._returnResult(o)}catch(v){if(Yr(v))return this._returnResult({data:null,error:v});throw v}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:a},error:h}=t;if(h)throw h;if(!a)throw new Ol;const{error:g}=await xi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:a.access_token});return this._returnResult({data:{user:null,session:null},error:g})})}catch(t){if(Yr(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async resend(t){try{const a=`${this.url}/resend`;if("email"in t){const{email:h,type:g,options:v}=t,{error:E}=await xi(this.fetch,"POST",a,{headers:this.headers,body:{email:h,type:g,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}},redirectTo:v==null?void 0:v.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:E})}else if("phone"in t){const{phone:h,type:g,options:v}=t,{data:E,error:o}=await xi(this.fetch,"POST",a,{headers:this.headers,body:{phone:h,type:g,gotrue_meta_security:{captcha_token:v==null?void 0:v.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:E==null?void 0:E.message_id},error:o})}throw new Jx("You must provide either an email or phone number and a type")}catch(a){if(Yr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(t,a){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const h=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),g=(async()=>(await h,await a()))();return this.pendingInLock.push((async()=>{try{await g}catch{}})()),g}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const h=a();for(this.pendingInLock.push((async()=>{try{await h}catch{}})()),await h;this.pendingInLock.length;){const g=[...this.pendingInLock];await Promise.all(g),this.pendingInLock.splice(0,g.length)}return await h}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const a=await this.__loadSession();return await t(a)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const a=await Yd(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",a),a!==null&&(this._isValidSession(a)?t=a:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const h=t.expires_at?t.expires_at*1e3-Date.now()<FS:!1;if(this._debug("#__loadSession()",`session has${h?"":" not"} expired`,"expires_at",t.expires_at),!h){if(this.userStorage){const E=await Yd(this.userStorage,this.storageKey+"-user");E!=null&&E.user?t.user=E.user:t.user=jS()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const E={value:this.suppressGetSessionWarning};t.user=d9(t.user,E),E.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:g,error:v}=await this._callRefreshToken(t.refresh_token);return v?this._returnResult({data:{session:null},error:v}):this._returnResult({data:{session:g},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await xi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:xh}):await this._useSession(async a=>{var h,g,v;const{data:E,error:o}=a;if(o)throw o;return!(!((h=E.session)===null||h===void 0)&&h.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ol}:await xi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(v=(g=E.session)===null||g===void 0?void 0:g.access_token)!==null&&v!==void 0?v:void 0,xform:xh})})}catch(a){if(Yr(a))return GW(a)&&(await this._removeSession(),await fh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(t,a={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,a))}async _updateUser(t,a={}){try{return await this._useSession(async h=>{const{data:g,error:v}=h;if(v)throw v;if(!g.session)throw new Ol;const E=g.session;let o=null,O=null;this.flowType==="pkce"&&t.email!=null&&([o,O]=await tm(this.storage,this.storageKey));const{data:F,error:$}=await xi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:a==null?void 0:a.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:O}),jwt:E.access_token,xform:xh});if($)throw $;return E.user=F.user,await this._saveSession(E),await this._notifyAllSubscribers("USER_UPDATED",E),this._returnResult({data:{user:E.user},error:null})})}catch(h){if(Yr(h))return this._returnResult({data:{user:null},error:h});throw h}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ol;const a=Date.now()/1e3;let h=a,g=!0,v=null;const{payload:E}=NS(t.access_token);if(E.exp&&(h=E.exp,g=h<=a),g){const{data:o,error:O}=await this._callRefreshToken(t.refresh_token);if(O)return this._returnResult({data:{user:null,session:null},error:O});if(!o)return{data:{user:null,session:null},error:null};v=o}else{const{data:o,error:O}=await this._getUser(t.access_token);if(O)throw O;v={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:h-a,expires_at:h},await this._saveSession(v),await this._notifyAllSubscribers("SIGNED_IN",v)}return this._returnResult({data:{user:v.user,session:v},error:null})}catch(a){if(Yr(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async a=>{var h;if(!t){const{data:E,error:o}=a;if(o)throw o;t=(h=E.session)!==null&&h!==void 0?h:void 0}if(!(t!=null&&t.refresh_token))throw new Ol;const{data:g,error:v}=await this._callRefreshToken(t.refresh_token);return v?this._returnResult({data:{user:null,session:null},error:v}):g?this._returnResult({data:{user:g.user,session:g},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(Yr(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(t,a){try{if(!Ro())throw new Qx("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Qx(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(a){case"implicit":if(this.flowType==="pkce")throw new nO("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Qx("Not a valid implicit grant flow url.");break;default:}if(a==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new nO("No code detected.");const{data:re,error:de}=await this._exchangeCodeForSession(t.code);if(de)throw de;const Oe=new URL(window.location.href);return Oe.searchParams.delete("code"),window.history.replaceState(window.history.state,"",Oe.toString()),{data:{session:re.session,redirectType:null},error:null}}const{provider_token:h,provider_refresh_token:g,access_token:v,refresh_token:E,expires_in:o,expires_at:O,token_type:F}=t;if(!v||!o||!E||!F)throw new Qx("No session defined in URL");const $=Math.round(Date.now()/1e3),Q=parseInt(o);let te=$+Q;O&&(te=parseInt(O));const J=te-$;J*1e3<=om&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${J}s, should have been closer to ${Q}s`);const we=te-Q;$-we>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",we,te,$):$-we<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",we,te,$);const{data:se,error:me}=await this._getUser(v);if(me)throw me;const fe={provider_token:h,provider_refresh_token:g,access_token:v,expires_in:Q,expires_at:te,refresh_token:E,token_type:F,user:se.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:fe,redirectType:t.type},error:null})}catch(h){if(Yr(h))return this._returnResult({data:{session:null,redirectType:null},error:h});throw h}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const a=await Yd(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&a)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async a=>{var h;const{data:g,error:v}=a;if(v)return this._returnResult({error:v});const E=(h=g.session)===null||h===void 0?void 0:h.access_token;if(E){const{error:o}=await this.admin.signOut(E,t);if(o&&!($W(o)&&(o.status===404||o.status===401||o.status===403)))return this._returnResult({error:o})}return t!=="others"&&(await this._removeSession(),await fh(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(t){const a=JW(),h={id:a,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",a),this.stateChangeEmitters.delete(a)}};return this._debug("#onAuthStateChange()","registered callback with id",a),this.stateChangeEmitters.set(a,h),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(a)})))(),{data:{subscription:h}}}async _emitInitialSession(t){return await this._useSession(async a=>{var h,g;try{const{data:{session:v},error:E}=a;if(E)throw E;await((h=this.stateChangeEmitters.get(t))===null||h===void 0?void 0:h.callback("INITIAL_SESSION",v)),this._debug("INITIAL_SESSION","callback id",t,"session",v)}catch(v){await((g=this.stateChangeEmitters.get(t))===null||g===void 0?void 0:g.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",v),console.error(v)}})}async resetPasswordForEmail(t,a={}){let h=null,g=null;this.flowType==="pkce"&&([h,g]=await tm(this.storage,this.storageKey,!0));try{return await xi(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:h,code_challenge_method:g,gotrue_meta_security:{captcha_token:a.captchaToken}},headers:this.headers,redirectTo:a.redirectTo})}catch(v){if(Yr(v))return this._returnResult({data:null,error:v});throw v}}async getUserIdentities(){var t;try{const{data:a,error:h}=await this.getUser();if(h)throw h;return this._returnResult({data:{identities:(t=a.user.identities)!==null&&t!==void 0?t:[]},error:null})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var a;try{const{data:h,error:g}=await this._useSession(async v=>{var E,o,O,F,$;const{data:Q,error:te}=v;if(te)throw te;const J=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(E=t.options)===null||E===void 0?void 0:E.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(O=t.options)===null||O===void 0?void 0:O.queryParams,skipBrowserRedirect:!0});return await xi(this.fetch,"GET",J,{headers:this.headers,jwt:($=(F=Q.session)===null||F===void 0?void 0:F.access_token)!==null&&$!==void 0?$:void 0})});if(g)throw g;return Ro()&&!(!((a=t.options)===null||a===void 0)&&a.skipBrowserRedirect)&&window.location.assign(h==null?void 0:h.url),this._returnResult({data:{provider:t.provider,url:h==null?void 0:h.url},error:null})}catch(h){if(Yr(h))return this._returnResult({data:{provider:t.provider,url:null},error:h});throw h}}async linkIdentityIdToken(t){return await this._useSession(async a=>{var h;try{const{error:g,data:{session:v}}=a;if(g)throw g;const{options:E,provider:o,token:O,access_token:F,nonce:$}=t,Q=await xi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(h=v==null?void 0:v.access_token)!==null&&h!==void 0?h:void 0,body:{provider:o,id_token:O,access_token:F,nonce:$,link_identity:!0,gotrue_meta_security:{captcha_token:E==null?void 0:E.captchaToken}},xform:Dl}),{data:te,error:J}=Q;return J?this._returnResult({data:{user:null,session:null},error:J}):!te||!te.session||!te.user?this._returnResult({data:{user:null,session:null},error:new em}):(te.session&&(await this._saveSession(te.session),await this._notifyAllSubscribers("USER_UPDATED",te.session)),this._returnResult({data:te,error:J}))}catch(g){if(Yr(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}})}async unlinkIdentity(t){try{return await this._useSession(async a=>{var h,g;const{data:v,error:E}=a;if(E)throw E;return await xi(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(g=(h=v.session)===null||h===void 0?void 0:h.access_token)!==null&&g!==void 0?g:void 0})})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(t){const a=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{const h=Date.now();return await r9(async g=>(g>0&&await t9(200*Math.pow(2,g-1)),this._debug(a,"refreshing attempt",g),await xi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:Dl})),(g,v)=>{const E=200*Math.pow(2,g);return v&&BS(v)&&Date.now()+E-h<om})}catch(h){if(this._debug(a,"error",h),Yr(h))return this._returnResult({data:{session:null,user:null},error:h});throw h}finally{this._debug(a,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,a){const h=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:a.redirectTo,scopes:a.scopes,queryParams:a.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",a,"url",h),Ro()&&!a.skipBrowserRedirect&&window.location.assign(h),{data:{provider:t,url:h},error:null}}async _recoverAndRefresh(){var t,a;const h="#_recoverAndRefresh()";this._debug(h,"begin");try{const g=await Yd(this.storage,this.storageKey);if(g&&this.userStorage){let E=await Yd(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!E&&(E={user:g.user},await am(this.userStorage,this.storageKey+"-user",E)),g.user=(t=E==null?void 0:E.user)!==null&&t!==void 0?t:jS()}else if(g&&!g.user&&!g.user){const E=await Yd(this.storage,this.storageKey+"-user");E&&(E!=null&&E.user)?(g.user=E.user,await fh(this.storage,this.storageKey+"-user"),await am(this.storage,this.storageKey,g)):g.user=jS()}if(this._debug(h,"session from storage",g),!this._isValidSession(g)){this._debug(h,"session is not valid"),g!==null&&await this._removeSession();return}const v=((a=g.expires_at)!==null&&a!==void 0?a:1/0)*1e3-Date.now()<FS;if(this._debug(h,`session has${v?"":" not"} expired with margin of ${FS}s`),v){if(this.autoRefreshToken&&g.refresh_token){const{error:E}=await this._callRefreshToken(g.refresh_token);E&&(console.error(E),BS(E)||(this._debug(h,"refresh failed with a non-retryable error, removing the session",E),await this._removeSession()))}}else if(g.user&&g.user.__isUserNotAvailableProxy===!0)try{const{data:E,error:o}=await this._getUser(g.access_token);!o&&(E!=null&&E.user)?(g.user=E.user,await this._saveSession(g),await this._notifyAllSubscribers("SIGNED_IN",g)):this._debug(h,"could not get user data, skipping SIGNED_IN notification")}catch(E){console.error("Error getting user data:",E),this._debug(h,"error getting user data, skipping SIGNED_IN notification",E)}else await this._notifyAllSubscribers("SIGNED_IN",g)}catch(g){this._debug(h,"error",g),console.error(g);return}finally{this._debug(h,"end")}}async _callRefreshToken(t){var a,h;if(!t)throw new Ol;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const g=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(g,"begin");try{this.refreshingDeferred=new qw;const{data:v,error:E}=await this._refreshAccessToken(t);if(E)throw E;if(!v.session)throw new Ol;await this._saveSession(v.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",v.session);const o={data:v.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(v){if(this._debug(g,"error",v),Yr(v)){const E={data:null,error:v};return BS(v)||await this._removeSession(),(a=this.refreshingDeferred)===null||a===void 0||a.resolve(E),E}throw(h=this.refreshingDeferred)===null||h===void 0||h.reject(v),v}finally{this.refreshingDeferred=null,this._debug(g,"end")}}async _notifyAllSubscribers(t,a,h=!0){const g=`#_notifyAllSubscribers(${t})`;this._debug(g,"begin",a,`broadcast = ${h}`);try{this.broadcastChannel&&h&&this.broadcastChannel.postMessage({event:t,session:a});const v=[],E=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,a)}catch(O){v.push(O)}});if(await Promise.all(E),v.length>0){for(let o=0;o<v.length;o+=1)console.error(v[o]);throw v[0]}}finally{this._debug(g,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const a=Object.assign({},t),h=a.user&&a.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!h&&a.user&&await am(this.userStorage,this.storageKey+"-user",{user:a.user});const g=Object.assign({},a);delete g.user;const v=cO(g);await am(this.storage,this.storageKey,v)}else{const g=cO(a);await am(this.storage,this.storageKey,g)}}async _removeSession(){this._debug("#_removeSession()"),await fh(this.storage,this.storageKey),await fh(this.storage,this.storageKey+"-code-verifier"),await fh(this.storage,this.storageKey+"-user"),this.userStorage&&await fh(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Ro()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(a){console.error("removing visibilitychange callback failed",a)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),om);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async a=>{const{data:{session:h}}=a;if(!h||!h.refresh_token||!h.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const g=Math.floor((h.expires_at*1e3-t)/om);this._debug("#_autoRefreshTokenTick()",`access token expires in ${g} ticks, a tick lasts ${om}ms, refresh threshold is ${c2} ticks`),g<=c2&&await this._callRefreshToken(h.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof eB)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ro()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const a=`#_onVisibilityChanged(${t})`;this._debug(a,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(a,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,a,h){const g=[`provider=${encodeURIComponent(a)}`];if(h!=null&&h.redirectTo&&g.push(`redirect_to=${encodeURIComponent(h.redirectTo)}`),h!=null&&h.scopes&&g.push(`scopes=${encodeURIComponent(h.scopes)}`),this.flowType==="pkce"){const[v,E]=await tm(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(v)}`,code_challenge_method:`${encodeURIComponent(E)}`});g.push(o.toString())}if(h!=null&&h.queryParams){const v=new URLSearchParams(h.queryParams);g.push(v.toString())}return h!=null&&h.skipBrowserRedirect&&g.push(`skip_http_redirect=${h.skipBrowserRedirect}`),`${t}?${g.join("&")}`}async _unenroll(t){try{return await this._useSession(async a=>{var h;const{data:g,error:v}=a;return v?this._returnResult({data:null,error:v}):await xi(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(h=g==null?void 0:g.session)===null||h===void 0?void 0:h.access_token})})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(t){try{return await this._useSession(async a=>{var h,g;const{data:v,error:E}=a;if(E)return this._returnResult({data:null,error:E});const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:O,error:F}=await xi(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(h=v==null?void 0:v.session)===null||h===void 0?void 0:h.access_token});return F?this._returnResult({data:null,error:F}):(t.factorType==="totp"&&O.type==="totp"&&(!((g=O==null?void 0:O.totp)===null||g===void 0)&&g.qr_code)&&(O.totp.qr_code=`data:image/svg+xml;utf-8,${O.totp.qr_code}`),this._returnResult({data:O,error:null}))})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var h;const{data:g,error:v}=a;if(v)return this._returnResult({data:null,error:v});const E=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?M9(t.webauthn.credential_response):O9(t.webauthn.credential_response)})}:{code:t.code}),{data:o,error:O}=await xi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:E,headers:this.headers,jwt:(h=g==null?void 0:g.session)===null||h===void 0?void 0:h.access_token});return O?this._returnResult({data:null,error:O}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:O}))})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async a=>{var h;const{data:g,error:v}=a;if(v)return this._returnResult({data:null,error:v});const E=await xi(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(h=g==null?void 0:g.session)===null||h===void 0?void 0:h.access_token});if(E.error)return E;const{data:o}=E;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:R9(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:k9(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(t){const{data:a,error:h}=await this._challenge({factorId:t.factorId});return h?this._returnResult({data:null,error:h}):await this._verify({factorId:t.factorId,challengeId:a.id,code:t.code})}async _listFactors(){var t;const{data:{user:a},error:h}=await this.getUser();if(h)return{data:null,error:h};const g={all:[],phone:[],totp:[],webauthn:[]};for(const v of(t=a==null?void 0:a.factors)!==null&&t!==void 0?t:[])g.all.push(v),v.status==="verified"&&g[v.factor_type].push(v);return{data:g,error:null}}async _getAuthenticatorAssuranceLevel(){var t,a;const{data:{session:h},error:g}=await this.getSession();if(g)return this._returnResult({data:null,error:g});if(!h)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:v}=NS(h.access_token);let E=null;v.aal&&(E=v.aal);let o=E;((a=(t=h.user.factors)===null||t===void 0?void 0:t.filter($=>$.status==="verified"))!==null&&a!==void 0?a:[]).length>0&&(o="aal2");const F=v.amr||[];return{data:{currentLevel:E,nextLevel:o,currentAuthenticationMethods:F},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async a=>{const{data:{session:h},error:g}=a;return g?this._returnResult({data:null,error:g}):h?await xi(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:h.access_token,xform:v=>({data:v,error:null})}):this._returnResult({data:null,error:new Ol})})}catch(a){if(Yr(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(t,a){try{return await this._useSession(async h=>{const{data:{session:g},error:v}=h;if(v)return this._returnResult({data:null,error:v});if(!g)return this._returnResult({data:null,error:new Ol});const E=await xi(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:g.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return E.data&&E.data.redirect_url&&Ro()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(E.data.redirect_url),E})}catch(h){if(Yr(h))return this._returnResult({data:null,error:h});throw h}}async _denyAuthorization(t,a){try{return await this._useSession(async h=>{const{data:{session:g},error:v}=h;if(v)return this._returnResult({data:null,error:v});if(!g)return this._returnResult({data:null,error:new Ol});const E=await xi(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:g.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return E.data&&E.data.redirect_url&&Ro()&&!(a!=null&&a.skipBrowserRedirect)&&window.location.assign(E.data.redirect_url),E})}catch(h){if(Yr(h))return this._returnResult({data:null,error:h});throw h}}async fetchJwk(t,a={keys:[]}){let h=a.keys.find(o=>o.kid===t);if(h)return h;const g=Date.now();if(h=this.jwks.keys.find(o=>o.kid===t),h&&this.jwks_cached_at+VW>g)return h;const{data:v,error:E}=await xi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(E)throw E;return!v.keys||v.keys.length===0||(this.jwks=v,this.jwks_cached_at=g,h=v.keys.find(o=>o.kid===t),!h)?null:h}async getClaims(t,a={}){try{let h=t;if(!h){const{data:J,error:we}=await this.getSession();if(we||!J.session)return this._returnResult({data:null,error:we});h=J.session.access_token}const{header:g,payload:v,signature:E,raw:{header:o,payload:O}}=NS(h);a!=null&&a.allowExpired||c9(v.exp);const F=!g.alg||g.alg.startsWith("HS")||!g.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(g.kid,a!=null&&a.keys?{keys:a.keys}:a==null?void 0:a.jwks);if(!F){const{error:J}=await this.getUser(h);if(J)throw J;return{data:{claims:v,header:g,signature:E},error:null}}const $=u9(g.alg),Q=await crypto.subtle.importKey("jwk",F,$,!0,["verify"]);if(!await crypto.subtle.verify($,Q,E,KW(`${o}.${O}`)))throw new d2("Invalid JWT signature");return{data:{claims:v,header:g,signature:E},error:null}}catch(h){if(Yr(h))return this._returnResult({data:null,error:h});throw h}}}f0.nextInstanceID={};const U9=f0;class $9 extends U9{constructor(t){super(t)}}class G9{constructor(t,a,h){var g,v,E;this.supabaseUrl=t,this.supabaseKey=a;const o=zW(t);if(!a)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const O=`sb-${o.hostname.split(".")[0]}-auth-token`,F={db:CW,realtime:RW,auth:Object.assign(Object.assign({},PW),{storageKey:O}),global:AW},$=LW(h??{},F);this.storageKey=(g=$.auth.storageKey)!==null&&g!==void 0?g:"",this.headers=(v=$.global.headers)!==null&&v!==void 0?v:{},$.accessToken?(this.accessToken=$.accessToken,this.auth=new Proxy({},{get:(Q,te)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(te)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((E=$.auth)!==null&&E!==void 0?E:{},this.headers,$.global.fetch),this.fetch=OW(a,this._getAccessToken.bind(this),$.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},$.realtime)),this.rest=new Fq(new URL("rest/v1",o).href,{headers:this.headers,schema:$.db.schema,fetch:this.fetch}),this.storage=new SW(this.storageUrl.href,this.headers,this.fetch,h==null?void 0:h.storage),$.accessToken||this._listenForAuthEvents()}get functions(){return new Dq(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,a={},h={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,a,h)}channel(t,a={config:{}}){return this.realtime.channel(t,a)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,a;if(this.accessToken)return await this.accessToken();const{data:h}=await this.auth.getSession();return(a=(t=h.session)===null||t===void 0?void 0:t.access_token)!==null&&a!==void 0?a:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:a,detectSessionInUrl:h,storage:g,userStorage:v,storageKey:E,flowType:o,lock:O,debug:F,throwOnError:$},Q,te){const J={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new $9({url:this.authUrl.href,headers:Object.assign(Object.assign({},J),Q),storageKey:E,autoRefreshToken:t,persistSession:a,detectSessionInUrl:h,storage:g,userStorage:v,flowType:o,lock:O,debug:F,throwOnError:$,fetch:te,hasCustomAuthorizationHeader:Object.keys(this.headers).some(we=>we.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new eW(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,h)=>{this._handleTokenChanged(a,"CLIENT",h==null?void 0:h.access_token)})}_handleTokenChanged(t,a,h){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==h?(this.changedAccessToken=h,this.realtime.setAuth(h)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),a=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const H9=(i,t,a)=>new G9(i,t,a);function q9(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const t=i.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}q9()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const W9="https://ovgutswnhlteysfcbigx.supabase.co",Z9="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92Z3V0c3duaGx0ZXlzZmNiaWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODk1MzcsImV4cCI6MjA3ODU2NTUzN30.4hdFVcv3HOdibT1fttjghFyMPPzjkRwBTqjJnUyRGpw",X9=H9(W9,Z9,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}});function K9(){const i=[];for(let a=-90;a<=90;a+=3)for(let h=-180;h<180;h+=3)i.push({lat:a,lng:h});return i}const Y9=[{level:"low",color:"#00ff00",label:"Low Risk",range:"0-25"},{level:"moderate",color:"#ffff00",label:"Moderate Risk",range:"26-50"},{level:"high",color:"#ff9500",label:"High Risk",range:"51-75"},{level:"extreme",color:"#ff0000",label:"Extreme Risk",range:"76-100"}],J9=()=>{const i=[];for(let a=-90;a<=90;a+=3)for(let h=-180;h<180;h+=3){let g=293,v=50,E=8;const o=Math.abs(a);if(o>66){const Be=(o-66)/24;g=283-Be*10,v=65+Be*10,E=6+Be*4}else if(o>40){const Be=(o-40)/26;g=293-Be*10,v=50+Be*15,E=8+Be*2}else if(o>23){const Be=(o-23)/17;g=298-Be*5,v=45+Be*5,E=9+Be*1}else{const Be=o/23;g=303-Be*5,v=40+Be*5,E=8+Be*1}let O=0,F=0,$=0;if(a>30&&a<50&&h>-125&&h<-100){const Be=gc(a,h,40,-112.5,10,12.5);O+=Be*15,F-=Be*20,$+=Be*7}if(a>30&&a<45&&h>-10&&h<45){const Be=gc(a,h,37.5,17.5,7.5,27.5);O+=Be*18,F-=Be*23,$+=Be*5}if(a>15&&a<35&&h>-15&&h<60){const Be=gc(a,h,25,22.5,10,37.5);O+=Be*23,F-=Be*25,$+=Be*4}if(a>-35&&a<-20&&h>110&&h<155){const Be=gc(a,h,-27.5,132.5,7.5,22.5);O+=Be*20,F-=Be*22,$+=Be*6}if(a>-40&&a<-25&&h>140&&h<155){const Be=gc(a,h,-32.5,147.5,7.5,7.5);O+=Be*17,F-=Be*18,$+=Be*8}if(a>-25&&a<-5&&h>-60&&h<-40){const Be=gc(a,h,-15,-50,10,10);O+=Be*14,F-=Be*15,$+=Be*4}if(a>10&&a<25&&h>95&&h<110){const Be=gc(a,h,17.5,102.5,7.5,7.5);O+=Be*16,F-=Be*18,$+=Be*3}if(a>-30&&a<-20&&h>20&&h<35){const Be=gc(a,h,-25,27.5,5,7.5);O+=Be*13,F-=Be*16,$+=Be*5}if(a>35&&a<45&&h>-105&&h<-90){const Be=gc(a,h,40,-97.5,5,7.5);O+=Be*10,F-=Be*14,$+=Be*7}if(a>36&&a<43&&h>-10&&h<3){const Be=gc(a,h,39.5,-3.5,3.5,6.5);O+=Be*17,F-=Be*20,$+=Be*4}g+=O,v=Math.max(15,Math.min(95,v+F)),E+=$;const Q=g+(Math.random()*6-3),te=Math.max(15,Math.min(95,v+(Math.random()*10-5))),J=Math.max(2,E+(Math.random()*4-2)),we=1013+(Math.random()*15-7.5),me=(Q-273.15)*9/5+32,fe=te/100*10,re=(1-2*(fe/30)+1.5*Math.pow(fe/30,2)-.5*Math.pow(fe/30,3))*100,de=Math.sqrt(1+Math.pow(J,2)),Oe=re*de*(1+Math.pow(me,2)/1e3)/100,Xe=Math.min(100,Math.max(0,Math.round(Oe)));let qe="low";Xe>75?qe="extreme":Xe>50?qe="high":Xe>25&&(qe="moderate"),i.push({lat:a,lng:h,temperature:Q,humidity:te,windSpeed:J,pressure:we,riskScore:Xe,riskLevel:qe})}return i};function gc(i,t,a,h,g,v){const E=Math.abs(i-a)/g,o=Math.abs(t-h)/v,O=Math.sqrt(E*E+o*o);return O>=1?0:(Math.cos(O*Math.PI)+1)/2}let e1=null;const Q9=()=>(e1||(e1=J9(),console.log(`Generated ${e1.length} weather data points for offline use`)),e1),e7=()=>{const i=ke.useRef(null),t=ke.useRef(null),[a,h]=ke.useState(()=>localStorage.getItem("mapboxToken")||"pk.eyJ1IjoiMWwiLCJhIjoiY21oc2Rnczd6MGMwMDJzb2piYXR4cGc4dCJ9.XV55_9Vl5iZsXmqcstxG2Q"),[g,v]=ke.useState(""),[E,o]=ke.useState(!0),[O,F]=ke.useState(!1),[$,Q]=ke.useState([]),[te,J]=ke.useState(!1),[we,se]=ke.useState(null),[me,fe]=ke.useState(null),re=async()=>{J(!0),fe(null);try{const qe=K9();console.log(`Fetching weather data for ${qe.length} points...`);const Be=[],bt=25;for(let Bt=0;Bt<qe.length;Bt+=bt){const nr=qe.slice(Bt,Bt+bt).map(async Mt=>{try{const{data:Zt,error:mr}=await X9.functions.invoke("get-weather-risk",{body:{lat:Mt.lat,lng:Mt.lng}});if(mr)throw mr;return{...Zt,lat:Mt.lat,lng:Mt.lng}}catch(Zt){return console.error(`Error fetching data for ${Mt.lat}, ${Mt.lng}:`,Zt),null}}),Gt=await Promise.all(nr);Be.push(...Gt.filter(Mt=>Mt!==null)),Bt+bt<qe.length&&await new Promise(Mt=>setTimeout(Mt,2e3))}Q(Be),se(new Date),localStorage.setItem("weatherRiskData",JSON.stringify({data:Be,timestamp:Date.now(),version:"2.1"}))}catch(qe){console.error("Error fetching weather risk data:",qe),fe("Failed to fetch weather data. Please try again.")}finally{J(!1)}},de=()=>{const qe=localStorage.getItem("weatherRiskData");if(qe)try{const Be=JSON.parse(qe),{data:bt,timestamp:Bt,version:Jt}=Be,nr=Date.now()-Bt;if(Jt==="2.1"&&nr<30*60*1e3)return Q(bt),se(new Date(Bt)),!0}catch{localStorage.removeItem("weatherRiskData")}return!1},Oe=()=>{g.trim()&&(localStorage.setItem("mapboxToken",g.trim()),h(g.trim()),F(!1))},Xe=()=>{localStorage.removeItem("mapboxToken"),h(""),F(!0),v("")};return ke.useEffect(()=>{if(E&&$.length===0){const qe=Q9();Q(qe),se(new Date),console.log(`Loaded ${qe.length} weather data points for offline map display`)}},[E]),ke.useEffect(()=>{if(i.current){if(!E&&!a){F(!0);return}return!E&&a&&(de()||re()),Gx.accessToken=a,t.current=new Gx.Map({container:i.current,style:"mapbox://styles/mapbox/streets-v12",center:[0,20],zoom:2}),t.current.on("style.load",()=>{if(!t.current)return;(t.current.getStyle().layers||[]).forEach(Be=>{var Bt,Jt,nr,Gt,Mt,Zt,mr,Qt,er,dt;const bt=Be.id;if(Be.type==="background"&&((Bt=t.current)==null||Bt.setPaintProperty(bt,"background-color","#ffffff")),Be.type==="fill"&&(bt.includes("land")||bt.includes("background"))&&((Jt=t.current)==null||Jt.setPaintProperty(bt,"fill-color","#ffffff")),Be.type==="line"&&((nr=t.current)==null||nr.setPaintProperty(bt,"line-opacity",.8),bt.includes("admin")||bt.includes("boundary")))try{(Gt=t.current)==null||Gt.setPaintProperty(bt,"line-color","#cccccc");const It=((Mt=t.current)==null?void 0:Mt.getPaintProperty(bt,"line-width"))||1;(Zt=t.current)==null||Zt.setPaintProperty(bt,"line-width",typeof It=="number"?It*1.2:It)}catch{}if(Be.type==="symbol"){(mr=t.current)==null||mr.setPaintProperty(bt,"text-opacity",.7);try{(Qt=t.current)==null||Qt.setPaintProperty(bt,"text-halo-width",2),(er=t.current)==null||er.setPaintProperty(bt,"text-halo-color","#ffffff"),(dt=t.current)==null||dt.setPaintProperty(bt,"text-color","#333333")}catch{}}})}),t.current.addControl(new Gx.NavigationControl,"top-right"),()=>{var qe;(qe=t.current)==null||qe.remove()}}},[a,E]),ke.useEffect(()=>{if(!t.current||$.length===0)return;const qe=()=>{if(!t.current)return;const bt=3/2,Jt={type:"FeatureCollection",features:$.map(nr=>({type:"Feature",geometry:{type:"Polygon",coordinates:[[[nr.lng-bt,nr.lat-bt],[nr.lng+bt,nr.lat-bt],[nr.lng+bt,nr.lat+bt],[nr.lng-bt,nr.lat+bt],[nr.lng-bt,nr.lat-bt]]]},properties:{riskScore:nr.riskScore,riskLevel:nr.riskLevel,temperature:nr.temperature,humidity:nr.humidity,windSpeed:nr.windSpeed,pressure:nr.pressure}}))};t.current.getSource("weather-risk")?t.current.getSource("weather-risk").setData(Jt):(t.current.addSource("weather-risk",{type:"geojson",data:Jt}),t.current.addLayer({id:"risk-heatmap",type:"fill",source:"weather-risk",paint:{"fill-color":["interpolate",["linear"],["get","riskScore"],0,"rgb(0, 255, 0)",25,"rgb(144, 238, 144)",50,"rgb(255, 255, 0)",75,"rgb(255, 165, 0)",100,"rgb(255, 0, 0)"],"fill-opacity":.4,"fill-antialias":!1}}),t.current.on("click",nr=>{var Mt;const Gt=(Mt=t.current)==null?void 0:Mt.queryRenderedFeatures(nr.point,{layers:["risk-heatmap"]});if(Gt&&Gt.length>0){const mr=Gt[0].properties,Qt=nr.lngLat.lat,er=nr.lngLat.lng;let dt=mr.temperature,It=mr.humidity,tr=null;const Gr=(Vi,On)=>{const wi=Vi-273.15;if(wi<0)return 0;const Vn=wi*9/5+32,Hr=On/100*10,Pi=(1-2*(Hr/30)+1.5*Math.pow(Hr/30,2)-.5*Math.pow(Hr/30,3))*100,Qi=Math.sqrt(1+Math.pow(mr.windSpeed,2)),Fn=Pi*Qi*(1+Math.pow(Vn,2)/1e3)/100;return Math.min(100,Math.max(0,Math.round(Fn)))},Rr=Vi=>Vi<=25?{level:"LOW",color:"#00ff00"}:Vi<=50?{level:"MODERATE",color:"#ffff00"}:Vi<=75?{level:"HIGH",color:"#ff9500"}:{level:"EXTREME",color:"#ff0000"},Sr=Vi=>{const On=((dt-273.15)*9/5+32).toFixed(1),wi=(mr.windSpeed*2.237).toFixed(1),Vn=(mr.pressure*.02953).toFixed(2),Hr=Gr(dt,It),Pi=Rr(Hr),Qi=`
                <div style="padding: 16px; min-width: 320px; max-width: 360px; background: #2a2a2a; border-radius: 8px;">
                  <h3 style="margin: 0 0 14px 0; font-weight: bold; color: ${Pi.color}; text-align: center; font-size: 17px; text-shadow: 0 1px 2px rgba(0,0,0,0.5);">
                    ${Pi.level} RISK
                  </h3>
                  <div style="background: #1a1a1a; padding: 14px; border-radius: 6px; margin-bottom: 12px; border: 1px solid #444;">
                    <p style="margin: 7px 0; font-size: 14px; color: #fff;"><strong style="color: #aaa;">Temperature:</strong> ${On}F</p>
                    <p style="margin: 7px 0; font-size: 14px; color: #fff;"><strong style="color: #aaa;">Wind Speed:</strong> ${wi} mph</p>
                    <p style="margin: 7px 0; font-size: 14px; color: #fff;"><strong style="color: #aaa;">Humidity:</strong> ${It.toFixed(1)}%</p>
                    <p style="margin: 7px 0; font-size: 14px; color: #fff;"><strong style="color: #aaa;">Barometric Pressure:</strong> ${Vn} inHg</p>
                  </div>
                  <p style="margin: 10px 0; text-align: center; font-size: 16px; color: #fff; font-weight: bold;">Risk Score: ${Hr}/100</p>
                  <button 
                    id="mistify-btn" 
                    style="width: 100%; padding: 13px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 7px; font-weight: bold; cursor: pointer; font-size: 15px; transition: all 0.3s; box-shadow: 0 3px 6px rgba(0,0,0,0.3);"
                    onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 5px 10px rgba(0,0,0,0.4)';"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 3px 6px rgba(0,0,0,0.3)';"
                  >
                     Activate MISTIFY
                  </button>
                  <p style="margin: 10px 0 0 0; font-size: 11px; color: #888; text-align: center;">
                    Fosberg Fire Weather Index
                  </p>
                </div>
              `;Vi.setHTML(Qi),setTimeout(()=>{const Fn=document.getElementById("mistify-btn");if(Fn){const bi=()=>{tr||(tr=window.setInterval(()=>{var cr;dt>293.15&&(dt=Math.max(293.15,dt-.5));const Qn=85;It<Qn&&(It=Math.min(Qn,It+2));const Ss=Gr(dt,It),Gi=$.map(Nt=>Math.abs(Nt.lat-Qt)<1&&Math.abs(Nt.lng-er)<1?{...Nt,temperature:dt,humidity:It,riskScore:Ss,riskLevel:Rr(Ss).level}:Nt),Ve=3/2,Ct={type:"FeatureCollection",features:Gi.map(Nt=>({type:"Feature",geometry:{type:"Polygon",coordinates:[[[Nt.lng-Ve,Nt.lat-Ve],[Nt.lng+Ve,Nt.lat-Ve],[Nt.lng+Ve,Nt.lat+Ve],[Nt.lng-Ve,Nt.lat+Ve],[Nt.lng-Ve,Nt.lat-Ve]]]},properties:{riskScore:Nt.riskScore,riskLevel:Nt.riskLevel,temperature:Nt.temperature,humidity:Nt.humidity,windSpeed:Nt.windSpeed,pressure:Nt.pressure}}))};(cr=t.current)!=null&&cr.getSource("weather-risk")&&t.current.getSource("weather-risk").setData(Ct),Sr(Vi),dt<=293.15&&It>=Qn&&ns()},100))},ns=()=>{tr&&(clearInterval(tr),tr=null)};Fn.addEventListener("mousedown",bi),Fn.addEventListener("mouseup",ns),Fn.addEventListener("mouseleave",ns),Fn.addEventListener("touchstart",bi),Fn.addEventListener("touchend",ns)}},0)},ti=new Gx.Popup().setLngLat(nr.lngLat).on("close",()=>{tr&&(clearInterval(tr),tr=null)}).addTo(t.current);Sr(ti)}}))};return t.current.loaded()?qe():t.current.on("load",qe),()=>{t.current&&t.current.off("load",qe)}},[$]),O?ye.jsx("div",{className:"container mx-auto px-4 py-12",children:ye.jsx(Aa,{className:"max-w-2xl mx-auto",children:ye.jsxs(g1,{className:"p-6",children:[ye.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[ye.jsx(G6,{className:"w-5 h-5 text-primary mt-1 flex-shrink-0"}),ye.jsxs("div",{children:[ye.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Mapbox Access Token Required"}),ye.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"To display the interactive weather-based wildfire risk map using live data, you'll need a free Mapbox access token."}),ye.jsxs("ol",{className:"text-sm text-muted-foreground list-decimal list-inside space-y-2 mb-4",children:[ye.jsxs("li",{children:["Visit ",ye.jsx("a",{href:"https://mapbox.com",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"mapbox.com"})]}),ye.jsx("li",{children:"Create a free account or sign in"}),ye.jsx("li",{children:"Go to your Account page and copy your default public token"}),ye.jsx("li",{children:"Paste it below"})]})]})]}),ye.jsxs("div",{className:"flex gap-2",children:[ye.jsx(ew,{type:"text",placeholder:"pk.eyJ1...",value:g,onChange:qe=>v(qe.target.value),className:"flex-1"}),ye.jsx(Ga,{onClick:Oe,children:"Submit"})]})]})})}):ye.jsxs("div",{className:"container mx-auto px-4 py-12",children:[ye.jsxs("div",{className:"mb-6 flex items-center justify-between flex-wrap gap-4",children:[ye.jsxs("div",{children:[ye.jsx("h2",{className:"flex items-center justify-between text-4xl font-bold mb-2 pb-6 border-b border-border/50",children:"Global Wildfire Risk Map"}),ye.jsx("p",{className:"text-muted-foreground",children:E?"Wildfire risk assessment using simulated weather data":"Wildfire risk assessment using live weather data"}),we&&ye.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Last updated: ",we.toLocaleString()," ",E]})]}),ye.jsxs("div",{className:"flex gap-2",children:[ye.jsx(Ga,{onClick:()=>{E?(a||F(!0),o(!1)):window.location.reload(!0)},variant:E?"default":"outline",className:"gap-2",children:E?"Use Live Data":"Use Demo Data"}),!E&&ye.jsxs(ye.Fragment,{children:[ye.jsxs(Ga,{onClick:re,disabled:te,className:"gap-2",children:[ye.jsx(K6,{className:`w-4 h-4 ${te?"animate-spin":""}`}),te?"Updating...":"Refresh Data"]}),ye.jsxs(Ga,{onClick:Xe,variant:"outline",className:"gap-2",children:[ye.jsx(Y6,{className:"w-4 h-4"}),"Change Token"]})]})]})]}),me&&ye.jsx(J3,{variant:"destructive",className:"mb-6",children:ye.jsx(Q3,{children:me})}),ye.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[ye.jsx("div",{className:"lg:col-span-3",children:ye.jsx("div",{ref:i,className:"w-full h-[600px] rounded-lg shadow-lg"})}),ye.jsxs("div",{className:"space-y-4",children:[ye.jsx(Aa,{children:ye.jsxs(g1,{className:"p-4",children:[ye.jsx("h3",{className:"font-semibold mb-3",children:"Risk Levels"}),ye.jsx("div",{className:"space-y-2",children:Y9.map(qe=>ye.jsxs("div",{className:"flex items-center gap-2",children:[ye.jsx("div",{className:"w-6 h-6 rounded",style:{backgroundColor:qe.color}}),ye.jsxs("div",{className:"flex-1",children:[ye.jsx("div",{className:"font-medium text-sm",children:qe.label}),ye.jsx("div",{className:"text-xs text-muted-foreground",children:qe.range})]})]},qe.level))})]})}),ye.jsx(Aa,{children:ye.jsxs(g1,{className:"p-4",children:[ye.jsx("h3",{className:"font-semibold mb-2",children:"About This Map"}),ye.jsx("p",{className:"text-sm text-muted-foreground",children:"This map displays real-time wildfire risk calculated using the Fosberg Fire Weather Index (FFWI) based on current temperature, humidity, wind speed, and atmospheric pressure data."})]})})]})]})]})},t7=I0("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function r7({className:i,variant:t,...a}){return ye.jsx("div",{className:Jn(t7({variant:t}),i),...a})}const i7="/assets/interface-phone-1-B0c1lVHj.png",n7="/assets/interface-phone-2-DsCV36T7.png",s7=({scrollY:i})=>{const[t,a]=ke.useState(!1),[h,g]=ke.useState("map");ke.useState(1),ke.useEffect(()=>{const o=()=>{const O=document.getElementById("interface");if(O){const F=O.getBoundingClientRect();a(F.top<window.innerHeight*.7)}};return window.addEventListener("scroll",o),o(),()=>window.removeEventListener("scroll",o)},[]);const v=[{id:"camera",icon:hM,title:"Camera Feed",description:"Per-unit camera feeds with spherical view field and night vision"},{id:"health",icon:uM,title:"Health Check",description:"Comprehensive status monitoring with self-repair and optimized rerouting"},{id:"map",icon:q6,title:"Risk Map",description:"Live data and inferences presented as intuitive, interactive visualizations"}],E=[{label:"Toggle Autopilot",icon:dM,status:"active"},{label:"Manual Override",icon:U6,status:"standby"},{label:"Autonomous Activation",icon:Z6,status:"active"}];return ye.jsx("section",{id:"interface",className:"py-32 px-4 relative",children:ye.jsxs("div",{className:"container mx-auto max-w-7xl",children:[ye.jsxs("div",{className:`text-center mb-20 transition-all duration-1000 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsxs("h2",{className:"text-5xl md:text-7xl font-bold mb-6",children:["Intuitive ",ye.jsx("span",{className:"text-gradient-secondary",children:"Control"})]}),ye.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Desktop & mobile apps with contextual options enabling easy unit control"})]}),ye.jsx("div",{className:"grid lg:grid-cols-3 gap-8 mb-12",children:v.map((o,O)=>{const F=o.icon,$=h===o.id;return ye.jsxs(Aa,{className:`glass-card p-8 cursor-pointer transition-all duration-500 hover:scale-105 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"} ${$?"border-secondary border-2":""}`,style:{transitionDelay:`${O*100}ms`},onClick:()=>g(o.id),children:[ye.jsx("div",{className:`inline-block p-4 rounded-xl mb-4 transition-all duration-300 ${$?"bg-secondary/20 hover-glow-secondary":"bg-muted/50"}`,children:ye.jsx(F,{className:`w-8 h-8 ${$?"text-secondary":"text-muted-foreground"}`})}),ye.jsx("h3",{className:"text-xl font-bold mb-3",children:o.title}),ye.jsx("p",{className:"text-muted-foreground leading-relaxed",children:o.description})]},o.id)})}),ye.jsxs(Aa,{className:`glass-card p-12 transition-all duration-1000 delay-300 ${t?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[h==="map"&&ye.jsx("div",{className:"relative overflow-hidden rounded-xl",children:ye.jsx(e7,{})}),h==="camera"&&ye.jsxs("div",{className:"mb-8 bg-gradient-to-br from-primary/10 to-secondary/10 rounded-xl p-12 text-center",children:[ye.jsx(hM,{className:"w-16 h-16 mx-auto mb-4 text-secondary"}),ye.jsx("p",{className:"text-xl font-semibold mb-2",children:"Live Camera Feed"}),ye.jsx("p",{className:"text-muted-foreground",children:"Per-unit camera feeds with spherical view field and night vision capabilities"})]}),h==="health"&&ye.jsxs("div",{className:"mb-8 bg-gradient-to-br from-accent/10 to-primary/10 rounded-xl p-12 text-center",children:[ye.jsx(uM,{className:"w-16 h-16 mx-auto mb-4 text-primary"}),ye.jsx("p",{className:"text-xl font-semibold mb-2",children:"System Health Check"}),ye.jsx("p",{className:"text-muted-foreground",children:"Comprehensive status monitoring with self-repair and optimized rerouting"})]}),ye.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:E.map((o,O)=>{const F=o.icon;return ye.jsxs("div",{className:"flex items-center gap-4 p-6 rounded-xl bg-card/30 hover:bg-card/50 transition-all duration-300 group cursor-pointer",children:[ye.jsx("div",{className:`p-3 rounded-lg ${o.status==="active"?"bg-primary/20 group-hover:bg-secondary/30":"bg-muted/50"}`,children:ye.jsx(F,{className:`w-6 h-6 ${o.status==="active"?"text-secondary":"text-muted-foreground"}`})}),ye.jsxs("div",{className:"flex-1",children:[ye.jsx("div",{className:"font-semibold mb-1",children:o.label}),ye.jsx(r7,{variant:"outline",className:`text-xs ${o.status==="active"?"bg-primary/10 text-secondary border-primary/30":"bg-muted/50 text-muted-foreground"}`,children:o.status})]})]},O)})}),ye.jsxs("div",{className:"mt-8 p-6 rounded-xl bg-gradient-to-r from-primary/10 via-secondary/10 to-accent/10 border border-primary/20",children:[ye.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[ye.jsx("div",{className:"w-3 h-3 rounded-full bg-primary animate-pulse"}),ye.jsx("span",{className:"font-semibold",children:"System Status: Operational"})]}),ye.jsx("p",{className:"text-sm text-muted-foreground",children:"All units functioning optimally. Environmental monitoring active."})]})]}),ye.jsxs("div",{className:`mt-16 grid md:grid-cols-2 gap-8 items-center transition-all duration-1000 delay-500 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsxs(Aa,{className:"glass-card p-12 hover-glow-secondary",children:[ye.jsxs("h3",{className:"text-3xl font-bold mb-6",children:["Control from ",ye.jsx("span",{className:"text-gradient-secondary",children:"Anywhere"})]}),ye.jsx("p",{className:"text-lg text-muted-foreground leading-relaxed mb-8",children:"24/7 monitoring and control through our intuitive mobile interface. Stream live camera feeds, view environmental data, and manage your fleet  all in real-time."}),ye.jsxs("div",{className:"flex gap-4 flex-wrap",children:[ye.jsxs(Ga,{variant:"outline",className:"border-primary text-primary hover:bg-primary/10",children:[ye.jsx(dM,{className:"w-4 h-4 mr-2"}),"System Status"]}),ye.jsxs(Ga,{variant:"outline",className:"border-secondary text-secondary hover:bg-secondary/10",children:[ye.jsx(Wz,{className:"w-4 h-4 mr-2"}),"Connectivity"]}),ye.jsxs(Ga,{variant:"outline",className:"border-accent text-accent hover:bg-accent/10",children:[ye.jsx(Hz,{className:"w-4 h-4 mr-2"}),"Fleet Power"]})]})]}),ye.jsxs("div",{className:"flex gap-6 justify-center items-center",children:[ye.jsx("img",{src:n7,alt:"MISTIFY mobile control menu interface",className:"w-64 rounded-3xl shadow-2xl transform hover:scale-105 transition-transform duration-500 hover-glow-primary"}),ye.jsx("img",{src:i7,alt:"MISTIFY mobile camera feed interface",className:"w-64 rounded-3xl shadow-2xl transform hover:scale-105 transition-transform duration-500 hover-glow-secondary"})]})]}),ye.jsx("div",{className:`text-center mt-16 transition-all duration-1000 delay-700 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:ye.jsxs(Ga,{size:"lg",variant:"outline",className:"border-primary text-primary hover:bg-secondary/10 hover-glow-secondary text-lg px-8 py-6 transition-all duration-300 hover:scale-105",onClick:()=>{var o;return(o=document.getElementById("impact"))==null?void 0:o.scrollIntoView({behavior:"smooth"})},children:["Learn More",ye.jsx(Dw,{className:"w-5 h-5 ml-2"})]})})]})})};var P0=i=>i.type==="checkbox",lf=i=>i instanceof Date,ea=i=>i==null;const iB=i=>typeof i=="object";var Ps=i=>!ea(i)&&!Array.isArray(i)&&iB(i)&&!lf(i),nB=i=>Ps(i)&&i.target?P0(i.target)?i.target.checked:i.target.value:i,o7=i=>i.substring(0,i.search(/\.\d+(\.|$)/))||i,sB=(i,t)=>i.has(o7(t)),a7=i=>{const t=i.constructor&&i.constructor.prototype;return Ps(t)&&t.hasOwnProperty("isPrototypeOf")},VI=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Zs(i){let t;const a=Array.isArray(i),h=typeof FileList<"u"?i instanceof FileList:!1;if(i instanceof Date)t=new Date(i);else if(!(VI&&(i instanceof Blob||h))&&(a||Ps(i)))if(t=a?[]:{},!a&&!a7(i))t=i;else for(const g in i)i.hasOwnProperty(g)&&(t[g]=Zs(i[g]));else return i;return t}var Ww=i=>/^\w*$/.test(i),As=i=>i===void 0,UI=i=>Array.isArray(i)?i.filter(Boolean):[],$I=i=>UI(i.replace(/["|']|\]/g,"").split(/\.|\[/)),Ir=(i,t,a)=>{if(!t||!Ps(i))return a;const h=(Ww(t)?[t]:$I(t)).reduce((g,v)=>ea(g)?g:g[v],i);return As(h)||h===i?As(i[t])?a:i[t]:h},Na=i=>typeof i=="boolean",Ln=(i,t,a)=>{let h=-1;const g=Ww(t)?[t]:$I(t),v=g.length,E=v-1;for(;++h<v;){const o=g[h];let O=a;if(h!==E){const F=i[o];O=Ps(F)||Array.isArray(F)?F:isNaN(+g[h+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;i[o]=O,i=i[o]}};const ow={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},$l={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},tu={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},GI=Ft.createContext(null);GI.displayName="HookFormContext";const Zw=()=>Ft.useContext(GI),l7=i=>{const{children:t,...a}=i;return Ft.createElement(GI.Provider,{value:a},t)};var oB=(i,t,a,h=!0)=>{const g={defaultValues:t._defaultValues};for(const v in i)Object.defineProperty(g,v,{get:()=>{const E=v;return t._proxyFormState[E]!==$l.all&&(t._proxyFormState[E]=!h||$l.all),a&&(a[E]=!0),i[E]}});return g};const HI=typeof window<"u"?Ft.useLayoutEffect:Ft.useEffect;function c7(i){const t=Zw(),{control:a=t.control,disabled:h,name:g,exact:v}=i||{},[E,o]=Ft.useState(a._formState),O=Ft.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return HI(()=>a._subscribe({name:g,formState:O.current,exact:v,callback:F=>{!h&&o({...a._formState,...F})}}),[g,h,v]),Ft.useEffect(()=>{O.current.isValid&&a._setValid(!0)},[a]),Ft.useMemo(()=>oB(E,a,O.current,!1),[E,a])}var Tc=i=>typeof i=="string",aB=(i,t,a,h,g)=>Tc(i)?(h&&t.watch.add(i),Ir(a,i,g)):Array.isArray(i)?i.map(v=>(h&&t.watch.add(v),Ir(a,v))):(h&&(t.watchAll=!0),a),f2=i=>ea(i)||!iB(i);function au(i,t,a=new WeakSet){if(f2(i)||f2(t))return i===t;if(lf(i)&&lf(t))return i.getTime()===t.getTime();const h=Object.keys(i),g=Object.keys(t);if(h.length!==g.length)return!1;if(a.has(i)||a.has(t))return!0;a.add(i),a.add(t);for(const v of h){const E=i[v];if(!g.includes(v))return!1;if(v!=="ref"){const o=t[v];if(lf(E)&&lf(o)||Ps(E)&&Ps(o)||Array.isArray(E)&&Array.isArray(o)?!au(E,o,a):E!==o)return!1}}return!0}function u7(i){const t=Zw(),{control:a=t.control,name:h,defaultValue:g,disabled:v,exact:E,compute:o}=i||{},O=Ft.useRef(g),F=Ft.useRef(o),$=Ft.useRef(void 0);F.current=o;const Q=Ft.useMemo(()=>a._getWatch(h,O.current),[a,h]),[te,J]=Ft.useState(F.current?F.current(Q):Q);return HI(()=>a._subscribe({name:h,formState:{values:!0},exact:E,callback:we=>{if(!v){const se=aB(h,a._names,we.values||a._formValues,!1,O.current);if(F.current){const me=F.current(se);au(me,$.current)||(J(me),$.current=me)}else J(se)}}}),[a,v,h,E]),Ft.useEffect(()=>a._removeUnmounted()),te}function h7(i){const t=Zw(),{name:a,disabled:h,control:g=t.control,shouldUnregister:v,defaultValue:E}=i,o=sB(g._names.array,a),O=Ft.useMemo(()=>Ir(g._formValues,a,Ir(g._defaultValues,a,E)),[g,a,E]),F=u7({control:g,name:a,defaultValue:O,exact:!0}),$=c7({control:g,name:a,exact:!0}),Q=Ft.useRef(i),te=Ft.useRef(g.register(a,{...i.rules,value:F,...Na(i.disabled)?{disabled:i.disabled}:{}}));Q.current=i;const J=Ft.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Ir($.errors,a)},isDirty:{enumerable:!0,get:()=>!!Ir($.dirtyFields,a)},isTouched:{enumerable:!0,get:()=>!!Ir($.touchedFields,a)},isValidating:{enumerable:!0,get:()=>!!Ir($.validatingFields,a)},error:{enumerable:!0,get:()=>Ir($.errors,a)}}),[$,a]),we=Ft.useCallback(re=>te.current.onChange({target:{value:nB(re),name:a},type:ow.CHANGE}),[a]),se=Ft.useCallback(()=>te.current.onBlur({target:{value:Ir(g._formValues,a),name:a},type:ow.BLUR}),[a,g._formValues]),me=Ft.useCallback(re=>{const de=Ir(g._fields,a);de&&re&&(de._f.ref={focus:()=>re.focus&&re.focus(),select:()=>re.select&&re.select(),setCustomValidity:Oe=>re.setCustomValidity(Oe),reportValidity:()=>re.reportValidity()})},[g._fields,a]),fe=Ft.useMemo(()=>({name:a,value:F,...Na(h)||$.disabled?{disabled:$.disabled||h}:{},onChange:we,onBlur:se,ref:me}),[a,h,$.disabled,we,se,me,F]);return Ft.useEffect(()=>{const re=g._options.shouldUnregister||v;g.register(a,{...Q.current.rules,...Na(Q.current.disabled)?{disabled:Q.current.disabled}:{}});const de=(Oe,Xe)=>{const qe=Ir(g._fields,Oe);qe&&qe._f&&(qe._f.mount=Xe)};if(de(a,!0),re){const Oe=Zs(Ir(g._options.defaultValues,a));Ln(g._defaultValues,a,Oe),As(Ir(g._formValues,a))&&Ln(g._formValues,a,Oe)}return!o&&g.register(a),()=>{(o?re&&!g._state.action:re)?g.unregister(a):de(a,!1)}},[a,g,o,v]),Ft.useEffect(()=>{g._setDisabledField({disabled:h,name:a})},[h,a,g]),Ft.useMemo(()=>({field:fe,formState:$,fieldState:J}),[fe,$,J])}const d7=i=>i.render(h7(i));var lB=(i,t,a,h,g)=>t?{...a[i],types:{...a[i]&&a[i].types?a[i].types:{},[h]:g||!0}}:{},Uy=i=>Array.isArray(i)?i:[i],gO=()=>{let i=[];return{get observers(){return i},next:g=>{for(const v of i)v.next&&v.next(g)},subscribe:g=>(i.push(g),{unsubscribe:()=>{i=i.filter(v=>v!==g)}}),unsubscribe:()=>{i=[]}}},xa=i=>Ps(i)&&!Object.keys(i).length,qI=i=>i.type==="file",Gl=i=>typeof i=="function",aw=i=>{if(!VI)return!1;const t=i?i.ownerDocument:0;return i instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},cB=i=>i.type==="select-multiple",WI=i=>i.type==="radio",f7=i=>WI(i)||P0(i),US=i=>aw(i)&&i.isConnected;function p7(i,t){const a=t.slice(0,-1).length;let h=0;for(;h<a;)i=As(i)?h++:i[t[h++]];return i}function m7(i){for(const t in i)if(i.hasOwnProperty(t)&&!As(i[t]))return!1;return!0}function Fs(i,t){const a=Array.isArray(t)?t:Ww(t)?[t]:$I(t),h=a.length===1?i:p7(i,a),g=a.length-1,v=a[g];return h&&delete h[v],g!==0&&(Ps(h)&&xa(h)||Array.isArray(h)&&m7(h))&&Fs(i,a.slice(0,-1)),i}var uB=i=>{for(const t in i)if(Gl(i[t]))return!0;return!1};function lw(i,t={}){const a=Array.isArray(i);if(Ps(i)||a)for(const h in i)Array.isArray(i[h])||Ps(i[h])&&!uB(i[h])?(t[h]=Array.isArray(i[h])?[]:{},lw(i[h],t[h])):ea(i[h])||(t[h]=!0);return t}function hB(i,t,a){const h=Array.isArray(i);if(Ps(i)||h)for(const g in i)Array.isArray(i[g])||Ps(i[g])&&!uB(i[g])?As(t)||f2(a[g])?a[g]=Array.isArray(i[g])?lw(i[g],[]):{...lw(i[g])}:hB(i[g],ea(t)?{}:t[g],a[g]):a[g]=!au(i[g],t[g]);return a}var wy=(i,t)=>hB(i,t,lw(t));const _O={value:!1,isValid:!1},yO={value:!0,isValid:!0};var dB=i=>{if(Array.isArray(i)){if(i.length>1){const t=i.filter(a=>a&&a.checked&&!a.disabled).map(a=>a.value);return{value:t,isValid:!!t.length}}return i[0].checked&&!i[0].disabled?i[0].attributes&&!As(i[0].attributes.value)?As(i[0].value)||i[0].value===""?yO:{value:i[0].value,isValid:!0}:yO:_O}return _O},fB=(i,{valueAsNumber:t,valueAsDate:a,setValueAs:h})=>As(i)?i:t?i===""?NaN:i&&+i:a&&Tc(i)?new Date(i):h?h(i):i;const vO={isValid:!1,value:null};var pB=i=>Array.isArray(i)?i.reduce((t,a)=>a&&a.checked&&!a.disabled?{isValid:!0,value:a.value}:t,vO):vO;function xO(i){const t=i.ref;return qI(t)?t.files:WI(t)?pB(i.refs).value:cB(t)?[...t.selectedOptions].map(({value:a})=>a):P0(t)?dB(i.refs).value:fB(As(t.value)?i.ref.value:t.value,i)}var g7=(i,t,a,h)=>{const g={};for(const v of i){const E=Ir(t,v);E&&Ln(g,v,E._f)}return{criteriaMode:a,names:[...i],fields:g,shouldUseNativeValidation:h}},cw=i=>i instanceof RegExp,by=i=>As(i)?i:cw(i)?i.source:Ps(i)?cw(i.value)?i.value.source:i.value:i,wO=i=>({isOnSubmit:!i||i===$l.onSubmit,isOnBlur:i===$l.onBlur,isOnChange:i===$l.onChange,isOnAll:i===$l.all,isOnTouch:i===$l.onTouched});const bO="AsyncFunction";var _7=i=>!!i&&!!i.validate&&!!(Gl(i.validate)&&i.validate.constructor.name===bO||Ps(i.validate)&&Object.values(i.validate).find(t=>t.constructor.name===bO)),y7=i=>i.mount&&(i.required||i.min||i.max||i.maxLength||i.minLength||i.pattern||i.validate),TO=(i,t,a)=>!a&&(t.watchAll||t.watch.has(i)||[...t.watch].some(h=>i.startsWith(h)&&/^\.\w+/.test(i.slice(h.length))));const $y=(i,t,a,h)=>{for(const g of a||Object.keys(i)){const v=Ir(i,g);if(v){const{_f:E,...o}=v;if(E){if(E.refs&&E.refs[0]&&t(E.refs[0],g)&&!h)return!0;if(E.ref&&t(E.ref,E.name)&&!h)return!0;if($y(o,t))break}else if(Ps(o)&&$y(o,t))break}}};function SO(i,t,a){const h=Ir(i,a);if(h||Ww(a))return{error:h,name:a};const g=a.split(".");for(;g.length;){const v=g.join("."),E=Ir(t,v),o=Ir(i,v);if(E&&!Array.isArray(E)&&a!==v)return{name:a};if(o&&o.type)return{name:v,error:o};if(o&&o.root&&o.root.type)return{name:`${v}.root`,error:o.root};g.pop()}return{name:a}}var v7=(i,t,a,h)=>{a(i);const{name:g,...v}=i;return xa(v)||Object.keys(v).length>=Object.keys(t).length||Object.keys(v).find(E=>t[E]===(!h||$l.all))},x7=(i,t,a)=>!i||!t||i===t||Uy(i).some(h=>h&&(a?h===t:h.startsWith(t)||t.startsWith(h))),w7=(i,t,a,h,g)=>g.isOnAll?!1:!a&&g.isOnTouch?!(t||i):(a?h.isOnBlur:g.isOnBlur)?!i:(a?h.isOnChange:g.isOnChange)?i:!0,b7=(i,t)=>!UI(Ir(i,t)).length&&Fs(i,t),T7=(i,t,a)=>{const h=Uy(Ir(i,a));return Ln(h,"root",t[a]),Ln(i,a,h),i},_1=i=>Tc(i);function EO(i,t,a="validate"){if(_1(i)||Array.isArray(i)&&i.every(_1)||Na(i)&&!i)return{type:a,message:_1(i)?i:"",ref:t}}var sm=i=>Ps(i)&&!cw(i)?i:{value:i,message:""},IO=async(i,t,a,h,g,v)=>{const{ref:E,refs:o,required:O,maxLength:F,minLength:$,min:Q,max:te,pattern:J,validate:we,name:se,valueAsNumber:me,mount:fe}=i._f,re=Ir(a,se);if(!fe||t.has(se))return{};const de=o?o[0]:E,Oe=Gt=>{g&&de.reportValidity&&(de.setCustomValidity(Na(Gt)?"":Gt||""),de.reportValidity())},Xe={},qe=WI(E),Be=P0(E),bt=qe||Be,Bt=(me||qI(E))&&As(E.value)&&As(re)||aw(E)&&E.value===""||re===""||Array.isArray(re)&&!re.length,Jt=lB.bind(null,se,h,Xe),nr=(Gt,Mt,Zt,mr=tu.maxLength,Qt=tu.minLength)=>{const er=Gt?Mt:Zt;Xe[se]={type:Gt?mr:Qt,message:er,ref:E,...Jt(Gt?mr:Qt,er)}};if(v?!Array.isArray(re)||!re.length:O&&(!bt&&(Bt||ea(re))||Na(re)&&!re||Be&&!dB(o).isValid||qe&&!pB(o).isValid)){const{value:Gt,message:Mt}=_1(O)?{value:!!O,message:O}:sm(O);if(Gt&&(Xe[se]={type:tu.required,message:Mt,ref:de,...Jt(tu.required,Mt)},!h))return Oe(Mt),Xe}if(!Bt&&(!ea(Q)||!ea(te))){let Gt,Mt;const Zt=sm(te),mr=sm(Q);if(!ea(re)&&!isNaN(re)){const Qt=E.valueAsNumber||re&&+re;ea(Zt.value)||(Gt=Qt>Zt.value),ea(mr.value)||(Mt=Qt<mr.value)}else{const Qt=E.valueAsDate||new Date(re),er=tr=>new Date(new Date().toDateString()+" "+tr),dt=E.type=="time",It=E.type=="week";Tc(Zt.value)&&re&&(Gt=dt?er(re)>er(Zt.value):It?re>Zt.value:Qt>new Date(Zt.value)),Tc(mr.value)&&re&&(Mt=dt?er(re)<er(mr.value):It?re<mr.value:Qt<new Date(mr.value))}if((Gt||Mt)&&(nr(!!Gt,Zt.message,mr.message,tu.max,tu.min),!h))return Oe(Xe[se].message),Xe}if((F||$)&&!Bt&&(Tc(re)||v&&Array.isArray(re))){const Gt=sm(F),Mt=sm($),Zt=!ea(Gt.value)&&re.length>+Gt.value,mr=!ea(Mt.value)&&re.length<+Mt.value;if((Zt||mr)&&(nr(Zt,Gt.message,Mt.message),!h))return Oe(Xe[se].message),Xe}if(J&&!Bt&&Tc(re)){const{value:Gt,message:Mt}=sm(J);if(cw(Gt)&&!re.match(Gt)&&(Xe[se]={type:tu.pattern,message:Mt,ref:E,...Jt(tu.pattern,Mt)},!h))return Oe(Mt),Xe}if(we){if(Gl(we)){const Gt=await we(re,a),Mt=EO(Gt,de);if(Mt&&(Xe[se]={...Mt,...Jt(tu.validate,Mt.message)},!h))return Oe(Mt.message),Xe}else if(Ps(we)){let Gt={};for(const Mt in we){if(!xa(Gt)&&!h)break;const Zt=EO(await we[Mt](re,a),de,Mt);Zt&&(Gt={...Zt,...Jt(Mt,Zt.message)},Oe(Zt.message),h&&(Xe[se]=Gt))}if(!xa(Gt)&&(Xe[se]={ref:de,...Gt},!h))return Xe}}return Oe(!0),Xe};const S7={mode:$l.onSubmit,reValidateMode:$l.onChange,shouldFocusError:!0};function E7(i={}){let t={...S7,...i},a={submitCount:0,isDirty:!1,isReady:!1,isLoading:Gl(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},h={},g=Ps(t.defaultValues)||Ps(t.values)?Zs(t.defaultValues||t.values)||{}:{},v=t.shouldUnregister?{}:Zs(g),E={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},O,F=0;const $={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let Q={...$};const te={array:gO(),state:gO()},J=t.criteriaMode===$l.all,we=Ve=>ct=>{clearTimeout(F),F=setTimeout(Ve,ct)},se=async Ve=>{if(!t.disabled&&($.isValid||Q.isValid||Ve)){const ct=t.resolver?xa((await Be()).errors):await Bt(h,!0);ct!==a.isValid&&te.state.next({isValid:ct})}},me=(Ve,ct)=>{!t.disabled&&($.isValidating||$.validatingFields||Q.isValidating||Q.validatingFields)&&((Ve||Array.from(o.mount)).forEach(Ct=>{Ct&&(ct?Ln(a.validatingFields,Ct,ct):Fs(a.validatingFields,Ct))}),te.state.next({validatingFields:a.validatingFields,isValidating:!xa(a.validatingFields)}))},fe=(Ve,ct=[],Ct,cr,Nt=!0,rr=!0)=>{if(cr&&Ct&&!t.disabled){if(E.action=!0,rr&&Array.isArray(Ir(h,Ve))){const br=Ct(Ir(h,Ve),cr.argA,cr.argB);Nt&&Ln(h,Ve,br)}if(rr&&Array.isArray(Ir(a.errors,Ve))){const br=Ct(Ir(a.errors,Ve),cr.argA,cr.argB);Nt&&Ln(a.errors,Ve,br),b7(a.errors,Ve)}if(($.touchedFields||Q.touchedFields)&&rr&&Array.isArray(Ir(a.touchedFields,Ve))){const br=Ct(Ir(a.touchedFields,Ve),cr.argA,cr.argB);Nt&&Ln(a.touchedFields,Ve,br)}($.dirtyFields||Q.dirtyFields)&&(a.dirtyFields=wy(g,v)),te.state.next({name:Ve,isDirty:nr(Ve,ct),dirtyFields:a.dirtyFields,errors:a.errors,isValid:a.isValid})}else Ln(v,Ve,ct)},re=(Ve,ct)=>{Ln(a.errors,Ve,ct),te.state.next({errors:a.errors})},de=Ve=>{a.errors=Ve,te.state.next({errors:a.errors,isValid:!1})},Oe=(Ve,ct,Ct,cr)=>{const Nt=Ir(h,Ve);if(Nt){const rr=Ir(v,Ve,As(Ct)?Ir(g,Ve):Ct);As(rr)||cr&&cr.defaultChecked||ct?Ln(v,Ve,ct?rr:xO(Nt._f)):Zt(Ve,rr),E.mount&&se()}},Xe=(Ve,ct,Ct,cr,Nt)=>{let rr=!1,br=!1;const _i={name:Ve};if(!t.disabled){if(!Ct||cr){($.isDirty||Q.isDirty)&&(br=a.isDirty,a.isDirty=_i.isDirty=nr(),rr=br!==_i.isDirty);const Hi=au(Ir(g,Ve),ct);br=!!Ir(a.dirtyFields,Ve),Hi?Fs(a.dirtyFields,Ve):Ln(a.dirtyFields,Ve,!0),_i.dirtyFields=a.dirtyFields,rr=rr||($.dirtyFields||Q.dirtyFields)&&br!==!Hi}if(Ct){const Hi=Ir(a.touchedFields,Ve);Hi||(Ln(a.touchedFields,Ve,Ct),_i.touchedFields=a.touchedFields,rr=rr||($.touchedFields||Q.touchedFields)&&Hi!==Ct)}rr&&Nt&&te.state.next(_i)}return rr?_i:{}},qe=(Ve,ct,Ct,cr)=>{const Nt=Ir(a.errors,Ve),rr=($.isValid||Q.isValid)&&Na(ct)&&a.isValid!==ct;if(t.delayError&&Ct?(O=we(()=>re(Ve,Ct)),O(t.delayError)):(clearTimeout(F),O=null,Ct?Ln(a.errors,Ve,Ct):Fs(a.errors,Ve)),(Ct?!au(Nt,Ct):Nt)||!xa(cr)||rr){const br={...cr,...rr&&Na(ct)?{isValid:ct}:{},errors:a.errors,name:Ve};a={...a,...br},te.state.next(br)}},Be=async Ve=>{me(Ve,!0);const ct=await t.resolver(v,t.context,g7(Ve||o.mount,h,t.criteriaMode,t.shouldUseNativeValidation));return me(Ve),ct},bt=async Ve=>{const{errors:ct}=await Be(Ve);if(Ve)for(const Ct of Ve){const cr=Ir(ct,Ct);cr?Ln(a.errors,Ct,cr):Fs(a.errors,Ct)}else a.errors=ct;return ct},Bt=async(Ve,ct,Ct={valid:!0})=>{for(const cr in Ve){const Nt=Ve[cr];if(Nt){const{_f:rr,...br}=Nt;if(rr){const _i=o.array.has(rr.name),Hi=Nt._f&&_7(Nt._f);Hi&&$.validatingFields&&me([cr],!0);const xn=await IO(Nt,o.disabled,v,J,t.shouldUseNativeValidation&&!ct,_i);if(Hi&&$.validatingFields&&me([cr]),xn[rr.name]&&(Ct.valid=!1,ct))break;!ct&&(Ir(xn,rr.name)?_i?T7(a.errors,xn,rr.name):Ln(a.errors,rr.name,xn[rr.name]):Fs(a.errors,rr.name))}!xa(br)&&await Bt(br,ct,Ct)}}return Ct.valid},Jt=()=>{for(const Ve of o.unMount){const ct=Ir(h,Ve);ct&&(ct._f.refs?ct._f.refs.every(Ct=>!US(Ct)):!US(ct._f.ref))&&wi(Ve)}o.unMount=new Set},nr=(Ve,ct)=>!t.disabled&&(Ve&&ct&&Ln(v,Ve,ct),!au(tr(),g)),Gt=(Ve,ct,Ct)=>aB(Ve,o,{...E.mount?v:As(ct)?g:Tc(Ve)?{[Ve]:ct}:ct},Ct,ct),Mt=Ve=>UI(Ir(E.mount?v:g,Ve,t.shouldUnregister?Ir(g,Ve,[]):[])),Zt=(Ve,ct,Ct={})=>{const cr=Ir(h,Ve);let Nt=ct;if(cr){const rr=cr._f;rr&&(!rr.disabled&&Ln(v,Ve,fB(ct,rr)),Nt=aw(rr.ref)&&ea(ct)?"":ct,cB(rr.ref)?[...rr.ref.options].forEach(br=>br.selected=Nt.includes(br.value)):rr.refs?P0(rr.ref)?rr.refs.forEach(br=>{(!br.defaultChecked||!br.disabled)&&(Array.isArray(Nt)?br.checked=!!Nt.find(_i=>_i===br.value):br.checked=Nt===br.value||!!Nt)}):rr.refs.forEach(br=>br.checked=br.value===Nt):qI(rr.ref)?rr.ref.value="":(rr.ref.value=Nt,rr.ref.type||te.state.next({name:Ve,values:Zs(v)})))}(Ct.shouldDirty||Ct.shouldTouch)&&Xe(Ve,Nt,Ct.shouldTouch,Ct.shouldDirty,!0),Ct.shouldValidate&&It(Ve)},mr=(Ve,ct,Ct)=>{for(const cr in ct){if(!ct.hasOwnProperty(cr))return;const Nt=ct[cr],rr=Ve+"."+cr,br=Ir(h,rr);(o.array.has(Ve)||Ps(Nt)||br&&!br._f)&&!lf(Nt)?mr(rr,Nt,Ct):Zt(rr,Nt,Ct)}},Qt=(Ve,ct,Ct={})=>{const cr=Ir(h,Ve),Nt=o.array.has(Ve),rr=Zs(ct);Ln(v,Ve,rr),Nt?(te.array.next({name:Ve,values:Zs(v)}),($.isDirty||$.dirtyFields||Q.isDirty||Q.dirtyFields)&&Ct.shouldDirty&&te.state.next({name:Ve,dirtyFields:wy(g,v),isDirty:nr(Ve,rr)})):cr&&!cr._f&&!ea(rr)?mr(Ve,rr,Ct):Zt(Ve,rr,Ct),TO(Ve,o)&&te.state.next({...a,name:Ve}),te.state.next({name:E.mount?Ve:void 0,values:Zs(v)})},er=async Ve=>{E.mount=!0;const ct=Ve.target;let Ct=ct.name,cr=!0;const Nt=Ir(h,Ct),rr=Hi=>{cr=Number.isNaN(Hi)||lf(Hi)&&isNaN(Hi.getTime())||au(Hi,Ir(v,Ct,Hi))},br=wO(t.mode),_i=wO(t.reValidateMode);if(Nt){let Hi,xn;const js=ct.type?xO(Nt._f):nB(Ve),os=Ve.type===ow.BLUR||Ve.type===ow.FOCUS_OUT,Pa=!y7(Nt._f)&&!t.resolver&&!Ir(a.errors,Ct)&&!Nt._f.deps||w7(os,Ir(a.touchedFields,Ct),a.isSubmitted,_i,br),vo=TO(Ct,o,os);Ln(v,Ct,js),os?(Nt._f.onBlur&&Nt._f.onBlur(Ve),O&&O(0)):Nt._f.onChange&&Nt._f.onChange(Ve);const en=Xe(Ct,js,os),aa=!xa(en)||vo;if(!os&&te.state.next({name:Ct,type:Ve.type,values:Zs(v)}),Pa)return($.isValid||Q.isValid)&&(t.mode==="onBlur"?os&&se():os||se()),aa&&te.state.next({name:Ct,...vo?{}:en});if(!os&&vo&&te.state.next({...a}),t.resolver){const{errors:Qs}=await Be([Ct]);if(rr(js),cr){const Do=SO(a.errors,h,Ct),eo=SO(Qs,h,Do.name||Ct);Hi=eo.error,Ct=eo.name,xn=xa(Qs)}}else me([Ct],!0),Hi=(await IO(Nt,o.disabled,v,J,t.shouldUseNativeValidation))[Ct],me([Ct]),rr(js),cr&&(Hi?xn=!1:($.isValid||Q.isValid)&&(xn=await Bt(h,!0)));cr&&(Nt._f.deps&&It(Nt._f.deps),qe(Ct,xn,Hi,en))}},dt=(Ve,ct)=>{if(Ir(a.errors,ct)&&Ve.focus)return Ve.focus(),1},It=async(Ve,ct={})=>{let Ct,cr;const Nt=Uy(Ve);if(t.resolver){const rr=await bt(As(Ve)?Ve:Nt);Ct=xa(rr),cr=Ve?!Nt.some(br=>Ir(rr,br)):Ct}else Ve?(cr=(await Promise.all(Nt.map(async rr=>{const br=Ir(h,rr);return await Bt(br&&br._f?{[rr]:br}:br)}))).every(Boolean),!(!cr&&!a.isValid)&&se()):cr=Ct=await Bt(h);return te.state.next({...!Tc(Ve)||($.isValid||Q.isValid)&&Ct!==a.isValid?{}:{name:Ve},...t.resolver||!Ve?{isValid:Ct}:{},errors:a.errors}),ct.shouldFocus&&!cr&&$y(h,dt,Ve?Nt:o.mount),cr},tr=Ve=>{const ct={...E.mount?v:g};return As(Ve)?ct:Tc(Ve)?Ir(ct,Ve):Ve.map(Ct=>Ir(ct,Ct))},Gr=(Ve,ct)=>({invalid:!!Ir((ct||a).errors,Ve),isDirty:!!Ir((ct||a).dirtyFields,Ve),error:Ir((ct||a).errors,Ve),isValidating:!!Ir(a.validatingFields,Ve),isTouched:!!Ir((ct||a).touchedFields,Ve)}),Rr=Ve=>{Ve&&Uy(Ve).forEach(ct=>Fs(a.errors,ct)),te.state.next({errors:Ve?a.errors:{}})},Sr=(Ve,ct,Ct)=>{const cr=(Ir(h,Ve,{_f:{}})._f||{}).ref,Nt=Ir(a.errors,Ve)||{},{ref:rr,message:br,type:_i,...Hi}=Nt;Ln(a.errors,Ve,{...Hi,...ct,ref:cr}),te.state.next({name:Ve,errors:a.errors,isValid:!1}),Ct&&Ct.shouldFocus&&cr&&cr.focus&&cr.focus()},ti=(Ve,ct)=>Gl(Ve)?te.state.subscribe({next:Ct=>"values"in Ct&&Ve(Gt(void 0,ct),Ct)}):Gt(Ve,ct,!0),Vi=Ve=>te.state.subscribe({next:ct=>{x7(Ve.name,ct.name,Ve.exact)&&v7(ct,Ve.formState||$,Ss,Ve.reRenderRoot)&&Ve.callback({values:{...v},...a,...ct,defaultValues:g})}}).unsubscribe,On=Ve=>(E.mount=!0,Q={...Q,...Ve.formState},Vi({...Ve,formState:Q})),wi=(Ve,ct={})=>{for(const Ct of Ve?Uy(Ve):o.mount)o.mount.delete(Ct),o.array.delete(Ct),ct.keepValue||(Fs(h,Ct),Fs(v,Ct)),!ct.keepError&&Fs(a.errors,Ct),!ct.keepDirty&&Fs(a.dirtyFields,Ct),!ct.keepTouched&&Fs(a.touchedFields,Ct),!ct.keepIsValidating&&Fs(a.validatingFields,Ct),!t.shouldUnregister&&!ct.keepDefaultValue&&Fs(g,Ct);te.state.next({values:Zs(v)}),te.state.next({...a,...ct.keepDirty?{isDirty:nr()}:{}}),!ct.keepIsValid&&se()},Vn=({disabled:Ve,name:ct})=>{(Na(Ve)&&E.mount||Ve||o.disabled.has(ct))&&(Ve?o.disabled.add(ct):o.disabled.delete(ct))},Hr=(Ve,ct={})=>{let Ct=Ir(h,Ve);const cr=Na(ct.disabled)||Na(t.disabled);return Ln(h,Ve,{...Ct||{},_f:{...Ct&&Ct._f?Ct._f:{ref:{name:Ve}},name:Ve,mount:!0,...ct}}),o.mount.add(Ve),Ct?Vn({disabled:Na(ct.disabled)?ct.disabled:t.disabled,name:Ve}):Oe(Ve,!0,ct.value),{...cr?{disabled:ct.disabled||t.disabled}:{},...t.progressive?{required:!!ct.required,min:by(ct.min),max:by(ct.max),minLength:by(ct.minLength),maxLength:by(ct.maxLength),pattern:by(ct.pattern)}:{},name:Ve,onChange:er,onBlur:er,ref:Nt=>{if(Nt){Hr(Ve,ct),Ct=Ir(h,Ve);const rr=As(Nt.value)&&Nt.querySelectorAll&&Nt.querySelectorAll("input,select,textarea")[0]||Nt,br=f7(rr),_i=Ct._f.refs||[];if(br?_i.find(Hi=>Hi===rr):rr===Ct._f.ref)return;Ln(h,Ve,{_f:{...Ct._f,...br?{refs:[..._i.filter(US),rr,...Array.isArray(Ir(g,Ve))?[{}]:[]],ref:{type:rr.type,name:Ve}}:{ref:rr}}}),Oe(Ve,!1,void 0,rr)}else Ct=Ir(h,Ve,{}),Ct._f&&(Ct._f.mount=!1),(t.shouldUnregister||ct.shouldUnregister)&&!(sB(o.array,Ve)&&E.action)&&o.unMount.add(Ve)}}},Pi=()=>t.shouldFocusError&&$y(h,dt,o.mount),Qi=Ve=>{Na(Ve)&&(te.state.next({disabled:Ve}),$y(h,(ct,Ct)=>{const cr=Ir(h,Ct);cr&&(ct.disabled=cr._f.disabled||Ve,Array.isArray(cr._f.refs)&&cr._f.refs.forEach(Nt=>{Nt.disabled=cr._f.disabled||Ve}))},0,!1))},Fn=(Ve,ct)=>async Ct=>{let cr;Ct&&(Ct.preventDefault&&Ct.preventDefault(),Ct.persist&&Ct.persist());let Nt=Zs(v);if(te.state.next({isSubmitting:!0}),t.resolver){const{errors:rr,values:br}=await Be();a.errors=rr,Nt=Zs(br)}else await Bt(h);if(o.disabled.size)for(const rr of o.disabled)Fs(Nt,rr);if(Fs(a.errors,"root"),xa(a.errors)){te.state.next({errors:{}});try{await Ve(Nt,Ct)}catch(rr){cr=rr}}else ct&&await ct({...a.errors},Ct),Pi(),setTimeout(Pi);if(te.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:xa(a.errors)&&!cr,submitCount:a.submitCount+1,errors:a.errors}),cr)throw cr},bi=(Ve,ct={})=>{Ir(h,Ve)&&(As(ct.defaultValue)?Qt(Ve,Zs(Ir(g,Ve))):(Qt(Ve,ct.defaultValue),Ln(g,Ve,Zs(ct.defaultValue))),ct.keepTouched||Fs(a.touchedFields,Ve),ct.keepDirty||(Fs(a.dirtyFields,Ve),a.isDirty=ct.defaultValue?nr(Ve,Zs(Ir(g,Ve))):nr()),ct.keepError||(Fs(a.errors,Ve),$.isValid&&se()),te.state.next({...a}))},ns=(Ve,ct={})=>{const Ct=Ve?Zs(Ve):g,cr=Zs(Ct),Nt=xa(Ve),rr=Nt?g:cr;if(ct.keepDefaultValues||(g=Ct),!ct.keepValues){if(ct.keepDirtyValues){const br=new Set([...o.mount,...Object.keys(wy(g,v))]);for(const _i of Array.from(br))Ir(a.dirtyFields,_i)?Ln(rr,_i,Ir(v,_i)):Qt(_i,Ir(rr,_i))}else{if(VI&&As(Ve))for(const br of o.mount){const _i=Ir(h,br);if(_i&&_i._f){const Hi=Array.isArray(_i._f.refs)?_i._f.refs[0]:_i._f.ref;if(aw(Hi)){const xn=Hi.closest("form");if(xn){xn.reset();break}}}}if(ct.keepFieldsRef)for(const br of o.mount)Qt(br,Ir(rr,br));else h={}}v=t.shouldUnregister?ct.keepDefaultValues?Zs(g):{}:Zs(rr),te.array.next({values:{...rr}}),te.state.next({values:{...rr}})}o={mount:ct.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},E.mount=!$.isValid||!!ct.keepIsValid||!!ct.keepDirtyValues,E.watch=!!t.shouldUnregister,te.state.next({submitCount:ct.keepSubmitCount?a.submitCount:0,isDirty:Nt?!1:ct.keepDirty?a.isDirty:!!(ct.keepDefaultValues&&!au(Ve,g)),isSubmitted:ct.keepIsSubmitted?a.isSubmitted:!1,dirtyFields:Nt?{}:ct.keepDirtyValues?ct.keepDefaultValues&&v?wy(g,v):a.dirtyFields:ct.keepDefaultValues&&Ve?wy(g,Ve):ct.keepDirty?a.dirtyFields:{},touchedFields:ct.keepTouched?a.touchedFields:{},errors:ct.keepErrors?a.errors:{},isSubmitSuccessful:ct.keepIsSubmitSuccessful?a.isSubmitSuccessful:!1,isSubmitting:!1})},ss=(Ve,ct)=>ns(Gl(Ve)?Ve(v):Ve,ct),Qn=(Ve,ct={})=>{const Ct=Ir(h,Ve),cr=Ct&&Ct._f;if(cr){const Nt=cr.refs?cr.refs[0]:cr.ref;Nt.focus&&(Nt.focus(),ct.shouldSelect&&Gl(Nt.select)&&Nt.select())}},Ss=Ve=>{a={...a,...Ve}},Js={control:{register:Hr,unregister:wi,getFieldState:Gr,handleSubmit:Fn,setError:Sr,_subscribe:Vi,_runSchema:Be,_focusError:Pi,_getWatch:Gt,_getDirty:nr,_setValid:se,_setFieldArray:fe,_setDisabledField:Vn,_setErrors:de,_getFieldArray:Mt,_reset:ns,_resetDefaultValues:()=>Gl(t.defaultValues)&&t.defaultValues().then(Ve=>{ss(Ve,t.resetOptions),te.state.next({isLoading:!1})}),_removeUnmounted:Jt,_disableForm:Qi,_subjects:te,_proxyFormState:$,get _fields(){return h},get _formValues(){return v},get _state(){return E},set _state(Ve){E=Ve},get _defaultValues(){return g},get _names(){return o},set _names(Ve){o=Ve},get _formState(){return a},get _options(){return t},set _options(Ve){t={...t,...Ve}}},subscribe:On,trigger:It,register:Hr,handleSubmit:Fn,watch:ti,setValue:Qt,getValues:tr,reset:ss,resetField:bi,clearErrors:Rr,unregister:wi,setError:Sr,setFocus:Qn,getFieldState:Gr};return{...Js,formControl:Js}}function I7(i={}){const t=Ft.useRef(void 0),a=Ft.useRef(void 0),[h,g]=Ft.useState({isDirty:!1,isValidating:!1,isLoading:Gl(i.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:i.errors||{},disabled:i.disabled||!1,isReady:!1,defaultValues:Gl(i.defaultValues)?void 0:i.defaultValues});if(!t.current)if(i.formControl)t.current={...i.formControl,formState:h},i.defaultValues&&!Gl(i.defaultValues)&&i.formControl.reset(i.defaultValues,i.resetOptions);else{const{formControl:E,...o}=E7(i);t.current={...o,formState:h}}const v=t.current.control;return v._options=i,HI(()=>{const E=v._subscribe({formState:v._proxyFormState,callback:()=>g({...v._formState}),reRenderRoot:!0});return g(o=>({...o,isReady:!0})),v._formState.isReady=!0,E},[v]),Ft.useEffect(()=>v._disableForm(i.disabled),[v,i.disabled]),Ft.useEffect(()=>{i.mode&&(v._options.mode=i.mode),i.reValidateMode&&(v._options.reValidateMode=i.reValidateMode)},[v,i.mode,i.reValidateMode]),Ft.useEffect(()=>{i.errors&&(v._setErrors(i.errors),v._focusError())},[v,i.errors]),Ft.useEffect(()=>{i.shouldUnregister&&v._subjects.state.next({values:v._getWatch()})},[v,i.shouldUnregister]),Ft.useEffect(()=>{if(v._proxyFormState.isDirty){const E=v._getDirty();E!==h.isDirty&&v._subjects.state.next({isDirty:E})}},[v,h.isDirty]),Ft.useEffect(()=>{i.values&&!au(i.values,a.current)?(v._reset(i.values,{keepFieldsRef:!0,...v._options.resetOptions}),a.current=i.values,g(E=>({...E}))):v._resetDefaultValues()},[v,i.values]),Ft.useEffect(()=>{v._state.mount||(v._setValid(),v._state.mount=!0),v._state.watch&&(v._state.watch=!1,v._subjects.state.next({...v._formState})),v._removeUnmounted()}),t.current.formState=oB(h,v),t.current}const AO=(i,t,a)=>{if(i&&"reportValidity"in i){const h=Ir(a,t);i.setCustomValidity(h&&h.message||""),i.reportValidity()}},mB=(i,t)=>{for(const a in t.fields){const h=t.fields[a];h&&h.ref&&"reportValidity"in h.ref?AO(h.ref,a,i):h.refs&&h.refs.forEach(g=>AO(g,a,i))}},A7=(i,t)=>{t.shouldUseNativeValidation&&mB(i,t);const a={};for(const h in i){const g=Ir(t.fields,h),v=Object.assign(i[h]||{},{ref:g&&g.ref});if(C7(t.names||Object.keys(i),h)){const E=Object.assign({},Ir(a,h));Ln(E,"root",v),Ln(a,h,E)}else Ln(a,h,v)}return a},C7=(i,t)=>i.some(a=>a.startsWith(t+"."));var P7=function(i,t){for(var a={};i.length;){var h=i[0],g=h.code,v=h.message,E=h.path.join(".");if(!a[E])if("unionErrors"in h){var o=h.unionErrors[0].errors[0];a[E]={message:o.message,type:o.code}}else a[E]={message:v,type:g};if("unionErrors"in h&&h.unionErrors.forEach(function($){return $.errors.forEach(function(Q){return i.push(Q)})}),t){var O=a[E].types,F=O&&O[h.code];a[E]=lB(E,t,a,g,F?[].concat(F,h.message):h.message)}i.shift()}return a},R7=function(i,t,a){return a===void 0&&(a={}),function(h,g,v){try{return Promise.resolve(function(E,o){try{var O=Promise.resolve(i[a.mode==="sync"?"parse":"parseAsync"](h,t)).then(function(F){return v.shouldUseNativeValidation&&mB({},v),{errors:{},values:a.raw?h:F}})}catch(F){return o(F)}return O&&O.then?O.then(void 0,o):O}(0,function(E){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(E))return{values:{},errors:A7(P7(E.errors,!v.shouldUseNativeValidation&&v.criteriaMode==="all"),v)};throw E}))}catch(E){return Promise.reject(E)}}},Tn;(function(i){i.assertEqual=g=>{};function t(g){}i.assertIs=t;function a(g){throw new Error}i.assertNever=a,i.arrayToEnum=g=>{const v={};for(const E of g)v[E]=E;return v},i.getValidEnumValues=g=>{const v=i.objectKeys(g).filter(o=>typeof g[g[o]]!="number"),E={};for(const o of v)E[o]=g[o];return i.objectValues(E)},i.objectValues=g=>i.objectKeys(g).map(function(v){return g[v]}),i.objectKeys=typeof Object.keys=="function"?g=>Object.keys(g):g=>{const v=[];for(const E in g)Object.prototype.hasOwnProperty.call(g,E)&&v.push(E);return v},i.find=(g,v)=>{for(const E of g)if(v(E))return E},i.isInteger=typeof Number.isInteger=="function"?g=>Number.isInteger(g):g=>typeof g=="number"&&Number.isFinite(g)&&Math.floor(g)===g;function h(g,v=" | "){return g.map(E=>typeof E=="string"?`'${E}'`:E).join(v)}i.joinValues=h,i.jsonStringifyReplacer=(g,v)=>typeof v=="bigint"?v.toString():v})(Tn||(Tn={}));var CO;(function(i){i.mergeShapes=(t,a)=>({...t,...a})})(CO||(CO={}));const $r=Tn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),_h=i=>{switch(typeof i){case"undefined":return $r.undefined;case"string":return $r.string;case"number":return Number.isNaN(i)?$r.nan:$r.number;case"boolean":return $r.boolean;case"function":return $r.function;case"bigint":return $r.bigint;case"symbol":return $r.symbol;case"object":return Array.isArray(i)?$r.array:i===null?$r.null:i.then&&typeof i.then=="function"&&i.catch&&typeof i.catch=="function"?$r.promise:typeof Map<"u"&&i instanceof Map?$r.map:typeof Set<"u"&&i instanceof Set?$r.set:typeof Date<"u"&&i instanceof Date?$r.date:$r.object;default:return $r.unknown}},ur=Tn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class _u extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=h=>{this.issues=[...this.issues,h]},this.addIssues=(h=[])=>{this.issues=[...this.issues,...h]};const a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=t}format(t){const a=t||function(v){return v.message},h={_errors:[]},g=v=>{for(const E of v.issues)if(E.code==="invalid_union")E.unionErrors.map(g);else if(E.code==="invalid_return_type")g(E.returnTypeError);else if(E.code==="invalid_arguments")g(E.argumentsError);else if(E.path.length===0)h._errors.push(a(E));else{let o=h,O=0;for(;O<E.path.length;){const F=E.path[O];O===E.path.length-1?(o[F]=o[F]||{_errors:[]},o[F]._errors.push(a(E))):o[F]=o[F]||{_errors:[]},o=o[F],O++}}};return g(this),h}static assert(t){if(!(t instanceof _u))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Tn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=a=>a.message){const a={},h=[];for(const g of this.issues)if(g.path.length>0){const v=g.path[0];a[v]=a[v]||[],a[v].push(t(g))}else h.push(t(g));return{formErrors:h,fieldErrors:a}}get formErrors(){return this.flatten()}}_u.create=i=>new _u(i);const p2=(i,t)=>{let a;switch(i.code){case ur.invalid_type:i.received===$r.undefined?a="Required":a=`Expected ${i.expected}, received ${i.received}`;break;case ur.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(i.expected,Tn.jsonStringifyReplacer)}`;break;case ur.unrecognized_keys:a=`Unrecognized key(s) in object: ${Tn.joinValues(i.keys,", ")}`;break;case ur.invalid_union:a="Invalid input";break;case ur.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${Tn.joinValues(i.options)}`;break;case ur.invalid_enum_value:a=`Invalid enum value. Expected ${Tn.joinValues(i.options)}, received '${i.received}'`;break;case ur.invalid_arguments:a="Invalid function arguments";break;case ur.invalid_return_type:a="Invalid function return type";break;case ur.invalid_date:a="Invalid date";break;case ur.invalid_string:typeof i.validation=="object"?"includes"in i.validation?(a=`Invalid input: must include "${i.validation.includes}"`,typeof i.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${i.validation.position}`)):"startsWith"in i.validation?a=`Invalid input: must start with "${i.validation.startsWith}"`:"endsWith"in i.validation?a=`Invalid input: must end with "${i.validation.endsWith}"`:Tn.assertNever(i.validation):i.validation!=="regex"?a=`Invalid ${i.validation}`:a="Invalid";break;case ur.too_small:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at least":"more than"} ${i.minimum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at least":"over"} ${i.minimum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="bigint"?a=`Number must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${i.minimum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly equal to ":i.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(i.minimum))}`:a="Invalid input";break;case ur.too_big:i.type==="array"?a=`Array must contain ${i.exact?"exactly":i.inclusive?"at most":"less than"} ${i.maximum} element(s)`:i.type==="string"?a=`String must contain ${i.exact?"exactly":i.inclusive?"at most":"under"} ${i.maximum} character(s)`:i.type==="number"?a=`Number must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="bigint"?a=`BigInt must be ${i.exact?"exactly":i.inclusive?"less than or equal to":"less than"} ${i.maximum}`:i.type==="date"?a=`Date must be ${i.exact?"exactly":i.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(i.maximum))}`:a="Invalid input";break;case ur.custom:a="Invalid input";break;case ur.invalid_intersection_types:a="Intersection results could not be merged";break;case ur.not_multiple_of:a=`Number must be a multiple of ${i.multipleOf}`;break;case ur.not_finite:a="Number must be finite";break;default:a=t.defaultError,Tn.assertNever(i)}return{message:a}};let k7=p2;function M7(){return k7}const O7=i=>{const{data:t,path:a,errorMaps:h,issueData:g}=i,v=[...a,...g.path||[]],E={...g,path:v};if(g.message!==void 0)return{...g,path:v,message:g.message};let o="";const O=h.filter(F=>!!F).slice().reverse();for(const F of O)o=F(E,{data:t,defaultError:o}).message;return{...g,path:v,message:o}};function Or(i,t){const a=M7(),h=O7({issueData:t,data:i.data,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,a,a===p2?void 0:p2].filter(g=>!!g)});i.common.issues.push(h)}class Za{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,a){const h=[];for(const g of a){if(g.status==="aborted")return Oi;g.status==="dirty"&&t.dirty(),h.push(g.value)}return{status:t.value,value:h}}static async mergeObjectAsync(t,a){const h=[];for(const g of a){const v=await g.key,E=await g.value;h.push({key:v,value:E})}return Za.mergeObjectSync(t,h)}static mergeObjectSync(t,a){const h={};for(const g of a){const{key:v,value:E}=g;if(v.status==="aborted"||E.status==="aborted")return Oi;v.status==="dirty"&&t.dirty(),E.status==="dirty"&&t.dirty(),v.value!=="__proto__"&&(typeof E.value<"u"||g.alwaysSet)&&(h[v.value]=E.value)}return{status:t.value,value:h}}}const Oi=Object.freeze({status:"aborted"}),Cy=i=>({status:"dirty",value:i}),dl=i=>({status:"valid",value:i}),PO=i=>i.status==="aborted",RO=i=>i.status==="dirty",Xm=i=>i.status==="valid",uw=i=>typeof Promise<"u"&&i instanceof Promise;var qr;(function(i){i.errToObj=t=>typeof t=="string"?{message:t}:t||{},i.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(qr||(qr={}));class Hh{constructor(t,a,h,g){this._cachedPath=[],this.parent=t,this.data=a,this._path=h,this._key=g}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const kO=(i,t)=>{if(Xm(t))return{success:!0,data:t.value};if(!i.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const a=new _u(i.common.issues);return this._error=a,this._error}}};function Ji(i){if(!i)return{};const{errorMap:t,invalid_type_error:a,required_error:h,description:g}=i;if(t&&(a||h))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:g}:{errorMap:(E,o)=>{const{message:O}=i;return E.code==="invalid_enum_value"?{message:O??o.defaultError}:typeof o.data>"u"?{message:O??h??o.defaultError}:E.code!=="invalid_type"?{message:o.defaultError}:{message:O??a??o.defaultError}},description:g}}class vn{get description(){return this._def.description}_getType(t){return _h(t.data)}_getOrReturnCtx(t,a){return a||{common:t.parent.common,data:t.data,parsedType:_h(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new Za,ctx:{common:t.parent.common,data:t.data,parsedType:_h(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const a=this._parse(t);if(uw(a))throw new Error("Synchronous parse encountered promise.");return a}_parseAsync(t){const a=this._parse(t);return Promise.resolve(a)}parse(t,a){const h=this.safeParse(t,a);if(h.success)return h.data;throw h.error}safeParse(t,a){const h={common:{issues:[],async:(a==null?void 0:a.async)??!1,contextualErrorMap:a==null?void 0:a.errorMap},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_h(t)},g=this._parseSync({data:t,path:h.path,parent:h});return kO(h,g)}"~validate"(t){var h,g;const a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_h(t)};if(!this["~standard"].async)try{const v=this._parseSync({data:t,path:[],parent:a});return Xm(v)?{value:v.value}:{issues:a.common.issues}}catch(v){(g=(h=v==null?void 0:v.message)==null?void 0:h.toLowerCase())!=null&&g.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:a}).then(v=>Xm(v)?{value:v.value}:{issues:a.common.issues})}async parseAsync(t,a){const h=await this.safeParseAsync(t,a);if(h.success)return h.data;throw h.error}async safeParseAsync(t,a){const h={common:{issues:[],contextualErrorMap:a==null?void 0:a.errorMap,async:!0},path:(a==null?void 0:a.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:_h(t)},g=this._parse({data:t,path:h.path,parent:h}),v=await(uw(g)?g:Promise.resolve(g));return kO(h,v)}refine(t,a){const h=g=>typeof a=="string"||typeof a>"u"?{message:a}:typeof a=="function"?a(g):a;return this._refinement((g,v)=>{const E=t(g),o=()=>v.addIssue({code:ur.custom,...h(g)});return typeof Promise<"u"&&E instanceof Promise?E.then(O=>O?!0:(o(),!1)):E?!0:(o(),!1)})}refinement(t,a){return this._refinement((h,g)=>t(h)?!0:(g.addIssue(typeof a=="function"?a(h,g):a),!1))}_refinement(t){return new Ym({schema:this,typeName:Di.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return Bh.create(this,this._def)}nullable(){return Jm.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ac.create(this)}promise(){return pw.create(this,this._def)}or(t){return dw.create([this,t],this._def)}and(t){return fw.create(this,t,this._def)}transform(t){return new Ym({...Ji(this._def),schema:this,typeName:Di.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const a=typeof t=="function"?t:()=>t;return new g2({...Ji(this._def),innerType:this,defaultValue:a,typeName:Di.ZodDefault})}brand(){return new rZ({typeName:Di.ZodBranded,type:this,...Ji(this._def)})}catch(t){const a=typeof t=="function"?t:()=>t;return new _2({...Ji(this._def),innerType:this,catchValue:a,typeName:Di.ZodCatch})}describe(t){const a=this.constructor;return new a({...this._def,description:t})}pipe(t){return ZI.create(this,t)}readonly(){return y2.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const D7=/^c[^\s-]{8,}$/i,L7=/^[0-9a-z]+$/,z7=/^[0-9A-HJKMNP-TV-Z]{26}$/i,F7=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,B7=/^[a-z0-9_-]{21}$/i,N7=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,j7=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,V7=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,U7="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let $S;const $7=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,G7=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,H7=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,q7=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,W7=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Z7=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gB="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",X7=new RegExp(`^${gB}$`);function _B(i){let t="[0-5]\\d";i.precision?t=`${t}\\.\\d{${i.precision}}`:i.precision==null&&(t=`${t}(\\.\\d+)?`);const a=i.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${a}`}function K7(i){return new RegExp(`^${_B(i)}$`)}function Y7(i){let t=`${gB}T${_B(i)}`;const a=[];return a.push(i.local?"Z?":"Z"),i.offset&&a.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${a.join("|")})`,new RegExp(`^${t}$`)}function J7(i,t){return!!((t==="v4"||!t)&&$7.test(i)||(t==="v6"||!t)&&H7.test(i))}function Q7(i,t){if(!N7.test(i))return!1;try{const[a]=i.split(".");if(!a)return!1;const h=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),g=JSON.parse(atob(h));return!(typeof g!="object"||g===null||"typ"in g&&(g==null?void 0:g.typ)!=="JWT"||!g.alg||t&&g.alg!==t)}catch{return!1}}function eZ(i,t){return!!((t==="v4"||!t)&&G7.test(i)||(t==="v6"||!t)&&q7.test(i))}class Ph extends vn{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==$r.string){const v=this._getOrReturnCtx(t);return Or(v,{code:ur.invalid_type,expected:$r.string,received:v.parsedType}),Oi}const h=new Za;let g;for(const v of this._def.checks)if(v.kind==="min")t.data.length<v.value&&(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),h.dirty());else if(v.kind==="max")t.data.length>v.value&&(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!1,message:v.message}),h.dirty());else if(v.kind==="length"){const E=t.data.length>v.value,o=t.data.length<v.value;(E||o)&&(g=this._getOrReturnCtx(t,g),E?Or(g,{code:ur.too_big,maximum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}):o&&Or(g,{code:ur.too_small,minimum:v.value,type:"string",inclusive:!0,exact:!0,message:v.message}),h.dirty())}else if(v.kind==="email")V7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"email",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="emoji")$S||($S=new RegExp(U7,"u")),$S.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"emoji",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="uuid")F7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"uuid",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="nanoid")B7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"nanoid",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="cuid")D7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"cuid",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="cuid2")L7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"cuid2",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="ulid")z7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"ulid",code:ur.invalid_string,message:v.message}),h.dirty());else if(v.kind==="url")try{new URL(t.data)}catch{g=this._getOrReturnCtx(t,g),Or(g,{validation:"url",code:ur.invalid_string,message:v.message}),h.dirty()}else v.kind==="regex"?(v.regex.lastIndex=0,v.regex.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"regex",code:ur.invalid_string,message:v.message}),h.dirty())):v.kind==="trim"?t.data=t.data.trim():v.kind==="includes"?t.data.includes(v.value,v.position)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:{includes:v.value,position:v.position},message:v.message}),h.dirty()):v.kind==="toLowerCase"?t.data=t.data.toLowerCase():v.kind==="toUpperCase"?t.data=t.data.toUpperCase():v.kind==="startsWith"?t.data.startsWith(v.value)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:{startsWith:v.value},message:v.message}),h.dirty()):v.kind==="endsWith"?t.data.endsWith(v.value)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:{endsWith:v.value},message:v.message}),h.dirty()):v.kind==="datetime"?Y7(v).test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:"datetime",message:v.message}),h.dirty()):v.kind==="date"?X7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:"date",message:v.message}),h.dirty()):v.kind==="time"?K7(v).test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.invalid_string,validation:"time",message:v.message}),h.dirty()):v.kind==="duration"?j7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"duration",code:ur.invalid_string,message:v.message}),h.dirty()):v.kind==="ip"?J7(t.data,v.version)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"ip",code:ur.invalid_string,message:v.message}),h.dirty()):v.kind==="jwt"?Q7(t.data,v.alg)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"jwt",code:ur.invalid_string,message:v.message}),h.dirty()):v.kind==="cidr"?eZ(t.data,v.version)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"cidr",code:ur.invalid_string,message:v.message}),h.dirty()):v.kind==="base64"?W7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"base64",code:ur.invalid_string,message:v.message}),h.dirty()):v.kind==="base64url"?Z7.test(t.data)||(g=this._getOrReturnCtx(t,g),Or(g,{validation:"base64url",code:ur.invalid_string,message:v.message}),h.dirty()):Tn.assertNever(v);return{status:h.value,value:t.data}}_regex(t,a,h){return this.refinement(g=>t.test(g),{validation:a,code:ur.invalid_string,...qr.errToObj(h)})}_addCheck(t){return new Ph({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...qr.errToObj(t)})}url(t){return this._addCheck({kind:"url",...qr.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...qr.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...qr.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...qr.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...qr.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...qr.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...qr.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...qr.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...qr.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...qr.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...qr.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...qr.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...qr.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...qr.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...qr.errToObj(t)})}regex(t,a){return this._addCheck({kind:"regex",regex:t,...qr.errToObj(a)})}includes(t,a){return this._addCheck({kind:"includes",value:t,position:a==null?void 0:a.position,...qr.errToObj(a==null?void 0:a.message)})}startsWith(t,a){return this._addCheck({kind:"startsWith",value:t,...qr.errToObj(a)})}endsWith(t,a){return this._addCheck({kind:"endsWith",value:t,...qr.errToObj(a)})}min(t,a){return this._addCheck({kind:"min",value:t,...qr.errToObj(a)})}max(t,a){return this._addCheck({kind:"max",value:t,...qr.errToObj(a)})}length(t,a){return this._addCheck({kind:"length",value:t,...qr.errToObj(a)})}nonempty(t){return this.min(1,qr.errToObj(t))}trim(){return new Ph({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ph({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ph({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxLength(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}}Ph.create=i=>new Ph({checks:[],typeName:Di.ZodString,coerce:(i==null?void 0:i.coerce)??!1,...Ji(i)});function tZ(i,t){const a=(i.toString().split(".")[1]||"").length,h=(t.toString().split(".")[1]||"").length,g=a>h?a:h,v=Number.parseInt(i.toFixed(g).replace(".","")),E=Number.parseInt(t.toFixed(g).replace(".",""));return v%E/10**g}class p0 extends vn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==$r.number){const v=this._getOrReturnCtx(t);return Or(v,{code:ur.invalid_type,expected:$r.number,received:v.parsedType}),Oi}let h;const g=new Za;for(const v of this._def.checks)v.kind==="int"?Tn.isInteger(t.data)||(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.invalid_type,expected:"integer",received:"float",message:v.message}),g.dirty()):v.kind==="min"?(v.inclusive?t.data<v.value:t.data<=v.value)&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.too_small,minimum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),g.dirty()):v.kind==="max"?(v.inclusive?t.data>v.value:t.data>=v.value)&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.too_big,maximum:v.value,type:"number",inclusive:v.inclusive,exact:!1,message:v.message}),g.dirty()):v.kind==="multipleOf"?tZ(t.data,v.value)!==0&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.not_multiple_of,multipleOf:v.value,message:v.message}),g.dirty()):v.kind==="finite"?Number.isFinite(t.data)||(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.not_finite,message:v.message}),g.dirty()):Tn.assertNever(v);return{status:g.value,value:t.data}}gte(t,a){return this.setLimit("min",t,!0,qr.toString(a))}gt(t,a){return this.setLimit("min",t,!1,qr.toString(a))}lte(t,a){return this.setLimit("max",t,!0,qr.toString(a))}lt(t,a){return this.setLimit("max",t,!1,qr.toString(a))}setLimit(t,a,h,g){return new p0({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:h,message:qr.toString(g)}]})}_addCheck(t){return new p0({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:qr.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:qr.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:qr.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:qr.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:qr.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:qr.toString(a)})}finite(t){return this._addCheck({kind:"finite",message:qr.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:qr.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:qr.toString(t)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&Tn.isInteger(t.value))}get isFinite(){let t=null,a=null;for(const h of this._def.checks){if(h.kind==="finite"||h.kind==="int"||h.kind==="multipleOf")return!0;h.kind==="min"?(a===null||h.value>a)&&(a=h.value):h.kind==="max"&&(t===null||h.value<t)&&(t=h.value)}return Number.isFinite(a)&&Number.isFinite(t)}}p0.create=i=>new p0({checks:[],typeName:Di.ZodNumber,coerce:(i==null?void 0:i.coerce)||!1,...Ji(i)});class m0 extends vn{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==$r.bigint)return this._getInvalidInput(t);let h;const g=new Za;for(const v of this._def.checks)v.kind==="min"?(v.inclusive?t.data<v.value:t.data<=v.value)&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.too_small,type:"bigint",minimum:v.value,inclusive:v.inclusive,message:v.message}),g.dirty()):v.kind==="max"?(v.inclusive?t.data>v.value:t.data>=v.value)&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.too_big,type:"bigint",maximum:v.value,inclusive:v.inclusive,message:v.message}),g.dirty()):v.kind==="multipleOf"?t.data%v.value!==BigInt(0)&&(h=this._getOrReturnCtx(t,h),Or(h,{code:ur.not_multiple_of,multipleOf:v.value,message:v.message}),g.dirty()):Tn.assertNever(v);return{status:g.value,value:t.data}}_getInvalidInput(t){const a=this._getOrReturnCtx(t);return Or(a,{code:ur.invalid_type,expected:$r.bigint,received:a.parsedType}),Oi}gte(t,a){return this.setLimit("min",t,!0,qr.toString(a))}gt(t,a){return this.setLimit("min",t,!1,qr.toString(a))}lte(t,a){return this.setLimit("max",t,!0,qr.toString(a))}lt(t,a){return this.setLimit("max",t,!1,qr.toString(a))}setLimit(t,a,h,g){return new m0({...this._def,checks:[...this._def.checks,{kind:t,value:a,inclusive:h,message:qr.toString(g)}]})}_addCheck(t){return new m0({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:qr.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:qr.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:qr.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:qr.toString(t)})}multipleOf(t,a){return this._addCheck({kind:"multipleOf",value:t,message:qr.toString(a)})}get minValue(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t}get maxValue(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t}}m0.create=i=>new m0({checks:[],typeName:Di.ZodBigInt,coerce:(i==null?void 0:i.coerce)??!1,...Ji(i)});class MO extends vn{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==$r.boolean){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.boolean,received:h.parsedType}),Oi}return dl(t.data)}}MO.create=i=>new MO({typeName:Di.ZodBoolean,coerce:(i==null?void 0:i.coerce)||!1,...Ji(i)});class hw extends vn{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==$r.date){const v=this._getOrReturnCtx(t);return Or(v,{code:ur.invalid_type,expected:$r.date,received:v.parsedType}),Oi}if(Number.isNaN(t.data.getTime())){const v=this._getOrReturnCtx(t);return Or(v,{code:ur.invalid_date}),Oi}const h=new Za;let g;for(const v of this._def.checks)v.kind==="min"?t.data.getTime()<v.value&&(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.too_small,message:v.message,inclusive:!0,exact:!1,minimum:v.value,type:"date"}),h.dirty()):v.kind==="max"?t.data.getTime()>v.value&&(g=this._getOrReturnCtx(t,g),Or(g,{code:ur.too_big,message:v.message,inclusive:!0,exact:!1,maximum:v.value,type:"date"}),h.dirty()):Tn.assertNever(v);return{status:h.value,value:new Date(t.data.getTime())}}_addCheck(t){return new hw({...this._def,checks:[...this._def.checks,t]})}min(t,a){return this._addCheck({kind:"min",value:t.getTime(),message:qr.toString(a)})}max(t,a){return this._addCheck({kind:"max",value:t.getTime(),message:qr.toString(a)})}get minDate(){let t=null;for(const a of this._def.checks)a.kind==="min"&&(t===null||a.value>t)&&(t=a.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const a of this._def.checks)a.kind==="max"&&(t===null||a.value<t)&&(t=a.value);return t!=null?new Date(t):null}}hw.create=i=>new hw({checks:[],coerce:(i==null?void 0:i.coerce)||!1,typeName:Di.ZodDate,...Ji(i)});class OO extends vn{_parse(t){if(this._getType(t)!==$r.symbol){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.symbol,received:h.parsedType}),Oi}return dl(t.data)}}OO.create=i=>new OO({typeName:Di.ZodSymbol,...Ji(i)});class DO extends vn{_parse(t){if(this._getType(t)!==$r.undefined){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.undefined,received:h.parsedType}),Oi}return dl(t.data)}}DO.create=i=>new DO({typeName:Di.ZodUndefined,...Ji(i)});class LO extends vn{_parse(t){if(this._getType(t)!==$r.null){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.null,received:h.parsedType}),Oi}return dl(t.data)}}LO.create=i=>new LO({typeName:Di.ZodNull,...Ji(i)});class zO extends vn{constructor(){super(...arguments),this._any=!0}_parse(t){return dl(t.data)}}zO.create=i=>new zO({typeName:Di.ZodAny,...Ji(i)});class FO extends vn{constructor(){super(...arguments),this._unknown=!0}_parse(t){return dl(t.data)}}FO.create=i=>new FO({typeName:Di.ZodUnknown,...Ji(i)});class qh extends vn{_parse(t){const a=this._getOrReturnCtx(t);return Or(a,{code:ur.invalid_type,expected:$r.never,received:a.parsedType}),Oi}}qh.create=i=>new qh({typeName:Di.ZodNever,...Ji(i)});class BO extends vn{_parse(t){if(this._getType(t)!==$r.undefined){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.void,received:h.parsedType}),Oi}return dl(t.data)}}BO.create=i=>new BO({typeName:Di.ZodVoid,...Ji(i)});class Ac extends vn{_parse(t){const{ctx:a,status:h}=this._processInputParams(t),g=this._def;if(a.parsedType!==$r.array)return Or(a,{code:ur.invalid_type,expected:$r.array,received:a.parsedType}),Oi;if(g.exactLength!==null){const E=a.data.length>g.exactLength.value,o=a.data.length<g.exactLength.value;(E||o)&&(Or(a,{code:E?ur.too_big:ur.too_small,minimum:o?g.exactLength.value:void 0,maximum:E?g.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:g.exactLength.message}),h.dirty())}if(g.minLength!==null&&a.data.length<g.minLength.value&&(Or(a,{code:ur.too_small,minimum:g.minLength.value,type:"array",inclusive:!0,exact:!1,message:g.minLength.message}),h.dirty()),g.maxLength!==null&&a.data.length>g.maxLength.value&&(Or(a,{code:ur.too_big,maximum:g.maxLength.value,type:"array",inclusive:!0,exact:!1,message:g.maxLength.message}),h.dirty()),a.common.async)return Promise.all([...a.data].map((E,o)=>g.type._parseAsync(new Hh(a,E,a.path,o)))).then(E=>Za.mergeArray(h,E));const v=[...a.data].map((E,o)=>g.type._parseSync(new Hh(a,E,a.path,o)));return Za.mergeArray(h,v)}get element(){return this._def.type}min(t,a){return new Ac({...this._def,minLength:{value:t,message:qr.toString(a)}})}max(t,a){return new Ac({...this._def,maxLength:{value:t,message:qr.toString(a)}})}length(t,a){return new Ac({...this._def,exactLength:{value:t,message:qr.toString(a)}})}nonempty(t){return this.min(1,t)}}Ac.create=(i,t)=>new Ac({type:i,minLength:null,maxLength:null,exactLength:null,typeName:Di.ZodArray,...Ji(t)});function lm(i){if(i instanceof bs){const t={};for(const a in i.shape){const h=i.shape[a];t[a]=Bh.create(lm(h))}return new bs({...i._def,shape:()=>t})}else return i instanceof Ac?new Ac({...i._def,type:lm(i.element)}):i instanceof Bh?Bh.create(lm(i.unwrap())):i instanceof Jm?Jm.create(lm(i.unwrap())):i instanceof Tf?Tf.create(i.items.map(t=>lm(t))):i}class bs extends vn{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),a=Tn.objectKeys(t);return this._cached={shape:t,keys:a},this._cached}_parse(t){if(this._getType(t)!==$r.object){const F=this._getOrReturnCtx(t);return Or(F,{code:ur.invalid_type,expected:$r.object,received:F.parsedType}),Oi}const{status:h,ctx:g}=this._processInputParams(t),{shape:v,keys:E}=this._getCached(),o=[];if(!(this._def.catchall instanceof qh&&this._def.unknownKeys==="strip"))for(const F in g.data)E.includes(F)||o.push(F);const O=[];for(const F of E){const $=v[F],Q=g.data[F];O.push({key:{status:"valid",value:F},value:$._parse(new Hh(g,Q,g.path,F)),alwaysSet:F in g.data})}if(this._def.catchall instanceof qh){const F=this._def.unknownKeys;if(F==="passthrough")for(const $ of o)O.push({key:{status:"valid",value:$},value:{status:"valid",value:g.data[$]}});else if(F==="strict")o.length>0&&(Or(g,{code:ur.unrecognized_keys,keys:o}),h.dirty());else if(F!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const F=this._def.catchall;for(const $ of o){const Q=g.data[$];O.push({key:{status:"valid",value:$},value:F._parse(new Hh(g,Q,g.path,$)),alwaysSet:$ in g.data})}}return g.common.async?Promise.resolve().then(async()=>{const F=[];for(const $ of O){const Q=await $.key,te=await $.value;F.push({key:Q,value:te,alwaysSet:$.alwaysSet})}return F}).then(F=>Za.mergeObjectSync(h,F)):Za.mergeObjectSync(h,O)}get shape(){return this._def.shape()}strict(t){return qr.errToObj,new bs({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(a,h)=>{var v,E;const g=((E=(v=this._def).errorMap)==null?void 0:E.call(v,a,h).message)??h.defaultError;return a.code==="unrecognized_keys"?{message:qr.errToObj(t).message??g}:{message:g}}}:{}})}strip(){return new bs({...this._def,unknownKeys:"strip"})}passthrough(){return new bs({...this._def,unknownKeys:"passthrough"})}extend(t){return new bs({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new bs({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:Di.ZodObject})}setKey(t,a){return this.augment({[t]:a})}catchall(t){return new bs({...this._def,catchall:t})}pick(t){const a={};for(const h of Tn.objectKeys(t))t[h]&&this.shape[h]&&(a[h]=this.shape[h]);return new bs({...this._def,shape:()=>a})}omit(t){const a={};for(const h of Tn.objectKeys(this.shape))t[h]||(a[h]=this.shape[h]);return new bs({...this._def,shape:()=>a})}deepPartial(){return lm(this)}partial(t){const a={};for(const h of Tn.objectKeys(this.shape)){const g=this.shape[h];t&&!t[h]?a[h]=g:a[h]=g.optional()}return new bs({...this._def,shape:()=>a})}required(t){const a={};for(const h of Tn.objectKeys(this.shape))if(t&&!t[h])a[h]=this.shape[h];else{let v=this.shape[h];for(;v instanceof Bh;)v=v._def.innerType;a[h]=v}return new bs({...this._def,shape:()=>a})}keyof(){return yB(Tn.objectKeys(this.shape))}}bs.create=(i,t)=>new bs({shape:()=>i,unknownKeys:"strip",catchall:qh.create(),typeName:Di.ZodObject,...Ji(t)});bs.strictCreate=(i,t)=>new bs({shape:()=>i,unknownKeys:"strict",catchall:qh.create(),typeName:Di.ZodObject,...Ji(t)});bs.lazycreate=(i,t)=>new bs({shape:i,unknownKeys:"strip",catchall:qh.create(),typeName:Di.ZodObject,...Ji(t)});class dw extends vn{_parse(t){const{ctx:a}=this._processInputParams(t),h=this._def.options;function g(v){for(const o of v)if(o.result.status==="valid")return o.result;for(const o of v)if(o.result.status==="dirty")return a.common.issues.push(...o.ctx.common.issues),o.result;const E=v.map(o=>new _u(o.ctx.common.issues));return Or(a,{code:ur.invalid_union,unionErrors:E}),Oi}if(a.common.async)return Promise.all(h.map(async v=>{const E={...a,common:{...a.common,issues:[]},parent:null};return{result:await v._parseAsync({data:a.data,path:a.path,parent:E}),ctx:E}})).then(g);{let v;const E=[];for(const O of h){const F={...a,common:{...a.common,issues:[]},parent:null},$=O._parseSync({data:a.data,path:a.path,parent:F});if($.status==="valid")return $;$.status==="dirty"&&!v&&(v={result:$,ctx:F}),F.common.issues.length&&E.push(F.common.issues)}if(v)return a.common.issues.push(...v.ctx.common.issues),v.result;const o=E.map(O=>new _u(O));return Or(a,{code:ur.invalid_union,unionErrors:o}),Oi}}get options(){return this._def.options}}dw.create=(i,t)=>new dw({options:i,typeName:Di.ZodUnion,...Ji(t)});function m2(i,t){const a=_h(i),h=_h(t);if(i===t)return{valid:!0,data:i};if(a===$r.object&&h===$r.object){const g=Tn.objectKeys(t),v=Tn.objectKeys(i).filter(o=>g.indexOf(o)!==-1),E={...i,...t};for(const o of v){const O=m2(i[o],t[o]);if(!O.valid)return{valid:!1};E[o]=O.data}return{valid:!0,data:E}}else if(a===$r.array&&h===$r.array){if(i.length!==t.length)return{valid:!1};const g=[];for(let v=0;v<i.length;v++){const E=i[v],o=t[v],O=m2(E,o);if(!O.valid)return{valid:!1};g.push(O.data)}return{valid:!0,data:g}}else return a===$r.date&&h===$r.date&&+i==+t?{valid:!0,data:i}:{valid:!1}}class fw extends vn{_parse(t){const{status:a,ctx:h}=this._processInputParams(t),g=(v,E)=>{if(PO(v)||PO(E))return Oi;const o=m2(v.value,E.value);return o.valid?((RO(v)||RO(E))&&a.dirty(),{status:a.value,value:o.data}):(Or(h,{code:ur.invalid_intersection_types}),Oi)};return h.common.async?Promise.all([this._def.left._parseAsync({data:h.data,path:h.path,parent:h}),this._def.right._parseAsync({data:h.data,path:h.path,parent:h})]).then(([v,E])=>g(v,E)):g(this._def.left._parseSync({data:h.data,path:h.path,parent:h}),this._def.right._parseSync({data:h.data,path:h.path,parent:h}))}}fw.create=(i,t,a)=>new fw({left:i,right:t,typeName:Di.ZodIntersection,...Ji(a)});class Tf extends vn{_parse(t){const{status:a,ctx:h}=this._processInputParams(t);if(h.parsedType!==$r.array)return Or(h,{code:ur.invalid_type,expected:$r.array,received:h.parsedType}),Oi;if(h.data.length<this._def.items.length)return Or(h,{code:ur.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Oi;!this._def.rest&&h.data.length>this._def.items.length&&(Or(h,{code:ur.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());const v=[...h.data].map((E,o)=>{const O=this._def.items[o]||this._def.rest;return O?O._parse(new Hh(h,E,h.path,o)):null}).filter(E=>!!E);return h.common.async?Promise.all(v).then(E=>Za.mergeArray(a,E)):Za.mergeArray(a,v)}get items(){return this._def.items}rest(t){return new Tf({...this._def,rest:t})}}Tf.create=(i,t)=>{if(!Array.isArray(i))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Tf({items:i,typeName:Di.ZodTuple,rest:null,...Ji(t)})};class NO extends vn{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:a,ctx:h}=this._processInputParams(t);if(h.parsedType!==$r.map)return Or(h,{code:ur.invalid_type,expected:$r.map,received:h.parsedType}),Oi;const g=this._def.keyType,v=this._def.valueType,E=[...h.data.entries()].map(([o,O],F)=>({key:g._parse(new Hh(h,o,h.path,[F,"key"])),value:v._parse(new Hh(h,O,h.path,[F,"value"]))}));if(h.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const O of E){const F=await O.key,$=await O.value;if(F.status==="aborted"||$.status==="aborted")return Oi;(F.status==="dirty"||$.status==="dirty")&&a.dirty(),o.set(F.value,$.value)}return{status:a.value,value:o}})}else{const o=new Map;for(const O of E){const F=O.key,$=O.value;if(F.status==="aborted"||$.status==="aborted")return Oi;(F.status==="dirty"||$.status==="dirty")&&a.dirty(),o.set(F.value,$.value)}return{status:a.value,value:o}}}}NO.create=(i,t,a)=>new NO({valueType:t,keyType:i,typeName:Di.ZodMap,...Ji(a)});class g0 extends vn{_parse(t){const{status:a,ctx:h}=this._processInputParams(t);if(h.parsedType!==$r.set)return Or(h,{code:ur.invalid_type,expected:$r.set,received:h.parsedType}),Oi;const g=this._def;g.minSize!==null&&h.data.size<g.minSize.value&&(Or(h,{code:ur.too_small,minimum:g.minSize.value,type:"set",inclusive:!0,exact:!1,message:g.minSize.message}),a.dirty()),g.maxSize!==null&&h.data.size>g.maxSize.value&&(Or(h,{code:ur.too_big,maximum:g.maxSize.value,type:"set",inclusive:!0,exact:!1,message:g.maxSize.message}),a.dirty());const v=this._def.valueType;function E(O){const F=new Set;for(const $ of O){if($.status==="aborted")return Oi;$.status==="dirty"&&a.dirty(),F.add($.value)}return{status:a.value,value:F}}const o=[...h.data.values()].map((O,F)=>v._parse(new Hh(h,O,h.path,F)));return h.common.async?Promise.all(o).then(O=>E(O)):E(o)}min(t,a){return new g0({...this._def,minSize:{value:t,message:qr.toString(a)}})}max(t,a){return new g0({...this._def,maxSize:{value:t,message:qr.toString(a)}})}size(t,a){return this.min(t,a).max(t,a)}nonempty(t){return this.min(1,t)}}g0.create=(i,t)=>new g0({valueType:i,minSize:null,maxSize:null,typeName:Di.ZodSet,...Ji(t)});class jO extends vn{get schema(){return this._def.getter()}_parse(t){const{ctx:a}=this._processInputParams(t);return this._def.getter()._parse({data:a.data,path:a.path,parent:a})}}jO.create=(i,t)=>new jO({getter:i,typeName:Di.ZodLazy,...Ji(t)});class VO extends vn{_parse(t){if(t.data!==this._def.value){const a=this._getOrReturnCtx(t);return Or(a,{received:a.data,code:ur.invalid_literal,expected:this._def.value}),Oi}return{status:"valid",value:t.data}}get value(){return this._def.value}}VO.create=(i,t)=>new VO({value:i,typeName:Di.ZodLiteral,...Ji(t)});function yB(i,t){return new Km({values:i,typeName:Di.ZodEnum,...Ji(t)})}class Km extends vn{_parse(t){if(typeof t.data!="string"){const a=this._getOrReturnCtx(t),h=this._def.values;return Or(a,{expected:Tn.joinValues(h),received:a.parsedType,code:ur.invalid_type}),Oi}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const a=this._getOrReturnCtx(t),h=this._def.values;return Or(a,{received:a.data,code:ur.invalid_enum_value,options:h}),Oi}return dl(t.data)}get options(){return this._def.values}get enum(){const t={};for(const a of this._def.values)t[a]=a;return t}get Values(){const t={};for(const a of this._def.values)t[a]=a;return t}get Enum(){const t={};for(const a of this._def.values)t[a]=a;return t}extract(t,a=this._def){return Km.create(t,{...this._def,...a})}exclude(t,a=this._def){return Km.create(this.options.filter(h=>!t.includes(h)),{...this._def,...a})}}Km.create=yB;class UO extends vn{_parse(t){const a=Tn.getValidEnumValues(this._def.values),h=this._getOrReturnCtx(t);if(h.parsedType!==$r.string&&h.parsedType!==$r.number){const g=Tn.objectValues(a);return Or(h,{expected:Tn.joinValues(g),received:h.parsedType,code:ur.invalid_type}),Oi}if(this._cache||(this._cache=new Set(Tn.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const g=Tn.objectValues(a);return Or(h,{received:h.data,code:ur.invalid_enum_value,options:g}),Oi}return dl(t.data)}get enum(){return this._def.values}}UO.create=(i,t)=>new UO({values:i,typeName:Di.ZodNativeEnum,...Ji(t)});class pw extends vn{unwrap(){return this._def.type}_parse(t){const{ctx:a}=this._processInputParams(t);if(a.parsedType!==$r.promise&&a.common.async===!1)return Or(a,{code:ur.invalid_type,expected:$r.promise,received:a.parsedType}),Oi;const h=a.parsedType===$r.promise?a.data:Promise.resolve(a.data);return dl(h.then(g=>this._def.type.parseAsync(g,{path:a.path,errorMap:a.common.contextualErrorMap})))}}pw.create=(i,t)=>new pw({type:i,typeName:Di.ZodPromise,...Ji(t)});class Ym extends vn{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Di.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:a,ctx:h}=this._processInputParams(t),g=this._def.effect||null,v={addIssue:E=>{Or(h,E),E.fatal?a.abort():a.dirty()},get path(){return h.path}};if(v.addIssue=v.addIssue.bind(v),g.type==="preprocess"){const E=g.transform(h.data,v);if(h.common.async)return Promise.resolve(E).then(async o=>{if(a.value==="aborted")return Oi;const O=await this._def.schema._parseAsync({data:o,path:h.path,parent:h});return O.status==="aborted"?Oi:O.status==="dirty"||a.value==="dirty"?Cy(O.value):O});{if(a.value==="aborted")return Oi;const o=this._def.schema._parseSync({data:E,path:h.path,parent:h});return o.status==="aborted"?Oi:o.status==="dirty"||a.value==="dirty"?Cy(o.value):o}}if(g.type==="refinement"){const E=o=>{const O=g.refinement(o,v);if(h.common.async)return Promise.resolve(O);if(O instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(h.common.async===!1){const o=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});return o.status==="aborted"?Oi:(o.status==="dirty"&&a.dirty(),E(o.value),{status:a.value,value:o.value})}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(o=>o.status==="aborted"?Oi:(o.status==="dirty"&&a.dirty(),E(o.value).then(()=>({status:a.value,value:o.value}))))}if(g.type==="transform")if(h.common.async===!1){const E=this._def.schema._parseSync({data:h.data,path:h.path,parent:h});if(!Xm(E))return Oi;const o=g.transform(E.value,v);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:a.value,value:o}}else return this._def.schema._parseAsync({data:h.data,path:h.path,parent:h}).then(E=>Xm(E)?Promise.resolve(g.transform(E.value,v)).then(o=>({status:a.value,value:o})):Oi);Tn.assertNever(g)}}Ym.create=(i,t,a)=>new Ym({schema:i,typeName:Di.ZodEffects,effect:t,...Ji(a)});Ym.createWithPreprocess=(i,t,a)=>new Ym({schema:t,effect:{type:"preprocess",transform:i},typeName:Di.ZodEffects,...Ji(a)});class Bh extends vn{_parse(t){return this._getType(t)===$r.undefined?dl(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Bh.create=(i,t)=>new Bh({innerType:i,typeName:Di.ZodOptional,...Ji(t)});class Jm extends vn{_parse(t){return this._getType(t)===$r.null?dl(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}Jm.create=(i,t)=>new Jm({innerType:i,typeName:Di.ZodNullable,...Ji(t)});class g2 extends vn{_parse(t){const{ctx:a}=this._processInputParams(t);let h=a.data;return a.parsedType===$r.undefined&&(h=this._def.defaultValue()),this._def.innerType._parse({data:h,path:a.path,parent:a})}removeDefault(){return this._def.innerType}}g2.create=(i,t)=>new g2({innerType:i,typeName:Di.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...Ji(t)});class _2 extends vn{_parse(t){const{ctx:a}=this._processInputParams(t),h={...a,common:{...a.common,issues:[]}},g=this._def.innerType._parse({data:h.data,path:h.path,parent:{...h}});return uw(g)?g.then(v=>({status:"valid",value:v.status==="valid"?v.value:this._def.catchValue({get error(){return new _u(h.common.issues)},input:h.data})})):{status:"valid",value:g.status==="valid"?g.value:this._def.catchValue({get error(){return new _u(h.common.issues)},input:h.data})}}removeCatch(){return this._def.innerType}}_2.create=(i,t)=>new _2({innerType:i,typeName:Di.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...Ji(t)});class $O extends vn{_parse(t){if(this._getType(t)!==$r.nan){const h=this._getOrReturnCtx(t);return Or(h,{code:ur.invalid_type,expected:$r.nan,received:h.parsedType}),Oi}return{status:"valid",value:t.data}}}$O.create=i=>new $O({typeName:Di.ZodNaN,...Ji(i)});class rZ extends vn{_parse(t){const{ctx:a}=this._processInputParams(t),h=a.data;return this._def.type._parse({data:h,path:a.path,parent:a})}unwrap(){return this._def.type}}class ZI extends vn{_parse(t){const{status:a,ctx:h}=this._processInputParams(t);if(h.common.async)return(async()=>{const v=await this._def.in._parseAsync({data:h.data,path:h.path,parent:h});return v.status==="aborted"?Oi:v.status==="dirty"?(a.dirty(),Cy(v.value)):this._def.out._parseAsync({data:v.value,path:h.path,parent:h})})();{const g=this._def.in._parseSync({data:h.data,path:h.path,parent:h});return g.status==="aborted"?Oi:g.status==="dirty"?(a.dirty(),{status:"dirty",value:g.value}):this._def.out._parseSync({data:g.value,path:h.path,parent:h})}}static create(t,a){return new ZI({in:t,out:a,typeName:Di.ZodPipeline})}}class y2 extends vn{_parse(t){const a=this._def.innerType._parse(t),h=g=>(Xm(g)&&(g.value=Object.freeze(g.value)),g);return uw(a)?a.then(g=>h(g)):h(a)}unwrap(){return this._def.innerType}}y2.create=(i,t)=>new y2({innerType:i,typeName:Di.ZodReadonly,...Ji(t)});bs.lazycreate;var Di;(function(i){i.ZodString="ZodString",i.ZodNumber="ZodNumber",i.ZodNaN="ZodNaN",i.ZodBigInt="ZodBigInt",i.ZodBoolean="ZodBoolean",i.ZodDate="ZodDate",i.ZodSymbol="ZodSymbol",i.ZodUndefined="ZodUndefined",i.ZodNull="ZodNull",i.ZodAny="ZodAny",i.ZodUnknown="ZodUnknown",i.ZodNever="ZodNever",i.ZodVoid="ZodVoid",i.ZodArray="ZodArray",i.ZodObject="ZodObject",i.ZodUnion="ZodUnion",i.ZodDiscriminatedUnion="ZodDiscriminatedUnion",i.ZodIntersection="ZodIntersection",i.ZodTuple="ZodTuple",i.ZodRecord="ZodRecord",i.ZodMap="ZodMap",i.ZodSet="ZodSet",i.ZodFunction="ZodFunction",i.ZodLazy="ZodLazy",i.ZodLiteral="ZodLiteral",i.ZodEnum="ZodEnum",i.ZodEffects="ZodEffects",i.ZodNativeEnum="ZodNativeEnum",i.ZodOptional="ZodOptional",i.ZodNullable="ZodNullable",i.ZodDefault="ZodDefault",i.ZodCatch="ZodCatch",i.ZodPromise="ZodPromise",i.ZodBranded="ZodBranded",i.ZodPipeline="ZodPipeline",i.ZodReadonly="ZodReadonly"})(Di||(Di={}));const GS=Ph.create;qh.create;Ac.create;const iZ=bs.create;bs.strictCreate;dw.create;fw.create;Tf.create;Km.create;pw.create;Bh.create;Jm.create;const vB=ke.forwardRef(({className:i,...t},a)=>ye.jsx("textarea",{className:Jn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:a,...t}));vB.displayName="Textarea";var nZ="Label",xB=ke.forwardRef((i,t)=>ye.jsx(oa.label,{...i,ref:t,onMouseDown:a=>{var g;a.target.closest("button, input, select, textarea")||((g=i.onMouseDown)==null||g.call(i,a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));xB.displayName=nZ;var wB=xB;const sZ=I0("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),bB=ke.forwardRef(({className:i,...t},a)=>ye.jsx(wB,{ref:a,className:Jn(sZ(),i),...t}));bB.displayName=wB.displayName;const oZ=l7,TB=ke.createContext({}),HS=({...i})=>ye.jsx(TB.Provider,{value:{name:i.name},children:ye.jsx(d7,{...i})}),Xw=()=>{const i=ke.useContext(TB),t=ke.useContext(SB),{getFieldState:a,formState:h}=Zw(),g=a(i.name,h);if(!i)throw new Error("useFormField should be used within <FormField>");const{id:v}=t;return{id:v,name:i.name,formItemId:`${v}-form-item`,formDescriptionId:`${v}-form-item-description`,formMessageId:`${v}-form-item-message`,...g}},SB=ke.createContext({}),y1=ke.forwardRef(({className:i,...t},a)=>{const h=ke.useId();return ye.jsx(SB.Provider,{value:{id:h},children:ye.jsx("div",{ref:a,className:Jn("space-y-2",i),...t})})});y1.displayName="FormItem";const v1=ke.forwardRef(({className:i,...t},a)=>{const{error:h,formItemId:g}=Xw();return ye.jsx(bB,{ref:a,className:Jn(h&&"text-destructive",i),htmlFor:g,...t})});v1.displayName="FormLabel";const x1=ke.forwardRef(({...i},t)=>{const{error:a,formItemId:h,formDescriptionId:g,formMessageId:v}=Xw();return ye.jsx(gz,{ref:t,id:h,"aria-describedby":a?`${g} ${v}`:`${g}`,"aria-invalid":!!a,...i})});x1.displayName="FormControl";const aZ=ke.forwardRef(({className:i,...t},a)=>{const{formDescriptionId:h}=Xw();return ye.jsx("p",{ref:a,id:h,className:Jn("text-sm text-muted-foreground",i),...t})});aZ.displayName="FormDescription";const w1=ke.forwardRef(({className:i,children:t,...a},h)=>{const{error:g,formMessageId:v}=Xw(),E=g?String(g==null?void 0:g.message):t;return E?ye.jsx("p",{ref:h,id:v,className:Jn("text-sm font-medium text-destructive",i),...a,children:E}):null});w1.displayName="FormMessage";const lZ=iZ({name:GS().trim().min(1,{message:"Name is required"}).max(100,{message:"Name must be less than 100 characters"}),email:GS().trim().email({message:"Invalid email address"}).max(255,{message:"Email must be less than 255 characters"}),message:GS().trim().min(1,{message:"Message is required"}).max(1e3,{message:"Message must be less than 1000 characters"})}),cZ=({scrollY:i})=>{const[t,a]=ke.useState(!1),{toast:h}=pz(),g=I7({resolver:R7(lZ),defaultValues:{name:"",email:"",message:""}}),v=async o=>{try{if(!(await fetch("https://ovgutswnhlteysfcbigx.supabase.co/functions/v1/send-contact-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92Z3V0c3duaGx0ZXlzZmNiaWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5ODk1MzcsImV4cCI6MjA3ODU2NTUzN30.4hdFVcv3HOdibT1fttjghFyMPPzjkRwBTqjJnUyRGpw"},body:JSON.stringify(o)})).ok)throw new Error("Failed to send message");h({title:"Message sent!",description:"Thank you for your interest. We'll get back to you soon."}),g.reset()}catch{h({title:"Error",description:"Failed to send message. Please try again.",variant:"destructive"})}};ke.useEffect(()=>{const o=()=>{const O=document.getElementById("impact");if(O){const F=O.getBoundingClientRect();a(F.top<window.innerHeight*.7)}};return window.addEventListener("scroll",o),o(),()=>window.removeEventListener("scroll",o)},[]);const E=[{icon:Q6,title:"Carbon Sequestration",description:"Trees and plants absorb harmful CO and produce vital oxygen",color:"primary"},{icon:r$,title:"Climate Stability",description:"Halt and reverse adverse effects of wildfires on ecosystems",color:"secondary"},{icon:$6,title:"Public Health",description:"Protect air quality and reduce wildfire health impacts",color:"primary"},{icon:qz,title:"Economic Resilience",description:"Safeguard investments and reduce catastrophic losses",color:"secondary"}];return ye.jsx("section",{id:"impact",className:"py-32 px-4 relative overflow-hidden",children:ye.jsxs("div",{className:"container mx-auto max-w-7xl relative z-10",children:[ye.jsxs("div",{className:`text-center mb-20 transition-all duration-1000 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsxs("h2",{className:"text-5xl md:text-7xl font-bold mb-6",children:["Global ",ye.jsx("span",{className:"text-gradient-primary",children:"Impact"})]}),ye.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"Humans now have the ability to halt and reverse the adverse effects of wildfires"})]}),ye.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16",children:E.map((o,O)=>{const F=o.icon;return ye.jsxs(Aa,{className:`glass-card p-8 text-center transition-all duration-500 hover:scale-105 hover-glow-${o.color} ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,style:{transitionDelay:`${O*100}ms`},children:[ye.jsx("div",{className:`inline-block p-4 rounded-xl bg-${o.color}/10 mb-4`,children:ye.jsx(F,{className:`w-10 h-10 text-${o.color}`})}),ye.jsx("h3",{className:"text-xl font-bold mb-3",children:o.title}),ye.jsx("p",{className:"text-muted-foreground leading-relaxed",children:o.description})]},O)})}),ye.jsxs(Aa,{className:`glass-card p-16 text-center max-w-5xl mx-auto hover-glow-primary transition-all duration-1000 delay-500 ${t?"opacity-100 scale-100":"opacity-0 scale-95"}`,children:[ye.jsxs("h3",{className:"text-4xl md:text-5xl font-bold mb-8 leading-tight",children:["With minimal intervention, ",ye.jsx("span",{className:"text-gradient-primary",children:"MISTIFY"})," augments environmental conditions enabling"," ",ye.jsx("span",{className:"text-gradient-secondary",children:"ecosystems to thrive"})]}),ye.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto leading-relaxed",children:"Reach out to receive a free tailored portfolio of high-impact solutions designed to deliver results from day one."})]}),ye.jsxs(Aa,{className:`glass-card p-12 max-w-3xl mx-auto mt-16 transition-all duration-1000 delay-700 ${t?"opacity-100 translate-y-0":"opacity-0 translate-y-10"}`,children:[ye.jsx("h3",{className:"text-3xl font-bold mb-6 text-center",children:"Get in Touch"}),ye.jsx("p",{className:"text-muted-foreground text-center mb-8",children:"Interested in learning more about MISTIFY? Send us a message."}),ye.jsx(oZ,{...g,children:ye.jsxs("form",{onSubmit:g.handleSubmit(v),className:"space-y-6",children:[ye.jsx(HS,{control:g.control,name:"name",render:({field:o})=>ye.jsxs(y1,{children:[ye.jsx(v1,{children:"Name"}),ye.jsx(x1,{children:ye.jsx(ew,{placeholder:"Your name",...o})}),ye.jsx(w1,{})]})}),ye.jsx(HS,{control:g.control,name:"email",render:({field:o})=>ye.jsxs(y1,{children:[ye.jsx(v1,{children:"Email"}),ye.jsx(x1,{children:ye.jsx(ew,{type:"email",placeholder:"your.email@example.com",...o})}),ye.jsx(w1,{})]})}),ye.jsx(HS,{control:g.control,name:"message",render:({field:o})=>ye.jsxs(y1,{children:[ye.jsx(v1,{children:"Message"}),ye.jsx(x1,{children:ye.jsx(vB,{placeholder:"Tell us about your interest in MISTIFY...",className:"min-h-[120px]",...o})}),ye.jsx(w1,{})]})}),ye.jsx(Ga,{type:"submit",className:"w-full",size:"lg",children:"Send Message"})]})})]})]})})},uZ=()=>ye.jsx("footer",{className:"py-16 px-4 border-t border-border/50",children:ye.jsx("div",{className:"container mx-auto max-w-7xl",children:ye.jsxs("div",{className:"text-center",children:[ye.jsxs("h3",{className:"text-4xl font-bold mb-6",children:[ye.jsx("span",{className:"text-gradient-primary",children:"MISTIFY"}),ye.jsx("span",{className:"text-foreground",children:".ai"})]}),ye.jsx("p",{className:"text-muted-foreground mb-8 max-w-2xl mx-auto",children:"Advancing agroforestry with AI robotics. Protecting our planet, one tree at a time."}),ye.jsxs("div",{className:"flex items-center justify-center gap-8 mb-12",children:[ye.jsxs("a",{href:"https://www.mistify.ai",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-secondary hover:text-secondary/80 transition-colors",children:[ye.jsx(qz,{className:"w-5 h-5"}),ye.jsx("span",{children:"www.mistify.ai"})]}),ye.jsxs("a",{href:"mailto:info@mistify.ai",className:"flex items-center gap-2 text-secondary hover:text-secondary/80 transition-colors",children:[ye.jsx(H6,{className:"w-5 h-5"}),ye.jsx("span",{children:"info@mistify.ai"})]})]}),ye.jsxs("div",{className:"text-xs text-muted-foreground/70 tracking-widest space-y-2",children:[ye.jsx("p",{children:"WORK PRODUCT  CONFIDENTIAL  PATENT PENDING"}),ye.jsx("p",{children:" 2025 MISTIFY.ai. All rights reserved."})]})]})})}),hZ=()=>{const[i,t]=ke.useState(0);return ke.useEffect(()=>{const a=()=>{t(window.scrollY)};return window.addEventListener("scroll",a,{passive:!0}),()=>window.removeEventListener("scroll",a)},[]),ye.jsxs("div",{className:"min-h-screen",children:[ye.jsx(yq,{scrollY:i}),ye.jsx(Sq,{scrollY:i}),ye.jsx(Eq,{scrollY:i}),ye.jsx(s7,{scrollY:i}),ye.jsx(cZ,{scrollY:i}),ye.jsx(uZ,{})]})},dZ=()=>{const i=X3();return ke.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",i.pathname)},[i.pathname]),ye.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:ye.jsxs("div",{className:"text-center",children:[ye.jsx("h1",{className:"mb-4 text-4xl font-bold",children:"404"}),ye.jsx("p",{className:"mb-4 text-xl text-gray-600",children:"Oops! Page not found"}),ye.jsx("a",{href:"/",className:"text-blue-500 underline hover:text-blue-700",children:"Return to Home"})]})})},fZ=new AH,pZ=()=>ye.jsx(PH,{client:fZ,children:ye.jsxs(iH,{children:[ye.jsx(j$,{}),ye.jsx(y8,{}),ye.jsx(pq,{children:ye.jsxs(hq,{children:[ye.jsx(JE,{path:"/",element:ye.jsx(hZ,{})}),ye.jsx(JE,{path:"*",element:ye.jsx(dZ,{})})]})})]})});fz(document.getElementById("root")).render(ye.jsx(pZ,{}));
